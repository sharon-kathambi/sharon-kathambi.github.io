webpackJsonp([9,226,228,238,247,248,249,250,251,263,268],{3590:function(e,t){(function(){TS.registerModule("ui.validation",{completed_sig:new signals.Signal,onStart:function e(){i();$("body").on("input.validation paste.validation change.validation","[data-validation]",TS.utility.debounce(function(e){if($(e.target).is(".ql-editor")||$(e.target).is(".ql-clipboard"))l($(e.target).closest(".ql-container"),{},e);else l($(e.target),{},e)},500));$("body").on("submit.validation","form[data-validation-form]",function(e){var t=$(e.target);var r=TS.ui.validation.validate(t);if(!r)e.preventDefault();TS.ui.validation.completed_sig.dispatch(t,{event:e,passed:r})})},validate:function e(t,r){r=r||{};var n=document;if(t){if(t.is("[data-validation]")){if(1===t.length)return l(t,r);return t.toArray().every(function(e){return l($(e),r)})}n=t.get(0)}var i=Array.prototype.slice.call(n.querySelectorAll("[data-validation]"));if(r&&r.fast)return i.every(function(e){return l($(e),r)});else if(r&&r.verbose){var a={};i.forEach(function(e){a[e.name]=l($(e),r)});return a}return i.reduce(function(e,t){return l($(t),r)&&e},true)},register:function e(t,r){if(o[t]){TS.warn(t+" cannot be registered because that key is already in use.");return}if("function"!==typeof r){TS.warn("Only functions can be registered as validators.");return}o[t]=r},showCustomValidation:function e(t,r,n,i){H(t,n.error_message||r,n.class,n,i)},getErrorMessage:function t(i,o){switch(i){case"invalid_name_required":return e.required();case"invalid_name_punctuation":return e.punctuation();case"invalid_name_maxlength":return e.maxlength({maxlength:o.maxlength});case"invalid_name_specials":return e.specials();case"name_taken":return e.name_taken({name:o.name});case"restricted_action":return n.restricted_action();case"name_invalid_name_required":return r.required();case"invalid_starts_with_at":return r.at_sign();case"name_invalid_name_maxlength":case"too_long":return r.maxlength({maxlength:o.maxlength});case"invalid_reserved_word":return r.reserved();case"name_invalid_name_specials":return r.specials();case"invalid_emoji_not_allowed":return r.emoji();case"display_name_not_allowed":return r.sso_display_name();case"invalid_email":return a.invalid();case"url_in_message":return s.url_in_message();default:return TS.i18n.t("For some weird reason, that didn’t work. Please try again to continue.","ui_validation")()}},maybeConvertNameErrorCode:function e(t){if("invalid_name_specials"===t)return"name_invalid_name_specials";if("invalid_name_maxlength"===t)return"name_invalid_name_maxlength";if("invalid_name_required"===t)return"name_invalid_name_required";return t},showError:function e(t,r,n,i){H(t,n.error_message||r,"validation_error",n,i)},showWarning:function e(t,r,n,i){H(t,n.warning_message||r,"validation_warning",n,i)},showSuccess:function e(t,r,n,i){H(t,n.success_message||r,"validation_success",n,i)},test:function e(){return{validations:o}}});var e={name_taken:TS.i18n.t("{name} is already taken by a channel, username, or user group.","ui_validation"),lowercase:TS.i18n.t("Channel names must be all lowercase. Try again?","ui_validation"),maxlength:TS.i18n.t("Blerg, that’s a bit too long! Channel names must be fewer than {maxlength} characters.","ui_validation"),required:TS.i18n.t("Don’t forget to name your channel.","ui_validation"),specials:TS.i18n.t("Channel names can’t contain spaces, periods, or most punctuation. Try again?","ui_validation"),punctuation:TS.i18n.t("Names can’t consist solely of punctuation. Please elaborate!","ui_validation")};var t={firstalphanumeric:TS.i18n.t("Usernames must start with a letter or number. Sorry about that!","ui_validation"),lowercase:TS.i18n.t("Sorry, usernames must be lowercase!","ui_validation"),maxlength:TS.i18n.t("Sorry, that’s a bit too long! Usernames must be fewer than {maxlength} characters.","ui_validation"),required:TS.i18n.t("Please fill in a username.","ui_validation"),specials:TS.i18n.t("Usernames can’t contain special characters. Sorry about that!","ui_validation")};var r={required:TS.i18n.t("Unfortunately, you can’t leave this blank.","ui_validation"),at_sign:TS.i18n.t("Names can’t start with the @ sign — that’s how your teammates will mention you in conversation.","ui_validation"),maxlength:TS.i18n.t("Unfortunately, names can’t be longer than {maxlength} characters.","ui_validation"),reserved:TS.i18n.t("That name’s already being used by Slack.","ui_validation"),specials:TS.i18n.t("Mostly, names can’t contain punctuation. (Apostrophes, spaces, and periods are fine.)","ui_validation"),emoji:TS.i18n.t("For all manner of complex reasons, names simply cannot contain emoji. Try again?","ui_validation"),sso_display_name:TS.i18n.t("Display names are automatically set by your organization.","ui_validation")};var n={};var i=function e(){n={restricted_action:TS.i18n.t("Sorry! An admin in your workspace has restricted who can create private channels.","ui_validation")}};var a={invalid:TS.i18n.t("This doesn’t seem like an email address. Sorry!","ui_validation")};var s={url_in_message:TS.i18n.t("Unfortunately, custom messages can’t contain URLs.","ui_validation")};var o={dateandformat:y,firstalphanumeric:x,hasnourl:p,isurl:f,lowercase:w,maxcsv:v,maxlength:g,mincsv:T,minlength:h,nospace:k,required:d,reservedwords:c,keywords:m,username:C,channel_name:P,shared_channel_name:A,team_name:E,is_email:F,membername:M};var l=function e(t,r,n){r=r||{};if(t.is("[data-validation-for]"))r.custom_for=t.attr("data-validation-for");r.success_message=TS.i18n.t("Nice, thanks!","ui_validation")();if(t.is("[data-validation-success]"))r.success_message=t.attr("data-validation-success");if(t.is("[data-validation-warning]"))r.warning_message=t.attr("data-validation-warning");if(t.is("[data-validation-error]"))r.error_message=t.attr("data-validation-error");if(q(t))U(t,r);var i=u(t).every(function(e){if(-1===e.indexOf("="))return o[e.trim()](t,r);var n=e.split("=");return o[n[0]](t,r,n[1])});TS.ui.validation.completed_sig.dispatch(t,{event:n,passed:i});if(D(t,i,r))TS.ui.validation.showSuccess(t,r.success_message,r,3e3);t.attr("aria-invalid",!i);return i};var u=function e(t){if(t.is("[data-validation]"))return _.compact(t.attr("data-validation").replace(/\s*(,|=)\s*/g,"$1").split(/\s+/));return[]};function d(e,t){if(e.is('input[type="radio"]')){if($(document.querySelectorAll('[name="'+e.prop("name")+'"][data-validation]')).filter(":checked").length)return true;TS.ui.validation.showWarning(e,TS.i18n.t("Please select an option","ui_validation")(),t)}else if(e.is('input[type="checkbox"]')){if($(document.querySelectorAll('[name="'+e.prop("name")+'"][data-validation]')).filter(":checked").length)return true;TS.ui.validation.showWarning(e,TS.i18n.t("Please select at least one option","ui_validation")(),t)}else if(e.is("select")){if(e.val())return true;TS.ui.validation.showWarning(e,TS.i18n.t("Please select an option","ui_validation")(),t)}else if(q(e)){if(G(e).trim())return true;TS.ui.validation.showWarning(e,TS.i18n.t("This field can’t be empty","ui_validation")(),t)}else TS.error("Error: cannot validate")}function c(e,t,r){if(e.is('input[type="radio"]')||e.is('input[type="checkbox"]')||e.is("select"))return true;if(q(e)){var n=G(e).trim().toLowerCase();var i=r.split(",");if(-1===i.indexOf(n))return true;TS.ui.validation.showWarning(e,TS.i18n.t('"{word}" is a reserved word. Try something else!',"ui_validation")({word:_.escape(n)}),t)}else TS.error("WTF: cannot validate")}function m(e,t){return c(e,t,TS.model.RESERVED_KEYWORDS.join(","))}function f(e,t,r){var n=G(e);var i=TS.i18n.t("This doesn’t seem like a proper link. Sorry!","ui_validation")();var a;var s=false;var o=false;if(!n)return true;if(e.is('input[type="radio"]')||e.is('input[type="checkbox"]')||e.is("select"))return true;if(!q(e)){TS.error("Error: cannot validate");return}if(r){a=r.split(",");if(-1!=a.indexOf("https"))i=TS.i18n.t("Please use https (for security).","ui_validation")();if(-1!=a.indexOf("http")&&-1==a.indexOf("https"))a.push("https");for(var l=0;l<a.length;l+=1)if(0===n.indexOf(a[l]+"://"))s=true}else{s=true;if(-1==n.indexOf("://"))n="http://"+n}o=TS.interop.url.simpleIsUrl(n);if(o&&s)return true;TS.ui.validation.showWarning(e,i,t)}function p(e,t){if(e.is('input[type="radio"]')||e.is('input[type="checkbox"]')||e.is("select"))return true;if(q(e)){var r=G(e);if(!r)return true;if(!TS.interop.url.findUrlsInString(r).length)return true;TS.ui.validation.showWarning(e,s.url_in_message(),t)}else TS.error("Error: cannot validate")}function h(e,t,r,n){return S(e,"minlength",t,r,n)}function g(e,t,r,n){return S(e,"maxlength",t,r,n)}function S(e,t,r,n,i){if(e.is('input[type="radio"]')||e.is('input[type="checkbox"]')||e.is("select"))return true;if(q(e)){var a=G(e);n=+n;if(void 0===a||isNaN(n)){TS.error("Error: no length to validate");return}if("minlength"===t){if(TS.interop.utility.getStringLength(a)>=n)return true;TS.ui.validation.showError(e,TS.i18n.t("This field can’t be less than {minlength, plural, =1{# character}other{# characters}}","ui_validation")({minlength:n}),r)}else if("maxlength"===t){if(!i)L(e,a.length,n,r);if(TS.interop.utility.getStringLength(a)<=n)return true;TS.ui.validation.showError(e,TS.i18n.t("This field can’t be more than {maxlength, plural, =1{# character}other{# characters}}","ui_validation")({maxlength:n}),r)}}else TS.error("Error: cannot validate")}function T(e,t,r){return b(e,"mincsv",t,r)}function v(e,t,r){return b(e,"maxcsv",t,r)}function b(e,t,r,n){if(e.is('input[type="radio"]')||e.is('input[type="checkbox"]')||e.is("select"))return true;if(q(e)){var i=G(e).trim();n=+n;if(void 0===i||isNaN(n)){TS.error("Error: no length to validate");return}if("mincsv"===t){if(i.split(/\s*,\s*/).length>=n)return true;TS.ui.validation.showError(e,TS.i18n.t("This field can’t have less than {minlength, plural, =1{# value}other{# values}}","ui_validation")({minlength:n}),r)}else if("maxcsv"===t){if(i.split(/\s*,\s*/).length<=n)return true;TS.ui.validation.showError(e,TS.i18n.t("This field can’t have more than {maxlength, plural, =1{# value}other{# values}}","ui_validation")({maxlength:n}),r)}}else TS.error("Error: cannot validate")}function y(e,t,r){if(e.is('input[type="radio"]')||e.is('input[type="checkbox"]')||e.is("select"))return true;if(q(e)){var n=G(e).trim();if(!n)return true;var i;var a;var s;var o;switch(r){case"Y-m-d":i="YYYY-MM-DD";a=n.match(/^[0-9]{4}-[0-9]{2}-[0-9]{2}$/);s=a&&1===a.length&&a[0]===n;if(s)o=B(n+"T00:00:00.000Z");break;case"m-d":i="MM-DD";a=n.match(/^[0-9]{2}-[0-9]{2}$/);s=a&&1===a.length&&a[0]===n;if(s)o=B("0000-"+n+"T00:00:00.000Z");break;default:TS.error("Error: cannot validate");return}if(s&&o)return true;if(!s)TS.ui.validation.showWarning(e,TS.i18n.t("This needs to be in the format {pattern}. Sorry!","ui_validation")({pattern:i}),t);else if(!o)TS.ui.validation.showWarning(e,TS.i18n.t("{value} doesn’t appear to be a valid date. Sorry!","ui_validation")({value:_.escape(n)}),t)}else TS.error("Error: cannot validate")}function w(e,t){var r=q(e)?G(e):e.val();var n=r===r.toLocaleLowerCase();if(n)return true;TS.ui.validation.showWarning(e,TS.i18n.t("This field must be lowercase only","ui_validation")(),t)}function k(e,t){var r=q(e)?G(e):e.val();var n=/\s/.test(r);if(!n)return true;TS.ui.validation.showWarning(e,TS.i18n.t("This field can’t contain spaces","ui_validation")(),t)}function x(e,t){var r=q(e)?G(e):e.val();var n=/^[^\W_]/.test(r);if(n)return true;TS.ui.validation.showWarning(e,TS.i18n.t("This first character must be a letter or number","ui_validation")(),t)}function C(e,r){var n=21;var i=$.extend({},r,{quiet:true});if(!d(e,i))TS.ui.validation.showWarning(e,t.required(),r);else if(!g(e,i,n,true))TS.ui.validation.showWarning(e,t.maxlength({maxlength:n+1}),r);else if(!k(e,i))TS.ui.validation.showWarning(e,t.specials(),r);else if(!O(e,i,/^[\w._-]+$/))TS.ui.validation.showWarning(e,t.specials(),r);else if(!x(e,i))TS.ui.validation.showWarning(e,t.firstalphanumeric(),r);else if(!w(e,i))TS.ui.validation.showWarning(e,t.lowercase(),r);else if(!c(e,r,TS.model.RESERVED_USERNAMES.join(",")))return false;else return true}function M(t,n,i){var a=$.extend({},n,{quiet:true});var s=80;if(t.is('input[type="radio"]')||t.is('input[type="checkbox"]')||t.is("select"))return true;if(!q(t)){TS.error("Error: cannot validate");return}var o=_.trim(G(t));var l=TS.interop.I18n.deburr(o.toLowerCase());var u=W(i);if(_.includes(u,"required")&&!d(t,a)){TS.ui.validation.showWarning(t,r.required(),n);return false}if(!g(t,a,s,true)){TS.ui.validation.showWarning(t,r.maxlength({maxlength:s}),n);return false}var c=TS.model.RESERVED_USERNAMES.concat(TS.model.RESERVED_KEYWORDS).map(function(e){return TS.interop.I18n.deburr(e)});if(-1!==c.indexOf(l)){TS.ui.validation.showWarning(t,r.reserved(),n);return false}if("@"===o.charAt(0)){TS.ui.validation.showWarning(t,r.at_sign(),n);return false}if(O(t,a,/^[-_.'‘’]+$/)){TS.ui.validation.showWarning(t,e.punctuation(),n);return false}if(O(t,a,/[`~!@#$%^&*+=\\:"<>?|]/)){TS.ui.validation.showWarning(t,r.specials(),n);return false}if(TS.emoji.hasUnifiedEmoji(o)){TS.ui.validation.showWarning(t,r.emoji(),n);return false}return true}function I(t,r){var n=$.extend({},r,{quiet:true});var i=21;if(!d(t,n)){TS.ui.validation.showWarning(t,e.required(),r);return true}if(!g(t,n,i,true)){TS.ui.validation.showWarning(t,e.maxlength({maxlength:i+1}),r);return true}if(!k(t,n)){TS.ui.validation.showWarning(t,e.specials(),r);return true}if(O(t,n,/^[-|_]+$/)){TS.ui.validation.showWarning(t,e.punctuation(),r);return true}}function P(e,t,r){if(e.is('input[type="radio"]')||e.is('input[type="checkbox"]')||e.is("select"))return true;if(!q(e)){TS.error("Error: cannot validate");return}var n=G(e);var i=W(r);var a=_.includes(i,"fix");if(a)n=z(e);var s=I(e,t);if(s)return false;var o=TS.shared.getActiveModelOb()||{};if($(".channel_options_modal").is(":visible")&&n===o.name)return false;var l=TS.channels.getChannelByName(n)||TS.groups.getGroupByName(n)||TS.members.getMemberByName(n);if(!l)return true;TS.ui.validation.showWarning(e,TS.i18n.t('"{name}" is already taken by a channel, username, or user group.',"ui_validation")({name:_.escape(n)}),t)}function A(e,t,r){if(e.is('input[type="radio"]')||e.is('input[type="checkbox"]')||e.is("select"))return true;if(!q(e)){TS.error("Error: cannot validate");return}var n=G(e);var i=W(r);var a=_.includes(i,"fix");if(a)n=z(e);var s=I(e,t);if(s)return false;var o=false;var l=TS.channels.getChannelByName(n)||TS.groups.getGroupByName(n)||TS.members.getMemberByName(n);var u=TS.shared.getActiveModelOb();if(!l)o=true;if(l&&l.id===u.id)o=true;if(l&&l.id!==u.id){TS.ui.validation.showWarning(e,TS.i18n.t("{name} has already been taken. Try something else!","ui_validation")({name:_.escape(n)}),t);return}return o}function E(e,t){t=t||{};var r=G(e).trim();var n=TS.validation.team_name(r);if(true!==n){t.should_truncate=false;if("empty"===n.error_key)TS.ui.validation.showCustomValidation(e,n.error_message,t);else TS.ui.validation.showError(e,n.error_message,t);return false}return true}function F(e,t){if(e.is('input[type="radio"]')||e.is('input[type="checkbox"]')||e.is("select"))return true;if(q(e)){var r=G(e);if(!r)return true;var n=r.match(TS.utility.email_regex);if(n&&1===n.length&&n[0]===r)return true;TS.ui.validation.showWarning(e,a.invalid(),t)}else TS.error("Error: cannot validate")}function O(e,t,r){var n=q(e)?G(e):e.val();if(!r.test(n))TS.ui.validation.showWarning(e,TS.i18n.t("This field contains invalid characters","ui_validation")(),t);else return true}var B=function e(t){if(!isNaN(Date.parse(t))){var r=new Date(t);return!r.toISOString().indexOf(t)}};var D=function e(t,r,n){var i=$(document.querySelector('label[for="'+(n.custom_for||t.attr("name"))+'"]'));if(!i.length)return;return!(n&&n.quiet)&&r&&false===i.data("validation-ephemeral")};var H=function e(t,r,n,i,a){i=i||{};if(_.isUndefined(i.should_truncate))i.should_truncate=true;if(i&&i.quiet)return;var s=$(document.querySelector('label[for="'+(i.custom_for||t.attr("name"))+'"]'));if(!s.length)return;var o=s.data("validation-timeout");clearTimeout(o);var l=s.find(".validation_message");if(!l.length){l=$("<span />").addClass("validation_message").toggleClass("overflow_ellipsis",i.should_truncate);if(t.is("select"))l.insertBefore(s.find("select"));else l.appendTo(s)}R(t,s,n);if(!r){l.remove();return}l.get(0).title=r;l.fadeIn(100);s.data("validation-ephemeral",!!a);if(a)s.data("validation-timeout",setTimeout(function(){s.removeData("validation-ephemeral").removeData("validation-timeout");l.fadeOut(100,function(){R(t,s);l.remove()})},a))};var j=["validation_error","validation_warning","validation_success"];var R=function e(t,r,n){if(r.hasClass(n))return;t.removeClass(j.join(" "));t.addClass(n);r.removeClass(j.join(" "));r.addClass(n)};var L=function e(t,r,n,i){if(n-r<=6)N(t,r,n,i);else U(t,i)};var N=function e(t,r,n,i){var a=document.querySelector('label[for="'+(i.custom_for||t.attr("name"))+'"]');if(!a)return;var s=[r,n].join("/");$(a).attr("data-countdown",s).addClass("countdown");var o=window.getComputedStyle(a,":after");var l=parseFloat(o.width)||9*s.length;if(t.hasClass("no_validation_padding"))return;if(!t.data("countdown-padding-right"))t.data("countdown-padding-right",parseFloat(t.css("padding-right")));t.css("padding-right",l+parseFloat(o.right)+t.data("countdown-padding-right"))};var U=function e(t,r){var n=document.querySelector('label[for="'+(r.custom_for||t.attr("name"))+'"]');if(!n)return;$(n).removeClass("countdown");t.removeData("countdown-padding-right");t.css("padding-right","")};var q=function e(t){if(TS.utility&&TS.utility.contenteditable)return t.is("input")||t.is("textarea")||TS.utility.contenteditable.isContenteditable(t);return t.is("input")||t.is("textarea")};var G=function e(t){if(TS.utility&&TS.utility.contenteditable)return TS.utility.contenteditable.value(t);return t.val()};var W=function e(t){if(!_.isString(t))return[];return _(t).split(",").map(_.trim).compact().value()};var z=function e(t){var r=G(t);var n=r.toLowerCase().replace(/^#+/,"");n=n.replace(/^\s+/,"");n=n.replace(/\s+$/,"");n=n.replace(/\s/g,"-");if(n&&r!==n){var i=TS.utility.contenteditable.cursorPosition(t).start;if(n.length<r.length)i-=r.length-n.length;t.val(n);TS.utility.contenteditable.cursorPosition(t,i)}return n}})()},3591:function(e,t){var r="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};var n=function(){function e(e,t){var r=[];var n=true;var i=false;var a=void 0;try{for(var s=e[Symbol.iterator](),o;!(n=(o=s.next()).done);n=true){r.push(o.value);if(t&&r.length===t)break}}catch(e){i=true;a=e}finally{try{if(!n&&s["return"])s["return"]()}finally{if(i)throw a}}return r}return function(t,r){if(Array.isArray(t))return t;else if(Symbol.iterator in Object(t))return e(t,r);else throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();(function(){TS.registerModule("utility",{onStart:function e(){TS.utility.makeRefererSafeLink=_.memoize(TS.utility.makeRefererSafeLink);if(TS.useSocket())TS.redux.socket.connectedSig.add(TS.utility.resetRefererSafeLinkCache);if(TS.prefs&&TS.prefs.team_hide_referers_changed_sig)TS.prefs.team_hide_referers_changed_sig.add(TS.utility.resetRefererSafeLinkCache);t=TS.i18n.t("me","utility")();i=TS.i18n.t("you","utility")();g=TS.utility.normalizeDevHost("https://"+document.location.hostname+"/files");S=TS.utility.normalizeDevHost("https://"+document.location.hostname+"/team")},keymap:{alt:18,ctrl:17,cmd_ff:224,cmd_other:91,cmd_right:93,esc:27,shift:16,tab:9,del:8,delete:46,enter:13,left:37,up:38,right:39,down:40,pageup:33,pagedown:34,end:35,home:36,space:32,semicolon:59,equals_sign:187,minus_sign:189,comma:188,period:190,left_square_bracket:219,right_square_bracket:221,V:86,a:65,e:69,b:66,k:75,i:73,z:90,y:89,insert:45,slash:191},email_regex:new RegExp("^[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$","i"),regexpEscape:function e(t,r){r=Math.min(r||5e5,5e5);if(t.length>r)t=t.slice(0,r);return _.escapeRegExp(t)},ensureInArray:function e(t,r){if(t.indexOf(r)>-1)return false;t.push(r);return true},compareVersions:function e(t,r){if(window.TS&&TS.interop&&TS.interop.versions&&TS.interop.versions.compareVersions)return TS.interop.versions.compareVersions(t,r);if(!t.major)t.major=0;if(!t.minor)t.minor=0;if(!t.patch)t.patch=0;if(!r.major)r.major=0;if(!r.minor)r.minor=0;if(!r.patch)r.patch=0;if(t.major===r.major){if(t.minor==r.minor){if(t.patch==r.patch)return 0;return t.patch>r.patch?1:-1}return t.minor>r.minor?1:-1}return t.major>r.major?1:-1},makeComparableVersion:function e(t){var r=t.split("-")[0];return _.reduce(r.split("."),function(e,t){return 1e3*e+parseInt(t,10)},0)},compareSemanticVersions:function e(t,r){var n=TS.utility.makeComparableVersion(t);var i=TS.utility.makeComparableVersion(r);if(n===i)return 0;return n>i?1:-1},isAppVersionBefore:function e(t){if(!TS.model.is_our_app){if("dev"===TS.boot_data.version_ts)throw new Error("Cannot check app version because we are not in the app, silly goose.");return false}return-1===TS.utility.compareSemanticVersions(TS.model.desktop_app_version.major+"."+TS.model.desktop_app_version.minor+"."+TS.model.desktop_app_version.patch,t)},doRectsOverlap:function e(t,r){return!(r.left>t.right||r.right<t.left||r.top>t.bottom||r.bottom<t.top)},doesRectContainRect:function e(t,r,n,i){n=n||0;if(r.top<t.top-n)return false;if(r.bottom>t.bottom+n)return false;if(i)return true;if(r.left<t.left-n)return false;if(r.right>t.right+n)return false;return true},shouldLinksHaveTargets:function e(){return!!(TS.client||TS.web&&TS.web.space)},parseJSONOrElse:function e(t,r){if(""===t)return r;try{return JSON.parse(t)}catch(e){return r}},stringifyJSONOrElse:function e(t,r,n,i){try{return JSON.stringify(t,r,n)}catch(e){if("function"===typeof i)return i(e);return i}},ordinalNumber:function e(t){return TS.i18n.t("{number_str, selectordinal, one{#st}two{#nd}few{#rd}other{#th}}","utilities")({number_str:t.toString()})},getTeamUrl:function e(){return S},getHistoryRetryDelay:function e(t,r){t=_.isInteger(t)?t:1;var n=2500;var i=5e3;var a=_.random(n,i);if("fatal_error"===r){var s=1.3;a*=Math.pow(s,t)}return a},getChannelNameFromUrl:function e(t){var r=TS.utility.getPathFromSlackUrl(t);if(!r)return"";var n="messages"==r[0]||"archives"==r[0];if(!n)return"";return decodeURIComponent(r[1])},getMessageTimestampFromUrl:function e(t){var r=TS.utility.getPathFromSlackUrl(t);if(!r)return"";var n="messages"==r[0]||"archives"==r[0];if(!n)return"";var i=r[2];if(!i||"p"!=i[0]||17!=i.length)return"";i=i.substr(1,10)+"."+i.substr(11);return decodeURIComponent(i)},getFlexPartsFromUrl:function e(t){var r=TS.utility.getPathFromSlackUrl(t);if(!r)return"";var n={messages:true,archives:true}[r[0]];var i=n?2:1;return r.slice(i)},getFlexNameFromUrl:function e(t){var r=TS.utility.getFlexPartsFromUrl(t)[0];if(!r)return"";return decodeURIComponent(r)},getFlexExtraFromUrl:function e(t){var r=TS.utility.getFlexPartsFromUrl(t)[1];if(!r)return"";return decodeURIComponent(r).replace(/%2F/g,"/")},getFlexExtraTypeFromUrl:function e(t){var r=TS.utility.getFlexPartsFromUrl(t)[2];if(!r)return"";return decodeURIComponent(r).replace(/%2F/g,"/")},removeUrlParam:function e(t,r){var n=r.split("?")[0];var i=-1!==r.indexOf("?")?r.split("?")[1]:"";var a=[];var s;if(""!==i){a=i.split("&");for(var o=a.length-1;o>=0;o-=1){s=a[o].split("=")[0];if(s===t)a.splice(o,1)}n=a.length?n+"?"+a.join("&"):n}return n},isUnreadViewPath:function e(t){return 0===t.indexOf("/unreads")},isThreadsViewPath:function e(t){return 0===t.indexOf("/threads")},isHomeScreenViewPath:function e(t){return 0===t.indexOf("/zen")},isAppsDashboardViewPath:function e(t){return 0===t.indexOf("/dashboard")},isAppSpaceViewPath:function e(t){return 0===t.indexOf("/app-space")},isSlackUrl:function e(t){return f.test(t)},getPathFromSlackUrl:function e(t){var r=t.match(f);var n=TS.boot_data.feature_cross_team_deeplink?2:1;var i=r&&r[n];if(!i)return;var a=t.split(i);var s=a[1].split("?")[0];return(i+s).split("/")},getTeamFromSlackUrl:function e(t){var r=t.match(f);var n=r&&r[1];return n},refashionUrl:function e(t,r,i,a){var s=document.createElement("a");s.href=t;var o=s.pathname.slice(1).split("/").slice(0,2),l=n(o,2),u=l[0],d=l[1];s.pathname=_.compact([r||"/"+u+"/"+d,i,a]).join("/");if("/"!==s.pathname[s.pathname.length-1])s.pathname+="/";return s.toString()},dataURItoBlob:function e(t){return TS.utility.base64StrtoBlob(TS.utility.base64StrFromDataURI(t))},base64StrFromDataURI:function e(t){return t.split(",")[1]},base64StrtoBlob:function e(t){var r=atob(t);var n=new ArrayBuffer(r.length);var i=new Uint8Array(n);for(var a=0;a<r.length;a+=1)i[a]=r.charCodeAt(a);var s=new DataView(n);var o=new Blob([s]);return o},ellipsize:function e(t,r){if(!t)return t;if(!r||!parseInt(r,10))r=50;if(t.length>r){var n=t.substr(0,r/2);var i=t.substr(-r/2,t.length);t=n+"..."+i}return t},makeSafeForDomId:function e(t){return String(t).replace(/\./g,"_")},makeSafeForDomClass:function e(t){return t.replace(/\s/g,"_")},getImageIconClass:function e(t,r){var n=r;var i=80;var a=80;if(t&&(t.thumb_360_w<i||t.thumb_360_h<a))if(t.thumb_360_w>t.thumb_360_h)n="landscape";else if(t.thumb_360_w<t.thumb_360_h)n="portrait";else n="square";return n},getAppliedClasses:function e(t){return _.reduce(t,function(e,t,r){if(t)e.push(r);return e},[]).join(" ")},convertFilesize:function e(t,r,n){if(0===t)return n?"0 bits":"0 bytes";var i=n?1024:1e3;if(Math.abs(t)<i)return t+" B";var a=n?["KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"]:["kB","MB","GB","TB","PB","EB","ZB","YB"];var s=-1;do{t/=i;s+=1}while(Math.abs(t)>=i&&s<a.length-1);return(r?t.toFixed(r):Math.round(t))+" "+a[s]},numberWithK:function e(t){if(t>999){t=Math.round(t/1e3*10)/10;return(TS.i18n.number(t)||"")+"K"}return TS.i18n.number(t)||""},cleanChannelName:function e(t){var r=XRegExp("[^\\pL\\pM\\pN_-]+","g");var n=XRegExp("[\\pM\\pM\\pM]","g");var i=/^[-_]+?$/;t=t.toLowerCase();t=t.replace(/^#+/g,"");t=t.replace(/ /g,"-");t=t.replace(r,"_");t=t.replace(/-+/g,"-");t=t.replace(/_+/g,"_");if(i.test(t)||n.test(t))return null;return t},openInNewTab:function e(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=n.dontEncodeHash,a=void 0===i?false:i;if(0===t.indexOf("/")&&TS.boot_data.team_url){var s=TS.boot_data.team_url;s=s.substr(0,s.length-1);t=s+t}var o=t;var l="";var u=o.indexOf("?");var d=TS.utility.urlNeedsRefererHiding(t);if(-1!==u){if(d)t=_.escape(t.substring(0,u));var c=o.substring(u+1,o.length);o=o.substring(0,u);if(c.length){var m=TS.interop.url.queryStringParse(c);var f=TS.interop.url.parseUrl(t);var p=false;if(f&&"accounts.google.com"==f.hostname&&"/o/oauth2/auth"==f.pathname)p=true;_.forEach(m,function(e,r){if(d){t=TS.interop.url.setUrlQueryStringValue(t,r,e||"",p);if(a)t=t.replace("%23","#")}else l+='<input type="hidden" name="'+_.escape(r)+'" value="'+_.escape(e||"")+'">'})}}if(d){l='<input type="hidden" name="url" value="'+_.escape(t)+'">';o="https://"+TS.boot_data.redir_domain+"/link"}$("<form>"+l+"</form>").attr({method:"GET",action:o,target:r}).appendTo("body").submit().remove()},isScalar:function e(t){return/boolean|number|string/.test("undefined"===typeof t?"undefined":r(t))},sanitizeHTML:function t(r,n,i,a){var s=function e(t){var r=t.tagName.toLowerCase();if(n.indexOf(r)<0)return null;Array.prototype.slice.apply(t.attributes).forEach(function(e){if(i.indexOf(e.name)<0)t.attributes.removeNamedItem(e.name)});Array.prototype.slice.apply(t.children).forEach(function(r){var n=e(r);if(!n)t.removeChild(r)});return t};e=e||new DOMParser;var o=e.parseFromString(r,"text/html")||e.parseFromString(r,"text/xml");var l=o.body;if(1!=l.children.length)return"";var u=s(l.children[0]);l=null;o=null;if(u)return a?u:u.outerHTML;return""},getChildTextNodes:function e(t){var r=[];if(!t)return r;if(t instanceof Text){r.push(t);return r}var n=document.createTreeWalker(t,NodeFilter.SHOW_TEXT,null,false);var i=n.nextNode();while(i){r.push(i);i=n.nextNode()}return r},getAttributesFromHTMLString:function t(r){e=e||new DOMParser;var n=e.parseFromString(r,"text/html")||e.parseFromString(r,"text/xml");var i=n.body;if(1!=i.children.length)return{};var a={};[].slice.apply(i.children[0].attributes).forEach(function(e){a[e.name]=e.value});i=null;n=null;return a},linkify:function e(t,r,n,i){if(!t)return t;t=t.replace(TS.interop.url.URL_REGEXP,function(e){var t;if(0===e.toLowerCase().indexOf("www.")){if(!n)return e;t="http://"+e}else t=e;if(i)return"<"+t+"|"+e+">";return"<a "+TS.utility.makeRefererSafeLink(t)+' target="'+(r||"")+'">'+e+"</a>"});return t},linkifyInternal:function e(t,r){return TS.utility.linkify(t,"",r,true)},preg_quote:function e(t){return(""+t).replace(/([\\.+*?[^\]$(){}=!<>|:])/g,"\\$1")},getActiveElementProp:function e(t){if(!document.activeElement)return"";if("NODENAME"===t){if(!document.activeElement.nodeName)return"";return document.activeElement.nodeName.toUpperCase()}return document.activeElement[t]},isTabCompleteShowing:function e(){if($("#chat_input_tab_ui").length)return true;return false},isFocusOnInput:function e(){var t=TS.utility.getActiveElementProp("NODENAME");if(""==t)return false;if("INPUT"===t)return true;if("TEXTAREA"===t)return true;if("SELECT"===t)return true;if(TS.utility.contenteditable.isContenteditable(document.activeElement))return true;return false},unformatTopicOrPurpose:function e(t){return TS.format.unFormatMsg(t)},formatTopicOrPurpose:function e(t,r){t=TS.format.formatWithOptions(t,{},{no_preformatted:!!r});t=t.replace(/(<br[^>]*>)/,'<span class="hidden br_ellipsis">…</span>$1');return t},removeLinksFromTabFlow:function e(t){return t.replace(p,'$1 tabindex="-1"$2')},populateInput:function e(t,r,n){if(!r)r="";var i=$(t);TS.utility.contenteditable.value(i,r);if(_.isNumber(n))TS.utility.contenteditable.cursorPosition(i,n)},populateThreadInputs:function e(t,r,n){if(TS.ui.replies.activeConvoModelId()===r&&TS.ui.replies.activeConvoThreadTs()===n)TS.ui.replies.populateReplyInput(t);if(TS.model.threads_view_is_showing)TS.ui.thread.findAndPopulateInput(t,r,n)},urlNeedsRefererHiding:function e(t){if(!t)return false;t=t.toLowerCase();if(0!==t.indexOf("https://")&&0!==t.indexOf("http://")&&0!==t.indexOf("ftp://")&&0!==t.indexOf("sftp://"))return false;var r=true;var n=TS.interop.url.getHostName(t,r);var i=getRefererHidingWhiteList();if(i&&i.indexOf&&-1!==i.indexOf(n))return false;return true},referer_safe_url_map:{},makeRefererSafeLink:function e(t){if("string"!==typeof t){TS.error("Expected url to be a string, got: "+("undefined"===typeof t?"undefined":r(t)));return}t=TS.format.replaceHighlightMarkers(t);var n=t.replace(/&amp;/g,"&");if(n.match(/javascript:/gi))n="#";var i=true;var a=TS.utility.sanitizeHTML('<a href="'+n+'"></a>',["a"],["href"],i)||null;if(a)n=a.href;n=_.escape(n).replace(/&amp;/g,"&").replace(/(%27|&#39;)/g,"'");if(t&&t.lastIndexOf("/")!==t.length-1)if(n&&n.lastIndexOf("/")===n.length-1)n=n.slice(0,-1);n=n||"#";var s='href="'+n+'"';var l="onclick";var u=o();if(!TS.model||!TS.model.is_our_app)if(u&&u.rewrite_on_right_click)l="onmousedown";if(!TS.utility.urlNeedsRefererHiding(t))return s;if(TS.utility.externalURLsNeedRedirecting()){var d=encodeURIComponent(n);var c="https://"+TS.boot_data.redir_domain+"/link?url="+d+(u&&u.redirect_type?"&v="+u.redirect_type:"");var m=_.escape(d);TS.utility.referer_safe_url_map[m]=n;s+=' data-referer-safe="1" '+l+'="this.href=&quot;'+c+'&quot;" onmouseover="this.href=TS.utility.referer_safe_url_map[&quot;'+m+'&quot;]" data-referer-original-href="'+n+'" rel="noreferrer"'}else s+=' rel="noreferrer"';return s},resetRefererSafeLinkCache:function e(){if(TS.utility.makeRefererSafeLink&&TS.utility.makeRefererSafeLink.cache)TS.utility.makeRefererSafeLink.cache.clear()},makeSureAllExternalLinksAreRefererSafe:function e(t){var r=Date.now();var n=[];if(TS.utility.externalURLsNeedRedirecting()){t.find("a[href]:not([data-referer-safe])").each(function(){var e=$(this);var t=e.attr("href");if(!TS.utility.urlNeedsRefererHiding(t))return;n.push(this.outerHTML);e.removeAttr("href");var r=this.outerHTML.replace("<a",function(){return"<a "+TS.utility.makeRefererSafeLink(t)+" "});e.replaceWith(r);n[n.length-1]+="\n->\n"+r});if(TS.model&&TS.model.team&&TS.has_pri[h]&&TS.boot_data.feature_tinyspeck)if(n.length){TS.log(h,"#"+t.attr("id")+" had "+n.length+" LINKS WITH EXT HREFS BUT NOT data-referer-safe! to fix it took "+(Date.now()-r)+"ms");TS.dir(h,n)}else TS.log(h,"#"+t.attr("id")+" had "+n.length+" LINKS WITH EXT HREFS BUT NOT data-referer-safe! to check it took "+(Date.now()-r)+"ms")}else{t.find("a[href]:not([rel])").each(function(){var e=$(this);var t=e.attr("href");if(0===t.indexOf("mailto")||0===t.indexOf("skype"))return;if(t&&"#"!==t){if(TS.utility.urlNeedsRefererHiding(t)){n.push(this.outerHTML);e.attr("rel","noreferrer");n[n.length-1]+="\n->\n"+this.outerHTML}}else e.removeAttr("href")});if(TS.model&&TS.model.team&&TS.has_pri[h]&&TS.boot_data.feature_tinyspeck)if(n.length){TS.log(h,"#"+t.attr("id")+" had "+n.length+' LINKS WITH EXT HREFS BUT WITHOUT rel="noreferrer"! to add rel it took '+(Date.now()-r)+"ms");TS.dir(h,n)}else TS.log(h,"#"+t.attr("id")+" had "+n.length+' LINKS WITH EXT HREFS BUT WITHOUT rel="noreferrer"! to check it took '+(Date.now()-r)+"ms")}},makeSureAllLinksHaveTargets:function e(t){var r=Date.now();var n=[];t.find("a[href]:not([target])").each(function(){var e=$(this);var t=e.attr("href");if(0===t.indexOf("mailto")||0===t.indexOf("skype"))return;if(t&&"#"!==t){n.push(this.outerHTML);e.attr("target",t);n[n.length-1]+="\n->\n"+this.outerHTML}else e.removeAttr("href")});if(TS.model&&TS.model.team&&TS.has_pri[h]&&TS.boot_data.feature_tinyspeck)if(n.length){TS.log(h,"#"+t.attr("id")+" had "+n.length+" LINKS WITH HREFS BUT WITHOUT TARGETS! to add targets it took "+(Date.now()-r)+"ms");TS.dir(h,n)}else TS.log(h,"#"+t.attr("id")+" had "+n.length+" LINKS WITH HREFS BUT WITHOUT TARGETS! to check it took "+(Date.now()-r)+"ms");TS.utility.makeSureAllExternalLinksAreRefererSafe(t)},sortTable:function e(t,r,n,i,a){n="desc"===n?"desc":"asc";a="desc"===a?"desc":"asc";function s(e){return function(t,r){var s=o(t,e);var l=o(r,e);if($.isNumeric(s)&&$.isNumeric(l)){if(s==l&&i){s=o(t,i);l=o(r,i);if($.isNumeric(s)&&$.isNumeric(l)){if(a!=n)return l-s;return s-l}if(a!=n)return TS.i18n.sorter(l,s);return TS.i18n.sorter(s,l)}return s-l}return TS.i18n.sorter(s,l)}}function o(e,t){return $(e).children("td").eq(t).attr("data-sort-val")}var l=t.find("tr:gt(0)").toArray().sort(s(r));if("desc"===n)l=l.reverse();for(var u=0;u<l.length;u+=1)t.append(l[u])},getPercSmartly:function e(t,r){if(!t||!r)return"0%";var n=t/r*100;if(100!=n&&100==Math.round(n))return"99%";if(n<.7)return"<1%";return Math.round(n)+"%"},isCursorWithinTBTs:function e(t){var r=TS.utility.contenteditable.cursorPosition(t);var n=TS.utility.contenteditable.value(t);var i=n.substr(0,r.end);var a=i.match(/```/g);if(!a)return false;var s=a.length;if(s%2)return true;return false},hex2rgb:function e(t){var r=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return r?{r:parseInt(r[1],16),g:parseInt(r[2],16),b:parseInt(r[3],16)}:void 0},rgb2hex:function e(t){if(/^#[0-9A-F]{6}$/i.test(t))return t;var r=t.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);if(!r)r=t.match(/^rgba\((\d+),\s*(\d+),\s*(\d+),\s*(\d*\.?\d+)\)$/);if(!r)return;function n(e){return("0"+parseInt(e,10).toString(16)).slice(-2)}return"#"+n(r[1])+n(r[2])+n(r[3])},setImmediate:function e(t){u(t)},immediateDebounce:function e(t){var r=false;return function(){if(r)return;var e=this;var n=arguments;r=true;u(function(){r=false;t.apply(e,n)})}},debounce:function e(t,r){var n;return function(){var e=this;var i=arguments;clearTimeout(n);n=setTimeout(function(){t.apply(e,i)},r)}},debounceWithPromise:function e(t,r){var n;return function(){var e=this;var i=arguments;if(n)n.cancel();n=new Promise(function(e){setTimeout(e,r)}).then(function(){return t.apply(e,i)});return n}},throttleFunc:function e(t,r,n){var i={};var a=function e(){var n=Array.prototype.slice.apply(arguments);var a=_.some(n,_.isObject);if(a)TS.error("You're passing non-scalar arguments to a function throttled with TS.utility.throttleFunc; it will likely not work as you want");var s="f-"+n.join("-");if(i[s]&&i[s].context!==this)throw new Error("Cannot use this function with different `this` contexts across different calls "+this+" "+i[s].context);i[s]=i[s]||{requested:Date.now(),timeout:0,context:this};if(i[s].timeout||e.always_wait)i[s].requested=Date.now();else t.apply(i[s].context,n);if(i[s].timeout)return;i[s].timeout=setTimeout(function e(){var a=Date.now()-i[s].requested;if(a>=r){t.apply(i[s].context,n);delete i[s]}else i[s].timeout=setTimeout(e,r-a)},r)};a.always_wait=!!n;return a},cmdKey:function e(t){if(!t)return false;if(TS.model.is_mac)return!!t.metaKey;return!!t.ctrlKey},looksLikeKeyboardShortcut:function e(t){var r=t.ctrlKey||t.altKey||t.metaKey;if(!r)return false;if(t.keyCode===TS.utility.keymap.alt||t.keyCode===TS.utility.keymap.ctrl||t.keyCode===TS.utility.keymap.cmd_ff||t.keyCode===TS.utility.keymap.cmd_other||t.keyCode===TS.utility.keymap.cmd_right)return false;var n=String.fromCharCode(t.keyCode);if(/^(\w|[$-/:-?{-~!"^_`[\]])$/i.test(n))return true;return true},isForwardDeleteKey:function e(t){if(t.keyCode===TS.utility.keymap.delete)return true;if(TS.model.is_mac&&t.ctrlKey&&"d"===t.key)return true;return false},isBoldKey:function e(t){if(!t)return false;return t.keyCode===TS.utility.keymap.b&&TS.utility.cmdKey(t)},isItalicKey:function e(t){if(!t)return false;return t.keyCode===TS.utility.keymap.i&&TS.utility.cmdKey(t)},throttle:function(){var e;var t;e={delay:200,timer_group:"generic"};t={timers:{},queues:{}};function r(e){var r;var n;if(t.timers[e]){if(t.queues[e])for(r=0,n=t.queues[e].length;r<n;r+=1)if(t.queues[e][r])t.queues[e][r]();t.queues[e]=null;t.timers[e]=null}}function n(n,i,a){if(!n)return false;i=i||e.timer_group;if(!t.timers[i]){a=a||e.delay;t.timers[i]=window.setTimeout(function(){r(i)},a)}if(!t.queues[i])t.queues[i]=[];if(t.queues[i].indexOf){if(-1===t.queues[i].indexOf(n))t.queues[i].push(n)}else t.queues[i].push(n)}return{method:n}}(),getImgProxyURL:function e(t,r,n){return TS.utility.getImgProxyURLWithOptions(t,{width:r,height:n})},getImgProxyURLWithOptions:function e(t,r){if(!t)return t;if(!TS.boot_data.image_proxy_url)return t;var n=TS.boot_data.image_proxy_url;if(0===t.indexOf(n))return t;var i=getRefererHidingWhiteList();var a;if(!r.emoji&&0===t.indexOf("https://")){a=t.replace(/^https:\/\//,"");var s=true;var o=TS.interop.url.getHostName(t,s);if(i&&-1!==i.indexOf(o)){if(r.stop_animations&&"slack-imgs.com"===o){var l=TS.interop.url.urlQueryStringParse(a).o1;var u;if(r.stop_animations||false===TS.prefs.getPref("a11y_animations"))u=l?l+".gu":"gu";else u=l&&l.replace(/\.gu|gu/,"");return TS.interop.url.setUrlQueryStringValue(t,"o1",u)}return t}}if(0===t.indexOf("/img/"))return t;n=TS.interop.url.setUrlQueryStringValue(n,"c","1");var d=[];var _=parseInt(r.width,10);var c=parseInt(r.height,10);if(_&&c){d.push("wi"+_);d.push("he"+c);if(TS.boot_data.feature_use_imgproxy_resizing)d.push("si")}if(r.rotate)d.push("ro");if(r.render_svg)d.push("sv2");if(r.convert_ico)d.push("ip");if(r.stop_animations||false==TS.prefs.getPref("a11y_animations"))d.push("gu");if(d.length>0)n=TS.interop.url.setUrlQueryStringValue(n,"o1",d.join("."));return TS.interop.url.setUrlQueryStringValue(n,"url",t)},rAF:function(){var e=["ms","moz","webkit","o"];var t=window.requestAnimationFrame;var r;for(r=0;r<e.length&&!t;r+=1)t=window[e[r]+"RequestAnimationFrame"];if(!t){var n=0;return function(e){var t=Date.now();var r=Math.max(0,16-(t-n));var i=window.setTimeout(function(){e(t+r)},r);n=t+r;return i}}return function(e){return t.call(window,e)}}(),cancelRAF:function(){var e=["ms","moz","webkit","o"];var t=window.cancelAnimationFrame;var r;for(r=0;r<e.length&&!t;r+=1)t=window[e[r]+"CancelAnimationFrame"]||window[e[r]+"CancelRequestAnimationFrame"];if(!t)return function(e){clearTimeout(e)};return function(e){t.call(window,e)}}(),startAnimation:function e(t){return m.subscribe(t)},getLocationHashString:function e(t){t=t||document;var r=t.location.hash;if(r&&r.length)return r.substr(1);return r},getYoutubeIdFromURL:function e(t){var r="";t=t.replace(/(>|<)/gi,"").split(/(vi\/|v=|\/v\/|youtu\.be\/|\/embed\/)/);if(void 0!==t[2]){r=t[2].split(/[^0-9a-z_-]/i);r=r[0]}else r=t;return r},loadUrlInWindowIfOnline:function e(t,r){r=r||document;var n=function e(n){if(n){$("body").addClass("hidden");r.location=t}else TS.generic_dialog.alert(TS.i18n.t("You can’t perform that action because you are not online :(","utility")())};return TS.api.call("api.test",{}).then(function(e){var t=e.data,r=e.args,i=e.request_id;var a=true;n(a,t,r,i);return{data:t,args:r,request_id:i}}).catch(function(e){var t=e.data,r=e.args,i=e.request_id;var a=false;n(a,t,r,i);return{data:t,args:r,request_id:i}})},externalURLsNeedRedirecting:function e(){if(TS.model.team&&TS.prefs.getTeamPref("hide_referers")&&!TS.model.is_our_app)return true;return false},swapInRedirUrlForIframe:function e(t,r){r=r||o();if(!r)return t;if(!r.iframe_redirect_type)return t;var n=$(t);var i=n.attr("src");if(!i)return t;if("1"==TS.qs_args.test_iframe_referers)i="https://"+document.location.host+"/referertester.html?"+Date.now();i="https://"+TS.boot_data.redir_domain+"/link?v="+r.iframe_redirect_type+"&url="+encodeURIComponent(i);n.attr("src",i);t=n[0].outerHTML;if("1"==TS.qs_args.test_iframe_referers)TS.info("html with redir:"+t);return t},setCssFromHeightAndWidthAttrs:function e(t){if(!t)return;var r=$(t);r.css({height:r.attr("height"),width:r.attr("width")});return r[0].outerHTML},isArrowKey:function e(t){var r=TS.utility.keymap;if(t==r.down)return true;if(t==r.up)return true;if(t==r.right)return true;if(t==r.left)return true;return false},isPageKey:function e(t){var r=TS.utility.keymap;if(t==r.pageup)return true;if(t==r.pagedown)return true;if(t==r.home)return true;if(t==r.end)return true;return false},isNumericKey:function e(t){if(t>=48&&t<=57)return true;return false},getFileIDFromURL:function e(t){if(!t)return null;t=TS.utility.normalizeDevHost(String(t));var r=document.createElement("a");r.href=g;var n=r.host;var i=document.createElement("a");i.href=t;var a;try{a=_.trimStart(i.pathname,"/")}catch(e){var s=true;TS.console.logError(e,"invalid_pathname_bug input="+t+", files_url="+g,void 0,s);return null}var o=[n,"files.dev.slack.com","files.staging.slack.com","files.slack.com"];var l=TS.redux.enterprise.getEnterprise();if(l&&l.domain)if(!TS.boot_data||"dev"!==TS.boot_data.version_ts)o.push(l.domain+".enterprise.slack.com");else o.push(l.domain+".enterprise.dev.slack.com");if(-1===o.indexOf(i.host))return null;var u;var d;if(0===a.indexOf("files/")){d=a.split("/");if(d.length<3)return null;var c=d[1];if(!c)return null;if(!(TS.members.getMemberByName(c)||TS.members.getMemberById(c)))return null;u=d[2]}else if(0===a.indexOf("files-pri/")){d=a.split("/");if(d.length<3)return null;var m=d[1];if(m.indexOf("-")<0)return null;var f=m.split("-");if(2!==f.length)return null;u=f[1]}else return null;if(!u)return null;if("F"!==u.substr(0,1))return null;if(u.length<2)return null;if(u.length>15)return null;return u},getMemberIdFromURL:function e(t){if(!t)return null;t=TS.utility.normalizeDevHost(String(t));var r;if(0===t.indexOf("/team/"))r=t.split("/team/");else{r=TS.utility.getPathFromSlackUrl(t);if(!r||r.length<2||"team"!==r[0])return null}var n=r[1];if(!n)return null;var i=TS.members.getMemberById(n)||TS.members.getMemberByName(n);if(i)return i.id;return null},normalizeDevHost:function e(t){return t.replace(/\.dev[0-9]*.slack.com/i,".dev.slack.com").replace(/\.staging.slack.com/i,".slack.com")},platformSupportsHtmlNotifications:function e(){if(TS.model.win_ssb_version&&window.winssb){if(window.winssb.app.canShowHtmlNotifications)return window.winssb.app.canShowHtmlNotifications();return false!==window.winssb.app.willUseHwAcceleration}return false},platformSupportsImgEmojiInHtmlNotifications:function e(){return TS.model.win_ssb_version&&(TS.model.win_ssb_version>.9||.9==TS.model.win_ssb_version&&TS.model.win_ssb_version_minor>=5)},findAllTeamEmojiInStr:function e(t,r){t=$.trim(t);var n=[];if(!t)return n;n=t.match(TS.emoji.getColonsRx())||n;var i=[];n=n.filter(function(e){if(TS.emoji.isValidName(e))return true;e.split("::").forEach(function(e){var t=TS.emoji.isValidName(e);if(!t)return;i.push(":"+t+":")});return false});n=n.concat(i);if(r)n=_.uniq(n);TS.dir(248,n);return n},areSimpleObjectsEqual:function e(t,n){if(t===n)return true;if(void 0===t&&n)return false;if(void 0===n&&t)return false;if(("undefined"===typeof t?"undefined":r(t))!==("undefined"===typeof n?"undefined":r(n)))return false;if(null===t&&n)return false;if(null===n&&t)return false;if(t.length!==n.length)return false;var i;for(i in n){if("undefined"===typeof t[i]&&"undefined"!==typeof n[i])return false;if(n[i])switch(r(n[i])){case"object":if(!e(t[i],n[i]))return false;break;case"function":if(String(n[i])!=String(t[i]))return false;break;default:if(n[i]!==t[i])return false}else if(t[i])return false}for(i in t)if("undefined"===typeof n[i]&&"undefined"!==typeof t[i])return false;return true},deepDiffObjects:function e(t,n){if(_.isEmpty(t))return{};else if(_.isEmpty(n))return t;var i={};_.each(t,function(e,t){var a=n[t];if(a===e)return;if(("undefined"===typeof e?"undefined":r(e))!==("undefined"===typeof a?"undefined":r(a)))i[t]=e;else if(_.isArray(e))i[t]=_.difference(e,a);else if(_.isPlainObject(e)){var s=TS.utility.deepDiffObjects(e,a);if(!_.isEmpty(s))i[t]=s}else i[t]=e});return i},appendLogToUrlWithLimit:function e(t,r){if(!t)return t;t+=-1==t.indexOf("?")?"?":"&";if(!r)return t;var n=2e3-t.length;return t+r.substr(0,n)},makeWebWorker:function e(t,r){var n=URL.createObjectURL(new Blob(["(",t,")()"],{type:"application/javascript"}));var i=new Worker(n);URL.revokeObjectURL(n);i.onmessage=r;return i},strGetWordCount:function e(t){return t.trim().split(/\s+/).length},truncateToNearestWordBoundary:function e(t,r){if(t.string)t=t.string;if(t.length<=r)return t;var n="…";var i=t.substring(0,r);var a=i.lastIndexOf(" ");if(a>0&&a>r-15)return i.substring(0,a)+n;return i.substring(0,i.length-1)+n},truncateAndEscape:function e(t,r){if(t.length<=r)return _.escape(t);return _.escape(t.substring(0,r-1))+"&hellip;"},truncateHTML:function(){var e;try{if(window.DOMParser){e=new DOMParser;if(!e.parseFromString("","text/html"))e=null}}catch(t){e=null}function t(e,r,n){var i=_.toArray(r.childNodes);_.forEach(i,function(i){if(e>=n){r.removeChild(i);return}if(i.nodeType===Node.TEXT_NODE){var a=i.textContent;if(e+a.length>n){i.textContent=a.substring(0,n-e);e+=n-e}else e+=i.textContent.length}else e=t(e,i,n)});return e}return function(r,n){try{var i;if(e){var a=e.parseFromString(r,"text/html");i=a.body}else{var s=jQuery.parseHTML("<div>"+r+"</div>");i=s[0]}var o=t(0,i,n);if(o>=n){var l=document.createTextNode("…");i.appendChild(l)}return i.innerHTML}catch(e){TS.error(e);return r}}}(),isSpaceClickEventSafe:function e(t,r){if(t.target){var n=$(t.target).closest("[href]");if(!n[0])return true;if(!n.closest(".post_body").length&&!n.closest("ts-rocket").length)return true;var i=n[0].protocol;if(i&&false===/^https?:$/.test(i)){TS.warn("not following bad link from a post preview");t.preventDefault();return false}if(n.data("original-href")){TS.warn("not following possibly spoofed link from a post preview");t.preventDefault();var s=n.data("referer-original-href")||n.attr("href");if(!r)a(n.data("original-href"),n.attr("href"),s);return false}}return true},getCachedScript:function e(t,r){r=$.extend(r||{},{dataType:"script",cache:true,url:t});return jQuery.ajax(r)},disableElement:function e(t,r){t=$(t);t.attr("disabled",r);t.attr("aria-disabled",r)},strToApparentlyRndPerc:function e(t){return parseFloat("."+TS.utility.strToApparentlyRndNum(t))},strToApparentlyRndNum:function e(t){if(!t)return NaN;t=String(t);var r=t.substr(Math.round(t.length/2),1);t=r+t.split("middle").reverse().join();var n="";for(var i=t.length-1;i>-1;i-=1)n+=(t.charCodeAt(i)*(i+1)).toString().substr(-1,1);return parseInt(n,10)},enableFeatureForUser:function e(t){if(t<0||t>100){TS.warn("TS.utility.enableFeatureForUser() expects a number between 0 and 100");return false}return _.random(0,100)<t},roundToThree:function e(t){return+(Math.round(t+"e+3")+"e-3")},convertBytesToMegabytes:function e(t){return t/1024/1024},convertKilobytesToMegabytes:function e(t){return t/1024},queryIsMaybeSelf:function e(r){r=_.toLower(r);if("me"===r||"you"===r||r===t||r===i)return true;return false},openAuthenticatedInBrowser:function e(t){var r=null!==TS.model.desktop_app_version;if(r&&parseFloat(TS.model.desktop_app_version.major+"."+TS.model.desktop_app_version.minor)>=2.6){var n=TS.boot_data.team_url+"web/open"+t;TSSSB.call("openAuthenticatedInBrowser",n)}else window.open(t)},getFontDescriptorForElement:function e(t){var r=t instanceof jQuery?t:$(t);return[r.css("font-style"),r.css("font-weight"),r.css("font-size"),r.css("font-family")].join(" ")},measureTextWidth:function e(t,r){if(!t)return 0;this._measure_text_width_canvas=this._measure_text_width_canvas||document.createElement("canvas");var n=this._measure_text_width_canvas.getContext("2d");n.font=r;return n.measureText(t).width},bytesInUnicodeCodePoint:function e(t){if(t<0||t>1114111)throw new RangeError("Invalid unicode code point {"+t+"}");if(t<128)return 1;if(t<2048)return 2;if(t<65536)return 3;if(t<=1114111)return 4},getRefererPolicy:function e(){return o},uuidv4:function e(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=Math.floor(16*Math.random());var r="x"==e?t:t%4+8;return r.toString(16)})},exampleEmailAddress:function e(t){if("you"===t)return TS.i18n.t("you@{example_com}","utility")({example_com:"example.com"});return TS.i18n.t("name@{example_com}","utility")({example_com:"example.com"})},exampleWebAddress:function e(){return"example.com"},test:function e(){var t={clearAndGetRefererPolicy:function e(){s=void 0;return o()},getRefererPolicy:function e(){return o()},setSlackUrlRe:function e(t){f=t}};Object.defineProperty(t,"_files_url",{get:function e(){return g},set:function e(t){g=t}});Object.defineProperty(t,"_team_url",{get:function e(){return S},set:function e(t){S=t}});return t}});var e;var t;var i;var a=function e(t,r,n){var i="";var a="";i+='<ts-icon class="ts_icon_warning yolk_orange small_right_margin"></ts-icon> ';i+=TS.i18n.t("Caution: Tricky Link","utility")();a+="<p>";a+='  <span class="inline_block">'+TS.i18n.t("The link you clicked (<strong>{url}</strong>) is tricky.","utility")({url:_.escape(n)})+"</span>";a+='  <span class="inline_block">'+TS.i18n.t("It has been formatted to look like another web address (<strong>{url}</strong>).","utility")({url:_.escape(t)})+"</span>";a+="</p>";a+="<p>"+TS.i18n.t("Are you sure you want to follow it?","utility")()+"</p>";TS.generic_dialog.start({title:i,body:a,show_cancel_button:false,show_secondary_go_button:true,secondary_go_button_text:TS.i18n.t("Let’s risk it","utility")(),secondary_go_button_class:"btn_outline",onSecondaryGo:function e(){window.open(r)},go_button_text:TS.i18n.t("Take me back to safety","utility")(),esc_for_ok:true,enter_always_gos:true})};var s;var o=function e(){if(!_.isUndefined(s))return s;var t=window.boot_data;if(!t){TS.warn("window.boot_data not available");s=null;return s}var r={iframe_redirect_type:4,redirect_type:3,rewrite_on_right_click:true};var n=TS.console&&TS.console.warn;if(!window.bowser){if(n)TS.warn(8675309,"window.bowser undefined, defaulting to restrictive referrer policy");s=r;return s}if(bowser.chrome&&bowser.version>=4.1||bowser.opera&&bowser.version>=15){s={iframe_redirect_type:4,redirect_type:null,rewrite_on_right_click:false};return s}if(bowser.ie){s={iframe_redirect_type:4,redirect_type:3,rewrite_on_right_click:true};return s}if(bowser.firefox){s={iframe_redirect_type:bowser.version>=36?4:2,redirect_type:3,rewrite_on_right_click:bowser.version<36};return s}if(bowser.safari&&bowser.version>=5||navigator.userAgent.match(/(Slack_SSB)/g)){s={iframe_redirect_type:2,redirect_type:null,rewrite_on_right_click:false};return s}if(navigator.userAgent&&navigator.userAgent.match(/phantomjs/i))n=false;if(n)TS.warn(8675309,"browser not recognized, defaulting to restrictive referrer policy");s=r;return r};var l=null;window.getRefererHidingWhiteList=function(){if(l)return l;l=["slack.com","slack-files.com","slack-imgs.com",TS.boot_data.redir_domain];return l};var u=window.setImmediate;if(!u)if(window.MutationObserver){var d=document.createElement("div");var c=[];new MutationObserver(function(){var e=c.slice();c.length=0;e.forEach(function(e){e()})}).observe(d,{attributes:true});u=function e(t){if(!c.length)d.setAttribute("yes","no");c.push(t)}}else u=function e(t){setTimeout(t,0)};var m=function(){var e=false;var t=[];function r(){if(!e)return;t.forEach(function(e){e()});TS.utility.rAF(r)}function n(n){var i={start:function i(){t.push(n);if(!e){e=true;TS.utility.rAF(r)}},stop:function r(){t.splice(t.indexOf(n),1);if(!t.length)e=false}};i.start();return i}return{subscribe:n,subscribers:t,isRunning:function t(){return e}}}();var f=/\.slack\.com\/((?:messages|archives|unreads|threads|team)\/)/;if(TS.boot_data.feature_cross_team_deeplink)f=/([^.:/]+)(?:\.[^.]+)?\.slack\.com\/((?:messages|archives|unreads|threads|team)\/)/;var p=/(<a\b[^>]*)(>)/gi;var h=365;var g=null;var S=null})()},3594:function(e,t){var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)if(Object.prototype.hasOwnProperty.call(r,n))e[n]=r[n]}return e};(function(){TS.registerModule("enterprise",{onStart:function e(){if(!TS.boot_data.page_needs_enterprise)return;if(TS.environment.isSSBAndAtLeastVersion("2.7"))TS.redux.socket.connectedSig.add(t)},addTeamsToSharedForChannel:function e(t,r){if(!TS.boot_data.page_needs_enterprise)return;if(!TS.shared.isModelObOrgShared(t))return;if(t.is_global_shared)return;var n=t.shared_team_ids;n=_(n).concat(r).uniq().value();t.shared_team_ids=n},updateSharesForChannel:function e(t,r,n){if(!TS.boot_data.page_needs_enterprise)return;if(!TS.shared.isModelObOrgShared(t))return;t.shared_team_ids=_.uniq(r);t.is_global_shared=!!n},promiseToSearchEnterpriseChannels:function t(a){var s=a.query,o=a.count;if(!TS.enterprise.isCrossWorkspacePrototypeEnabled())return Promise.resolve();var l=!!s;i(!l);var u=n({query:s,count:o});if(!u)return Promise.resolve();var d=TS.api.callImmediately("enterprise.channels.search",u).then(function(t){_.get(t,"data.channels",[]).forEach(function(t){if(TS.model.team.enterprise_id===t.team_id.replace(/^T/,"E"))return;if(!_.includes(TS.model.user.enterprise_user.teams,t.team_id))return;e[t.id]=r({},t,{is_cross_workspace:true})})}).catch(_.noop);return l?d:new Promise(function(e){return d.then(e)})},getChannelById:function t(r){var n=e[r];return n&&!n.is_group?n:null},getGroupById:function t(r){var n=e[r];return n&&n.is_group?n:null},getChannels:function t(){if(!TS.enterprise.isCrossWorkspacePrototypeEnabled())return[];return _.reject(_.values(e),"is_group")},getGroups:function t(){if(!TS.enterprise.isCrossWorkspacePrototypeEnabled())return[];return _.filter(_.values(e),"is_group")},displayEnterpriseChannel:function t(r,n){var i=e[r];if(!i)return;var a=i.team_id;if(n){var s=document.createElement("iframe");var o="slack://channel"+TS.interop.url.queryStringEncode({team:a,id:r});s.src=o;document.body.appendChild(s);setTimeout(function(){return s.remove()},1e3)}else{var l=_.get(TS.teams.getTeamById(a),"domain");var u=TS.utility.enterprise.buildTeamUrl(l)+"messages/"+r;TS.utility.openInNewTab(u,i.team_id)}},getModelObById:function e(t){if(!TS.boot_data.page_needs_enterprise)return TS.shared.getModelObById(t);return TS.shared.getModelObById(t)||TS.enterprise.getChannelById(t)||TS.enterprise.getGroupById(t)},isCrossWorkspacePrototypeEnabled:function e(){return TS.boot_data.page_needs_enterprise&&TS.boot_data.feature_enterprise_frecency&&TS.boot_data.feature_cross_workspace_quick_switcher_prototype}});var e={};var t=function e(t){if(!TS.boot_data.feature_ent_user_teams_validate)return;if(t)return;if(!TS.shared.isRelevantTeam())return;var r=TSSSB.call("getSignedInTeamIds");var n=_.get(r,"length");var i=20;if(!n)return TS.warn("WTF did not find any teams in the desktop?");if(n>=i)return TS.warn("Will not auto add any more teams to the desktop.");var a=TS.prefs.getPref("enterprise_excluded_app_teams");var s=a?a.split(","):[];var o=_.difference(_.get(TS.model,"user.enterprise_user.teams",[]),r,s).slice(0,i-n);_.map(o,function(e){return TS.client.userAddedToTeam(e,true)})};var n=function e(t){var r=t.query,n=t.count;if(r)return{query:r,count:n};var i=100;var a="C";var s="G";var o=_(TS.ui.frecency.getMostCommonWithPrefix(a)).map("id").reject(TS.shared.getModelObById).value().slice(0,i);var l=_(TS.ui.frecency.getMostCommonWithPrefix(s)).map("id").reject(TS.shared.getModelObById).value().slice(0,i);var u=o.concat(l);if(u.length)return{channels:u};return null};var i=function t(r){if(r)e={}}})()},3596:function(e,t){(function(){TS.registerModule("format.texty",{memberToSlug:function e(t,r){if(!t||!t.id||!t.name)return;var n=TS.members.getPrefCompliantMemberName(t,false,true);return{insert:n,attributes:{slackmention:{id:t.id,label:n,should_highlight:!!r}}}},convertContentsToString:function e(t){if(!t.contents)return"";var r=_.reduce(t.contents,function(e,t){if(t.attributes&&t.attributes.slackmention){if(t.insert.length>t.attributes.slackmention.label.length){var r=t.insert.split(t.attributes.slackmention.label);if(r.length>1){r.shift();r=r.map(function(){return"<@"+t.attributes.slackmention.id+"|"+_.escape(t.attributes.slackmention.label)+">"});return e+r.join("")}}return e+"<@"+t.attributes.slackmention.id+"|"+_.escape(t.attributes.slackmention.label)+">"}if(TS.utility.contenteditable.inlineEmojiIsEnabled()&&t.insert&&t.insert.slackemoji)return e+t.insert.slackemoji;return e+t.insert},"");return r.replace(/\n$/,"")},convertContentsToStringForDisplay:function e(t){if(!t.contents)return"";t=_.reduce(t.contents,function(e,t){if(t.attributes&&t.attributes.slackmention)return e+t.attributes.slackmention.label;if(t.insert.slackemoji)return e+t.insert.slackemoji;return e+t.insert},"");return t.replace(/\n$/,"")},convertContentsStringToContents:function e(t){var r;var n=0;var i={contents:[]};if(!t)t="";if(TS.utility.contenteditable.inlineEmojiIsEnabled()){var s=[];t.replace(a,function(e,t,r,n){r=_.unescape(r);s.push({index:n,length:e.length,replacement:{insert:r,attributes:{slackmention:{label:r,id:t,mention:TS.format.texty.shouldHighlightMention(t,r),unverified:"UNVERIFIED"===t}}}})});if("as_text"!==TS.prefs.getPref("emoji_mode"))t.replace(TS.emoji.getColonsRx(),function(e,t,r){var n=e;if(t)n=n.substr(0,n.length-t.length);n=n.replace(/:/g,"");if(TS.emoji.getEmojiByName(n))s.push({index:r,length:e.length,replacement:{insert:{slackemoji:e}}})});s=_.sortBy(s,"index");s.forEach(function(e){var r=t.substring(n,e.index);if(r.length)i.contents.push({insert:r});i.contents.push(e.replacement);n=e.index+e.length});r=t.substr(n);if(r.length)i.contents.push({insert:r});return i}if(-1!==t.search(a)){var o=[];t.replace(a,function(e,t,r,n){o.push({id:t,label:_.unescape(r),index:n,length:e.length})});o.forEach(function(e){var r=t.substring(n,e.index);if(r.length)i.contents.push({insert:r});var a=TS.format.texty.shouldHighlightMention(e.id,e.label);var s="UNVERIFIED"===e.id;i.contents.push({insert:e.label,attributes:{slackmention:{label:e.label,id:e.id,mention:a,unverified:s}}});n=e.index+e.length});r=t.substr(n);if(r.length)i.contents.push({insert:r});return i}i.contents.push({insert:t});return i},convertContentsStringForSlashCommands:function e(t){var r=TS.format.texty.convertContentsStringToContents(t);return _.reduce(r.contents,function(e,t){if(t.attributes&&t.attributes.slackmention){var r=t.attributes.slackmention.id;if(p(r))return e+"@"+g(r);else if(h(r))return""+e+t.attributes.slackmention.label;return e+"@"+r}if(t.insert&&t.insert.slackemoji)return e+t.insert.slackemoji;return e+t.insert},"")},convertContentsStringForEncodedMembers:function e(t){var r=TS.format.texty.convertContentsStringToContents(t);return _.reduce(r.contents,function(e,t){if(t.attributes&&t.attributes.slackmention){var r=t.attributes.slackmention.id;if(p(r))return e+"@"+g(r);else if(h(r))return""+e+t.attributes.slackmention.label;else if("S"===r.charAt(0)){var n=TS.user_groups.getUserGroupsById(r);if(n)return e+"<!subteam^"+n.id+"|@"+n.handle+">"}return e+"<@"+r+">"}if(t.insert&&t.insert.slackemoji)return e+t.insert.slackemoji;return e+t.insert},"")},convertContentsStringToDisplayString:function e(t){var r=TS.format.texty.convertContentsStringToContents(t);return TS.format.texty.convertContentsToStringForDisplay(r)},getMemberAsContentsString:function e(t){if(!t)return"";return"<@"+t.id+"|@"+TS.members.getMemberMentionName(t)+">"},getFormattedDelta:function e(t){if(!t)return;var r=t.map(s);var n=o(r);var i=_.last(n);i.insert=i.insert.replace(/\n$/,"");var a=n.map(l);return new TS.interop.texty.Delta(a)},replaceFormatMentions:function e(t,r,n){var i=0;r=r.replace(a,function(e,r,a){i+=1;var s="mention-placeholder-"+Date.now()+"-"+i;var o=n?_.escape(a):a;if(p(r))o="<!"+g(r)+">";else if(h(r));else if("S"===r.charAt(0)){var l=TS.user_groups.getUserGroupsById(r);if(l)o="<!subteam^"+l.id+"|@"+l.handle+">"}else{var u=TS.members.getMemberById(r);if(u)o="<@"+u.id+">"}t.push({mention:o,placeholder:s});return s});return r},buildSmartQuotesDelta:function e(t){var r=new TS.interop.texty.Delta;var n=0;var a=t.reduce(function(e,t){if(t.attributes&&t.attributes.slackmention){var r=t.insert.replace(/./g,"a");return e+r}if(t.insert.slackemoji)return e+"a";return e+t.insert},"");var s=TS.format.texty.replaceSmartQuotes(a);if(a===s)return r;for(var o=0;o<a.length;o++)if(a[o]!==s[o]&&-1!==i.indexOf(a[o])&&-1!==i.indexOf(s[o])){r.retain(o-n).delete(1).insert(s[o]);n=o+1}return r},replaceSmartQuotes:function e(t){t=t.replace(/[\u2018|\u2019]/g,"'");t=t.replace(/[\u201c|\u201d]/g,'"');var r=[];t=TSF.replaceFormatContents(r,t,{replace_pre:true,replace_code:true,replace_url:true});var n=[];t=m(t,n);t=t.replace(/([^A-Za-z0-9]|^)"(\S)/g,"$1“$2").replace(/(\u201c[^"]*)"([^"]*$|[^\u201c"]*\u201c)/g,"$1”$2").replace(/([^0-9])"/g,"$1”").replace(/([^A-Za-z0-9]|^)'(\S)/g,"$1‘$2").replace(/([a-z])'([a-z])/gi,"$1’$2").replace(/((\u2018[^']*)|[a-z])'([^0-9]|$)/gi,"$1’$3").replace(/(\u2018)([0-9]{2}[^\u2019]*)(\u2018([^0-9]|$)|$|\u2019[a-z])/gi,"’$2$3").replace(/(\B|^)\u2018(?=([^\u2019]*\u2019\b)*([^\u2019\u2018]*\W[\u2019\u2018]\b|[^\u2019\u2018]*$))/gi,"$1’").replace(/'/g,"′");t=f(t,n);t=TSF.swapOutPlaceholders(r,t);return t},removeInvalidMentions:function e(t){t.contents=t.contents.map(function(e){if(e.attributes&&e.attributes.slackmention&&!TS.members.getMemberById(e.attributes.slackmention.id)&&!TS.user_groups.getUserGroupsById(e.attributes.slackmention.id)&&-1===["BKeveryone","BKhere","BKchannel","BKgroup"].indexOf(e.attributes.slackmention.id))return{insert:e.insert};return e});return t},shouldHighlightMention:function e(t,r){if(TS.model.user.id===t)return true;else if(TS.user_groups.getUserGroupsById(t)&&-1!==TS.model.highlight_words.indexOf(r))return true;else if(-1!==["BKeveryone","BKhere","BKchannel","BKgroup"].indexOf(t))return true;return false},test:function e(){var t={};Object.defineProperty(t,"IGNORED_FORMATS",{get:function e(){return r},set:function e(t){r=t}});return t}});var e={bold:function e(t){return"*"+t+"*"},italic:function e(t){return"_"+t+"_"},code:function e(t){return"`"+t+"`"},strike:function e(t){return"~"+t+"~"},"code-block":function e(t){return"```\n"+t+"\n```"},bracketed:function e(t){return"["+t+"]"}};var t=["bold","italic","code","strike","bracketed"];var r=["code","code-block"];var n=["monospace","menlo","consolas","inconsolata","courier","monaco","anonymous pro","terminus","source code pro"];var i=["'",'"',"“","”","‘","’"];var a=/(?:<)@((?:(?:U|W|S)[A-Z0-9]{8})|BKeveryone|BKhere|BKchannel|BKgroup|UNVERIFIED)\|(@.*?)(?:>)/g;function s(t){var r={attributes:{},insert:t.insert};_.each(t.attributes,function(t,n){if("fontFamily"===n&&c(t))n="code";if(!e[n]||!t)return;if("code-block"===n)n="code";r.attributes[n]=true});return r}function o(e){var t=e.slice(0,1);_.each(e.slice(1),function(e){var r=_.last(t);if(_.isEqual(e.attributes,r.attributes))r.insert+=e.insert;else t.push(e)});return t}function l(n){var i={insert:n.insert};_.each(n.attributes,function(n,a){a=d(i.insert,a);if(_.includes(r,a))return;if(_.includes(t,a)){var s=i.insert.split("\n").map(function(t){return u(t,e[a])});i.insert=s.join("\n")}else i.insert=u(i.insert,e[a])});return i}function u(e,t){if(/^\s*$/.test(e))return e;return e.replace(/^(\s*)((?:.|\n)*?)(\s*)$/,function(e,r,n,i){return r+t(n)+i})}function d(e,t){if("code-block"===t&&e.match(/^[^\n]*\n?$/))return"code";if("code"===t&&e.match(/\n/g))return"code-block";return t}function c(e){if(!e)return false;var t=e.toLowerCase();if(_.includes(t," mono"))return true;return n.some(function(e){return _.includes(t,e)})}function m(e,t){TS.emoji.eachEmoticon(e,function(r){e=e.replace(r,function(e){var r="<emoticon-placeholder-"+Date.now()+">";t.push({emoticon:e,placeholder:r});return r})});return e}function f(e,t){t.forEach(function(t){e=e.replace(t.placeholder,t.emoticon)});return e}function p(e){return-1!==["BKeveryone","BKhere","BKchannel","BKgroup"].indexOf(e)}function h(e){return"UNVERIFIED"===e}function g(e){switch(e){case"BKeveryone":return"everyone";case"BKhere":return"here";case"BKchannel":return"channel";case"BKgroup":return"group";default:return""}}})()},3601:function(e,t){(function(){TS.registerModule("tabcomplete.channels",{type:"channels",getMatch:function e(t){if(!_.isString(t))return;var r;var n;var i;if(TS.boot_data.feature_allow_cjk_autocomplete&&TS.boot_data.feature_locale_ja_JP){n=Math.max(t.lastIndexOf("＃"),t.lastIndexOf("#"));i=/(^|\n|.)([#＃][^~`!@#＃$%^&*()+=[\]{}\\|;:'",.<>/?\s]*)$/i}else{n=t.lastIndexOf("#");i=/(^|\n|.)(#[^~`!@#$%^&*()+=[\]{}\\|;:'",.<>/?\s]*)$/i}var a=TS.interop.I18n.deburr(t);a.replace(i,function(e,i){if(!TS.tabcomplete.isAllowedSurroundingCharacter(i))return;r=t.substr(n,t.length-n)});if(!r)return;return{match:r,index:n}},shouldDisplayResults:function e(t,r){if(!t||_.isEmpty(r))return false;var n=t.replace(/^#/,"").toLowerCase();var i=1===r.length&&r[0].name===n;return!i},getResultAtIndex:function e(t,r){if(!t||!_.isNumber(r))return;return t[r]},getInsertData:function e(t){if(!t)return;TS.clog.track("PFP_ACTION",{contexts:{growth:{action:"autocomplete_select",trigger:"channel"}}});var r="#"+t.name;return{text:r,ensure_preceding_space:true}},search:function t(r,n,i){var a=e(r);i(null,a)},render:function e(t,r){var n=TS.templates.tabcomplete_channel_header({text:t});var i=TS.templates.tabcomplete_channel_results({results:r});return TS.tabcomplete.renderMenu(n,i)},onSelect:function e(t,r){if(!t)return;if(!r)r="";r=TS.boot_data.feature_allow_cjk_autocomplete&&TS.boot_data.feature_locale_ja_JP?r.replace(/^(#|＃)/,""):r.replace(/^#/,"");TS.ui.frecency.record(t,r)},onSelectedIndexChange:function e(t){TS.tabcomplete.onSelectedIndexChange(t)},shouldCompleteOnSelectionChange:function e(){return true}});function e(e){var t;t={channels:_.reject(TS.redux.channels.dangerouslyGetChannelsForUser(),function(e){if(e.is_private||e.is_mpim||e.is_archived)return e})};var r={prefer_exact_match:true,frecency:true,limit:25,allow_empty_query:true,search_previous_channel_names:true};var n=e.replace(/^#/,"");var i=TS.sorter.search(n,t,r);return _.map(i,"model_ob")}})()},3602:function(e,t){(function(){TS.registerModule("tabcomplete.commands",{type:"commands",getMatch:function e(t,r,n){if(!_.isString(t))return;if(_.isNumber(n)&&0!==n)return;if(t.startsWith("／"))t="/"+t.substring(1);if("/"===t)TS.clog.track("PFP_ACTION",{contexts:{growth:{action:"autcomplete_start",trigger:"slash_command"}}});var i;var a;TS.interop.I18n.deburr(t).replace(/^(\/\S*)$/i,function(e,r,n){a=n;i=t.substr(a,r.length)});if(!i)return;return{match:i,index:a}},getResultAtIndex:function e(t,r){if(!t||!_.isNumber(r))return;var n=_.flatMap(t,"cmds");return _.find(n,{index:r})},getInsertData:function e(t){if(!t)return;TS.clog.track("PFP_ACTION",{contexts:{growth:{action:"autcomplete_select",trigger:"slash_command"}}});if("last"===t.type)return TS.format.texty.convertContentsStringToContents(t.cmd);return{text:t.name}},search:function t(r,n,i){if(TS.apps.permissions.areXoxaAppsInstalled())TS.apps.permissions.ensureAppResourceMembershipIsKnown(TS.model.active_cid).then(function(){var t=e(r,n);i(null,t)});else{var a=e(r,n);i(null,a)}},render:function e(t,r){var n=TS.templates.tabcomplete_command_header({text:t});var i=TS.templates.tabcomplete_command_results({results:r});return TS.tabcomplete.renderMenu(n,i)},onSelectedIndexChange:function e(t){TS.tabcomplete.onSelectedIndexChange(t)},shouldCompleteOnSelectionChange:function e(){return true},onSelect:function e(t,r){if("client"===t.type)TS.clog.track("BUILTIN_CHAT_COMMAND_AUTOCOMPLETE",{locale:TS.i18n.locale(),search_term:r,slash_command_canonical_name:t.canonical_name||t.name,slash_command_name:t.name})}});function e(e,r){var n=t(r);var i=TS.interop.I18n.deburr(e.toLowerCase());i=TS.tabcomplete.trimTrailingCharacterModifier(i);if(i)n=n.filter(function(e){if(0===(e.normalized||e.name).indexOf(i))return true;if(e.canonical_name&&0===e.canonical_name.indexOf(i))return true;var t=e.localized_aliases||e.aliases;if(t)return t.some(function(e){var t=TS.interop.I18n.deburr(e);return 0===t.indexOf(i)});return false});var a=_.map(n,"name");var s=TS.cmd_handlers.sortNames(a);var o;if("/"===i&&TS.chat_history.getCommands().length){var l=TS.chat_history.getCommands()[0].trim();var u=l.split(" ")[0];var d=TS.cmd_handlers.getAvailableUserCmds()[u]&&!r.in_thread;var c=d?1:0;o=s.map(function(e,t){return _.assign({index:t+c,name:e},TS.cmd_handlers[e])});var m=l;m=TS.format.texty.convertContentsStringToContents(l);m=TS.format.texty.convertContentsToStringForDisplay(m);if(d){var f={name:m,cmd:l,index:0,type:"last"};o.unshift(f);var p=TS.cmd_handlers.groupCmdsByType(o);var h=TS.i18n.t("Last Used","command_tab_complete");p.unshift({name:h,id:"last",cmds:[f]});return p}return TS.cmd_handlers.groupCmdsByType(o)}o=s.map(function(e,t){return _.assign({index:t,name:e},TS.cmd_handlers[e])});return TS.cmd_handlers.groupCmdsByType(o)}function t(e){var t=TS.cmd_handlers.getAvailableUserCmds(e);var r=_.map(t,function(e,t){return _.assign({name:t},e)});return r}})()},3603:function(e,t){(function(){TS.registerModule("tabcomplete.emoji",{type:"emoji",getMatch:function e(t,r){if(!_.isString(t))return;var n;var i;var a;if(TS.boot_data.feature_localization)a=/(^|\n|[^+-])([+-]?[:|：][^~@#$%^&*()=[\]{}\\|;:：",.<>/ ]*)$/i;else a=/(^|\n|[^+-])([+-]?:[\w\-+'’]*)$/i;t.replace(a,function(e,r,a,s){var o=r[r.length-1];if(!TS.tabcomplete.isAllowedSurroundingCharacter(o))return;if(r.trim()&&/^[+-]/.test(a)){a=a.slice(1);s+=1}i=s+r.length;n=t.substr(i,a.length)});if(!n)return;if(!r)if(!l(n,TS.i18n.locale()))return;return{match:n,index:i}},shouldDisplayResults:function e(t,r,n){if(!t||_.isEmpty(r)||_.isEmpty(r.results))return false;if(1===r.results.length&&n)return false;return true},getResultAtIndex:function e(t,r){if(!t||!t.results||!_.isNumber(r))return;var n=t.results[r];if(!n)return;return{action:t.action,emoji:n}},getInsertData:function e(t){if(!t||!t.emoji)return;TS.clog.track("PFP_ACTION",{contexts:{growth:{action:"autocomplete_select",trigger:"emoji"}}});var r=":"+(t.emoji.display_name||t.emoji.name)+":";if(TS.utility.contenteditable.inlineEmojiIsEnabled())r=":"+t.emoji.name+":";if(t.emoji.is_skin){var n=!!TS.boot_data.feature_localization;if(TS.utility.contenteditable.inlineEmojiIsEnabled())n=false;r+=TS.emoji.getChosenSkinToneModifier(n)||""}var i=r;var a="";if("add_rxn"===t.action){i="+"+r;a="+"}else if("remove_rxn"===t.action){i="-"+r;a="-"}if(TS.utility.contenteditable.inlineEmojiIsEnabled())return{text:a,slackemoji:r};return{text:i}},getNextSelectedIndex:function e(a){var s;switch(a.keyCode){case TS.utility.keymap.right:s="right";break;case TS.utility.keymap.left:s="left";break;case TS.utility.keymap.up:s="up";break;case TS.utility.keymap.down:s="down"}if(!s)return;var o=t(a.menu);if(1===o.length)return 0;if("right"===s)return a.selectedIndex<o.length-1?a.selectedIndex+1:0;if("left"===s)return a.selectedIndex>0?a.selectedIndex-1:o.length-1;if(a.keyCode===TS.utility.keymap.home||"up"===s&&a.metaKey)return 0;if(a.keyCode===TS.utility.keymap.end||"down"===s&&a.metaKey)return o.length-1;var l=_.map(o,function(e,t){var n=r(e);n.index=t;return n});var u=l[a.selectedIndex];var d=n(u,l,"down"===s);var c=i(u,d);if(!c){if("down"===s)return o.length-1;if("up"===s)return 0}return c.index},search:function t(r,n,i){var o=/^(\+|-):/.test(r)?r[0]:"";var l=n.index;r=TS.emoji.normalizeSearchTerm(r);r=TS.tabcomplete.trimTrailingCharacterModifier(r);var u=a(r);var d;if(0===l&&o){var c=TS.shared.getActiveModelOb();var m=e(c);if("-"===o){var f=s(r,m);if(!_.isEmpty(f))d={action:"remove_rxn",results:f}}else if("+"===o){var p=_.difference(u,m);if(!_.isEmpty(p))d={action:"add_rxn",results:p}}}else d={action:"search",results:u};if("U02592DNU"===TS.model.user.id)TS.console.logError(JSON.stringify({query:r,results:d}),"emoji_tabcomplete_results");if(d&&!d.results.length)d=null;i(null,d)},render:function e(t,r){var n=TS.templates.tabcomplete_emoji_header({text:t,action:r.action});var i=_.map(r.results,function(e){return o(e,r.action)});var a=TS.templates.tabcomplete_emoji_results({results:i});return TS.tabcomplete.renderMenu(n,a)},onSelect:function e(t,r){if(!t||!t.emoji)return;if(!r)r="";r=r.replace(/^:/,"");TS.ui.frecency.record(t.emoji,r)},onSelectedIndexChange:function e(t){TS.tabcomplete.onSelectedIndexChange(t)},shouldCompleteOnSelectionChange:function e(){return!TS.utility.contenteditable.inlineEmojiIsEnabled()},test:function r(){var n={};Object.defineProperty(n,"_getResultElements",{get:function e(){return t},set:function e(r){t=r}});Object.defineProperty(n,"_getLocalResults",{get:function e(){return a},set:function e(t){a=t}});Object.defineProperty(n,"_getPrevMsgRxns",{get:function t(){return e},set:function t(r){e=r}});Object.defineProperty(n,"_sortResults",{get:function e(){return s},set:function e(t){s=t}});return n}});var e=function e(t){var r=TS.utility.msgs.getDisplayedMsgs(t.msgs);var n=_.find(r,function(e){return!e.is_ephemeral});if(!n)return;var i=TS.rxns.getMemberRxnsFromMessage(n,TS.model.user.id);var a=_.map(i,function(e){var t=e.name.replace(/(:.+)$/,"");return TS.emoji.getEmojiByName(t)});return _.compact(a)};var t=function e(t){if(!t)return[];return _.toArray(t.querySelectorAll(".tab_complete_ui_item"))};var r=function e(t){var r=t.offsetLeft;return{left:r,right:r+t.offsetWidth,top:t.offsetTop}};var n=function e(t,r,n){if(!t||!r||!r.length)return;var i=_.groupBy(r,"top");var a=_.map(_.keys(i),_.toNumber);var s=a.indexOf(t.top);var o=n?s+1:s-1;var l=a[o];return i[l]};var i=function e(t,r){if(!t||!r||!r.length)return;var n=r.filter(function(e){if(_.inRange(e.left,t.left,t.right))return true;if(_.inRange(e.right,t.left,t.right))return true;if(e.left<t.left&&e.right>t.right)return true;return false});if(!n)return;var i=_.maxBy(n,function(e){var r=Math.max(e.left,t.left);var n=Math.min(e.right,t.right);return n-r});return i};var a=function e(t){return s(t,TS.model.emoji_map)};var s=function e(t,r){if(!r||!r.length)return[];var n={emoji:r};var i={allow_empty_query:true,frecency:true,limit:50,prefer_exact_match:true};var a=t.replace(/^(\+|-)?:/,"");r=TS.sorter.search(a,n,i);return _.map(r,"model_ob")};var o=function e(t){var r=":"+(t.display_name||t.name)+":";var n={emoji_is_plain_text_only:"as_text"===TS.prefs.getPref("emoji_mode"),emoji:t,emoji_display_name_with_colons:r};if(t.is_skin){n.show_skin_tone_variant=t.is_skin;n.emoji_name_with_colons_and_skin=t.name_with_colons+TS.emoji.getChosenSkinToneModifier();var i=!!TS.boot_data.feature_localization;n.emoji_display_name_with_colons_and_skin=r+TS.emoji.getChosenSkinToneModifier(i)}return n};var l=function e(t,r){switch(r){case"ja-JP":return t.length>=2;default:return t.length>=3}}})()},3604:function(e,t){(function(){TS.registerModule("tabcomplete.members",{type:"members",getMatch:function e(t,r,n,i){var a;var s;var o=/(^|\n|.)?((?:@|\uFF20)[^\n@\uFF20]*)$/i;t.replace(o,function(e,t,r,n){var o=TS.tabcomplete.isAllowedSurroundingCharacter(t)||i&&i.allowed_preceding_symbols&&-1!==i.allowed_preceding_symbols.indexOf(t);if(!o)return;if(t)n+=t.length;a=r;s=n});if(!a&&r){var l=_.last(/(^|\s)([^\s\n@\uFF20]+)$/.exec(t));l=TS.tabcomplete.trimSurroundingSymbols(l);if(c(l,r)){a=l;s=t.length-l.length}}if(!a)return;return{match:a,index:s}},shouldDisplayResults:function e(t,r){if(!t||_.isEmpty(r))return false;return true},getResultAtIndex:function e(t,r){if(!t||!_.isNumber(r))return;return t[r]},getInsertData:function e(t){if(!t)return;TS.clog.track("PFP_ACTION",{contexts:{growth:{action:"autocomplete_select",trigger:"member"}}});var r=TS.tabcomplete.members.getDisplayTextForResult(t);var n=TS.format.texty.shouldHighlightMention(t.id,r);return{text:r,format:{slackmention:{id:t.id,label:r,mention:n}}}},getDisplayTextForResult:function e(t){if(t.is_broadcast_keyword)return"@"+t.name;else if(t.is_usergroup)return"@"+t.handle;return"@"+TS.members.getMemberMentionName(t)},search:function r(n,i,u){var d=f(n,i.isUserSolicited);var c=m(d);var h;if(!i.no_model_ob)h=i.model_ob||TS.shared.getActiveModelOb();var g=l(h,i.no_model_ob);var S=TS.user_groups.getActiveUserGroups();var T;if(i.complete_member_specials)T=TS.tabcomplete.members.getBroadcastKeywords(i.complete_member_specials);var v=a(h,n,{members:g,usergroups:S,broadcast_keywords:T},i.include_deleted);c(function(){u(null,v)});if(h){var b=_(g).map("id").without("USLACKBOT").value();if(b.length>e){var y=TS.boot_data.page_needs_enterprise?"W":"U";var w=TS.ui.frecency.getMostCommonWithPrefix(y,e);var k=_.map(w,"id");var x=_.intersection(b,k);var C=_.difference(b,x);b=x.concat(C.slice(0,e-x.length))}TS.log(1990,"Ensuring we have membership for "+b.length+" users in "+h.id+": "+b);TS.membership.ensureChannelMembershipIsKnownForUsers(h.id,b).then(function(e){TS.log(1990,"Got membership for "+b.length+" users in "+h.id+"; any fetches required? "+e);if(e)c(function(){u(null,v)})});if(TS.apps.permissions.areXoxaAppsInstalled())TS.apps.permissions.ensureAppResourceMembershipIsKnown(h.id).then(function(e){if(e)c(function(){u(null,v)})})}if(o(n,g,i)){var M={include_deleted:i.include_deleted,limit:t};var I=s(h,n,M);I.then(function(e){var t=_(g).concat(e).compact().uniqBy("id").value();var r=a(h,n,{members:t,usergroups:S,broadcast_keywords:T},i.include_deleted);var s=[];if(h){var o=_.filter(r,"is_usergroup");s=_.reduce(o,function(e,t){var r=TS.user_groups.ensureUserGroupMembersInModelObNumIsKnown(t.id,h.id);if(!r.isResolved())e.push(r);return e},[]);TS.membership.ensureChannelMembershipIsKnownForUsers(h.id,_.map(r,"id"))}if(s.length)Promise.all(s).then(function(){c(function(){u(null,r)})});else if(!p(v,r))c(function(){u(null,r)});return null})}},render:function e(t,r,n){if("@"!==t[0]&&"＠"!==t[0])t="@"+t;var i=TS.templates.tabcomplete_member_header({text:t});var a;if(!n.no_model_ob)a=n.model_ob||TS.shared.getActiveModelOb();var s=r.map(function(e){if(e.is_broadcast_keyword)return e;if(e.is_usergroup)return d(a,e);return u(a,e,t)});var o=TS.templates.tabcomplete_member_results({results:s,is_client:!!TS.client});return TS.tabcomplete.renderMenu(i,o)},onSelect:function e(t,r){if(!t)return;if(!r)r="";r=r.replace(/^@/,"");TS.ui.frecency.record(t,r)},getIndexForPopulatingInput:function e(t,r){if(!w()){TS.tabcomplete.members.onSelectedIndexChange(t);return t}var n=$(".tab_complete_ui_item.active").data("index");var i=t;var a=t;var s=y(n,t,r);if(b()||T(t))if(s){i=S()-1;a=i}else{i=0;a=0}else if(_.isUndefined(r)&&v(t)){i=n;a=n}else if(!s&&v(t)){i=0;a=0}TS.tabcomplete.members.onSelectedIndexChange(a);return i},onSelectedIndexChange:function e(t){TS.tabcomplete.onSelectedIndexChange(t)},shouldCompleteOnSelectionChange:function e(){return true},getBroadcastKeywords:function e(t){var r=TS.utility.members.getBroadcastKeywordsForUser();if(_.isArray(t))r=r.filter(function(e){return-1!==t.indexOf(e.id)});return r},test:function e(){var t={IGNORED_SEARCH_TERMS:r,MIN_UNPREFIXED_MATCH_LENGTH:n};Object.defineProperty(t,"IGNORED_SEARCH_TERMS",{get:function e(){return r},set:function e(t){r=t}});Object.defineProperty(t,"_shouldDoAsyncSearch",{get:function e(){return o},set:function e(t){o=t}});Object.defineProperty(t,"_getLocalMembers",{get:function e(){return l},set:function e(t){l=t}});Object.defineProperty(t,"_sortResults",{get:function e(){return a},set:function e(t){a=t}});Object.defineProperty(t,"SEARCH_DELAY_MS",{get:function e(){return i},set:function e(t){i=t}});return t}});var e=100;var t=25;var r=["the","and"];var n=3;var i=500;var a=function e(r,n,i,a){var s={allow_empty_query:true,frecency:true,limit:t,prefer_exact_match:true};var o=r&&!r.is_im;if(o){s.model_ob=r;s.prefer_channel_members=o}var l=n.replace(/^@/,"");var u=_.trimEnd(l);var d=TS.sorter.search(u,i,s);var c=_.map(d,"model_ob");var m=c;if(a)m=_.sortBy(m,function(e){return e.deleted});return m};var s=function e(t,r,n){var i={query:r.replace(/^@/,""),max_api_results:n.limit,include_deleted:n.include_deleted,include_org:true,include_slackbot:true,include_self:true,full_profile_filter:false};if(!n.include_deleted)i.limit_by_model_relevancy=t;if(t&&!t.is_im)i.determine_membership_for_channel=t.id;return TS.members.promiseToSearchMembers(i).then(function(e){if(!e||!e.items||!e.items.length)return[];return e.items})};var o=function e(t,i,a){if(0!==t.indexOf("@")){if(-1!==r.indexOf(t))return false;if(t.length<n)return false;if(a.member_prefix_required)return false;return false}if(i&&i.length)if(1===i.length&&"@"+i[0].name===t)return false;return true};var l=function e(t,r){var n=TS.members.getActiveMembersWithSelfAndSlackbot();if(!r)n=n.filter(function(e){return TS.utility.members.isMemberRelevantToModel(e,t)});return n};var u=function e(t,r){var n=[];var i=[];var a;var s;a=TS.members.getPrefCompliantMemberName(r,false,false);s=TS.members.getMemberSecondaryName(r);n.push("primary_name");i.push("secondary_name");var o=t&&!t.is_im;var l;var u;var d;if(r.is_app_user){d=TS.apps.permissions.getAppUserResourceMembershipStatus(r.id,t.id);u=d.is_known;l=!d.is_member}else if(o){if(TS.boot_data.feature_store_membership_in_redux)d=TS.redux.membership.getChannelMembershipInfoForUser(t.id,r.id);else d=TS.membership.getUserChannelMembershipStatus(r.id,t);u=d.is_known;if(u)l=!d.is_member}var _;if(TS.utility.teams.isMemberExternal(r)){var c=TS.teams.getTeamById(r.team_id);if(c&&c.name)_=c.name}return{is_member:true,member:r,primary_name_classes:n.join(" "),secondary_name_classes:i.join(" "),show_channel_membership:o,member_does_not_belong_to_channel:l,secondary_name:s,primary_name:a,membership_status_is_known:u,team_name:_}};var d=function e(t,r){var n=0;if(t)n=TS.user_groups.getUserGroupMembersNotInModelObCount(r.id,t.id);return{description:r.description||r.name,is_usergroup:true,members_not_in_channel:n,usergroup:r}};var c=function e(t,i){if(!t)return false;if(i)return true;if(t.length<n)return false;if(_.includes(r,t.toLowerCase()))return false;return true};var m=function e(t){var r=Date.now()+t;return function(e){var t=Date.now();var n=Math.max(0,r-t);setTimeout(e,n)}};var f=function e(t,r){if(0===t.indexOf("@"))return 0;if(r)return 0;return i};var p=function e(t,r){if(!r&&!t)return true;if(!r||!t)return false;if(t.length!==r.length)return false;return _.isEqualWith(t,r,function(e,t){return e.id===t.id})};var h=function e(){return $(".tab_complete_ui_item")};var g="reveal_hidden_items";var S=function e(){var t=h();var r=t.index($("."+g));if(r)return r;return-1};var T=function e(t){var r=h();if(r.eq(t).hasClass("deleted"))return true;return false};var v=function e(t){var r=h();if(r.eq(t).hasClass(g))return true;return false};var b=function e(){var t=$(".active."+g);return-1!==h().index(t)};var y=function e(t,r,n){if(n)return n;if(0===t&&Math.abs(r-t)>1)return true;if(t-r===1)return true;return false};var w=function e(){if($(".tab_complete_ui_item.deleted").length)return true;return false}})()},3605:function(e,t){(function(){TS.registerModule("tabcomplete",{positionUIRelativeToInput:function e(t,r,n){if(!t||!r)return;var i=$(r).offset();t.style.left=i.left+"px";var a;if(n){var s=i.top+$(r).height()+2;t.style.top=s+"px";a=$(window).height()-s}else{t.style.bottom=$(window).height()-i.top+"px";a=i.top}var o=_.clamp(a-$(t).find(".tab_complete_ui_header").outerHeight()-2,454);$(t).find(".tab_complete_ui_scroller").css("maxHeight",o+"px")},render:function e(t,r,n,i){switch(t){case"members":return TS.tabcomplete.members.render(r,n,i);case"commands":return TS.tabcomplete.commands.render(r,n,i);case"emoji":return TS.tabcomplete.emoji.render(r,n,i);case"channels":return TS.tabcomplete.channels.render(r,n,i);default:TS.warn('TS.tabcomplete: unknown render type "'+t+'"')}},renderMenu:function e(t,r){return TS.templates.tabcomplete_menu({safe_header_html:new Handlebars.SafeString(t),safe_results_html:new Handlebars.SafeString(r)})},onSelectedIndexChange:function e(t){var r=$(".tab_complete_ui_item");r.removeClass("active");r.eq(t).addClass("active");r.eq(t).scrollintoview({duration:0})},isAllowedSurroundingCharacter:function e(t){if(!t||!t.trim())return true;return""===TS.tabcomplete.trimSurroundingSymbols(t)},trimSurroundingSymbols:function e(t){if(!t)return"";return t.replace(r,"")},trimTrailingCharacterModifier:function e(t){if(!t)return"";return t.replace(n,"")},test:function t(){return{ALLOWED_PRECEDING_SYMBOLS:e}}});var e=["{","[","(","*","_","/",'"',"“","'","‘","<"];var t={hiragana:"\\u3040-\\u309F",katakana:"\\u30A0-\\u30FF",katakana_phonetic_extensions:"\\u31F0-\\u31FF",halfwidth_fullwidth_forms:"\\uFF00-\\uFFEF",cjk_ideographs:"\\u3400-\\u4DBF\\u4E00-\\u62FF\\u6300-\\u77FF\\u7800-\\u8CFF\\u8D00-\\u9FFF",cjk_radicals:"\\u2E80-\\u2EFF",cjk_kangxi_radicals:"\\u2F00-\\u2FDF",cjk_ideographic_description_characters:"\\u2FF0-\\u2FFF",cjk_punctuation:"\\u3001-\\u303F",cjk_strokes:"\\u31C0-\\u31EF",cjk_enclosed_letters_months:"\\u3200-\\u32FF",cjk_compatability:"\\u3300-\\u33FF\\uF900-\\uFAFF\\uFE30-\\uFE4F"};var r=function(e,t){var r=e.map(function(e){return"\\"+e});if(TS.boot_data.feature_allow_cjk_autocomplete&&TS.boot_data.feature_locale_ja_JP)return new RegExp("^("+r.join("|")+"|["+_.values(t).join("")+"])+","g");return new RegExp("^("+r.join("|")+")+","g")}(e,t);var n=/[`´ˆ¨˜]$/})()},3607:function(e,t){(function(){TS.registerComponent("ui.CurrentStatusInput",{_constructor:function e(t){this._onSave=t.onSave;this._onEscape=t.onEscape;this._onError=t.onError;this._$container=t.$parent.find(".current_status_input_container").addBack(".current_status_input_container");this._$emoji_input=t.$parent.find('[name="status_emoji"]');this._$inline_saver=t.$parent.find(".current_status_inline_saver");this._$input=t.$parent.find(".current_status_input");this._$action_buttons=t.$parent.find(".current_status_action_buttons");this._$cancel_button=this._$action_buttons.find(".current_status_cancel_button");this._$save_button=this._$action_buttons.find(".current_status_save_button");this._$status_emoji_picker=t.$parent.find(".current_status_emoji_picker");this._$status_clear_icon=t.$parent.find(".status_clear_icon");this._$status_clear_icon_wrap=t.$parent.find(".status_clear_icon_wrap");this._$presets_list=t.$parent.find(".current_status_presets");this._has_form_context=t.has_form_context;this._has_presets_menu=t.has_presets_menu;this._preset_index=t.preset_index;this._is_preset_editor=_.isNumber(this._preset_index);this._selected_emoji=this._getOriginalStatus().emoji;this._bindFunctions();this._bindEvents();this._toggleStatusClearIcon();this._startTexty();TS.ui.validation.validate(this._$input)},destroy:function e(){if(this._$input)TS.utility.contenteditable.unload(this._$input);this._unbindEvents();this._$container=null;this._$emoji_input=null;this._$inline_saver=null;this._$input=null;this._$action_buttons=null;this._$cancel_button=null;this._$save_button=null;this._$status_clear_icon=null;this._$status_clear_icon_wrap=null;this._$status_emoji_picker=null;this._$presets_list=null;this._has_form_context=null;this._has_presets_menu=null;this._selected_emoji=null;this._preset_index=null;this._is_preset_editor=null;this._onSave=null;this._onEscape=null;this._onError=null},focus:function e(){if(this._$input&&this._$input.length)TS.utility.contenteditable.setCursorAtEnd(this._$input)},getEscapedInputText:function e(){return _.escape(TS.emoji.maybeGetCanonicalEmojiString(TS.utility.contenteditable.value(this._$input).replace(/\t/g," ").trim()))},hasText:function e(){return!TS.utility.contenteditable.isEmpty(this._$input,true)},hasNewText:function e(){return this.getEscapedInputText()!==this._getOriginalStatus().text},isEdited:function e(){return this.hasNewText()||this._selected_emoji!==this._getOriginalStatus().emoji},isSaveable:function e(){return this.isEdited()},onEmojiSelected:function e(t){t=t||"";this._selectEmoji(t);this._toggleActionButtons();this._toggleStatusClearIcon();this.focus()},onTabComplete:function e(t,r){TS.utility.populateInput(this._$input,t,r);TS.ui.validation.validate(this._$input)},_bindFunctions:function e(){this._onFocus=this._onFocus.bind(this);this._onCancel=this._onCancel.bind(this);this._onKeydown=this._onKeydown.bind(this);this._onKeyup=this._onKeyup.bind(this);this._onBodyClick=this._onBodyClick.bind(this);this.clearCurrentStatus=this.clearCurrentStatus.bind(this);this._openEmojiPicker=this._openEmojiPicker.bind(this);this._presetChosen=this._presetChosen.bind(this);this._editCurrentStatus=this._editCurrentStatus.bind(this);this.onEmojiSelected=this.onEmojiSelected.bind(this);this.onTabComplete=this.onTabComplete.bind(this)},_bindEvents:function e(){this._$input.on("keydown.ui_current_status_input",this._onKeydown);this._$input.on("keyup.ui_current_status_input",this._onKeyup);this._$status_emoji_picker.on("click.ui_current_status_input",this._openEmojiPicker);this._$status_clear_icon.on("click.ui_current_status_input",this.clearCurrentStatus);this._$cancel_button.on("click.ui_current_status_input",this._onCancel);this._$save_button.on("click.ui_current_status_input",this._editCurrentStatus);if(!this._has_presets_menu)this._$presets_list.on("click.ui_current_status_input",".current_status_preset_option",this._presetChosen)},_unbindEvents:function e(){if(this._$input)this._$input.off(".ui_current_status_input");if(this._$status_clear_icon)this._$status_clear_icon.off(".ui_current_status_input");if(!this._has_presets_menu)this._$presets_list.off(".ui_current_status_input");if(this._$status_emoji_picker&&this._$status_emoji_picker.length)this._$status_emoji_picker.off(".ui_current_status_input");if(this._$cancel_button&&this._$cancel_button.length)this._$cancel_button.off(".ui_current_status_input");if(this._$save_button&&this._$save_button.length)this._$save_button.off(".ui_current_status_input");this._maybeRemoveBodyClickHandler()},_getOriginalStatus:function e(){var t=this._is_preset_editor?TS.prefs.getTeamPref("custom_status_presets")[this._preset_index][0]:TS.members.getMemberCurrentStatus(TS.model.user).emoji;var r=this._is_preset_editor?TS.prefs.getTeamPref("custom_status_presets")[this._preset_index][1]:TS.members.getMemberCurrentStatus(TS.model.user).text;return{emoji:t,text:r}},_selectEmoji:function e(t){this._selected_emoji=t||"";this._$emoji_input.val(this._selected_emoji);this._$status_emoji_picker.find(".current_status_empty_emoji").toggleClass("hidden",!!this._selected_emoji);this._$status_emoji_picker.find(".current_status_emoji").html(TS.format.formatCurrentStatus(this._selected_emoji,void 0,{stop_animations:true,transform_missing_emoji:true,ignore_emoji_mode_pref:"as_text"===TS.prefs.getPref("emoji_mode")}))},_onCancel:function e(){if(!this._has_form_context){this._maybeRemoveBodyClickHandler();this._restoreCurrentStatus();TS.utility.contenteditable.blur(this._$input);this._maybeHidePresetsMenu();if(_.isFunction(this._onEscape))this._onEscape(this._getOriginalStatus())}},_onFocus:function e(t){if(!this.isEdited()||this._getSelectedPresetIndex()>-1||!(this.hasText()||this._selected_emoji))this._maybeShowPresetsMenu(t);this._maybeAddBodyClickHandler()},_onBodyClick:function e(t){if(TS.ui.react_emoji_menu.is_showing)return;if($.contains(this._$container.get(0),t.target))return;this._onCancel()},_onKeydown:function e(t){if(t.which===TS.utility.keymap.enter)t.stopPropagation();else if(t.which===TS.utility.keymap.tab)t.stopPropagation();else if(t.which===TS.utility.keymap.esc){t.stopPropagation();t.preventDefault()}},_onKeyup:function e(t){if([TS.utility.keymap.enter,TS.utility.keymap.esc,TS.utility.keymap.tab].indexOf(t.which)>-1)return;this._toggleStatusClearIcon();this._toggleActionButtons();if(this.isEdited())this._maybeHidePresetsMenu();else this._maybeShowPresetsMenu(t)},_maybeShowPresetsMenu:function e(t){if(this._has_presets_menu){TS.menu.startWithList(t,this._$presets_list,{onClick:this._presetChosen,close_on_click:true,ignore_bounds:true,attach_to_target_at_full_width:true,keep_menu_open_if_target_clicked_again:true});TS.kb_nav.setAllowHighlightWithoutBlurringInput(true)}},_maybeHidePresetsMenu:function e(){if(this._has_presets_menu&&TS.model.menu_is_showing)TS.menu.end()},_maybeAddBodyClickHandler:function e(){if(!this._has_form_context&&this._has_presets_menu)TS.utility.rAF(function(){$("body").on("click.ui_current_status_input",this._onBodyClick)}.bind(this))},_maybeRemoveBodyClickHandler:function e(){if(!this._has_form_context&&this._has_presets_menu)$(document.body).off(".ui_current_status_input")},_maybeGetCanonicalStatus:function e(t){if(TS.i18n.locale()!==TS.interop.I18n.DEFAULT_LOCALE)return TS.emoji.maybeGetCanonicalEmojiString(t);return t},_getLocalizedStatus:function e(t){if(TS.i18n.locale()!==TS.interop.I18n.DEFAULT_LOCALE)return TS.emoji.maybeGetLocalizedEmojiString(t);return t},_openEmojiPicker:function e(n){var i=$(n.target).closest(".current_status_emoji_picker").dimensions_rect();var a=!this._has_presets_menu;TS.ui.react_emoji_menu.start({e:n,callback:this.onEmojiSelected,position:a?"bottom-left":"top-left",offset_y:a?r:t,target_bounds:i})},_toggleActionButtons:function e(){this._$action_buttons.toggleClass("invisible",!this.isSaveable()||!this.hasText()&&!this._selected_emoji)},_toggleStatusClearIcon:function e(){this._$status_clear_icon_wrap.toggleClass("hidden",!this._selected_emoji&&!this.hasText())},_presetChosen:function e(t){var r=$(t.target).closest(".current_status_preset_option");var n=r.data("text")||"";var i=r.data("emoji")||"";TS.utility.contenteditable.value(this._$input,TS.emoji.maybeGetLocalizedEmojiString(TS.format.unFormatMsg(n)));this._selectEmoji(i);this._toggleStatusClearIcon();this._editCurrentStatus()},clearCurrentStatus:function e(){TS.utility.contenteditable.clear(this._$input);TS.ui.validation.validate(this._$input);this._selectEmoji("");this._toggleStatusClearIcon();this._toggleActionButtons();this._editCurrentStatus()},clogStatusChange:function t(r,n,i){var a={custom_status_set_origin:i};if(!r&&!n){a.custom_status="UNKNOWN";TS.clog.track("CUSTOM_STATUS_CLEAR",a);return}var s=this._getSelectedPresetIndex(r,n);if(s>-1)a.custom_status=TS.prefs.getTeamPref("uses_customized_custom_status_presets")?"ADMIN_PRESET":e[s];else a.custom_status="USER_DEFINED";a.custom_status_text=r;a.custom_status_emoji=n;TS.clog.track("CUSTOM_STATUS_SET",a)},clogPresetChange:function e(t,r){TS.clog.track("CUSTOM_STATUS_ADMIN_PRESET_SET",{custom_status_text:t,custom_status_emoji:r,custom_status_preset:"ADMIN_PRESET_"+(this._preset_index+1)})},_getSelectedPresetIndex:function e(t,r){if(_.isUndefined(t))t=this.getEscapedInputText();if(_.isUndefined(r))r=this._selected_emoji;var n=TS.team.getTeamCustomStatusPresets();var i=_.findIndex(n,function(e){return e.text===t});var a=_.findIndex(n,function(e){return e.emoji===r});return i>-1&&i===a?i:-1},_restoreCurrentStatus:function e(){var t=this._getOriginalStatus();TS.utility.contenteditable.value(this._$input,TS.emoji.maybeGetLocalizedEmojiString(TS.format.unFormatMsg(t.text)));TS.ui.validation.validate(this._$input);this._selectEmoji(t.emoji);this._toggleStatusClearIcon();this._toggleActionButtons()},_editCurrentStatus:function e(){if(this._has_form_context)return Promise.resolve();if(!TS.ui.validation.validate(this._$input,{quiet:true,fast:true})){TS.ui.validation.validate(this._$input);return Promise.resolve()}if(!this.isSaveable())return Promise.resolve();this._maybeRemoveBodyClickHandler();var t=TS.emoji.maybeGetCanonicalEmojiString(TS.utility.contenteditable.value(this._$input).replace(/\t/g," ").trim());var r=this.getEscapedInputText();var n=this._selected_emoji||t&&TS.prefs.getTeamPref("custom_status_default_emoji");var i;if(this._has_presets_menu)i="FLEXPANE_PROFILE";else if(!this._has_form_context)i="TEAM_MENU";var a;if(this._is_preset_editor)a=new Promise(function(e,r){return TS.prefs.setTeamPrefByAPI({custom_status_presets:this._getUpdatedPresets(t,this._selected_emoji)},r,["uses_customized_custom_status_presets"]).then(e)}.bind(this));else{var s={profile:JSON.stringify({status_text:t,status_emoji:this._selected_emoji})};a=TS.api.call("users.profile.set",s)}a.then(function(){if(this._is_preset_editor)this.clogPresetChange(r,n);else this.clogStatusChange(r,n,i)}.bind(this),function(e){if(_.isFunction(this._onError))this._onError(this._getOriginalStatus());if(e&&e.data&&"ratelimited"===e.data.error)TS.generic_dialog.alert(TS.i18n.t("You’re changing your status too often! You might have better luck if you try again in a few minutes.","current_status")());else TS.generic_dialog.alert(TS.i18n.t("Sorry! Something went wrong. Please try again.","current_status")());if(this._$input)this._restoreCurrentStatus();return e}.bind(this));TS.ui.inline_saver.show({target:this._$inline_saver,promise:a});if(_.isFunction(this._onSave))this._onSave({text:r,emoji:n});return a},_startTexty:function e(){var t=this._editCurrentStatus;var r=this._onCancel;var n=this._onFocus;var i=this._$input;var a=this._is_preset_editor?TS.i18n.t("e.g. Gone to lunch","current_status")():TS.i18n.t("What’s your status?","current_status")();TS.utility.contenteditable.create(i,{modules:{tabcomplete:{completers:["emoji"],positionMenu:function e(t){t.style.width=i.outerWidth()+"px";t.style.minWidth=0;TS.tabcomplete.positionUIRelativeToInput(t,i)}}},singleLineInput:true,placeholder:a,onFocus:function e(){n(jQuery.Event("focus",{target:i,currentTarget:i}))},onEnter:function e(){t();return false},onEscape:function e(){r();return false},onTextChange:function e(){TS.ui.validation.validate(i)}});TS.utility.contenteditable.value(i,TS.emoji.maybeGetLocalizedEmojiString(TS.format.unFormatMsg(this._getOriginalStatus().text)));TS.utility.contenteditable.enable(i)},_getUpdatedPresets:function e(t,r){var n=[];var i=TS.prefs.getTeamPref("custom_status_presets");var a=i.slice(0,this._preset_index);var s=[r,t];var o=i.slice(this._preset_index+1);n=a;n.push(s);return n.concat(o)}});var e=["IN_A_MEETING","COMMUTING","OUT_SICK","VACATIONING","WORKING_REMOTELY"];var t=-5;var r=5})()},4741:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var n=r(4742);var i=r.n(n);var a=r(4743);var s=r.n(a);var o=r(4744);var l=r.n(o);var u=r(4745);var d=r.n(u);var _=r(4746);var c=r.n(_);var m=r(4747);var f=r.n(m);var p=r(4748);var h=r.n(p);var g=r(4749);var S=r.n(g);var T=r(4750);var v=r.n(T);var b=r(4751);var y=r.n(b);var w=r(4752);var k=r.n(w);var x=r(4753);var C=r.n(x);var M=r(4754);var I=r.n(M);var P=r(4755);var A=r.n(P);var E=r(4756);var F=r.n(E);var O=r(4757);var B=r.n(O);var $=r(4758);var D=r.n($);var H=r(4759);var j=r.n(H);var R=r(4760);var L=r.n(R);var N=r(4761);var U=r.n(N);var q=r(4762);var G=r.n(q);var W=r(4763);var z=r.n(W);var K=r(4764);var V=r.n(K);var Y=r(5180);var J=r.n(Y);var Q=r(4765);var X=r.n(Q);var Z=r(4766);var ee=r.n(Z);var te=r(4767);var re=r.n(te);var ne=r(4768);var ie=r.n(ne);var ae=r(4769);var se=r.n(ae);var oe=r(4770);var le=r.n(oe);var ue=r(4771);var de=r.n(ue);var _e=r(4772);var ce=r.n(_e);var me=r(4773);var fe=r.n(me);var pe=r(4774);var he=r.n(pe);var ge=r(4775);var Se=r.n(ge);var Te=r(4776);var ve=r.n(Te);var be=r(4777);var ye=r.n(be);var we=r(4778);var ke=r.n(we);var xe=r(4779);var Ce=r.n(xe);var Me=r(4780);var Ie=r.n(Me);var Pe=r(4781);var Ae=r.n(Pe);var Ee=r(4782);var Fe=r.n(Ee);var Oe=r(4783);var Be=r.n(Oe);var $e=r(4784);var De=r.n($e);var He=r(4785);var je=r.n(He);var Re=r(4786);var Le=r.n(Re);var Ne=r(4787);var Ue=r.n(Ne);var qe=r(4788);var Ge=r.n(qe);var We=r(4789);var ze=r.n(We);var Ke=r(4790);var Ve=r.n(Ke);var Ye=r(4791);var Je=r.n(Ye);var Qe=r(4792);var Xe=r.n(Qe);var Ze=r(4793);var et=r.n(Ze);var tt=r(4794);var rt=r.n(tt);var nt=r(4795);var it=r.n(nt);var at=r(4796);var st=r.n(at);var ot=r(4797);var lt=r.n(ot);var ut=r(4798);var dt=r.n(ut);var _t=r(4799);var ct=r.n(_t);var mt=r(3591);var ft=r.n(mt);var pt=r(4800);var ht=r.n(pt);var gt=r(4801);var St=r.n(gt);var Tt=r(4802);var vt=r.n(Tt);var bt=r(4803);var yt=r.n(bt);var wt=r(4804);var kt=r.n(wt);var xt=r(4805);var Ct=r.n(xt);var Mt=r(4806);var It=r.n(Mt);var Pt=r(4807);var At=r.n(Pt);var Et=r(4808);var Ft=r.n(Et);var Ot=r(4809);var Bt=r.n(Ot);var $t=r(4810);var Dt=r.n($t);var Ht=r(4811);var jt=r.n(Ht);var Rt=r(4812);var Lt=r.n(Rt);var Nt=r(4813);var Ut=r.n(Nt);var qt=r(4814);var Gt=r.n(qt);var Wt=r(3590);var zt=r.n(Wt);var Kt=r(4815);var Vt=r.n(Kt);var Yt=r(4816);var Jt=r.n(Yt);var Qt=r(4817);var Xt=r.n(Qt);var Zt=r(4818);var er=r.n(Zt);var tr=r(4819);var rr=r.n(tr);var nr=r(4820);var ir=r.n(nr);var ar=r(4821);var sr=r.n(ar);var or=r(4822);var lr=r.n(or);var ur=r(4823);var dr=r.n(ur);var _r=r(4824);var cr=r.n(_r);var mr=r(4825);var fr=r.n(mr);var pr=r(4826);var hr=r.n(pr);var gr=r(4827);var Sr=r.n(gr);var Tr=r(4828);var vr=r.n(Tr);var br=r(4829);var yr=r.n(br);var wr=r(4830);var kr=r.n(wr);var xr=r(3594);var Cr=r.n(xr);var Mr=r(4831);var Ir=r.n(Mr);var Pr=r(4832);var Ar=r.n(Pr);var Er=r(4833);var Fr=r.n(Er);var Or=r(4834);var Br=r.n(Or);var $r=r(4835);var Dr=r.n($r);var Hr=r(4836);var jr=r.n(Hr);var Rr=r(4837);var Lr=r.n(Rr);var Nr=r(4838);var Ur=r.n(Nr);var qr=r(4839);var Gr=r.n(qr);var Wr=r(4840);var zr=r.n(Wr);var Kr=r(4841);var Vr=r.n(Kr);var Yr=r(4842);var Jr=r.n(Yr);var Qr=r(4843);var Xr=r.n(Qr);var Zr=r(4844);var en=r.n(Zr);var tn=r(4845);var rn=r.n(tn);var nn=r(4846);var an=r.n(nn);var sn=r(4847);var on=r.n(sn);var ln=r(4848);var un=r.n(ln);var dn=r(4849);var _n=r.n(dn);var cn=r(4850);var mn=r.n(cn);var fn=r(3596);var pn=r.n(fn);var hn=r(3605);var gn=r.n(hn);var Sn=r(3604);var Tn=r.n(Sn);var vn=r(3601);var bn=r.n(vn);var yn=r(3602);var wn=r.n(yn);var kn=r(3603);var xn=r.n(kn);var Cn=r(3607);var Mn=r.n(Cn)},4742:function(e,t){(function(){TS.registerModule("presence_manager",{sub_list_changed:new signals.Signal,onStart:function e(){i=true;p=TS.utility.enableFeatureForUser(1);if(o.length)b();if(l.length)y();TS.redux.socket.disconnectedSig.add(k);TS.redux.socket.connectedSig.add(w)},addPresenceList:function e(t){if(-1===a.indexOf(t)){a.push(t);t.added_sig.add(g);t.removed_sig.add(S)}},removePresenceList:function e(t){if(a.indexOf(t)>-1){a.splice(a.indexOf(t),1);t.added_sig.remove(g);t.removed_sig.remove(S)}},createNewPresenceList:function e(t){return new TS.PresenceList(t)},isSubscribedToMember:function e(t){return o.indexOf(t)>=0},queryMemberPresence:function e(t){if(_.isArray(t))t.forEach(function(e){h(e)});else h(t);y()},periodicallyCheckPresenceConsistency:function e(t){if(_.isUndefined(t))t=1e3;if(c){clearInterval(c);c=null}c=setInterval(x,t)},stopCheckingPresenceConsistency:function e(){if(c)clearInterval(c);c=null},getSubList:function e(){return o.slice()},test:function e(){var t={getSubObject:function e(){var t={};var r;for(r in s)if(s[r])t[r+" "+TS.members.getMemberById(r).name]=s[r];return t},getSubList:function e(){return o}};Object.defineProperty(t,"_is_first_connection",{get:function e(){return f},set:function e(t){f=t}});Object.defineProperty(t,"_handleConnect",{get:function e(){return w},set:function e(t){w=t}});Object.defineProperty(t,"_addMemberToQueryList",{get:function e(){return h},set:function e(t){h=t}});Object.defineProperty(t,"_sendSubList",{get:function e(){return b},set:function e(t){b=t}});Object.defineProperty(t,"_sendQueryList",{get:function e(){return y},set:function e(t){y=t}});return t}});var e="USLACKBOT";var t=1e3;var r=1300;var n=1300;var i=false;var a=[];var s={};var o=[];var l=[];var u=false;var d=false;var c;var m=false;var f=true;var p=false;var h=function e(t){if(o.indexOf(t)>-1)return;if(l.indexOf(t)>-1)return;l.push(t)};var g=function e(t){if(!_.isArray(t))t=[t];t.forEach(function(e){T(e)})};var S=function e(t){if(!_.isArray(t))t=[t];t.forEach(function(e){v(e)})};var T=function t(r){if(r===e)return;if(s[r])s[r]+=1;else{s[r]=1;o.push(r);b()}return null};var v=function e(t){if(s[t]){s[t]-=1;if(!s[t]){var r=o.indexOf(t);o.splice(r,1);b()}}return null};var b=function e(){if(!i||0===o.length||u)return null;if(!TS.redux.socket.isConnected())return;u=true;Promise.resolve().then(function(){u=false;if(p)TS.metrics.count("presence_manager",o.length);if(o&&o.length>r){if(!m){TS.console.logError({},"presence_sub_list_too_long","List length is "+o.length);m=true}o=o.slice(0,r)}var e={type:"presence_sub",ids:o};TS.interop.SocketManager.send(e);TS.presence_manager.sub_list_changed.dispatch();return null})};var y=function e(){if(!i||0===l.length||d)return null;if(!TS.redux.socket.isConnected())return;d=true;Promise.resolve().then(function(){d=false;_.chunk(l,n).forEach(function(e){var t={type:"presence_query",ids:e};TS.interop.SocketManager.send(t)});l=[];return null})};b=_.throttle(b,t);y=_.throttle(y,t);var w=function e(t){if(TS.client&&!f&&!t){var r=_.map(TS.model.members,"id");var n=_.map(TS.model.bots,"id");var i=r.concat(n);i.forEach(function(e){h(e)})}f=false;b();y()};var k=function e(){TS.redux.socket.promiseToHaveOpenWebSocket().then(function(){b();y()})};var x=function e(){var t;var r=[];var n=[];var i=[];var a=Array.prototype.slice.call(document.querySelectorAll("[data-member-presence]"));a.forEach(function(e){t=e.getAttribute("data-member-presence");if($(e).is(":visible"))n.push(t);else i.push(t)});n=_.uniq(n);if(_.difference(n,o).length){var s=_.map(_.difference(n,o),TS.members.getMemberById);TS.warn("There are members needing presence updates in the DOM that are not in the presence subscription list");TS.warn("Missing Names:",_.map(s,"name"));TS.warn("Missing Ids:",_.map(s,"id"))}r=_.uniq(n.concat(i));if(_.difference(o,r).length){var l=_.map(_.difference(o,r),TS.members.getMemberById);TS.warn("There are members in the presence subscription list that are no longer in the DOM.");TS.warn("This might be fine if a longListView of members is showing, but once that list is removed these errors should go away.");TS.warn("Extra Names:",_.map(l,"name"));TS.warn("Extra Ids:",_.map(l,"id"))}}})()},4743:function(e,t){(function(){TS.registerModule("compression",{compress:function e(t,r,i,s){var o=Date.now();if(i){var l=LZString.compress(r);var u=Date.now()-o;if(TS.has_pri[a])TS.log(a,t+" took "+u+"ms to _compress immediately str.length: "+r.length);return s({k:t,str:l})}n(t,r,function(e,r){var n=Date.now()-o;if(TS.has_pri[a])TS.log(a,t+" took "+n+"ms for the compression worker to callback ("+r+"ms spent within the worker) result.length: "+e.length);s({k:t,str:e})})},deCompress:function e(t,r){return""},terminate:function t(){if(e)e.terminate();e=null}});var e=null;var t=0;var r={};var n=function n(a,s,o){if(!e)i();t+=1;var l="job_key"+t;r[l]=function(e,t){o(e,t);delete r[l]};e.postMessage({request:"compress",input:s,job_key:l,k:a})};var i=function t(){if(e){TS.error("_makeWorker but there is a _worker");return}var n=_.get(TS,"boot_data.vvv_paths.lz_string","/js/libs/lz-string-1.4.4.js");var i=TS.environment.is_dev;if(TS.qs_args.local_assets||i)n=location.protocol+"//"+location.host+n;e=TS.utility.makeWebWorker("function() {\t\t\tself.importScripts('"+n+"');\t\t\tself.onmessage = function(e) {\t\t\t\tvar start = Date.now();\t\t\t\tvar result;\t\t\t\tif (e.data.request === 'compress') {\t\t\t\t\tresult = LZString.compress(e.data.input)\t\t\t\t}\t\t\t\tvar elapsed = Date.now() - start;\t\t\t\tpostMessage({\t\t\t\t\trequest: e.data.request,\t\t\t\t\tresult: result,\t\t\t\t\tjob_key: e.data.job_key,\t\t\t\t\tk: e.data.k,\t\t\t\t\telapsed: elapsed\t\t\t\t});\t\t\t}\t\t}",function(e){var t=r[e.data.job_key];if(!t){TS.error("e.data.job_key:"+e.data.job_key+" had no record in _callbacks??");return}t(e.data.result,e.data.elapsed)})};var a=488})()},4744:function(e,t){var r="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};(function(){var e="STORAGE";TS.registerModule("storage",{version:"0.85",msgs_version:window.boot_data&&boot_data.cache_version||"unknown_version",cache_ts_version:window.boot_data&&boot_data.cache_ts_version||"unknown_version",do_compression:!TS.model.is_our_app&&"undefined"!==typeof window.Worker&&(!window.bowser||!bowser.phantom&&!bowser.msie),test:function e(){return{getLocalStorage:H,setLocalStorage:j,getKeys:y,set:$}},onStart:function t(){TS.storage.onStart=function(){};if(!TS.storage.do_compression&&TS.boot_data.feature_force_ls_compression){TS.interop.console.info(e,"Special case: force-enabling LS compression for this session.");TS.storage.do_compression=true}TS.storage.version+=TS.storage.do_compression?"-compressed-LZString":"";var r=s||"1"==TS.qs_args.ls_disabled||!D||TS.boot_data&&TS.boot_data.ls_disabled||function(){if(!TS.storage.storageAvailable()){k();if(!TS.storage.storageAvailable()){TS.interop.console.info(e,"TS.storage.storageAvailable() = false in onStart after flushing all our keys, so disabling");return true}}return false}();if(TS.has_pri[U]){TS.log(U,"TS.storage.onStart should_disable:"+r);TS.log(U,"TS.storage.do_compression:"+TS.storage.do_compression+" (_ls.getItem('is_compressed') === 'yes'):"+(D&&"yes"===D.getItem("is_compressed")))}TS.ui.window_unloaded_sig.add(C);TS.ui.window_focus_changed_sig.add(M);TS.storage.setDisabled(r);$("rxn_records",null)},setDisabled:function e(t){if(s==t)return;if(t||!D){s=true;if(D)k()}else{s=false;w()}TS.log(U,"_disabled:"+s)},storageAvailable:function e(){if(!D)return false;try{var t="test_to_see_if_we_can_write_to_local_storage";D.setItem(t,"foo");D.removeItem(t);return true}catch(e){return false}},storageSize:function t(n){var i=0;if(!D)return i;var a=y();var s=0;var o;var l;for(var u=0;u<a.length;u+=1){s+=1;o=a[u];l=D.getItem(o);if(!l&&""!==l)TS.interop.console.info(e,o+" not measurable value, typeof:"+("undefined"===typeof l?"undefined":r(l)));else{i+=l.length;if(n)TS.info(o+"="+(2*l.length/1024).toFixed(2)+"KB (total="+(i/1024).toFixed(2)+"KB)")}}if(n)TS.info("total for "+s+" items is "+(i/1024).toFixed(2)+"KB");return i},completelyEmptyAllStorageAndReset:function e(){TS.info("completelyEmptyAllStorageAndReset running");x();TS.storage.storeLastEventTS("",true,true);var t=TS.storage.fetchLastEventTS(true);TS.info("completelyEmptyAllStorageAndReset fetched_b4_flush:"+t);if(t){TS.info("completelyEmptyAllStorageAndReset _getKeys:"+y().join(", "));TS.info("completelyEmptyAllStorageAndReset Object.keys(_buffer):"+Object.keys(l).join(", "))}F(true,"completelyEmptyAllStorageAndReset");var r=TS.storage.fetchLastEventTS(true);TS.info("completelyEmptyAllStorageAndReset fetched_after_flush:"+r);if(r){TS.info("completelyEmptyAllStorageAndReset _getKeys:"+y().join(", "));TS.info("completelyEmptyAllStorageAndReset Object.keys(_buffer):"+Object.keys(l).join(", "))}},flush:function e(t){if(TS.has_pri[U])TS.log(U,"TS.storage.flush()");k();if(t)TS.storage.clearBufferAndCache()},clearBufferAndCache:function e(){if(TS.has_pri[U])TS.log(U,"TS.storage.clearBufferAndCache()");l={};u={};if(TS.compresion)TS.compression.terminate()},fetchStorageVersion:function e(){return O("storage_version")},storeStorageVersion:function e(t){$("storage_version",t,true)},fetchCacheTSStorageVersion:function e(){return O("storage_cache_ts_version")},storeCacheTSStorageVersion:function e(t){$("storage_cache_ts_version",t,true)},_makeMsgInputId:function e(t){return"msg_input_"+t},fetchLastMsgInput:function e(t){return O(TS.storage._makeMsgInputId(t),null)},storeLastMsgInput:function e(t,r){$(TS.storage._makeMsgInputId(t),r)},_makeCommentInputId:function e(t){return"comment_input_"+t},fetchLastCommentInput:function e(t){return O(TS.storage._makeCommentInputId(t),null)},storeLastCommentInput:function e(t,r){$(TS.storage._makeCommentInputId(t),r)},fetchOldestTs:function e(t){return O(a(t),null)},storeOldestTs:function e(t,r){$(a(t),r)},fetchActiveHistory:function e(){return O("active_history",[])||[]},storeActiveHistory:function e(t){$("active_history",t,true)},fetchLastEventTS:function e(t){return O("last_event_ts","",t)||""},storeLastEventTS:function e(t,r,n){$("last_event_ts",t,r,n)},fetchUIState:function e(){return O("ui_state",{})||{}},storeUIState:function e(t){$("ui_state",t)},fetchExpandableState:function e(){var t=O("expandable_state",{});return t&&"object"===("undefined"===typeof t?"undefined":r(t))?t:{}},storeExpandableState:function e(t){$("expandable_state",t)},fetchClientWindows:function e(){return O("client_windows",{})||{}},storeClientWindows:function e(t){$("client_windows",t)},fetchInputHistory:function e(){var t=O("input_history",[])||[];if("string"===typeof t)t=[t];var r=300;if(t.length>r)t.length=r;return t},storeInputHistory:function e(t){$("input_history",t)},fetchCustomEmoji:function e(){return O("custom_emoji",null)||null},storeCustomEmoji:function e(t){$("custom_emoji",t)},fetchStaticTranslations:function e(){return O("static_translations",null)||null},storeStaticTranslations:function e(t){$("static_translations",t)},fetchApps:function e(){return O("apps",null)||null},storeApps:function e(t){$("apps",t)},fetchAppsSearchResults:function e(){return O("apps_search",null)||null},storeAppsSearchResults:function e(t){$("apps_search",t)},fetchCmds:function e(){return O("cmds",null)||null},storeCmds:function e(t){$("cmds",t)},fetchChannelPageState:function e(){return O("channel_page_state",{})||{}},storeChannelPageState:function e(t){$("channel_page_state",t)},fetchInvitesState:function e(){return O("invites_state",[])||[]},storeInvitesState:function e(t){$("invites_state",t)},fetchBriefingOpensCount:function e(){return Number(O("briefing_opens_count",0))||0},storeBriefingOpensCount:function e(t){$("briefing_opens_count",t)},fetchReplyInput:function e(t,r){var n=O("reply_inputs")||[];var i=_.find(n,{model_ob_id:t,thread_ts:r});return i?i.text:""},storeReplyInput:function e(t,r,n){var i=10;var a=O("reply_inputs")||[];a=_.reject(a,{model_ob_id:t,thread_ts:r});if(a.length>i)a.shift();a.push({model_ob_id:t,thread_ts:r,text:n});$("reply_inputs",a)},fetchFilterState:function e(){return O("team_filter_state","")||""},storeFilterState:function e(t){$("team_filter_state",t)},fetchCallsState:function e(){return O("calls_state",{})||{}},storeCallsState:function e(t){$("calls_state",t)},fetchFrecency:function e(t){return O("frecency_"+t)},storeFrecency:function e(t,r){$("frecency_"+t,r)},clearFrecency:function e(t){$("frecency_"+t,"")},fetchEnterpriseState:function e(){return O("enterprise_state",{})||{}},storeEnterpriseState:function e(t){$("enterprise_state",t)},fetchLastTraceTS:function e(){return O("last_trace_ts","")||""},storeLastTraceTS:function e(){$("last_trace_ts",Date.now())}});var t=window.boot_data.user_id+"_";var n="channel_msgs_";var i="oldest_msg_ts_";var a=function e(t){return i+t};var s;var o=false;var l={};var u={};var d=1e3;var c=false;var m=1e3;var f=false;var p=1e3;var h=false;var g=false;var S=null;var T=3e5;var v=1e4;var b=1e3;var y=function e(){var t=[];if(!D)return t;var r=D.length;if(!r)return t;for(var n=0;n<r;n+=1)t.push(D.key(n));return t};var w=function r(){var n;if(!s){var i=TS.storage.fetchStorageVersion()||"";var a=-1!=i.indexOf("-compressed")||"yes"===D.getItem("is_compressed");if(TS.storage.do_compression&&!a){TS.interop.console.info(e,"migrating to compressed format");n=y();n.forEach(function(e){var r=e.replace(t,"");var n=B(e,D.getItem(e));var i="converting: "+e+" -> "+r+" val.length: "+(void 0===n||null===n?-1:String(n).length);$(r,null);$(r,n);if(O(r)==n){if(TS.has_pri[U])TS.log(U,i+" SUCCESS _get(name) has a value:"+!!O(r)+", and it it the same as val")}else TS.error(i+" FAILURE _get(name) !== val")});TS.interop.console.info(e,"migration to compressed format complete, "+n.length+" migrated");TS.storage.storeStorageVersion(TS.storage.version)}else if(TS.has_pri[U])TS.log(U,"no migration needed");D.setItem("is_compressed",TS.storage.do_compression?"yes":"no")}var o=TS.storage.fetchCacheTSStorageVersion();if(TS.has_pri[U])TS.log(U,"storage_cache_ts_version:"+o);var l=TS.storage.fetchStorageVersion()||"";if(TS.has_pri[U]){TS.log(U,"TS.storage.version:"+TS.storage.version);TS.log(U,"storage_version:"+l);TS.log(U,"TS.storage last_unload_flushing: "+O("last_unload_flushing"));TS.log(U,"TS.storage.storageAvailable(): "+TS.storage.storageAvailable())}n=y();if(TS.has_pri[U])TS.dir(U,n,"_getKeys()");if(!TS.storage.storageAvailable()){TS.log(U,"TS.storage.storageAvailable() = false so flushing all our keys");k()}else if(l!=TS.storage.version){TS.log(U,"storage_version:"+l+" does not match TS.storage.version:"+TS.storage.version+" so flushing all our keys: "+n.join(", "));k()}else if(!TS.storage.fetchLastEventTS()){TS.log(U,"TS.storage.fetchLastEventTS() is empty so flushing channel data");x()}TS.storage.storeStorageVersion(TS.storage.version);TS.redux.socket.connectedSig.addOnce(I)};var k=function e(){y().forEach(function(e){if(0===e.indexOf(t))D.removeItem(e)})};var x=function e(){var r=y();if(TS.has_pri[U])TS.log(U,r,"_getKeys()");var a;for(var s=0;s<r.length;s+=1){a=r[s];if(0!==a.indexOf(t))continue;if(-1==a.indexOf(n)&&-1==a.indexOf(i))continue;D.removeItem(a);delete l[a]}for(a in l){if(0!==a.indexOf(t))continue;if(-1==a.indexOf(n)&&-1==a.indexOf(i))continue;delete l[a]}u={};r=y();TS.dir(488,r,"_getKeys()")};var C=function e(){o=true;$("last_unload_flushing",(new Date).toString(),true);F(true,"_windowUnloaded");TS.compression.terminate()};var M=function e(){F(true,"_windowBlurred")};var I=function e(){if(S){window.clearInterval(S);S=null}S=window.setInterval(P,T)};var P=function e(){if(!TS.model)return;var t=Object.keys(l).length;if(!t)return;var r=false;var n="";if(!TS.model.ui.is_window_focused){n="window blurred!";r=true}var i=Date.now()-TS.model.client.last_user_active_timestamp;if(!r)if(i>=v){n="window focused, but user has been idle long enough "+i+" >= "+v;r=true}if(TS.has_pri[U])TS.log(U,"_maybeFlushBuffer ok_to_flush_all:"+r);if(r){F(true,"maybeFlushBuffer ("+t+") "+n);return}var a=i>b;if(TS.has_pri[U])TS.log(U,"_maybeFlushBuffer ok_to_flush_some:"+a);n="window focused, but user has been idle long enough "+i+" >= "+b;if(a)F(false,"maybeFlushBuffer ("+t+") "+n)};var A=function e(t){return"string"===typeof t||"number"===typeof t||!t?t:JSON.stringify(t)};var E=function e(t){if("undefined"===t)return null;if("null"===t)return null;return t};var F=function e(t,r){if(s)return;var n=new Date;var i=Date.now();var a;var o=0;var d;var _=TS.model&&TS.model.team&&TS.model.team.domain&&TS.boot_data.feature_tinyspeck;var c;var m;var f;var S;var T;for(d in l){if(l[d].being_flushed)continue;S=A(l[d].val);if(void 0===S||null===S){D.removeItem(d);delete l[d];delete u[d]}else try{R(d,S)}catch(e){TS.error(0,e);k();delete l[d];delete u[d];continue}o+=1;a=Date.now()-i;if(_&&TS.has_pri[U])TS.log(U,"_flushBuffer _ls.setItem "+d+": "+a+"ms "+(l[d]&&l[d].val&&l[d].val.toString?l[d].val.toString().substr(0,100):"NULL?"));if(!t){c=new Date-n;if(!h&&c>p){h=true;f=new Date;try{m=TS.storage.storageSize()}catch(e){}f=new Date-f;T="Took "+c+"ms for "+o+" item (!all case) (threshold is "+p+" ms). Key: "+d+". Buffer length: "+(l[d]&&l[d].val&&l[d].val.toString()?l[d].val.toString().length:"unknown (not a string)")+". localStorage size: "+(m||"unknown")+". Time to read LS size: "+f;TS.info("_flushBuffer exceeded slow write threshold: "+T)}}if(l[d])l[d].being_flushed=true;if(!t){if(TS.has_pri[U])TS.log(U,"_flushBuffer: Wrote one item. why: "+r);return}u={}}if(o&&!g){c=new Date-n;if(c>p){g=true;try{m=TS.storage.storageSize()}catch(e){}T="Took "+c+"ms for "+o+" items (threshold is "+p+" ms). localStorage size: "+m+". App open for "+((Date.now()-TS.boot_data.start_ms)/1e3/60).toFixed(2)+" min. why: "+r;TS.info("_flushBuffer exceeded slow write threshold (all case): "+T)}}if(TS.has_pri[U])if(0===o)TS.log(U,"_flushBuffer: Nothing to save.");else TS.log(U,"_flushBuffer: Saved "+o+(1===o?" item":" items")+" why: "+r)};var O=function e(r,n,i){var a=t+r;if(i)TS.info("_get name:"+r+" k:"+a+" disabled:"+s+' _buffer["'+a+'"].val:'+(l[a]&&l[a].val));if(s)return l[a]&&l[a].val||n;if(a in l)return l[a]&&l[a].val||n;if(u.hasOwnProperty(a))return u[a];var o=B(a,N(a,D.getItem(a)),n,i);u[a]=o;return o};var B=function e(t,n,i,a){var s=new Date;var o=E(n);if(a)TS.info("_get _correctBadValsFromStorage(_ls.getItem(k)) k:"+t+" typeof result:"+("undefined"===typeof o?"undefined":r(o))+" /^[{[]/.test(result):"+/^[{[]/.test(o));var l;if(o&&"string"===typeof o&&/^[{[]/.test(o))o=TS.utility.parseJSONOrElse(o)||o;o=o||(void 0!==i?i:null);s=new Date-s;if(!c&&s>d){c=true;try{l=TS.storage.storageSize()}catch(e){}var u="_get took longer than threshold: Took "+s+"ms to read "+t+" (theshold is "+d+"ms), length = "+(o&&!isNaN(o.length)?o.length:"unknown")+". Storage size: "+l;TS.info(u)}return o};var $=function r(n,i,a,o){var d=false;var _=new Date;var c;var p=t+n;l[p]={val:i,being_flushed:false};u[p]=l[p].val;if(o)TS.info("_set immediate:"+a+" name:"+n+" k:"+p+" disabled:"+s+" do_compression:"+TS.storage.do_compression+' _buffer["'+p+'"].val:'+l[p].val);if(a){if(!s){var h=A(i);if(void 0===h||null===h){D.removeItem(p);delete l[p]}else try{R(p,h,a)}catch(e){TS.interop.console.warn("_set _ls.setItem failed, flushing. TS.storage.storageSize():"+TS.storage.storageSize(false));d=true}}if(o)TS.info("_set failed:"+d);if(!d){if(o)TS.info('_set _buffer["'+p+'"]:'+(l[p]&&JSON.stringify(l[p])));_=new Date-_;if(_>m){TS.interop.console.info(e,"_set immediately "+n+": "+_+"ms "+(i&&i.toString?i.toString().substr(0,100):"NULL?"));if(!f){f=true;try{c=TS.storage.storageSize()}catch(e){}var g="_set exceeded slow set threshold (immediate): Took "+_+"ms to write "+p+" (theshold is "+m+"ms), length = "+(i&&!isNaN(i.length)?i.length:"unknown")+". Storage length: "+c;TS.info(g)}}else if(TS.has_pri[U])TS.log(U,"_set GOOD immediately: "+a+" "+n+": "+_+"ms",i)}}};var D=window.localStorage;var H=function e(){return D};var j=function e(t){D=t};var R=function e(t,r,n){r=String(r);if(TS.storage.do_compression){TS.compression.compress(t,r,n||o,L);return}L({k:t,str:r})};var L=function t(n){D.setItem(n.k,n.str);var i=function t(i){var a=D.getItem(n.k);if(a===n.str){if(i>1)TS.interop.console.info(e,n.k+" now saved, try #"+i);delete l[n.k];delete u[n.k];return}if(i>1&&(!l[n.k]||l[n.k].val!=n.str)){TS.error("buffer changed for "+n.k+" so we don't care anymore, a new value is being set for it, try #"+i);return}TS.error("WTF not saved, try #"+i+" "+n.k+" "+(n.str||"").length+" typeof ob.str:"+r(n.str)+" from_ls:"+("undefined"===typeof a?"undefined":r(a)));D.setItem(n.k,n.str);setTimeout(t,1e3,i+1)};i(1)};var N=function e(t,r){if(!TS.storage.do_compression)return r;var n=Date.now();if(r)r=LZString.decompress(r);var i=Date.now()-n;if(r&&TS.has_pri[U])TS.log(U,t+" took "+i+"ms to _decompress str.length: "+r.length);return r};var U=488})()},4745:function(e,t){(function(){TS.registerModule("api",{paused_sig:new signals.Signal,unpaused_sig:new signals.Signal,Q_empty_sig:new signals.Signal,onStart:function e(){if(TS.boot_data.feature_sli_briefing)r.push("highlights.briefing");if(TS.boot_data.feature_sli_home)r.push("home.modules");if(TS.boot_data.feature_sli_channel_insights){r.push("channels.insights");o.push("channels.insights")}if(TS.boot_data.page_needs_enterprise){r.push("enterprise.channels.search");o.push("enterprise.channels.search")}},test:function n(){var i={_one_at_a_time_methodsA:s,_ensure_model_methodsA:r,_pause:ie,_unPause:ae,_pauseUntilAPIConnectionRestored:ue,_promisify:W,_getMaxAttempts:k,_incrementPending:C,_decrementPending:M,_getDefaultArgsByMethodName:P,_kickOffACallOrEnqueue:A,_callOutsideHandler:L,_nextFromQ:O,_reQueue:N,_calculateHTTPErrorDelayMs:U,_makeLogSafeMethodName:q,_logError:R,_getAPIErrorObject:G,_maybeShowConnectivityWarning:ee,_one_at_a_time_Q:m};Object.defineProperty(i,"_pauseFor",{get:function e(){return le},set:function e(t){le=t}});Object.defineProperty(i,"_pauseUntilBackOnline",{get:function e(){return de},set:function e(t){de=t}});Object.defineProperty(i,"_pauseUntilServiceIsUp",{get:function e(){return _e},set:function e(t){_e=t}});Object.defineProperty(i,"_maybePauseUntilServiceIsUp",{get:function e(){return me},set:function e(t){me=t}});Object.defineProperty(i,"_one_at_a_time_call_pending",{get:function e(){return c},set:function e(t){c=t}});Object.defineProperty(i,"_is_paused",{get:function e(){return p},set:function e(t){p=t}});Object.defineProperty(i,"_ensure_model_methodsA",{get:function e(){return r},set:function e(t){r=t}});Object.defineProperty(i,"_one_at_a_time_methodsA",{get:function e(){return s},set:function e(t){s=t}});Object.defineProperty(i,"_max_attempts",{get:function e(){return S}});Object.defineProperty(i,"_pending",{get:function e(){return u},set:function e(t){u=t}});Object.defineProperty(i,"_pause_secs",{get:function e(){return h},set:function e(t){h=t}});Object.defineProperty(i,"_maybeTimingClearMarks",{get:function e(){return Q},set:function e(t){Q=t}});Object.defineProperty(i,"_maybeTimingCount",{get:function e(){return V},set:function e(t){V=t}});Object.defineProperty(i,"_maybeTimingMark",{get:function e(){return Y},set:function e(t){Y=t}});Object.defineProperty(i,"_maybeTimingMeasure",{get:function e(){return J},set:function e(t){J=t}});Object.defineProperty(i,"_maybeShowConnectivityWarning",{get:function e(){return ee},set:function e(t){ee=t}});Object.defineProperty(i,"_default_api_args",{get:function t(){return e},set:function t(r){e=r}});Object.defineProperty(i,"_default_api_args_by_method",{get:function e(){return t},set:function e(r){t=r}});Object.defineProperty(i,"_kickOffACall",{get:function e(){return E},set:function e(t){E=t}});Object.defineProperty(i,"_kickOffACallOrEnqueue",{get:function e(){return A},set:function e(t){A=t}});Object.defineProperty(i,"_last_connectivity_warning_time",{get:function e(){return Z},set:function e(t){Z=t}});Object.defineProperty(i,"_api_queue_depth_warning_threshold",{get:function e(){return X},set:function e(t){X=t}});Object.defineProperty(i,"_main_Q",{get:function e(){return d},set:function e(t){d=t}});Object.defineProperty(i,"_one_at_a_time_Q",{get:function e(){return m},set:function e(t){m=t}});Object.defineProperty(i,"_makeRequest",{get:function e(){return F},set:function e(t){F=t}});return i},call:function e(t,r,n,i,a){return A(t,r,n,i,a)},callImmediately:function e(t,r,n,i,a){var o=true;if(-1!=s.indexOf(t))if(c){TS.warn(t+" cannot be called with TS.api.callImmediately because a one-at-a-time call is already pending, so sending to _kickOffACallOrEnqueue for enqueuing");return A(t,r,n,i,a,o)}if(p){TS.warn(t+" cannot be called with TS.api.callImmediately because we are waiting due to a non-200 response, so sending to _kickOffACallOrEnqueue for enqueuing");return A(t,r,n,i,a,o)}r=r||{};var l=W(t,n);return E(t,r,l,i,a)},callSynchronously:function e(t,r,n,i,a){r=r||{};r._synchronously=true;return TS.api.callImmediately(t,r,void 0,i,a).then(function(e){var t=e.data,r=e.args,i=e.request_id;var a=true;if(n)n(a,t,r,i);return{data:t,args:r,request_id:i}}).catch(function(e){var t=e.data,r=e.args,i=e.request_id;var a=false;if(n)n(a,t,r,i);return{data:t,args:r,request_id:i}})},debugGetCounts:function e(){return{_method_call_counts:y,_pending:u}},hasPendingRequests:function e(){return!!u},getQLengths:function e(){return{_main_Q:d.length,_one_at_a_time_Q:m.length}},isPaused:function e(){return p},callFuncWhenApiQisEmpty:function e(t){if(TS.api.hasPendingRequests()){if(!TS.api.Q_empty_sig.has(t))TS.api.Q_empty_sig.addOnce(t)}else t()},debugShowStatus:function e(){TS.console.group("TS.api status");if(p)if(h)TS.log(2,"API calls are paused for "+h+"more seconds");else TS.log(2,"API calls are paused.");else TS.log(2,"API calls are NOT paused");TS.warn(2,"Pending count is "+u+", main queue length is "+d.length+", and one-at-a-time queue length is "+m.length);if(y.total_asks==y.total_attempts)TS.log(2,"Total API calls made (there have been no retries): "+y.total_asks);else{TS.log(2,"Total API calls made (not including retries): "+y.total_asks);TS.log(2,"Total API calls made (including retries): "+y.total_attempts)}if(y.total_non_200s)TS.warn(2,"Total non-200 API responses: "+y.total_non_200s);else TS.log(2,"No non-200 API responses");TS.console.groupEnd("TS.api status")},debugShowQueue:function e(){_.forEach({main:d,"one-at-a-time":m},function(e,t){TS.console.group("TS.api "+t+" queue");if(e.length)e.forEach(function(e){TS.log(2,e.method,e.args)});else TS.log(2,"Nothing pending in "+t+" queue");TS.console.groupEnd("TS.api "+t+" queue")})},debugSetPaused:function e(t){var r=100;if(t){ie({reason:{DEBUG:true},retry_after:1e3*r});TS.log(2,"API calls are now paused for",r,"seconds")}else{ae();TS.log(2,"API calls are now unpaused")}},runNextFromQueue:function e(){if(p){TS.info("Calls are paused, so runNextFromQueue doing anything");return}TS.info("Running next from queue");O()}});var e={};var t={"channels.view":{canonical_avatars:true,name_tagging:true},"rtm.leanStart":{canonical_avatars:true,name_tagging:true},"rtm.start":{canonical_avatars:true,name_tagging:true},"users.info":{canonical_avatars:true,name_tagging:true},"users.list":{canonical_avatars:true,name_tagging:true},"conversations.view":{canonical_avatars:true,name_tagging:true}};var r=["activity.mentions","stars.list","files.list","files.info","search.messages","search.files","channels.history","groups.history","im.history","mpim.history","channels.listShared","groups.listShared","unread.history","pins.list","subteams.users.list","subteams.list","channels.replies","groups.replies","im.replies","subscriptions.thread.getView","chat.command","conversations.history"];var n=["channels.history","pins.list","groups.history","im.history","mpim.history","unread.history","activity.mentions","conversations.history"];var i=["rtm.start","rtm.leanStart","files.list"];var a=["rtm.start","rtm.leanStart","activity.mentions","stars.list","files.list","files.info","apps.list","commands.list","channels.list","emoji.list","help.issues.list","subteams.list","subteams.users.list","rtm.checkFastReconnect"];var s=["users.prefs.set","rtm.start","rtm.leanStart","rtm.checkFastReconnect","enterprise.setPhoto","signup.createTeam"];var o=["channels.view","conversations.view","dnd.teamInfo","screenhero.rooms.create","screenhero.rooms.join","screenhero.rooms.refreshToken","screenhero.rooms.invite","highlights.list","enterprise.channels.createShared","enterprise.groups.createShared","enterprise.teams.create"];var l=["api.test","auth.emailToken","auth.findTeam","auth.findUser","auth.loginMagic","auth.signin","enterprise.signup.complete","enterprise.signup.checkDomain","enterprise.signup.checkPassword","helpdesk.get","signup.addLead","team.checkEmailDomains","test.versionInfo","oauth.access"];var u=0;var d=[];var c=false;var m=[];var f=4;var p=false;var h=0;var g;var S=10;var T=6e4;var v=5e3;var b=100;var y={total_asks:0,total_attempts:0,total_non_200s:0};var w=0;var k=function e(t){if("rtm.start"===t)return 2;if("rtm.leanStart"===t)return 2;if("rtm.checkFastReconnect"===t)return 2;return S};var x=function e(t,r){var n=k(t);if("rtm.start"===t&&r>=n)return true;if("rtm.leanStart"===t&&r>=n)return true;if("rtm.checkFastReconnect"===t&&r>=n)return true;if(w>=4)return true};var C=function e(t){u+=1;if(u>=10)V("ts_api_pending_10plus");else if(u>=5)V("ts_api_pending_5plus");else if(u>=3)V("ts_api_pending_3plus");else if(2==u)V("ts_api_pending_2");else if(1==u)V("ts_api_pending_1");if(-1!=s.indexOf(t))c=true};var M=function e(t){u-=1;if(-1!=s.indexOf(t))c=false};var I=function e(t){M(t);if(!p)O()};var P=function r(n){return _.assign({},e,t[n])};var A=function e(t,r,n,i,a,o){if(_.isUndefined(t)){TS.error("Tried to make API call, but API method name was not specified");throw new Error("Invalid API call")}r=_.defaults(r||{},P(t));var l=W(t,n);var h;if(-1!=s.indexOf(t)){if(!p&&!c)return E(t,r,l,i,a);h=m}else{if(!p&&u<f)return E(t,r,l,i,a);h=d}var g={p:l,method:t,args:r,dont_set_active:i,progressHandler:a};if(o)h.unshift(g);else h.push(g);if(p){V("ts_api_called_while_paused");ee()}if(h==d)V("ts_api_main_queue_depth",d.length);return l.promise};var E=function e(t,r,n,i,a){if(n.promise.isCancelled()){if(TS.has_pri[he])TS.log(he,t+" cancelled before call could be made in TS.api");setTimeout(O,1);return n.promise}if(TS.has_pri[he])TS.log(he,'calling method "'+t+'" args._attempts:'+r._attempts);C(t);var s=t.indexOf("search.")>-1;if(TS.boot_data.page_needs_enterprise&&r.enterprise_token&&s&&!TS.prefs.getPref("search_only_current_team"))r.token=r.enterprise_token;else if(TS.boot_data.page_needs_enterprise&&r.enterprise_token&&!s)r.token=r.enterprise_token;else r.token=TS.model.api_token;if(!TS.client&&!i){r.set_active=true;TS.model.last_net_send=Date.now()}var l=Date.now();var u=B(t,r);var d=l/1e3;var c=TS.model.api_url+t+"?_x_id="+TS.boot_data.version_uid.substring(0,8)+"-"+d;_.each(TS.qs_args,function(e,t){if(0==t.indexOf("feature_")||0==t.indexOf("exp_"))c+="&"+encodeURIComponent(t)+"="+encodeURIComponent(e)});if(TS.boot_data.feature_channel_eventlog_client)if("channels.history"===t||"groups.history"===t||"im.history"===t||"mpim.history"===t||"conversations.history"===t)r.visible=1;var m=function e(){$(u)};var f=function e(i,a){var s=Date.now()-l;TS.dir(2,{data:i,args:r},'got api rsp for method "'+t+'" (took '+s+"ms)");i=i||{ok:false};if(i.ok){D(u);L(t,r,i,a,n);return{breathing_ms:b,try_again:false}}j(u);R(t,r,i);if(-1!=o.indexOf(t)){TS.warn('NOT re-Qing "'+t+'", as specified');L(t,r,i,a,n);return{breathing_ms:b,try_again:false}}if((429==i.status||503==i.status)&&r._attempts>=k(t)||r._synchronously){TS.warn('NOT re-Qing api call "'+t+'" because we tried too many times ('+r._attempts+")");L(t,r,i,a,n);return{breathing_ms:b,try_again:false}}if("_timeout"===i.error)return{breathing_ms:v,try_again:true};if("_badly_formed"===i.error)return{breathing_ms:b,try_again:true};if("_http_error"===i.error){r._delay_ms=U(r,i);if(0==i.status&&x(t,r._attempts)){de(r._attempts);return{breathing_ms:0}}else if(i.status>=500&&x(t,r._attempts)){me(k(t),r._attempts);var d=r._attempts<k(t);return{breathing_ms:r._delay_ms,try_again:d}}y.total_non_200s+=1;return{breathing_ms:r._delay_ms}}var _=false;var c=3;var m=b;if(r._attempts<c)if(("search.files"===t||"search.messages"===t)&&"solr_failed"===i.error)_=true;else if("users.info"===t&&"user_not_found"===i.error){m=1e3*r._attempts;_=true}if(_)return{breathing_ms:m,try_again:true};L(t,r,i,a,n);return{breathing_ms:b,try_again:false}};F(c,t,r,n,m,i,a,f);return n.promise};var F=function e(t,r,n,i,s,o,d,c){var m=new XMLHttpRequest;var f=-1!=a.indexOf(r);var h=0;if(!n._attempts){n._attempts=0;y.total_asks+=1;y[r]=y[r]?y[r]+1:1}n._attempts+=1;y.total_attempts+=1;if(TS.has_pri[ge])TS.log(ge,r+" count: "+y[r]+" (asks: "+y.total_asks+" attempts: "+y.total_attempts+")");var g=function e(){if(TS._count_bytes_received)TS._bytes_received+=m.responseText.length;var t=JSON.parse(m.responseText);w=0;var a=c(t,m.getResponseHeader("X-Slack-Req-Id"));if(a.try_again)setTimeout(function(){N(r,n,i,o,d);if(!p&&!u)O()},a.breathing_ms);I(r)};var S=function e(){var t={ok:false,error:"_http_error",status:parseInt(m.status,10),retry_after:parseInt(m.getResponseHeader&&m.getResponseHeader("Retry-After"),10)};if(t.status>=500||0==t.status)w+=1;else w=0;var a=c(t);function s(){N(r,n,i,o,d);I(r)}if(false===a.try_again){var l;L(r,n,t,l,i);I(r)}else if(a.breathing_ms)setTimeout(s,a.breathing_ms);else s()};var v=function e(){m.onerror=_.noop;m.onreadystatechange=_.noop;m.onprogress=_.noop;m.abort();k=_.noop;var t={ok:false,error:"_timeout",seconds:T};var a=c(t);setTimeout(function(){if(a.try_again)N(r,n,i,o,d);I(r)},a.breathing_ms)};i.onCancel=function(){if(TS.has_pri[he])TS.log(he,r+" cancelled and aborted during request in TS.api");m.onerror=_.noop;m.onreadystatechange=_.noop;m.onprogress=_.noop;m.abort();k=_.noop;clearTimeout(h);setTimeout(I,b,r)};var k=function e(t){if(TS.has_pri[Se])TS.log(Se,r+" progress: "+(void 0!=t&&-1!=t&&100*t+"%"||-1!=t&&0!==t&&100*t+"%"||"unknown"));if(!f)return;clearTimeout(h);var i=T;if("rtm.start"===r)if(n.cache_ts)i=1.5*T;else i=2*T;h=setTimeout(function(){clearTimeout(h);var e=T+"ms passed, no "+r+" progress";var t="API method timed out after "+i;var n="api_call_timeout";var a=false;TS.console.logError(e,t,n,a);v()},i)};m.onprogress=function(e){var t=e.lengthComputable?e.loaded/e.total:-1;if(f)k(t);if(d)d(t)};m.onerror=function(){};m.onreadystatechange=function(){if(1==m.readyState);else if(2==m.readyState){if(s)s(m)}else if(3==m.readyState);else if(4==m.readyState){m.onprogress({loaded:1,total:1,lengthComputable:true});m.onprogress=_.noop;clearTimeout(h);if(200==m.status){m.onreadystatechange=null;g()}else S()}};var x=new FormData;var C=l.indexOf(r)<0;var M=false;Object.keys(n).forEach(function(e){if("token"===e&&!C)return;if("_"===e[0]&&"_x_reason"!==e)return;x.append(e,n[e]);M=true});m.open("POST",t,!n._synchronously);m.setRequestHeader("X-Slack-Version-Ts",TS.boot_data.version_ts);if(f)k(0);if(M)m.send(x);else m.send()};var O=function e(){var t;if(m.length&&!c)t=m.shift();else if(d.length>=te&&re){t=_.find(d,function(e){return ne(e.method)!==re});if(t&&d[0]!==t)_.remove(d,t);else t=d.shift()}else if(d.length)t=d.shift();if(!t){if(0===u){TS.api.Q_empty_sig.dispatch();re=void 0}return}re=ne(t.method);E(t.method,t.args,t.p,t.dont_set_active,t.progressHandler)};var B=function e(t,r){var n="api_call_"+q(t);var a=n+"__headers";var s="start_"+y.total_asks+"_"+n;Y(s);return{args:r,method:t,mark_label:s,headers_label:a,complete_label:n,ephemeral:-1===i.indexOf(t)}};var $=function e(t){if(!t)return;J(t.headers_label,t.mark_label,null,{ephemeral:t.ephemeral});H(t,t.headers_label)};var D=function e(t){if(!t)return;Y(t.complete_label,t.mark_label,null,{ephemeral:t.ephemeral});H(t,t.complete_label);Q(t.mark_label)};var H=function e(t,r){if(!t)return;if("rtm.start"===t.method||"rtm.leanStart"===t.method){var n=r;n+="__dmeliding_"+(t.args.only_relevant_ims?"yes":"no");J(n,t.mark_label,null,{ephemeral:t.ephemeral})}};var j=function e(t){if(!t)return;Q(t.mark_label)};var R=function e(t,r,n){if("file_deleted"===n.error);else{var i=n;var a='api call "'+t+'" not ok';var s="api_call_error";var o=false;TS.console.logError(i,a,s,o);if(TS.qs_args.log_api_failures){try{TS.warn("args: "+JSON.stringify(r))}catch(e){TS.warn("could not stringify args")}try{TS.warn("data: "+JSON.stringify(n))}catch(e){TS.warn("could not stringify data")}}else TS.warn("args/data logging skipped, run with ?log_api_failures=1 to enable full logging")}};var L=function e(t,i,a,s,o){var l=function e(){var r=TS.client&&TS.client.stats&&TS.client.stats.isEnabled();var n;var l;if(r){fe+=1;n="api_response_handler_"+fe;l="slow_api_handler_"+t;TS.metrics.mark(n)}o.handler(a.ok,a,i,s);if(r){var u=TS.metrics.measureAndClear(l,n);if(u>pe)TS.warn("API method handler took too long ("+u+"): "+t,TS.console.getStackTrace())}return Promise.resolve()};if(!a.ok&&a.active_migration&&TS.boot_data){var u=TS.boot_data.api_active_migration_error_response_type;if(!u)TS.info('API returned "active_migration" (enterprise org migration) for '+t+" - not alerting or reloading because no api_active_migration_error_response_type set.",a);else if(TS.boot_data.ignore_api_active_migration_error)TS.info('API returned "active_migration" (enterprise org migration) for '+t+' - skipping "'+u+'" because ignore_api_active_migration_error set.',a);else if("allow_reload"===u){if(!TS.boot_data.active_migration_reload_underway){TS.warn('About to reload because API returned "active_migration" (enterprise org migration) for '+t+" and api_active_migration_error_response_type allows reload.",a);TS.boot_data.active_migration_reload_underway=true;TS.reload(false,"TS.api._callOutsideHandler")}}else if("show_dialog"===u)if(TS.boot_data.user_saw_migration_dialog)TS.info('API returned "active_migration" (enterprise org migration) for '+t+", but user has already seen dialog. Doing nothing.");else{TS.info('API returned "active_migration" (enterprise org migration) for '+t+". Showing migration dialog.");TS.ui.fs_modal.start({title:"This team is joining an Enterprise Organization!",body:"Apologies for the interruption. This team is currently being migrated into "+(a.enterprise_name?"the <b>"+_.escape(a.enterprise_name)+"</b> Organization":"an Organization")+", which can take some time to complete. In the meantime, you won’t be able to use it, but we’ll email you once it’s done.",show_cancel_button:false,show_go_button:false,disable_default_controls:true,disable_esc:true});TS.boot_data.user_saw_migration_dialog=true}else TS.warn('API returned "active_migration" (enterprise org migration) for '+t+', but api_active_migration_error_response_type of "'+u+'" not recognized - doing nothing.',a);return l()}if(!a.ok)return l();if(-1==r.indexOf(t))return l();var d=function e(){if(0===t.indexOf("bots."))return Promise.resolve();if(TS.has_pri[Te])TS.log(Te,'running api data from "'+t+'" through TS.bots.ensureBotsInDataArePresent()');return TS.bots.ensureBotsInDataArePresent(a,t,i.channel||void 0).catch(function(e){TS.error(e)})};var c=function e(){if(_.includes(n,t))return Promise.resolve();if(0===t.indexOf("users."))return Promise.resolve();if(TS.has_pri[Te])TS.log(Te,'running api data from "'+t+'" through TS.members.ensureMembersInDataArePresent()');return TS.members.ensureMembersInDataArePresent(a,t).catch(function(e){TS.error(e)})};var m=function e(){if(TS.has_pri[Te])TS.log(Te,'running api data from "'+t+'" through TS.shared.ensureModelObsInDataArePresent()');return TS.ensureFullyBooted().then(function(){return TS.shared.ensureModelObsInDataArePresent(a,t).catch(function(e){TS.error(e)})})};var f=function e(){if(0===t.indexOf("teams."))return Promise.resolve();TS.log(528,'running api data from "'+t+'" through TS.teams.ensureTeamsInDataArePresent()');return TS.teams.ensureTeamsInDataArePresent(a).catch(function(e){TS.error(e)})};m().then(function(){return Promise.join(d(),c(),f())}).then(l)};var N=function e(t,r,n,i,a){TS.warn('re Qing api call "'+t+'"');var o=-1!=s.indexOf(t)?m:d;o.unshift({method:t,args:r,p:n,dont_set_active:i,progressHandler:a})};var U=function e(t,r){var n;var i;var a=r.retry_after||60;if(a>180)a=180;if(429==r.status||503==r.status){i=1.1;n=180}else{i=1.3;a=1;n=60}var s=!t._delay_ms?1e3*(a+1):Math.min(t._delay_ms*i,1e3*n);s+=Math.random()*(s/2);return Math.floor(s)};var q=function e(t){return String(t).replace(/\./g,"_")};var G=function e(t){var r=new Error('API call "'+t.method+'" not ok');r.method=t.method;r.data=t.data;r.args=t.args;r.request_id=t.request_id;return r};var W=function e(t,r){var n;var i;var a=new Promise(function(e,t,a){i=e;n=t;a(function(){if("function"===typeof r)TS.error("Because you passed a handler, which is deprecated, this API call has been cancelled but your handler has not been called. Use Promise chaining to cancel and react.");o.onCancel()})});if("function"===typeof r)a=a.caught(_.noop);var s=function e(a,s,o,l){var u={data:s,args:o,method:t,request_id:l};if(a)i(u);else n(G(u));if(r)r(a,s,o,l)};var o={promise:a,handler:s,onCancel:_.noop};return o};var z=.01;var K=TS.qs_args.api_timings||Math.random()<=z;var V=function e(t,r){if(!K)return;TS.metrics.count(t,r)};var Y=function e(t){if(!K)return;TS.metrics.mark(t)};var J=function e(t,r,n,i){if(!K)return;TS.metrics.measure(t,r,n,i)};var Q=function e(t){if(!K)return;TS.metrics.clearMarks(t)};var X=100;var Z=0;var ee=function e(){if(TS.ui.fs_modal.is_showing)return;if(!p)return;if(d.length<X)return;var t=3e5;if(Date.now()-Z<t)return;Z=Date.now();TS.metrics.count("ts_api_connectivity_warning_shown");TS.ui.fs_modal.start({title:"Connection troubles",body:"We're having a bit of trouble with our connections to Slack's servers. We've seen this problem clear up with a restart of Slack, a solution which we suggest to you now only with great regret and self-loathing.",go_button_text:"Reload Slack",cancel_button_text:"Ignore",onGo:function e(){TS.metrics.count("ts_api_connectivity_warning_reload");TS.reload(null,"API queue was too deep ("+d.length+" / "+X+") and user chose to reload")},onCancel:function e(){TS.metrics.count("ts_api_connectivity_warning_ignore")}})};var te=5;var re;var ne=function e(t){return t.replace(/^(channels|groups|im|mpim)\./,"_modelob_.")};var ie=function e(t){if("undefined"===typeof t)throw new Error("Please specify the reason pausing the API");if(!p){p=true;V("ts_api_pause");Y("ts_api_pause_start");TS.api.paused_sig.dispatch(t)}};var ae=function e(){if(p){p=false;V("ts_api_unpause");J("ts_api_pause_duration","ts_api_pause_start");Q("ts_api_pause_start")}};var se=function e(){TS.api.unpaused_sig.dispatch()};var oe=1e3;var le=function e(t){h=Math.max(h,Math.ceil(t/oe));ie({reason:{API_ERROR:true},retry_after:h});clearInterval(g);g=setInterval(function(){h-=1;TS.api.paused_sig.dispatch({reason:{API_ERROR:true},retry_after:h});if(!h){clearInterval(g);ae();se();O()}},oe)};var ue=function e(t,r){if(p)return;ie({reason:t});return TS.api.connection.waitForAPIConnection(r).catch(function(){}).then(ae).then(se).then(O).catch(function(e){TS.error("An error occured while waiting for API connection to come back",e);throw e})};var de=function e(t){TS.warn(t+" consecutive connection errors. Pausing API queue until internet returns");return ue({OFFLINE:true})};var _e=function e(t,r){TS.warn("Received "+r+" consecutive 500s; pausing API queue until we determine the service is in a good state");return ue({SERVICE_DOWN:true},t)};var ce=false;var me=function e(t,r){if(ce)return;ce=true;TS.api.connection.promiseToTestAPIConnection().then(function(e){if(e);else _e(t,r)}).finally(function(){ce=false})};var fe=0;var pe=1e3;var he=2;var ge=48;var Se=222;var Te=528})()},4746:function(e,t){(function(){TS.registerModule("permissions.members",{onStart:function e(){if(TS.boot_data.feature_stop_loud_channel_mentions&&TS.client&&TS.client.login_sig)TS.client.login_sig.add(t)},canThread:function e(t){if(!TS.boot_data.feature_default_shared_channels)return true;if(t.is_read_only||t.is_non_threadable)return false;return true},canPostInChannel:function e(t){if(t.is_general)return TS.permissions.members.canPostInGeneral(TS.model.user);if(TS.ims.isImWithDeletedMember(t))return false;if(TS.boot_data.feature_default_shared_channels){if(t.is_read_only||t.is_thread_only)return false;return true}return!TS.channels.read_only.isReadOnly(t.id)},canPostInGeneral:function t(r){if(!r)return false;return e("who_can_post_general",r)},canPostInModelOb:function e(t,r){if(r.is_general)return TS.permissions.members.canPostInGeneral(t);else if(TS.shared.isModelObOrgShared(r))return TS.permissions.members.canPostInChannel(r);else if(TS.ims.isImWithDeletedMember(r))return false;return true},canNonAdminsAtMentionEveryoneBySettings:function t(){if(TS.boot_data.feature_default_shared_channels&&TS.channels.isChannelOrgDefault(TS.shared.getActiveModelOb()))return false;return e("who_can_at_everyone",TS.model.user)},canAtMentionEveryone:function e(){if(!TS.boot_data.feature_stop_loud_channel_mentions)return TS.permissions.members.canNonAdminsAtMentionEveryoneBySettings();var t=TS.channels.getGeneralChannel();if(!t){TS.warn("WTF, could not getGeneralChannel()? Checking only team settings, skipping large channel mentions check.");return TS.permissions.members.canNonAdminsAtMentionEveryoneBySettings()}return TS.permissions.members.canNonAdminsAtMentionEveryoneBySettings()&&!TS.permissions.members.shouldStopChannelMentions(t.id,TS.model.user.id)},canNonAdminsAtChannelOrGroupBySettings:function t(r){if(r)if(TS.boot_data.feature_default_shared_channels&&TS.channels.isChannelOrgDefault(TS.shared.getModelObById(r)))return false;return e("who_can_at_channel",TS.model.user)},canAtChannelOrGroup:function e(t){return TS.permissions.members.canNonAdminsAtChannelOrGroupBySettings(t)&&!TS.permissions.members.shouldStopChannelMentions(t,TS.model.user.id)},shouldStopChannelMentions:function e(t,r){if(!TS.boot_data.feature_stop_loud_channel_mentions)return false;var i=TS.shared.getModelObById(t);if(!i){TS.warn("shouldStopChannelMentions(): could not find model_ob for id "+t);return false}if(i.is_im&&!i.is_mpim)return false;if(TS.boot_data.feature_default_shared_channels&&TS.channels.isChannelOrgDefault(i))return true;var a=TS.membership.getMembershipCounts(i);var s=_.get(a,"counts.member_count")||0;var o=s>=n;if(o&&r){var l=TS.members.getMemberById(r);if(l&&l.is_admin)o=false}return o},canMsgMentionChannelIfMention:function e(t,r,n){if(!TS.boot_data.feature_stop_loud_channel_mentions)return true;if(!t){TS.warn("canMsgMentionChannel: WTF no msg_text?",arguments);return true}var i=true;var a=false;var s=false;var o=false;var l={text:t,subtype:""};var u=TS.utility.msgs.msgContainsMention(l,a,i,s,o);if(!u)return true;var d=TS.permissions.members.shouldStopChannelMentions(r,n);if(d)return false;return true},canArchiveChannels:function t(){if(TS.model.user.is_restricted)return false;return e("who_can_archive_channels",TS.model.user)},canCreateChannels:function t(){if(TS.model.user.is_restricted)return false;return e("who_can_create_channels",TS.model.user)},canCreateGroups:function t(){if(TS.model.user.is_ultra_restricted)return false;return e("who_can_create_groups",TS.model.user)},canCreateMpims:function e(){if(TS.model.user.is_ultra_restricted)return false;return true},canCreateAndDeleteUserGroups:function t(){if(TS.model.user.is_restricted)return false;return e("who_can_create_delete_user_groups",TS.model.user,true)},canEditUserGroups:function t(){if(TS.model.user.is_restricted)return false;return e("who_can_edit_user_groups",TS.model.user,true)},canUserSeeMember:function e(t){if(!TS.model.user.is_restricted)return true;else if(t.is_self)return true;else if(t.is_slackbot)return true;return TS.members.getMembersForUser().indexOf(t)>=0},canKickFromChannels:function t(){if(TS.model.user.is_restricted)return false;return e("who_can_kick_channels",TS.model.user,true)},canKickFromGroups:function t(){if(TS.model.user.is_restricted)return false;return e("who_can_kick_groups",TS.model.user,true)},canCreateConvertOrgSharedChannels:function e(){if(!TS.boot_data.page_needs_enterprise)return false;if(TS.model.user.enterprise_user&&TS.model.user.enterprise_user.is_owner)return true;return TS.permissions.members.canManageOrgSharedChannels()},canManageOrgSharedChannels:function e(){if(!TS.prefs.getTeamPref("who_can_manage_shared_channels"))return true;if(!TS.boot_data.page_needs_enterprise)return false;var t=TS.model.user;if(t.is_restricted)return false;if(void 0!==TS.prefs.getTeamPref("can_user_manage_shared_channels"))return TS.prefs.getTeamPref("can_user_manage_shared_channels");var r=TS.prefs.getTeamPref("who_can_manage_shared_channels").type[0];if("regular"===r)return true;if("admin"===r)return t.is_admin||t.is_owner||!!(t.enterprise_user&&(t.enterprise_user.is_admin||t.enterprise_user.is_owner));if("owner"===r){if(t.enterprise_user&&(t.enterprise_user.is_admin||t.enterprise_user.is_owner))return true;if(TS.prefs.getTeamPref("who_can_manage_shared_channels").user&&TS.prefs.getTeamPref("who_can_manage_shared_channels").user.indexOf(TS.model.user.id)>-1)return true;return false}return false},canRequestSharedChannel:function e(){if(!TS.model.team.plan)return false;if(TS.boot_data.page_needs_enterprise&&!TS.boot_data.feature_shared_channels_enterprise)return false;var t=_.includes(i,TS.model.team.domain);var r=TS.model.user.is_owner||TS.model.user.is_admin;if(t&&r)return 0!==TS.prefs.getTeamPref("enable_shared_channels");return 1===TS.prefs.getTeamPref("enable_shared_channels")},canCreateSharedChannel:function e(){if(!TS.model.user.is_owner&&!TS.model.user.is_admin)return false;return TS.permissions.members.canRequestSharedChannel()},canDisconnectSharedChannels:function e(){if(!TS.model.user.is_owner&&!TS.model.user.is_admin)return false;if(!TS.model.team.plan||TS.boot_data.page_needs_enterprise&&!TS.boot_data.feature_tinyspeck&&!TS.boot_data.feature_shared_channels_enterprise)return false;return true},canManageParticipationInSharedChannelsOpenBeta:function e(){if(!TS.model.team.plan)return false;if(TS.boot_data.page_needs_enterprise&&!TS.boot_data.feature_shared_channels_enterprise)return false;return TS.model.user.is_admin},canExportMessageHistory:function e(t){if(TS.boot_data.feature_channel_exports&&(TS.model.user.is_admin||t.is_im||t.is_group))return true;return false},canUserInviteToChannel:function e(t){if(TS.model.user.is_ultra_restricted)return false;if(t.is_channel&&t.is_member)return true;if(t.is_group)return true;return false},canOrgUserManageGuests:function e(){if(!TS.boot_data.page_needs_enterprise)return true;if(!TS.prefs.getTeamPref("who_can_manage_guests"))return true;var t=TS.model.user;var r=t.is_admin;var n=t.enterprise_user.is_admin;var i=TS.prefs.getTeamPref("who_can_manage_guests");var a=_.head(_.get(i,"type"));if("admin"===a&&(r||n))return true;if("owner"===a&&n)return true;if("owner"===a&&_.includes(i.user,t.id))return true;return false},test:function t(){var r={};Object.defineProperty(r,"_checkPrefCascade",{get:function t(){return e},set:function t(r){e=r}});return r}});var e=function e(t,r,n){if("undefined"===typeof n)n=true;if(r.is_restricted)return"ra"===TS.prefs.getTeamPref(t);if("ra"===TS.prefs.getTeamPref(t))return true;if("regular"===TS.prefs.getTeamPref(t))return true;if("admin"===TS.prefs.getTeamPref(t))return!!r.is_admin;if("owner"===TS.prefs.getTeamPref(t))return!!r.is_owner;return n};function t(){TS.prefs.team_loud_channel_mentions_limit_changed_sig.add(r);r()}var r=function e(){n=TS.prefs.getTeamPref("loud_channel_mentions_limit")||Math.infinity};var n;var i=["rsquared","shared-channels","ultra4slack","slacksharedchannels","bankrate","mtzhf","sarankco","caspersleep","patronage","forbes-business","forbes","nobleppl","tray","stembolt","aking-prod-60","aking-prod-120","stripe","c2","sidlee","nprdigital","insideenergy","3qdigital","radiant-lighting","labyrinth-lab","coloradopublicradio","pcetest1","pcetest2","50bradslavin","surveymonkey","parlevel","zdcorp","happy-returns","solsties","ncc-test-api1-team1","ncc-test-api2-team1","digitalica","eventbrite","songkick","everlane","smyte","bauerxcelmedia","stroeerdigitalgroup","crossengage","outcastagency","methodhome","awaymessages","hellofresh","npr","harvest-test","harvest-client","paperplayground","paper-dbx","digishopgirl","zoomwebdevep1","zoomwebdevep2","carousell","sidearm","paciolan","wwit-apps-ogilvy","iridesco","nikkeidevs","stripe-vendor","nikkeiitb","tab","fogcreek","beproud","institute-group","frontiers-inc","zd-media","ce-one-sharedchannels","ce-two-sharedchannels","friendstestteam","frontiersdemo1","frontiersdemo2","frontiersdemo3"]})()},4747:function(e,t){(function(){TS.registerModule("tips",{onStart:function t(){e.delegate(".ts_tip_lazy, .ts_tip_float","mouseenter",o);e.delegate(".ts_tip_float","mouseleave",l);e.on("click",".ts_tip",function(e){if(TS.isPartiallyBooted()){e.preventDefault();e.stopPropagation();TS.incremental_boot.userDidInteractWithUI();return}c($(this))})},hideAll:function e(){$(".ts_tip").addClass("ts_tip_hide")},unhideAll:function e(){$(".ts_tip").removeClass("ts_tip_hide")},updateTipTitle:function e(t,n){var a=m(t);if(a.length)a.html(n);else t.attr("title",n);if(r&&r[0]==t[0])if(!n)u();else{i.html(n);d()}},updateFloater:function e(t){if(i&&t.title)i.text(t.title);if(n&&t.classes_to_add)n.addClass(t.classes_to_add.join(" "))}});var e=$("BODY");var t=null;var r=null;var n=null;var i=null;var a=10;var s=0;var o=function o(l){r=$(l.currentTarget);var _=r.hasClass("ts_tip_multiline");r.addClass("ts_tip_hidden");if(0==r.children(".ts_tip_tip").length)p(r,_);r.removeAttr("title");r.removeClass("ts_tip_lazy");$("#ts_tip_float_floater").remove();if(r.hasClass("ts_tip_float")){var c=r.attr("class").split(/\s+/).filter(function(e){if("ts_tip_float"===e)return false;if("ts_tip_lazy"===e)return false;return 0===e.indexOf("ts_tip")});var m=TS.templates.builders.strBuilder('<div id="ts_tip_float_floater" style="width:${w}px; height:${h}px;" class="${classes}">${tip_html}</div>',{w:r.outerWidth(),h:r.outerHeight(),classes:c.join(" "),tip_html:r.find(".ts_tip_tip").clone()[0].outerHTML});n=$(m);e.append(n);s=setTimeout(function(){n.removeClass("ts_tip_hidden");d()},a);t=r.closest(":scrollable(vertical)");t.on("scroll.ts_tip_removal",u);r.on("destroyed.ts_tip_removal",u);if(r.hasClass("ts_tip_hide_on_click"))r.on("click.ts_tip_removal",u);if(_)i=n.find(".ts_tip_multiline_inner");else{i=n.find(".ts_tip_tip_inner");if(!i.length)i=n.find(".ts_tip_tip")}}else setTimeout(function(){r.removeClass("ts_tip_hidden")},a)};var l=function e(){u()};var u=function e(){clearTimeout(s);if(n)n.addClass("ts_tip_hidden");if(r&&r.length){r.off("click.ts_tip_removal");r.off("destroyed.ts_tip_removal")}if(t)t.off("scroll.ts_tip_removal");t=null;r=null;n=null;i=null};var d=function e(){var t=r.offset();var i=2;var a=window.innerWidth-i;var s=window.innerHeight-i;var o=n.hasClass("ts_tip_multiline");var l=function e(){if(o)return n.find(".ts_tip_multiline_inner").dimensions_rect();return n.find(".ts_tip_tip").dimensions_rect()};var u=function e(t){n.removeClass("\t\t\tts_tip_right \t\t\tts_tip_rightish \t\t\tts_tip_left \t\t\tts_tip_leftish \t\t\tts_tip_multiline_top_leftish \t\t\tts_tip_multiline_top_left \t\t\tts_tip_multiline_top_right \t\t\tts_tip_multiline_top_rightish \t\t").addClass(t)};n.css("left",t.left).css("top",t.top);var d=l();if(d.bottom>s)n.removeClass("ts_tip_bottom").addClass("ts_tip_top");else if(d.top<i)n.removeClass("ts_tip_top").addClass("ts_tip_bottom");if(o){if(d.right>a)u("ts_tip_multiline_top_rightish");else if(d.left<i)u("ts_tip_multiline_top_leftish");d=l();if(d.right>a)u("ts_tip_multiline_top_right");else if(d.left<i)u("ts_tip_multiline_top_left")}else{if(d.right>a)u("ts_tip_rightish");else if(d.left<i)u("ts_tip_leftish");d=l();if(d.right>a)u("ts_tip_right");else if(d.left<i)u("ts_tip_left")}};var c=function e(t){var r=m(t);var n="tip-toggle-auto";var i;if(t.data(n))i=t;else if(r.data(n))i=r;if(!(i&&i.length))return;var a=r.html();var s=i.data(n);if(!s)return TS.warn("No toggle state text defined on tipped element. Please add text to data-tip-toggle-text or data-tip-toggle-auto attribute");TS.tips.updateTipTitle(t,s);i.data(n,a)};var m=function e(t){var r=t.find(".ts_tip_multiline_inner");if(!r.length)r=t.find(".ts_tip_tip_inner");if(!r.length)r=t.find(".ts_tip_tip");return r};var f=function e(t){if(t.text().trim().length)return;if(t.attr("aria-label"))return;return _.uniqueId("ts_tip_tip_")};var p=function e(t,r){var n="";if(t.data("tip-member"))n=TS.templates["c-member"]({member:TS.members.getMemberById(t.data("tip-member")),size:"small",avatar:true,no_tip:true,dark:true,omit_status:true,forced_primary:"real_name"});else{var i=_.escape(t.prop("title"));var a=f(t);var s=a?' id="'+a+'"':"";n=r?'<span class="ts_tip_multiline_inner">'+i+"</span>":i}var o=["<span",s,' class="ts_tip_tip"',">",n,"</span>"];t.append(o.join(""));t.attr("aria-labelledby",a)}})()},4748:function(e,t){(function(){TS.registerModule("tips.texty",{onStart:function n(){e.delegate(".ts_tip_texty","mouseenter",t);e.delegate(".ts_tip_texty","mouseleave",r)},show:function e(t){n(t)},hide:function e(){i()}});var e=$("BODY");var t=function e(t){n(t.target)};var r=function e(){i()};var n=function t(r){var n=r.getAttribute("data-title")||null;var i=r.getAttribute("data-id")&&"UNVERIFIED"!==r.getAttribute("data-id")?TS.members.getMemberById(r.getAttribute("data-id")):null;$("#ts_tip_texty_tip").remove();if(!n&&!TS.boot_data.feature_slug_tooltips)return;if(TS.boot_data.feature_slug_tooltips&&!n&&!i)return;var a=$('<div id="ts_tip_texty_tip"></div>');var s=r.getBoundingClientRect();TS.interop.mountTooltipTip(TS.boot_data.team_id,a[0],i?i.id:null,{children:n,position:"top",className:TS.boot_data.feature_slug_tooltips&&i?"c-tooltip__tip--member":""});e.append(a);var o=e.height()-s.top;var l=s.left;l-=a.width()/2;l+=s.width/2;a.css({bottom:o+"px",left:l+"px",opacity:1})};var i=function e(){var t=document.getElementById("ts_tip_texty_tip");if(!t)return;$(t).fadeOut(100,function(){TS.interop.unmountTooltipTip(t);$(t).remove()})}})()},4749:function(e,t){(function(){TS.registerModule("notifs",{onStart:function e(){},canCorGHaveChannelMentions:function e(t){var r=TS.channels.getChannelById(t)||TS.groups.getGroupById(t)||TS.mpims.getMpimById(t);if(!r){TS.error("no model_ob for c_id:"+t+"?");return true}return TS.notifs.canModelObHaveChannelMentions(r)},canModelObHaveChannelMentions:function e(t){if(t.is_im)return false;if("admin"===TS.prefs.getTeamPref("who_can_at_channel")||"owner"===TS.prefs.getTeamPref("who_can_at_channel"))return true;if(TS.channels.isChannelRequired(t)&&("admin"===TS.prefs.getTeamPref("who_can_at_everyone")||"owner"===TS.prefs.getTeamPref("who_can_at_everyone")))return true;if(t.is_general&&("admin"===TS.prefs.getTeamPref("who_can_post_general")||"owner"===TS.prefs.getTeamPref("who_can_post_general")))return true;var r=TS.notifs.getCalculatedCorGNotifySetting(t.id);if("mentions"!==r&&"nothing"!==r)return true;return!TS.notifs.hasUserSuppressedCorGChannelMentions(t)},hasUserSuppressedCorGChannelMentions:function e(t){if(TS.boot_data.feature_mpdm_default_fe)return!!TS.redux.notifications.getNotificationsChannelPref(t.id,"suppress_at_channel");var r=TS.model.at_channel_suppressed_channels.indexOf(t.id);if(-1!=r)return true;return false},hasUserSuppressedCorGChannelMentionsById:function e(t){var r=TS.channels.getChannelById(t)||TS.groups.getGroupById(t)||TS.mpims.getMpimById(t);if(!r){TS.error("no model_ob for c_id:"+t+"?");return true}return TS.notifs.hasUserSuppressedCorGChannelMentions(r)},hasUserSuppressedCorGPushChannelMentions:function e(t){var r=TS.channels.getChannelById(t)||TS.groups.getGroupById(t)||TS.mpims.getMpimById(t);if(!r){TS.error("no model_ob for c_id:"+t+"?");return true}var n=TS.model.push_at_channel_suppressed_channels.indexOf(r.id);if(-1!=n)return true;return false},isCorGMuted:function e(t){if(!t){TS.error('wtf no c_id "'+t+'"');return false}return TS.redux.channels.isChannelMutedById(t)},getCorGsNotUsingGlobalPushNotificationSetting:function e(){var t={nothing:[],mentions:[],everything:[]};var r;var n;var i={};var a;var s;var o="quiet";if(TS.prefs.getPref("push_mention_alert")||TS.prefs.getPref("push_dm_alert"))o="mentions";if(TS.prefs.getPref("push_everything"))o="loud";s=TS.prefs.getPref("push_loud_channels_set")?TS.prefs.getPref("push_loud_channels_set").split(","):[];for(n=0;n<s.length;n+=1){a=$.trim(s[n]);if(!a)continue;i[a]="quiet"}s=TS.channels.getChannelsForUser();for(n=0;n<s.length;n+=1){if(!s[n])continue;a=s[n].id;if("mentions"!==TS.notifs.getCalculatedCorGPushNotifySetting(a))continue}s=TS.prefs.getPref("push_mention_channels")?TS.prefs.getPref("push_mention_channels").split(","):[];for(n=0;n<s.length;n+=1){a=$.trim(s[n]);if(!a)continue;if(!i[a])continue;i[a]="mentions"}s=TS.prefs.getPref("push_loud_channels")?TS.prefs.getPref("push_loud_channels").split(","):[];for(n=0;n<s.length;n+=1){a=$.trim(s[n]);if(!a)continue;if(!i[a])continue;i[a]="loud"}_.forOwn(i,function(e,n){r=TS.channels.getChannelById(n)||TS.groups.getGroupById(n)||TS.mpims.getMpimById(n);if(!r)return;if(r.is_archived)return;if(r.is_channel&&!r.is_member)return;if("loud"===e){if("loud"===o)return;t.everything.push(r)}else if("mentions"===e){if("mentions"===o)return;t.mentions.push(r)}else if("mentions_suppressed"===e);else{if("quiet"===o)return;t.nothing.push(r)}});return t},getCorGsNotUsingGlobalNotificationSetting:function e(){var t={nothing:[],mentions:[],everything:[],muted:[],suppressed:[]};var r=TS.channels.getChannelsForUser();_.forOwn(r,function(e){if(e.is_archived)return;if(!e.is_member)return;if(n(e.id))t.nothing.push(e);if(i(e.id))t.mentions.push(e);if(a(e.id))t.everything.push(e);if(TS.notifs.isCorGMuted(e.id))t.muted.push(e);if(TS.notifs.hasUserSuppressedCorGChannelMentions(e))t.suppressed.push(e)});_.forOwn(TS.model.groups,function(e){if(e.is_archived)return;if(n(e.id))t.nothing.push(e);if(i(e.id))t.mentions.push(e);if(a(e.id))t.everything.push(e);if(TS.notifs.isCorGMuted(e.id))t.muted.push(e);if(TS.notifs.hasUserSuppressedCorGChannelMentions(e))t.suppressed.push(e)});_.forOwn(TS.model.mpims,function(e){if(e.is_archived)return;if(n(e.id))t.nothing.push(e);if(i(e.id))t.mentions.push(e);if(a(e.id))t.everything.push(e);if(TS.notifs.isCorGMuted(e.id))t.muted.push(e);if(TS.notifs.hasUserSuppressedCorGChannelMentions(e))t.suppressed.push(e)});return t},getCalculatedCorGNotifySetting:function n(i){if(!i){TS.error('wtf no c_id "'+i+'"');return false}if(TS.boot_data.feature_mpdm_default_fe){var a=TS.redux.notifications.getCalculatedDesktopNotifySetting(i);if("mentions_dms"===a)return"mentions";return a}var s=r(i);if(s){if(e(i))return"everything";if(t(i))return"nothing";return"mentions"}if(TS.prefs.getPref("growls_enabled")){if(TS.prefs.getPref("all_channels_loud"))return"everything";return"mentions"}return"nothing"},muteOrUnmuteCorG:function e(t){if(!t)return;if(TS.isPartiallyBooted()){TS.incremental_boot.userDidInteractWithUI();return}var r=TS.shared.getModelObById(t);if(!r)return;if(r.is_im)return;var n=TS.notifs.isCorGMuted(t);if(!n){TS.notifs.makeCorGMuted(t);if(r.is_mpim)TS.mpims.markMostRecentReadMsg(r,TS.model.marked_reasons.muted)}else TS.notifs.makeCorGNOTMuted(t);var i=TS.redux.channels.getMutedChannelsAsArray().join(",");TS.prefs.onPrefChanged({name:"muted_channels",value:i});TS.prefs.setPrefByAPI({name:"muted_channels",value:i})},makeCorGMuted:function e(t){var r=TS.channels.getChannelById(t);var n=TS.groups.getGroupById(t);var i=TS.mpims.getMpimById(t);if(!r&&!n&&!i){TS.error('wtf no channel/group "'+t+'"');return false}var a=true;TS.redux.channels.setMutedChannelById(t,a);TS.prefs.setMutedChannels(TS.redux.channels.getMutedChannelsAsArray().join(","));if(!TS.client)return;if(r)TS.channels.calcUnreadCnts(r);if(n)TS.groups.calcUnreadCnts(n);if(i)TS.mpims.calcUnreadCnts(i)},makeCorGNOTMuted:function e(t){var r=TS.channels.getChannelById(t);var n=TS.groups.getGroupById(t);var i=TS.mpims.getMpimById(t);if(!r&&!n&&!i){TS.error('wtf no channel/group "'+t+'"');return false}var a=false;TS.redux.channels.setMutedChannelById(t,a);TS.prefs.setMutedChannels(TS.redux.channels.getMutedChannelsAsArray().join(","));if(!TS.client)return;if(r)TS.channels.calcUnreadCnts(r);if(n)TS.groups.calcUnreadCnts(n);if(i)TS.mpims.calcUnreadCnts(i)},makeCorGSuppressed:function e(t){var r=TS.channels.getChannelById(t);var n=TS.groups.getGroupById(t);var i=TS.mpims.getMpimById(t);if(!r&&!n&&!i){TS.error('wtf no channel/group "'+t+'"');return false}var a=TS.model.at_channel_suppressed_channels.indexOf(t);if(-1==a)TS.model.at_channel_suppressed_channels.push(t);TS.prefs.setSuppressedChannels(TS.model.at_channel_suppressed_channels.join(","));if(!TS.client)return;if(r)TS.channels.calcUnreadCnts(r);if(n)TS.groups.calcUnreadCnts(n);if(i)TS.mpims.calcUnreadCnts(i)},makeCorGNOTSuppressed:function e(t){var r=TS.channels.getChannelById(t);var n=TS.groups.getGroupById(t);var i=TS.mpims.getMpimById(t);if(!r&&!n&&!i){TS.error('wtf no channel/group "'+t+'"');return false}var a=TS.model.at_channel_suppressed_channels.indexOf(t);if(-1!=a)TS.model.at_channel_suppressed_channels.splice(a,1);TS.prefs.setSuppressedChannels(TS.model.at_channel_suppressed_channels.join(","));if(!TS.client)return;if(r)TS.channels.calcUnreadCnts(r);if(n)TS.groups.calcUnreadCnts(n);if(i)TS.mpims.calcUnreadCnts(i)},makeCorGPushSuppressed:function e(t){var r=TS.channels.getChannelById(t);var n=TS.groups.getGroupById(t);var i=TS.mpims.getMpimById(t);if(!r&&!n&&!i){TS.error('wtf no channel/group "'+t+'"');return false}var a=TS.model.push_at_channel_suppressed_channels.indexOf(t);if(-1==a)TS.model.push_at_channel_suppressed_channels.push(t);TS.prefs.setPushSuppressedChannels(TS.model.push_at_channel_suppressed_channels.join(","))},makeCorGNOTPushSuppressed:function e(t){var r=TS.channels.getChannelById(t);var n=TS.groups.getGroupById(t);var i=TS.mpims.getMpimById(t);if(!r&&!n&&!i){TS.error('wtf no channel/group "'+t+'"');return false}var a=TS.model.push_at_channel_suppressed_channels.indexOf(t);if(-1!=a)TS.model.push_at_channel_suppressed_channels.splice(a,1);TS.prefs.setPushSuppressedChannels(TS.model.push_at_channel_suppressed_channels.join(","))},makeCorGDTopNothing:function e(t){var r=TS.channels.getChannelById(t);var n=TS.groups.getGroupById(t);var i=TS.mpims.getMpimById(t);if(!r&&!n&&!i){TS.error('wtf no channel/group "'+t+'"');return false}var a=TS.model.loud_channels.indexOf(t);if(-1!=a)TS.model.loud_channels.splice(a,1);TS.prefs.setLoudChannels(TS.model.loud_channels.join(","));a=TS.model.never_channels.indexOf(t);if(TS.prefs.getPref("growls_enabled")){if(-1==a)TS.model.never_channels.push(t);u(t)}else{if(-1!=a)TS.model.never_channels.splice(a,1);d(t)}TS.prefs.setNeverChannels(TS.model.never_channels.join(","))},makeCorGDTopEverything:function e(t){var r=TS.channels.getChannelById(t);var n=TS.groups.getGroupById(t);var i=TS.mpims.getMpimById(t);if(!r&&!n&&!i){TS.error('wtf no channel/group "'+t+'"');return false}var a=TS.model.never_channels.indexOf(t);if(-1!=a)TS.model.never_channels.splice(a,1);TS.prefs.setNeverChannels(TS.model.never_channels.join(","));a=TS.model.loud_channels.indexOf(t);if(TS.prefs.getPref("growls_enabled")&&TS.prefs.getPref("all_channels_loud")){if(-1!=a)TS.model.loud_channels.splice(a,1);d(t)}else{if(-1==a)TS.model.loud_channels.push(t);u(t)}TS.prefs.setLoudChannels(TS.model.loud_channels.join(","))},makeCorGDTopMentions:function e(t){var r=TS.channels.getChannelById(t);var n=TS.groups.getGroupById(t);var i=TS.mpims.getMpimById(t);if(!r&&!n&&!i){TS.error('wtf no channel/group "'+t+'"');return false}var a=TS.model.loud_channels.indexOf(t);if(-1!=a)TS.model.loud_channels.splice(a,1);TS.prefs.setLoudChannels(TS.model.loud_channels.join(","));a=TS.model.never_channels.indexOf(t);if(-1!=a)TS.model.never_channels.splice(a,1);TS.prefs.setNeverChannels(TS.model.never_channels.join(","));if(TS.prefs.getPref("growls_enabled")&&!TS.prefs.getPref("all_channels_loud"))d(t);else u(t)},makeCorGPushNothing:function e(t){var r=TS.channels.getChannelById(t);var n=TS.groups.getGroupById(t);var i=TS.mpims.getMpimById(t);if(!r&&!n&&!i){TS.error('wtf no channel/group "'+t+'"');return false}var a=TS.model.push_loud_channels.indexOf(t);if(-1!=a)TS.model.push_loud_channels.splice(a,1);TS.prefs.setPushLoudChannels(TS.model.push_loud_channels.join(","));a=TS.model.push_mention_channels.indexOf(t);if(-1!=a)TS.model.push_mention_channels.splice(a,1);TS.prefs.setPushMentionChannels(TS.model.push_mention_channels.join(","));if(TS.prefs.getPref("push_everything")||TS.prefs.getPref("push_mention_alert"))c(t);else m(t)},makeCorGPushEverything:function e(t){var r=TS.channels.getChannelById(t);var n=TS.groups.getGroupById(t);var i=TS.mpims.getMpimById(t);if(!r&&!n&&!i){TS.error('wtf no channel/group "'+t+'"');return false}var a=TS.model.push_mention_channels.indexOf(t);if(-1!=a)TS.model.push_mention_channels.splice(a,1);TS.prefs.setPushMentionChannels(TS.model.push_mention_channels.join(","));a=TS.model.push_loud_channels.indexOf(t);if(TS.prefs.getPref("push_everything")){if(-1!=a)TS.model.push_loud_channels.splice(a,1);m(t)}else{if(-1==a)TS.model.push_loud_channels.push(t);c(t)}TS.prefs.setPushLoudChannels(TS.model.push_loud_channels.join(","))},makeCorGPushMentions:function e(t){var r=TS.channels.getChannelById(t);var n=TS.groups.getGroupById(t);var i=TS.mpims.getMpimById(t);if(!r&&!n&&!i){TS.error('wtf no channel/group "'+t+'"');return false}var a=TS.model.push_loud_channels.indexOf(t);if(-1!=a)TS.model.push_loud_channels.splice(a,1);TS.prefs.setPushLoudChannels(TS.model.push_loud_channels.join(","));a=TS.model.push_mention_channels.indexOf(t);if(!TS.prefs.getPref("push_mention_alert")||TS.prefs.getPref("push_everything")){if(-1==a)TS.model.push_mention_channels.push(t);c(t)}else{if(-1!=a)TS.model.push_mention_channels.splice(a,1);m(t)}TS.prefs.setPushMentionChannels(TS.model.push_mention_channels.join(","))},getCalculatedCorGPushNotifySetting:function e(t){if(!t){TS.error('wtf no c_id "'+t+'"');return false}if(TS.boot_data.feature_mpdm_default_fe){var r=TS.redux.notifications.getCalculatedMobileNotifySetting(t);if("mentions_dms"===r)return"mentions";return r}var n=l(t);if(n){if(s(t))return"everything";if(o(t))return"mentions";return"nothing"}if(TS.prefs.getPref("push_everything"))return"everything";if(TS.prefs.getPref("push_mention_alert")||TS.prefs.getPref("push_dm_alert"))return"mentions";return"nothing"},getGlobalHighlightWords:function e(){if(TS.boot_data.feature_mpdm_default_fe)return TS.redux.notifications.getGlobalHighlightWords();return TS.prefs.getPref("highlight_words")},setGlobalHighlightWords:function e(t){if(TS.boot_data.feature_mpdm_default_fe)return TS.notifs.setGlobalNotificationPrefByKey("global_keywords",t);return TS.prefs.setPrefByAPI({name:"highlight_words",value:t})},getDesktopNotificationSoundPref:function e(){if(TS.boot_data.feature_mpdm_default_fe)return TS.redux.notifications.getDesktopNotificationSoundPref();return TS.prefs.getPref("new_msg_snd")},setDesktopNotificationSoundPref:function e(t){if(TS.boot_data.feature_mpdm_default_fe)return TS.notifs.setGlobalNotificationPrefByKey("desktop_sound",t);return TS.prefs.setPrefByAPI({name:"new_msg_snd",value:t})},getThreadsEverythingNotificationPref:function e(){if(TS.boot_data.feature_mpdm_default_fe)return TS.redux.notifications.getThreadsEverythingNotificationPref();return TS.prefs.getPref("threads_everything")},setThreadsEverythingNotificationPref:function e(t){var r="threads_everything";if(TS.boot_data.feature_mpdm_default_fe)return TS.notifs.setGlobalNotificationPrefByKey(r,t);return TS.prefs.setPrefByAPI({name:r,value:t})},getNotificationPushIdleWaitTimeInMinutes:function e(){if(TS.boot_data.feature_mpdm_default_fe)return TS.redux.notifications.getNotificationPushIdleWaitTimeInMinutes();return TS.prefs.getPref("push_idle_wait")},setNotificationPushIdleWaitTimeInMinutes:function e(t){var r="push_idle_wait";if(TS.boot_data.feature_mpdm_default_fe)return TS.notifs.setGlobalNotificationPrefByKey(r,t);return TS.prefs.setPrefByAPI({name:r,value:t})},getNoTextInNotificationsPref:function e(){if(TS.boot_data.feature_mpdm_default_fe)return TS.redux.notifications.getNoTextInNotificationsPref();return TS.prefs.getPref("no_text_in_notifications")},setNoTextInNotificationsPref:function e(t){var r="no_text_in_notifications";if(TS.boot_data.feature_mpdm_default_fe)return TS.notifs.setGlobalNotificationPrefByKey(r,t);return TS.prefs.setPrefByAPI({name:r,value:t})},getGlobalNotificationSetting:function e(){if(TS.boot_data.feature_mpdm_default_fe){var t=TS.redux.notifications.getGlobalDesktopNotifySetting();if("mentions_dms"===t)return"mentions";return t}if(!TS.prefs.getPref("growls_enabled"))return"nothing";if(TS.prefs.getPref("all_channels_loud"))return"everything";return"mentions"},setDesktopGlobalNotifySetting:function e(t,r){if(!TS.boot_data.feature_mpdm_default_fe)return;return TS.notifs.setGlobalNotificationPrefByKey("global_desktop",t,r)},getGlobalPushNotificationSetting:function e(){if(TS.boot_data.feature_mpdm_default_fe){var t=TS.redux.notifications.getGlobalMobileNotifySetting();if("mentions_dms"===t||"dms"===t)return"mentions";return t}if(TS.prefs.getPref("push_everything"))return"everything";if(TS.prefs.getPref("push_mention_alert")&&TS.prefs.getPref("push_dm_alert"))return"dm_and_mentions";if(TS.prefs.getPref("push_mention_alert"))return"mentions";if(TS.prefs.getPref("push_dm_alert"))return"dms";return"nothing"},setMobileGlobalNotifySetting:function e(t){if(!TS.boot_data.feature_mpdm_default_fe)return;return TS.notifs.setGlobalNotificationPrefByKey("global_mobile",t)},setGlobalNotificationPrefByKey:function e(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:false;if("mentions"===r)r="mentions_dms";return TS.api.call("users.prefs.setNotifications",{global:true,name:t,value:r,sync:n})}});var e=function e(t){if(!t){TS.error('wtf no c_id "'+t+'"');return false}if(TS.model.loud_channels.indexOf(t)>-1)return true;return false};var t=function e(t){if(!t){TS.error('wtf no c_id "'+t+'"');return false}if(TS.model.never_channels.indexOf(t)>-1)return true;return false};var r=function e(t){if(!t){TS.error('wtf no c_id "'+t+'"');return false}if(TS.model.loud_channels_set&&TS.model.loud_channels_set.indexOf(t)>-1)return true;return false};var n=function e(t){if(TS.prefs.getPref("growls_enabled")&&"nothing"===TS.notifs.getCalculatedCorGNotifySetting(t))return true;return false};var i=function e(t){var r=TS.notifs.getCalculatedCorGNotifySetting(t);if("mentions"!==r)return false;if(!TS.prefs.getPref("growls_enabled")||TS.prefs.getPref("all_channels_loud"))return true;return false};var a=function e(t){if((!TS.prefs.getPref("growls_enabled")||!TS.prefs.getPref("all_channels_loud"))&&"everything"===TS.notifs.getCalculatedCorGNotifySetting(t))return true;return false};var s=function e(t){if(!t){TS.error('wtf no c_id "'+t+'"');return false}if(TS.model.push_loud_channels.indexOf(t)>-1)return true;return false};var o=function e(t){if(!t){TS.error('wtf no c_id "'+t+'"');return false}if(TS.model.push_mention_channels.indexOf(t)>-1)return true;return false};var l=function e(t){if(!t){TS.error('wtf no c_id "'+t+'"');return false}if(TS.model.push_loud_channels_set&&TS.model.push_loud_channels_set.indexOf(t)>-1)return true;return false};var u=function e(t){var r=TS.model.loud_channels_set.indexOf(t);if(-1==r)TS.model.loud_channels_set.push(t);TS.prefs.setLoudChannelsSet(TS.model.loud_channels_set.join(","))};var d=function e(t){var r=TS.model.loud_channels_set.indexOf(t);if(-1!=r)TS.model.loud_channels_set.splice(r,1);TS.prefs.setLoudChannelsSet(TS.model.loud_channels_set.join(","))};var c=function e(t){var r=TS.model.push_loud_channels_set.indexOf(t);if(-1==r)TS.model.push_loud_channels_set.push(t);TS.prefs.setPushLoudChannelsSet(TS.model.push_loud_channels_set.join(","))};var m=function e(t){var r=TS.model.push_loud_channels_set.indexOf(t);if(-1!=r)TS.model.push_loud_channels_set.splice(r,1);TS.prefs.setPushLoudChannelsSet(TS.model.push_loud_channels_set.join(","))}})()},4750:function(e,t){(function(){TS.registerModule("redux",{onStart:function t(){e=TS.interop.redux.configureStore({teamId:TS.boot_data.team_id||"NO_TEAM_ID"});TS.redux.dispatch(TS.interop.redux.features.bootData.setBootData(TS.boot_data));if(TS.useReactMessages()){var r=TS.storage.fetchExpandableState();TS.redux.dispatch(TS.interop.redux.features.expandables.bulkSetExpanded(r))}},bindSelectorToStore:function t(n){if(!n)throw new Error("bindSelectorToStore: selector is undefined.");return function(t,i,a,s,o,l,u){if(!e){TS.console.error("Attempting to use a redux selector before the redux store is initialized, returning undefined instead. Selector is: "+n,d);return}var d=r(n);if(!d){TS.console.error("Selector "+n+" cannot be found. Either it doesn't exist or it hasn't yet been initialized. Returning undefined instead");return}if(d&&d.length>7)throw new Error("bindSelectorToStore only supports selectors accepting up to 7 parameters. This should be more than enough for any use case");return d.call(void 0,TS.redux.getState(),t,i,a,s,o,l,u)}},getState:function t(){var r=e&&e.getState&&e.getState();if(!r){TS.error("No redux state found. The redux store must not be initialized yet");TS.console.logStackTrace("Logging a stack trace to determine what is trying to access redux too early")}return r},getStoreInstance:function t(){if(!e){TS.error("No redux store found. The redux store must not be initialized yet");TS.console.logStackTrace("Logging a stack trace to determine what is trying to access redux too early")}return e},dispatch:function t(r){if(r&&e&&e.dispatch)return e.dispatch(r);if(!r){TS.error("No action provided?");return}TS.error("No dispatch function available. The redux store must not be initialized yet");TS.console.logStackTrace("Logging a stack trace to determine what is trying to access redux too early")},test:function e(){var t={};return t}});var e;var t={};function r(e){var r=t[e];if(r)return r;r=_.get(window,e);if(!r)return;t[e]=r;return r}})()},4751:function(e,t){(function(){TS.registerModule("redux.all_unreads",{onStart:function e(){t()},updateHasUnreads:function e(t){if("boolean"!==typeof t)return;TS.redux.dispatch(TS.interop.redux.features.allUnreads.updateHasUnreads(t))},updateHasUnreadThreads:function e(t){if("boolean"!==typeof t)return;TS.redux.dispatch(TS.interop.redux.features.allUnreads.updateHasUnreadThreads(t))},updateThreadsMentionCount:function e(t){if(!_.isInteger(t))return;TS.redux.dispatch(TS.interop.redux.features.allUnreads.updateThreadsMentionCount(t))}});function e(){TS.redux.all_unreads.updateHasUnreadThreads(TS.model.threads_has_unreads);TS.redux.all_unreads.updateThreadsMentionCount(TS.model.threads_mention_count)}function t(){if(_.get(TS,"client.threads.threads_unread_changed"))TS.client.threads.threads_unread_changed.add(e)}})()},4752:function(e,t){(function(){TS.registerModule("redux.channels",{onStart:function t(){e=TS.interop.redux.models.channels.isIm;Object.defineProperty(TS.model,"channels",{get:function e(){return h("channels")}});Object.defineProperty(TS.model,"groups",{get:function e(){return h("groups")}});Object.defineProperty(TS.model,"mpims",{get:function e(){return h("mpims")}});Object.defineProperty(TS.model,"ims",{get:function e(){return h("ims")}})},forceUpdateOfEntityById:function e(t){if(!t||!t.id)return;TS.redux.dispatch(TS.interop.redux.models.channels.forceUpdateOfChannelById(t.id))},clearAllShowInListEvenThoughUnreadsFlags:function e(){TS.redux.dispatch(TS.interop.redux.models.channels.clearAllShowInListEvenThoughUnreadsFlags())},dangerouslyGetEntityById:function e(t){return n(t)},dangerouslyGetChannelsForUser:function e(){var t=_.filter(r(),function(e){return e.is_channel});if(!TS.model.user.is_restricted)return t;return _.filter(t,"is_member")},dangerouslyGetGroups:function e(){return _.filter(r(),function(e){return e.is_group&&!e.is_mpim})},dangerouslyGetMpims:function e(){return _.filter(r(),function(e){return e.is_group&&e.is_mpim})},isChannel:function e(t){if(!t)return false;return t.is_channel},isMpim:function e(t){if(!t)return false;return t.is_group&&t.is_mpim},isGroup:function e(t){if(!t)return false;return t.is_group&&!t.is_mpim},isIm:function t(r){return e(r)},setMarkingState:function e(t,r){TS.redux.dispatch(TS.interop.redux.models.channelsMeta.needsApiMarking.setMarkingState({id:t,needsApiMarking:r}))},clearAllMarkingFlags:function e(){TS.redux.dispatch(TS.interop.redux.models.channelsMeta.needsApiMarking.clearAllMarkingFlags())},clearMarkingFlagsForIds:function e(t){TS.redux.dispatch(TS.interop.redux.models.channelsMeta.needsApiMarking.clearMarkingFlagsForIds(t))},getAllIdsNeedingMarking:function e(){return o()},getAllUnmutedIdsNeedingMarking:function e(){return u()},getAllMutedIdsNeedingMarking:function e(){return l()},bulkAddEntities:function e(t){TS.redux.dispatch(TS.interop.redux.models.channels.bulkAddChannels(t))},bulkUpdateEntities:function e(t){TS.redux.dispatch(TS.interop.redux.models.channels.bulkUpdateChannels(t))},addEntity:function e(t){if(!t)return;if(t._is_interop_channel_object){var r="Attempting to add a channel interop object, not a channel. Only raw channel objects can be added. Take this to #devel-redux";if(p())throw new Error(r);else{TS.error(r);return}}TS.redux.dispatch(TS.interop.redux.models.channels.addChannel(t))},removeEntity:function e(t){if(!t)return;if(t._is_interop_channel_object){t=n(t.id);if(!t)return}TS.redux.dispatch(TS.interop.redux.models.channels.removeChannel(t))},removeMpimFromNameMap:function e(t){TS.redux.dispatch(TS.interop.redux.models.channelsMeta.channelNamesToIds.removeMpimFromNameMap({name:t}))},addEntityToNameMap:function e(t){if(!t||!t.id)return;var r=t._is_interop_channel_object?n(t.id):t;TS.redux.dispatch(TS.interop.redux.models.channelsMeta.channelNamesToIds.addChannelToNameMap(r))},replaceEntity:function e(t){if(!t)return;if(t._is_interop_channel_object){var r="Attempting to replace a channel object with a channel interop object. If you are trying to update a property for this channel you should change the property directly. Take this to #devel-redux";if(p())throw new Error(r);else{TS.error(r);return}}var i=n(t.id);if(i)TS.redux.channels.removeEntity(i);TS.redux.channels.addEntity(t)},updateMutedChannels:function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];var r=_.reduce(t,function(e,t){e[t]=true;return e},{});TS.redux.dispatch(TS.interop.redux.models.channelsMeta.mutedChannels.setMutedChannels(r))},getMutedChannelsAsArray:function e(){return _.reduce(d(),function(e,t,r){e.push(r);return e},[])},setMutedChannelById:function e(t,r){if(!t||_.isUndefined(r))return;var n={id:t,muted:r};TS.redux.dispatch(TS.interop.redux.models.channelsMeta.mutedChannels.setMutedChannel(n))},isChannelMutedById:function e(r){if(!r)return false;return t(r)},getEntityById:function e(t){var r=n(t);return TS.redux.channels.interop.maybeWrapEntity(r)},getChannelById:function e(t){var r=TS.redux.channels.getEntityById(t);if(r&&r.is_channel)return r;return null},getChannelByName:function e(t){var r=i(t);var n=TS.redux.channels.getEntityById(r);if(n&&n.is_channel)return n;return null},getGroupById:function e(t){var r=TS.redux.channels.getEntityById(t);if(r&&r.is_group&&!r.is_mpim)return r;return null},getGroupByName:function e(t){var r=i(t);var n=TS.redux.channels.getEntityById(r);if(n&&n.is_group&&!n.is_mpim)return n;return null},getMpimById:function e(t){var r=TS.redux.channels.getEntityById(t);if(r&&r.is_group&&r.is_mpim)return r;return null},getMpimByName:function e(t){var r=a(t);var n=TS.redux.channels.getEntityById(r);if(n&&n.is_group&&n.is_mpim)return n;return null},getImById:function t(r){var n=TS.redux.channels.getEntityById(r);if(e(n))return n;return null},getImByMemberId:function t(r){var n=s(r);var i=TS.redux.channels.getEntityById(n);if(e(i))return i;return null},test:function e(){var t={};return t}});var e;var t=TS.redux.bindSelectorToStore("TS.interop.redux.models.channelsMeta.mutedChannels.isChannelMutedById");var r=TS.redux.bindSelectorToStore("TS.interop.redux.models.channels.getAllChannels");var n=TS.redux.bindSelectorToStore("TS.interop.redux.models.channels.getChannelById");var i=TS.redux.bindSelectorToStore("TS.interop.redux.models.channelsMeta.channelNamesToIds.getChannelOrGroupIdByName");var a=TS.redux.bindSelectorToStore("TS.interop.redux.models.channelsMeta.channelNamesToIds.getMpimIdByName");var s=TS.redux.bindSelectorToStore("TS.interop.redux.models.channelsMeta.channelNamesToIds.getImIdByMemberId");var o=TS.redux.bindSelectorToStore("TS.interop.redux.models.channelsMeta.needsApiMarking.getAllIdsNeedingMarking");var l=TS.redux.bindSelectorToStore("TS.interop.redux.models.channelsMeta.needsApiMarking.getAllMutedIdsNeedingMarking");var u=TS.redux.bindSelectorToStore("TS.interop.redux.models.channelsMeta.needsApiMarking.getAllUnmutedIdsNeedingMarking");var d=TS.redux.bindSelectorToStore("TS.interop.redux.models.channelsMeta.mutedChannels.getMutedChannels");var c;var m={};var f={channels:void 0,groups:void 0,mpims:void 0,ims:void 0};var p=function e(){return TS.boot_data&&("dev"===TS.boot_data.version_ts||"local_js"===TS.boot_data.version_ts)};var h=function t(n){var i=r();var a;switch(n){case"channels":a=function e(t){return t.is_channel};break;case"groups":a=function e(t){return t.is_group&&!t.is_mpim};break;case"ims":a=e;break;case"mpims":a=function e(t){return t.is_group&&t.is_mpim}}if(i===c&&m[n])return m[n];if(i!==c){c=i;m={}}m[n]=_.filter(i,a);m[n]=_.map(m[n],TS.redux.channels.interop.maybeWrapEntity);if(!f[n])f[n]=_.defer(function(){delete m[n];delete f[n];c=null});return m[n]}})()},4753:function(e,t){(function(){TS.registerModule("redux.channels.interop",{maybeWrapEntity:function e(t){if(!t||!t.id)return t;return T(t.id)},getSetCounts:function e(){return _.chain(t).map(function(e,t){return{key:t,value:e}}).sortBy("value").reverse().value()},getReduxSetCounts:function e(){return _.chain(r).map(function(e,t){return{key:t,value:e}}).sortBy("value").reverse().value()},test:function e(){var t={};return t}});var e=TS.redux.bindSelectorToStore("TS.interop.redux.models.channels.getChannelById");var t={};var r={};var n={};var i=function e(){var t=window.Proxy&&S();return t};var a=function e(t,r,n){if(!t||!r)return;var i={id:t};i[r]=n;TS.redux.dispatch(TS.interop.redux.models.channels.updateOneKeyForChannel(i))};var s=["_show_in_list_even_though_no_unreads","deleted","has_draft","is_archived","is_channel","is_ext_shared","is_group","is_im","is_member","is_mpim","is_open","is_org_shared","is_pending_ext_shared","is_self_im","is_shared","is_slackbot_im","is_starred","last_read","members","priority","unread_cnt","unread_highlight_cnt"];var o=["_display_name","_archive_msgs","_checking_at_channel_status","_consistency_has_been_checked","_consistency_is_being_checked","_delayed_fetch_timer","_did_defer_initial_msg_history","_display_name_lc","_display_name_truncated","_has_auto_scrolled","_history_fetched_since_last_connect","_i18n_ns_history","_i18n_ns","_internal_name","_jumper_previous_name_match","_latest_via_users_counts","_mark_most_recent_read_timer","_marked_reason","_members","_mention_count_display_via_users_counts","_name_lc","_needs_unread_recalc","_prev_last_read","_score","_temp_last_read","_temp_unread_cnt","_users_counts_info","active_members","can_thread","create_channel","created","creator","date_created","enterprise_id","fetched_history_after_scrollback_time","has_fetched_history_after_scrollback","has_pins","history_changed","history_fetch_failed","history_fetch_retries","history_is_being_fetched","id","inherit","inviter","is_default","is_general","is_global_shared","is_limited","is_moved","is_non_threadable","is_org_default","is_org_mandatory","is_private","is_read_only","is_thread_only","last_made_active","last_msg_input","latest","length","member","msgs","name_normalized","name","needs_created_message","needs_invited_message","needs_joined_message","never_needs_joined_msg","note","num_members","old_name","oldest_msg_ts","opened_this_session","org","parent_group","pending_shared","pinned_items","pinned_items_count","presence","previous_names","purpose","scroll_top","shared_team_ids","shares","domain","tooltip","topic","unlinked","unread_count_display","unread_count","unread_highlight_cnt_in_client","unread_highlights","unreads","user","was_archived_this_session","is_cross_workspace"];var l=["_get","_is_interop_channel_object","_set","_setWithReduxAction","attributes","children","disabled","is_broadcast_keyword","is_divider","is_emoji","is_usergroup","is_view","nodeType","old_name","props_to_define","selector","then","title","toObject","toJSON","window"];var u=_.reduce(s,function(e,t){e[t]=true;return e},{});var d=_.reduce(o,function(e,t){e[t]=true;return e},{});var c=_.reduce(l,function(e,t){e[t]=true;return e},{});var m={};var f=function t(r,i){if(!d[i]&&!u[i]&&!c[i]&&_.isString(i)){TS.console.logStackTrace("Accessing an unknown key "+i+" on a model object");if(!n[i])n[i]=true;if(S())TS.console.error('Dev only warning: Trying to get an unknown field "'+i+'" from a model object. If this is not a typo and you are relying on this property, please try and store this data outside of the model ob, or add to the model_ob_keys_as_map whitelist in TS.redux.channels.interop.source.js. Questions? Feel free to ask in #devel-redux');var a=e(r.id);return a&&a[i]}return r[i]};var p=function r(i,a,s){if(_.isString(a))t[a]=(t[a]||0)+1;if(!d[a]&&!u[a]&&_.isString(a)){TS.console.logStackTrace("Setting an unknown key "+a+" on a model object");if(!n[a])n[a]=true;if(S())throw new Error('Dev only warning: Trying to set an unknown field "'+a+'" on a model object. If this is not a typo and you are relying on this property, please try and store this data outside of the model ob, or add to the model_ob_keys_as_map whitelist in TS.redux.channels.interop.source.js. Questions? Feel free to ask in #devel-redux');var o=e(i.id);if(o)o[a]=s}i[a]=s;return true};var h=function e(t){this.id=t;Object.defineProperties(this,this.props_to_define)};var g={};_.without(o,"id").forEach(function(e){g[e]={enumerable:true,get:function t(){return this._get(e)},set:function t(r){return this._set(e,r)}};s.forEach(function(e){g[e]={enumerable:true,get:function t(){return this._get(e)},set:function t(r){return this._setWithReduxAction(e,r)}}})});h.prototype.props_to_define=g;h.prototype._is_interop_channel_object=true;h.prototype._get=function(t){var r=e(this.id);if(r)return r[t]};h.prototype._set=function(t,r){var n=e(this.id);if(n)n[t]=r;return true};h.prototype._setWithReduxAction=function(t,n){var i=e(this.id);if(i)if(i[t]!==n){a(this.id,t,n);r[t]=(r[t]||0)+1}return true};var S=function e(){return TS.boot_data&&("dev"===TS.boot_data.version_ts||"local_js"===TS.boot_data.version_ts)};var T=function e(t){if(!t)throw new Error("Must pass in a valid id to _createWrappedEntityById");var r;var n=i();if(m[t])r=m[t];else{r=new h(t);if(n)r=new window.Proxy(r,{get:function e(t,r){return f(t,r)},set:function e(t,r,n){return p(t,r,n)}});m[t]=r}return r}})()},4754:function(e,t){(function(){TS.registerModule("redux.presence",{onStart:function e(){n()},getPresenceByMemberId:function t(r){return e(r)},toggleUserPresence:function e(){return TS.redux.dispatch(TS.interop.redux.features.presence.toggleUserPresence())},updatePresenceForMember:function e(t){if(!t||!t.id)return;TS.redux.dispatch(TS.interop.redux.features.presence.updatePresence({memberId:t.id,presence:t.presence}))},addToBulkUpsertPayload:function e(r){if(!r)return;var n=r.id;var i=r.presence;t.push({id:n,presence:i})},test:function e(){var t={};return t}});var e=TS.redux.bindSelectorToStore("TS.interop.redux.features.presence.getPresenceByMemberId");var t=[];var r=function e(){if(t.length){TS.redux.dispatch(TS.interop.redux.features.presence.bulkUpdatePresence(t));t=[]}};var n=function e(){TS.members.presence_changed_sig.add(TS.redux.presence.updatePresenceForMember);TS.members.batch_upserted_sig.add(r)}})()},4755:function(e,t){(function(){TS.registerModule("redux.custom_status",{onStart:function e(){r()},updateStatusForMember:function e(t){if(!(t&&t.id&&t.profile))return;TS.redux.dispatch(TS.interop.redux.features.customStatus.updateStatus({memberId:t.id,status:{emoji:t.profile.status_emoji,text:t.profile.status_text}}))},addToBulkUpsertPayload:function t(r){e.push(r)},test:function e(){var t={};return t}});var e=[];var t=function t(){if(e.length){TS.redux.dispatch(TS.interop.redux.features.customStatus.bulkUpdateStatus(e));e=[]}};var r=function e(){TS.members.changed_current_status_sig.add(TS.redux.custom_status.updateStatusForMember);TS.members.batch_upserted_sig.add(t)}})()},4756:function(e,t){(function(){TS.registerModule("redux.dnd",{isMemberInDndById:function t(r){return e(r)},getDndScheduleByMemberId:function e(r){return t(r)},getAllDndSchedules:function e(){return n()},getSnoozeScheduleForCurrentUser:function e(){return r()},updateDndForMember:function e(t,r){if(!t)return;TS.redux.dispatch(TS.interop.redux.features.dnd.updateDnd({memberId:t,isInDnd:r}))},updateDndScheduleForMembers:function e(t){if(!t||!_.isArray(t)||!t.length)return;TS.redux.dispatch(TS.interop.redux.features.dnd.updateDndSchedules(t))},updateDndScheduleForMember:function e(t,r,n){if(!t)return;TS.redux.dispatch(TS.interop.redux.features.dnd.updateDndSchedule({memberId:t,nextDndStartTs:r,nextDndEndTs:n}))},removeDndScheduleForMember:function e(t){if(!t||!_.isArray(t)||!t.length)return;TS.redux.dispatch(TS.interop.redux.features.dnd.removeDndSchedule({memberIds:t}))},updateSnoozeScheduleForCurrentMember:function e(t,r){TS.redux.dispatch(TS.interop.redux.features.dnd.updateSnooze({snoozeEnabled:t,snoozeEndTs:r}))},test:function e(){var t={};return t}});var e=TS.redux.bindSelectorToStore("TS.interop.redux.features.dnd.getDndByMemberId");var t=TS.redux.bindSelectorToStore("TS.interop.redux.features.dnd.getDndScheduleByMemberId");var r=TS.redux.bindSelectorToStore("TS.interop.redux.features.dnd.getSnoozeScheduleForCurrentUser");var n=TS.redux.bindSelectorToStore("TS.interop.redux.features.dnd.getAllDndSchedules")})()},4757:function(e,t){(function(){TS.registerModule("redux.enterprise",{setEnterprise:function e(t){if(!t||!t.id)return;TS.redux.dispatch(TS.interop.redux.models.enterprise.setEnterprise(t))},getEnterprise:function e(){if(!TS.interop.redux.models.enterprise.getEnterprise)return null;return TS.interop.redux.models.enterprise.getEnterprise(TS.redux.getState())},getEnterpriseOrgName:function e(){if(!TS.interop.redux.models.enterprise.getEnterpriseOrgName)return null;return TS.interop.redux.models.enterprise.getEnterpriseOrgName(TS.redux.getState())},updateEnterpriseOrgName:function e(t){if(!TS.interop.redux.models.enterprise.updateEnterpriseName)return null;return TS.redux.dispatch(TS.interop.redux.models.enterprise.updateEnterpriseName(t))},getEnterpriseId:function e(){if(!TS.interop.redux.models.enterprise.getEnterpriseId)return null;return TS.interop.redux.models.enterprise.getEnterpriseId(TS.redux.getState())},getEnterpriseOrgInfo:function e(){if(!TS.interop.redux.models.enterprise.getEnterpriseOrgInfo)return Promise.reject();return TS.redux.dispatch(TS.interop.redux.models.enterprise.getEnterpriseOrgInfo())}})})()},4758:function(e,t){(function(){TS.registerModule("redux.members",{onStart:function e(){if(TS.boot_data.no_login)return;if(TS.useReduxMembers()){d();Object.defineProperty(TS.model,"members",{get:function e(){return TS.redux.members.getAllMembers()},set:function e(){if(TS.boot_data.feature_tinyspeck)TS.warn("TS.redux.members: Set TS.model.members");return false}});Object.defineProperty(TS.model,"user",{get:function e(){return n()},set:function e(t){TS.redux.members.addMember(t)}})}},getMemberById:function e(t){var n=r(t);if(!n||n.id!==t)return null;return n},getMemberByEmail:function e(r){var n=t(r);if(!n||!n.profile||n.profile.email!==r)return null;return n},getAllMembers:function t(){var r=e();if(r===i)return a;a=_.values(r);i=r;return a},addMember:function e(t){if(!t)return;TS.redux.dispatch(TS.interop.redux.models.members.addMember(t))},addToBulkUpsertPayload:function e(t){s.push(t)},removeMember:function e(t){if(!t)return;TS.redux.dispatch(TS.interop.redux.models.members.removeMember(t))},removeMembers:function e(t){if(!t)return;TS.redux.dispatch(TS.interop.redux.models.members.bulkRemoveMembers(t))},logStats:function e(){var t=_(o).keys().union(_.keys(l)).value();var r={};_.forEach(t,function(e){r[e]={gets:o[e]||0,sets:l[e]||0}});TS.console.table(r)},test:function e(){var t={_addSignalListeners:d};Object.defineProperty(t,"_bulk_upsert_payload",{get:function e(){return s},set:function e(t){s=t}});return t}});var e=TS.redux.bindSelectorToStore("TS.interop.redux.models.members.getAllMembers");var t=TS.redux.bindSelectorToStore("TS.interop.redux.models.members.getMemberByEmail");var r=TS.redux.bindSelectorToStore("TS.interop.redux.models.members.getMemberById");var n=TS.redux.bindSelectorToStore("TS.interop.redux.models.members.getCurrentMember");var i;var a;var s=[];var o={};var l={};var u=function e(){if(s.length){TS.redux.dispatch(TS.interop.redux.models.members.bulkAddMembers(s));s=[]}};var d=function e(){TS.members.batch_upserted_sig.add(u)}})()},4759:function(e,t){var r="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};(function(){TS.registerModule("redux.bots",{onStart:function e(){if(TS.useReduxMembers()){o();Object.defineProperty(TS.model,"bots",{get:function e(){return TS.redux.bots.getAllBots()},set:function e(){if(TS.boot_data.feature_tinyspeck)TS.warn("TS.redux.bots: Set TS.model.bots");return false}})}},getBotById:function e(r){var n=t(r);if(!n||n.id!==r)return null;return c(n)},getAllBots:function t(){return _.values(e())},addBot:function e(t){if(!t)return;TS.redux.dispatch(TS.interop.redux.models.bots.addBot(t))},addToBulkUpsertPayload:function e(t){a.push(t)},logStats:function e(){var t=_(n).keys().union(_.keys(i)).value();var r={};_.forEach(t,function(e){r[e]={gets:n[e]||0,sets:i[e]||0}});TS.console.table(r)},test:function e(){var t={_addSignalListeners:o};Object.defineProperty(t,"_bulk_upsert_payload",{get:function e(){return a},set:function e(t){a=t}});return t}});var e=TS.redux.bindSelectorToStore("TS.interop.redux.models.bots.getAllBots");var t=TS.redux.bindSelectorToStore("TS.interop.redux.models.bots.getBotById");var n={};var i={};var a=[];var s=function e(){if(a.length){TS.redux.dispatch(TS.interop.redux.models.bots.bulkAddBots(a));a=[]}};var o=function e(){TS.bots.batch_upserted_sig.add(s)};var l=function e(){return TS.boot_data&&("dev"===TS.boot_data.version_ts||"local_js"===TS.boot_data.version_ts)};var u=function e(t,a){if("symbol"!==("undefined"===typeof a?"undefined":r(a))){if(!_.isNumber(n[a])){n[a]=0;i[a]=0}n[a]+=1}return t[a]};var d=function e(t,a,s){if("symbol"!==("undefined"===typeof a?"undefined":r(a))){if(!_.isNumber(i[a])){n[a]=0;i[a]=0}i[a]+=1}t[a]=s;return true};var c=function e(t){if(!window.Proxy||!l())return t;return new window.Proxy(t,{get:function e(t,r){return u(t,r)},set:function e(t,r,n){return d(t,r,n)}})}})()},4760:function(e,t){var r="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};(function(){TS.registerModule("redux.user_groups",{onStart:function e(){if(TS.useReduxMembers()){u();Object.defineProperty(TS.model,"user_groups",{get:function e(){return TS.redux.user_groups.getAllUserGroups()},set:function e(){TS.error("TS.redux.user_groups: trying to set TS.model.user_groups???");return false}})}},getUserGroupById:function e(r){var n=t(r);if(!n||n.id!==r)return null;return f(n)},getAllUserGroups:function t(){var r=e();if(r===n)return i;i=_.values(r).sort(TS.i18n.mappedSorter("_name_lc"));n=r;return i},addUserGroup:function e(t){if(!t)return;TS.redux.dispatch(TS.interop.redux.models.userGroups.bulkAddGroups([t]))},addToBulkUpsertPayload:function e(t){o.push(t)},logStats:function e(){var t=_(a).keys().union(_.keys(s)).value();var r={};_.forEach(t,function(e){r[e]={gets:a[e]||0,sets:s[e]||0}});TS.console.table(r)},test:function e(){var t={_addSignalListeners:u};Object.defineProperty(t,"_bulk_upsert_payload",{get:function e(){return o},set:function e(t){o=t}});return t}});var e=TS.redux.bindSelectorToStore("TS.interop.redux.models.userGroups.getAllUserGroups");var t=TS.redux.bindSelectorToStore("TS.interop.redux.models.userGroups.getUserGroupById");var n;var i;var a={};var s={};var o=[];var l=function e(){if(o.length){TS.redux.dispatch(TS.interop.redux.models.userGroups.bulkAddGroups(o));o=[]}};var u=function e(){TS.user_groups.batch_upserted_sig.add(l)};var d=function e(){return TS.boot_data&&("dev"===TS.boot_data.version_ts||"local_js"===TS.boot_data.version_ts)};var c=function e(t,n){if("symbol"!==("undefined"===typeof n?"undefined":r(n))){if(!_.isNumber(a[n])){a[n]=0;s[n]=0}a[n]+=1}return t[n]};var m=function e(t,n,i){if("symbol"!==("undefined"===typeof n?"undefined":r(n))){if(!_.isNumber(s[n])){a[n]=0;s[n]=0}s[n]+=1}t[n]=i;return true};var f=function e(t){if(!window.Proxy||!d())return t;return new window.Proxy(t,{get:function e(t,r){return c(t,r)},set:function e(t,r,n){return m(t,r,n)}})}})()},4761:function(e,t){(function(){TS.registerModule("redux.member_types",{onStart:function e(){r()},updateMemberTypeForMember:function e(t){if(!t||!t.id)return;TS.redux.dispatch(TS.interop.redux.models.memberTypesById.updateMemberType(t))},addToBulkUpdatePayload:function t(r){e.push(r)},removeMemberTypeForMember:function e(t){if(!t)return;TS.redux.dispatch(TS.interop.redux.models.memberTypesById.removeMemberType(t))},bulkRemoveMemberTypesForMembers:function e(t){if(!t)return;TS.redux.dispatch(TS.interop.redux.models.memberTypesById.bulkRemoveMemberTypes(t))},test:function e(){var t={};return t}});var e=[];var t=function t(){if(e.length){TS.redux.dispatch(TS.interop.redux.models.memberTypesById.bulkUpdateMemberType(e));e=[]}};var r=function e(){TS.members.changed_account_type_sig.add(TS.redux.member_types.updateMemberTypeForMember);TS.members.batch_upserted_sig.add(t)}})()},4762:function(e,t){(function(){TS.registerModule("redux.files",{onStart:function e(){if(TS.useReduxFiles())Object.defineProperty(TS.model,"files",{get:function e(){return TS.redux.files.getAllFiles()},set:function e(){if(TS.boot_data.feature_tinyspeck)TS.warn("TS.redux.files: Set TS.model.files");return false}})},getFileById:function e(r){var n=t(r);if(!n||n.id!==r)return null;return n},getFileByProp:function e(t,r){var n=TS.redux.files.getAllFiles();return _.find(n,function(e){return e[t]===r})},getAllFiles:function t(){var i=e();if(i===r)return n;n=_.values(i);r=i;return n},upsertFile:function e(t){if(!t)return;TS.redux.dispatch(TS.interop.redux.models.files.upsertFile(t))},logStats:function e(){var t=_(i).keys().union(_.keys(a)).value();var r={};_.forEach(t,function(e){r[e]={gets:i[e]||0,sets:a[e]||0}});TS.console.table(r)}});var e=TS.redux.bindSelectorToStore("TS.interop.redux.models.files.getAllFiles");var t=TS.redux.bindSelectorToStore("TS.interop.redux.models.files.getFileById");var r;var n;var i={};var a={}})()},4763:function(e,t){(function(){TS.registerModule("redux.prefs",{setUserPrefs:function e(t){TS.redux.dispatch(TS.interop.redux.features.prefs.setUserPrefs(t))},setTeamPrefs:function e(t){TS.redux.dispatch(TS.interop.redux.features.prefs.setTeamPrefs(t))},setUserPref:function e(t,r){if(TS.redux.prefs.getUserPref(t)===r)return;TS.redux.dispatch(TS.interop.redux.features.prefs.setUserPref({pref:t,value:r}))},setMultipleUserPrefs:function e(t){TS.redux.dispatch(TS.interop.redux.features.prefs.setMultipleUserPrefs(t))},setTeamPref:function e(t,r){if(TS.redux.prefs.getTeamPref(t)===r)return;TS.redux.dispatch(TS.interop.redux.features.prefs.setTeamPref({pref:t,value:r}))},setChannelNotificationOverrideAndCallApi:function e(t,r,n){TS.redux.dispatch(TS.interop.redux.features.prefs.setChannelNotificationOverrideAndCallApi({name:t,value:r,channelId:n}))},getUserPref:function t(r){return e(r)},getTeamPref:function e(r){return t(r)},test:function e(){var t={};return t}});var e=TS.redux.bindSelectorToStore("TS.interop.redux.features.prefs.getUserPref");var t=TS.redux.bindSelectorToStore("TS.interop.redux.features.prefs.getTeamPref")})()},4764:function(e,t){(function(){TS.registerModule("redux.reactions",{updateReaction:function e(t,r){if(!t)return;TS.redux.dispatch(TS.interop.redux.models.reactions.updateReaction({key:t,reactions:r}))},addToBulkUpsertPayload:function r(n,i){if(!n)return;if(!e)return;t.push({key:n,reactions:i})},isInBulkUpsertMode:function t(){return e},startBulkUpsert:function t(){if(e)return false;e=true;return true},finishBulkUpsert:function t(){if(!e)return false;r();e=false;return true}});var e=false;var t=[];var r=function e(){if(t.length){TS.redux.dispatch(TS.interop.redux.models.reactions.bulkUpdateReaction(t));t=[]}}})()},4765:function(e,t){(function(){TS.registerModule("redux.messages",{addMessages:function e(t,r,n){var i=_.some(t,function(e){var t=TS.redux.messages.getMessageByTimestamp(e.channel,e.ts);return!t});TS.redux.dispatch(TS.interop.redux.models.messages.addMessages(t));if(r){var a=_.reject(t,TS.utility.msgs.isMsgHidden);if(_.isEmpty(a))return i;var s=a&&a[0]&&a[0].channel;var o=_.map(a,"ts");var l={};if(n)l={oldest:_.min(o),hasMore:false};TS.redux.dispatch(TS.interop.redux.models.channelHistory.addTimestamps(_.assign({channelId:s,timestamps:o},l)))}return i},addMessage:function e(t,r){if(!t||!t.channel||!t.ts)return;var n=TS.redux.messages.getMessageByTimestamp(t.channel,t.ts);TS.redux.dispatch(TS.interop.redux.models.messages.addMessages([t]));if(!TS.utility.msgs.isMsgHidden(t)){var i={channelId:t.channel,timestamps:[t.ts]};if(r){i.oldest=t.ts;i.hasMore=false;i.append=true}TS.redux.dispatch(TS.interop.redux.models.channelHistory.addTimestamps(i))}return!n},replaceMessage:function e(t){if(!t||!t.channel||!t.ts)return;TS.redux.messages.addMessage(t)},removeMessage:function e(t,r){if(!t||!t.channel||!t.ts)return;TS.redux.dispatch(TS.interop.redux.features.messagePane.maybeAnimateDeleteMessage(t,r))},channelHistoryChanged:function e(t){TS.redux.dispatch(TS.interop.redux.models.channelHistory.removeAllTimestamps({channelId:t}))},getMessageByTimestamp:function e(t,r){if(!TS.interop.redux.models.messages.getMessageByTimestamp)return null;return TS.interop.redux.models.messages.getMessageByTimestamp(TS.redux.getState(),t,r)},getMessagesInChannel:function e(t,r,n){if(!t)return[];if(void 0===n)n=true;var i=TS.interop.redux.models.channelHistory.getTimestampsByChannelId(TS.redux.getState(),t,r);var a=TS.interop.redux.models.messages.getMessagesByChannelId(TS.redux.getState(),t);var s=i&&i.timestamps||[];var o=_(s).map(function(e){return a[e]}).compact().value();o=TS.interop.messages.computeRollups(o).messages;var l=_(o).reject(TS.utility.msgs.isMsgHidden).sortBy("ts");return n?l.reverse().value():l.value()},getRecentMessagesInChannel:function e(t,r){return TS.redux.messages.getMessagesInChannel(t,null,r)},getExpandablesInChannel:function e(t){var r=TS.redux.messages.getMessagesInChannel(t,null,false);return _(r).map(function(e){var t=e.ts;if(e.file)return TS.interop.messages.getExpandableKey("file",t,{id:e.file});if("sh_room_shared"===e.subtype||"sh_room_created"===e.subtype)return TS.interop.messages.getExpandableKey("call",t,{id:e._room_id});if(e.attachments)return _.map(e.attachments,function(e){return TS.interop.messages.getExpandableKey("attachment",t,{imageUrl:e.image_url,audioHtml:e.audio_html,videoHtml:e.video_html,thumbUrl:e.thumb_url})});return null}).flatten().compact().value()},getMessagesByProp:function e(t,r){var n=TS.interop.redux.models.messages.getMessagesByProps(TS.redux.getState(),t,r);return _(n).sortBy("ts").reverse().value()},getMessagesByChannelId:function e(t,r){if(void 0===r)r=true;var n=TS.interop.redux.models.messages.getMessagesByChannelId(TS.redux.getState(),t);return r?_(n).sortBy("ts").reverse().value():_(n).sortBy("ts").value()},recordDeletedMessage:function e(t,r){TS.redux.dispatch(TS.interop.redux.features.deletedMessages.recordMessageDeleted({channelId:t,ts:r}))}})})()},4766:function(e,t){(function(){TS.registerModule("redux.notifications",{getCalculatedDesktopNotifySetting:function t(r){return e(r)},getCalculatedMobileNotifySetting:function e(r){return t(r)},getDefaultDesktopNotifySetting:function e(t){return r(t)},getDefaultMobileNotifySetting:function e(t){return n(t)},getGlobalDesktopNotifySetting:function e(){return i("global_desktop")},getGlobalMobileNotifySetting:function e(){return i("global_mobile")},getGlobalHighlightWords:function e(){return i("global_keywords")},getDesktopNotificationSoundPref:function e(){return i("desktop_sound")},getNotificationPushIdleWaitTimeInMinutes:function e(){return i("push_idle_wait")},getThreadsEverythingNotificationPref:function e(){return i("threads_everything")},getNoTextInNotificationsPref:function e(){return i("no_text_in_notifications")},getAllNotificationOverrides:function e(){return a()},getNotificationsChannelPref:function e(t,r){return s(t,r)}});var e=TS.redux.bindSelectorToStore("TS.interop.notifications.getCalculatedDesktopNotifySetting");var t=TS.redux.bindSelectorToStore("TS.interop.notifications.getCalculatedMobileNotifySetting");var r=TS.redux.bindSelectorToStore("TS.interop.notifications.getDefaultDesktopNotifySetting");var n=TS.redux.bindSelectorToStore("TS.interop.notifications.getDefaultMobileNotifySetting");var i=TS.redux.bindSelectorToStore("TS.interop.redux.features.prefs.getNotificationsGlobalPref");var a=TS.redux.bindSelectorToStore("TS.interop.redux.features.prefs.getAllNotificationOverrides");var s=TS.redux.bindSelectorToStore("TS.interop.redux.features.prefs.getNotificationsChannelPref")})()},4767:function(e,t){(function(){TS.registerModule("redux.teams",{onStart:function e(){Object.defineProperty(TS.model,"team",{get:function e(){return TS.redux.teams.getCurrentTeam()},set:function e(){TS.error("TS.redux.teams: trying to set TS.model.team???");return false}})},addTeam:function e(t){if(!t||!t.id)return;TS.redux.dispatch(TS.interop.redux.models.teams.addTeam(t))},removeTeam:function e(t){if(!t||!t.id)return;TS.redux.dispatch(TS.interop.redux.models.teams.removeTeam(t))},getTeamById:function e(t){if(!TS.interop.redux.models.teams.getTeamById)return null;return TS.interop.redux.models.teams.getTeamById(TS.redux.getState(),t)},getAllTeams:function e(){if(!TS.interop.redux.models.teams.getAllTeams)return null;return TS.interop.redux.models.teams.getAllTeams(TS.redux.getState())},getTeamByEnterpriseId:function e(t){if(!TS.interop.redux.models.teams.getTeamByEnterpriseId)return null;return TS.interop.redux.models.teams.getTeamByEnterpriseId(TS.redux.getState(),t)},getTeamByDomain:function e(t){if(!TS.interop.redux.models.teams.getTeamByDomain)return null;return TS.interop.redux.models.teams.getTeamByDomain(TS.redux.getState(),t)},getCurrentTeam:function e(){if(!TS.interop.redux.models.teams.getCurrentTeam)return null;return TS.interop.redux.models.teams.getCurrentTeam(TS.redux.getState())},ensureEnterpriseTeamIsKnown:function e(t,r){if(!TS.interop.redux.models.teams.ensureEnterpriseTeamIsKnown)return null;return TS.redux.dispatch(TS.interop.redux.models.teams.ensureEnterpriseTeamIsKnown(TS.redux.getState(),{id:t,additionalOptions:r}))}})})()},4768:function(e,t){(function(){TS.registerModule("redux.socket",{connectedSig:new signals.Signal,disconnectedSig:new signals.Signal,provisionallyConnectedSig:new signals.Signal,socketErrorMessageReceivedSig:new signals.Signal,socketMessageReceivedSig:new signals.Signal,troubleConnectingSig:new signals.Signal,waitingForRateLimitSig:new signals.Signal,hasNeverConnected:TS.redux.bindSelectorToStore("TS.interop.redux.features.socket.hasNeverConnected"),isAsleep:TS.redux.bindSelectorToStore("TS.interop.redux.features.socket.isAsleep"),isConnected:TS.redux.bindSelectorToStore("TS.interop.redux.features.socket.isConnected"),isConnecting:TS.redux.bindSelectorToStore("TS.interop.redux.features.socket.isConnecting"),isProvisionallyConnected:TS.redux.bindSelectorToStore("TS.interop.redux.features.socket.isProvisionallyConnected"),isWaitingForConnectivity:TS.redux.bindSelectorToStore("TS.interop.redux.features.socket.isWaitingForConnectivity"),isWaitingForRateLimit:TS.redux.bindSelectorToStore("TS.interop.redux.features.socket.isWaitingForRateLimit"),promiseToHaveOpenWebSocket:TS.redux.bindSelectorToStore("TS.interop.redux.features.socket.promiseToHaveOpenWebSocket")})})()},4769:function(e,t){(function(){TS.registerModule("redux.canvases",{addCanvas:function e(t){TS.redux.dispatch(TS.interop.redux.models.canvases.addCanvas(t))},updateCanvas:function e(t){TS.redux.dispatch(TS.interop.redux.models.canvases.updateCanvas(t))}})})()},4770:function(e,t){(function(){TS.registerModule("channels",{switched_sig:new signals.Signal,joined_sig:new signals.Signal,member_joined_sig:new signals.Signal,left_sig:new signals.Signal,member_left_sig:new signals.Signal,list_fetched_sig:new signals.Signal,history_fetched_sig:new signals.Signal,history_being_fetched_sig:new signals.Signal,message_received_sig:new signals.Signal,message_removed_sig:new signals.Signal,message_changed_sig:new signals.Signal,marked_sig:new signals.Signal,unread_changed_sig:new signals.Signal,unread_highlight_changed_sig:new signals.Signal,topic_changed_sig:new signals.Signal,purpose_changed_sig:new signals.Signal,created_sig:new signals.Signal,deleted_sig:new signals.Signal,renamed_sig:new signals.Signal,archived_sig:new signals.Signal,unarchived_sig:new signals.Signal,msg_not_sent_sig:new signals.Signal,data_retention_changed_sig:new signals.Signal,converted_to_shared_sig:new signals.Signal,unshared_sig:new signals.Signal,shared_teams_updated_sig:new signals.Signal,shared_invite_pending_sig:new signals.Signal,shared_invite_revoked_sig:new signals.Signal,shared_invite_accepted_sig:new signals.Signal,data_updated_sig:new signals.Signal,temp_list_of_removed_channels:{},addMsg:function e(t,r){var n=TS.channels.getChannelById(t);if(!n){if(!TS.channels.temp_list_of_removed_channels[t])TS.error('unknown channel "'+t+'"');return}if(TS.useReactMessages()&&!TS.utility.msgs.isMsgReply(r)){if(!TS.redux.messages.addMessage(r,true))return}else if(!TS.shared.addMsg(n,r))return;var i=!TS.utility.msgs.isTempMsg(r);TS.channels.calcUnreadCnts(n,i);TS.utility.msgs.maybeTruncateMsgs(n);TS.channels.message_received_sig.dispatch(n,r)},calcUnreadCnts:function e(t,r){TS.shared.calcUnreadCnts(t,TS.channels,r)},removeMsg:function e(t,r){var n=TS.channels.getChannelById(t);if(!n){TS.error('unknown channel "'+t+'"');return}if(TS.useReactMessages()&&!TS.utility.msgs.isMsgReply(r))TS.redux.messages.removeMessage(r);else{if(n._archive_msgs)TS.utility.msgs.spliceMsg(n._archive_msgs,r);var i=n.msgs;TS.utility.msgs.spliceMsg(i,r)}TS.channels.message_removed_sig.dispatch(n,r);TS.channels.calcUnreadCnts(n,true)},sendMsg:function e(t,r,n,i){var a;var s=TS.channels.getChannelById(t);if(!s)return false;if(s.is_archived)return false;if(!s.is_member)return false;var o=TS.channels.getGeneralChannel();var l=function e(t,i){if(i){var a={text:t,ephemeral_type:i,slackbot_feels:"sad_surprise"};TS.client.ui.addOrFlashEphemeralBotMsg(a)}else TS.generic_dialog.alert(t).then(function(){if(n)TS.ui.replies.focusReplyInput();else TS.view.focusMessageInput()});if(n){TS.ui.replies.populateReplyInput(r);TS.ui.replies.focusReplyInput()}else{TS.utility.contenteditable.value(TS.client.ui.$msg_input,r);TS.view.focusMessageInput()}};if(s.is_general&&!TS.permissions.members.canPostInGeneral(TS.model.user)){var u=TS.i18n.t("A Workspace Owner has restricted posting to the #*{channel_name}* channel.","channels")({channel_name:s.name});l(u,"general_posting_restricted");return false}var d=TS.format.cleanMsg(r);var _=!!n;var c=TS.model.here_regex.test(d);var m=TS.model.channel_regex.test(d)&&!_||TS.model.group_regex.test(d)&&!_||c;var f=TS.model.everyone_regex.test(d)&&!_||TS.channels.isChannelRequired(s)&&m;if(f){if(!TS.permissions.members.canAtMentionEveryone(s.id)){if(TS.model.user.is_restricted){a="<p>"+TS.i18n.t("Your account is restricted, and you cannot send <b>{everyone}</b> messages.","channels")({everyone:TS.templates.builders.atLabel("everyone")})+"</p>";l(a);return false}if(!TS.permissions.members.canNonAdminsAtMentionEveryoneBySettings(t))a="<p>"+TS.i18n.t("A Workspace Owner has restricted the use of <b>{everyone}</b> messages.","channels")({everyone:TS.templates.builders.atLabel("everyone")})+"</p>";else{a="<p>"+TS.i18n.t("Usage of <b>{everyone}</b> is restricted to Workspace Admins in the large general channel.","channels")({everyone:TS.templates.builders.atLabel("everyone")})+"</p>";TS.metrics.count("stopped_loud_channel_mention")}if(!TS.channels.isChannelRequired(s)&&TS.permissions.members.canAtChannelOrGroup(s.id))a+='<p class="no_bottom_margin">'+TS.i18n.t("If you just want to address everyone in this channel, use <b>{channel}</b> instead.","channels")({channel:TS.templates.builders.atLabel("channel")})+"</p>";l(a);return false}if(!TS.channels.isChannelRequired(s)&&!c){if(!o||!o.is_member){a="<p>"+TS.i18n.t("You cannot send <b>{everyone}</b> messages.","channels")({everyone:TS.templates.builders.atLabel("everyone")})+"</p>";if(TS.permissions.members.canAtChannelOrGroup(t))a+='<p class="no_bottom_margin">'+TS.i18n.t("If you just want to address everyone in this channel, use <b>{channel}</b> instead.","channels")({channel:TS.templates.builders.atLabel("channel")})+"</p>";l(a)}else TS.generic_dialog.start({title:TS.i18n.t("Send {everyone} a message","channels")({everyone:TS.templates.builders.atLabel("everyone")}),body:TS.i18n.t('<p class="bold">Would you like to switch to #{general_channel} and send your message?</p>\t\t\t\t\t\t\t<p class="">Using <b>{everyone}</b> in a message is a way to address your entire workspace, but it must be done in the #{general_channel} channel.</p>\t\t\t\t\t\t\t<p class="no_bottom_margin">If you just want to address everyone in this channel, use <b>{channel}</b> instead.</p>',"channels")({general_channel:o.name,everyone:TS.templates.builders.atLabel("everyone"),channel:TS.templates.builders.atLabel("channel")}),show_cancel_button:true,show_go_button:true,go_button_text:TS.i18n.t("Yes, send it","channels")(),onGo:function e(){TS.channels.displayChannel({id:o.id,and_send_txt:r})},onCancel:function e(){TS.utility.contenteditable.value(TS.client.ui.$msg_input,r);TS.view.focusMessageInput()}});return false}}if(m&&!TS.permissions.members.canAtChannelOrGroup(t)){var p=c?TS.templates.builders.atLabel("here"):TS.templates.builders.atLabel("channel");if(!TS.permissions.members.canNonAdminsAtChannelOrGroupBySettings(t))a="<p>"+TS.i18n.t("A Workspace Owner has restricted the use of <b>{key_word}</b> messages.","channels")({key_word:p})+"</p>";else{a="<p>"+TS.i18n.t("Usage of <b>{key_word}</b> is restricted to Workspace Admins in this large channel.","channels")({key_word:p})+"</p>";TS.metrics.count("stopped_loud_channel_mention")}l(a);return false}if(!_&&TS.ui.needToShowAtChannelWarning(t,r)){TS.ui.at_channel_warning_dialog.startInMessagePane(t,r,TS.channels);return false}return TS.shared.sendMsg(t,r,TS.channels,n,i)},onSendMsg:function e(t,r){var n=_.get(r,"SENT_MSG.channel");var i=TS.channels.getChannelById(n);if(!i){TS.error("unknown channel? "+n);return}TS.shared.onSendMsg(t,r,i,TS.channels)},displayChannel:function e(t){var r=_.defaults({},t,{from_history:false,replace_history_state:false});var i=r.id;if(!i){TS.error("no channel id supplied");return}var a=r.path;var s=r.and_send_txt;var o=r.from_history;var l=r.replace_history_state;if(TS.isPartiallyBooted()&&i!==TS.model.initial_cid){TS.warn("Can't switch model objects during incremental boot; this is a programming error");TS.sounds.play("beep");return}TS.metrics.mark("start_channel_change_"+i);var u=TS.channels.getChannelById(i);if(!u){TS.error('channel "'+i+'" unknown');return}TS.utility.msgs.maybeClearPrevLastRead();TS.utility.msgs.maybeClearPrevLastRead(u);TS.shared.maybeClearHasAutoScrolled();if(i===TS.model.active_channel_id&&!l&&!TS.client.activeChannelIsHidden()){TS.warn('channel "'+i+'" already displayed');if(s)TS.channels.sendMsg(i,$.trim(s));return}if(TS.has_pri[n])TS.log(n,"displayChannel: "+u.id);if(TS.shared.didDeferMessageHistoryById(u.id))TS.shared.checkInitialMsgHistory(u,TS.channels);if(!u.is_member){if(s){TS.model.requested_channel_joins[i]={and_send_txt:s};TS.channels.joinById(i);return}var d=TS.shared.getActiveModelOb();if(!(d.is_channel&&!d.is_member))TS.client.archives.previous_model_ob=d}var c=l?false:o;var m=TS.client.channelDisplaySwitched({id:i,path:a,replace_history_state:l,no_history_add:c});if(m)TS.channels.switched_sig.dispatch();if(s)TS.channels.sendMsg(i,$.trim(s))},setLastRead:function e(t,r,n){var a;if(TS.useReactMessages()){a=TS.model.last_reads_set_by_client[t.id+"_"+r];delete TS.model.last_reads_set_by_client[t.id+"_"+r]}if(t.last_read===r)return false;if(r.indexOf(TS.utility.date.fake_ts_unique_padder)>-1){TS.error("bad ts: "+r);return false}var s=t.id+". last_read = "+t.last_read+" -> "+r+", reason: "+(n||"unspecified");if(t.last_read>r){if(!TS.useReactMessages()){a=TS.model.last_reads_set_by_client[t.id+"_"+r];delete TS.model.last_reads_set_by_client[t.id+"_"+r]}if(a){TS.warn("NOT going back in time on channel "+s);return}if(TS.has_pri[i])TS.log(i,"going back in time on channel "+s,TS.console.getStackTrace());TS.utility.msgs.maybeClearPrevLastRead(t);TS.utility.msgs.setPrevLastRead(t,r)}else{if(TS.has_pri[i])TS.log(i,"TS.channels.setLastRead: "+s);TS.utility.msgs.maybeClearPrevLastRead(t);TS.utility.msgs.maybeSetPrevLastRead(t,r)}t.last_read=r;if(n)t._marked_reason=n;TS.channels.marked_sig.dispatch(t);TS.utility.msgs.maybeClearUsersCountsInfo(t);TS.channels.calcUnreadCnts(t);return true},markMostRecentReadMsg:function e(t,r,n){if(!t){TS.error("channel unknown");return}if(TS.useReactMessages()){TS.redux.dispatch(TS.interop.redux.models.channels.markMostRecentMsgRead({channelId:t.id,reason:r}));return}if((!t.msgs||!t.msgs.length)&&!n)return;var i=TS.utility.msgs.getMostRecentValidTs(t);if(!i){if(t.is_member&&(t.msgs&&t.msgs.length||!t._latest_via_users_counts))TS.warn('no valid tses for channel "'+t.id+'"???');return}TS.channels.markReadMsg(t.id,i,r)},markReadMsg:function e(t,r,n){var i=TS.channels.getChannelById(t);if(!i){TS.error('channel "'+t+'" unknown');return}if(i.last_read===r)return;if(TS.channels.setLastRead(i,r,n)){i._marked_reason=n;if(i.is_member){var a=true;TS.redux.channels.setMarkingState(i.id,a)}}},onMarked:function e(t,r,n){var i=TS.channels.getChannelById(n.channel);if(!i){TS.error('error: no channel "'+n.channel+'"');return}if(t||r&&("not_in_channel"===r.error||"is_archived"===r.error||"channel_not_found"===r.error));else{var a=true;TS.redux.channels.setMarkingState(i.id,a)}},create:function e(t,r){r=r||{};if(TS.model.user.is_restricted)return Promise.reject(new Error("restricted_action"));if(!t)return Promise.reject(new Error("required"));if(TS.model.created_channels[t])return Promise.reject(new Error("name_taken"));TS.model.created_channels[t]=true;return new Promise(function(e,n){var i=TS.boot_data.feature_conversations_create?"conversations.create":"channels.create";return TS.api.call(i,{name:t,validate:r.validate_name}).then(function(t){TS.channels.onJoin(t.data.ok,t.data,t.args);e(t);return null}).catch(function(e){delete TS.model.created_channels[t];n(e);return null})})},joinById:function e(t,r,n){n=n||{};if(TS.model.user.is_restricted)return Promise.reject(new Error("Account is restricted"));if(!t)return Promise.reject(new Error("No channel id given"));if(!TS.channels.getChannelById(t)){if(TS.model.created_channel_ids[t])return Promise.reject("Already joining");TS.model.created_channel_ids[t]=true}return new Promise(function(e,i){return TS.api.call("conversations.join",{channel:t,_in_background:!!n.in_background}).then(function(t){TS.channels.onJoin(t.data.ok,t.data,t.args);if(r)r(t.data.ok,t.data,t.args);else e(t);return null}).catch(function(e){delete TS.model.created_channel_ids[t];if(r)r(e.data.ok,e.data,e.args);else i(e);return null})})},onJoin:function e(t,r,n){if(!t){if("name_taken"===r.error);else if("is_archived"===r.error)TS.channels.displayChannel({id:TS.channels.getChannelByName(n.name).id});else if("restricted_action"===r.error)TS.generic_dialog.alert(TS.i18n.t("<p>You don’t have permission to create new channels.</p><p>Talk to your Workspace Owner.</p>","channels")());else{TS.error("failed to join channel");alert("failed to join channel")}return}var i;var a;if(r.channel){a=TS.channels.upsertChannel(r.channel);i=r.channel.id}if(!i){TS.error("no channel_id?!!");return}var s="";if(TS.model.requested_channel_joins[i]){s=TS.model.requested_channel_joins[i].and_send_txt;delete TS.model.requested_channel_joins[i]}if(!a){TS.error("no channel?!!");return}if(n._in_background)return;if(!a.needs_created_message&&!a.never_needs_joined_msg)a.needs_joined_message=true;if(TS.client)TS.channels.displayChannel({id:i,and_send_txt:s})},leave:function e(t){var r=TS.channels.getChannelById(t);if(!r)return;if(TS.boot_data.feature_default_shared_channels){var n=TS.permissions.channels.canMemberLeaveChannel(r,TS.model.user);if(!n){TS.generic_dialog.alert(TS.i18n.t("Sorry, you can’t leave <strong>#{channel_name}</strong>!","channels")({channel_name:r.name}));return}}if(TS.channels.isChannelRequired(r)||TS.model.user.is_restricted){TS.generic_dialog.alert(TS.i18n.t("Sorry, you can’t leave <strong>#{channel_name}</strong>!","channels")({channel_name:r.name}));return}else if(r.is_private){TS.generic_dialog.start({title:TS.i18n.t("Leave {channel_name}","channels")({channel_name:r.name}),body:TS.i18n.t("<p>If you leave the private channel, you will no longer be able to see any of its messages. To rejoin the private channel, you will have to be re-invited.</p><p>Are you sure you wish to leave?</p>","channels")(),go_button_text:TS.i18n.t("Yes, leave the private channel","channels")(),onGo:function e(){TS.api.call("conversations.leave",{channel:t}).then(function(e){var t=e.data,r=e.args,n=e.request_id;var i=true;if(TS.channels.onLeave)TS.channels.onLeave(i,t,r,n);return{data:t,args:r,request_id:n}}).catch(function(e){var t=e.data,r=e.args,n=e.request_id;var i=false;if(TS.channels.onLeave)TS.channels.onLeave(i,t,r,n);return{data:t,args:r,request_id:n}})}});return}TS.channels.markMostRecentReadMsg(r,TS.model.marked_reasons.left);TS.client.markLastReadsWithAPI();TS.api.call("conversations.leave",{channel:t}).then(function(e){var t=e.data,r=e.args,n=e.request_id;var i=true;if(TS.channels.onLeave)TS.channels.onLeave(i,t,r,n);return{data:t,args:r,request_id:n}}).catch(function(e){var t=e.data,r=e.args,n=e.request_id;var i=false;if(TS.channels.onLeave)TS.channels.onLeave(i,t,r,n);return{data:t,args:r,request_id:n}})},onLeave:function e(t,r,n){if(!t){TS.error("failed to leave channel");return}var i=TS.channels.getChannelById(n.channel);if(!i){TS.error('error no channel "'+n.channel+'"');return}i.msgs.length=0;if(i.is_limited)i.is_limited=false},closeMpim:function e(t){var r=TS.channels.getChannelById(t);if(!r)return;TS.api.call("conversations.close",{channel:t}).then(function(e){var t=e.data,r=e.args,n=e.request_id;var i=true;if(TS.channels.onMpimClosed)TS.channels.onMpimClosed(i,t,r,n);return{data:t,args:r,request_id:n}}).catch(function(e){var t=e.data,r=e.args,n=e.request_id;var i=false;if(TS.channels.onMpimClosed)TS.channels.onMpimClosed(i,t,r,n);return{data:t,args:r,request_id:n}})},onMpimClosed:function e(t,r,n){if(!t)return;if(r.no_op){var i=TS.channels.getChannelById(n.channel);if(i)TS.mpims.closed_sig.dispatch(i)}},setTopic:function e(t,r){r=TS.format.cleanMsg(r);TS.api.call("conversations.setTopic",{channel:t,topic:r}).then(function(e){var t=e.data,r=e.args,n=e.request_id;var i=true;if(TS.channels.onSetTopic)TS.channels.onSetTopic(i,t,r,n);return{data:t,args:r,request_id:n}}).catch(function(e){var t=e.data,r=e.args,n=e.request_id;var i=false;if(TS.channels.onSetTopic)TS.channels.onSetTopic(i,t,r,n);return{data:t,args:r,request_id:n}})},onSetTopic:function e(t){if(!t)TS.error("failed to set channel topic")},setPurpose:function e(t,r){r=TS.format.cleanMsg(r);TS.api.call("conversations.setPurpose",{channel:t,purpose:r,name_tagging:true}).then(function(e){var t=e.data,r=e.args,n=e.request_id;var i=true;if(TS.channels.onSetPurpose)TS.channels.onSetPurpose(i,t,r,n);return{data:t,args:r,request_id:n}}).catch(function(e){var t=e.data,r=e.args,n=e.request_id;var i=false;if(TS.channels.onSetPurpose)TS.channels.onSetPurpose(i,t,r,n);return{data:t,args:r,request_id:n}})},onSetPurpose:function e(t,r){if(!t){TS.error("failed to set channel purpose");TS.channels.alertSetPurposeError(r.error)}},alertSetPurposeError:function e(t){var r;if("too_long"===t)r=TS.i18n.t("Oooops! That purpose is too long. Please try again with fewer than 250 characters.","channels")();else if("restricted_action"===t||"user_is_restricted"===t)r=TS.i18n.t("Uh oh! You don’t have permission to change the purpose. Talk to your workspace admin.","channels")();else r=TS.i18n.t("Uh oh! Something went wrong with setting the purpose. Please try again.","channels")();TS.generic_dialog.alert(r)},getChannelsFilteredBy:function e(t){return TS.shared.getEntitiesFilteredBy("channels",t)},getChannelById:function e(t){if(!t)return null;return TS.redux.channels.getChannelById(t)},getFirstChannelYouAreIn:function e(){var t=TS.model.channels;if(!t)return null;return _.find(t,"is_member")},getGeneralChannel:function e(){var t=TS.model.channels;if(!t)return null;return _.find(t,"is_general")},isChannelRequired:function e(t){return t.is_general||t.is_org_mandatory},isChannelOrgDefault:function e(t){if(!t)return false;if(TS.channels.isChannelRequired(t)&&TS.shared.isModelObOrgShared(t))return true;if(TS.boot_data.feature_default_shared_channels)return t.is_org_default;return false},getChannelByName:function e(t){return TS.redux.channels.getChannelByName(t)},upsertChannel:function t(r,n){return e(r,n)},removeChannel:function e(t){if(TS.has_pri[a])TS.log(a,'removing channel "'+t.id+'"');TS.channels.temp_list_of_removed_channels[t.id]=true;TS.redux.channels.removeEntity(t);if(TS.client)if(TS.model.active_channel_id===t.id)TS.client.activeChannelDisplayGoneAway();if(t.msgs)t.msgs.length=0;if(t.is_limited)t.is_limited=false;TS.channels.deleted_sig.dispatch(t)},channelRenamed:function e(t){var r=TS.channels.getChannelById(t.id);t.previous_names=[r._name_lc].concat(r.previous_names||[]);var n=TS.channels.upsertChannel(t);n._name_lc=_.toLower(n.name);TS.channels.renamed_sig.dispatch(n)},markScrollTop:function e(t,r){var n=TS.channels.getChannelById(t);if(!n)return false;if(n.scroll_top===r)return false;n.scroll_top=r;return true},maybeLoadScrollBackHistory:function e(t,r){var n=TS.channels.getChannelById(t);if(!n)return false;return TS.shared.maybeLoadScrollBackHistory(n,TS.channels,r)},onHistory:function e(t,r,n){var i=TS.channels.getChannelById(n.channel);if(!i){TS.error('error no channel "'+n.channel+'"');return}if(!t||!r||!r.messages){TS.error("failed to get history for channel "+n.channel);i.history_is_being_fetched=false;i.history_fetch_retries=(i.history_fetch_retries||0)+1;var a=TS.utility.getHistoryRetryDelay(i.history_fetch_retries,_.get(r,"error"));TS.info("retrying history fetch on channel "+i.id+" in "+a);window.setTimeout(function(){TS.info("retrying history fetch on channel "+i.id+", attempt #"+(i.history_fetch_retries||"1"));TS.channels.fetchHistory(i,n,TS.channels.onHistory)},a);return}i.history_fetch_retries=0;var s=TS.shared.onHistory(i,r,n,TS.channels);if(!s){i.history_is_being_fetched=false;TS.channels.history_fetched_sig.dispatch(i)}var o=TS.utility.msgs.shouldMarkUnreadsOnMessageFetch(i);TS.channels.calcUnreadCnts(i,o)},fetchHistory:function e(t,r,n){if(!t){TS.error('error no channel "'+t+'"');return}t.history_is_being_fetched=true;t.history_fetch_failed=false;TS.channels.history_being_fetched_sig.dispatch(t);if(t.history_fetch_retries>5){TS.error("giving up on channels.history for "+t.id+", channel.history_fetch_retries = "+t.history_fetch_retries);t.history_fetch_retries=0;t.history_is_being_fetched=false;t.history_fetch_failed=true;if(TS.client)TS.client.msg_pane.updateEndMarker();return}n=n||TS.channels.onHistory;if(TS.boot_data.feature_trace_reason)r._x_reason=TS.console.getStackTrace().replace(/(\(?http.*\)?)|at|Array|Object/g,"").trim().substring(0,200);TS.api.call("conversations.history",r).then(function(e){var t=e.data,r=e.args,i=e.request_id;var a=true;n(a,t,r,i);return{data:t,args:r,request_id:i}}).catch(function(e){var t=e.data,r=e.args,i=e.request_id;var a=false;n(a,t,r,i);return{data:t,args:r,request_id:i}})},topicChanged:function e(t,r,n,i){if(!t.topic)t.topic={};t.topic.creator=r;t.topic.last_set=n;t.topic.value=i;TS.channels.topic_changed_sig.dispatch(t,r,i)},purposeChanged:function e(t,r,n,i){if(!t.purpose)t.purpose={};t.purpose.creator=r;t.purpose.last_set=n;t.purpose.value=i;TS.channels.purpose_changed_sig.dispatch(t,r,i)},closeArchivedChannel:function e(t){TS.shared.closeArchivedChannel(t)},makeMembersWithPreselectsForTemplate:function e(t,r){r=r||[];var n=[];for(var i=0;i<t.length;i+=1){var a=t[i];var s=-1!=r.indexOf(a.id);n[i]={member:a,preselected:s}}return n},fetchList:function e(t,r){var n={exclude_members:1};if(TS.boot_data.feature_conversations_list){if(t)n.cursor=t;n.types="public_channel";n.limit=1e3;var i=r||[];TS.api.call("conversations.list",n).then(function(e){var t=e.data,r=e.args,n=e.request_id;var a=true;i=i.concat(t.channels);if(!t.response_metadata.next_cursor){t.channels=i;if(TS.channels.onListFetched)TS.channels.onListFetched(a,t,r,n);return{data:t,args:r,request_id:n}}TS.channels.fetchList(t.response_metadata.next_cursor,i)},function(e){var t=e.data,r=e.args,n=e.request_id;var i=false;if(TS.channels.onListFetched)TS.channels.onListFetched(i,t,r,n);return{data:t,args:r,request_id:n}})}else TS.api.call("channels.list",n).then(function(e){var t=e.data,r=e.args,n=e.request_id;var i=true;if(TS.channels.onListFetched)TS.channels.onListFetched(i,t,r,n);return{data:t,args:r,request_id:n}}).catch(function(e){var t=e.data,r=e.args,n=e.request_id;var i=false;if(TS.channels.onListFetched)TS.channels.onListFetched(i,t,r,n);return{data:t,args:r,request_id:n}})},onListFetched:function e(t,r){if(!t){TS.error("failed to fetch channel list");return}var n=true;var i=_.map(r.channels,function(e){return TS.channels.upsertChannel(e,n)});if(i.length)TS.redux.channels.bulkAddEntities(_.compact(i));TS.channels.list_fetched_sig.dispatch(r.channels)},kickMember:function e(t,r){if(!TS.permissions.members.canKickFromChannels())return;var n=TS.channels.getChannelById(t);if(!n)return;return TS.shared.kickMember(n,r)},getChannelsForUser:function e(){var t=TS.model.channels;if(!TS.model.user.is_restricted)return t;return TS.channels.getChannelsUserIsIn()},getChannelsUserIsIn:function e(){var t=TS.model.channels;return _.filter(t,"is_member")},getUnarchivedChannelsForUser:function e(){var t=TS.channels.getChannelsForUser();return _.reject(t,"is_archived")},getAllVisibleMpimsForUser:function e(t){if(!t)t=TS.model.mpims;var r=_.filter(TS.model.channels,function(e){if(e.is_mpim)return true});t=_.union(t,r);return t.filter(function(e){if(e.is_open)return true;if(e.is_starred)return true;if(e.unread_cnt)return true;if(!e.latest&&(!e.msgs||!e.msgs.length))return false;if(e.members&&2===e.members.length)return false;if(TS.model.user.is_ultra_restricted)return true;return true})},setDataRetention:function e(t,r,n,i){var a={channel:t,retention_type:$("select[name=retention_type]").val()};if(1==a.retention_type)a.retention_duration=$("#retention_duration").val();var s=function e(t,r,n){if(i)i(t,r,n);if(t)TS.channels.data_retention_changed_sig.dispatch(n)};TS.api.call("conversations.setRetention",a).then(function(e){var t=e.data,r=e.args,n=e.request_id;var i=true;s(i,t,r,n);return{data:t,args:r,request_id:n}}).catch(function(e){var t=e.data,r=e.args,n=e.request_id;var i=false;s(i,t,r,n);return{data:t,args:r,request_id:n}})},getDataRetention:function e(t,r){TS.api.call("conversations.getRetention",{channel:t}).then(function(e){var t=e.data,n=e.args,i=e.request_id;var a=true;if(r)r(a,t,n,i);return{data:t,args:n,request_id:i}}).catch(function(e){var t=e.data,n=e.args,i=e.request_id;var a=false;if(r)r(a,t,n,i);return{data:t,args:n,request_id:i}})}});var e=function e(n,i){var a=TS.channels.getChannelById(n.id);var o;delete n.unread_count;if(TS.boot_data.feature_tinyspeck&&"C00"===n.id)TS.warn("_upsertChannel() got a bad channel id of C00",n);if(a){a=_.assign({},TS.redux.channels.dangerouslyGetEntityById(n.id));if(TS.has_pri[s])TS.log(s,'updating existing channel "'+n.id+'"');for(var l in n)if("members"===l){if(!n.is_mpim)continue;o=n.members;if(TS.shared.isModelObOrgShared(n))a.members=_.union(a.members,o);else{if(a.members.length!==o.length)TS.metrics.count("channel_upsert_membership_discrepancy");a.members.length=0;for(var u=0;u<o.length;u+=1)a.members.push(o[u])}}else if("pinned_items"===l){if(TS.client){if(n.pinned_items)TS.pins.upsertPinnedItems(n.pinned_items);a.pinned_items=n.pinned_items}}else a[l]=n[l];t(a);n=a;if(TS.isPartiallyBooted()&&null===n.oldest_msg_ts)n.oldest_msg_ts=TS.storage.fetchOldestTs(n.id);TS.shared.maybeResetHistoryFetched(n);if(TS.client&&n.is_member){var d=true;TS.shared.checkInitialMsgHistory(n,TS.channels,d)}if(!i)TS.redux.channels.replaceEntity(n)}else{r(n);if(!i)TS.redux.channels.addEntity(n);if(n.pinned_items&&TS.client)TS.pins.upsertPinnedItems(n.pinned_items)}if(n.is_member&&n.is_archived){TS.error("channel.is_member and channel.is_archived are both true for "+n.id);TS.dir(0,n);n.is_member=false}if(TS.client){var c=TS.utility.msgs.shouldMarkUnreadsOnMessageFetch(n);if(TS.model.active_cid===n.id)TS.channels.calcUnreadCnts(n,c);else if(!a)TS.channels.calcUnreadCnts(n,c)}return n};var t=function e(t){if(t.is_global_shared||!TS.shared.isModelObShared(t)&&!TS.shared.isModelObOrgShared(t)&&!TS.shared.isModelObPendingShared(t)){if(t.shares)t.shares=void 0;if(t.shared_team_ids)t.shared_team_ids=void 0;return}if(t.shares&&TS.shared.isModelObOrgShared(t)){t.shared_team_ids=_(t.shared_team_ids||[]).concat(_.map(t.shares,"id")).value();if(t.shares)t.shares=void 0}else if(t.shares&&TS.shared.isModelObShared(t))if(_.isArray(t.shares))if(_.isObject(t.shares[0]))t.shared_team_ids=_.map(t.shares,function(e){return e.team.id});else t.shared_team_ids=t.shares;else if(_.isObject(t.shares))t.shared_team_ids=_.map(t.shares,"team.id");t.shared_team_ids=_(t.shared_team_ids||[]).uniq().value();if(TS.shared.isModelObShared(t)&&t.shared_team_ids.length)TS.teams.ensureTeamsArePresentWhenConvenient(t.shared_team_ids);if(TS.shared.isModelObPendingShared(t)&&t.pending_shared.length)TS.teams.ensureTeamsArePresentWhenConvenient(t.pending_shared)};var r=function e(r){TS.shared.setPriorityForDev(r);r.is_channel=true;r.is_general=!!r.is_general;if(TS.boot_data.feature_default_shared_channels){r.is_org_mandatory=!!r.is_org_mandatory;r.is_org_default=!!r.is_org_default}r._name_lc=_.toLower(r.name);r._show_in_list_even_though_no_unreads=false;TS.shared.maybeResetHistoryFetched(r);if(!r.topic)r.topic={};if(!r.purpose)r.purpose={};r.is_member=!!r.is_member;r.scroll_top=-1;r.history_is_being_fetched=false;r.unread_highlight_cnt=0;r.unread_highlights=[];r.unread_cnt=0;r.unreads=[];TS.shared.setOldestUnreadTsForId(r.id,null);r.has_fetched_history_after_scrollback=false;if(TS.client)if(TS._incremental_boot&&r.msgs&&r.msgs.length>0){r.msgs=r.msgs.map(function(e){return TS.utility.msgs.processImsg(e,r.id)});TS.utility.msgs.setMsgs(r,r.msgs)}else TS.utility.msgs.setMsgs(r,[]);else if(TS.boot_data.msgs)TS.utility.msgs.ingestMessagesFromBootData(r);r.oldest_msg_ts=TS.storage.fetchOldestTs(r.id)||null;r.last_msg_input=TS.storage.fetchLastMsgInput(r.id)||null;r.has_draft=!!r.last_msg_input;if(TS.model.created_channels[r.name]){r.needs_created_message=true;delete TS.model.created_channels[r.name]}t(r)};var n=999;var i=142;var a=4;var s=5})()},4771:function(e,t){(function(){TS.registerModule("membership",{membership_counts_need_refetch_sig:new signals.Signal,onStart:function e(){TS.channels.member_left_sig.add(d);TS.channels.member_joined_sig.add(u);TS.groups.member_left_sig.add(d);TS.groups.member_joined_sig.add(u);TS.channels.switched_sig.add(m);TS.groups.switched_sig.add(m);TS.ims.switched_sig.add(m);TS.mpims.switched_sig.add(m);TS.channels.joined_sig.add(f);TS.channels.left_sig.add(p);TS.groups.left_sig.add(p);TS.redux.socket.connectedSig.addOnce(function(){TS.redux.socket.connectedSig.add(g)});var t=Infinity;TS.members.changed_deleted_sig.add(S,this,t);TS.members.non_loaded_changed_deleted_sig.add(S,this,t)},test:function r(){var s={};Object.defineProperty(s,"_channel_member_counts_info",{get:function t(){return e},set:function t(r){e=r}});Object.defineProperty(s,"_promiseToGetChannelMemberCountsFromAPI",{get:function e(){return o},set:function e(t){o=t}});Object.defineProperty(s,"_isChannelMembershipKnownForUser",{get:function e(){return n},set:function e(t){n=t}});Object.defineProperty(s,"_getChannelMembershipForUser",{get:function e(){return i},set:function e(t){i=t}});Object.defineProperty(s,"_setChannelKnownMembership",{get:function e(){return a},set:function e(t){a=t}});Object.defineProperty(s,"_channel_known_member_statuses",{get:function e(){return t},set:function e(r){t=r}});return s},lazyLoadGroupMembership:function e(){return false},lazyLoadMpimMembership:function e(){return false},getUserChannelMembershipStatus:function e(t,r){if(!_.isString(t))throw new Error("Expected user_id to be a string");if(!_.isObject(r))throw new Error("Expected channel to be an object");if(r.is_im)return{is_known:true,is_member:t==TS.boot_data.user_id||t==r.user};if(n(r.id,t))return{is_known:true,is_member:i(r.id,t)};var a={is_known:false};Object.defineProperty(a,"is_member",{get:function e(){throw new Error("Value for is_member is not known; check is_known before accessible this field")}});return a},setUserChannelMembership:function e(t,r,n){if(!_.isString(t))throw new Error("Expected user_id to be a string");return a(r.id,t,n)},ensureChannelMembershipIsKnownForUsers:function e(t,r){if(TS.boot_data.feature_store_membership_in_redux)return TS.redux.membership.ensureChannelMembershipIsKnownForUsers(t,r);var n=s(t,r);if(0===n.length)return Promise.resolve(false);return TS.flannel.fetchChannelMembershipForUsers(t,n).then(function(e){_.forEach(e,function(e,r){a(t,r,e)});return true})},isChannelMembershipKnownForUsers:function e(t,r){var n=s(t,r);return 0===n.length},notifyChannelMembershipChanged:function e(t,r,n,i){var a=TS.members.getMemberById(t);if(!a){var s=n?"joined":"left";TS.warn("User "+t+" "+s+" channel "+r.id+" but we don’t have that user in our model");return}if(n)TS.channels.member_joined_sig.dispatch(r,a,!i);else TS.channels.member_left_sig.dispatch(r,a)},promiseToGetMembershipCounts:function e(t){var r=TS.membership.getMembershipCounts(t);if(r.promise)return r.promise.then(function(){return Promise.resolve(TS.membership.getMembershipCounts(t).counts)});return Promise.resolve(r.counts)},getMembershipCounts:function t(r){e[r.id]=e[r.id]||{};var n=e[r.id];var i=!n.promise&&(!n.counts||n.should_refetch);if(i){n.should_refetch=false;n.promise=o(r,n.last_fetched_ts||0).then(function(e){n.counts=e;delete n.promise;if(n.should_refetch)TS.membership.getMembershipCounts(r);n.last_fetched_ts=Date.now();return null})}return n},fetchMembershipForChannel:function e(t){return TS.api.call("conversations.members",{channel:t,include_shared:true}).then(function(e){return e.data.members})}});var e={};var t={};var r={};var n=function e(r,n){if(!t[r])return false;return _.includes(t[r].known_members,n)||_.includes(t[r].known_non_members,n)};var i=function e(r,n){if(t[r]&&_.includes(t[r].known_members,n))return true;else if(t[r]&&_.includes(t[r].known_non_members,n))return false;throw new Error("Channel membership not known for the given user; this is a programming error")};var a=function e(r,a,s){if(!_.isString(r))throw new Error("model_ob_id should be a string");if(!_.isString(a))throw new Error("user_id should be a string");if(!_.isBoolean(s))throw new Error("is_member should be a boolean");if(!t[r])t[r]={known_members:[],known_non_members:[]};if(n(r,a)&&i(r,a)==s)return false;if(TS.has_pri[v])TS.log(v,"Noting "+a+" ("+_.get(TS.members.getMemberById(a),"name","(member not loaded)")+") "+(s?"is":"is NOT")+" a member of "+r);if(s){t[r].known_members.push(a);_.pull(t[r].known_non_members,a)}else{t[r].known_non_members.push(a);_.pull(t[r].known_members,a)}return true};var s=function e(t,r){if(!_.isString(t))throw new Error("Expected channel_id to be a string");if(!_.isArray(r))throw new Error("Expected user_ids to be an array");if(r.length>0&&!_.isString(r[0]))throw new Error("Expected user_ids to be an array of strings");if("D"===t[0])return[];var i=r.filter(function(e){return!n(t,e)});return i};var o=function e(t,n){if(!t)return Promise.reject(new Error("Cannot fetch member counts without model_ob"));if(TS.interop.utility.looksLikeMemberId(t.id))return Promise.reject(new Error("Cannot fetch member counts on user objects"));var i=1e4;var a=Date.now()-n;var s=r[t.id];if(s)return s;if(a<i)s=new Promise(function(e){if(TS.has_pri[T])TS.log(T,"Channel member counts ("+t.id+"): it’s only been "+a+"ms since last fetch; waiting "+(i-a)+" ms before fetching");setTimeout(e,i-a)});else s=Promise.resolve();r[t.id]=s.then(function(){if(TS.has_pri[T])TS.log(T,"Channel member counts ("+t.id+"): fetching counts from API");return TS.flannel.fetchMembershipCountsForChannel(t.id).then(function(e){if(!e)throw new Error("Invalid membership counts response from flannel!");if(TS.has_pri[T])TS.log(T,"Channel member counts from flannel ("+t.id+"): "+JSON.stringify(e));return{member_count:e.members,restricted_member_count:e.guests,teams_member_count:e.external_teams}}).catch(function(){var e=Date.now();r[t.id]=null;return o(t,e)}).finally(function(){r[t.id]=null})});return r[t.id]};var l=function t(r,n,i){var a=e[r.id];if(!a)return;a.should_refetch=true;if(a.counts){a.counts.member_count+=n;if(i)a.counts.restricted_count+=n}};var u=function e(t,r){var n=1;l(t,n,r.is_restricted);a(t.id,r.id,true)};var d=function e(t,r){var n=-1;l(t,n,r.is_restricted);a(t.id,r.id,false)};var c;var m=function t(){if(c){var r=TS.shared.getModelObById(c);if(r&&r.is_channel&&!r.is_member){if(TS.has_pri[T])TS.log(T,"Channel member counts ("+r.id+"): removing local counts because we switched away and we are not a member");delete e[r.id]}}c=TS.shared.getActiveModelOb().id};var f=function e(t){u(t,TS.model.user);h(t)};var p=function r(n){if(TS.has_pri[T])TS.log(T,"Channel member counts ("+n.id+"): removing local counts because we left the channel");delete e[n.id];delete t[n.id];h(n)};var h=function e(t){if(!TS.model.user.is_admin&&TS.shared.isModelObShared(t)){var r=TS.utility.teams.getTeamsForModelOb(t);var n=r.reduce(function(e,t){return e.concat(TS.utility.teams.getMembersForTeam(t))},[]);TS.members.removeMembers(n)}};var g=function n(i){if(i)return;var a=TS.shared.getActiveModelOb();var s;if(a&&a.id){s=e[a.id]||{};s.should_refetch=true}e={};t={};r={};if(a&&a.id)e[a.id]=s;TS.membership.membership_counts_need_refetch_sig.dispatch()};var S=function t(){_.forEach(e,function(e){e.should_refetch=true})};var T=1989;var v=1990})()},4772:function(e,t){(function(){TS.registerModule("channels.read_only",{list_updated_sig:new signals.Signal,refetching_channel_info_ids:{},stashAndFetchChannelPostingUpdates:function e(t,r){if(!TS.boot_data.page_needs_enterprise||!TS.boot_data.feature_default_shared_channels)return;if(TS.channels.read_only.refetching_channel_info_ids[t])return;TS.channels.read_only.refetching_channel_info_ids[t]=true;var n={id:t};var i=true;switch(r){case 6:n.is_read_only=true;n.is_thread_only=false;n.is_non_threadable=false;break;case 7:n.is_read_only=false;n.is_thread_only=true;n.is_non_threadable=false;break;case 8:n.is_read_only=false;n.is_thread_only=false;n.is_non_threadable=true;break;default:i=false}if(i){TS.channels.upsertChannel(n);TS.channels.read_only.list_updated_sig.dispatch()}TS.view.checkIfInputShouldBeDisabledAndPopulate();TS.shared.promiseToRefetchModelOb(t).then(function(){delete TS.channels.read_only.refetching_channel_info_ids[t];TS.view.checkIfInputShouldBeDisabledAndPopulate();TS.channels.read_only.list_updated_sig.dispatch()})},updateList:function e(t){if(!t||!_.isArray(t))return;var r=_.uniq(t);var n=_.difference(r,TS.model.read_only_channels);var i=_.difference(TS.model.read_only_channels,r);i.forEach(function(e){var t=TS.shared.getModelObById(e);if(!t)return;var r=_.assign({},t,{is_read_only:false});if(t.is_group)TS.groups.upsertGroup(r);else TS.channels.upsertChannel(r)});n.forEach(function(e){var t=TS.shared.getModelObById(e);if(!t)return;var r=_.assign({},t,{is_read_only:true});if(t.is_group)TS.groups.upsertGroup(r);else TS.channels.upsertChannel(r)});TS.model.read_only_channels=r;TS.channels.read_only.list_updated_sig.dispatch()},addChannelToList:function e(t){TS.model.read_only_channels=_.uniq(_.concat(TS.model.read_only_channels,t));TS.channels.read_only.list_updated_sig.dispatch()},removeChannelFromList:function e(t){TS.model.read_only_channels=TS.model.read_only_channels.filter(function(e){return e!==t});TS.channels.read_only.list_updated_sig.dispatch()},isReadOnly:function e(t){if(TS.boot_data.page_needs_enterprise){if(TS.model.user.enterprise_user&&TS.model.user.enterprise_user.is_owner)return false}else if(TS.model.user.owner)return false;var r=TS.shared.getModelObById(t);if(!r)return false;if(r.is_im||r.is_mpim)return false;if(!_.isUndefined(r.is_read_only))return r.is_read_only;return TS.model.read_only_channels.indexOf(t)>-1}})})()},4773:function(e,t){(function(){TS.registerModule("channels.ui",{onStart:function e(){},showDataRetentionDialog:function n(i,o,l,u){var d=!l;var c=TS.shared.getModelObById(i);if(!c){TS.error("unknown channel_id passed to data retention dialog:"+i);return}var m;var f;if(c.is_im||c.is_mpim){f="conversation";m="this conversation"}else if(c.is_group||c.is_private){f="channel";m=_.escape(c.name)}else{f="channel";m="#"+_.escape(c.name)}var p=TS.prefs.getTeamPref("retention_type");var h=TS.prefs.getTeamPref("retention_duration");if(c.is_im||c.is_mpim){p=TS.prefs.getTeamPref("dm_retention_type");h=TS.prefs.getTeamPref("dm_retention_duration")}else if(c.is_group||c.is_private){p=TS.prefs.getTeamPref("group_retention_type");h=TS.prefs.getTeamPref("group_retention_duration")}var g=s();if(!d)g=TS.templates.channel_data_retention_dialog({model_type:f,retention_type:l,retention_duration:u,team_type:p,team_duration:h});TS.generic_dialog.start({title:TS.i18n.t("Edit retention policy for {channel_name}","channels")({channel_name:m}),body:g,go_button_text:TS.i18n.t("Save settings","channels")(),enter_always_gos:true,onGo:function e(){var t=$("select[name=retention_type]").val();var r=$("#retention_duration").val();if(null===t)return;if(null===r)return;var n=TS.shared.getControllerForModelOb(c);if(_.isFunction(n.setDataRetention))n.setDataRetention(i,t,r,o)},onShow:d?null:a});if(d)if(c.is_im)TS.ims.getDataRetention(i,r);else if(c.is_mpim)TS.mpims.getDataRetention(i,r);else if(c.is_group)TS.groups.getDataRetention(i,t);else TS.channels.getDataRetention(i,e)},showArchiveChannelDialog:function e(t){TS.generic_dialog.start({title:TS.i18n.t("Archive #{channel_name}","channels")({channel_name:t.name}),body:TS.templates.channel_option_archive({name:t.name}),go_button_text:TS.i18n.t("Yes, archive the channel","channels")(),onGo:function e(){var r=function e(t,r){if(t){if(TS.web){$("p.alert").addClass("hidden");$("#archive_success").removeClass("hidden");$("#archive_btn").addClass("hidden");$("#unarchive_btn").removeClass("hidden")}return}var n=TS.i18n.t("Archiving failed with error: {error}","channels")({error:r.error});if("last_ra_channel"===r.error)if(TS.model.user.is_admin)n=TS.i18n.t("Sorry, you can’t archive this channel because it is the only channel one of the guest account members belongs to. If you first disable the guest account, you will then be able to archive the channel.","channels")();else n=TS.i18n.t("Sorry, you can’t archive this channel because it is the only channel one of the guest account members belongs to.","channels")();else if("restricted_action"===r.error)n=TS.i18n.t("<p>You don’t have permission to archive channels.</p><p>Talk to your Workspace Owner.</p>","channels")();else if("already_archived"===r.error)n=TS.i18n.t("This channel was already archived.","channels")();else if("cant_archive_general"===r.error)n=TS.i18n.t("This channel cannot be archived.","channels")();setTimeout(TS.generic_dialog.alert,500,n)};TS.api.call("conversations.archive",{channel:t.id}).then(function(e){var t=e.data,n=e.args,i=e.request_id;var a=true;r(a,t,n,i);return{data:t,args:n,request_id:i}},function(e){var t=e.data,n=e.args,i=e.request_id;var a=false;r(a,t,n,i);return{data:t,args:n,request_id:i}})}})},showArchiveGroupDialog:function e(t,r){var n=TS.i18n.t("{leave, select, true{Leave and archive}other{Archive}} {prefix}{name}","channels")({leave:r,prefix:TS.model.group_prefix,name:t.name});var i=TS.i18n.t("{leave, select, true{Yes, leave & archive the channel}other{Yes, archive the channel}}","channel")({leave:r});TS.generic_dialog.start({title:n,body:TS.templates.channel_option_archive({name:t.name,group_prefix:TS.model.group_prefix}),go_button_text:i,onGo:function e(){var n=function e(n,i){if(n){if(r&&TS.client)TS.shared.closeArchivedChannel(t.id);if(TS.web){$("p.alert").addClass("hidden");$("#archive_success").removeClass("hidden");$("#archive_btn").addClass("hidden");$("#unarchive_btn").removeClass("hidden")}return}var a=TS.i18n.t("Archiving failed with error: {error}","channels")({error:i.error});if("last_ra_channel"===i.error)if(TS.model.user.is_admin)a=TS.i18n.t("Sorry, you can’t archive this channel because it is the only channel one of the guest account members belongs to. If you first disable the guest account, you will then be able to archive the channel.","channels")();else a=TS.i18n.t("Sorry, you can’t archive this channel because it is the only channel one of the guest account members belongs to.","channels")();else if("already_archived"===i.error)a=TS.i18n.t("This channel was already archived.","channels")();else if("restricted_action"===i.error)a=TS.i18n.t("<p>You don’t have permission to archive private channels.</p><p>Talk to your Workspace Owner.</p>","channels")();setTimeout(TS.generic_dialog.alert,500,a)};TS.api.call("conversations.archive",{channel:t.id}).then(function(e){var t=e.data,r=e.args,i=e.request_id;var a=true;n(a,t,r,i);return{data:t,args:r,request_id:i}},function(e){var t=e.data,r=e.args,i=e.request_id;var a=false;n(a,t,r,i);return{data:t,args:r,request_id:i}})}})},channelCreateDialogShowNameTakenAlert:function e(t){t.find(".modal_input_note").addClass("hidden");t.find(".name_taken_warning").removeClass("hidden");$("#channel_create_title").select()},channelCreateDialogShowDisallowedCharsAlert:function e(t){t.find(".modal_input_note").addClass("hidden");t.find(".invalid_chars_warning").removeClass("hidden");$("#channel_create_title").select()},channelCreateDialogShowSinglePunctuationAlert:function e(t){t.find(".modal_input_note").addClass("hidden");t.find(".single_punctuation_warning").removeClass("hidden");$("#channel_create_title").select()},channelCreateDialogShowOtherErrorAlert:function e(t,r){if(!r)r=TS.i18n.t("Sorry! Something went wrong.","channels")();t.find(".modal_input_note").addClass("hidden");t.find(".other_error").removeClass("hidden").find(".error_message").text(r)},channelCreateDialogCleanName:function e(t){var r=t.find(".title_input").val();var n=TS.utility.cleanChannelName(r);while("#"===r.substr(0,1))r=r.substr(1);if(n!=r){t.find(".title_input").val(n);TS.channels.ui.channelCreateDialogShowDisallowedCharsAlert(t);return false}return true},channelCreateDialogValidateInput:function e(t){var r=t.find(".title_input").val();var n=TS.utility.cleanChannelName(r);if(!TS.channels.ui.channelCreateDialogCleanName(t))return false;if("_"===n||"-"===n){TS.channels.ui.channelCreateDialogShowSinglePunctuationAlert(t);return false}if(!r){$("#channel_create_title").select();return false}if(TS.channels.getChannelByName(r)||TS.groups.getGroupByName(r)||TS.members.getMemberByName(r)){TS.channels.ui.channelCreateDialogShowNameTakenAlert(t);return false}return true}});var e=function e(t,r){if(t){var a=r.retention.retention_type;var s=r.retention.retention_duration;n("channel",a,s)}else i("channel",r)};var t=function e(t,r){if(t){var a=r.retention.retention_type;var s=r.retention.retention_duration;n("group",a,s)}else i("group",r)};var r=function e(t,r){if(t){var a=r.retention.retention_type;var s=r.retention.retention_duration;n("conversation",a,s)}else i("conversation",r)};var n=function e(t,r,n){var i=$("#generic_dialog .loading_hash_animation");var s=TS.prefs.getTeamPref("retention_type");var o=TS.prefs.getTeamPref("retention_duration");if("group"===t){s=TS.prefs.getTeamPref("group_retention_type");o=TS.prefs.getTeamPref("group_retention_duration")}else if("conversation"===t){s=TS.prefs.getTeamPref("dm_retention_type");o=TS.prefs.getTeamPref("dm_retention_duration")}if("group"===t)t="channel";i.replaceWith(TS.templates.channel_data_retention_dialog({model_type:t,retention_type:r,retention_duration:n,team_type:s,team_duration:o}));a()};var i=function e(t,r){var n=$("#generic_dialog .loading_hash_animation");if("no_perms"===r.error||"is_archived"===r.error||"not_paid"===r.error){if("group"===t)t="channel";n.replaceWith('<p class="no_bottom_margin">'+TS.i18n.t("Sorry! You can’t change the retention duration for this {model_type, select, conversation {conversation} other {channel}}.","channels")({model_type:t})+"</p>")}else n.replaceWith('<p class="no_bottom_margin">'+TS.i18n.t("Oops! Something went wrong. Please try again.","channels")()+"</p>")};var a=function e(){$("select[name=retention_type]").change(function(){if(1!=this.value){$("#team_retention_pref").removeClass("hidden");$("#retention_duration_container, #retention_duration_warning").addClass("hidden")}else{$("#team_retention_pref").addClass("hidden");$("#retention_duration_container, #retention_duration_warning").removeClass("hidden");if(0===$("#retention_duration").val())$("#retention_duration").val("");$("#retention_duration").focus()}}).change()};var s=function e(){var t=cdn_url+"/9c217/img/loading_hash_animation_@2x.gif";var r=TS.i18n.t("Loading...","channels")();return'<div class="loading_hash_animation" style="margin: 2rem;"><img src="'+t+'" alt="'+r+'" /><br />'+r+"</div>"}})()},4774:function(e,t){(function(){TS.registerModule("groups",{switched_sig:new signals.Signal,joined_sig:new signals.Signal,member_joined_sig:new signals.Signal,left_sig:new signals.Signal,member_left_sig:new signals.Signal,history_fetched_sig:new signals.Signal,history_being_fetched_sig:new signals.Signal,message_received_sig:new signals.Signal,message_removed_sig:new signals.Signal,message_changed_sig:new signals.Signal,marked_sig:new signals.Signal,unread_changed_sig:new signals.Signal,unread_highlight_changed_sig:new signals.Signal,topic_changed_sig:new signals.Signal,purpose_changed_sig:new signals.Signal,deleted_sig:new signals.Signal,renamed_sig:new signals.Signal,opened_sig:new signals.Signal,closed_sig:new signals.Signal,archived_sig:new signals.Signal,unarchived_sig:new signals.Signal,msg_not_sent_sig:new signals.Signal,data_retention_changed_sig:new signals.Signal,converted_to_shared_sig:new signals.Signal,shared_teams_updated_sig:new signals.Signal,addMsg:function e(t,r){var n=TS.groups.getGroupById(t);if(!n){if(!TS.channels.temp_list_of_removed_channels[t])TS.error('unknown group "'+t+'"');return}if(TS.useReactMessages()&&!TS.utility.msgs.isMsgReply(r)){if(!TS.redux.messages.addMessage(r,true))return}else if(!TS.shared.addMsg(n,r))return;var i=!TS.utility.msgs.isTempMsg(r);TS.groups.calcUnreadCnts(n,i);TS.utility.msgs.maybeTruncateMsgs(n);TS.groups.message_received_sig.dispatch(n,r);if(!n.is_open)TS.api.call("conversations.open",{channel:n.id})},calcUnreadCnts:function e(t,r){TS.shared.calcUnreadCnts(t,TS.groups,r)},removeMsg:function e(t,r){var n=TS.groups.getGroupById(t);if(!n){TS.error('unknown group "'+t+'"');return}if(TS.useReactMessages()&&!TS.utility.msgs.isMsgReply(r))TS.redux.messages.removeMessage(r);else{if(n._archive_msgs)TS.utility.msgs.spliceMsg(n._archive_msgs,r);var i=n.msgs;TS.utility.msgs.spliceMsg(i,r)}TS.groups.message_removed_sig.dispatch(n,r);TS.groups.calcUnreadCnts(n,true)},sendMsg:function e(t,r,n,i){return TS.shared.sendMsgGroup(t,r,TS.groups,n,i)},onSendMsg:function e(t,r){var n=TS.groups.getGroupById(r.SENT_MSG.channel);if(!n){TS.error("unknown group? "+r.SENT_MSG.channel);return}TS.shared.onSendMsg(t,r,n,TS.groups)},displayGroup:function e(t){var r=_.defaults({},t,{from_history:false,replace_history_state:false});var i=r.id;if(!i){TS.error("no group id supplied");return}var a=r.path;var s=r.and_send_txt;var o=r.from_history;var l=r.replace_history_state;if(TS.isPartiallyBooted()&&i!==TS.model.initial_cid){TS.warn("Can't switch model objects during incremental boot; this is a programming error");TS.sounds.play("beep");return}TS.metrics.mark("start_channel_change_"+i);var u=TS.groups.getGroupById(i);if(!u){TS.error('group "'+i+'" unknown');return}TS.utility.msgs.maybeClearPrevLastRead();TS.utility.msgs.maybeClearPrevLastRead(u);TS.shared.maybeClearHasAutoScrolled();if(TS.shared.didDeferMessageHistoryById(u.id))TS.shared.checkInitialMsgHistory(u,TS.groups);if(TS.has_pri[n])TS.log(n,"displayGroup "+u.id+" from_history:"+o+" replace_history_state:"+l);if(i===TS.model.active_group_id&&!l&&!TS.client.activeChannelIsHidden()){TS.warn('group "'+i+'" already displayed');if(s)TS.groups.sendMsg(i,$.trim(s));return}var d=l?false:o;var c=a||"/messages/"+u;var m=TS.client.channelDisplaySwitched({id:i,path:c,replace_history_state:l,no_history_add:d});if(m)TS.groups.switched_sig.dispatch();if(u.is_open){if(s)TS.groups.sendMsg(i,$.trim(s));return}TS.model.requested_group_opens[i]={and_send_txt:s};TS.api.call("conversations.open",{channel:u.id})},setLastRead:function e(t,r,n){var a;if(TS.useReactMessages()){a=TS.model.last_reads_set_by_client[t.id+"_"+r];delete TS.model.last_reads_set_by_client[t.id+"_"+r]}if(t.last_read===r)return false;if(r.indexOf(TS.utility.date.fake_ts_unique_padder)>-1){TS.error("bad ts:"+r);return false}var s=t.id+". last_read = "+t.last_read+" -> "+r+", reason: "+(n||"unspecified");if(t.last_read>r){if(!TS.useReactMessages()){a=TS.model.last_reads_set_by_client[t.id+"_"+r];delete TS.model.last_reads_set_by_client[t.id+"_"+r]}if(a){TS.warn("NOT going back in time on group "+s);return}if(TS.has_pri[i])TS.log(i,"going back in time on group "+s);TS.utility.msgs.maybeClearPrevLastRead(t);TS.utility.msgs.setPrevLastRead(t,r)}else{if(TS.has_pri[i])TS.log(i,"TS.groups.setLastRead: "+s);TS.utility.msgs.maybeClearPrevLastRead(t);TS.utility.msgs.maybeSetPrevLastRead(t,r)}t.last_read=r;if(n)t._marked_reason=n;TS.groups.marked_sig.dispatch(t);TS.utility.msgs.maybeClearUsersCountsInfo(t);TS.groups.calcUnreadCnts(t);return true},markMostRecentReadMsg:function e(t,r,n){if(!t){TS.error("group unknown");return}if(TS.useReactMessages()){TS.redux.dispatch(TS.interop.redux.models.channels.markMostRecentMsgRead({channelId:t.id,reason:r}));return}if((!t.msgs||!t.msgs.length)&&!n)return;var i=TS.utility.msgs.getMostRecentValidTs(t);if(!i){if(t.msgs&&t.msgs.length||!t._latest_via_users_counts)TS.warn('no valid tses for group "'+t.id+'"???');return}TS.groups.markReadMsg(t.id,i,r)},markReadMsg:function e(t,r,n){var i=TS.groups.getGroupById(t);if(!i){TS.error('group "'+t+'" unknown');return}if(i.last_read===r)return;if(TS.groups.setLastRead(i,r,n)){i._marked_reason=n;var a=true;TS.redux.channels.setMarkingState(i.id,a)}},onMarked:function e(t,r,n){var i=TS.groups.getGroupById(n.channel);if(!i){TS.error('error no group "'+n.channel+'"');return}if(t||r&&"is_archived"===r.error);else{var a=true;TS.redux.channels.setMarkingState(i.id,a)}},create:function e(t,r){r=r||{};if(!t)return;TS.model.created_groups[t]=true;var n=r.and_invite_members_idsA?r.and_invite_members_idsA.join(","):"";return new Promise(function(e,i){if(TS.boot_data.feature_conversations_create)TS.api.call("conversations.create",{name:t,is_private:true,_and_invite_members_ids:n,validate:r.validate}).then(function(t){e(t);TS.groups.onCreate(t.data.ok,t.data,t.args);return null},function(e){i(e);return null});else TS.api.call("groups.create",{name:t,_and_invite_members_ids:n,validate:r.validate}).then(function(t){e(t);TS.groups.onCreate(t.data.ok,t.data,t.args);return null},function(e){i(e);return null})})},createChild:function e(t,r,n){var i=TS.groups.getGroupById(t);if(!i)return;TS.model.archives_and_recreated_groups[t]=true;var a=r?r.join(","):"";var s=function e(t,r,i){TS.groups.onCreate(t,r,i);if(n)n(t,r,i)};var o=TS.boot_data.feature_conversations_create_child?"conversations.createChild":"groups.createChild";TS.api.call(o,{channel:t,_and_invite_members_ids:a}).then(function(e){var t=e.data,r=e.args,n=e.request_id;var i=true;s(i,t,r,n);return{data:t,args:r,request_id:n}},function(e){var t=e.data,r=e.args,n=e.request_id;var i=false;s(i,t,r,n);return{data:t,args:r,request_id:n}})},onCreate:function e(t,r,n){if(!t){if("name_taken"===r.error);else if("restricted_action"===r.error);else TS.error("failed to create group");return}var i;var a;if(r.group||r.channel){i=TS.boot_data.feature_conversations_create?TS.groups.upsertGroup(r.channel):TS.groups.upsertGroup(r.group);a=TS.boot_data.feature_conversations_create?r.channel.id:r.group.id}if(!a){TS.error("no group_id?!!");return}if(!i){TS.error("no group?!!");return}var s=n._and_invite_members_ids?n._and_invite_members_ids.split(","):null;if(s)TS.api.call("conversations.invite",{channel:a,users:s.join(",")});if(TS.client)TS.groups.displayGroup({id:a})},getLeaveAction:function e(t){if(TS.model.user.is_ultra_restricted)return"";if(!TS.groups.canLeaveGroup(t))return"";var r=TS.groups.getGroupById(t);if(r.is_archived)return"close";var n=TS.membership.getMembershipCounts(r);var i=_.get(n,"counts.member_count")||0;if(1===i)return"leave_and_archive";return"leave"},leave:function e(t){var r=TS.groups.getGroupById(t);if(!r){TS.error("WTF no group:"+t);return}if(TS.boot_data.feature_default_shared_channels){var n=TS.permissions.channels.canMemberLeaveChannel(r,TS.model.user);if(!n){TS.generic_dialog.alert(TS.i18n.t("Sorry, you can’t leave <strong>{group_name}</strong>!","channels")({group_name:TS.model.group_prefix+r.name}));return}}var i=TS.groups.getLeaveAction(t);if("close"===i)TS.shared.closeArchivedChannel(t);else if("leave_and_archive"===i)TS.channels.ui.showArchiveGroupDialog(r,true);else if("leave"===i)TS.generic_dialog.start({title:TS.i18n.t("Leave {group}","groups")({group:TS.model.group_prefix+r.name}),body:TS.i18n.t("<p>If you leave the private channel, you will no longer be able to see any of its messages. To rejoin the private channel, you will have to be re-invited.</p><p>Are you sure you wish to leave?</p>","groups")(),go_button_text:TS.i18n.t("Yes, leave the private channel","groups")(),onGo:function e(){TS.api.call("conversations.leave",{channel:t}).then(function(e){var t=e.data,r=e.args,n=e.request_id;var i=true;if(TS.groups.onLeave)TS.groups.onLeave(i,t,r,n);return{data:t,args:r,request_id:n}},function(e){var t=e.data,r=e.args,n=e.request_id;var i=false;if(TS.groups.onLeave)TS.groups.onLeave(i,t,r,n);return{data:t,args:r,request_id:n}})}});else TS.generic_dialog.alert(TS.i18n.t("Sorry, you can’t leave <strong>{group}</strong>!","groups")({group:TS.model.group_prefix+r.name}))},onLeave:function e(t,r,n){if(!t){if(r&&"last_member"===r.error){TS.shared.closeArchivedChannel(n.channel);return}TS.error("failed to leave group");return}var i=TS.groups.getGroupById(n.channel);if(!i)return;i.msgs.length=0;if(i.is_limited)i.is_limited=false},setTopic:function e(t,r){r=TS.format.cleanMsg(r);TS.api.call("conversations.setTopic",{channel:t,topic:r,name_tagging:true}).then(function(e){var t=e.data,r=e.args,n=e.request_id;var i=true;if(TS.groups.onSetTopic)TS.groups.onSetTopic(i,t,r,n);return{data:t,args:r,request_id:n}},function(e){var t=e.data,r=e.args,n=e.request_id;var i=false;if(TS.groups.onSetTopic)TS.groups.onSetTopic(i,t,r,n);return{data:t,args:r,request_id:n}})},onSetTopic:function e(t){if(!t)TS.error("failed to set group topic")},setPurpose:function e(t,r){r=TS.format.cleanMsg(r);TS.api.call("conversations.setPurpose",{channel:t,purpose:r,name_tagging:true}).then(function(e){var t=e.data,r=e.args,n=e.request_id;var i=true;if(TS.groups.onSetPurpose)TS.groups.onSetPurpose(i,t,r,n);return{data:t,args:r,request_id:n}},function(e){var t=e.data,r=e.args,n=e.request_id;var i=false;if(TS.groups.onSetPurpose)TS.groups.onSetPurpose(i,t,r,n);return{data:t,args:r,request_id:n}})},onSetPurpose:function e(t,r){if(!t){TS.error("failed to set group purpose");TS.channels.alertSetPurposeError(r.error)}},getGroupsFilteredBy:function e(t){return TS.shared.getEntitiesFilteredBy("groups",t)},getGroupById:function e(t){if(!t)return null;return TS.redux.channels.getGroupById(t)},getGroupByName:function e(t){return TS.redux.channels.getGroupByName(t)},upsertGroup:function t(r,n){return e(r,n)},removeGroup:function e(t){if(TS.has_pri[a])TS.log(a,'removing group "'+t.id+'"');TS.channels.temp_list_of_removed_channels[t.id]=true;TS.redux.channels.removeEntity(t);if(TS.client)if(TS.model.active_group_id===t.id)TS.client.activeChannelDisplayGoneAway();if(t.msgs)t.msgs.length=0;if(t.is_limited)t.is_limited=false;TS.groups.deleted_sig.dispatch(t)},groupRenamed:function e(t){var r=TS.groups.upsertGroup(t);r._name_lc=_.toLower(r.name);TS.groups.renamed_sig.dispatch(r)},markScrollTop:function e(t,r){var n=TS.groups.getGroupById(t);if(!n)return false;if(n.scroll_top===r)return false;n.scroll_top=r;return true},maybeLoadScrollBackHistory:function e(t,r){var n=TS.groups.getGroupById(t);if(!n)return false;return TS.shared.maybeLoadScrollBackHistory(n,TS.groups,r)},onHistory:function e(t,r,n){var i=TS.groups.getGroupById(n.channel);if(!i){TS.error('error no group "'+n.channel+'"');return}if(!t||!r||!r.messages){TS.error("failed to get history for group "+n.channel);i.history_is_being_fetched=false;i.history_fetch_retries=(i.history_fetch_retries||0)+1;var a=TS.utility.getHistoryRetryDelay(i.history_fetch_retries,_.get(r,"error"));TS.info("retrying history fetch on group "+i.id+" in "+a);window.setTimeout(function(){TS.info("retrying history fetch on group "+i.id+", attempt #"+(i.history_fetch_retries||"1"));TS.groups.fetchHistory(i,n,TS.groups.onHistory)},a);return}i.history_fetch_retries=0;var s=TS.shared.onHistory(i,r,n,TS.groups);if(!s){i.history_is_being_fetched=false;TS.groups.history_fetched_sig.dispatch(i)}var o=TS.utility.msgs.shouldMarkUnreadsOnMessageFetch(i);TS.groups.calcUnreadCnts(i,o)},fetchHistory:function e(t,r,n){if(!t){TS.error('error no group "'+t+'"');return}t.history_is_being_fetched=true;t.history_fetch_failed=false;TS.groups.history_being_fetched_sig.dispatch(t);if(t.history_fetch_retries>5){t.history_fetch_retries=0;t.history_is_being_fetched=false;t.history_fetch_failed=true;if(TS.client)TS.client.msg_pane.updateEndMarker();return}n=n||TS.groups.onHistory;var i=TS.boot_data.feature_trace_reason?TS.console.getStackTrace().replace(/(\(?http.*\)?)|at|Array|Object/g,"").trim().substring(0,200):"";if(i)r._x_reason=i;TS.api.call("conversations.history",r).then(function(e){var t=e.data,r=e.args,i=e.request_id;var a=true;n(a,t,r,i);return{data:t,args:r,request_id:i}},function(e){var t=e.data,r=e.args,i=e.request_id;var a=false;n(a,t,r,i);return{data:t,args:r,request_id:i}})},topicChanged:function e(t,r,n,i){if(!t.topic)t.topic={};t.topic.creator=r;t.topic.last_set=n;t.topic.value=i;TS.groups.topic_changed_sig.dispatch(t,r,i)},purposeChanged:function e(t,r,n,i){if(!t.purpose)t.purpose={};t.purpose.creator=r;t.purpose.last_set=n;t.purpose.value=i;TS.groups.purpose_changed_sig.dispatch(t,r,i)},getUnarchivedClosedGroups:function e(){var t=TS.groups.getUnarchivedGroups();return _.reject(t,"is_open")},getUnarchivedGroups:function e(){var t=TS.model.groups;return _.reject(t,"is_archived")},calcActiveMembersForGroup:function e(t){t.active_members.length=0;if(!t.members)return;var r;for(var n=0;n<t.members.length;n+=1){r=TS.members.getMemberById(t.members[n]);if(!r)continue;if(r.deleted)continue;t.active_members.push(r.id)}},calcActiveMembersForAllGroups:function e(){var t=TS.model.groups;for(var r=0;r<t.length;r+=1)TS.groups.calcActiveMembersForGroup(t[r])},createSuggestedName:function e(t){var r=TS.model.user.name;var n=[];var i;var a;var s=TS.model.channel_name_max_length;for(a=0;a<t.length;a+=1){i=TS.members.getMemberById(t[a]);if(!i)continue;n.push(i)}n.sort(function e(t,r){var n=t._name_lc;var i=r._name_lc;if(n<i)return-1;if(n>i)return 1;return 0});for(a=0;a<n.length;a+=1){i=n[a];r+="-"+i.name.split("-")[0]}if(r.length>s){r=r.substr(0,s);if("-"===r.charAt(r.length-1))r=r.substr(0,s-1)}var o=r;var l=1;var u;while(TS.channels.getChannelByName(r)||TS.groups.getGroupByName(r)||TS.members.getMemberByName(r)){u=(l+1).toString();l+=1;r=o+u;if(r.length>s)r=o.substr(0,s-u.length)+u}return r},kickMember:function e(t,r){if(!TS.permissions.members.canKickFromGroups())return;var n=TS.groups.getGroupById(t);if(!n)return;return TS.shared.kickMember(n,r)},canLeaveGroup:function e(t){if(!TS.model.user.is_restricted)return true;if(TS.model.user.is_ultra_restricted)return false;if(TS.channels.getChannelsForUser().length)return true;var r=TS.model.groups;var n;for(var i=0;i<r.length;i+=1){n=r[i];if(n.is_archived)continue;if(n.id===t)continue;return true}return false},setDataRetention:function e(t,r,n,i){var a={channel:t,retention_type:parseInt($("select[name=retention_type]").val(),10)};if(1===a.retention_type)a.retention_duration=$("#retention_duration").val();var s=function e(t,r,n){if(i)i(t,r,n);if(t)TS.groups.data_retention_changed_sig.dispatch(n)};TS.api.call("conversations.setRetention",a).then(function(e){var t=e.data,r=e.args,n=e.request_id;var i=true;s(i,t,r,n);return{data:t,args:r,request_id:n}},function(e){var t=e.data,r=e.args,n=e.request_id;var i=false;s(i,t,r,n);return{data:t,args:r,request_id:n}})},getDataRetention:function e(t,r){TS.api.call("conversations.getRetention",{channel:t}).then(function(e){var t=e.data,n=e.args,i=e.request_id;var a=true;if(r)r(a,t,n,i);return{data:t,args:n,request_id:i}},function(e){var t=e.data,n=e.args,i=e.request_id;var a=false;if(r)r(a,t,n,i);return{data:t,args:n,request_id:i}})}});var e=function e(n,i){var s=TS.groups.getGroupById(n.id);var o;delete n.unread_count;if(s){s=_.assign({},TS.redux.channels.dangerouslyGetEntityById(n.id));if(TS.has_pri[a])TS.log(a,'updating existing group "'+n.id+'"');for(var l in n)if("members"===l){o=n.members;s.members=[];if(o&&o.length)for(var u=0;u<o.length;u+=1)s.members.push(o[u]);else TS.console.logError({group:n,existing_group:s},"There are no members when trying to upsert group",null,!TS.boot_data.feature_tinyspeck)}else if("pinned_items"===l){if(TS.client){if(n.pinned_items)TS.pins.upsertPinnedItems(n.pinned_items);s.pinned_items=n.pinned_items}}else s[l]=n[l];t(s);n=s;if(TS.isPartiallyBooted()&&null===n.oldest_msg_ts)n.oldest_msg_ts=TS.storage.fetchOldestTs(n.id);TS.shared.maybeResetHistoryFetched(n);if(TS.client){var d=true;TS.shared.checkInitialMsgHistory(n,TS.groups,d)}if(!i)TS.redux.channels.replaceEntity(n)}else{if(TS.has_pri[a])TS.log(a,'adding group "'+n.id+'"');r(n);if(!i)TS.redux.channels.addEntity(n);if(n.pinned_items&&TS.client)TS.pins.upsertPinnedItems(n.pinned_items)}if(TS.client){var c=TS.utility.msgs.shouldMarkUnreadsOnMessageFetch(n);if(TS.model.active_cid===n.id)TS.groups.calcUnreadCnts(n,c);else if(!s)TS.groups.calcUnreadCnts(n,c)}TS.groups.calcActiveMembersForGroup(n);return n};var t=function e(t){if(!TS.shared.isModelObOrgShared(t))return;if(!TS.boot_data.page_needs_enterprise)return;if(t.is_global_shared){if(t.shares)t.shares=void 0;if(t.shared_team_ids)t.shared_team_ids=void 0;return}if(t.shares&&TS.shared.isModelObOrgShared(t)){t.shared_team_ids=_(t.shared_team_ids||[]).concat(_.map(t.shares,"id")).value();if(t.shares)t.shares=void 0}else if(t.shares&&TS.shared.isModelObShared(t))if(_.isArray(t.shares))if(_.isObject(t.shares[0]))t.shared_team_ids=_.map(t.shares,function(e){return e.team.id});else t.shared_team_ids=t.shares;else if(_.isObject(t.shares))t.shared_team_ids=_.map(t.shares,"team.id");t.shared_team_ids=_(t.shared_team_ids||[]).uniq().value()};var r=function e(r){TS.shared.setPriorityForDev(r);r.is_group=true;r._name_lc=_.toLower(r.name);r._show_in_list_even_though_no_unreads=false;TS.shared.maybeResetHistoryFetched(r);r.active_members=[];r.scroll_top=-1;r.history_is_being_fetched=false;r.unread_highlight_cnt=0;r.unread_highlights=[];r.unread_cnt=0;r.unreads=[];TS.shared.setOldestUnreadTsForId(r.id,null);r.has_fetched_history_after_scrollback=false;if(TS.client)if(TS._incremental_boot&&r.msgs&&r.msgs.length>0){r.msgs=r.msgs.map(function(e){return TS.utility.msgs.processImsg(e,r.id)});TS.utility.msgs.setMsgs(r,r.msgs)}else TS.utility.msgs.setMsgs(r,[]);else if(TS.boot_data.msgs)TS.utility.msgs.ingestMessagesFromBootData(r);r.oldest_msg_ts=TS.storage.fetchOldestTs(r.id)||null;r.last_msg_input=TS.storage.fetchLastMsgInput(r.id)||null;r.has_draft=!!r.last_msg_input;if(TS.model.created_groups[r.name])delete TS.model.created_groups[r.name];t(r)};var n=999;var i=142;var a=4})()},4775:function(e,t){var r="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};(function(){TS.registerModule("files",{team_file_added_sig:new signals.Signal,team_file_deleted_sig:new signals.Signal,team_file_deleted_success_sig:new signals.Signal,team_file_changed_sig:new signals.Signal,team_file_shared_sig:new signals.Signal,team_file_comment_added_sig:new signals.Signal,team_file_comment_edited_sig:new signals.Signal,team_file_comment_deleted_sig:new signals.Signal,file_uploaded_sig:new signals.Signal,file_uploading_sig:new signals.Signal,file_progress_sig:new signals.Signal,file_canceled_sig:new signals.Signal,file_queue_emptied_sig:new signals.Signal,channel_files_fetched_sig:new signals.Signal,user_changed_public_url_sig:new signals.Signal,uploadQ:[],uploading:false,polling_count:0,polling_file_id:null,polling_ticket:null,polling_tim:null,polling_handler:null,waiting_for_refresh:{},supported_audio_type_re:/^(m4a|mp3|wav)$/,supported_video_type_re:/^(mp4|mov|webm)$/,onStart:function e(){TS.prefs.team_disable_file_editing_changed_sig.add(TS.files.getFileActions,TS.files.upsertAndSignal)},isFilePrivate:function e(t){return!t.is_public&&!t.is_external&&!t.is_shared},isFileAuthorExternal:function e(t){if(!_.isObject(t))return false;var r=TS.members.getMemberById(t.user);if(!_.isObject(r))return false;return TS.utility.teams.isMemberExternal(r)},isFileUntitled:function e(t){return"-"===t.name},createPublicURL:function e(t,r){if(TS.prefs.getTeamPref("disallow_public_file_urls"))return;var n=function e(n,i,a){if(n){TS.files.upsertAndSignal({id:t.id,public_url_shared:true});TS.files.user_changed_public_url_sig.dispatch(i.file)}else if(i.error&&"not_allowed"===i.error){TS.prefs.setTeamPrefLocal("disallow_public_file_urls",true);if(TS.boot_data.feature_external_files)TS.generic_dialog.alert(TS.i18n.t("An administator has disabled external file URL creation. You will not be able to create an external URL for this Post.","files")());else TS.generic_dialog.alert(TS.i18n.t("An administator has disabled public file URL creation. You will not be able to create a public URL for this space.","files")())}if(r&&"function"===typeof r)r(n,i,a)};return TS.api.callImmediately("files.sharedPublicURL",{file:t.id}).then(function(e){var t=e.data,r=e.args,i=e.request_id;var a=true;n(a,t,r,i);return{data:t,args:r,request_id:i}}).catch(function(e){var t=e.data,r=e.args,i=e.request_id;var a=false;n(a,t,r,i);return{data:t,args:r,request_id:i}})},createSpace:function e(t){var r={};if(TS.boot_data.page_needs_enterprise)r.team=TS.model.team.id;var n=function e(r,n){if(r){var i=TS.files.upsertAndSignal(n.file).file;if(TS.web)TS.ssb.upsertFileInSSBParentWin(i);t(i)}else{TS.generic_dialog.alert('<p class="no_bottom_margin">'+TS.i18n.t("Oops! Something went wrong. Please try again.","files")()+"</p>");t(null)}};return TS.api.callSynchronously("files.createSpace",r).then(function(e){var t=e.data,r=e.args,i=e.request_id;var a=true;n(a,t,r,i);return{data:t,args:r,request_id:i}}).catch(function(e){var t=e.data,r=e.args,i=e.request_id;var a=false;n(a,t,r,i);return{data:t,args:r,request_id:i}})},createAndOpenNewSpace:function e(t,r){return TS.files.createSpace(function(e){if(e){var n=TS.model.active_cid?"?origin_channel="+TS.model.active_cid:"";if(TS.boot_data.page_needs_enterprise)if(n.length)n+="&origin_team="+TS.model.team.id;else n="?origin_team="+TS.model.team.id;var i=e.permalink+n;if(r||!TS.ssb.openNewFileWindow(e,i,n))TS.utility.openInNewTab(i,e.id)}if("function"===typeof t)t(e)})},promptForFileUnshare:function e(t,r){var n=TS.shared.getModelObById(r);if(!n||n.is_im||n.is_mpim)return;var i=TS.i18n.t("<p>Are you sure you want to un-share this file from the <strong>{channel_name}</strong> {is_private, select, true {private} other {}} channel?</p>\t\t\t<p>Un-sharing the file will not remove existing share and comment messages, but it will keep any future comments from appearing in the channel.</p>","files")({is_private:n.is_private||n.is_group,channel_name:n.is_channel&&!n.is_private?"#"+n.name:n.name});TS.generic_dialog.start({title:TS.i18n.t("Un-share file","files")(),body:i,show_cancel_button:true,show_go_button:true,go_button_text:TS.i18n.t("Yes, unshare this file","files")(),cancel_button_text:TS.i18n.t("Cancel","files")(),onGo:function e(){TS.files.unshareFile(t,r)}})},shareFile:function e(t,r,n,i,a){var s={file:t,channel:r,comment:n||""};s.resharing_aware=true;if(i)s.share_quietly=true;var o=function e(t,r,n){TS.files.onFileShare(t,r,n);if(a)a(t,r,n)};return TS.api.call("files.share",s).then(function(e){var t=e.data,r=e.args,n=e.request_id;var i=true;o(i,t,r,n);return{data:t,args:r,request_id:n}}).catch(function(e){var t=e.data,r=e.args,n=e.request_id;var i=false;o(i,t,r,n);return{data:t,args:r,request_id:n}})},onFileShare:function e(t,r,n){if(!t)return;TS.files.fetchFileInfo(n.file,function(e,t){if(TS.web)TS.files.upsertAndSignal(t)});if(TS.web&&TS.web.space)TS.web.space.onFileShare(t,r,n)},unshareFile:function e(t,r,n){var i=function e(r,i,a){TS.files.onFileUnShare(r,i,a);if(n)n(t,TS.files.getFileById(t))};TS.api.call("files.unshare",{file:t,channel:r}).then(function(e){var t=e.data,r=e.args,n=e.request_id;var a=true;i(a,t,r,n);return{data:t,args:r,request_id:n}}).catch(function(e){var t=e.data,r=e.args,n=e.request_id;var a=false;i(a,t,r,n);return{data:t,args:r,request_id:n}})},fetchFileInfo:function e(t,r,n){var i=false;return a(t,i,r,n)},fetchFileInfoRaw:function e(t,r,n){var i=true;return a(t,i,r,n)},onFileUnShare:function e(t,r,n){if(!t)return;TS.files.fetchFileInfo(n.file,function(e,t){if(TS.web)TS.files.upsertAndSignal(t)})},fetchTeamFiles:function e(r,n){var i=function e(t,r,i){if(t)if(r.files){var a;for(var s=0;s<r.files.length;s+=1){a=r.files[s];TS.files.upsertFile(a)}}if(n)n(t,r,i)};TS.api.call("files.list",{types:r,count:t}).then(function(e){var t=e.data,r=e.args,n=e.request_id;var a=true;i(a,t,r,n);return{data:t,args:r,request_id:n}}).catch(function(e){var t=e.data,r=e.args,n=e.request_id;var a=false;i(a,t,r,n);return{data:t,args:r,request_id:n}})},fetchMemberFiles:function e(r,n,i){var a=function e(t,r,n){if(t)if(r.files){var a;for(var s=0;s<r.files.length;s+=1){a=r.files[s];TS.files.upsertFile(a)}}if(i)i(t,r,n)};TS.api.call("files.list",{user:r,types:n,count:t}).then(function(e){var t=e.data,r=e.args,n=e.request_id;var i=true;a(i,t,r,n);return{data:t,args:r,request_id:n}}).catch(function(e){var t=e.data,r=e.args,n=e.request_id;var i=false;a(i,t,r,n);return{data:t,args:r,request_id:n}})},fetchChannelFiles:function e(t,r,n,i){var a=i&&i.length?i.join(","):"";if(r){var s=function e(t,n,i){if(t)TS.files.onChannelFetch(t,n,i);r(t,n,i)};TS.api.call("files.list",{channel:t,types:a,count:n}).then(function(e){var t=e.data,r=e.args,n=e.request_id;var i=true;s(i,t,r,n);return{data:t,args:r,request_id:n}}).catch(function(e){var t=e.data,r=e.args,n=e.request_id;var i=false;s(i,t,r,n);return{data:t,args:r,request_id:n}})}else TS.api.call("files.list",{channel:t,types:a}).then(function(e){var t=e.data,r=e.args,n=e.request_id;var i=true;if(TS.files.onChannelFetch)TS.files.onChannelFetch(i,t,r,n);return{data:t,args:r,request_id:n}}).catch(function(e){var t=e.data,r=e.args,n=e.request_id;var i=false;if(TS.files.onChannelFetch)TS.files.onChannelFetch(i,t,r,n);return{data:t,args:r,request_id:n}})},fetchMultipleFiles:function e(t,r,n){var i=function e(t,i,a){if(t)if(i.files&&!n){var s;for(var o=0;o<i.files.length;o+=1){s=i.files[o];TS.files.upsertFile(s)}}if(r)r(t,i,a)};return TS.api.call("files.list",{files:t.join(",")}).then(function(e){var t=e.data,r=e.args,n=e.request_id;var a=true;i(a,t,r,n);return{data:t,args:r,request_id:n}}).catch(function(e){var t=e.data,r=e.args,n=e.request_id;var a=false;i(a,t,r,n);return{data:t,args:r,request_id:n}})},fetchMultipleFilesRaw:function e(t){var r=null;var n=true;return TS.files.fetchMultipleFiles(t,r,n)},onChannelFetch:function e(t,r,n){if(!t)return;if(r.files){var i;for(var a=0;a<r.files.length;a+=1){i=r.files[a];TS.files.upsertFile(i)}}TS.files.channel_files_fetched_sig.dispatch(n.channel,r.files)},addComment:function e(t,r,n,i){var a={file:t,comment:r,channel:n||""};var s=function e(t,r,n){TS.files.onFileComment(t,r,n);if(i)i(t,r,n)};TS.api.callImmediately("files.comments.add",a).then(function(e){var t=e.data,r=e.args,n=e.request_id;var i=true;s(i,t,r,n);return{data:t,args:r,request_id:n}}).catch(function(e){var t=e.data,r=e.args,n=e.request_id;var i=false;s(i,t,r,n);return{data:t,args:r,request_id:n}})},onFileComment:function e(t,r,n){if(!t)return;var i=TS.files.getFileById(n.file);if(!i){TS.error("no file? "+n.file);return}TS.files.addCommentToFile(r.comment,i)},getFileById:function e(t){if(TS.useReduxFiles())return TS.redux.files.getFileById(t);return TS.files.getFileByProp("id",t)},getFileByDownloadUrlPrivate:function e(t){return TS.files.getFileByProp("url_private_download",t)},getFileByProp:function e(t,r){if(TS.useReduxFiles())return TS.redux.files.getFileByProp(t,r);if(!t)return null;if(!r)return null;var n=TS.model.files;var i;for(var a=0;a<n.length;a+=1){i=n[a];if(i[t]==r)return i}return null},getFileActions:function e(t){if(!t)return;var r={};var n=false;if(t.user==TS.model.user.id)n=true;if(t.is_public)r.share=true;else if(n)r.share=true;else r.share_private_file=true;r.comment=true;if(!t.public_url_shared&&"external"!==t.mode&&!TS.model.user.is_restricted&&!TS.prefs.getTeamPref("disallow_public_file_urls"))if(t.is_public)r.create_public_link=true;else if(n)r.create_public_link=true;if(t.public_url_shared&&!TS.model.user.is_restricted&&(TS.model.user.is_admin||n)&&!TS.prefs.getTeamPref("disallow_public_file_urls"))r.revoke_public_link=true;if("hosted"===t.mode||"snippet"===t.mode)r.download=true;if(t.mimetype&&0===t.mimetype.indexOf("image/")||"pdf"===t.filetype||"external"===t.mode||"snippet"===t.mode||"email"===t.mode)r.open_original=true;if(TS.web)if("post"===t.mode||"snippet"===t.mode||"space"===t.mode||"email"===t.mode||"arugula"===t.mode)r.print=true;if("space"===t.mode&&!("USLACKBOT"===t.user&&"Getting_Started_with_Posts"===t.name))r.learn_more=true;if("space"===t.mode||"arugula"===t.mode)r.new_window=true;if("space"===t.mode&&"locked"!==t.state)r.edit=true;if(n){if("snippet"===t.mode||"post"===t.mode||"space"===t.mode||"arugula"===t.mode)r.edit=true;if("hosted"===t.mode||"email"===t.mode)r.edit_title=true;r.delete_file=true}if(TS.model.user.is_admin){var i=TS.utility.teams.isMemberExternalById(t.user);r.delete_file=!i}if(TS.clipboard.canWriteText())r.copy_file_link=true;if("external"===t.mode)if(n||TS.model.user.is_admin)r.refresh=true;if(window.Dropbox&&Dropbox.isBrowserSupported()&&TS.prefs.getPref("dropbox_enabled"))if("hosted"===t.mode)r.save_to_dropbox=true;if(TS.client){var a=TS.shared.getActiveModelOb();if(TS.pins.canUserPinHere(a))if(t.pinned_to&&-1!==t.pinned_to.indexOf(a.id))r.unpin_file=true;else{var s=!!t.is_public;if(t.channels)s=s||-1!==t.channels.indexOf(a.id);else TS.warn("No channels array for file object in getFileActions(): "+t.id);if(t.groups)s=s||-1!==t.groups.indexOf(a.id);else TS.warn("No groups array for file object in getFileActions(): "+t.id);if(t.ims)s=s||-1!==t.ims.indexOf(a.id);else TS.warn("No ims array for file object in getFileActions(): "+t.id);if(s)r.pin_file=true}}r.rxn_file=true;if(TS.prefs.getTeamPref("disable_file_editing")){r.edit=false;r.edit_title=false}if(TS.prefs.getTeamPref("disable_file_deleting"))r.delete_file=false;if(t.is_tombstoned){r.edit=false;r.edit_title=false;r.delete_file=false}return r},getFileCommentActions:function e(t,r){if(!t)return{};var n={can_edit:true,can_delete:true};if(t.user!=TS.model.user.id)n.can_edit=false;else if(TS.prefs.getTeamPref("msg_edit_window_mins")>-1&&(Date.now()-TS.interop.datetime.toDateObject(t.timestamp))/6e4>TS.prefs.getTeamPref("msg_edit_window_mins"))n.can_edit=false;if(!TS.prefs.getTeamPref("allow_message_deletion")){if(!TS.model.user.is_admin)n.can_delete=false}else if(t.user!=TS.model.user.id)if(!TS.model.user.is_admin)n.can_delete=false;if(TS.client){var i=TS.shared.getActiveModelOb();if(TS.pins.canUserPinHere(i))if(t.pinned_to&&-1!==t.pinned_to.indexOf(i.id))n.can_unpin=true;else{var a=!!r.is_public;if(r.channels)a=a||-1!==r.channels.indexOf(i.id);else TS.warn("No channels array for file object in getFileCommentActions(): "+r.id);if(r.groups)a=a||-1!==r.groups.indexOf(i.id);else TS.warn("No groups array for file object in getFileCommentActions(): "+r.id);if(r.ims)a=a||-1!==r.ims.indexOf(i.id);else TS.warn("No ims array for file object in getFileCommentActions(): "+r.id);if(a)n.can_pin=true}}n.rxn_file_comment=true;return n},getThumbSrcForFile:function e(t,r){try{t=o(t)}catch(e){return false}if(!t.thumb_360&&!t.thumb_360_gif)return false;if(!r)r={};if(!r.max_size)r.max_size=480;if(false===TS.prefs.getPref("a11y_animations")&&"gif"===t.filetype){if(t.deanimate_gif)return t.deanimate_gif;if(r.max_size>360&&t.thumb_480)return t.thumb_480;else if(t.thumb_160)return t.thumb_160}if(t.thumb_480_gif||t.thumb_360_gif){if(r.max_size>360&&t.thumb_480_gif)return t.thumb_480_gif;if(t.thumb_360_gif)return t.thumb_360_gif}if(TS.boot_data.feature_pjpeg&&t.pjpeg)return t.pjpeg;if(TS.boot_data.feature_pdf_thumb&&t.thumb_pdf)return t.thumb_pdf;if(r.max_size>480&&t.thumb_1024)return t.thumb_1024;if(r.max_size>360&&t.thumb_960)return t.thumb_960;if(t.thumb_720)return t.thumb_720;if(t.thumb_480)return t.thumb_480;return t.thumb_360},fileIsImage:function e(t){try{t=o(t)}catch(e){return false}var r=t.thumb_360||t.thumb_360_gif;var n=t.mimetype&&-1!==t.mimetype.indexOf("image/");return r&&n},fileHasRichPreview:function e(t){try{t=o(t)}catch(e){return false}var r=t.mimetype&&-1!==t.mimetype.indexOf("image/");return t.has_rich_preview&&!r},fileIsSupportedAudio:function e(t){return TS.files.supported_audio_type_re.test(o(t).filetype)},fileIsSupportedVideo:function e(t){return TS.files.supported_video_type_re.test(o(t).filetype)},fileIsHostedSupportedMedia:function e(t){try{t=o(t)}catch(e){return false}var r=TS.files.fileIsSupportedAudio(t)||TS.files.fileIsSupportedVideo(t);var n=!t.is_external||!_.isEmpty(_.get(t,"video.outputs"));return r&&n},fileIsPDF:function e(t){try{t=o(t)}catch(e){return false}return"pdf"===t.filetype},getFileTemplateArguments:function e(t,r){var n={};n.current_user_id=TS.model.user.id;n.file_partial="generic";if(/(snippet|post|email|arugula)/.test(t.mode))n.file_partial=t.mode;if(/(space)/.test(t.mode))n.file_partial="post";if(TS.files.fileIsImage(t)){n.file_partial="image";n.image_src=TS.files.getThumbSrcForFile(t,{max_size:r});n.image_width=360===r?t.thumb_360_w:t.thumb_480_w||t.thumb_360_w;n.image_height=360===r?t.thumb_360_h:t.thumb_480_h||t.thumb_360_h;n.preserve_aspect_ratio=n.image_width>0&&n.image_height>0;n.preview_actions_class="";if(n.image_width<170||n.image_height<50)n.preview_actions_class+=" overflow_preview_actions";if(n.image_width<170)n.preview_actions_class+=" overflow_preview_actions_width"}if(/(post|space|email|arugula|generic)/.test(n.file_partial))n.title_hider=true;if("snippet"===t.mode)n.title_hider="Untitled"===t.title;n.filesize=t.size>2e4&&!/(gdoc|gpres|gsheet|gdraw)/.test(t.filetype);if(!/(space|post)/.test(t.filetype))n.meta_filetype=new Handlebars.SafeString(TS.templates.builders.makeFiletypeHTML(t));if(TS.templates.builders.makeExternalFiletypeHTML(t)===n.meta_filetype)n.meta_filetype=false;if(TS.files.fileIsHostedSupportedMedia(t)){if(TS.files.fileIsSupportedVideo(t)){n.file_is_video=true;var i={width:t.width,height:t.height,source:t.url_private,size:t.size};if(t.video){n.transcoding_status=t.video.status;if(t.video.outputs)for(var a=t.video.outputs.length-1;a>=0;a-=1){var s=t.video.outputs[a];if(!s.source)continue;if(!i.width||s.width>i.width)i=s}}n.video_height=TS.model.native_video_embed_height;if(t.thumb_video)n.poster=t.thumb_video;n.best_source=i.source}if(TS.files.fileIsSupportedAudio(t)){n.file_is_audio=true;n.audio_preload="metadata";if(t.size<=TS.model.native_media_preload_limit_bytes)n.audio_preload="auto"}}return n},getFileDetailsMetaTemplateArguments:function e(t){var r=TS.files.getFileActions(t);var n="post"===t.mode;var i="space"===t.mode||"post"===t.mode;var a="snippet"===t.mode;var s="arugula"===t.mode;var o={file:t,user:TS.model.user,download:"hosted"===t.mode,edit_link:n?t.edit_link:t.permalink,edit:(i||a)&&t.user===TS.model.user.id,is_post:n,is_post_or_space:i,is_snippet:a,is_arugula:s,show_open_public_link:!TS.prefs.getTeamPref("disallow_public_file_urls"),show_revoke_public_link:!TS.prefs.getTeamPref("disallow_public_file_urls")&&r.revoke_public_link};if("email"===t.mode){o.to_more_count=t.to.length-1;o.cc_more_count=t.cc.length-1}if(t&&t.id)if("snippet"===t.mode||"post"===t.mode||"space"===t.mode)if(!t.content&&!t.content_html&&!t.content_highlight_html)TS.files.fetchFileInfo(t.id);return o},createFileCommentsGroup:function e(t){var r={};function n(e,t,n){var i=TS.shared.getModelObById(t);var a=i&&TS.shared.getDisplayNameForModelOb(i);var s=e.share_info&&e.share_info[t];var o=s&&s.timestamp;var l=TS.members.getMemberById(s&&s.user_id);var u=l&&TS.members.getPrefCompliantMemberName(l);r[t]={name:a,first_share:{name:u,timestamp:o},comments:n?[n]:[]}}for(var i=t.comments.length-1;i>=0;i-=1){var a=t.comments[i];if(a.channel)if(r[a.channel])r[a.channel].comments.unshift(a);else n(t,a.channel,a)}_.each([t.channels,t.groups,t.ims,t.mpims],function(e){if(e)for(var i=e.length-1;i>=0;i-=1){var a=e[i];if(!r[a])n(t,a)}});t._comments_grouped=r},resetFileCommentsGroup:function e(t){t._comments_grouped=null},sortFiles:function e(t){function r(e,t){if(e.timestamp<t.timestamp)return 1;if(e.timestamp>t.timestamp)return-1;return 0}t.sort(r)},getFileCommentById:function e(t,r){var n;for(var i=0;i<t.comments.length;i+=1){n=t.comments[i];if(n.id==r)return n}return null},addCommentToFile:function e(t,r){var n=TS.files.getFileCommentById(r,t.id);if(n)return n;t._rxn_key=TS.rxns.getRxnKey("file_comment",t.id);TS.rxns.upsertRxnsFromDataAndUpdateUI(t._rxn_key,t.reactions);delete t.reactions;r.comments.push(t);TS.files.sortCommentsOnFile(r);TS.files.team_file_comment_added_sig.dispatch(r,t);return t},editCommentOnFile:function e(t,r){var n;var i=false;var a=false;for(var s=0;s<r.comments.length;s+=1){n=r.comments[s];if(n.id==t.id){i=true;r.comments[s]=t;if(n.is_starred)t.is_starred=true;if(n._rxn_key)t._rxn_key=n._rxn_key;if(n.pinned_to&&!t.pinned_to)t.pinned_to=n.pinned_to;if(r.initial_comment&&n.id==r.initial_comment.id){r.initial_comment=t;a=true}break}}if(!i)return false;TS.files.sortCommentsOnFile(r);TS.files.team_file_comment_edited_sig.dispatch(r,t);if(a)TS.files.team_file_changed_sig.dispatch(r);return true},deleteCommentOnFile:function e(t,r){var n;var i=[];var a;for(var s=0;s<r.comments.length;s+=1){n=r.comments[s];if(n.id==t){a=n;if(r.initial_comment&&n.id==r.initial_comment.id)r.initial_comment=null;continue}i.push(n)}if(i.length==r.comments.length)return;r.comments=i;TS.files.sortCommentsOnFile(r);TS.files.team_file_comment_deleted_sig.dispatch(r,t,a);TS.files.team_file_changed_sig.dispatch(r)},sortCommentsOnFile:function e(t){function r(e,t){if(e.timestamp>t.timestamp)return 1;if(e.timestamp<t.timestamp)return-1;return 0}t.comments.sort(r)},upsertFile:function e(t){if(Object.keys(t).length<2)TS.error("upserting a bad file object! it has less than 2 properties");if("space"===t.mode){try{if(t.preview&&/^\s*<document>/.test(t.preview)){var n=$(t.preview);if(n.length)t.preview=n.html();if(n.length){var a=n.children().eq(0);if(a.hasClass("list"))a.find("li:not(:first)").remove();if("pre"===a.prop("tagName").toLowerCase())t.preview_in_list=a.length?'<span class="monospace">'+_.escape(a.text())+"</span>":"";else t.preview_in_list=a.length?_.escape(a.text()):""}}}catch(e){TS.log(93,"problem with file.preview id:"+t.id);if(TS.boot_data.feature_tinyspeck)TS.log(93,"(TS-ONLY log) file.preview: "+t.preview)}try{if(t.content_html&&(!TS.useReactMessages()||/^\s*<document>/.test(t.content_html))){var s=$(t.content_html);if(s.length)t.content_html=s.html()}}catch(e){TS.log(93,"problem with file.content_html id:"+t.id);if(TS.boot_data.feature_tinyspeck)TS.log(93,"(TS-ONLY log) file.content_html: "+t.content_html)}}if("post"===t.mode&&t.preview){var o=t.preview;var l=o.split("\n");var u=l.length;for(var d=0;d<u;d+=1){var c=l[d];if(c){t.preview_in_list=c;break}}}if("snippet"===t.mode){var m=["content","content_highlight_html"];var f=12800;_.forEach(m,function(e){if(t[e]&&t[e].length>f){var r=truncate(t[e],f);if(r!==t[e]){t[e]=r;t.is_truncated=true}}})}if(t.filetype)t.pretty_type=TS.i18n.getStaticTranslation(t.filetype,"file_pretty_type_strings")||t.pretty_type;var p=TS.files.getFileById(t.id);var h="NOOP";var g=[];var S;var T;var v;var b;TS.files.maybePruneChannels(t);if(TS.boot_data.page_needs_enterprise&&t.permalink&&TS.boot_data.feature_file_links_betterer){var y=t.permalink;var w=t.permalink.indexOf("?")>-1?"&":"?";y=""+y+w+"origin_team="+TS.model.team.id;t.permalink=y}if(p){if(TS.useReduxFiles())p=_.assign({},p);t._rxn_key=TS.rxns.getRxnKey("file",t.id);v=TS.rxns.getExistingRxnsByKey(t._rxn_key);if(v&&!t.reactions)TS.warn("file:"+t.id+" has reactions in local model, but we are upserting an object that does NOT have reactions, which seems suspicious");else TS.rxns.upsertRxnsFromDataAndUpdateUI(t._rxn_key,t.reactions);delete t.reactions;if(t.comments)for(b=0;b<t.comments.length;b+=1){T=t.comments[b];T._rxn_key=TS.rxns.getRxnKey("file_comment",T.id);v=TS.rxns.getExistingRxnsByKey(T._rxn_key);if(v&&!T.reactions)TS.warn("comment:"+t.id+" has reactions in local model, but we are upserting an object that does NOT have reactions, which seems suspicious");else TS.rxns.upsertRxnsFromDataAndUpdateUI(T._rxn_key,T.reactions);delete T.reactions}if(t.initial_comment){t.initial_comment._rxn_key=TS.rxns.getRxnKey("file_comment",t.initial_comment.id);v=TS.rxns.getExistingRxnsByKey(t.initial_comment._rxn_key);if(v&&!t.initial_comment.reactions)TS.warn("initial_comment:"+t.id+" has reactions in local model, but we are upserting an object that does NOT have reactions, which seems suspicious");else TS.rxns.upsertRxnsFromDataAndUpdateUI(t.initial_comment._rxn_key,t.initial_comment.reactions);delete t.initial_comment.reactions}if(t.is_tombstoned!==p.is_tombstoned)for(var k in p)if("is_tombstoned"===k)p[k]=!!t[k];else delete p[k];else if(t.is_tombstoned==p.is_tombstoned&&!t.is_tombstoned)delete p.is_tombstoned;t.is_starred=!!t.is_starred;S=(p.channels||[]).concat(p.ims||[]).concat(p.groups||[]);for(var x in t)if("channels"===x||"ims"===x||"groups"===x||"pinned_to"===x||"to"===x||"from"===x||"cc"===x||"attachments"===x){var C=false;var M=_.isArray(t[x])?t[x]:[];var I=_.isArray(p[x])?p[x]:[];if("to"===x||"from"===x||"cc"===x||"attachments"===x){if(I.length!=M.length)C=true}else if(I.join("")!=M.join("")){C=true;if("channels"===x||"ims"===x||"groups"===x)S=S.concat(t[x]||[])}if(C){p[x]=t[x];h="CHANGED";g.push(x)}}else if("preview"===x){if(p[x]!==t[x]){p[x]=t[x];if(p.content)delete p.content;if(p.content_html)delete p.content_html;if(p.content_highlight_html)delete p.content_highlight_html;h="CHANGED";g=g.concat([x,"content","content_html","content_highlight_html"])}}else if("comments"===x){if(t[x]&&!TS.utility.areSimpleObjectsEqual(t[x],p[x],"file:"+t.id+" "+t.name)){p[x]=t[x];h="CHANGED";g.push(x)}}else if("content"===x){if(t[x]&&p[x]!=t[x]){p[x]=t[x];h="CHANGED";g.push(x)}}else if("editor"===x||"state"===x){if(t[x]!=p[x]){S=[];g.push(x);p[x]=t[x];h="CHANGED"}}else if("initial_comment"===x)p[x]=t[x];else if("reactions"===x)p[x]=t[x];else if(("channel_map"===x||"group_map"===x||"im_map"===x||"teams"===x||"teams_shared_with"===x||"users"===x)&&!TS.utility.isScalar(t[x]))p[x]=t[x];else if("video"===x){if(t[x]&&!TS.utility.areSimpleObjectsEqual(t[x],p[x],"file:"+t.id+" "+t.name)){p[x]=t[x];h="CHANGED";g.push(x)}}else if(p[x]!=t[x])if(t[x]&&!TS.utility.isScalar(t[x])){p[x]=t[x];TS.warn(x+" is not scalar! it needs to be handled by upsertFile specifically to test if it has changed! "+r(t[x]))}else if("boolean"!==typeof t[x]||!t[x]!=!p[x]){g.push(x+" ["+p[x]+"] -> ["+t[x]+"]");p[x]=t[x];h="CHANGED"}}else{h="ADDED";t._rxn_key=TS.rxns.getRxnKey("file",t.id);TS.rxns.upsertRxnsFromDataAndUpdateUI(t._rxn_key,t.reactions);delete t.reactions;if(t.comments){for(b=0;b<t.comments.length;b+=1){T=t.comments[b];T._rxn_key=TS.rxns.getRxnKey("file_comment",T.id);TS.rxns.upsertRxnsFromDataAndUpdateUI(T._rxn_key,T.reactions);delete T.reactions}if(t.initial_comment){t.initial_comment._rxn_key=TS.rxns.getRxnKey("file_comment",t.initial_comment.id);TS.rxns.upsertRxnsFromDataAndUpdateUI(t.initial_comment._rxn_key,t.initial_comment.reactions);delete t.initial_comment.reactions}}if(!TS.useReduxFiles())TS.model.files.push(t);var P=TS.members.getPotentiallyUnknownMemberById(t.user);if(P){P.files.push(t);TS.files.sortFiles(P.files)}else TS.error("hmmm, file "+t.id+" does not have a known user "+t.user);i(t);p=t}if("CHANGED"===h){i(t);if(_.includes(g,"comments"))TS.utility.msgs.updateCommentReferences(p)}if(!p.comments)p.comments=[];else p.comments_count=Math.max(p.comments_count,p.comments.length);if(!p.channels)p.channels=[];if(!p.ims)p.ims=[];if(!p.groups)p.groups=[];p.is_shared=p.groups.length>0||p.channels.length>0;if(TS.useReduxFiles()&&"NOOP"!==h)TS.redux.files.upsertFile(p);TS.files.sortFiles(TS.model.files);return{status:h,file:p,what_changed:g}},upsertAndSignal:function e(t){var r=TS.files.upsertFile(t);if("CHANGED"===r.status)TS.files.team_file_changed_sig.dispatch(r.file);else if("ADDED"===r.status)TS.files.team_file_added_sig.dispatch(r.file);return r},removeFile:function e(t){TS.log(4,'removing file "'+t+'"');var r=TS.files.getFileById(t);if(r)r.is_deleted=true;TS.model.channels.forEach(function(e){if(r)TS.utility.msgs.removeFileSharesAndMentions(e,r);if(r)TS.utility.msgs.removeFileComments(e,r);TS.utility.msgs.removeFileReferences(e,t)});TS.model.groups.forEach(function(e){if(r)TS.utility.msgs.removeFileSharesAndMentions(e,r);if(r)TS.utility.msgs.removeFileComments(e,r);TS.utility.msgs.removeFileReferences(e,t)});TS.model.ims.forEach(function(e){if(r)TS.utility.msgs.removeFileSharesAndMentions(e,r);if(r)TS.utility.msgs.removeFileComments(e,r);TS.utility.msgs.removeFileReferences(e,t)});TS.model.mpims.forEach(function(e){if(r)TS.utility.msgs.removeFileSharesAndMentions(e,r);if(r)TS.utility.msgs.removeFileComments(e,r);TS.utility.msgs.removeFileReferences(e,t)});if(r)TS.files.team_file_deleted_sig.dispatch(r)},upload:function e(t){if(TS.files.uploading)TS.files.uploadQ.push(t);else TS.files.actuallyUpload(t)},actuallyUpload:function t(r){TS.files.uploading=true;r.retry_num=r.retry_num||0;var n=new FormData;var i;var a=!!r.file;if(r.title)r.title=TS.emoji.maybeGetCanonicalEmojiString(r.title);if(r.text){i=r.title||r.filetype;TS.files.file_uploading_sig.dispatch(i,r.retry_num>0,a);n.append("content",r.text);if(r.filetype)n.append("filetype",r.filetype);if(r.filename)TS.warn("ignoring filename because it makes no sense for text files")}else{i=r.title||r.filename||r.file&&r.file.name||"blob";TS.files.file_uploading_sig.dispatch(i,r.retry_num>0,a);if("string"===typeof r.file)n.append("content64",r.file);else n.append("file",r.file);if(r.filename)n.append("filename",r.filename);if(r.filetype)TS.warn("ignoring filetype we send a filename which can intuit it")}n.append("token",TS.model.api_token);if(r.channels&&r.channels.length){var s="";if("string"===typeof r.channels)s=r.channels;else if(r.channels.join)s=r.channels.join(",");n.append("channels",s)}n.append("title",r.title);if(r.initial_comment)n.append("initial_comment",r.initial_comment);var o="files.uploadAsync";if(r.link){if(r.is_dropbox)o="files.uploadExternal";if(r.is_box)o="files.uploadExternal";n.append("link",r.link)}var l;if("files.uploadAsync"===o)l=TS.model.async_api_url+o;else l=TS.model.api_url+o;var u=false;e=$.ajax({url:l,data:n,dataType:"json",cache:false,contentType:false,processData:false,type:"POST",xhr:function e(){var e=jQuery.ajaxSettings.xhr();if(e.upload)e.upload.addEventListener("progress",function(e){if(e.lengthComputable){var t=parseInt(100*e.loaded/e.total,10);TS.files.file_progress_sig.dispatch(t)}else TS.info("Upload length not computable")},false);return e},error:function e(t,n,a){u=true;TS.info("Error: Failed to upload file.");TS.info("textStatus:"+n+" errorThrown:"+a);TS.info("data:"+t);if("abort"===n){TS.files.file_canceled_sig.dispatch(i);TS.files.uploadOver(false);return}if(0===r.retry_num){r.retry_num+=1;TS.files.actuallyUpload(r)}else TS.generic_dialog.start({title:TS.i18n.t("Upload failed","files")(),body:TS.i18n.t("Hmm, it looks like your file failed to upload. Want to try again?","files")(),go_button_text:TS.i18n.t("Yes, try again","files")(),cancel_button_text:TS.i18n.t("No, cancel","files")(),onGo:function e(){r.retry_num+=1;TS.files.actuallyUpload(r)},onCancel:function e(){TS.files.uploadOver(false)}})},complete:function e(t){if(u)return;t=jQuery.parseJSON(t.responseText);if(t&&t.ok&&t.file)if("files.uploadAsync"===o){var n=function e(t,r,n){if(!TS.files.polling_file_id)return;if(t)if("complete"===r.status){var i=TS.files.upsertAndSignal(r.file);TS.files.uploadProcessingOver(true,i.file.id)}else if("failed"===r.status){var a="";if(r.debug&&TS.boot_data.feature_tinyspeck)a="<br><br>TS only Debugging:<br><br>"+r.debug;TS.generic_dialog.start({title:TS.i18n.t("Upload failed","files")(),body:TS.i18n.t("Hmm, it looks like your file failed to upload. Want to try again?","files")()+a,go_button_text:TS.i18n.t("Yes, try again","files")(),cancel_button_text:TS.i18n.t("No, cancel","files")(),onGo:function e(){n.retry_num+=1;TS.files.actuallyUpload(n)},onCancel:function e(){TS.files.uploadProcessingOver(false,TS.files.polling_file_id)}})}else TS.files.pollForUploadProcessing();else{TS.generic_dialog.start({title:TS.i18n.t("Upload failed","files")(),body:TS.i18n.t("Hmm, it looks like your file failed to upload.","files")(),show_cancel_button:true});TS.files.uploadProcessingOver(false,TS.files.polling_file_id)}};TS.files.startPollingForUploadProcessing(t.file,t.ticket,n)}else{var i=TS.files.upsertAndSignal(t.file);TS.files.uploadOver(t.ok,i.file.id)}else{TS.info("Error: Failed to upload file.");TS.info(t);if(t)if(0===r.retry_num){r.retry_num+=1;TS.files.actuallyUpload(r)}else if("folders_not_supported"===t.error)TS.generic_dialog.start({title:TS.i18n.t("Folders not supported","files")(),body:TS.i18n.t("<p>Sorry, <strong>{folder_name}</strong> is a folder, and folder uploads are not supported by Slack.</p>\t\t\t\t\t\t\t\t\t<p>Try uploading a .zip version of the file instead.</p>","files")({folder_name:_.escape(r.filename)}),show_cancel_button:false,esc_for_ok:true,onGo:function e(){TS.generic_dialog.end();TS.files.uploadOver(false)}});else if("request_timeout"===t.error)TS.generic_dialog.start({title:TS.i18n.t("File upload timed out","files")(),body:TS.i18n.t('<p>It looks like you’re on a slow or inconsistent internet connection. You may want to try your file upload again later. Or, try again now and it might work if you cross your fingers!</p>\t\t\t\t\t\t\t\t\t<p>If you’re still having problems, you can:</p>\t\t\t\t\t\t\t\t\t<ul><li><a href="/help/test" target="{new_win_name}" class="bold">Run our Self-Help Tests</a></li>\t\t\t\t\t\t\t\t\t<li><a href="/help/requests/new" target="{new_win_name}" class="bold">Contact our support team</li></ul>',"files")({new_win_name:TS.templates.builders.newWindowName()}),show_cancel_button:false,esc_for_ok:true,onGo:function e(){TS.generic_dialog.end();TS.files.uploadOver(false)}});else if("file_uploads_disabled"===t.error)TS.generic_dialog.start({title:TS.i18n.t("Upload failed","files")(),body:TS.i18n.t("At the request of your administrator, file uploads have been disabled on this workspace.","files")(),show_cancel_button:false,onGo:function e(){TS.files.uploadOver(false)}});else if("file_uploads_except_images_disabled"===t.error)TS.generic_dialog.start({title:TS.i18n.t("Upload failed","files")(),body:TS.i18n.t("At the request of your administrator, only images can be uploaded to this workspace.","files")(),show_cancel_button:false,onGo:function e(){TS.files.uploadOver(false)}});else TS.generic_dialog.start({title:TS.i18n.t("Upload failed","files")(),body:TS.i18n.t("Hmm, it looks like your file failed to upload. Want to try again?","files")(),go_button_text:TS.i18n.t("Yes, try again","files")(),cancel_button_text:TS.i18n.t("No, cancel","files")(),onGo:function e(){r.retry_num+=1;TS.files.actuallyUpload(r)},onCancel:function e(){TS.files.uploadOver(false)}});else{alert("Upload failed.");TS.files.uploadOver(false)}}}})},startPollingForUploadProcessing:function e(t,r,n){TS.files.polling_count=0;TS.files.polling_file_id=t;TS.files.polling_ticket=r;TS.files.polling_handler=n;TS.files.pollForUploadProcessing()},pollForUploadProcessing:function e(){TS.files.polling_count+=1;TS.files.polling_tim=setTimeout(function(){if(!TS.files.polling_ticket)return;var e=function e(t,r,n){if(!TS.files.polling_ticket)return;TS.files.polling_handler(t,r,n)};TS.api.callImmediately("files.uploadStatus",{ticket:TS.files.polling_ticket}).then(function(t){var r=t.data,n=t.args,i=t.request_id;var a=true;e(a,r,n,i);return{data:r,args:n,request_id:i}}).catch(function(t){var r=t.data,n=t.args,i=t.request_id;var a=false;e(a,r,n,i);return{data:r,args:n,request_id:i}})},1e3*TS.files.polling_count)},uploadProcessingOver:function e(t,r){if(TS.files.polling_file_id!=r)return;TS.info("TS.files.uploadProcessingOver polling_file_id:"+TS.files.polling_file_id+" polling_ticket:"+TS.files.polling_ticket+" polling_count:"+TS.files.polling_count);TS.files.polling_count=0;TS.files.polling_file_id=null;TS.files.polling_ticket=null;TS.files.polling_handler=null;clearTimeout(TS.files.polling_tim);TS.files.uploadOver(t,r)},uploadOver:function t(r,n){TS.files.file_uploaded_sig.dispatch(r,n);TS.files.uploading=false;e=null;if(TS.files.uploadQ.length)TS.files.actuallyUpload.call(null,TS.files.uploadQ.shift());else TS.files.file_queue_emptied_sig.dispatch()},cancelCurrentUpload:function t(){if(e)e.abort()},deleteFile:function e(t){TS.api.call("files.delete",{file:t}).then(function(e){var t=e.data,r=e.args,n=e.request_id;var i=true;if(TS.files.onFileDelete)TS.files.onFileDelete(i,t,r,n);return{data:t,args:r,request_id:n}}).catch(function(e){var t=e.data,r=e.args,n=e.request_id;var i=false;if(TS.files.onFileDelete)TS.files.onFileDelete(i,t,r,n);return{data:t,args:r,request_id:n}})},onFileDelete:function e(t){if(!t);},endEditFileTitle:function e(){$("#file_edit_title_container").addClass("hidden");$("#file_title_container").removeClass("hidden")},saveEditFileTitle:function e(t){var r=TS.files.getFileById(t);if(!r)return;var n=$("#file_edit_title_input").val();if(!$.trim(n)){TS.sounds.play("beep");return}var i=r.title;if(i==n){TS.files.endEditFileTitle();return}var a=function e(r){if(!r){TS.files.upsertAndSignal({id:t,title:i});TS.generic_dialog.alert(TS.i18n.t("Something’s gone wrong, and your change didn’t save. If you see this message more than once, you may want to try restarting Slack.","files")(),TS.i18n.t("Oh, crumbs!","files")(),TS.i18n.t("Got it","files")())}};TS.api.callImmediately("files.edit",{file:t,title:TS.emoji.maybeGetCanonicalEmojiString(n)}).then(function(e){var t=e.data,r=e.args,n=e.request_id;var i=true;a(i,t,r,n);return{data:t,args:r,request_id:n}}).catch(function(e){var t=e.data,r=e.args,n=e.request_id;var i=false;a(i,t,r,n);return{data:t,args:r,request_id:n}});n=_.escape(n);TS.files.upsertAndSignal({id:t,title:n});TS.files.endEditFileTitle()},editFileTitle:function e(t){var r=TS.files.getFileById(t);if(!r)return;var n=r.title;if(n)n=TS.format.unFormatMsg(n);else n=r.name;$("#file_title_container").addClass("hidden");$("#file_edit_title_container").removeClass("hidden");$("#file_edit_title_input").val(n);$("#file_edit_title_input").select()},openBoxChooser:function e(){TS.utility.box.unregister(TS.utility.box.SUCCESS_EVENT_TYPE,TS.files.onBoxChooser);TS.utility.box.success(TS.files.onBoxChooser);TS.utility.box.launchPopup()},onBoxChooser:function e(t){var r=new Array(t.length);for(var n=0;n<t.length;n+=1){var i=t[n];r[n]={name:i.name,link:i.url,is_box:true}}TS.ui.upload_dialog.startWithCommentFromChatInput(r)},openDropboxChooser:function e(){var t="preview";Dropbox.choose({success:TS.files.onDropboxChooser,linkType:t,multiselect:true})},onDropboxChooser:function e(t){var r=[];for(var n=0;n<t.length;n+=1){var i=t[n];r.push({name:i.name,size:i.bytes,link:i.link,icon:i.icon,is_dropbox:true})}TS.ui.upload_dialog.startWithCommentFromChatInput(r)},makeFileNameFromFile:function e(t){return t.name||TS.i18n.t("Pasted image at {date}","files")({date:TS.interop.datetime.toFilenameFriendlyDate(Date.now()/1e3)})+".png"},makeFileTitleFromFile:function e(t){return t.name||TS.i18n.t("Pasted image at {date}","files")({date:TS.interop.datetime.toDate(Date.now()/1e3)})},justUploadTheseFileNow:function e(t){var r;for(var n=0;n<t.length;n+=1){r=t[n];if(r.size>TS.model.upload_file_size_limit_bytes)continue;TS.files.upload({file:r,filename:TS.files.makeFileNameFromFile(r),title:TS.files.makeFileTitleFromFile(r),channels:[TS.shared.getActiveModelOb().id],initial_comment:""})}},refreshFile:function e(t){TS.files.startRefreshingFile(t);TS.api.call("files.refresh",{file:t}).then(function(e){var t=e.data,r=e.args,n=e.request_id;var i=true;if(TS.files.onFileRefresh)TS.files.onFileRefresh(i,t,r,n);return{data:t,args:r,request_id:n}}).catch(function(e){var t=e.data,r=e.args,n=e.request_id;var i=false;if(TS.files.onFileRefresh)TS.files.onFileRefresh(i,t,r,n);return{data:t,args:r,request_id:n}})},onFileRefresh:function e(t,r,n){var i=n.file;if(t)TS.menu.$menu.find("#refresh_file").find(".item_label").text(TS.i18n.t("File refreshed!","files")()).end();else if(!t){TS.files.doneRefreshingFile(i,'<span class="moscow_red">'+TS.i18n.t("Refresh failed.","files")()+"</span>",5e3);TS.menu.$menu.find("#refresh_file").find(".item_label").text(TS.i18n.t("Refresh failed","files")()).end()}if(t&&!r.will_refresh)TS.files.doneRefreshingFile(i,'<span class="moscow_red">'+TS.i18n.t("File refreshed < 1 minute ago.","files")()+"</span>",5e3);if(TS.web&&t){TS.menu.$menu.find("#refresh_file").find(".item_label").text(TS.i18n.t("Reloading...","files")());TS.reload(false,"TS.files.onFileRefresh")}if(!t)if("file_deleted"===r.error){var a=TS.files.getFileById(i);if(a)TS.files.removeFile(a.id)}},fileWasMaybeRefreshed:function e(t){if(!t)return;if(!TS.files.waiting_for_refresh[t.id])return;TS.files.doneRefreshingFile(t.id,'<span class="kelly_green">'+TS.i18n.t("File refreshed!","files")()+"</span>",6e4)},startRefreshingFile:function e(t){TS.files.waiting_for_refresh[t]=true;$('.file_refresh[data-file-id="'+t+'"]').addClass("hidden");$('.file_refresh_status[data-file-id="'+t+'"]').removeClass("hidden")},doneRefreshingFile:function e(t,r,n){delete TS.files.waiting_for_refresh[t];$('.file_refresh_status[data-file-id="'+t+'"]').html(r);setTimeout(function(){$('.file_refresh[data-file-id="'+t+'"]').removeClass("hidden");$('.file_refresh_status[data-file-id="'+t+'"]').text(TS.i18n.t("Refreshing file...","files")()).addClass("hidden")},n)},reShareConfirmation:function e(t,r){var n=t.map(function(e){return TS.members.getPrefCompliantMemberNameById(e.user,true)});n=_.uniq(n);var i=TS.shared.getActiveModelOb();var a=TS.shared.isModelObShared(i);var s;var o;if(a&&(i.is_im||i.is_mpim||i.is_private)){s=TS.i18n.t("Share private {file_count, plural, =1 {file} other {files}}?","files")({file_count:t.length});o=TS.i18n.t("<p><strong>{user_names}</strong> {file_owners_count, plural, =1 {originally shared} other {originally shared}} {file_count, plural, =1 {this file} other {these files}} with you privately. If you share {file_count, plural, =1 {it} other {them}} here, {file_count, plural, =1 {the file} other {they}} could be shared with anyone from <strong>{workspace_name}</strong>.</p>","files")({user_names:TS.i18n.listify(n).join(""),workspace_name:i.is_im?TS.teams.getTeamNameByMemberId(i.user):TS.i18n.listify(_.map(i.shared_team_ids,TS.teams.getTeamNameById)).join(""),file_owners_count:n.length,file_count:t.length,file_title:1===t.length?TS.format.formatNoSpecials(t[0].title||"Untitled"):""})}else if(a&&i.is_channel){s=TS.i18n.t("Share private {file_count, plural, =1 {file} other {files}}?","files")({file_count:t.length});o=TS.i18n.t("<p><strong>{user_names}</strong> {file_owners_count, plural, =1 {originally shared} other {originally shared}} {file_count, plural, =1 {this file} other {these files}} with you privately. If you share {file_count, plural, =1 {it} other {them}} here, {file_count, plural, =1 {the file} other {they}} will be viewable by anyone from <strong>{workspace_names}</strong>.</p>","files")({user_names:TS.i18n.listify(n).join(""),workspace_names:TS.i18n.listify(_.map(i.shared_team_ids,TS.teams.getTeamNameById)).join(""),file_owners_count:n.length,file_count:t.length,file_title:1===t.length?TS.format.formatNoSpecials(t[0].title||"Untitled"):""})}else if(i.is_im){s=TS.i18n.t("Share private {file_count, plural, =1 {file} other {files}} and {file_count, plural, =1 {its} other {their}} comments?","files")({file_count:t.length});o=TS.i18n.t("<p><strong>{user_names}</strong> {file_owners_count, plural, =1 {originally shared} other {originally shared}} {file_count, plural, =1 {this file} other {these files}} with you privately. If you share {file_count, plural, =1 {it} other {them}} here, both the {file_count, plural, =1 {file} other {files}} and {file_count, plural, =1 {its} other {their}} comments will be viewable by <strong>{recipient_name}</strong>.</p>","files")({user_names:TS.i18n.listify(n).join(""),recipient_name:TS.templates.builders.makeModelObNameForDisplay(i),file_owners_count:n.length,file_count:t.length,file_title:1===t.length?TS.format.formatNoSpecials(t[0].title||"Untitled"):""})}else if(i.is_mpim){s=TS.i18n.t("Share private {file_count, plural, =1 {file} other {files}} and {file_count, plural, =1 {its} other {their}} comments?","files")({file_count:t.length});o=TS.i18n.t("<p><strong>{user_names}</strong> {file_owners_count, plural, =1 {originally shared} other {originally shared}} {file_count, plural, =1 {this file} other {these files}} with you privately. If you share {file_count, plural, =1 {it} other {them}} here, both the {file_count, plural, =1 {file} other {files}} and {file_count, plural, =1 {its} other {their}} comments will be viewable by everyone in this conversation.</p>","files")({user_names:TS.i18n.listify(n).join(""),file_owners_count:n.length,file_count:t.length,file_title:1===t.length?TS.format.formatNoSpecials(t[0].title||"Untitled"):""})}else{s=TS.i18n.t("Share private {file_count, plural, =1 {file} other {files}} and {file_count, plural, =1 {its} other {their}} comments?","files")({file_count:t.length});o=TS.i18n.t("<p><strong>{user_names}</strong> {file_owners_count, plural, =1 {originally shared} other {originally shared}} {file_count, plural, =1 {this file} other {these files}} with you privately. If you share {file_count, plural, =1 {it} other {them}} here, both the {file_count, plural, =1 {file} other {files}} and {file_count, plural, =1 {its} other {their}} comments will be viewable by anyone in <strong>{channel_name}</strong>.</p>","files")({user_names:TS.i18n.listify(n).join(""),channel_name:TS.templates.builders.makeModelObNameForDisplay(i),file_owners_count:n.length,file_count:t.length,file_title:1===t.length?TS.format.formatNoSpecials(t[0].title||"Untitled"):""})}TS.generic_dialog.start({title:s,body:o,show_cancel_button:true,show_go_button:true,go_button_text:TS.i18n.t("Share {file_count, plural, =1 {file} other {files}}","files")({file_count:t.length}),cancel_button_text:TS.i18n.t("Cancel","files")(),onGo:r})},updateFileListItem:function e(t,r){var n=r.find('.file_list_item[data-file-id="'+t.id+'"]');if(n.length){n.replaceWith(TS.templates.builders.fileHTML(t));if(TS.files.fileIsImage(t))r.find(".lazy").lazyload()}},nonImageCanUseFSFV:function e(t){if(!t)return false;return TS.model.pdf_viewer_enabled&&"hosted"===t.mode&&TS.files.fileIsPDF(t)&&t.size<=5e7},maybePruneChannels:function e(t){if(!TS.boot_data.feature_less_c_ids_fetch)return;if(!t)return;if(t.channels&&t.channel_map){var r=_(t.channel_map).map(function(e){return TS.shared.isModelObOrgShared(e)||e.team===TS.model.team.id?e.id:void 0}).compact().value();t.channels=_.intersection(t.channels,r)}}});var e=null;var t=20;var n={};var i=function e(t){if(!TS.files.fileIsImage(t))return;var r={width:t.thumb_360_w,height:t.thumb_360_h,link_url:t.url_private,internal_file_id:t.id};if("gif"===t.filetype)if(t.deanimate_gif)TS.inline_imgs.makeInternalInlineImg(t.deanimate_gif,r);else if(t.thumb_160)TS.inline_imgs.makeInternalInlineImg(t.thumb_160,r);if(t.thumb_480_gif||t.thumb_360_gif){if(t.thumb_480_gif)TS.inline_imgs.makeInternalInlineImg(t.thumb_480_gif,r);if(t.thumb_360_gif)TS.inline_imgs.makeInternalInlineImg(t.thumb_360_gif,r)}else{if(t.thumb_720)TS.inline_imgs.makeInternalInlineImg(t.thumb_720,r);if(t.thumb_480)TS.inline_imgs.makeInternalInlineImg(t.thumb_480,r);if(t.thumb_360)TS.inline_imgs.makeInternalInlineImg(t.thumb_360,r);if(TS.boot_data.feature_pjpeg&&t.pjpeg)TS.inline_imgs.makeInternalInlineImg(t.pjpeg,r);if(TS.boot_data.feature_pdf_thumb&&t.thumb_pdf)TS.inline_imgs.makeInternalInlineImg(t.thumb_pdf,r)}};var a=function e(t,r,i,a){var o=function e(n){var a;if(n&&n.data){var o=!!r;s(n.data.ok,n.data,n.args,o);a=r?n.data.file:TS.files.getFileById(t)}if(i)i(t,a);return a||t};var l=500;var u=n[t];if(!u){u=TS.api.call("files.info",{file:t,page:1,count:l,truncate:1,_x_reason:a});n[t]=u;u.finally(function(){delete n[t]})}return u.then(function(e){return o(e)}).catch(function(e){return o(e)})};var s=function e(t,r,n,i){if(!t){if("file_deleted"===r.error){var a=TS.files.getFileById(n.file);if(a)TS.files.removeFile(a.id);else if(n.file)TS.files.removeFile(n.file)}else if("file_not_found"===r.error)TS.files.removeFile(n.file);return}if(r.file){r.file.comments=r.comments;r.file.content=r.content;r.file.content_html=r.content_html;r.file.content_highlight_html=r.content_highlight_html;if(!i)TS.files.upsertAndSignal(r.file)}};var o=function e(t){var r=_.isString(t)?TS.files.getFileById(t):t;if(!_.isObject(r))throw new Error("Expected file or file ID.");return r}})()},4776:function(e,t){(function(){TS.registerModule("ims",{switched_sig:new signals.Signal,history_fetched_sig:new signals.Signal,history_being_fetched_sig:new signals.Signal,message_received_sig:new signals.Signal,message_removed_sig:new signals.Signal,message_changed_sig:new signals.Signal,marked_sig:new signals.Signal,closed_sig:new signals.Signal,unread_changed_sig:new signals.Signal,unread_highlight_changed_sig:new signals.Signal,opened_sig:new signals.Signal,msg_not_sent_sig:new signals.Signal,data_retention_changed_sig:new signals.Signal,onStart:function e(){TS.prefs.display_real_names_override_changed_sig.add(i);TS.prefs.team_display_real_names_changed_sig.add(i);TS.members.changed_profile_sig.add(n)},addMsg:function e(t,r){var n=TS.ims.getImById(t);if(!n){TS.error('unknown im "'+t+'"');return}if(TS.useReactMessages()&&!TS.utility.msgs.isMsgReply(r)){if(!TS.redux.messages.addMessage(r,true))return}else if(!TS.shared.addMsg(n,r))return;var i=!TS.utility.msgs.isTempMsg(r);TS.ims.calcUnreadCnts(n,i);TS.utility.msgs.maybeTruncateMsgs(n);TS.ims.message_received_sig.dispatch(n,r);if(!n.is_open)TS.api.call("conversations.open",{users:n.user,return_im:true,reason:"TS.ims.addMsg"}).then(function(e){var t=e.data,r=e.args,n=e.request_id;var i=true;if(TS.ims.onOpened)TS.ims.onOpened(i,t,r,n);return{data:t,args:r,request_id:n}}).catch(function(e){var t=e.data,r=e.args,n=e.request_id;var i=false;if(TS.ims.onOpened)TS.ims.onOpened(i,t,r,n);return{data:t,args:r,request_id:n}})},calcUnreadCnts:function e(t,r){TS.shared.calcUnreadCnts(t,TS.ims,r)},removeMsg:function e(t,r){var n=TS.ims.getImById(t);if(!n){TS.error('unknown im "'+t+'"');return}if(TS.useReactMessages()&&!TS.utility.msgs.isMsgReply(r))TS.redux.messages.removeMessage(r);else{if(n._archive_msgs)TS.utility.msgs.spliceMsg(n._archive_msgs,r);var i=n.msgs;TS.utility.msgs.spliceMsg(i,r)}TS.ims.message_removed_sig.dispatch(n,r);TS.ims.calcUnreadCnts(n,true)},sendMsg:function e(t,r,n,i){return TS.shared.sendMsg(t,r,TS.ims,n,i)},onSendMsg:function e(t,r){var n=TS.ims.getImById(r.SENT_MSG.channel);if(!n){TS.error("unknown im? "+r.SENT_MSG.channel);return}TS.shared.onSendMsg(t,r,n,TS.ims)},closeImByMemberId:function e(t){var r=TS.ims.getImByMemberId(t);if(!r)return;TS.ims.closeIm(r.id)},closeIm:function e(t){var r=TS.ims.getImById(t);if(!r||!r.is_open)return;r.is_open=false;var n=TS.model.active_im_id==t;if(n&&TS.client)TS.client.activeChannelDisplayGoneAway();TS.ims.onClosed(true,{no_op:!n},{channel:t});TS.api.call("conversations.close",{channel:t}).catch(function(){r.is_open=true;TS.ims.onClosed(true,{no_op:!n},{channel:t})})},onClosed:function e(t,r,n){if(!t)return;if(r.no_op){var i=TS.ims.getImById(n.channel);if(i)TS.ims.closed_sig.dispatch(i)}},startImById:function e(t,r,n){var i=TS.ims.getImById(t);if(!i){TS.error(t+" not an im");return}TS.ims.startImByMemberId(i.user,r,n)},startImByMemberName:function e(t,r,n){var i=TS.members.getMemberByName(t);if(!i){TS.error("no member?? "+t);return}TS.ims.startImByMemberId(i.id,r,n)},startImByMemberId:function e(t,r,n){if(TS.useReactMessages()){var i=TS.shared.getActiveModelOb();if(i)TS.redux.dispatch(TS.interop.redux.features.messageEdit.stopEditingMessagesInChannel({channelId:i.id}))}var a=TS.ims.getImByMemberId(t);if(a){TS.log(6532,"im_debug: found im");if(TS.ims.isImWithDeletedMember(a))TS.client.archives.previous_model_ob=TS.shared.getActiveModelOb();TS.ims.displayIm(a.id,r);if(a.is_open){TS.log(6532,"im_debug: im is open");if(n)TS.ims.sendMsg(a.id,$.trim(n));return Promise.resolve()}}TS.model.requested_im_opens[t]={and_send_txt:n};TS.log(6532,"im_debug: calling conversations.open for "+t);return TS.api.call("conversations.open",{users:t,return_im:true,reason:"TS.ims.startImByMemberId"}).then(function(e){var t=e.data,r=e.args,n=e.request_id;var i=true;TS.log(6532,"im_debug: conversations.open returned OK",t,r);if(TS.ims.onOpened)TS.ims.onOpened(i,t,r,n);return{data:t,args:r,request_id:n}}).catch(function(e){var t=e.data,r=e.args,n=e.request_id;var i=false;TS.log(6532,"im_debug: conversations.open failed",t,r);if(TS.ims.onOpened)TS.ims.onOpened(i,t,r,n);return{data:t,args:r,request_id:n}})},promiseToStartImByMemberId:function e(t,r,n,i){var a;if(TS.useReactMessages())a=TS.redux.dispatch(TS.interop.actions.displayModelOrViewById(t)).catch(function(e){if(e&&"editing-message"===e.message)TS.ui.fs_modal.close();throw e});else a=TS.ims.startImByMemberId(t,r,n,i);var s=function e(){var r=TS.shared.getActiveModelOb();return r&&r.is_im&&r.user===t};TS.log(6532,"im_debug: start promise (id="+t+", isActive="+s()+")");if(s())return Promise.resolve();return a.then(function(e){TS.log(6532,"im_debug: promise resolved (id="+e.request_id+", isActive="+s()+")");if(s())return Promise.resolve();var r;TS.log(6532,"im_debug: waiting for im_open from MS");return new Promise(function(e){TS.log(6532,"im_debug: start inner promise");r=function t(){TS.log(6532,"im_debug: im_switched (isActive="+s()+")");if(s())return e()};TS.ims.switched_sig.add(r)}).timeout(3e4).finally(function(){TS.log(6532,"im_debug: inner promise finally (timeout case)");delete TS.model.requested_im_opens[t];TS.ims.switched_sig.remove(r)})}).catch(_.noop)},onOpened:function e(t,r,n){if(!t){TS.log(6532,"im_debug: TS.ims.onOpened: not OK, exiting.");return}if(n.return_im&&r.channel){TS.log(6532,"im_debug: TS.ims.onOpened: upserting IM.",r);TS.ims.upsertIm(r.channel)}else TS.log(6532,"im_debug: TS.ims.onOpened: not upserting IM.",t,r)},displayIm:function e(t,r,n){if(TS.isPartiallyBooted()&&t!==TS.model.initial_cid){TS.warn("Can't switch model objects during incremental boot; this is a programming error");TS.sounds.play("beep");return}TS.metrics.mark("start_channel_change_"+t);var i=TS.ims.getImById(t);if(!i){TS.error('im "'+t+'" unknown');return}TS.utility.msgs.maybeClearPrevLastRead();TS.utility.msgs.maybeClearPrevLastRead(i);TS.shared.maybeClearHasAutoScrolled();if(TS.shared.didDeferMessageHistoryById(i.id))TS.shared.checkInitialMsgHistory(i,TS.ims);if(t==TS.model.active_im_id&&!TS.client.activeChannelIsHidden()){if(n)TS.ims.sendMsg(i.id,$.trim(n));return}if(TS.has_pri[l])TS.log(l,"displayChannel (im): "+t);var a=TS.client.channelDisplaySwitched({id:t,no_history_add:r});if(a)TS.ims.switched_sig.dispatch();if(n)TS.ims.sendMsg(i.id,$.trim(n))},setLastRead:function e(t,r,n){var i;if(TS.useReactMessages){i=TS.model.last_reads_set_by_client[t.id+"_"+r];delete TS.model.last_reads_set_by_client[t.id+"_"+r]}if(t.last_read==r)return false;if(r.indexOf(TS.utility.date.fake_ts_unique_padder)>-1){TS.error("bad ts:"+r);return false}var a=t.id+". last_read = "+t.last_read+" -> "+r+", reason: "+(n||"unspecified");if(t.last_read>r){if(!TS.useReactMessages){i=TS.model.last_reads_set_by_client[t.id+"_"+r];delete TS.model.last_reads_set_by_client[t.id+"_"+r]}if(i){TS.warn("NOT going back in time on im "+a);return}if(TS.has_pri[o])TS.log(o,"going back in time on im "+a);TS.utility.msgs.maybeClearPrevLastRead(t);TS.utility.msgs.setPrevLastRead(t,r)}else{if(TS.has_pri[o])TS.log(o,"TS.ims.setLastRead: "+a);TS.utility.msgs.maybeClearPrevLastRead(t);TS.utility.msgs.maybeSetPrevLastRead(t,r)}if(TS.has_pri[o]){var s=TS.shared.getActiveModelOb();if(s&&s.id&&s.id!==t.id){TS.log(o,"setLastRead: IM "+t.id+" was marked with reason = "+(n||"unspecified")+", but is NOT active ("+s.id+"). Should it have been marked?\nTS.client.ui.isUserAttentionOnChat(): "+TS.client.ui.isUserAttentionOnChat()+"\nactiveChannelIsHidden: "+TS.client.activeChannelIsHidden());TS.log(o,"setLastRead stacktrace: "+TS.console.getStackTrace())}}t.last_read=r;if(n)t._marked_reason=n;TS.ims.marked_sig.dispatch(t);TS.utility.msgs.maybeClearUsersCountsInfo(t);TS.ims.calcUnreadCnts(t);return true},markMostRecentReadMsg:function e(t,r,n){if(!t){TS.error("im unknown");return}if(TS.useReactMessages()){TS.redux.dispatch(TS.interop.redux.models.channels.markMostRecentMsgRead({channelId:t.id,reason:r}));return}if((!t.msgs||!t.msgs.length)&&!n)return;var i=TS.utility.msgs.getMostRecentValidTs(t);if(!i){var a=t.msgs&&t.msgs.length;if(TS.has_pri[o])TS.log(o,"markMostRecentReadMsg: no most_recent_valid_ts for IM "+t.id+"? "+a+" msgs at present.");if(t.msgs&&t.msgs.length||!t._latest_via_users_counts)TS.warn('no valid tses for im "'+t.id+'"???');return}if(TS.has_pri[o]){var s=TS.shared.getActiveModelOb();var l=(t&&t.id)===(s&&s.id);if(!r)TS.log(o,"IM "+t.id+" marked without reason.");else TS.log(o,"IM "+t.id+" marked with reason = "+r);if(r&&!l){TS.log(o,"markMostRecentReadReadMsg: IM "+t.id+" was marked with reason = "+(r||"unspecified")+", but is NOT active ("+s.id+"). Should it have been marked?\nTS.client.ui.isUserAttentionOnChat(): "+TS.client.ui.isUserAttentionOnChat()+"\nactiveChannelIsHidden: "+TS.client.activeChannelIsHidden());TS.log(o,"markMostRecentReadReadMsg stacktrace: "+TS.console.getStackTrace())}}TS.ims.markReadMsg(t.id,i,r)},markReadMsg:function e(t,r,n){var i=TS.ims.getImById(t);if(!i){TS.error('im "'+t+'" unknown');return}if(i.last_read==r)return;if(TS.ims.setLastRead(i,r,n)){i._marked_reason=n;var a=true;TS.redux.channels.setMarkingState(i.id,a)}},onMarked:function e(t,r,n){var i=TS.ims.getImById(n.channel);if(!i){TS.error('wtf no im "'+n.channel+'"');return}if(!t){var a=true;TS.redux.channels.setMarkingState(i.id,a)}},getImsFilteredBy:function e(t){return TS.shared.getEntitiesFilteredBy("ims",t)},getImById:function e(t){if(!t)return null;return TS.redux.channels.getImById(t)},getDisplayNameOfUserForIm:function e(t){return r(t)},getDisplayNameOfUserForImLowerCase:function e(t){return TS.members.getPrefCompliantMemberNameLowerCase(TS.members.getMemberById(t.user))},getImByUsername:function e(t){var r=TS.members.getMemberByName(t);if(!r)return null;return TS.ims.getImByMemberId(r.id)},getImByMemberId:function e(t){return TS.redux.channels.getImByMemberId(t)},getFirstOpenIm:function e(){var t=TS.model.ims;var r;if(!t)return null;for(var n=0;n<t.length;n+=1){r=t[n];if(r.is_open)return r}return null},isImWithDeletedMember:function e(t){if(!t.is_im)return false;var r=TS.members.getMemberById(t.user);if(!r||!r.deleted)return false;return true},setNameFromMember:function t(r){var n=TS.ims.getImByMemberId(r.id);if(!n)return;e(n,r)},upsertIm:function e(r,n){var i=TS.ims.getImById(r.id);delete r.unread_count;if(i){i=_.assign({},TS.redux.channels.dangerouslyGetEntityById(r.id));if(TS.has_pri[s])TS.log(s,'updating existing im "'+r.id+'"');_.each(_.keys(r),function(e){i[e]=r[e]});r=i;if(TS.isPartiallyBooted()&&null===r.oldest_msg_ts)r.oldest_msg_ts=TS.storage.fetchOldestTs(r.id);TS.shared.maybeResetHistoryFetched(r);if(TS.client&&(r.is_open||r.unread_cnt)){var a=true;TS.shared.checkInitialMsgHistory(r,TS.ims,a)}if(!n)TS.redux.channels.replaceEntity(r)}else{if(TS.has_pri[s])TS.log(s,'adding im "'+r.id+'"');var o=TS.members.getMemberById(r.user);t(r,o);if(!n)TS.redux.channels.addEntity(r)}if(TS.client){var l=TS.utility.msgs.shouldMarkUnreadsOnMessageFetch(r);if(TS.model.active_cid==r.id)TS.ims.calcUnreadCnts(r,l);else if(!i)TS.ims.calcUnreadCnts(r,l)}return r},markScrollTop:function e(t,r){var n=TS.ims.getImById(t);if(!n)return false;if(n.scroll_top==r)return false;n.scroll_top=r;return true},maybeLoadScrollBackHistory:function e(t,r){var n=TS.ims.getImById(t);if(!n)return false;return TS.shared.maybeLoadScrollBackHistory(n,TS.ims,r)},onHistory:function e(t,r,n){var i=TS.ims.getImById(n.channel);if(!i){TS.error('wtf no im "'+n.channel+'"');return}if(!t||!r||!r.messages){TS.error("failed to get history for im "+n.channel);i.history_is_being_fetched=false;i.history_fetch_retries=(i.history_fetch_retries||0)+1;var a=TS.utility.getHistoryRetryDelay(i.history_fetch_retries,_.get(r,"error"));TS.info("retrying history fetch on im "+i.id+" in "+a);window.setTimeout(function(){TS.info("retrying history fetch on im "+i.id+", attempt #"+(i.history_fetch_retries||"1"));TS.ims.fetchHistory(i,n,TS.ims.onHistory)},a);return}i.history_fetch_retries=0;var s=TS.shared.onHistory(i,r,n,TS.ims);if(!s){i.history_is_being_fetched=false;TS.ims.history_fetched_sig.dispatch(i)}var o=TS.utility.msgs.shouldMarkUnreadsOnMessageFetch(i);TS.ims.calcUnreadCnts(i,o)},fetchHistory:function e(t,r,n){if(!t){TS.error('wtf no im "'+t+'"');return}t.history_is_being_fetched=true;t.history_fetch_failed=false;TS.ims.history_being_fetched_sig.dispatch(t);if(t.history_fetch_retries>5){t.history_fetch_retries=0;t.history_is_being_fetched=false;t.history_fetch_failed=true;if(TS.client)TS.client.msg_pane.updateEndMarker();return}n=n||TS.ims.onHistory;var i=TS.boot_data.feature_trace_reason?TS.console.getStackTrace().replace(/(\(?http.*\)?)|at|Array|Object/g,"").trim().substring(0,200):"";if(i)r._x_reason=i;TS.api.call("conversations.history",r).then(function(e){var t=e.data,r=e.args,i=e.request_id;var a=true;n(a,t,r,i);return{data:t,args:r,request_id:i}}).catch(function(e){var t=e.data,r=e.args,i=e.request_id;var a=false;n(a,t,r,i);return{data:t,args:r,request_id:i}})},checkForOldImsToClose:function e(){return TS.shared.checkForOldImsToClose()},setDataRetention:function e(t,r,n,i){var a={channel:t,retention_type:$("select[name=retention_type]").val()};if(1==a.retention_type)a.retention_duration=$("#retention_duration").val();var s=function e(t,r,n){if(i)i(t,r,n);if(t)TS.ims.data_retention_changed_sig.dispatch(n)};TS.api.call("conversations.setRetention",a).then(function(e){var t=e.data,r=e.args,n=e.request_id;var i=true;s(i,t,r,n);return{data:t,args:r,request_id:n}},function(e){var t=e.data,r=e.args,n=e.request_id;var i=false;s(i,t,r,n);return{data:t,args:r,request_id:n}})},getDataRetention:function e(t,r){TS.api.call("conversations.getRetention",{channel:t}).then(function(e){var t=e.data,n=e.args,i=e.request_id;var a=true;if(r)r(a,t,n,i);return{data:t,args:n,request_id:i}},function(e){var t=e.data,n=e.args,i=e.request_id;var a=false;if(r)r(a,t,n,i);return{data:t,args:n,request_id:i}})}});var e=function e(t,r){if(TS._incremental_boot&&t.name);else t.name=t.user;if(r)t.name=r.name;t._name_lc=_.toLower(t.name)};var t=function t(r,n){TS.shared.setPriorityForDev(r);r.is_im=true;e(r,n);if(n)if(n.is_slackbot)r.is_slackbot_im=true;else if(n.is_self)r.is_self_im=true;TS.shared.maybeResetHistoryFetched(r);r.opened_this_session=false;r.scroll_top=-1;r.history_is_being_fetched=false;r.unread_highlight_cnt=0;r.unread_highlights=[];r.unread_cnt=0;r.unreads=[];TS.shared.setOldestUnreadTsForId(r.id,null);r.has_fetched_history_after_scrollback=false;if(TS.client)if(TS._incremental_boot&&r.msgs&&r.msgs.length>0){r.msgs=r.msgs.map(function(e){return TS.utility.msgs.processImsg(e,r.id)});TS.utility.msgs.setMsgs(r,r.msgs)}else TS.utility.msgs.setMsgs(r,[]);else if(TS.boot_data.msgs)TS.utility.msgs.ingestMessagesFromBootData(r);r.oldest_msg_ts=TS.storage.fetchOldestTs(r.id)||null;r.last_msg_input=TS.storage.fetchLastMsgInput(r.id)||null;r.has_draft=!!r.last_msg_input;if(n)r.is_archived=n.deleted};var r=function e(t){if(t._display_name)return t._display_name;var r=t.user;var n=TS.members.getMemberById(t.user);if(!n){if(t.name===t.user)TS.console.logError({msg:"IM name looks like a member ID",im_user:r},"im_name_is_id");return t.name}var i=TS.members.getPrefCompliantMemberName(n);if(i===t.user||i===n.id){TS.console.logError({msg:"Member name looks like an ID",im_user:r,member:n},"member_name_is_id");return t.name}t._display_name=i;return t._display_name};var n=function e(t){var r=_.find(TS.model.ims,{user:t.id});if(r)a(r)};var i=function e(){TS.model.ims.forEach(a)};var a=function e(t){t._display_name=void 0};var s=4;var o=142;var l=999})()},4777:function(e,t){(function(){TS.registerModule("mpims",{switched_sig:new signals.Signal,joined_sig:new signals.Signal,member_joined_sig:new signals.Signal,history_fetched_sig:new signals.Signal,history_being_fetched_sig:new signals.Signal,message_received_sig:new signals.Signal,message_removed_sig:new signals.Signal,message_changed_sig:new signals.Signal,marked_sig:new signals.Signal,closed_sig:new signals.Signal,unread_changed_sig:new signals.Signal,unread_highlight_changed_sig:new signals.Signal,opened_sig:new signals.Signal,msg_not_sent_sig:new signals.Signal,data_retention_changed_sig:new signals.Signal,onStart:function e(){TS.prefs.display_real_names_override_changed_sig.add(i);TS.prefs.team_display_real_names_changed_sig.add(i);TS.members.changed_profile_sig.add(n)},getVisibleMpims:function e(t){TS.channels.getAllVisibleMpimsForUser(t)},addMsg:function e(t,r){var n=TS.mpims.getMpimById(t);if(!n){TS.error('unknown mpim "'+t+'"');return}if(TS.useReactMessages()&&!TS.utility.msgs.isMsgReply(r)){if(!TS.redux.messages.addMessage(r,true))return}else if(!TS.shared.addMsg(n,r))return;var i=!TS.utility.msgs.isTempMsg(r);TS.mpims.calcUnreadCnts(n,i);TS.utility.msgs.maybeTruncateMsgs(n);TS.mpims.message_received_sig.dispatch(n,r);if(!n.is_open&&TS.utility.msgs.msgCanCountAsUnread(r))if(1==n.members.length){var a=n.members[0];TS.api.call("conversations.open",{users:a,return_im:true,reason:"TS.mpims.addMsg"}).then(function(e){var t=e.data,r=e.args,n=e.request_id;var i=true;if(TS.ims.onOpened)TS.ims.onOpened(i,t,r,n);return{data:t,args:r,request_id:n}}).catch(function(e){var t=e.data,r=e.args,n=e.request_id;var i=false;if(TS.ims.onOpened)TS.ims.onOpened(i,t,r,n);return{data:t,args:r,request_id:n}})}else if(n.members.length>1){var s=n.members.join(",");TS.api.call("conversations.open",{users:s}).then(function(e){var t=e.data,r=e.args,n=e.request_id;var i=true;if(TS.mpims.onOpened)TS.mpims.onOpened(i,t,r,n);return{data:t,args:r,request_id:n}}).catch(function(e){var t=e.data,r=e.args,n=e.request_id;var i=false;if(TS.mpims.onOpened)TS.mpims.onOpened(i,t,r,n);return{data:t,args:r,request_id:n}})}},calcUnreadCnts:function e(t,r){TS.shared.calcUnreadCnts(t,TS.mpims,r)},removeMsg:function e(t,r){var n=TS.mpims.getMpimById(t);if(!n){TS.error('unknown mpim "'+t+'"');return}if(TS.useReactMessages()&&!TS.utility.msgs.isMsgReply(r))TS.redux.messages.removeMessage(r);else{if(n._archive_msgs)TS.utility.msgs.spliceMsg(n._archive_msgs,r);var i=n.msgs;TS.utility.msgs.spliceMsg(i,r)}TS.mpims.message_removed_sig.dispatch(n,r);TS.mpims.calcUnreadCnts(n,true)},sendMsg:function e(t,r,n,i){return TS.shared.sendMsgGroup(t,r,TS.mpims,n,i)},onSendMsg:function e(t,r){var n=TS.mpims.getMpimById(r.SENT_MSG.channel);if(!n){TS.error("unknown mpim? "+r.SENT_MSG.channel);return}TS.shared.onSendMsg(t,r,n,TS.mpims)},closeMpim:function e(t){var r=TS.mpims.getMpimById(t);if(!r){r=TS.channels.getChannelById(t);if(TS.shared.isModelObShared(r))TS.channels.closeMpim(t);return}TS.api.call("conversations.close",{channel:t}).then(function(e){var t=e.data,r=e.args,n=e.request_id;var i=true;if(TS.mpims.onClosed)TS.mpims.onClosed(i,t,r,n);return{data:t,args:r,request_id:n}}).catch(function(e){var t=e.data,r=e.args,n=e.request_id;var i=false;if(TS.mpims.onClosed)TS.mpims.onClosed(i,t,r,n);return{data:t,args:r,request_id:n}})},onClosed:function e(t,r,n){if(!t)return;if(r.no_op){var i=TS.mpims.getMpimById(n.channel);if(i)TS.mpims.closed_sig.dispatch(i)}},onOpened:function e(t){if(!t);},displayMpim:function e(t){var r=_.defaults({},t,{from_history:false,replace_history_state:false});var n=r.id;if(!n){TS.error("no mpim id supplied");return}var i=r.path;var a=r.and_send_txt;var s=r.from_history;var o=r.replace_history_state;if(TS.isPartiallyBooted()&&n!==TS.model.initial_cid){TS.warn("Can't switch model objects during incremental boot; this is a programming error");TS.sounds.play("beep");return}TS.metrics.mark("start_channel_change_"+n);var l=TS.mpims.getMpimById(n);if(!l){TS.error('mpim "'+n+'" unknown');return}TS.utility.msgs.maybeClearPrevLastRead();TS.utility.msgs.maybeClearPrevLastRead(l);TS.shared.maybeClearHasAutoScrolled();if(TS.shared.didDeferMessageHistoryById(l.id))TS.shared.checkInitialMsgHistory(l,TS.mpims);if(n==TS.model.active_mpim_id&&!o&&!TS.client.activeChannelIsHidden()){TS.warn('mpim "'+n+'" already displayed');if(a)TS.mpims.sendMsg(n,$.trim(a));return}if(TS.has_pri[c])TS.log(c,"displayChannel (mpim): "+n);var u=o?false:s;var d=i||"/messages/"+l;var m=TS.client.channelDisplaySwitched({id:n,path:d,replace_history_state:o,no_history_add:u});if(m)TS.mpims.switched_sig.dispatch();if(l.is_open){if(a)TS.mpims.sendMsg(n,$.trim(a));return}TS.model.requested_mpim_opens[n]={and_send_txt:a};var f=l.members.filter(function(e){return TS.model.user.id!==e});TS.api.call("conversations.open",{users:f.join(",")}).then(function(e){var t=e.data,r=e.args,n=e.request_id;var i=true;if(TS.mpims.onOpened)TS.mpims.onOpened(i,t,r,n);return{data:t,args:r,request_id:n}}).catch(function(e){var t=e.data,r=e.args,n=e.request_id;var i=false;if(TS.mpims.onOpened)TS.mpims.onOpened(i,t,r,n);return{data:t,args:r,request_id:n}})},setLastRead:function e(t,r,n){var i;if(TS.useReactMessages()){i=TS.model.last_reads_set_by_client[t.id+"_"+r];delete TS.model.last_reads_set_by_client[t.id+"_"+r]}if(t.last_read==r)return false;if(r.indexOf(TS.utility.date.fake_ts_unique_padder)>-1){TS.error("bad ts:"+r);return false}var a=t.id+". last_read = "+t.last_read+" -> "+r+", reason: "+(n||"unspecified");if(t.last_read>r){if(!TS.useReactMessages()){i=TS.model.last_reads_set_by_client[t.id+"_"+r];delete TS.model.last_reads_set_by_client[t.id+"_"+r]}if(i){TS.warn("NOT going back in time on mpim "+a);return}if(TS.has_pri[d])TS.log(d,"going back in time on mpim "+a);TS.utility.msgs.maybeClearPrevLastRead(t);TS.utility.msgs.setPrevLastRead(t,r)}else{if(TS.has_pri[d])TS.log(d,"TS.mpims.setLastRead: "+a);TS.utility.msgs.maybeClearPrevLastRead(t);TS.utility.msgs.maybeSetPrevLastRead(t,r)}t.last_read=r;if(n)t._marked_reason=n;TS.mpims.marked_sig.dispatch(t);TS.utility.msgs.maybeClearUsersCountsInfo(t);TS.mpims.calcUnreadCnts(t);return true},markMostRecentReadMsg:function e(t,r,n){if(!t){TS.error("mpim unknown");return}if(TS.useReactMessages()){TS.redux.dispatch(TS.interop.redux.models.channels.markMostRecentMsgRead({channelId:t.id,reason:r}));return}if((!t.msgs||!t.msgs.length)&&!n)return;var i=TS.utility.msgs.getMostRecentValidTs(t);if(!i){if(t.msgs&&t.msgs.length||!t._latest_via_users_counts)TS.warn('no valid tses for mpim "'+t.id+'"???');return}TS.mpims.markReadMsg(t.id,i,r)},markReadMsg:function e(t,r,n){var i=TS.mpims.getMpimById(t);if(!i){TS.error('mpim "'+t+'" unknown');return}if(i.last_read==r)return;if(TS.mpims.setLastRead(i,r,n)){i._marked_reason=n;var a=true;TS.redux.channels.setMarkingState(i.id,a)}},onMarked:function e(t,r,n){var i=TS.mpims.getMpimById(n.channel);if(!i){TS.error('error no mpim "'+n.channel+'"');return}if(!t){var a=true;TS.redux.channels.setMarkingState(i.id,a)}},getMpimsFilteredBy:function e(t){return TS.shared.getEntitiesFilteredBy("mpims",t)},getMpimById:function e(t){if(!t)return null;return TS.redux.channels.getMpimById(t)},getMpimByName:function e(t){return TS.redux.channels.getMpimByName(t)},getActiveMembers:function e(t){var r=TS.mpims.getMembersInDisplayOrder(t);return r.filter(function(e){return!e.deleted})},getMembersInDisplayOrder:function e(t){if(!t)return;if(TS.boot_data.feature_esc_fix_dm_browser)return _.chain(t.members).without(TS.model.user.id).map(function(e){var t=TS.members.getPotentiallyUnknownMemberById(e);if(!t||t.is_unknown||t.is_nonexistent)TS.warn("Could not find a member in model with id: "+e);return t}).compact().value();if(t._members&&t._members.length===t.members.length-1)return t._members;t._members=_.without(t.members,TS.model.user.id).map(function(e){var t=TS.members.getMemberById(e);if(!t)TS.warn("Could not find a member in model with id: "+e);return t});return _.compact(t._members)},getDisplayName:function e(t,r,n,i,a){var l=_.isInteger(i);if(t._display_name&&!r&&!n&&!l&&!a)return t._display_name;if(t._display_name_truncated&&!r&&!n&&!a&&l)return t._display_name_truncated;if(a)return o(t);return s(t,r)},getDisplayNameLowerCase:function e(t){if(t._display_name_lc)return t._display_name_lc;var r=TS.mpims.getDisplayName(t);t._display_name_lc=_.toLower(r);return t._display_name_lc},getTooltipText:function e(t){var r=TS.mpims.getMembersInDisplayOrder(t);var n=r.map(function(e){if(e.profile.real_name)return e.profile.real_name;return e.name});var i=n.join(", ");if(i===TS.mpims.getDisplayName(t))return"";return i},getMpimArchivesPath:function e(t){return"/archives/"+t.id},getMemberCount:function e(t){return Math.min(Math.max(t.members.length-1,2),9)},upsertMpim:function e(t,r){var n=TS.mpims.getMpimById(t.id);delete t.unread_count;if(n){n=_.assign({},TS.redux.channels.dangerouslyGetEntityById(t.id));if(TS.has_pri[u])TS.log(u,'updating existing mpim "'+n.id+'"');for(var i in t){if("name"===i)continue;n[i]=t[i]}t=n;if(TS.isPartiallyBooted()&&null===t.oldest_msg_ts)t.oldest_msg_ts=TS.storage.fetchOldestTs(t.id);TS.shared.maybeResetHistoryFetched(n);if(TS.client&&(t.is_open||t.unread_cnt)){var a=true;TS.shared.checkInitialMsgHistory(t,TS.mpims,a)}if(!r)TS.redux.channels.replaceEntity(t)}else{if(TS.has_pri[u])TS.log(u,'adding mpim "'+t.id+'"');l(t);if(!r)TS.redux.channels.addEntity(t)}if(TS.client){var s=TS.utility.msgs.shouldMarkUnreadsOnMessageFetch(t);if(TS.model.active_cid==t.id)TS.mpims.calcUnreadCnts(t,s);else if(!n)TS.mpims.calcUnreadCnts(t,s)}return t},processNewMpimForUpserting:function e(t){l(t)},markScrollTop:function e(t,r){var n=TS.mpims.getMpimById(t);if(!n)return false;if(n.scroll_top==r)return false;n.scroll_top=r;return true},maybeLoadScrollBackHistory:function e(t,r){var n=TS.mpims.getMpimById(t);if(!n)return false;return TS.shared.maybeLoadScrollBackHistory(n,TS.mpims,r)},onHistory:function e(t,r,n){var i=TS.mpims.getMpimById(n.channel);if(!i){TS.error('error no mpim "'+n.channel+'"');return}if(!t||!r||!r.messages){TS.error("failed to get history for mpim "+n.channel);i.history_is_being_fetched=false;i.history_fetch_retries=(i.history_fetch_retries||0)+1;var a=TS.utility.getHistoryRetryDelay(i.history_fetch_retries,_.get(r,"error"));TS.info("retrying history fetch on mpim "+i.id+" in "+a);window.setTimeout(function(){TS.info("retrying history fetch on mpim "+i.id+", attempt #"+(i.history_fetch_retries||"1"));TS.ims.fetchHistory(i,n,TS.mpims.onHistory)},a);return}i.history_fetch_retries=0;var s=TS.shared.onHistory(i,r,n,TS.mpims);if(!s){i.history_is_being_fetched=false;TS.mpims.history_fetched_sig.dispatch(i)}var o=TS.utility.msgs.shouldMarkUnreadsOnMessageFetch(i);TS.mpims.calcUnreadCnts(i,o)},fetchHistory:function e(t,r,n){if(!t){TS.error('error no mpim "'+t+'"');return}t.history_is_being_fetched=true;t.history_fetch_failed=false;TS.mpims.history_being_fetched_sig.dispatch(t);if(t.history_fetch_retries>5){t.history_fetch_retries=0;t.history_is_being_fetched=false;t.history_fetch_failed=true;if(TS.client)TS.client.msg_pane.updateEndMarker();return}n=n||TS.mpims.onHistory;var i=TS.boot_data.feature_trace_reason?TS.console.getStackTrace().replace(/(\(?http.*\)?)|at|Array|Object/g,"").trim().substring(0,200):"";if(i)r._x_reason=i;TS.api.call("conversations.history",r).then(function(e){var t=e.data,r=e.args,i=e.request_id;var a=true;n(a,t,r,i);return{data:t,args:r,request_id:i}}).catch(function(e){var t=e.data,r=e.args,i=e.request_id;var a=false;n(a,t,r,i);return{data:t,args:r,request_id:i}})},setNamesFromMember:function e(t){TS.model.mpims.forEach(function(e){if(_.includes(e.members,t.id)){r(e);a(e)}})},checkMpimMatch:function e(t,r,n){if(!t)return;var i=true;var a=true;var s=TS.mpims.getMembersInDisplayOrder(t);for(var o=0;o<r.length;o+=1){var l=false;for(var u=0;u<s.length;u+=1)if(TS.utility.members.checkMemberMatch(s[u],r[o],i)||n&&TS.utility.members.checkMemberMatch(s[u],n[o],i))l=true;if(!l)a=false}return a},setDataRetention:function e(t,r,n,i){var a={channel:t,retention_type:$("select[name=retention_type]").val()};if(1==a.retention_type)a.retention_duration=$("#retention_duration").val();var s=function e(t,r,n){if(i)i(t,r,n);if(t)TS.mpims.data_retention_changed_sig.dispatch(n)};TS.api.call("conversations.setRetention",a).then(function(e){var t=e.data,r=e.args,n=e.request_id;var i=true;s(i,t,r,n);return{data:t,args:r,request_id:n}},function(e){var t=e.data,r=e.args,n=e.request_id;var i=false;s(i,t,r,n);return{data:t,args:r,request_id:n}})},getDataRetention:function e(t,r){TS.api.call("conversations.getRetention",{channel:t}).then(function(e){var t=e.data,n=e.args,i=e.request_id;var a=true;if(r)r(a,t,n,i);return{data:t,args:n,request_id:i}},function(e){var t=e.data,n=e.args,i=e.request_id;var a=false;if(r)r(a,t,n,i);return{data:t,args:n,request_id:i}})},convertToGroup:function e(t,r,n){n=n||{};var i=t.id;return TS.api.call("mpim.convertToGroup",{channel:i,name:r,validate:!!n.validate_name})}});var e=false;var t=function t(r){var n=TS.mpims.getMembersInDisplayOrder(r);if(n.length<2)return r._internal_name;if(!TS.boot_data.feature_esc_fix_dm_browser)if(_.compact(n).length<n.length){var i=_(n).compact().map("id").value();var a=_.without(r.members,i);TS.warn("Missing some members in MPIM "+r.id+":"+a.join(","));var s=_.reject(a,TS.members.getMemberById);if(s.length>0)TS.warn("Some members ("+s.join(",")+") were still unavailable when we tried again; unable to recover");else{TS.info("All members were available when we tried again; recovering");r._members=void 0;n=TS.mpims.getMembersInDisplayOrder()}if(!e){e=true;TS.console.logStackTrace("We are somehow trying to generate a name for an mpim without having all members locally. Here's a stack trace");if(TS.boot_data.feature_tinyspeck)TS.metrics.count("mpim_missing_members_bug_ts_only");else TS.metrics.count("mpim_missing_members_bug")}}return"@"+_(n).compact().map(function(e){if(TS.utility.teams.isMemberExternal(e))return e.name+"_"+e.team_id;return e.name}).value().join(",")};var r=function e(r){if(r._name_lc)TS.redux.channels.removeMpimFromNameMap(r._name_lc);r.name=t(r);r._name_lc=_.toLower(r.name);TS.redux.channels.addEntityToNameMap(r)};var n=function e(t){TS.model.mpims.forEach(function(e){if(-1!==e.members.indexOf(t.id))a(e)})};var i=function e(){TS.model.mpims.forEach(a)};var a=function e(t){t._display_name=void 0;t._display_name_lc=void 0};var s=function e(t,r){var n=TS.mpims.getMembersInDisplayOrder(t);var i=n.map(function(e){var t=TS.members.getPrefCompliantMemberName(e);if(r){var n="";if(TS.members.getMemberCurrentStatus(e).emoji||TS.members.getMemberCurrentStatus(e).text)n=" "+TS.templates.current_status({tip_direction:"bottom",member:e,classes:"ts_tip_float"});t=_.escape($.trim(t));t='<li class="mpdm_member '+TS.templates.makeMemberDomId(e)+" "+TS.templates.makeMemberPresenceStateClass(e)+'" data-member-id="'+e.id+'">'+t+n+"</li>"}return t});var a=r?i.join(" "):i.join(", ");if(!r)t._display_name=a;return a};var o=function e(t){var r=TS.mpims.getMembersInDisplayOrder(t);var n=r.map(function(e){return TS.members.getPrefCompliantMemberName(e)});var i=TS.i18n.listify(n,{strong:true}).join("");return i};var l=function e(t){t._internal_name=t.name;r(t);TS.shared.setPriorityForDev(t);t.is_mpim=true;t.is_group=true;t.opened_this_session=false;t.scroll_top=-1;t.history_is_being_fetched=false;t.unread_highlight_cnt=0;t.unread_highlights=[];t.unread_cnt=0;t.unreads=[];TS.shared.setOldestUnreadTsForId(t.id,null);t.has_fetched_history_after_scrollback=false;if(TS.client){TS.shared.maybeResetHistoryFetched(t);if(TS._incremental_boot&&t.msgs&&t.msgs.length>0){t.msgs=t.msgs.map(function(e){return TS.utility.msgs.processImsg(e,t.id)});TS.utility.msgs.setMsgs(t,t.msgs)}else TS.utility.msgs.setMsgs(t,[])}else if(TS.boot_data.msgs)TS.utility.msgs.ingestMessagesFromBootData(t);t.oldest_msg_ts=TS.storage.fetchOldestTs(t.id);t.last_msg_input=TS.storage.fetchLastMsgInput(t.id);t.has_draft=!!t.last_msg_input};var u=4;var d=142;var c=999})()},4778:function(e,t){(function(){var e="HISTORY";TS.registerModule("shared",{msg_sent_sig:new signals.Signal,onStart:function e(){if(TS.client){TS.channels.switched_sig.add(p);TS.ims.switched_sig.add(p);TS.groups.switched_sig.add(p);TS.mpims.switched_sig.add(p);if(TS.client&&TS.client.unread)TS.client.unread.switched_sig.add(p);if(TS.client&&TS.client.threads)TS.client.threads.switched_sig.add(p);var t=function e(){r=true;y()};TS.redux.socket.connectedSig.addOnce(t);TS.redux.socket.connectedSig.add(k)}},test:function e(){var t={};Object.defineProperty(t,"_queried_usernames",{get:function e(){return w},set:function e(t){w=t}});return t},didDeferMessageHistoryById:function e(t){if(!t)return false;return i[t]},setDeferMessageHistoryForId:function e(t,r){if(!t)return;i[t]=!!r},getUserCountsInfoById:function e(t){if(!t)return;return s[t]},setUserCountsInfoForId:function e(t,r){if(!t)return;s[t]=r},deleteUserCountsInfoForId:function e(t){if(!t)return;delete s[t]},getOldestUnreadTsForId:function e(t){if(!t)return;return o[t]},setOldestUnreadTsForId:function e(t,r){if(!t)return;o[t]=r},calcUnreadCnts:function e(t,r,n){if(TS.useReactMessages())return;if(TS._incremental_boot)return;if(TS.shared.didDeferMessageHistoryById(t.id))if(!t.is_im&&!t.is_mpim){if(!a[t.id]){var i=2500;var o=1e4;if(TS.boot_data.feature_less_history_when_muted&&TS.notifs.isCorGMuted(t.id))o*=3;var l=_.random(i,o);if(TS.has_pri[A])TS.log(A,"calcUnreadCnts ("+t.id+"): no history in model, no history call yet - delaying "+l+" ms before history fetch.");a[t.id]=window.setTimeout(function(){if(TS.has_pri[A])TS.log(A,"calcUnreadCnts ("+t.id+"): fetching after "+l+" ms delay.");delete a[t.id];TS.shared.checkInitialMsgHistory(t,r)},l)}}else{TS.shared.checkInitialMsgHistory(t,r);return}t.unreads.length=0;t.unread_highlights.length=0;TS.shared.setOldestUnreadTsForId(t.id,null);var u=t.msgs;var d=t.unread_cnt;var c=t.unread_highlight_cnt;var m;var f=false;var p=false;var h=true;var g="away"===TS.model.user.presence;if(!t.was_archived_this_session){if(t.is_archived)h=false;if(t.is_channel&&!t.is_member)h=false}if(t.is_im){var S=TS.members.getMemberById(t.user);if(S&&S.deleted)h=false}var T=TS.notifs.isCorGMuted(t.id);var v=t.is_im||t.is_mpim||TS.notifs.canModelObHaveChannelMentions(t);var b;if(h&&u)for(var y=0;y<u.length;y+=1){m=u[y];if(m.ts<=t.last_read)continue;if(TS.utility.msgs.isTempMsg(m)&&!m._alert_even_though_temp)continue;p=TS.utility.msgs.msgCanCountAsUnread(m);f=f||p;if(!p)continue;t.unreads.push(m.ts);var w=TS.shared.getOldestUnreadTsForId(t.id);if(!w||m.ts<w)TS.shared.setOldestUnreadTsForId(t.id,m.ts);if("thread_broadcast"===m.subtype)continue;if(v){var k=1e3*parseFloat(m.ts);b=g||k<TS.model.user._presence_last_changed;if(TS.utility.msgs.msgContainsMention(m,b))if(TS.permissions.members.canMsgMentionChannelIfMention(m.text,t.id,m.user)){TS.log(99,"allowing channel mention for msg.ts "+m.ts+" from member "+m.user+" in "+t.id);t.unread_highlights.push(m.ts)}else TS.log(99,"ignoring large channel mention for msg.ts "+m.ts+" from member "+m.user+" in "+t.id+" because member is not an admin.")}else if(TS.utility.msgs.getMsgMentionData(m).non_channel_mentions)t.unread_highlights.push(m.ts)}if(!f&&t.unreads.length){t.unreads.length=0;t.unread_highlights.length=0;TS.shared.setOldestUnreadTsForId(t.id,null);if(n)r.markMostRecentReadMsg(t,TS.model.marked_reasons.none_qualify)}if(TS.has_pri[E])TS.log(E,"TS.shared.calcUnreadCnts: "+t.id+", unreads.length: "+t.unreads.length+" and_mark: "+n);var x=TS.shared.lastReadIsOlderThanCurrentHistory(t);if(x)t.unread_cnt=Math.max(t.unread_cnt,t.unreads.length);else t.unread_cnt=t.unreads.length;if(T)if(t.unread_cnt)t._show_in_list_even_though_no_unreads=true;if(x)t.unread_highlight_cnt=Math.max(t.unread_highlight_cnt,t.unread_highlights.length);else t.unread_highlight_cnt=t.unread_highlights.length;TS.shared.maybeMarkReadIfMuted(t,r);TS.utility.msgs.countAllUnreads();if(d!=t.unread_cnt)r.unread_changed_sig.dispatch(t);if(c!=t.unread_highlight_cnt)r.unread_highlight_changed_sig.dispatch(t);if(TS.client){if(!s[t.id]||!s[t.id].has_unreads)return;if(!t._history_fetched_since_last_connect||t.history_is_being_fetched)return;if(!t.msgs.length||t.unread_cnt)return;delete s[t.id];if(TS.notifs.isCorGMuted(t.id)){if(TS.has_pri[E])TS.log(E,"TS.shared.calcUnreadCnts: "+t.id+": ignoring possible users.counts has_unreads discrepancy because channel is muted.");return}var C=TS.shared.getActiveModelOb();if(C&&C.id===t.id){if(TS.has_pri[E])TS.log(E,"TS.shared.calcUnreadCnts: "+t.id+": ignoring possible users.counts has_unreads discrepancy due to active channel.");return}var M=TS.utility.msgs.getMostRecentValidTs(t);var I=TS.model.marked_reasons.none_qualify;TS.warn('Found users.counts discrepancy: has_unreads = true for "'+t.id+'", but client calculated 0 unreads after fetching history ('+t.msgs.length+' msgs). Marking now with reason="'+I+'" to correct discrepancy, assuming last_read ('+t.last_read+") < latest ("+M+").");if(parseFloat(t.last_read)>=parseFloat(M)){TS.warn('Error last >= latest for "'+t.id+'"? Bailing, not attempting to mark.');return}r.markMostRecentReadMsg(t,I)}},getLatestMsgTs:function e(t){if(t.latest&&t.latest.ts){if(TS.has_pri[A])TS.log(A,"getLatestMsgTs ("+t.id+"): returning model_ob.latest.ts of "+t.latest.ts);return t.latest.ts}var r=t.latest||t._latest_via_users_counts;if(TS.has_pri[A])TS.log(A,"getLatestMsgTs ("+t.id+"): no latest.ts, returning latest || _latest_via_users_counts ("+t.latest+" || "+t._latest_via_users_counts+") -> "+r);return r},queueConsistencyCheckAfterHistory:function e(t){if(!t){TS.warn("queueConsistencyCheck: no model_ob");return}if(t._consistency_is_being_checked||t._consistency_has_been_checked)return;var r=TS.shared.getControllerForModelOb(t);r.history_fetched_sig.addOnce(function(e){if(!e)return;if(e._consistency_is_being_checked||e._consistency_has_been_checked)return;if(TS.has_pri[A])TS.log(A,'"'+t.id+'": fetched history, now checking consistency.');TS.utility.msgs.checkConsistencyViaApi(e.id)})},maybeFetchHistoryAndThenCheckConsistency:function e(t){var r=true;TS.shared.maybeFetchHistory(t,r)},maybeFetchHistory:function e(t,r){if(!t){TS.warn("maybeFetchHistory: no model_ob?");return}var n;if(TS.has_pri[A])n='maybeFetchHistory: "'+t.id+'": ';if(t.history_is_being_fetched){if(TS.has_pri[A])TS.log(A,n+"history is being fetched already. Queueing consistency check and exiting.");TS.shared.queueConsistencyCheckAfterHistory(t);return}if(t._history_fetched_since_last_connect){if(TS.has_pri[A])TS.log(A,n+"history already fetched.");TS.utility.msgs.checkConsistencyViaApi(TS.model.active_cid);return}if(TS.has_pri[A])if(r)TS.log(A,n+"checking history first, then consistency.");else TS.log(A,n+"checking history.");if(r)TS.shared.queueConsistencyCheckAfterHistory(t);var i=TS.shared.getControllerForModelOb(t);TS.shared.checkInitialMsgHistory(t,i);if(TS.client&&TS.client.msg_pane)TS.client.msg_pane.maybeClearNewMsgsTimer(t)},checkInitialMsgHistory:function e(t,n,i){if(TS.useReactMessages())return;if(t.history_is_being_fetched){TS.warn('checkInitialMsgHistory NOT DOING ANYTHING, because "'+t.id+'" history_is_being_fetched:true');return}var s=TS.isPartiallyBooted()||!r;if(s&&TS._did_incremental_boot&&t.id===TS.model.active_channel_id)return;if(a[t.id]){if(TS.has_pri[A])TS.log(A,"checkInitialMsgHistory ("+t.id+"): Clearing _delayed_fetch_timer and fetching immediately");window.clearTimeout(a[t.id]);delete a[t.id]}TS.shared.setDeferMessageHistoryForId(t.id,false);if(i)t._needs_unread_recalc=true;else TS.utility.msgs.maybeFetchUserDataFromLS(t);var o=TS.model.initial_msgs_cnt;var l=TS.shared.getLatestMsgTs(t);var u=TS.utility.msgs.getMsg(l,t.msgs);if(u&&!t._history_fetched_since_last_connect){if(TS.has_pri[A])TS.log(A,'We have all recent "'+t.id+'" messages, but have not fetched history since last connect. Will fetch, omitting "latest".');u=null;l=null}var d;if(u){if(TS.has_pri[A])TS.log(A,'we have all recent "'+t.id+'" msgs unread_count:'+t.unread_count+" unread_cnt:"+t.unread_cnt+" initial_count:"+o);TS.shared.maybeDealWithAllSentTempMsgs(t,n);var _=TS.utility.msgs.getOlderMsgsStatus(t);if(t.msgs.length<TS.model.initial_msgs_cnt&&_.more){if(TS.isPartiallyBooted());else{TS.error("calling loadHistory because status.more=true && model_ob.msgs.length < TS.model.initial_msgs_cnt: "+t.msgs.length+" < "+TS.model.initial_msgs_cnt);TS.dir(0,_,t.id);TS.shared.loadHistory(t,n,o)}return true}}else if(i)TS.shared.setDeferMessageHistoryForId(t.id,true);else{if(TS.has_pri[A])TS.log(A,'WE DO NOT HAVE ALL RECENT MESSAGES for "'+t.id+'" unread_count:'+t.unread_count+" unread_cnt:"+t.unread_cnt+" initial_count:"+o);var c=false;if(!t.msgs.length);d={channel:t.id,count:o,inclusive:"string"===typeof t.latest,ignore_replies:true,include_pin_count:true};if(l)d.latest=l;if(c){if(TS.has_pri[A])TS.log(A,'we have some but not all recent "'+t.id+'" msgs but we no_oldest so are not setting oldest for api call')}else if(t.msgs.length&&!TS.utility.msgs.isTempMsg(t.msgs[0])){if(TS.has_pri[A])TS.log(A,'we have some but not all recent "'+t.id+'" msgs');d.oldest=t.msgs[0].ts}else if(TS.has_pri[A])TS.log(A,'we have no "'+t.id+'" msgs');if(!t._history_fetched_since_last_connect)if(!t.msgs.length){if(TS.has_pri[A])TS.log(A,'we have no msgs for "'+t.id+'", and have not fetched history since last connection');if(d.latest){if(TS.has_pri[A])TS.log(A,"no msgs.length. dropping api_args.latest of "+d.latest+' for "'+t.id+'"');delete d.latest}if(d.oldest){if(TS.has_pri[A])TS.log(A,"no msgs.length. dropping api_args.oldest of "+d.oldest+' for "'+t.id+'"');delete d.oldest}}else if(1===t.msgs.length&&!TS.utility.msgs.isTempMsg(t.msgs[0])){if(TS.has_pri[A])TS.log(A,"first new message on "+t.id+", fetching history without any latest/oldest");delete d.latest;delete d.oldest}else{if(TS.has_pri[A])TS.log(A,"we have some ("+t.msgs.length+') but not all recent msgs for "'+t.id+'", and have not fetched history since last connection');if(d.latest){if(TS.has_pri[A])TS.log(A,'first history fetch since connect for "'+t.id+'" - deleting api_args.latest of '+d.latest);delete d.latest}if(d.oldest&&d.count)if(TS.has_pri[A])TS.log(A,"We have api_args.oldest, fetching oldest + "+d.count+' messages on "'+t.id+'" to get client up-to-date.')}var m=function e(){if(t.history_is_being_fetched){if(TS.has_pri[A])TS.log(A,'NOT fetching history on "'+t.id+'", history already being fetched')}else{if(TS.has_pri[A])TS.log(A,'fetching history for "'+t.id+'" with api_args',d);n.fetchHistory(t,d)}};if(TS.redux.socket.isConnected())m();else TS.redux.socket.connectedSig.addOnce(m)}},maybeLoadScrollBackHistory:function t(r,n,i){if(!i&&0!==r.scroll_top)return false;var a=TS.utility.msgs.getOlderMsgsStatus(r);if(!a.more){TS.interop.console.info(e,"Not loading scrollback in "+r.id+": "+a.text);if(3===a.code){var s=_.map(r.msgs,"ts");TS.shared.checkForMoreMsgs(r).then(function(){var e;e="more messages than expected in "+r.id;TS.logError(e,"oldest_msg_ts or is_limited is wrong","Scrollback history error");var t=_.map(r.msgs,"ts");var i=_.difference(s,t);var a=_.difference(t,s);if(i.length||a.length){e="timestamps not present in new data:"+i.toString()+"; timestamps not present in old data: "+a.toString();TS.logError(e,"Found a difference in timestamps before and after history call","Scrollback history error")}else TS.log(null,"Did not find a difference between old and new timestamp data after history API call.");if(TS.shared.getActiveModelOb().id!==r.id||r.history_is_being_fetched)return;if(r.is_limited)r.is_limited=false;if(r.oldest_msg_ts)TS.utility.msgs.resetOldestMsgsTs(r);TS.shared.loadScrollBackHistory(r,n)},_.noop)}return false}return TS.shared.loadScrollBackHistory(r,n)},loadScrollBackHistory:function t(r,n){if(!r.msgs.length){if(TS.has_pri[A])TS.log(A,"TS.shared.loadScrollbackHistory: No messages in "+r.id+" yet; not loading scrollback history.");if(!r._history_fetched_since_last_connect){if(TS.has_pri[A])TS.log(A,"TS.shared.loadScrollBackHistory: No messages, and history has not been fetched since last connect; doing an initial fetch.");TS.shared.checkInitialMsgHistory(r,n)}return}TS.interop.console.info(e,r.id+" HAS MORE");TS.shared.loadHistory(r,n);r.has_fetched_history_after_scrollback=true;r.fetched_history_after_scrollback_time=Date.now();return true},loadHistory:function e(t,r,n){var i={channel:t.id,latest:t.msgs[t.msgs.length-1].ts,count:n||TS.model.subsequent_msgs_cnt,ignore_replies:true,include_pin_count:true};r.fetchHistory(t,i)},checkForMoreMsgs:function e(t){var r={channel:t.id,latest:t.msgs[t.msgs.length-1].ts,count:1,ignore_replies:true,include_pin_count:true};var n=TS.boot_data.feature_trace_reason?TS.console.getStackTrace().replace(/(\(?http.*\)?)|at|Array|Object/g,"").trim().substring(0,200):"";if(n)r._x_reason=n;return TS.api.call("conversations.history",r).then(function(e){if(e.data.messages&&e.data.messages.length>0)return Promise.resolve(e);return Promise.reject(new Error("No more messages"))})},onSendMsg:function e(t,r,n,i){var a=r.temp_ts?TS.utility.msgs.getMsgByProp("temp_ts",r.temp_ts,n.msgs):null;if(!t){if(a){TS.model.unsent_msgs[a.ts]=true;i.msg_not_sent_sig.dispatch(n,a,r)}else TS.error("that makes no sense");return}TS.view.scroll_down_when_msg_from_user_is_added=true;var s;if(a){s=_.cloneDeep(a);s.text=r.text;s.ts=r.ts;delete s.is_pending;i.removeMsg(n.id,a)}else{TS.warn("no temp msg for "+r.reply_to);s={text:r.text,user:TS.model.user.id,ts:r.ts}}if(r.SENT_MSG.thread_ts)s.thread_ts=r.SENT_MSG.thread_ts;i.addMsg(r.SENT_MSG.channel||n.id,TS.utility.msgs.processImsg(s,n.id));TS.shared.maybeShowEphemeralUserGroupMessage(n,s);var o=TS.client&&TS.client.stats&&TS.client.stats.isEnabled();if(o)TS.metrics.measureAndClear("send_msg_"+TS.shared.getTypeForModelOb(),"msg_input_try_to_submit");if(n.id)c(n.id,s)},maybeShowEphemeralUserGroupMessage:function e(t,r){var n;if(t.is_channel)n=TS.i18n.t("channel","shared")();else if(t.is_group&&!t.is_mpim)n=TS.i18n.t("private channel","shared")();else return;var i=r.text.match(/<!subteam(.*?)>/g);if(i)for(var a=0;a<i.length;a+=1){var s=i[a].replace(">","").replace("<","");s=s.split("|")[0];var o=s.split("^")[1];if(!o)continue;(function(e){TS.user_groups.getUserGroupMembers(e,function(i){var a=_.uniq(i.users);if(!a)return;TS.membership.ensureChannelMembershipIsKnownForUsers(t.id,a).then(function(){var i=[];a.forEach(function(e){var r;if(TS.boot_data.feature_store_membership_in_redux)r=TS.redux.membership.getChannelMembershipInfoForUser(t.id,e);else r=TS.membership.getUserChannelMembershipStatus(e,t);if(!r.is_member)i.push(e)});if(!i.length)return;var s=TS.interop.datetime.makeTsStamp();var o="<!subteam^"+e+">";var l=i.length;var u="TS.client.ui.promptForGroupOrChannelInvite('"+t.id+"', '"+i.join(",")+"', '"+s+"')";var d="TS.client.ui.sendChannelMsgThroughSlackBot('"+t.id+"', '"+r.ts+"', '"+i.join(",")+"', '"+s+"')";var _="TS.utility.msgs.removeEphemeralMsg('"+t.id+"', '"+s+"')";TS.client.msg_pane.addMaybeClick(u,TS.client.ui.promptForGroupOrChannelInvite.bind(Object.create(null),t.id,i.join(","),s));TS.client.msg_pane.addMaybeClick(d,TS.client.ui.sendChannelMsgThroughSlackBot.bind(Object.create(null),t.id,r.ts,i.join(","),s));TS.client.msg_pane.addMaybeClick(_,TS.utility.msgs.removeEphemeralMsg.bind(Object.create(null),t.id,s));var c="";c=TS.i18n.t("{member_count, plural, =1 {One member} =2 {Two members} =3 {Three members} =4 {Four members} =5 {Five members} =6 {Six members} =7 {Seven members} =8 {Eight members} =9 {Nine members} =10 {Ten members} other {# members}} of the {name} group {member_count, plural, =1 {isn’t} other {aren’t}} in this {channel}. ","shared")({name:o,member_count:l,channel:n});if("G"===t.id.charAt(0))c+=TS.i18n.t("If you’d like I can <javascript:{prompt}|invite them to join>, or, <javascript:{nothing}|do nothing>.","shared")({prompt:u,nothing:_});else c+=TS.i18n.t("If you’d like Slack can <javascript:{message}|notify them about your message>.","shared")({message:d});TS.client.ui.addEphemeralBotMsg({channel:t.id,ts:s,text:c,thread_ts:r.thread_ts})})})})(o)}},sendMsg:function e(r,n,i,a,s){if(!n)return false;var o=TS.useReactMessages()&&!a;var l=TS.shared.getModelObById(r);var u=l&&l.msgs&&l.msgs[0]&&TS.interop.datetime.toDateObject(l.msgs[0].ts+1)||Date.now();if(o){u=Date.now();var d=TS.redux.getState();var c=TS.interop.redux.models.channelHistory.getTimestampsByChannelId(d,r);if(c&&c.reachedEnd&&!_.isEmpty(c.timestamps)){var m=_.max(c.timestamps);var f=Date.now()/1e3;if(f<m)u=TS.interop.datetime.toDateObject(m+1)}}var p=TS.interop.datetime.makeTsStamp(u);var h=TS.format.cleanMsg(n);var g={type:"message",channel:r,text:$.trim(h)};if(a){g.thread_ts=a.thread_ts||a.ts;g.reply_broadcast=s}if(o){TS.redux.dispatch(TS.interop.redux.actions.sendMessage.send(g,p));TS.typing.userEnded(l);return true}TS.interop.SocketManager.send(g).then(function(e){e.temp_ts=p;if(i&&i.onSendMsg)i.onSendMsg(true,e)}).catch(function(e){e.msg=e.msg||{};e.msg.temp_ts=p;if(i&&i.onSendMsg){if(TS.boot_data.page_needs_enterprise&&TS.boot_data.feature_default_shared_channels){var t=e.msg.error.code;if(6===t||7===t||8===t)TS.channels.read_only.stashAndFetchChannelPostingUpdates(e.msg.SENT_MSG.channel,t)}i.onSendMsg(false,e.msg)}}).finally(function(){_.pull(t[r],p)});t[r]=t[r]||[];t[r].push(p);TS.typing.userEnded(l);var S={type:"message",text:h,user:TS.model.user.id,ts:p,is_pending:true,temp_ts:p};if(g.thread_ts){S.thread_ts=g.thread_ts;S._hidden_reply=true;S._was_reply_broadcast=g.reply_broadcast}i.addMsg(r,S);TS.shared.msg_sent_sig.dispatch(l);return true},sendMsgGroup:function e(t,r,n,i,a){var s=TS.shared.getModelObById(t);var o=s.is_mpim?TS.i18n.t("conversation","shared")():TS.i18n.t("channel","shared")();var l=s.is_mpim?"conversation":"channel";if(!s)return false;if(s.is_archived)return false;var u=TS.channels.getGeneralChannel();var d=function e(t){TS.generic_dialog.alert(t).then(function(){if(i)TS.ui.replies.focusReplyInput();else TS.view.focusMessageInput()});if(i)TS.ui.replies.populateReplyInput(r);else TS.utility.contenteditable.value(TS.client.ui.$msg_input,r)};var c=TS.format.cleanMsg(r);var m=!!i;var f;if(TS.model.everyone_regex.test(c)&&!m){if(!TS.permissions.members.canAtMentionEveryone()){if(!TS.permissions.members.canNonAdminsAtMentionEveryoneBySettings())f="<p>"+TS.i18n.t("A Workspace Owner has restricted the use of <strong>{everyone}</strong> messages.","shared")({everyone:TS.templates.builders.atLabel("everyone")})+"</p>";else f="<p>"+TS.i18n.t("Usage of <strong>{everyone}</strong> is restricted to Workspace Admins in the large general channel.","shared")({everyone:TS.templates.builders.atLabel("everyone")})+"</p>";if(TS.permissions.members.canAtChannelOrGroup(s.id))if("channel"===l)f+='<p class="no_bottom_margin">'+TS.i18n.t("If you just want to address everyone in this channel, use <strong>{at_label}</strong> instead.","shared")({at_label:TS.templates.builders.atLabel(l)})+"</p>";else f+='<p class="no_bottom_margin">'+TS.i18n.t("If you just want to address everyone in this conversation, use <strong>{at_label}</strong> instead.","shared")({at_label:TS.templates.builders.atLabel(l)})+"</p>";else if(TS.model.user.is_restricted)f="<p>"+TS.i18n.t("Your account is restricted, and you cannot send <strong>{everyone}</strong> messages.","shared")({everyone:TS.templates.builders.atLabel("everyone")})+"</p>";d(f);return false}if(!u||!u.is_member){f="<p>"+TS.i18n.t("You cannot send <strong>{everyone}</strong> messages.","shared")({everyone:TS.templates.builders.atLabel("everyone")})+"</p>";if(TS.permissions.members.canAtChannelOrGroup())f+='<p class="no_bottom_margin">'+TS.i18n.t("If you just want to address everyone in this {conversation_or_channel}, use <strong>{at_label}</strong> instead.","shared")({conversation_or_channel:o,at_label:TS.templates.builders.atLabel(l)})+"</p>";d(f)}else TS.generic_dialog.start({title:TS.i18n.t("Send {everyone} a message","shared")({everyone:TS.templates.builders.atLabel("everyone")}),body:TS.i18n.t('<p class="bold">Would you like to switch to {general_channel} and send your message?</p><p class="">Using <strong>{everyone}</strong> in a message is a way to address your entire workspace, but it must be done in the {general_channel} channel.</p><p class="no_bottom_margin">If you just want to address everyone in this {conversation_or_channel}, use <strong>{channel}</strong> instead.</p>',"shared")({general_channel:"#"+_.escape(u.name),conversation_or_channel:o,everyone:TS.templates.builders.atLabel("everyone"),channel:TS.templates.builders.atLabel("channel")}),show_cancel_button:true,show_go_button:true,go_button_text:TS.i18n.t("Yes, send it","shared")(),onGo:function e(){TS.channels.displayChannel({id:u.id,and_send_txt:r})},onCancel:function e(){TS.utility.contenteditable.value(TS.client.ui.$msg_input,r);TS.view.focusMessageInput()}});return false}var p=TS.model.here_regex.test(c);var h=(TS.model.channel_regex.test(c)||TS.model.group_regex.test(c))&&!m;if((h||p)&&!TS.permissions.members.canAtChannelOrGroup()){var g=p?TS.templates.builders.atLabel("here"):TS.templates.builders.atLabel("channel");f="<p>"+TS.i18n.t("A Workspace Owner has restricted the use of <strong>{key_word}</strong> messages.","shared")({key_word:g})+"</p>";d(f);return false}if(!m&&TS.ui.needToShowAtChannelWarning(t,r)){TS.ui.at_channel_warning_dialog.startInMessagePane(t,r,n);return false}return TS.shared.sendMsg(t,r,n,i,a)},onHistory:function t(r,n,i,a){var s=r.msgs;var o;if(n.is_limited){if(TS.has_pri[A])TS.log(A,'data.is_limited case: setting has_more = false, is_limited = true for "'+r.id+'"',i);n.has_more=false;r.is_limited=true}var l;if(!r._history_fetched_since_last_connect){if(TS.has_pri[A])TS.log(A,'first history fetch for "'+r.id+'"',i);if(TS.client&&TS.client.msg_pane)TS.client.msg_pane.maybeResetUnreadsCheck(r);if(i.oldest)if(!n.has_more){if(TS.has_pri[A])TS.log(A,'first history fetch. has_more is false for "'+r.id+'" - we should have all recent msgs. Setting _history_fetched_since_last_connect.',i);r._history_fetched_since_last_connect=true;if(r.history_is_being_fetched){if(TS.has_pri[A])TS.log(A,'Resetting history_is_being_fetched for "'+r.id+'"');r.history_is_being_fetched=false}l=true;if(TS.client&&TS.client.msg_pane)TS.client.msg_pane.maybeStartNewMsgsTimer(r)}else{r.msgs=[];c={channel:r.id,count:TS.model.initial_msgs_cnt,inclusive:true};if(TS.has_pri[A])TS.log(A,'first history fetch. has_more is TRUE for "'+r.id+'" - dumping history and fetching most recent '+TS.model.initial_msgs_cnt+" msgs. prior history call data follows.",i);a.fetchHistory(r,c);return true}else{if(TS.boot_data.feature_scrollback_half_measures&&TS.prefs.getPref("start_scroll_at_oldest")){var u=parseInt(r.last_read,10)?r.last_read:null;if(n.messages&&u&&!i._second_attempt_for_last_read){var d=_.minBy(n.messages,"ts");if(d&&d.ts>u){var c={channel:r.id,count:3*TS.model.initial_msgs_cnt,inclusive:true,_second_attempt_for_last_read:true};if(TS.has_pri[A])TS.log(A,"last_read for "+r.id+" is older than the first history response, trying again with a larger count");a.fetchHistory(r,c);return true}}}if(TS.has_pri[A])TS.log(A,'first history fetch. no "oldest" param for "'+r.id+'", marking _history_fetched_since_last_connect = true.',i);r._history_fetched_since_last_connect=true;if(r.history_is_being_fetched){if(TS.has_pri[A])TS.log(A,'Resetting history_is_being_fetched for "'+r.id+'"');r.history_is_being_fetched=false}l=true;if(TS.client&&TS.client.msg_pane)TS.client.msg_pane.maybeStartNewMsgsTimer(r)}}if(i.oldest)if(n.has_more){TS.interop.console.info(e,r.id+" has more than one page of msg history between what is in cache and the latest, so let's dump what we have and just use this page of results");TS.interop.console.info(e,r.id+" args.oldest:"+i.oldest);s.length=0;if(r.is_limited)r.is_limited=false}var m=[];var f=[];if(n.messages){for(var p=0;p<n.messages.length;p+=1)if(!TS.utility.msgs.getMsg(n.messages[p].ts,s)){o=n.messages[p];m.push(TS.utility.msgs.processImsgFromHistory(o,r.id));f.push(o.ts)}if(TS.has_pri[A])TS.log(A,'got history for "'+r.id+'", added '+m.length+" new messages out of "+n.messages.length+" total.")}if(m.length&&!TS.utility.msgs.getDisplayedMsgs(m).length)TS.warn("no displayed msgs in this page for "+r.id+" ! We expect TS.client.ui.afterHistoryFetch to detect this and load another page");s=m.concat(s);s=TS.utility.msgs.setMsgs(r,s);if(TS.has_pri[O])TS.log(O,r.id+" msgs has more history now");if(r.latest&&r.latest.ts&&!TS.utility.msgs.getMsg(r.latest.ts,s)){if(TS.has_pri[O])TS.log(O,"tacking on latest msg "+r.latest.ts);o=r.latest;TS.utility.msgs.appendMsg(s,TS.utility.msgs.processImsgFromHistory(o,r.id));TS.utility.msgs.sortMsgs(s)}if(!i.oldest)if(!n.has_more&&!n.is_limited)TS.utility.msgs.setOldestMsgsTs(r);TS.shared.maybeDealWithAllSentTempMsgs(r,a);if(l){if(TS.has_pri[A])TS.log(A,"onHistory: post-message merge, doing recalc of unread counts for "+r.id);var h=false;a.calcUnreadCnts(r,h)}if(TS.pins)TS.pins.updateCount(r,n.pin_count)},maybeDealWithAllSentTempMsgs:function r(n,i){if(!TS.useSocket())return;function a(t){var r=TS.utility.msgs.getMsg(t,n.msgs);if(!r)return;var a=TS.utility.msgs.getNonTempMsgFromUserMatchingText(r.text,TS.model.user.id,n.msgs);if(a){var s=TS.interop.datetime.toDateObject(a.ts);var o=TS.interop.datetime.toDateObject(t);if(s<o){TS.interop.console.info(e,"existing_msg time is older than temp_msg time, so it can’t be the message we were looking for");a=null}}if(!a){TS.warn("not removing, we don’t appear to have this non-temp message: "+r.ts);TS.model.unsent_msgs[r.ts]=true;i.msg_not_sent_sig.dispatch(n,r);return}TS.interop.console.info(e,"removing temp_msg: "+r.ts+" existing_msg:"+a.ts);if(!i)i=TS.shared.getControllerForModelOb(n);if(_.isFunction(i.removeMsg))i.removeMsg(n.id,r);return true}if(!t.hasOwnProperty(n.id))return;t[n.id].forEach(function(e){a(e)});delete t[n.id]},getControllerForModelOb:function e(t){if(!t)return{};if(t.is_im)return TS.ims;else if(t.is_mpim&&t.is_group)return TS.mpims;else if(t.is_group)return TS.groups;return TS.channels},getActiveModelOb:function e(){var t;if(TS.client){if(TS.model.active_channel_id)t=TS.channels.getChannelById(TS.model.active_channel_id);else if(TS.model.active_im_id)t=TS.ims.getImById(TS.model.active_im_id);else if(TS.model.active_mpim_id)t=TS.mpims.getMpimById(TS.model.active_mpim_id);else if(TS.model.active_group_id)t=TS.groups.getGroupById(TS.model.active_group_id)}else if(TS.boot_data.channel_id)t=TS.channels.getChannelById(TS.boot_data.channel_id);else if(TS.boot_data.im_id)t=TS.ims.getImById(TS.boot_data.im_id);else if(TS.boot_data.mpim_id)t=TS.mpims.getMpimById(TS.boot_data.mpim_id);else if(TS.boot_data.group_id)t=TS.groups.getGroupById(TS.boot_data.group_id);else{TS.warn("error getActiveModelOb found no ob");TS.warn("TS.boot_data.channel_id: "+TS.boot_data.channel_id);TS.warn("TS.boot_data.im_id: "+TS.boot_data.im_id);TS.warn("TS.boot_data.group_id: "+TS.boot_data.group_id)}return t},getDisplayNameForModelOb:function e(t){if(t.is_mpim)return TS.mpims.getDisplayName(t);else if(t.is_im){var r=false;var n=true;return TS.members.getPrefCompliantMemberNameById(t.user,r,n)}else if(t.is_group||t.is_private)return t.name;else if(t.is_channel)return"#"+t.name;TS.warn("getDisplayNameForModelOb: unknown model_ob type: "+t.id);return t.id},getTypeForModelOb:function e(t){t=t||TS.shared.getActiveModelOb();if(!t)return"";if(t.is_mpim)return"mpim";if(t.is_slackbot_im)return"slackbot";if(t.is_im)return"im";if(t.is_group)return"group";if(t.is_channel)return"channel";return""},getDisplayNameForModelObNoSigns:function e(t){if(t.is_mpim)return TS.mpims.getDisplayName(t);else if(t.is_im){var r=false;var n=false;return TS.members.getPrefCompliantMemberNameById(t.user,r,n)}else if(t.is_group||t.is_channel)return t.name;TS.warn("getDisplayNameForModelOb: unknown model_ob type: "+t.id);return t.id},getEntitiesFilteredBy:function e(t,r){if(!t)return[];if(!r)return TS.model[t];return _.filter(TS.model[t],r)},getModelObById:function e(t){if(!t)return null;var r=t[0];if("C"===r)return TS.channels.getChannelById(t);else if("G"===r)return TS.mpims.getMpimById(t)||TS.groups.getGroupById(t);else if("S"===r)return TS.user_groups.getUserGroupsById(t);else if("E"===r)return TS.emoji.getEmojiById(t);else if("B"===r)return TS.bots.getBotById(t);else if("U"===r||"W"===r)return TS.members.getMemberById(t);else if("D"===r)return TS.ims.getImById(t);else if("T"===r)return TS.teams.getTeamById(t);return null},getAllModelObsForUser:function e(){return TS.channels.getChannelsForUser().concat(TS.model.groups,TS.model.ims,TS.model.mpims)},getShareModelObId:function e(t,r){var n;var i;var a=function e(t){if(TS.model.archive_view_is_showing&&TS.client.archives.current_model_ob.id==t)TS.client.archives.cancel()};if(t&&TS.interop.utility.looksLikeMemberId(t)){n=TS.ims.getImByMemberId(t);if(!n){var s=function e(i,a,s){if(i){TS.ims.onOpened(i,a,s);n=TS.ims.getImByMemberId(t);if(n)r(n.id);else if(TS.web)r(a.channel.id);else TS.error("getShareModelObId opened an IM, but it is not in the model? data.channel.id: "+a.channel.id)}else TS.error("getShareModelObId try to open an IM, but failed data: "+JSON.stringify(a||null))};TS.api.call("conversations.open",{users:t,return_im:true,reason:"TS.shared.getShareModelObId"}).then(function(e){var t=e.data,r=e.args,n=e.request_id;var i=true;s(i,t,r,n);return{data:t,args:r,request_id:n}}).catch(function(e){var t=e.data,r=e.args,n=e.request_id;var i=false;s(i,t,r,n);return{data:t,args:r,request_id:n}})}else{t=n.id;a(t);r(t)}}else if(t&&"C"===t.charAt(0)){i=TS.channels.getChannelById(t);if(!i.is_member&&!i.is_archived)TS.channels.joinById(i.id,function(e){if(e)r(t);else r(t)});else{a(t);r(t)}}else{a(t);r(t)}},getModelObIdForSendingMsg:function e(t,r){var n;var i;if(t&&TS.interop.utility.looksLikeMemberId(t)){n=TS.ims.getImByMemberId(t);if(!n){var a=function e(i,a,s){if(i){TS.ims.onOpened(i,a,s);n=TS.ims.getImByMemberId(t);if(n)r(n.id);else if(TS.web)r(a.channel.id);else TS.error("getModelObIdForSendingMsg opened an IM, but it is not in the model? data.channel.id: "+a.channel.id)}else TS.error("getModelObIdForSendingMsg try to open an IM, but failed data: "+JSON.stringify(a||null))};TS.api.call("conversations.open",{users:t,return_im:true,reason:"TS.shared.getModelObIdForSendingMsg"}).then(function(e){var t=e.data,r=e.args,n=e.request_id;var i=true;a(i,t,r,n);return{data:t,args:r,request_id:n}}).catch(function(e){var t=e.data,r=e.args,n=e.request_id;var i=false;a(i,t,r,n);return{data:t,args:r,request_id:n}})}else{t=n.id;r(t)}}else if(t&&"C"===t.charAt(0)){i=TS.channels.getChannelById(t);if(!i.is_member&&!i.is_archived)TS.channels.joinById(i.id,function(e){if(e)r(t);else r(t)});else r(t)}else r(t)},maybeMarkReadIfMuted:function e(t){if(!t)return;if(!t.is_mpim)return;if(!TS.notifs.isCorGMuted(t.id))return;if(!t.unreads.length||t.unread_highlights.length)return;if("hide_read_channels"===TS.prefs.getPref("sidebar_behavior")){if(TS.model.active_cid==t.id)return}else if("hide_read_channels_unless_starred"===TS.prefs.getPref("sidebar_behavior")&&!t.is_starred)if(TS.model.active_cid==t.id)return;if(t.is_mpim)TS.mpims.markMostRecentReadMsg(t,TS.model.marked_reasons.muted);else if(t.is_group)TS.groups.markMostRecentReadMsg(t,TS.model.marked_reasons.muted);else TS.channels.markMostRecentReadMsg(t,TS.model.marked_reasons.muted)},markReadMsg:function e(t,r,n){var i=TS.shared.getModelObById(t);var a=TS.shared.getControllerForModelOb(i);if(_.isFunction(a.markReadMsg))a.markReadMsg(i.id,r,n)},moveLastMsgInput:function e(t,r){if(!t.last_msg_input)return;r.last_msg_input=t.last_msg_input;r.has_draft=!!r.last_msg_input;t.last_msg_input="";t.has_draft=!!t.last_msg_input;TS.storage.storeLastMsgInput(t.id,t.last_msg_input);TS.storage.storeLastMsgInput(r.id,r.last_msg_input)},closeArchivedChannel:function e(t){var r=TS.shared.getModelObById(t);if(!r)return;if(!r.is_archived)return;r.was_archived_this_session=false;TS.client.activeChannelDisplayGoneAway()},getLastMsg:function e(t){if(!t.msgs||0===t.msgs.length)return null;for(var r=0;r<t.msgs.length;r+=1)if(!TS.utility.msgs.isMsgHidden(t.msgs[r])&&!t.msgs[r].is_ephemeral)return t.msgs[r];return null},sorterByLastMsg:function e(t,r){var n=t&&TS.shared.getLastMsg(t);var i=r&&TS.shared.getLastMsg(r);var a;var s;if(n)a=parseFloat(n.ts);else if(t){a=TS.shared.getLatestMsgTs(t);if(a)a=parseFloat(a)}if(i)s=parseFloat(i.ts);else if(r){s=TS.shared.getLatestMsgTs(r);if(s)s=parseFloat(s)}if(a&&s){if(a>s)return-1;if(s>a)return 1}else{if(a)return-1;if(s)return 1}return 0},hasUnreads:function e(t){if(!t)return false;var r=TS.shared.getLatestMsgTs(t);if(!r)return false;return r>t.last_read},checkForOldImsToClose:function e(){var t=TS.model.ims;var r=TS.model.mpims;var n=t.concat(r);var i;var a;var s;var o;var l;var u=0;var d=11;var _=6048e5;for(l=0;l<n.length;l+=1){i=n[l];if(!i.is_open&&!i.unread_cnt)continue;u+=1}var c=u-d;if(c<1)return;TS.info("checkForOldImsToClose might close some. this_too_many:"+c);var m=[];for(l=0;l<n.length;l+=1){i=n[l];if(i.is_slackbot_im)continue;if(i.is_self_im)continue;if(!i.is_open)continue;if(i.unread_cnt)continue;if(i.is_starred)continue;if(i.opened_this_session)continue;if(i==TS.shared.getActiveModelOb())continue;a=TS.shared.getLatestMsgTs(i)||"";if(i.msgs&&i.msgs.length&&i.msgs[0]&&i.msgs[0].ts>a)a=i.msgs[0].ts;if(a)s=TS.interop.datetime.toDateObject(a);else s=new Date(1e3*i.created);o=new Date-s;if(o>_){TS.info(i.id+" "+s+" ms_since_activity:"+o+" allow_elapsed_ms:"+_);m.push({model_ob:i,ms_since_activity:o})}}if(!m.length)TS.info("checkForOldImsToClose found no candidates for closing");m.sort(function e(t,r){var n=t.ms_since_activity;var i=r.ms_since_activity;if(n<i)return 1;if(n>i)return-1;return 0});m.length=m.length>c?c:m.length;for(l=0;l<m.length;l+=1){i=m[l].model_ob;TS.warn("checkForOldImsToClose CLOSING:"+i.id+" ms_since_activity:"+m[l].ms_since_activity);if(i.is_im)TS.ims.closeIm(i.id);else if(i.is_mpim)TS.mpims.closeMpim(i.id)}},ensureModelObIsPresent:function e(t){return new Promise(function(e,r){if(!t)return e();if("string"!==typeof t)return e();u(t).then(e,r)})},promiseToRefetchModelOb:function e(t){return new Promise(function(e,r){if(!t||"string"!==typeof t)return e();d(t).then(e,r)})},getModelObIdsNotPresent:function e(t){return t.filter(function(e){return!TS.shared.getModelObById(e)})},promiseToGetImAndMpimLatest:function e(){if(!TS.boot_data.feature_ms_latest)return Promise.resolve();return Promise.join(TS.api.callImmediately("im.list",{get_latest:true}),TS.api.callImmediately("mpim.list",{get_latest:true}),function(e,t){var r=true;TS.redux.channels.bulkUpdateEntities(_.concat(_.get(e,"data.ims",[]).map(function(e){return TS.ims.upsertIm(e,r)}),_.get(t,"data.groups",[]).map(function(e){return TS.mpims.upsertMpim(e,r)})))})},promiseToHaveAllRelevantImIds:function e(){n=n||new Promise(function(e,t){TS.api.callImmediately("im.list").then(function(t){var r=_(_.get(t,"data.ims",[])).map("id").concat(_.map(TS.model.ims,"id")).uniq().value();TS.log(48,"all_im_ids: "+r);e(r)},function(e){n=null;t(e)})});return n},ensureModelObsArePresent:function e(t){if(!t||!t.length)return Promise.resolve();var r=t.map(function(e){if(TS.channels.temp_list_of_removed_channels[e])return new Promise(function(e,t){t(new Error("This channel is no longer part of this workspace"))});return TS.shared.ensureModelObIsPresent(e).reflect()});return Promise.all(r).then(function(e){var t=[];e.forEach(function(e){if(e.isFulfilled())return;t.push(e.reason())});if(t.length)return Promise.reject(new Error("some ensureModelObsArePresent c_ids failed:\n"+t.join("\n")));return Promise.resolve()})},ensureModelObsInDataArePresent:function e(t,r){var n=TS.interop.utility.extractAllModelObIds(t);if("search.messages"===r&&TS.boot_data.page_needs_enterprise)P(t,n);return TS.shared.ensureModelObsArePresent(n)},addMsg:function e(t,r){return l(t,[r])},addMsgs:function e(t,r){if(l(t,r)){var n=false;var i=TS.shared.getControllerForModelOb(t);if(_.isFunction(i.calcUnreadCnts))i.calcUnreadCnts(t,n);TS.utility.msgs.maybeTruncateMsgs(t);if(TS.client)if(TS.model.active_cid!==t.id){if(TS.has_pri[A])TS.log(A,'Got message(s) for "'+t.id+'", but not active_cid "'+TS.model.active_cid+'" (yet.) NOT rebuilding.')}else{if(TS.has_pri[A])TS.log(A,"Got messages on active channel, rebuilding.");var a=true;TS.client.msg_pane.rebuildMsgsWithReason("addMsgs: got messages on active channel "+t.id,a)}return true}return false},kickMember:function e(t,r){var n=t.is_channel||t.is_group&&!t.is_mpim;if(!n)return;if(t.is_group){if(!TS.permissions.members.canKickFromGroups())return}else if(!TS.permissions.members.canKickFromChannels())return;var i=TS.members.getMemberById(r);if(!i)return;var a=true;var s=true;var o=TS.members.getPrefCompliantMemberName(i,a,s);var l=TS.shared.getDisplayNameForModelOb(t);TS.membership.ensureChannelMembershipIsKnownForUsers(t.id,[r]).then(function(){var e;if(TS.boot_data.feature_store_membership_in_redux)e=TS.redux.membership.getChannelMembershipInfoForUser(t.id,r);else e=TS.membership.getUserChannelMembershipStatus(r,t);if(!e.is_member){TS.generic_dialog.alert(TS.i18n.t("<strong>{user_name}</strong> is not a member of {channel_name}.","shared")({user_name:o,channel_name:l}));return null}var n;if(t.is_group)n="<p>"+TS.i18n.t("If you remove <strong>{user_name}</strong> from {channel_name}, they will no longer be able to see any of its messages. To rejoin the private channel, they will have to be re-invited.</p><p>Are you sure you wish to do this?","shared")({user_name:o,channel_name:l})+"</p>";else n="<p>"+TS.i18n.t("Are you sure you wish to remove <strong>{user_name}</strong> from {channel_name}?","shared")({user_name:o,channel_name:l})+"</p>";var a="conversations.kick";TS.generic_dialog.start({title:TS.i18n.t("Remove {user_name}","shared")({user_name:o}),body:n,go_button_text:TS.i18n.t("Yes, remove them","shared")(),onGo:function e(){TS.api.call(a,{channel:t.id,user:r}).catch(function(e){TS.info("Removing user failed; api="+a+"; error="+e.data.error);setTimeout(function(){var t=i.is_ultra_restricted?TS.i18n.t("Single-channel guests","shared")():TS.i18n.t("Multi-channel guests","shared")();if("cant_kick_from_last_channel"===e.data.error&&TS.model.user.is_admin){TS.generic_dialog.start({title:TS.i18n.t("Removing {member_display_name} failed","shared")({member_display_name:o}),body:TS.i18n.t("<p>{account_type} (like <strong>{member_display_name}</strong>) can’t be removed from channels.</p><p>If <strong>{member_display_name}</strong> should no longer have access to your workspace, we suggest deactivating their account.</p>","shared")({account_type:t,member_display_name:o}),go_button_text:TS.i18n.t("Manage Members","shared")(),show_cancel_button:true,onGo:function e(){TS.utility.openInNewTab("/admin#restricted",TS.templates.builders.newWindowName())}});return}var r;switch(e.data.error){case"cant_kick_from_last_channel":r=TS.i18n.t("<p>{account_type} (like <strong>{member_display_name}</strong>) can’t be removed from channels.</p><p>Please contact a Workspace Admin if <strong>{member_display_name}</strong> should no longer have access to your workspace.</p>","shared")({account_type:t,member_display_name:o});break;case"restricted_action":r=TS.i18n.t("<p>Hmm, looks like you don’t have permission to kick from channels.</p><p>Please contact a Workspace Admin if <strong>{member_display_name}</strong> should no longer have access to your workspace.</p>","shared")({member_display_name:o});break;default:r=TS.i18n.t("<p>Something’s gone wrong, and we couldn’t remove <strong>{member_display_name}</strong> from {channel}. We suspect this is only temporary. Try again in a bit?</p>","shared")({member_display_name:o,channel:l})}TS.generic_dialog.alert(r,TS.i18n.t("Removing {member_display_name} failed","shared")({member_display_name:o}))},500)})}});return null})},maybeResetHistoryFetchedOnAll:function e(){if(!TS.client)return;if(TS.has_pri[A])TS.log(A,"maybeResetHistoryFetchedOnAll()");function t(e){TS.shared.maybeResetHistoryFetched(e)}_.forEach(TS.model.channels,t);_.forEach(TS.model.ims,t);_.forEach(TS.model.mpims,t);_.forEach(TS.model.groups,t)},maybeResetHistoryFetched:function e(t){if(!TS.client)return;if(!t){TS.warn("maybeResetHistoryFetched: WTF no model_ob",t);return}if(!t._history_fetched_since_last_connect)return;if(TS.has_pri[A]&&t._history_fetched_since_last_connect)TS.log(A,'resetting history_fetched_since_last_connect for "'+t.id+'"');t._history_fetched_since_last_connect=false},maybeClearHasAutoScrolled:function e(){var t=TS.shared.getActiveModelOb();if(t&&t._has_auto_scrolled){if(TS.has_pri[A])TS.log(A,'resetting _has_auto_scrolled for "'+t.id+'"');t._has_auto_scrolled=false}},setPriorityForDev:function e(t){if("dev"!==TS.boot_data.version_ts)return;if(t.priority||0===t.priority)return;t.priority=TS.utility.strToApparentlyRndPerc(t.id)},isModelObPendingShared:function e(t){if(!_.isObject(t))return false;if(t.is_pending_ext_shared)return true;if(t.pending_shared&&t.pending_shared.length)return true;return false},isModelObShared:function e(t){if(!_.isObject(t))return false;var r=TS.interop.utility.looksLikeMemberId(t.id)?TS.utility.teams.isMemberExternalById(t.id):false;return r||TS.interop.redux.models.channels.isExternallyShared(t)},isModelObOrgShared:function e(t){if(!_.isObject(t))return false;var r=TS.boot_data.page_needs_enterprise;return r&&t.is_org_shared},isRelevantTeam:function e(){var t=true;if(!TS.model.is_our_app||!window.winssb)return t;if(!TS.boot_data.page_needs_enterprise||!TS.model.team||!TS.model.team.enterprise_id||!TS.boot_data.other_accounts)return t;if(!window.winssb)return t;if(TS.has_pri[F])TS.log(F,"isRelevantTeam()");var r=_.get(TS.model.user,"enterprise_user.teams",[]);if(1===r.length)return t;var n=TSSSB.call("getLastActiveTeamIdForTeamIds",r);var i;if(TS.has_pri[F])TS.log(F,"isRelevantTeam(): Got relevant team IDs from SSB",n);if(n instanceof Array&&n.length){i=n[0];if(TS.has_pri[F])TS.log(F,"isRelevantTeam(): Array case - taking the first relevant team id",i,n)}else if(TS.has_pri[F]){TS.log(F,"isRelevantTeam(): relevant_team_ids is not an array, OR, is empty?",n);TS.log(F,"isRelevantTeam(): Electron did not provide any matches for the given team_ids",r)}if(!i){if(TS.has_pri[F])TS.log(F,"Invalid response from SSB lastActiveTeamIdForTeamIds() call? Exiting.");return t}if(TS.has_pri[F])TS.log(F,"comparing most_relevant_team_id ( "+i+") -> TS.model.team_id ("+TS.model.team.id+")");if(i===TS.model.team.id){if(TS.has_pri[F])TS.log(F,"isRelevantTeam(): "+TS.model.team.id+" is relevant. Including.")}else{if(TS.has_pri[F])TS.log(F,"isRelevantTeam(): "+TS.model.team.id+" is NOT relevant. Excluding.");t=false}return t},isRelevantTeamForSharedModelOb:function e(t){var r=true;if(!t)return r;if(!window.winssb)return r;if(!TS.boot_data.page_needs_enterprise||!TS.model.team||!TS.model.team.enterprise_id||!TS.boot_data.other_accounts)return r;if(!TS.shared.isModelObOrgShared(t))return r;var n;if(TS.has_pri[F])TS.log(F,"isRelevantTeamForSharedModelOb(): "+t.id);if(t.is_im||t.is_mpim||t.is_global_shared)n=_.get(TS.model.user,"enterprise_user.teams",[]);else n=t.shared_team_ids;if(!n){if(TS.has_pri[F])TS.log(F,"Could not find shared team IDs for "+t.id+"? Exiting.");return r}var i=TSSSB.call("getLastActiveTeamIdForTeamIds",n);var a;if(TS.has_pri[F])TS.log(F,"Got relevant team IDs from SSB",i);if(i instanceof Array&&i.length){a=i[0];if(TS.has_pri[F])TS.log(F,"Array case - taking the first relevant team id",a,i)}else{if(TS.has_pri[F])TS.log(F,"relevant_team_ids is not an array, OR, is empty?",i);if(n&&n.length){if(TS.has_pri[F])TS.log(F,"we have enterprise_team_ids, looking there and taking the first item.",n);a=n[0]}else if(TS.has_pri[F])TS.log(F,"WTF no enterprise_team_ids, either?")}if(!a){if(TS.has_pri[F])TS.log(F,"Invalid response from SSB lastActiveTeamIdForTeamIds() call on "+t.id+"? Exiting.");return r}if(TS.has_pri[F])TS.log(F,"comparing most_relevant_team_id ( "+a+") -> TS.model.team_id ("+TS.model.team.id+")");if(a===TS.model.team.id){if(TS.has_pri[F])TS.log(F,"Shared channel "+t.id+" is relevant for this team ("+TS.model.team.id+"). Including.")}else{if(TS.has_pri[F])TS.log(F,"Shared channel "+t.id+" is NOT relevant for this team ("+TS.model.team.id+"). Excluding.");r=false}return r},checkDisplayEmailAddressPref:function e(){if(!TS.client||!TS.model.team)return;var t=0;var r=0;var n=0;var i=.5;if(TS.model.members)_.each(TS.model.members,function(e){if(e.is_bot)r+=1;if(!e||!e.profile||!e.profile.email)return;if(e.id===TS.model.user.id)return;t+=1});n=TS.model.members.length-r;if(!TS.prefs.getTeamPref("display_email_addresses"))if(t){TS.log(550,"Email display hidden for this team, but found "+t+" email fields in TS.model.members.");TS.shared.onDisplayEmailAddressesPrefChanged()}else TS.log(550,"Email display hidden for this team. Client model OK. ✓");else if(!t){TS.log(550,"Email display allowed for this team, but no email fields found in TS.model.members.");TS.shared.onDisplayEmailAddressesPrefChanged()}else if(t/n<i){TS.warn("Email display allowed for this team, but < "+100*i+"% of non-bot members ("+t+"/"+n+") in model have email fields. Dumping LS cache to correct inconsistency.");TS.shared.onDisplayEmailAddressesPrefChanged()}},onDisplayEmailAddressesPrefChanged:function e(){if(!TS.model||!TS.model.team)return;TS.info('Team pref "display_email_addresses" -> '+TS.prefs.getTeamPref("display_email_addresses"));var t=0;if(TS.model.members)TS.model.members=_.map(TS.model.members,function(e){if(!e.profile||!e.profile.email)return e;if(e.id===TS.model.user.id)return e;t+=1;if(!TS.prefs.getTeamPref("display_email_addresses"))e.profile.email=void 0;return e});if(!TS.prefs.getTeamPref("display_email_addresses"))if(t)TS.info("display_email_addresses check: found and cleared "+t+" email fields from TS.model.members.");else TS.info("display_email_addresses check: TS.model.members is already clear of email fields. ✓");else if(!t)TS.info("display_email_addresses check: pref enabled, but 0 email fields found in TS.model.members.");var r=true;if(TS.client&&TS.client.ui&&!TS.model.ms_logged_in_once)TS.client.ui.rebuildAll(r)},lastReadIsOlderThanCurrentHistory:function e(t){t=t||TS.shared.getActiveModelOb();if(!parseInt(t.last_read,10))return false;if(!t.msgs||!t.msgs.length)return false;if(t.oldest_msg_ts&&t.last_read<t.oldest_msg_ts)return false;return!_.some(t.msgs,function(e){return e.ts<=t.last_read})},dispatchUnreadChanged:function e(t){var r=TS.shared.getControllerForModelOb(t);r.unread_changed_sig.dispatch(t)},dispatchUnreadHighlightChanged:function e(t){var r=TS.shared.getControllerForModelOb(t);r.unread_highlight_changed_sig.dispatch(t)},batchUpsertObjects:function e(t){if(TS.has_pri[D])TS.log(D,"Flannel: upserting batch of "+t.length+" objects");var r=_.partition(t,function(e){if(TS.utility.members.isMember(e)){var t=TS.members.getMemberById(e.id);if(!t)t=TS.members.getUnknownMemberById(e.id);return t&&!t.is_unknown}return TS.shared.getModelObById(e.id)});var n=r[0];var i=r[1];var a=_.some(i,M);var s=_.some(i,TS.utility.members.isMember);var o=[];function l(e){var t=C(e);if(t)o.push(t)}function u(e){var t=x(e);if(t)o.push(t);return t}n.forEach(l);if(a)TS.bots.startBatchUpsert();if(s)TS.members.startBatchUpsert();i.forEach(u);if(a)TS.bots.finishBatchUpsert();if(s)TS.members.finishBatchUpsert();return o.map(function(e){return e.member||e.bot||e})},disconnectSharedChannel:function e(t){return TS.api.call("conversations.disconnectShared",{channel:t.id})},revokeSharedChannelInvite:function e(t,r){return TS.api.call("conversations.revokeSharedInvite",{channel:t.id,target_team:r.id})},getActiveChannelSessionId:function e(){return _.get(TS.redux.getState(),["messagePane","channelSessionId"],null)}});var t={};var r=false;var n;var i={};var a={};var s={};var o={};var l=function e(t,r){var n=false;if(!t._history_fetched_since_last_connect){var i;if(TS.has_pri[A])i='Defer case: First new message on "'+t.id+'" - ';if(!r||!r.length)TS.warn("_addMsgsWorker("+t.id+"): WTF no msgs to add?");if(!t.is_im&&!t.is_mpim&&!t.msgs.length){if(TS.has_pri[A])TS.log(A,i+"no history in model, no history call yet - waiting for calcUnreadCnts() which will trigger a delayed history fetch.")}else if(!t.is_im&&!t.is_mpim&&t.msgs.length&&a[t.id]){if(TS.has_pri[A])TS.log(A,i+"some history, history fetch is already queued up - attaching "+r.length+" message(s) to model.")}else if(t.msgs.length){if(t.history_is_being_fetched){if(TS.pri)TS.log(58,i+"some history, history fetch is already underway - attaching "+r.length+" message(s) to model.")}else if(!t._history_fetched_since_last_connect){if(TS.pri)TS.log(58,i+"some history, have not fetched history since last reconnect - attaching "+r.length+" new messages to model.");TS.shared.maybeFetchHistoryAndThenCheckConsistency(t)}}else if(t.history_is_being_fetched){if(TS.has_pri[A])TS.log(A,i+"no history in model, but history is already pending - adding "+r.length+" message(s) to model.")}else if(!t._history_fetched_since_last_connect){if(TS.has_pri[A])TS.log(A,i+"no history in model, no history call yet - fetching, and adding "+r.length+" message(s) to model.");TS.shared.maybeFetchHistoryAndThenCheckConsistency(t)}else if(TS.pri)if(TS.has_pri[A])TS.log(A,i+"Edge case - "+r.length+" new message(s) to add, but no history and we have called history, too?")}r=_.filter(r,function(e){var r=e.ts&&TS.utility.msgs.getMsg(e.ts,t.msgs);if(r&&TS.has_pri[A])TS.log(A,"Not adding duplicate message "+e.ts+", already in "+t.id);return!r});if(!r.length){if(TS.has_pri[A])TS.log(A,"No messages to add to "+t.id+" - exiting.");return false}if(TS.has_pri[A])TS.log(A,"Adding "+(r.length>1?"messages":"message")+" to "+t.id);r.forEach(function(e){if(TS.utility.msgs.validateMsg(t.id,e,t.msgs)){n=true;TS.utility.msgs.appendMsg(t.msgs,e)}});if(!n)return false;TS.utility.msgs.sortMsgs(t.msgs);TS.utility.msgs.maybeSetOldestMsgsTsAfterMsgAdded(t);return true};var u=function e(t){if("string"!==typeof t)return Promise.reject(Error('c_id: "'+t+'" is not a String'));if(TS.has_pri[B])TS.log(B,'_getModelObByIdFromModelOrApi c_id: "'+t+'"');var r=TS.shared.getModelObById(t);if(r)return Promise.resolve(r);if("C"===t.charAt(0)||"G"===t.charAt(0))return d(t);return TS.shared.promiseToHaveAllRelevantImIds().then(function(e){if(-1==e.indexOf(t)){TS.maybeWarn(48,"c_id:"+t+" is not in all_im_ids, not calling the API");return Promise.resolve()}return d(t)}).catch(function(e){if(e&&"im.list"===e.method)return d(t);return Promise.reject(e)})};var d=function e(t){if(TS.has_pri[B])TS.log(B,'_getModelObByIdFromApi c_id: "'+t+'"');return new Promise(function(e,r){var n=TS.model.incrementUnknownIdHandled(t);var i="conversations.info";if("C"===t.charAt(0)){if(TS.boot_data.feature_less_c_ids_fetch&&TS.boot_data.page_needs_enterprise&&n>1){TS.warn("Grid: Not calling conversations.info for "+t+" again.");e();return}var a={channel:t,no_members:true};TS.api.callImmediately(i,a).then(function(r){e(TS.channels.upsertChannel(r.data.channel));TS.model.reportResultOfUnknownIdHandled(t,true)},function(i){if(TS.boot_data.page_needs_enterprise&&i.data&&i.data.error&&"channel_not_found"===i.data.error){TS.maybeWarn(98765,"_getModelObByIdFromApi called for a channel but it is not found for enterprise. Channel:",t);e();TS.model.reportResultOfUnknownIdHandled(t,true);return}r(Error((i.data&&i.data.error||"unknown error")+" try #"+n+" calling channels.info with channel:"+t));TS.model.reportResultOfUnknownIdHandled(t,false)})}else if("G"===t.charAt(0))TS.api.callImmediately(i,{channel:t}).then(function(r){var n=r.data.group||r.data.channel;if(n.is_mpim)e(TS.mpims.upsertMpim(n));else e(TS.groups.upsertGroup(n));TS.model.reportResultOfUnknownIdHandled(t,true)},function(e){r(Error((e.data&&e.data.error||"unknown error")+" try #"+n+" calling groups.info with channel:"+t));TS.model.reportResultOfUnknownIdHandled(t,false)});else TS.api.callImmediately(i,{channel:t}).then(function(r){var n=r.data.im||r.data.channel;e(TS.ims.upsertIm(n));TS.model.reportResultOfUnknownIdHandled(t,true)},function(e){r(Error((e.data&&e.data.error||"unknown error")+" try #"+n+" calling im.info with channel:"+t));TS.model.reportResultOfUnknownIdHandled(t,false)})})};var c=function e(t,r){var n={message_timestamp:r.ts,channel_id:t,channel_type:t?t.charAt(0):""};var i=TS.shared.getActiveChannelSessionId();if(null!==i)n.channel_session_id=i;TS.clog.track("MSG_SENT",n)};var m=null;var f=function e(){var t=!TS.client.activeChannelIsHidden()?TS.shared.getActiveModelOb():null;var r=t&&t.id?t.id:null;TS.redux.dispatch(TS.interop.redux.features.messagePane.updateActiveChannelSessionId(r))};var p=function e(t){var r=!TS.client.activeChannelIsHidden()?TS.shared.getActiveModelOb():null;var n=m;if(n&&n.id)g(n);f();if(r&&r.id){h(r,t);var i=r.id.charAt(0);if("D"===i)b(r)}m=r};var h=function e(t,r){var n=t.id;var i=n.charAt(0);var a={channel_id:n,channel_type:i,is_boot:!!r,unread_channel_ids:S(),mentioned_channel_ids:T()};var s=TS.shared.getActiveChannelSessionId();if(null!==s)a.channel_session_id=s;if(void 0!==t.is_member&&null!==t.is_member)a.is_member=t.is_member;if(!r)a.num_unreads=t.unread_cnt;TS.clog.track("CHANNEL_SWITCHED",a)};var g=function e(t){var r=t.id;var n=r.charAt(0);var i={channel_id:r,channel_type:n};var a=TS.shared.getActiveChannelSessionId();if(null!==a)i.channel_session_id=a;if(void 0!==t.is_member&&null!==t.is_member)i.is_member=t.is_member;TS.clog.track("CHANNEL_SWITCHED_OUT",i)};var S=function e(){return v(function(e){return e.unread_cnt>0})};var T=function e(){return v(function(e){return e.unread_highlight_cnt>0})};var v=function e(t){if(!TS.model)return[];var r=[];var n=function e(t){return t.id};if(TS.model.channels)r=r.concat(_.map(_.filter(TS.model.channels,t),n));if(TS.model.groups)r=r.concat(_.map(_.filter(TS.model.groups,t),n));if(TS.model.ims)r=r.concat(_.map(_.filter(TS.model.ims,t),n));return r};var b=function e(t){var r=t.id;var n={};var i=TS.ims.getImById(r);var a=i?TS.members.getMemberById(i.user):null;if(a&&a.is_bot){var s=a.profile.bot_id;var o=TS.bots.getBotById(s);n.app_id=o?o.app_id:"";n.bot_id=s}TS.clog.track("DM_OPEN",n)};var y=function e(){var t=true;p(t)};var w={};var k=function e(t){if(t)return;n=null};var x=function e(t){if(M(t)){if(TS.has_pri[D])TS.log(D,"Flannel: upserting bot "+t.id+" from query results");return TS.bots.upsertBot(t)}else if(TS.utility.members.isMember(t)){if(TS.has_pri[D])TS.log(D,"Flannel: upserting user "+t.id+" from query results");return TS.members.upsertMember(t)}};var C=function e(t){if(M(t)){if(TS.has_pri[D])TS.log(D,"Flannel: upserting and signalling bot "+t.id+" from query results");return TS.bots.upsertAndSignal(t).bot}else if(TS.utility.members.isMember(t)){if(TS.has_pri[D])TS.log(D,"Flannel: upserting and signalling user "+t.id+" from query results");return TS.members.upsertAndSignal(t).member}};var M=function e(t){var r=_.get(t,"id[0]");return"B"===r};var I=function e(t,r){var n={no_sort:true,types:"private_channel",limit:1e3};if(r)n.cursor=r;var i=t||[];return TS.api.callImmediately("conversations.list",n).then(function(t){i=i.concat(t.data.channels);if(!t.data.response_metadata.next_cursor){var r=_(i).map("id").concat(_.map(TS.model.mpims,"id")).concat(_.map(TS.model.groups,"id")).uniq().value();TS.log(48,"all_group_ids: "+r);return r}return e(i,t.data.response_metadata.next_cursor)})};function P(e,t){var r=TS.model.team.id;_.remove(t,function(t){var n=_.find(e.messages.matches,function(e){return e.channel.id==t},this);var i=_.get(n,"channel");var a=TS.shared.isModelObOrgShared(i)||TS.shared.isModelObShared(i);if(n&&_.get(n,"team")!=r&&_.startsWith(t,"C")&&!a)return t})}var A=58;var E=99;var F=1701;var O=4;var B=529;var D=1989})()},4779:function(e,t){(function(){TS.registerModule("teams",{added_sig:new signals.Signal,rename_sig:new signals.Signal,changed_sig:new signals.Signal,unlinked_sig:new signals.Signal,changed_icon_sig:new signals.Signal,onStart:function e(){if(TS.client)TS.client.login_sig.add(r);TS.teams.changed_icon_sig.add(i);TS.teams.rename_sig.add(i);TS.teams.added_sig.add(s);TS.team.team_name_changed_sig.add(s)},getTeamById:function e(t){if(!_.isString(t))return null;return TS.redux.teams.getTeamById(t)||TS.redux.teams.getTeamByEnterpriseId(t)||null},isExternal:function e(t){if(!_.isObject(t))return false;if(t.id===TS.model.team.id)return false;if(t._other_account)return false;var r=m();return!(r&&r===t.enterprise_id)},getAllExternalTeams:function e(){return _.pickBy(TS.redux.teams.getAllTeams(),TS.teams.isExternal)},isPartOfMyOrg:function e(t){if(!_.isObject(t))return false;var r=m();return r&&r===t.enterprise_id},getAllEnterpriseTeams:function e(){return _.pickBy(TS.redux.teams.getAllTeams(),TS.teams.isPartOfMyOrg)},getEnterpriseTeams:function e(t){t=_.isObject(t)?t:{};var r=TS.teams.getAllEnterpriseTeams();if(t.only_member_of)r=_.pickBy(r,function(e){return TS.model.user.enterprise_user.teams.indexOf(e.id)>-1});if(t.exclude_current_team)r=_.omitBy(r,function(e){return e.id===TS.model.team.id});return r},getTeamByDomain:function e(t){if(!_.isString(t))return null;return TS.redux.teams.getTeamByDomain(t)},getTeamByMsg:function e(t){if(!_.isObject(t))return null;var r=t.source_team_id;if(!r)return null;var n=TS.teams.getTeamById(r);if(n)return n;return null},getTeamNameByMember:function e(t){if(!_.isObject(t))return null;var r=TS.teams.getTeamById(t.team_id);if(r&&r.name)return r.name;return null},getTeamNameByMemberId:function e(t){if(!_.isString(t))return null;var r=TS.members.getMemberById(t);if(!r)return null;var n=TS.teams.getTeamById(r.team_id);if(n&&n.name)return n.name;return null},getTeamNameById:function e(t){var r=TS.teams.getTeamById(t);if(!_.isObject(r))return null;if(r&&r.name)return r.name;return null},updateTeamName:function e(t){if(!t.name)return;var r=TS.teams.getTeamById(t.source_team);if(!r)return;r=_.clone(r);r.name=t.name;TS.teams.upsertAndSignal(r)},updateTeamIcon:function e(t){if(!t.icon)return;var r=TS.teams.getTeamById(t.source_team);if(!r)return;r=_.clone(r);r.icon=t.icon;TS.teams.upsertAndSignal(r)},upsertAndSignal:function e(t){var r=TS.teams.upsertTeam(t);if("CHANGED"===r.status){if(-1!=r.what_changed.indexOf("icon"))TS.teams.changed_icon_sig.dispatch(r.team);if(-1!=r.what_changed.indexOf("name"))TS.teams.rename_sig.dispatch(r.team);if(-1!=r.what_changed.indexOf("unlinked"))TS.teams.unlinked_sig.dispatch(r.team)}else if("ADDED"===r.status)TS.teams.added_sig.dispatch(r.team);return r},upsertTeam:function e(t){var r=TS.teams.getTeamById(t.id);var n="NOOP";var i=[];if(r){r=_.assign({},r);if(!t.hasOwnProperty("_other_account"))t._other_account=false;for(var a in t)if("icon"===a){if(t[a]&&!TS.utility.areSimpleObjectsEqual(t[a],r[a])){r[a]=t[a];n="CHANGED";i.push(a)}}else if(r[a]!=t[a])if("boolean"!==typeof t[a]||!t[a]!=!r[a]){r[a]=t[a];n="CHANGED";i.push(a)}t=r}else n="ADDED";if("NOOP"!==n)TS.redux.teams.addTeam(t);return{status:n,team:t,what_changed:i}},ensureTeamsArePresentWhenConvenient:function e(r){if(!_.isArray(r))return;var n=function e(){if(!t.length)return Promise.resolve();var r=_.uniq(_.clone(t));return TS.teams.ensureTeamsArePresent(r).then(function(){_.each(r,function(e){return _.pull(t,e)});return e()}).catch(function(e){e.lazy_batch_team_ids=t;e.lazy_batch_team_ids_getting_fetched=r;TS.console.logError(e,"lazy_batch_fetch_error","lazy_batch_team_error",true);throw e})};if(!t.length&&r.length)_.defer(n);t.push.apply(t,r)},ensureTeamsArePresent:function e(t){if(!_.isArray(t))return Promise.reject(Error("t_ids is not an array"));var r=_.filter(t,function(e){var t=TS.teams.getTeamById(e);return!t||t._other_account});if(!r.length)return Promise.resolve();return n(r)},ensureTeamsInDataArePresentWhenConvenient:function e(t){var r=TS.interop.utility.extractAllTeamIds(t);TS.teams.ensureTeamsArePresentWhenConvenient(r)},ensureTeamsInDataArePresent:function e(t){var r=TS.interop.utility.extractAllTeamIds(t);return TS.teams.ensureTeamsArePresent(r)},ensureSharedTeamsForMember:function e(t){if(!t)return Promise.resolve();return TS.teams.ensureTeamsArePresent(o(t))},getSharedTeamsForMember:function e(t){if(!t)return[];return _.map(o(t),TS.teams.getTeamById)},getTeamIdsConnectedOnlyByModelOb:function e(t){return TS.api.call("conversations.info",{channel:t.id,include_external_connections:true}).then(function(e){var r=_.get(e,"data.channel.external_connections");if(_.isObject(r))return t.shared_team_ids.filter(function(e){return 1===r[e]});return[]})},promiseToSearchTeams:function e(t){if(!m())return Promise.resolve(t);return Promise.resolve(t).then(function(e){if(!e)return Promise.reject(new Error("No search parameters provided"));e=l(e);if(e._is_new||e.num_remaining>0)return d(e);return Promise.resolve(e)})},test:function e(){var t={_getSharedTeamIdsForMember:o};Object.defineProperty(t,"_readyTeamSearcher",{get:function e(){return l},set:function e(t){l=t}});Object.defineProperty(t,"_promiseToSearchTeamsWorker",{get:function e(){return c},set:function e(t){c=t}});Object.defineProperty(t,"_buildPromiseToSearchTeamsArguments",{get:function e(){return u},set:function e(t){u=t}});Object.defineProperty(t,"_getTeamsByIdFromApi",{get:function e(){return n},set:function e(t){n=t}});return t}});var e=100;var t=[];var r=function e(){if(TS.boot_data&&_.isObject(TS.boot_data.other_accounts))_.each(TS.boot_data.other_accounts,function(e){var t={id:e.team_id,domain:TS.interop.url.getTeamSubdomain(e.team_url),icon:e.team_icon,name:e.team_name,url:e.team_url,_other_account:true};TS.teams.upsertTeam(t)})};var n=function e(t){if(!_.isArray(t))return Promise.reject(Error("t_ids is not an array"));var r={teams:t};return new Promise(function(e,t){TS.api.callImmediately("team.info",r).then(function(t){var r=[];t.data.teams.forEach(function(e){r.push(TS.teams.upsertAndSignal(e).team)});e(r)},function(e){t(Error(e.data&&e.data.error||"unknown error"))})})};var i=function e(t){if(t.id!==TS.model.team.id)a(t);s(t)};var a=function e(t){if(!_.isObject(t))return;var r=TS.utility.teams.getMembersForTeam(t);if(!r.length)return;_.forEach(r,function(e){TS.members.changed_profile_sig.dispatch(e)})};var s=function e(t){if(!_.isObject(t))return;var r=TS.shared.getActiveModelOb();if(!TS.shared.isModelObShared(r))return;var n=TS.utility.teams.getTeamsForModelOb(r,{include_pending:true});if(_.indexOf(n,t)>-1)TS.channels.shared_teams_updated_sig.dispatch(r)};var o=function e(t){if(!t)return[];if(_.get(t,"enterprise_user"))return _.intersection(_.get(t,"enterprise_user.teams",[]),_.get(TS.model.user,"enterprise_user.teams",[]));if(_.get(t,"team_id")===_.get(TS.model.user,"team_id"))return[t.team_id];return[]};var l=function e(t){t=t||{};t._is_new=false;if(!t.hasOwnProperty("query"))t.query="";if(!t.hasOwnProperty("additional_args"))t.additional_args={};if(t._last_query!==t.query){if(t.hasOwnProperty("_searcher_p"))t._searcher_p.cancel();t._last_query=t.query;t._is_new=true;t._cursor_mark=null;t.items=[]}if(!_.isEqual(t._last_additional_args,t.additional_args)){if(t.hasOwnProperty("_searcher_p"))t._searcher_p.cancel();t._last_additional_args=_.assign({},t.additional_args);t._is_new=true;t._cursor_mark=null;t.items=[]}return t};var u=function t(r){var n=[TS.utility.search.makeClause("is","team")];if(r.query)n.push(TS.utility.search.makeClause("fuzzy",r.query));if(_.get(r,"included_ids.length"))if(1===r.included_ids.length)n.push(TS.utility.search.makeClause("id",_.head(r.included_ids)));else n.push(TS.utility.search.makeConjunction("or",_.map(r.included_ids,function(e){return TS.utility.search.makeClause("id",e)})));var i={count:r.max_api_results||e,query:n.length>1?JSON.stringify(TS.utility.search.makeConjunction("and",n)):JSON.stringify(_.head(n))};if(!_.isEmpty(_.get(r,"additional_args")))i=_.merge(i,r.additional_args);if(r._cursor_mark)i.cursor_mark=r._cursor_mark;return i};var d=function e(t){var r=function e(){return c(t)};if(t._is_new)t._searcher_p=r();else t._searcher_p=t._searcher_p.then(r);return t._searcher_p};var c=function e(t){var r=_.get(t,"endpoint","search.enterprise");var n=_.get(t,"response_key","items");return TS.api.call(r,u(t)).then(function(e){if(!t._cursor_mark){t.num_remaining=e.data.num_found;t.num_found=e.data.num_found}if(!e.data[n].length)return Promise.resolve(t);t.num_remaining-=e.data[n].length;t._cursor_mark=e.data.next_cursor_mark;var r=_.keyBy(t.omitted_ids,_.identity);var i=_(e.data[n]).filter(function(e){return!r[e.id]}).map(function(e){return TS.teams.upsertTeam(e)}).map("team").value();t.num_found-=e.data[n].length-i.length;t.items=_.concat(t.items,i);return Promise.resolve(t)})};var m=function e(){return _.get(TS.model,"team.enterprise_id",TS.boot_data.enterprise_id)}})()},4780:function(e,t){(function(){TS.registerModule("utility.teams",{isMemberExternal:function e(t){if(!_.isObject(t))return false;if(!t.team_id)return false;if(!t._is_local&&t._is_from_org)return false;return!t._is_local&&!t._is_from_org},isMemberExternalById:function e(t){var r=TS.members.getMemberById(t);if(!r){TS.warn("Trying to check for external team membership by id ("+t+") but member is not present in the model.");return false}return TS.utility.teams.isMemberExternal(r)},isMemberGuest:function e(t){if(!_.isObject(t))return false;if(t.is_external||t.is_restricted)return true;return false},isMsgFromOtherTeam:function e(t){if(!_.isObject(t))return false;if(!t.source_team_id)return false;if(t.source_team_id&&TS.model.team.id!=t.source_team_id)return true;return false},getMembersForTeam:function e(t){if(!_.isObject(t))return;if(!t.id)return;var r=_.filter(TS.model.members,{team_id:t.id});return r},isMemberOnTeam:function e(t,r){if(!t||!r)return false;if(_.get(t,"team_id")===_.get(r,"id"))return true;return _.includes(_.get(t,"enterprise_user.teams"),_.get(r,"id"))},getTeamsForModelOb:function e(t,r){var n=[];if(!_.isObject(t))return n;r=r||{};if(!TS.shared.isModelObShared(t)&&!TS.shared.isModelObPendingShared(t))return n;if(!r.only_pending&&t.shared_team_ids&&t.shared_team_ids.length)n=n.concat(t.shared_team_ids);if((r.only_pending||r.include_pending)&&t.pending_shared&&t.pending_shared.length)n=_.uniq(n.concat(t.pending_shared));return _.compact(_.map(n,TS.teams.getTeamById))}})})()},4781:function(e,t){var r="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function n(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}else return Array.from(e)}(function(){TS.registerModule("members",{status_changed_sig:new signals.Signal,presence_changed_sig:new signals.Signal,ds_presence_changed_sig:new signals.Signal,user_color_changed_sig:new signals.Signal,joined_team_sig:new signals.Signal,changed_current_status_sig:new signals.Signal,changed_name_sig:new signals.Signal,changed_real_name_sig:new signals.Signal,changed_deleted_sig:new signals.Signal,changed_profile_sig:new signals.Signal,changed_tz_sig:new signals.Signal,changed_account_type_sig:new signals.Signal,changed_admin_perms_sig:new signals.Signal,changed_owner_perms_sig:new signals.Signal,changed_self_sig:new signals.Signal,lazily_added_sig:new signals.Signal,batch_upserted_sig:new signals.Signal,non_loaded_changed_deleted_sig:new signals.Signal,member_was_upserted_sig:new signals.Signal,user_added_to_team_sig:new signals.Signal,user_removed_from_team_sig:new signals.Signal,changed_is_unknown_sig:new signals.Signal,is_in_bulk_upsert_mode:false,members_for_user_changed_sig:new signals.Signal,onStart:function e(){TS.redux.socket.disconnectedSig.add(Z);TS.channels.member_joined_sig.add(function(e,t){var r=true;te(t,r)},TS.members,-1);TS.channels.member_left_sig.add(function(e,t){re(t)},TS.members,-1);TS.channels.joined_sig.add(Q);TS.channels.left_sig.add(Q);TS.groups.joined_sig.add(Q);TS.groups.left_sig.add(Q);TS.members.lazily_added_sig.add(TS.teams.ensureTeamsInDataArePresentWhenConvenient);if(TS.client)TS.client.login_sig.addOnce(function(){TS.members.non_loaded_changed_deleted_sig.add(X);TS.members.changed_deleted_sig.add(function(e){var t=!e.deleted;te(e,t)},TS.members,-1)});TS.redux.socket.disconnectedSig.add(le);TS.channels.switched_sig.add(fe)},maybeFetchAccessibleUserIds:function e(){if(TS.isPartiallyBooted()&&!TS._did_full_boot)return Promise.resolve();if(!TS.model.user.is_restricted)return Promise.resolve();TS.model.guest_accessible_user_ids=TS.model.guest_accessible_user_ids||[];return TS.api.call("conversations.guestVisibleMembers").then(function(e){var t=e.data;var r=t.members;if(!_.isEqual(_.sortBy(r),_.sortBy(TS.model.guest_accessible_user_ids))){p.length=0;TS.model.guest_accessible_user_ids=r;TS.model.need_guest_accessible_user_ids=false;TS.members.members_for_user_changed_sig.dispatch()}J=Date.now()})},getPotentiallyUnknownMemberById:function e(r){if(!r)return null;if(!TS.useReduxMembers()){ce(r);var n=t[r];if(n&&n.is_unknown)return n}if(!TS.interop.utility.looksLikeMemberId(r)){var i=TS.members.getMemberByName(r);if(i)return i;de(r);return{id:r,name:r,is_unknown:false,is_non_existent:true}}return TS.members.getMemberById(r)||R(r)},getMemberById:function e(r){if(!_.isString(r))return null;if(r&&"@"===r.charAt(0))r=r.substring(1);if(TS.useReduxMembers()){var n=TS.redux.members.getMemberById(r);if(n&&!n.isUnknown)return n;return null}ce(r);var i=t[r];if("undefined"!==typeof i){if(i.is_unknown)return null;return i}return null},getUnknownMemberById:function e(r){if(!r)return;ce(r);var n=t[r];if(n&&n.is_unknown)return n;return null},getMemberByName:function e(t){t=_.toLower(t);if(!i.hasOwnProperty(t)){var r=TS.model.members;if(Object.keys(i).length<TS.model.members.length)r.forEach(function(e){i[e._name_lc]=e.id;i["@"+e._name_lc]=e.id})}if(i.hasOwnProperty(t))return TS.members.getPotentiallyUnknownMemberById(i[t]);return null},getMemberByEmail:function e(t){if(TS.useReduxMembers())return TS.redux.members.getMemberByEmail(t);t=_.toLower(t);var r=TS.model.members;var n;for(var i=0;i<r.length;i+=1){n=r[i];if(!n.profile)continue;if(!n.profile.email)continue;if(_.toLower(n.profile.email)===t)return n}return null},upsertAndSignal:function e(t){var r=TS.members.upsertMember(t);return _e(r,t)},upsertMember:function r(n){var s=TS.members.getMemberById(n.id);var o="NOOP";var l=[];if(!s)s=TS.members.getUnknownMemberById(n.id);if(n.is_ultra_restricted)n.is_restricted=true;if(s){if(TS.useReduxMembers())s=_.assign({},s);if(TS.has_pri[ae])TS.log(ae,'updating existing member "'+n.id+'"');var u=H(s,n);o=u.status;l=u.what_changed;if(_.includes(l,"presence"))if(TS.members.is_in_bulk_upsert_mode)TS.redux.presence.addToBulkUpsertPayload(s);else TS.redux.presence.updatePresenceForMember(s);if(_.includes(l,"is_restricted")||_.includes(l,"is_ultra_restricted"))if(TS.members.is_in_bulk_upsert_mode)TS.redux.member_types.addToBulkUpdatePayload(s);else TS.redux.member_types.updateMemberTypeForMember(s);if(_.includes(l,"deleted")){var d=TS.ims.getImByMemberId(s.id);if(d)d.is_archived=s.deleted}if(_.includes(l,"current_status"))if(TS.members.is_in_bulk_upsert_mode)TS.redux.custom_status.addToBulkUpsertPayload(s);else TS.redux.custom_status.updateStatusForMember(s);if("undefined"!==typeof s.is_non_existent)delete s.is_non_existent;n=s}else if(n.id){o="ADDED";if(TS.useReduxMembers()&&_.includes(h,n.id))l.push("is_unknown");if(TS.boot_data.feature_esc_fix_dm_browser){e+=1;t[n.id]=n;i[n._name_lc]=n.id;i["@"+n._name_lc]=n.id;if(!TS.useReduxMembers())TS.model.members.push(n)}q(n);if(TS.has_pri[ae])TS.log(ae,'adding member "'+n.id+'" color:'+n.color+" member_color:"+n.member_color);if(n.presence)if(TS.members.is_in_bulk_upsert_mode)TS.redux.presence.addToBulkUpsertPayload(n);else TS.redux.presence.updatePresenceForMember(n);if(n.profile&&n.profile.status_emoji)if(TS.members.is_in_bulk_upsert_mode)TS.redux.custom_status.addToBulkUpsertPayload(n);else TS.redux.custom_status.updateStatusForMember(n);if(TS.members.is_in_bulk_upsert_mode)TS.redux.member_types.addToBulkUpdatePayload(n);else TS.redux.member_types.updateMemberTypeForMember(n);if(!TS.boot_data.feature_esc_fix_dm_browser){e+=1;t[n.id]=n;i[n._name_lc]=n.id;i["@"+n._name_lc]=n.id;if(!TS.useReduxMembers())TS.model.members.push(n)}}else TS.error("bad error, no member.id");if(n.is_self&&n.deleted){TS.reload(null,"member.is_self && member.deleted");return}if(!TS.members.is_in_bulk_upsert_mode){TS.members.invalidateMembersUserCanSeeArrayCaches();TS.members.invalidateActiveMembersArrayCaches()}TS.members.member_was_upserted_sig.dispatch();if(TS.useReduxMembers()&&"NOOP"!==o){n.profile=_.assign({},n.profile);if(TS.members.is_in_bulk_upsert_mode)TS.redux.members.addToBulkUpsertPayload(n);else TS.redux.members.addMember(n)}var c={status:o,member:n,what_changed:l};if(TS.members.is_in_bulk_upsert_mode)a.push(c);return c},processExistingMemberForUpserting:function e(t,r){return H(t,r)},processNewMemberForUpserting:function e(t){q(t)},setMemberUserColor:function e(t,r){r=_.escape(r);t.member_color=r||t.color;if(r&&r!=t.color)TS.model.user_colors[t.id]=r;else delete TS.model.user_colors[t.id];TS.members.user_color_changed_sig.dispatch(t)},usernameChanged:function e(t,r){delete i[r];delete i["@"+r];t._name_lc=_.toLower(t.name);i[t._name_lc]=t.id;i["@"+t._name_lc]=t.id;M(t)},getActiveMembersWithSelfAndNotSlackbot:function e(){if(!s.length)s=TS.members.fillMembersWithOptions(s,{include_self:true,include_slackbot:false,include_bots:true});return s},getActiveMembersWithSelfAndNotBots:function e(){if(!o.length)o=TS.members.fillMembersWithOptions(o,{include_self:true,include_slackbot:false,include_bots:false});return o},getActiveMembersExceptSelfAndSlackbot:function e(){if(!l.length)l=TS.members.fillMembersWithOptions(l,{include_self:false,include_slackbot:false,include_bots:true});return l},getActiveMembersExceptSelfAndBots:function e(){if(!u.length)u=TS.members.fillMembersWithOptions(u,{include_self:false,include_slackbot:false,include_bots:false});return u},getActiveMembersWithSelfAndSlackbot:function e(){if(!d.length)d=TS.members.fillMembersWithOptions(d,{include_self:true,include_slackbot:true,include_bots:true});return d},getActiveMembersWithSlackbotAndNotSelf:function e(){if(!c.length)c=TS.members.fillMembersWithOptions(c,{include_self:false,include_slackbot:true,include_bots:true});return c},getMembersWithOptions:function e(t){var r=TS.members.getMembersForUser();var n=_.filter(r,function(e){if(e.is_stranger)return false;if(t.only_admins)return e.is_admin&&!e.deleted;if(t.only_local_team&&!e._is_local)return false;if(!t.include_deleted&&e.deleted)return false;if(!t.include_slackbot&&e.is_slackbot)return false;if(!t.include_self&&e.is_self)return false;if(!t.include_bots&&e.is_bot)return false;return true});return n},fillMembersWithOptions:function e(t,r){if(!_.isArray(t))throw new TypeError("members passed to fillMembersWithOptions is not an array!");t.length=0;var n=TS.members.getMembersWithOptions(r);_.each(n,function(e){t.push(e)});return t},getMembersForUser:function e(){if(p.length)return p;if(!TS.model.user.is_restricted){p=_.filter(TS.model.members,function(e){return true!==e.is_stranger});return p}var t={};(TS.model.guest_accessible_user_ids||[]).forEach(function(e){t[e]=true});var r=TS.isPartiallyBooted();p=Object.keys(t).map(function(e){return{id:e,user:TS.members.getMemberById(e)}}).filter(function(e){var t=e.user;if(!t&&r)return false;if(!t)return false;return!t.deleted}).map(function(e){return e.user});return p},shouldDisplayRealNames:function e(){var t=TS.prefs.getPref("display_real_names_override");return TS.prefs.getTeamPref("display_real_names")&&-1!==t||1===t},getMemberMentionName:function e(t){var r=TS.members.getMemberProfileFieldDisplayName(t);if(r)return r;return TS.members.getMemberRealName(t)},getPrefCompliantMemberNameById:function e(t,r,n,i){var a=i?TS.members.getMemberById(t):TS.members.getPotentiallyUnknownMemberById(t);return a?TS.members.getPrefCompliantMemberName(a,r,n):t},getPrefCompliantMemberName:function e(t,r,n){if(!t)return"";var i=function(){var e=n?"@":"";var r=TS.members.getMemberRealName(t);if(!TS.members.shouldDisplayRealNames()&&TS.members.getMemberProfileFieldDisplayName(t))r=TS.members.getMemberProfileFieldDisplayName(t);return e+r}();return r?_.escape(i):i},getPrefCompliantMemberNameLowerCase:function e(t,r){if(!t)return"";if(!TS.model.team)return t._name_lc;if(TS.members.shouldDisplayRealNames())if(t.profile&&t.profile.real_name){if(r)return _.escape(t._real_name_lc);return t._real_name_lc}return t._name_lc},getMemberRealName:function e(t){return A(t,"real_name")},getMemberRealNameLowerCase:function e(t){return A(t,"_real_name_normalized_lc")},getMemberProfileFieldDisplayName:function e(t){return A(t,"display_name")},getMemberSecondaryName:function e(t){var r=b(t);var n=TS.members.getMemberRealName(r);var i=TS.members.getMemberProfileFieldDisplayName(r);if(TS.members.shouldDisplayRealNames())return i;else if(i)return n;return""},getMemberCurrentStatus:function e(t){var r=b(t);if(!(r&&r.profile))return{emoji:"",text:""};return{emoji:r.profile.status_emoji||"",text:r.profile.status_text||""}},getMemberCurrentStatusForDisplay:function e(t,r){var n=TS.members.getMemberCurrentStatus(t);var i="";if(n.text)i+='<span class="prevent_copy_paste" aria-label=" "></span>'+TS.format.formatCurrentStatus(n.text,void 0,r);var a=TS.format.formatCurrentStatus(n.emoji,void 0,_.assign({transform_missing_emoji:true},r));return a+i},invalidateMembersUserCanSeeArrayCaches:function e(t){if(!TS.model.user)return;var r=p.length;if(!r)return;p.length=0;TS.members.invalidateActiveMembersArrayCaches();if(t)return;var n=TS.members.getMembersForUser();if(n.length!==r)TS.members.members_for_user_changed_sig.dispatch()},invalidateActiveMembersArrayCaches:function e(){s.length=0;o.length=0;l.length=0;u.length=0;d.length=0;c.length=0;m.length=0;f.length=0},memberSorterByActive:function e(t,r){if(t.presence!=r.presence){if("active"===t.presence)return-1;if("active"===r.presence)return 1}var n=TS.members.getPrefCompliantMemberNameLowerCase(t);var i=TS.members.getPrefCompliantMemberNameLowerCase(r);return TS.i18n.sorter(n,i)},memberSorterByActiveWithBotsLast:function e(t){var r=t.filter(function(e){return e.is_bot||e.is_slackbot});var i=r.filter(function(e){return"active"===e.presence});var a=r.filter(function(e){return"away"===e.presence});var s=t.filter(function(e){return!e.is_bot&&!e.is_slackbot});var o=s.filter(function(e){return"active"===e.presence});var l=s.filter(function(e){return"away"===e.presence});var u=o.sort(function(e,t){var r=TS.members.getPrefCompliantMemberName(e)||e.name;var n=TS.members.getPrefCompliantMemberName(t)||t.name;return TS.i18n.sorter(r,n)});var d=l.sort(function(e,t){var r=TS.members.getPrefCompliantMemberName(e)||e.name;var n=TS.members.getPrefCompliantMemberName(t)||t.name;return TS.i18n.sorter(r,n)});var _=i.sort(TS.i18n.mappedSorter("name"));var c=a.sort(TS.i18n.mappedSorter("name"));var m=[];m.push.apply(m,n(u).concat(n(_),n(d),n(c)));return m},memberSorterByName:function e(t,r){var n=TS.members.getPrefCompliantMemberNameLowerCase(t);var i=TS.members.getPrefCompliantMemberNameLowerCase(r);return TS.i18n.sorter(n,i)},prepareMembersForLS:function e(){var t=[];var r;var n;var i;var a;for(a=0;a<TS.model.members.length;a+=1){n=TS.model.members[a];if(!n){TS.warn("prepareMembersForLS: no member at offset "+a+"??");continue}if(!n._is_local)continue;r={};t.push(r);for(i in n){if("files"===i)continue;if("activity"===i)continue;if("stars"===i)continue;if("mentions"===i)continue;if(0===i.indexOf("_"))continue;r[i]=n[i]}r.profile=D(r.profile)}return t},ensureMembersInDataArePresent:function e(t,r){var n=TS.interop.utility.extractAllMemberIds(t);if("T02J3DPUE"===_.get(TS,"model.team.id")&&!_.isEmpty(n)){var i=_.some(n,function(e){return"U"===e[0]});if(i){var a={message:"Fetching U users on W team from source: "+r,stack:TS.console.getStackTrace()};$.post(TS.boot_data.beacon_error_url,{description:"fetch_u_on_w_team",error_json:JSON.stringify(a),team:_.get(TS,"model.team.id","none"),user:TS.boot_data.user_id,version:TS.boot_data.version_ts})}}return TS.members.ensureMembersArePresent(n)},fetchMemberProfileExtras:function e(t,r){r=r||["shared_channels"];var n={user:t,keys:r.join(",")};return TS.api.call("users.profile.getExtras",n).catch(function(){TS.info("Failed to fetch member profile extras")}).then(function(e){if(!e||!e.data)return{};return _.omit(e.data,"ok")})},fetchRawMembersWithIds:function e(t,r){var n=false;return I(t,n,r)},fetchAndUpsertMembersWithIds:function e(t,r,n){return P(t,r,n)},fetchAndUpsertMembersWithQuery:function e(t){return TS.flannel.fetchRawObjectsWithQuery(t).then(function(e){e.objects=TS.shared.batchUpsertObjects(e.objects);return e})},ensureMembersArePresent:function e(t){if(!t||!t.length)return Promise.resolve();var r=_(t).uniq().filter(TS.members.getMemberById).value();var n=_.difference(t,r);var i=TS.useSocket()?S:g;var a=_(n).chunk(i).map(function(e){var t=P(e,false,"ensure_members");t.catch(function(t){TS.info("ensureMembersArePresent: got "+t+" while fetching "+e.join(", "));TS.logError(t)});return t.reflect()}).value();return Promise.all(a).then(function(e){var t=e.filter(function(e){return e.isRejected()}).map(function(e){return e.reason()});if(t.length){var r=new Error("Some member fetches failed");r.rejection_reasons=t;return Promise.reject(r)}var n=[];var i=[];_.forEach(e,function(e){var t=e.value();n.push(t.missing_members);i.push(t.fetched_members)});return Promise.resolve({fetched_members:_.flatten(i),missing_members:_.flatten(n)})})},ensureMembersArePresentInOrgSharedModelObs:function e(t){var r=t.filter(TS.shared.isModelObOrgShared);return TS.members.ensureMembersArePresentInModelObs(r)},ensureMembersArePresentInModelObs:function e(t){var r=[];var n=[];if(TS.boot_data.page_needs_enterprise&&TS.boot_data.exclude_org_members)return Promise.resolve();t.forEach(function(e){if(e.is_im){r.push(e.user);n.push(e.id)}else if(e.is_mpim){r.push.apply(r,e.members||[]);n.push.apply(n,_.fill(Array(e.members&&e.members.length||0),e.id))}else if(e.is_channel);else if(e.is_group){r.push.apply(r,e.members||[]);n.push.apply(n,_.fill(Array(e.members&&e.members.length||0),e.id))}else TS.warn("ensureMembersArePresentInModelObs found an unexpected model_ob type")});if(!r.length)return Promise.resolve();return TS.members.ensureMembersArePresent(r,n)},startBatchUpsert:function e(){if(TS.members.is_in_bulk_upsert_mode)return false;TS.members.is_in_bulk_upsert_mode=true;return true},finishBatchUpsert:function e(){if(!TS.members.is_in_bulk_upsert_mode)return false;TS.members.is_in_bulk_upsert_mode=false;TS.members.invalidateMembersUserCanSeeArrayCaches();TS.members.invalidateActiveMembersArrayCaches();var t=_.partition(a,function(e){return _.includes(e.what_changed,"is_unknown")});var r=t[0];TS.members.batch_upserted_sig.dispatch(a);a=[];if(r.length>0)TS.members.changed_is_unknown_sig.dispatch({batch:_.map(r,"member")});return true},allocateTeamListMembers:function e(t){var r;var n=[];var i=[];var a=[];var s=[];var o=[];var l=[];t.sort(function(e,t){var r=e._real_name_lc||e._name_lc;var n=t._real_name_lc||t._name_lc;if(r>n)return 1;if(n>r)return-1;return 0});for(var u=0;u<t.length;u+=1){r=t[u];if(r.deleted)if(r.is_bot)a.push(r);else i.push(r);else if(r.is_ultra_restricted)l.push(r);else if(r.is_restricted)o.push(r);else if(r.is_bot||r.is_slackbot)s.push(r);else n.push(r)}return{members:n,disabled_members:i,deleted_bots:a,bots:s,restricted_members:o,ultra_restricted_members:l}},promiseToSearchMembers:function e(t){return Promise.resolve(t).then(function(e){if(!e)return Promise.reject(new Error("No search parameters provided"));e.query=e.query&&e.query.trim()||"";e.include_org=!!TS.boot_data.page_needs_enterprise&&!!e.include_org;e.org_team_ids=e.include_org&&Array.isArray(e.org_team_ids)?e.org_team_ids:[];e=E(e,TS.interop.searcher.isNewMemberSearch(e));if(e._is_new||e.num_remaining>0)return F(e);return Promise.resolve(e)})},isLocalTeamMember:function e(t){if(!t){TS.warn("isLocalTeamMember: No member provided?");return}if(t._is_local)return t._is_local;return t.team_id===TS.model.team.id},readyMemberSearcher:function e(t,r){return E(t,r)},buildPromiseToSearchMembersArguments:function e(t){return O(t)},haveAllMembersForModelOb:function e(t){if(t.is_channel&&!t.is_group)return false;var r=t.members||[t.user];var n=_.map(TS.model.members,"id");return!_.difference(r,n).length},getAllKnownMemberIds:function e(){return _.map(TS.model.members,"id")},userAddedToTeam:function e(t){var r=_.merge({},TS.model.user);r.enterprise_user.teams=_.uniq(r.enterprise_user.teams.concat(t));TS.members.upsertMember(r);Q();TS.members.user_added_to_team_sig.dispatch(t)},userRemovedFromTeam:function e(t){var r=_.merge({},TS.model.user);r.enterprise_user.teams=r.enterprise_user.teams.filter(function(e){return e!==t});TS.members.upsertMember(r);Q();TS.members.user_removed_from_team_sig.dispatch(t)},fetchMemberObjectsForUserProfileFields:function e(t){var r=[];if(t.is_restricted&&t.profile.guest_invited_by)r.push(t.profile.guest_invited_by);var n=TS.team.getVisibleTeamProfileFieldsForMember(t);var i=_.chain(n).filter({type:"user"}).reduce(function(e,t){return e.concat(t.value.split(/\s*,\s*/))},[]).value();r=_.chain(r).concat(i).compact().uniq().value();if(!r.length)return Promise.resolve();return TS.members.ensureMembersArePresent(r)},removeMembers:function e(t){if(!_.isArray(t)||!t.length)return;var r=_.filter(t,"id");if(!r.length)return;if(1===r.length)TS.redux.member_types.removeMemberTypeForMember(r[0]);else TS.redux.member_types.bulkRemoveMemberTypesForMembers(r);if(TS.useReduxMembers())if(1===r.length)TS.redux.members.removeMember(r[0]);else TS.redux.members.removeMembers(r);else{me(r);_.pullAllBy(TS.model.members,r,"id");_.pullAllBy(h,r,"id");TS.members.invalidateMembersUserCanSeeArrayCaches();TS.members.invalidateActiveMembersArrayCaches()}},maybeUpdateMembersUserCanSee:function e(t){if(!t)return X();return TS.members.ensureMembersArePresent([t]).then(function(){var e=true;return te(TS.members.getMemberById(t),e)})},test:function r(){var r={};Object.defineProperty(r,"_id_map_size",{get:function t(){return e},set:function t(r){e=r}});Object.defineProperty(r,"_id_map",{get:function e(){return t},set:function e(r){t=r}});Object.defineProperty(r,"_name_map",{get:function e(){return i},set:function e(t){i=t}});Object.defineProperty(r,"_maybeRefetchAccessibleUserIds",{get:function e(){return Q},set:function e(t){Q=t}});Object.defineProperty(r,"_is_refetching_accessible_user_ids",{get:function e(){return V},set:function e(t){V=t}});Object.defineProperty(r,"_did_receive_multiple_calls_to_refetch_accessible_user_ids",{get:function e(){return Y},set:function e(t){Y=t}});Object.defineProperty(r,"_accessible_user_ids_last_fetched_ts",{get:function e(){return J},set:function e(t){J=t}});Object.defineProperty(r,"_maybeSetDeletedStatus",{get:function e(){return k},set:function e(t){k=t}});Object.defineProperty(r,"_maybeSetTeamId",{get:function e(){return x},set:function e(t){x=t}});Object.defineProperty(r,"_maybeSetLocality",{get:function e(){return C},set:function e(t){C=t}});Object.defineProperty(r,"_setImAndMpimNames",{get:function e(){return M},set:function e(t){M=t}});Object.defineProperty(r,"_setLowerCaseNamesForMember",{get:function e(){return G},set:function e(t){G=t}});Object.defineProperty(r,"_setImagesForMember",{get:function e(){return W},set:function e(t){W=t}});return r}});var e=0;var t={};var i={};var a=[];var s=[];var o=[];var l=[];var u=[];var d=[];var c=[];var m=[];var f=[];var p=[];var h=[];var g=250;var S=100;var T={};var v={};var b=function e(t){return _.isString(t)?TS.members.getPotentiallyUnknownMemberById(t):t};var y=function e(t){var r=t?t.is_unknown:false;if(t&&t.is_unknown)t.is_unknown=false;_.pull(h,t.id);if(T[t.id]){de(t.id);if(r)TS.statsd.measure("unknown_member_resolution_timing","unknown_member_resolution_timing_"+t.id)}return r};var w=function e(t){if(t.member_color)return;t.member_color=t.color;if(TS.model.user_colors[t.id])TS.members.setMemberUserColor(t,TS.model.user_colors[t.id])};var k=function e(t,r){if(!TS.boot_data.page_needs_enterprise)return;if(t.enterprise_user&&t.enterprise_user.teams&&t.enterprise_user.teams.length>0)if("web"===TS.boot_data.app){if(t.enterprise_user.teams.indexOf(TS.model.team.id)>-1)t.deleted=false}else if(r&&r.length&&r.indexOf("deleted")>=0){if(t.deleted){t.deleted=false;var n=r.indexOf("deleted");if(n>=0)r.splice(n,1);if(TS.model.user.is_restricted)r.push("member_visibility")}}else t.deleted=false};var x=function e(t){if(t.team_id)return;if(t.enterprise_user&&t.id===t.enterprise_user.id){t.team_id=t.enterprise_user.enterprise_id;return}t.team_id=TS.model.team.id};var C=function e(t){if(!t){TS.warn("_maybeSetLocality: No member provided?");return}t._is_local=TS.utility.teams.isMemberOnTeam(t,TS.model.team);if(TS.boot_data.page_needs_enterprise){var r=TS.redux.enterprise.getEnterpriseId();t._is_from_org=!t._is_local&&(t.team_id===r||_.get(t,"enterprise_user.enterprise_id")===r)}t.is_external=TS.utility.teams.isMemberExternal(t);if(TS.members.is_in_bulk_upsert_mode)TS.redux.member_types.addToBulkUpdatePayload(t);else TS.redux.member_types.updateMemberTypeForMember(t)};var M=function e(t){TS.ims.setNameFromMember(t);TS.mpims.setNamesFromMember(t)};var I=function e(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"flannel_fallback";if(_.isEmpty(t))return Promise.resolve();if(!Array.isArray(t))return Promise.reject(new Error("m_ids is not an array"));t=_.uniq(t);var i="calls"===TS.boot_data.app&&!TS.redux.socket.isConnecting();var a;var s=TS.useSocket()&&!r&&!i;if(s)a=TS.flannel.fetchRawObjectsByIds(t).catch(function(e){TS.warn("_fetchAndUpsertMembersWithIds: Flannel fetch fetched; will fall back to API");TS.warn("_fetchAndUpsertMembersWithIds: error was "+e.message);TS.warn("_fetchAndUpsertMembersWithIds: was trying to fetch "+t.join(","));return[]});else{var o=_.filter(t,TS.interop.utility.looksLikeMemberId);if(_.isEmpty(o))return Promise.resolve({fetched_members:[]});var l={users:o,custom_fields_mode:"user",_x_reason:n};a=TS.api.call("users.info",l).then(function(e){return e.data.users})}return a.then(function(e){if(e.length!==t.length)if(s){var r=e;var i=_.difference(t,_.map(r,"id"));var a=i.join(",");var o=true;var l=n?n+"_fallback":"";return P(i,o,l).then(function(e){var n=_.concat(r,e.fetched_members);if(n.length===t.length){TS.warn("_fetchAndUpsertMembersWithIds tried to fetch members from Flannel but had to fall back to the API (everything worked out, though). Members: "+a);var i={failed_ids:a};var s="_fetchAndUpsertMembersWithIds tried to fetch members from Flannel but they were not returned";var o="flannel_ensure_members_failure";var l=true;TS.console.logError(i,s,o,l)}else{TS.warn("_fetchAndUpsertMembersWithIds tried to fetch members from Flannel and from the API and still could not find them. Missing members: "+a);var u={failed_ids:_.difference(t,_.map(n,"id")).join(",")};var d="_fetchAndUpsertMembersWithIds tried to fetch members from Flannel and from the API but they were not returned";var c="flannel_users_info_ensure_members_failure";var m=true;TS.console.logError(u,d,c,m)}return n})}return e}).then(function(e){var r=_.difference(t,_.map(e,"id"));if(e.length!==t.length)TS.warn("_fetchAndUpsertMembersWithIds requested "+t.length+" members but received "+e.length+". Missing members: "+r.join(", "));var n=[];_.each(r,function(e){N(e);if(!TS.members.getMemberById(e)||_.includes(h,e))n.push(e)});if(n.length){var i={failed_ids:n.join(",")};var a="_fetchAndUpsertMembersWithIds tried to make non-existent members and failed";var s="non_existent_ensure_members_failure";var o=true;TS.console.logError(i,a,s,o)}return{fetched_members:e,missing_members:r}})};var P=function e(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"flannel_fallback";return I(t,r,n).then(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.fetched_members,r=e.missing_members;return{fetched_members:TS.shared.batchUpsertObjects(t),missing_members:r}})};var A=function e(t,r){var n=b(t);if(!n)return"";if(!n.profile){if(n.is_bot&&n.name)return n.name;return""}if(n.profile[r])return n.profile[r];if(n[r])return n[r];if(n.profile[r+"_normalized"])return n.profile[r+"_normalized"];return""};var E=function e(t,r){t=t||{};if(t.hasOwnProperty("_searcher_p")&&r)t._searcher_p.cancel();if(!t.hasOwnProperty("_cursor_mark")||r)t._cursor_mark="";if(!t.hasOwnProperty("full_profile_filter"))t.full_profile_filter=true;if(!t.hasOwnProperty("include_bots"))t.include_bots=true;if(!t.hasOwnProperty("include_deleted"))t.include_deleted=false;if(!t.hasOwnProperty("include_self"))t.include_self=false;if(!t.hasOwnProperty("include_slackbot"))t.include_slackbot=true;if(!t.hasOwnProperty("only_local_team"))t.only_local_team=false;if(!t.hasOwnProperty("only_admins"))t.only_admins=false;if(!t.hasOwnProperty("items")||r)t.items=[];if(!t.hasOwnProperty("not_member_of"))t.not_member_of=[];if(!t.hasOwnProperty("member_of"))t.member_of=[];if(!t.hasOwnProperty("num_found")||r)t.num_found=0;if(!t.hasOwnProperty("num_remaining")||r)t.num_remaining=0;if(!t.hasOwnProperty("num_new")||r)t.num_new=0;if(!t.hasOwnProperty("max_api_results"))t.max_api_results=100;if(r){t._last_query=t.query;t._last_include_org=t.include_org;t._last_org_team_ids=t.org_team_ids}t._is_new=!!r;return t};var F=function e(t){var r=function e(){return B(t)};if(t._is_new)t._searcher_p=r();else t._searcher_p=t._searcher_p.then(r);return t._searcher_p};var O=function e(t){var r=[TS.utility.search.makeClause("is","user")];if(t._last_query){var n=t._last_query.split(/\s*,\s*|\s+/).map(function(e){return"@"===e.charAt("0")?e.substring(1):e}).filter(function(e){return!!e}).map(function(e){if(1===e.length||!t.full_profile_filter)return TS.utility.search.makeConjunction("OR",[TS.utility.search.makeClause("real_name",e),TS.utility.search.makeClause("display_name",e)]);return TS.utility.search.makeClause("fuzzy_with_email",e)});r=r.concat(n)}if(t.not_member_of&&t.not_member_of.length){var i=t.not_member_of.map(function(e){return TS.utility.search.makeClause("not_member_of",e)});r.push(i.length>1?TS.utility.search.makeConjunction("OR",i):i[0])}if(t.member_of&&t.member_of.length){var a=t.member_of.map(function(e){return TS.utility.search.makeClause("member_of",e)});r.push(a.length>1?TS.utility.search.makeConjunction("OR",a):a[0])}if(t._last_include_org&&t._last_org_team_ids.length){var s=t._last_org_team_ids.map(function(e){return TS.utility.search.makeClause("belongs_to_team_id",e)});r.push(s.length>1?TS.utility.search.makeConjunction("OR",s):s[0])}var o=r.length>1?TS.utility.search.makeConjunction("AND",r):r[0];var l={query:o,count:t.max_api_results,include_bots:t.include_bots,include_deleted:t.include_deleted,ignore_guest_accounts:t.ignore_guest_accounts,only_local_team:t.only_local_team,only_admins:t.only_admins,raw_query:t.query};if(t._last_include_org)l.all_of_org=t._last_include_org;if(t._cursor_mark)l.cursor_mark=t._cursor_mark;if(t.determine_membership_for_channel)l.determine_membership_for_channel=t.determine_membership_for_channel;return l};var B=function e(t){var r=O(t);t.num_new=0;return TS.utility.search.promiseToSearch(r).then(function(e){if(!e.data.items.length)return Promise.resolve(t);if(!t.num_remaining){t.num_remaining=e.data.num_found;t.num_found=e.data.num_found}t.num_remaining-=e.data.items.length;t._cursor_mark=e.data.next_cursor_mark;var r=e.data.items.map(function(e){var r=TS.members.getMemberById(e.id);if(!r){if(t._last_include_org&&e.team_id!==TS.model.team.id){e.is_primary_owner=false;e.is_owner=false;e.is_admin=false}r=TS.members.upsertMember(e).member}return r}).filter(function(e){if(e.is_self&&!t.include_self||e.is_slackbot&&!t.include_slackbot){t.num_found-=1;return false}if(t.limit_by_model_relevancy)return TS.utility.members.isMemberRelevantToModel(e,t.limit_by_model_relevancy);return true});t.num_new=r.length;t.items.push.apply(t.items,r);return Promise.resolve(t)})};var D=function e(t){if(!_.isObject(t))return t;return _.omitBy(t,function(e,t){return 0===t.indexOf("image_")})};var H=function e(t,n){var i="NOOP";var a=[];z(t,n);Object.keys(n).forEach(function(e){if("profile"===e){var s=D(t.profile);var o=D(n.profile);if(_.isObject(o)){if(s.status_text!==o.status_text||s.status_emoji!==o.status_emoji){i="CHANGED";a.push("current_status");t.profile.status_text=o.status_text;t.profile.status_emoji=o.status_emoji}var l=Object.keys(s).filter(function(e){return"undefined"===typeof o[e]}).concat(["status_text","status_emoji"]);s=_.omit(s,l);o=_.omit(o,l);if(!_.isEqual(s,o)){var u=_.some(["real_name","full_name","display_name"],function(e){return o[e]!=s[e]});if(!_.isUndefined(s.fields)&&_.isUndefined(o.fields)){if(!TS.calls)TS.warn("So uh, yeah, we just tried to overwrite the `fields` value. Keeping what we have instead. User: "+n.id);o.fields=s.fields}t.profile=_.assign(t.profile,o);if(u)G(t);var d=s.avatar_hash!=o.avatar_hash;if(d)W(t);i="CHANGED";a.push(e)}}}else if("enterprise_user"===e)if(t[e]){for(var c in n[e])if(!_.isEqual(t[e][c],n[e][c])){t[e][c]=n[e][c];i="CHANGED";a.push(e)}}else{t[e]=n[e];i="CHANGED";a.push(e)}else if("id"===e){var m=t.id!=n.id&&t.enterprise_user&&n.enterprise_user;if(m){var f=t.enterprise_user.id===t.id;var p=n.id!=n.enterprise_user.id;if(f&&p){t.id=n.id;i="CHANGED";a.push(e)}}}else if("teams"===e){t[e]=n[e];i="CHANGED";a.push(e)}else if(t[e]!=n[e]){if("is_admin"===e)if(TS.has_pri[oe]){TS.warn(oe,e+"is changing from `"+t[e]+"` to `"+n[e]+"`");TS.console.trace(oe)}if(n[e]&&!TS.utility.isScalar(n[e])){t[e]=n[e];TS.warn(e+" is not scalar! it needs to be handled by upsertMember specifically to test if it has changed! "+r(n[e]))}else if("boolean"!==typeof n[e]||!n[e]!=!t[e]){a.push(e);i="CHANGED";var h=t[e];var g=n[e];t[e]=g;if("name"===e)TS.members.usernameChanged(t,h);else if("real_name"===e)t._real_name_lc=_.toLower(t.profile.real_name)}}});if(y(t))a.push("is_unknown");w(t);k(t,a);x(t);C(t);return{status:i,what_changed:a}};var j=function e(){if(!h.length){var t=TS.shared.getActiveModelOb();if(t&&v[t.id]){var r=performance.now()-v[t.id];TS.metrics.store("channel_switched_to_unknown_resolution",r);delete v[t.id]}return Promise.resolve()}var n=_.clone(h);if(TS.utility.enableFeatureForUser(10)&&n)TS.metrics.store("unknown_member_fetch_batch_size",n.length);return P(n,false,"unknown_members").then(function(t){var r=t.fetched_members;if(r&&n.length!==_.map(r,"id").length)TS.console.logError({member_ids_requested:n,member_ids_returned:_.map(r,"id"),is_enterprise:"enterprise"===TS.model.team.plan},"member_non_existent","unknown_member_error",false);var i=true;if(TS.client&&TS.client.ui)TS.client.ui.rebuildAll(i);return e()}).catch(function(t){t.unknown_member_ids=h;t.unknown_member_ids_getting_fetched=n;TS.console.logError(t,"unknown_fetch_error","unknown_member_error",true);_.pullAll(h,n);return e()})};var R=function e(t){if(!_.isString(t))return null;if(t&&"@"===t.charAt(0))t=t.substring(1);if(TS.has_pri[se])TS.log(se,"member id "+t+" not found in members map, added unknown member to map");var r=L(t);h.push(t);if(TS.useReduxMembers())return r;if(1===h.length)_.defer(j);return r};var L=function e(t){if(TS.useReduxMembers())return{id:t,name:t,is_unknown:true,is_non_existent:false,files:[],profile:{}};var r={id:t,name:t};r=TS.members.upsertMember(r).member;r.is_unknown=true;r.is_non_existent=false;U(r);ue(t);TS.statsd.mark("unknown_member_resolution_timing_"+t);return r};var N=function e(t){var r={id:t,name:t};if(TS.useReduxMembers())return n;var n=TS.members.upsertMember(r).member;n.is_non_existent=true;y(n);U(n);return n};var U=function e(t){if(!_.isObject(t.profile))return;if(!t.is_unknown&&!t.is_non_existent)return;_.forEach(["24","32","48","72","192","512","1024"],function(e){t.profile["image_"+e]=cdn_url+"/436da/img/unknown_avatar.png"})};var q=function e(t){if(!t.profile||"object"!==r(t.profile))t.profile={};if("USLACKBOT"===t.id)t.is_slackbot=true;y(t);w(t);k(t);x(t);C(t);t._first_name_lc="";t._last_name_lc="";t._real_name_lc="";t._real_name_normalized_lc="";t._display_name_lc="";t._display_name_normalized_lc="";G(t);W(t);t.files=[];t.activity=[];t.stars=[];t.mentions=[];K(t);M(t)};var G=function e(t){if("name"in t)t._name_lc=_.toLower(t.name);if(!_.isObject(t.profile))return;if("first_name"in t.profile)t._first_name_lc=_.toLower(t.profile.first_name);if("last_name"in t.profile)t._last_name_lc=_.toLower(t.profile.last_name);if("real_name"in t.profile){t._real_name_lc=_.toLower(t.profile.real_name);t._real_name_normalized_lc=_.toLower(TS.interop.I18n.deburr(t._real_name_lc));t.profile.real_name_normalized=TS.interop.I18n.deburr(t.profile.real_name)}if("display_name"in t.profile)t._display_name_lc=_.toLower(t.profile.display_name);if("display_name_normalized"in t.profile)t._display_name_normalized_lc=_.toLower(t.profile.display_name_normalized)};var W=function e(t){if(!_.isObject(t.profile))return;x(t);var r=TS.model.team.avatar_base_url+t.team_id+"-"+t.id+"-"+t.profile.avatar_hash+"-";_.forEach(["24","32","48","72","192","512","1024"],function(e){t.profile["image_"+e]=r+e});delete t.profile.image_original};var z=function e(t,r){if(_.get(t,"profile.always_active")!==_.get(r,"profile.always_active"))r.presence=_.get(r,"profile.always_active")?"active":"away"};var K=function e(t){t.presence="active"===t.presence?"active":"away";if(_.get(t,"profile.always_active"))t.presence="active"};var V=false;var Y=false;var J=0;var Q=function e(){if(!TS.model.user.is_restricted)return;if(V){Y=true;return}V=true;var t=12e4;var r=Date.now()-J;var n;if(r<t)n=new Promise(function(e){setTimeout(e,t-r)});else n=Promise.resolve();n.then(function(){Y=false;return TS.members.maybeFetchAccessibleUserIds()}).finally(function(){V=false;if(Y){Y=false;Q()}});return n};var X=function e(){TS.members.invalidateMembersUserCanSeeArrayCaches();return Q()};var Z=function e(){TS.model.need_guest_accessible_user_ids=true};var ee=function e(t){return!t||!TS.model.user||!TS.model.user.is_restricted||!TS.model.guest_accessible_user_ids||!TS.model.guest_accessible_user_ids.length||TS.model.need_guest_accessible_user_ids||V};var te=function e(t,r){if(ee(t))return X();if(r){if(_.includes(TS.model.guest_accessible_user_ids,t.id))return Promise.resolve();TS.model.guest_accessible_user_ids.push(t.id)}else{if(!_.includes(TS.model.guest_accessible_user_ids,t.id))return Promise.resolve();_.pull(TS.model.guest_accessible_user_ids,t.id)}TS.members.invalidateMembersUserCanSeeArrayCaches();return Promise.resolve()};var re=function e(t){if(ee(t))return X();if(!_.includes(TS.model.guest_accessible_user_ids,t.id))return Promise.resolve();var r=_.concat(_.flatMap(TS.model.mpims,"members"),_.map(TS.model.ims,"user"));if(_.includes(r,t.id))return Promise.resolve();var n=ne(t);var i=n[0];var a=n[1];if(a.length>ie)return X();if(a.length)return Promise.map(a,function(e){return TS.membership.ensureChannelMembershipIsKnownForUsers(e.model_ob.id,[t.id])}).then(function(){return e(t)});if(_.some(i,"membership.is_member"))return Promise.resolve();_.pull(TS.model.guest_accessible_user_ids,t.id);TS.members.invalidateMembersUserCanSeeArrayCaches();return Promise.resolve()};var ne=function e(t){return _(_.concat(TS.channels.getChannelsForUser(),TS.model.groups)).map(function(e){var r;if(TS.boot_data.feature_store_membership_in_redux)r=TS.redux.membership.getChannelMembershipInfoForUser(e.id,t.id);else r=TS.membership.getUserChannelMembershipStatus(t.id,e);return{model_ob:e,membership:r}}).partition("membership.is_known").value()};var ie=10;var ae=4;var se=6655;var oe=1975;var le=function e(){if(0===_.keys(T).length)return;_.each(T,de)};var ue=function e(t){if(T[t])return;var r=TS.console.getStackTrace();T[t]=setTimeout(function(){if(TS.redux.socket.isConnected()){P([t],false,"unknown_member").then(function(){var e=TS.members.getUnknownMemberById(t);var r=e?"failure":"success";if("success"===r)de(t);TS.metrics.count("unknown_member_timeout_retry_"+r)});if(T[t])return;T[t]=setTimeout(function(){if(TS.redux.socket.isConnected()){var e=TS.members.getUnknownMemberById(t);if(e)return;TS.metrics.count("unknown_member_persistence_timeout");TS.statsd.measure("unknown_member_resolution_timing","unknown_member_resolution_timing_"+t);TS.console.logError({id:t,is_unknown:e.is_unknown,is_non_existent:e.is_non_existent,start_stack:r},"persistent unknown member","unknown_member_error",true)}},6e4)}},2e4)};var de=function e(t){clearTimeout(T[t]);delete T[t]};var _e=function e(t,r){if("ADDED"===t.status)TS.members.lazily_added_sig.dispatch(t.member);else if("CHANGED"===t.status){if(-1!==t.what_changed.indexOf("is_unknown")){TS.members.changed_is_unknown_sig.dispatch(t.member);return t}if(-1!==t.what_changed.indexOf("current_status"))TS.members.changed_current_status_sig.dispatch(t.member);if(-1!==t.what_changed.indexOf("profile"))TS.members.changed_profile_sig.dispatch(t.member);if(-1!==t.what_changed.indexOf("is_restricted")||-1!==t.what_changed.indexOf("is_ultra_restricted"))TS.members.changed_account_type_sig.dispatch(t.member);if(-1!==t.what_changed.indexOf("real_name"))TS.members.changed_real_name_sig.dispatch(t.member);if(-1!==t.what_changed.indexOf("name"))TS.members.changed_name_sig.dispatch(t.member);if(-1!==t.what_changed.indexOf("tz"))TS.members.changed_tz_sig.dispatch(t.member);if(-1!==t.what_changed.indexOf("deleted")){TS.members.changed_deleted_sig.dispatch(t.member);var n=TS.ims.getImByMemberId(t.member.id);if(n)TS.ims.calcUnreadCnts(n,true);TS.groups.calcActiveMembersForAllGroups()}if(-1!==t.what_changed.indexOf("presence"))TS.members.presence_changed_sig.dispatch(t.member);if(-1!==t.what_changed.indexOf("is_owner"))TS.members.changed_owner_perms_sig.dispatch(t.member);if(-1!==t.what_changed.indexOf("is_admin"))TS.members.changed_admin_perms_sig.dispatch(t.member);if(-1!==t.what_changed.indexOf("member_visibility"))Q();if(r.is_self){TS.members.changed_self_sig.dispatch(t.member);TS.model.makeYouRegex()}}return t};var ce=function r(n){if("undefined"===typeof t[n]){var i=TS.model.members;if(!i)return;if(e<i.length){i.forEach(function(e){t[e.id]=e});e=Object.keys(t).length;if(e!==i.length)TS.warn("member map size and member list length have diverged")}}};var me=function r(n){n.forEach(function(e){delete t[e.id];delete i[e._name_lc];delete i["@"+e._name_lc]});e=Object.keys(t).length};var fe=function e(){var t=TS.shared.getActiveModelOb();if(h.length>0&&t)v[t.id]=performance.now()}})()},4782:function(e,t){var r="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};(function(){TS.registerModule("team",{team_profile_changed_sig:new signals.Signal,team_plan_changed_sig:new signals.Signal,team_email_domain_changed_sig:new signals.Signal,team_domain_changed_sig:new signals.Signal,team_name_changed_sig:new signals.Signal,onStart:function e(){if(TS.useSocket())TS.redux.socket.connectedSig.add(n,TS.team)},upsertAndSignal:function e(t){if(!t)return;var r=TS.team.upsertTeam(t);if("CHANGED"===r.status){if(-1!=r.what_changed.indexOf("profile"))TS.team.team_profile_changed_sig.dispatch(r.team);if(-1!=r.what_changed.indexOf("email_domain"))TS.team.team_email_domain_changed_sig.dispatch(r.team);if(-1!=r.what_changed.indexOf("domain"))TS.team.team_domain_changed_sig.dispatch(r.team)}return r},upsertTeam:function e(t){a(t);var n=TS.model.team;var i="NOOP";var l=[];if(t){if(TS.has_pri[4])TS.log(4,'updating team "'+t.id+'"');for(var u in t)if("profile"===u){if(t.profile.fields&&t.profile.fields.length){if("object"===r(t.profile.fields[0]))s(t.profile.fields);else if("string"===typeof t.profile.fields[0])o(t.profile.fields);l.push(u);i="CHANGED"}}else if("prefs"===u){TS.redux.prefs.setTeamPrefs(t.prefs);delete t.prefs}else if("icon"===u||"cannot_leave_reasons"===u)n[u]=t[u];else if(n[u]!=t[u])if(t[u]&&!TS.utility.isScalar(t[u])){n[u]=t[u];TS.warn(u+" is not scalar! it needs to be handled by upsertTeam specifically to test if it has changed! "+r(t[u]))}else if("boolean"!==typeof t[u]||!t[u]!=!n[u]){n[u]=t[u];l.push(u);i="CHANGED"}TS.teams.upsertTeam(n)}return{status:i,team:n,what_changed:l}},ensureTeamProfileFields:function e(){if(t)return t;t=TS.api.call("team.profile.get").then(function(e){TS.team.upsertTeam(_.assign({id:TS.boot_data.team_id},{profile:e.data.profile}))});return t},getTeamProfileFieldById:function e(t){if(!TS.model.team.profile.fields.length)TS.warn("Ensure profile fields exist before calling getTeamProfileFieldById");for(var r=0;r<TS.model.team.profile.fields.length;r+=1)if(TS.model.team.profile.fields[r].id===t)return TS.model.team.profile.fields[r];return null},getVisibleTeamProfileFields:function e(){if(!TS.model.team.profile.fields.length)TS.warn("Ensure profile fields exist before calling getVisibleTeamProfileFields");return TS.model.team.profile.fields.filter(function(e){return!e.is_hidden})},getHiddenTeamProfileFields:function e(){if(!TS.model.team.profile.fields.length)TS.warn("Ensure profile fields exist before calling getHiddenTeamProfileFields");return TS.model.team.profile.fields.filter(function(e){return e.is_hidden})},getTeamCustomStatusPresets:function e(){return _.map(TS.prefs.getTeamPref("custom_status_presets"),function(e){return{text:e[1],emoji:e[0]}})},sortTeamProfileFieldsByOrdering:function e(){if(!TS.model.team.profile.fields.length)TS.warn("Ensure profile fields exist before calling sortTeamProfileFieldsByOrdering");else TS.model.team.profile.fields.sort(function(e,t){return e.ordering-t.ordering})},getVisibleTeamProfileFieldsForMember:function e(t,r){if(!(t&&t.profile))return[];if(!TS.model.team.profile.fields.length)TS.warn("Ensure profile fields exist before calling getVisibleTeamProfileFieldsForMember");return TS.model.team.profile.fields.filter(function(e){return(r||_.get(t.profile,["fields",e.id,"value"]))&&!e.is_hidden}).map(function(e){var r=_.get(t.profile,["fields",e.id,"value"]);var n=_.get(t.profile,["fields",e.id,"alt"]);var i=r&&"date"===e.type?TS.interop.datetime.convertISOtoUTCReadableDate(r):n;return $.extend(true,{value:r,alt:i},e)})},isEntireTeamLoaded:function t(){return e}});var e=false;var t;var n=function e(){t=null};var i=function e(t){if(t&&t.length)_.remove(t,function(e){return!e});return!(t&&t.length)};var a=function e(t){if(!t)return;if(_.get(window,"TS.model.team.profile.fields"))return;_.set(t,"profile.fields",_.get(t,"profile.fields",[]));TS.teams.upsertTeam(t)};var s=function e(t){if(i(t))return;var r=false;var n=false;var a=TS.model.team.profile.fields.reduce(function(e,t){e[t.id]=t;return e},{});t.forEach(function(e){var t=a[e.id];if(t){n=n||u(t,e);r=r||t.ordering!==e.ordering;$.extend(true,t,e)}else{TS.model.team.profile.fields.push(e);if(TS.model.members&&"options_list"===e.type)n=true}});if(r)TS.team.sortTeamProfileFieldsByOrdering();if(n)l(t)};var o=function e(t){if(i(t))return;_.remove(TS.model.team.profile.fields,function(e){return-1!==t.indexOf(e.id)});l(t)};var l=function e(t){if(!t||!t.length)return;if(!TS.model.members)return;t.forEach(function(e){TS.model.members.forEach(function(t){if(t.profile.fields&&t.profile.fields[e.id||e]){if(e.id){if("options_list"!==e.type)return;var r=-1!==e.possible_values.indexOf(t.profile.fields[e.id].value);if(r)return}var n=$.extend(true,{},t);delete n.profile.fields[e.id||e];TS.members.upsertMember(n)}})})};var u=function e(t,r){if(TS.model.members&&"options_list"===r.type)return r.possible_values.some(function(e){return-1===t.possible_values.indexOf(e)});return false}})()},4783:function(e,t){var r="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};(function(){TS.registerModule("apps",{onStart:function t(){var r=true;e=TS.utility.throttleFunc(e,3e3,r)},isAppSpaceEnabled:function e(){return TS.boot_data.is_app_space_enabled},isAppCanvasesEnabled:function e(){return TS.boot_data.feature_app_canvases&&"in_experiment"===TS.experiment.getGroup("app_canvas_flexpane")},isAppmin:function e(){var t=false;var r=_.get(TS,"model.user");if(r&&!r.is_restricted){var n=TS.prefs.getTeamPref("who_can_manage_integrations");if(_.isUndefined(n))n={};if(n){var i=n.type||[];if(i.indexOf("admin")&&r.is_admin||i.indexOf("owner")&&r.is_owner)t=true;var a=n.subteam||[];var s=Object.keys(TS.model.your_user_group_regex);if(_.intersection(a,s).length>0)t=true;var o=n.user||[];if(-1!==o.indexOf(r.id))t=true}}return t},isCurrentModelViewAnApp:function e(){var t=TS.shared.getActiveModelOb();if(!t)return false;var r=TS.members.getMemberById(_.get(t,"user"));var n=_.get(r,"profile.bot_id");return!!n},resetUpApps:function t(){TS.storage.storeApps("");e()},setUp:function e(){return TS.apps.fetchApps()},ingestApp:function e(t){if(!t||!t.id)return;TS.model.apps[t.id]=t;TS.storage.storeApps({data:TS.model.apps,cache_ts:TS.model.apps_cache_ts})},ingestApps:function e(t){if("object"!==("undefined"===typeof t?"undefined":r(t))||!t)return;TS.storage.storeApps({data:t,cache_ts:TS.model.apps_cache_ts});TS.model.apps={};_.forEach(t,function(e){TS.model.apps[e.id]=e})},fetchApps:function e(){var t=TS.storage.fetchApps();if(t&&TS.model.apps_cache_ts==t.cache_ts){TS.model.did_we_load_with_app_cache=true;TS.apps.ingestApps(t.data);return Promise.resolve()}return TS.api.call("apps.list").then(function(e){TS.model.apps_cache_ts=e.data.cache_ts;TS.apps.ingestApps(e.data.apps)}).catch(_.noop)},getAppById:function e(t){if(!_.isString(t))return null;var r=TS.model.apps;if(!r){TS.warn("Trying to look up app by id ("+t+") but TS.model.apps is not present.");return null}var n=_.find(TS.model.apps,{id:t});if(n){n.is_app=true;return n}TS.warn("Trying to look up app by id ("+t+") but it is not present.");return null},startFlexPaneByAppId:function e(t,r,n){return TS.apps.promiseToGetFullAppProfile(null,t,r,n).then(function(e){TS.client.ui.app_profile.openWithApp(e,null,t,n);TS.client.flexDisplaySwitched("apps",e.id,true,true)}).catch(function(){TS.client.ui.flex.hideFlex()})},startFlexPaneByBotId:function e(t,r,n){return TS.apps.promiseToGetFullAppProfile(r,t,null,n).then(function(e){TS.client.ui.app_profile.openWithApp(e,r,t,n);TS.client.flexDisplaySwitched("apps",r,true,true)}).catch(function(){TS.client.ui.flex.hideFlex()})},promiseToGetFullAppProfile:function e(t,r,n,i){if(t&&!_.isString(t))return null;if(n&&!_.isString(n))return null;return new Promise(function(e,a,s){var o=TS.api.call("apps.profile.get",{bot:t,bot_home_team:r,app:n,show_auth_summary:!!i}).then(function(r){if(r.data.ok&&r.data.app_profile){var n=r.data.app_profile;TS.apps.ingestApp(n);e(n)}else{a(r.data.error);TS.warn("Trying to look up app by bot id ("+t+") but it failed.")}}).catch(function(e){TS.warn("Trying to look up app by bot id ("+t+") but it failed.");a(e.data)});s(function(){o.cancel()})})},sortNames:function e(t){return t.slice().sort(TS.i18n.sorter)},constructTemplateArgsForCardAndProfile:function e(t,r,n,i,a){if(!t)return TS.warn("Trying to build app card but it failed.");if(void 0==a)a=true;var s=r?"/services/"+r:"/apps/"+t.id;var o={settings_url:s,name:t.name,desc:t.desc,app_icons:t.icons,app_id:t.id,bot_id:r,is_slack_integration:t.is_slack_integration,is_directory_published:t.is_directory_published,is_distributed:t.is_distributed,commands:_.toArray(t.commands),is_external_app:t.is_external,app_team_id:i,is_xoxa_app:t.is_xoxa_app};var l=_.get(t,"bot_user.id");var u;if(n)u=TS.members.getMemberById(n);var d;if(t.app_card_color){o.color=TS.utility.hex2rgb(t.app_card_color);o.color.hex=t.app_card_color}if(t.config&&t.config.is_custom_integration){if(t.config.icons)if(t.config.icons.emoji){var c=TS.emoji.graphicReplace(_.escape(t.config.icons.emoji),{force_img:true});o.emoji_img_tag=new Handlebars.SafeString(c)}else o.bot_icons=t.config.icons;if(t.config.real_name)d=t.config.real_name;else d=t.bot_user?t.bot_user.username:t.config.username;o.name=d;o.desc=t.config.descriptive_label;o.username=t.config.username;o.custom_integration_type=t.config.custom_integration_type;o.date_created=t.config.date_created;var m='<a class="bold member charcoal_grey" data-member-id='+t.config.created_by+">"+TS.members.getPrefCompliantMemberNameById(t.config.created_by,true,true)+"</a>";o.custom_integration_creator=new Handlebars.SafeString(m)}if(_.get(t.config,"icons"))if(t.config.icons.image_72)o.avatar=t.config.icons.image_72;else o.avatar=t.config.icons.image_48;else if(t.icons)if(t.is_slack_integration)o.avatar=t.icons.image_192;else o.avatar=t.icons.image_96;if(t.screenshots)o.screenshots=t.screenshots;if(t.youtube_url){var f=TS.utility.getYoutubeIdFromURL(t.youtube_url);o.youtube_url=t.youtube_url;o.youtube_id=f}var p=t.screenshots||t.youtube_url;o.has_screenshots=p;if(_.get(t.config,"date_deleted")>0||true===_.get(t.auth,"revoked")){o.deleted=true;o.app_id=t.id}if(!t.is_slack_integration){if(t.is_external)o.disabled=false;else if(i!==TS.model.team.id)o.disabled=false;else if(!t.auth||t.auth.revoked)o.disabled=true}else if(t.is_slack_integration)if(t.is_slack_integration&&t.is_external)o.disabled=false;else if(!t.config||1!==parseInt(t.config.is_active,10)||0!==parseInt(t.config.date_deleted,10))o.disabled=true;if(a&&!t.is_external&&(l||!t.is_slack_integration)&&!t.is_xoxa_app)o.show_settings_section=true;if(TS.model.user.is_restricted||TS.model.user.is_ultra_restricted){o.user_is_restricted=true;o.show_settings_section=false;o.disabled=false}if(t.installation_summary&&!t.is_xoxa_app){var h=t.installation_summary.replace(/<@([A-Z0-9]+)>/g,function(e,t){if(TS.members.getMemberById(t))return'<span class="app_card_member_link" data-member-profile-link='+t+">"+TS.members.getPrefCompliantMemberNameById(t,true,true)+"</span>";return'<span class="app_card_member_link" data-member-profile-link='+t+">A user</span>"});h=h.replace(/#([a-z0-9-]+)/g,function(e,t){var r=TS.channels.getChannelByName(t);if(r){var n=TS.templates.builders.makeChannelPrefix(r);return'<span class="app_card_channel_link internal_channel_link" data-channel-id="'+r.id+'">'+n+t+"</span>"}return t});o.installation_summary=new Handlebars.SafeString(h)}if(l){o.bot_user=t.bot_user.id;o.username=t.bot_user.username;o.bot_user_channel_count=t.bot_user.memberships_count;if(t.bot_user.memberships_count<1&&t.is_slack_integration)o.show_settings_section=false}else if(u&&u.is_bot&&!u.is_stranger)o.allow_dm=true;if(l||o.is_xoxa_app){if(!o.disabled){if(!TS.model.user.is_ultra_restricted)o.show_channel_invite=true;o.allow_dm=true}if(true===o.deleted)o.hide_link_to_app_profile=true}if(t.long_desc_formatted)o.long_description=new Handlebars.SafeString(t.long_desc_formatted);if(t.long_desc)o.long_description_raw=new Handlebars.SafeString(t.long_desc);if(t.support_url)o.support_url=t.support_url;if(t.url)o.website_url=t.url;if(t.user_can_manage)o.user_can_manage=t.user_can_manage;var g=_.isEmpty(_.get(t,"commands"));if(t.is_slack_integration&&g||TS.utility.strGetWordCount(t.long_desc)<350||!p&&g)o.hide_expand_button=true;return o},promiseToParsePermissionsForApp:function e(t){if(!t)return;var r={};var n=t.grantors;if(_.get(t,"scopes"))r.scopes=_.orderBy(t.scopes,"is_dangerous","asc");if(n){var i=_.map(n,"id");var a;return TS.members.ensureMembersArePresent(i).then(function(){a=_.map(n,function(e){return TS.members.getMemberById(e.id)});r.grantors=a;return r})}return Promise.resolve(r)}});var e=function e(){TS.apps.setUp()}})()},4784:function(e,t){(function(){TS.registerModule("apps.permissions",{onStart:function e(){TS.channels.member_joined_sig.add(l);TS.channels.member_left_sig.add(l);TS.groups.member_joined_sig.add(l);TS.groups.member_left_sig.add(l);if(TS.client)TS.client.login_sig.addOnce(f)},app_resource_membership_changed_sig:new signals.Signal,xoxa_apps_installed_sig:new signals.Signal,areXoxaAppsInstalled:function e(){return i},ensureAppResourceMembershipIsKnown:function i(a){if(!TS.apps.permissions.areXoxaAppsInstalled())return Promise.resolve(false);if(s(a)&&0!==t){r=a;e={};t=0;n=true;return TS.api.call("apps.permissions.internal.listForResource",{channel:a}).then(function(r){t=Date.now();_.get(r,"data.apps",[]).forEach(function(t){e[t.app_user_id]=t});return true})}return Promise.resolve(false)},ensureAppAndBotResourceMembershipIsKnown:function e(t){if(!TS.apps.permissions.areXoxaAppsInstalled())return Promise.resolve(false);return TS.apps.permissions.ensureAppResourceMembershipIsKnown(t).then(function(){return o(t)})},promiseToGenerateAppAndBotListForResource:function t(r){if(!TS.apps.permissions.areXoxaAppsInstalled())return Promise.resolve(false);return TS.apps.permissions.ensureAppAndBotResourceMembershipIsKnown(r).then(function(){return _.values(e).reduce(function(e,t){if(t.app_id){var r=TS.apps.getAppById(t.app_id);if(r){r.app_user_id=t.app_user_id;e.push(r)}}else if(t.name)e.push(t);return e},[]).sort(TS.i18n.mappedSorter("name"))})},getAppUserResourceMembershipStatus:function t(n,i){if(TS.apps.permissions.areXoxaAppsInstalled()&&i===r)return{is_known:!s(i),is_member:e.hasOwnProperty(n)};return{is_known:false,is_member:false}},addAppToResource:function e(t,r,n){var i;if(!_.isObject(t))throw new Error("Expected app user to be an object");if(!_.isObject(r))throw new Error("Expected model_ob to be an object");var a=r.is_im||r.is_mpim;return TS.api.call("apps.permissions.internal.add",{channel:r.id,app_user:t.id}).then(function(e){return new Promise(function(s,o){if(_.get(e,"data.should_confirm")){i=_.get(e,"data.scope_info",[]);d(t,i,r,s,function(){var e=a?TS.i18n.t("{app_user} wasn’t added to this direct message.","apps")({app_user:u(t)}):TS.i18n.t("{app_user} wasn’t added to this channel.","apps")({app_user:u(t)});TS.cmd_handlers.addEphemeralFeedback(e,{input_txt:n})})}else o()})}).then(function(){return TS.api.call("apps.permissions.internal.add",{channel:r.id,app_user:t.id,did_confirm:true})}).then(function(){if(TS.apps.permissions.areXoxaAppsInstalled())TS.apps.permissions.handleAppResourceMembershipChanged(r,t)}).catch(function(){TS.utility.contenteditable.value(TS.client.ui.$msg_input,n)})},removeAppFromResource:function e(t,r,n){if(!_.isObject(t))throw new Error("Expected app user to be an object");if(!_.isObject(r))throw new Error("Expected model_ob to be an object");var i=_.escape(t.real_name);var a=c(r);var s=r.id;var o=function e(t){if(TS.boot_data.feature_wta_management_modal){var n=document.getElementById("app_permission_dialog_mount_point");TS.interop.mountAppRemoveDialog(TS.boot_data.team_id,n,{appName:i,channel:r,onConfirm:t})}else TS.generic_dialog.start({dialog_class:"p-app_permission_remove_modal",title:new Handlebars.SafeString(TS.i18n.t("Remove {app_name} from {resource_name}?","apps")({app_name:i,resource_name:a})),body:new Handlebars.SafeString(TS.i18n.t("{app_name} will no longer be able to access or post to {resource_name}, unless you invite it again.","apps")({app_name:i,resource_name:a})),go_button_text:TS.i18n.t("Remove","apps")(),go_button_class:"btn_danger",onGo:function e(){t()}})};return new Promise(function(e,r){TS.apps.permissions.ensureAppResourceMembershipIsKnown(s).then(function(){var n=TS.apps.permissions.getAppUserResourceMembershipStatus(t.id,s);if(n.is_known&&n.is_member)o(e);else{TS.cmd_handlers.addEphemeralFeedback(TS.i18n.t("{app_user} isn’t part of this channel or conversation, so you can’t kick it out.","apps")({app_user:u(t)}),{slackbot_feels:"sad_surprise"});r()}})}).then(function(){return TS.api.call("apps.permissions.internal.remove",{channel:s,app_user:t.id})}).then(function(){if(TS.apps.permissions.areXoxaAppsInstalled())TS.apps.permissions.handleAppResourceMembershipChanged(r,t)}).catch(function(){TS.utility.contenteditable.value(TS.client.ui.$msg_input,n)})},requestPermissions:function e(t,r,n){var i=_.flatten(r.map(function(e){return e.scopes})).join(",");var a=TS.members.getMemberById(t);var s=function e(t){TS.api.call("apps.permissions.internal.addScope",{trigger_id:n,scopes:i,did_confirm:t}).catch(function(){TS.cmd_handlers.addEphemeralFeedback(TS.i18n.t("Hmm, something went wrong, try again?","apps")(),{slackbot_feels:"sad_surprise"})})};d(a,r,null,function(){s(true)},function(){s(false)})},addAppOrBotToActiveResource:function e(t){if(!TS.apps.permissions.areXoxaAppsInstalled())return;var r=TS.shared.getActiveModelOb();if(t.is_app_user){TS.apps.permissions.addAppToResource(t,r);return}TS.api.call("conversations.invite",{channel:r.id,user:t.id})},removeAppOrBotFromActiveResource:function e(t){if(!TS.apps.permissions.areXoxaAppsInstalled())return;var r=TS.shared.getActiveModelOb();if(t.is_app_user){TS.apps.permissions.removeAppFromResource(t,r);return}TS.shared.kickMember(r,t.id)},canAppOrBotBeAddedToResource:function e(t,r){if(!t||!TS.apps.permissions.areXoxaAppsInstalled())return false;var n=TS.members.getMemberById(t);if((r.is_im||r.is_mpim)&&!n.is_app_user)return false;var i=TS.apps.permissions.getAppUserResourceMembershipStatus(t,r.id);return i.is_known&&!i.is_member},handleAppResourceMembershipChanged:function e(t,n){if(!TS.apps.permissions.areXoxaAppsInstalled())return;r=null;TS.apps.permissions.app_resource_membership_changed_sig.dispatch(t,n)},buildAddAppsTitle:function e(t){return TS.i18n.t("Add apps to {channel_name}","apps")({channel_name:c(t)})}});var e={};var t;var r;var n=true;var i=false;var a=12e4;var s=function e(n){if(n!==r||t<Date.now()-a)return true;return false};var o=function t(r){if(n&&"D"!==r.charAt(0))return TS.bots.fetchAndUpsertBotsWithQuery({channels:[r],filter:"bots"}).then(function(t){_.get(t,"objects",[]).forEach(function(t){var r=_.get(t,"id");e[r]={app_id:_.get(t,"profile.api_app_id"),app_user_id:_.get(t,"id"),name:_.get(t,"real_name"),app_icon:_.get(t,"profile.image_24")}});n=false;return true});return Promise.resolve(false)};var l=function e(t,n){if(TS.apps.permissions.areXoxaAppsInstalled()&&n.is_bot&&t.id===r)TS.apps.permissions.handleAppResourceMembershipChanged(t,n)};var u=function e(t){return"@"+_.escape(t.name)};var d=function e(t,r,n,i,a){var s=_.escape(t.real_name);var o;if(n)o=TS.i18n.t('{app_name} would like to do the following in <strong class="no_wrap">{channel_name}:</strong>',"apps")({app_name:s,channel_name:c(n)});else o=TS.i18n.t("{app_name} would like to do the following in <strong>all channels it’s a member of:</strong>","apps")({app_name:s});var l=t.profile.image_48;m(l).finally(function(){var e=document.getElementById("app_permission_dialog_mount_point");TS.interop.mountAppPermissionDialog(TS.boot_data.team_id,e,{title:o,onAuthorize:i,onDismiss:a,appName:s,appImageSrc:l,scopeInfo:r,channel:n})})};var c=function e(t){var r;if(t.is_channel)r="#";else if(t.is_im)r="@";else if(t.is_mpim)r='<i class="ts_icon ts_icon_multiparty_dm_'+TS.mpims.getMemberCount(t)+'"></i>';else r='<i class="ts_icon ts_icon_lock"></i>';return r+_.escape(TS.shared.getDisplayNameForModelObNoSigns(t))};var m=function e(t){return new Promise(function(e,r){var n=new Image;n.onload=function(){e()};n.onerror=function(){r(new Error("failed to load image"))};n.src=t})};var f=function e(){if(!TS.boot_data.feature_app_permissions_backend_enterprise&&TS.boot_data.page_needs_enterprise)return;i=_.some(TS.model.apps,{is_xoxa_app:true});if(i)TS.apps.permissions.xoxa_apps_installed_sig.dispatch();else{var t=function e(t){if(t.is_app_user){i=true;TS.apps.permissions.xoxa_apps_installed_sig.dispatch();TS.members.joined_team_sig.remove(e)}};TS.members.joined_team_sig.add(t)}}})()},4785:function(e,t){(function(){TS.registerModule("apps.splash",{onStart:$.noop,create:function t(r){if(!r||r&&0===r.length)return;if(TS.boot_data.feature_app_directory_home_page_redesign){l.drive.headline=TS.i18n.t("Share and search files...","pages_apps_directory")();l.drive.image_alt_text=TS.i18n.t("New Hire Onboarding document shared from {app_name}.","pages_apps_directory")({app_name:"Google Drive"});l.zoom.headline=TS.i18n.t("Start an instant meeting...","pages_apps_directory")();l.zoom.image_alt_text=TS.i18n.t("{app_name}: Bruce started a meeting. Summer Offsite Prep","pages_apps_directory")({app_name:"Zoom"});l.jira.headline=TS.i18n.t("Preview issues and get updates...","pages_apps_directory")();l.jira.image_alt_text=TS.i18n.t("{app_name}. Issue-123: Update rocketship fins. Status: Ready for QA.","pages_apps_directory")({app_name:"Jira Cloud"});l.salesforce.headline=TS.i18n.t("Quickly find account details...","pages_apps_directory")();l.salesforce.image_alt_text=TS.i18n.t("{app_name}: Sunny Farms Account. Show Account.","pages_apps_directory")({app_name:"Salesforce"})}return new e(r)}});function e(e){this.$element=e;this.$buttons=e.find(".splash_interactive__button");this.icons=["drive","zoom","jira","salesforce"];this.active_index=0;this.timeouts=[];this.$buttons.on("click",n.bind(this));r.bind(this)();this.timeouts.push(setInterval(r.bind(this),6e3));o()}function t(e){$("[data-window-link]").unbind("click");$("[data-window-link]").on("click",function(){var t=l[e].link;TS.clog.track("APP_DIRECTORY_HOME_SPLASH",{link_to:t,data_tag_identifier:"splash_interactive__window_link",contexts:{ui_context:{step:"app_directory_home",action:"click",ui_element:e}}});if(t)window.location=t})}function r(){var e=this.icons[this.active_index];i.bind(this,e)();a.bind(this,e)();this.active_index+=1;if(this.active_index===this.icons.length)this.active_index=0}function n(e){if(this.timeouts.length){s(this.timeouts);this.timeouts=[]}var t=$(e.target).data("icon");i.bind(this,t)();a.bind(this,t)()}function i(e){this.$buttons.removeClass("splash_interactive__button--active");$(".splash_interactive__button--"+e).addClass("splash_interactive__button--active")}function a(e){var r=l[e];var n=$("[data-js='window_content_container']");var i=$("[data-js='window_message']");var a=$("[data-js='window_response']");var s=$("[data-js='window_message_content_text']");var o=$("[data-js='splash_color_border']");var u=$("[data-window-link]");var d=$("[data-js='window_headline']");var _=$("[data-js='window_message_content_username']");var c=$("[data-js='window_message_image']");n.addClass("splash_interactive__window_content_container--hide");i.removeClass("splash_interactive__window_message--show");a.removeClass("splash_interactive__window_response--show");s.removeClass("splash_interactive__window_message_content_text--typing");s.removeClass("splash_interactive__window_message_content_text--drive");o.removeClass("splash_color_border--filled");a.removeClass("splash_interactive__window_response--drive");u.attr({href:r.link});t(e);this.timeouts.push(setTimeout(function(){d.html(r.headline);_.html(r.message_profile_name);s.find("span").html(r.message_content);c.css({"background-image":"url("+r.message_profile_image_url+")"});a.attr({srcset:r.response_image_url_1x+" 1x, "+r.response_image_url_2x+" 2x",src:r.response_image_url_2x,alt:r.image_alt_text});i.addClass("splash_interactive__window_message--show");a.addClass("splash_interactive__window_response--show");n.removeClass("splash_interactive__window_content_container--hide");if(r.use_typing_animation){s.addClass("splash_interactive__window_message_content_text--typing");setTimeout(function(){s.removeClass("splash_interactive__window_message_content_text--typing")},2e3)}else{a.addClass("splash_interactive__window_response--drive");s.addClass("splash_interactive__window_message_content_text--drive")}},400))}function s(e){return e.map(function(e){return clearInterval(e)&&clearTimeout(e)})}function o(){$("[data-track]").map(function(e,t){var r=_.get($(t).data(),"track");var n=$(t).attr("href")?$(t).attr("href"):"no_link";if(!r)r="splash_log_error";return TS.clog.trackClick('[data-track="'+r+'"]',"APP_DIRECTORY_HOME_SPLASH",{link_to:n,data_tag_identifier:r,contexts:{ui_context:{step:"app_directory_home",action:"click",ui_element:r}}})})}var l={drive:{headline:"Share and search files...",message_profile_image_url:"/img/apps/profile_drive@2x.png",message_profile_name:"Lisa Zhang",message_content:"shared this file",response_image_url_1x:"/img/apps/response_drive_2.0@1x.png",response_image_url_2x:"/img/apps/response_drive_2.0@2x.png",link:"https://slack.com/apps/A6NL8MJ6Q-google-drive",use_typing_animation:false,image_alt_text:"New Hire Onboarding document shared from Google Drive."},zoom:{headline:"Start an instant meeting...",message_profile_image_url:"/img/apps/profile_zoom@2x.png",message_profile_name:"Bruce Olson",message_content:"/zoom meeting Summer Offsite Prep",response_image_url_1x:"/img/apps/response_zoom_4.0@1x.png",response_image_url_2x:"/img/apps/response_zoom_4.0@2x.png",link:"https://slack.com/apps/A5GE9BMQC-zoom",use_typing_animation:true,image_alt_text:"Zoom: Bruce started a meeting. Summer Offsite Prep"},jira:{headline:"Preview issues and get updates...",message_profile_image_url:"/img/apps/profile_jira_2.0@2x.png",message_profile_name:"Angela Zamfir",message_content:"Can we get ISSUE-123 prioritized today?",response_image_url_1x:"/img/apps/response_jira_2.0@1x.png",response_image_url_2x:"/img/apps/response_jira_2.0@2x.png",link:"https://slack.com/apps/A2RPP3NFR-jira-cloud",use_typing_animation:true,image_alt_text:"Jira Cloud. Issue-123: Update rocketship fins. Status: Ready for QA."},salesforce:{headline:"Quickly find account details...",message_profile_image_url:"/img/apps/profile_salesforce@2x.png",message_profile_name:"Arcadio Buendía",message_content:"/salesforce sunny farms",response_image_url_1x:"/img/apps/response_salesforce_2.0@1x.png",response_image_url_2x:"/img/apps/response_salesforce_2.0@2x.png",link:"https://slack.com/apps/A2DAS7NNR-salesforce",use_typing_animation:true,image_alt_text:"Salesforce: Sunny Farms Account. Show Account."}};e.prototype.destroy=function(){this.$element.off();this.$element.remove()}})()},4786:function(e,t){var r="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};(function(){TS.registerModule("bots",{added_sig:new signals.Signal,changed_name_sig:new signals.Signal,changed_deleted_sig:new signals.Signal,changed_icons_sig:new signals.Signal,batch_upserted_sig:new signals.Signal,is_in_bulk_upsert_mode:false,isBotExternal:function e(t){if(!t.team_id)return false;return TS.model.team.id!==t.team_id&&!TS.model.team.enterprise_id},getBotById:function t(r){if(TS.useReduxMembers())return TS.redux.bots.getBotById(r);if(e[r])return e[r];var n=TS.model.bots;var i;for(var a=0;a<n.length;a+=1){i=n[a];if(i.id==r){TS.warn(r+" not in _id_map");e[r]=i;return i}}return null},getBotByMsg:function e(t){var r=TS.members.getMemberById(t.user);var n=t.bot_id||_.get(r,"profile.bot_id");if(!n)return null;if(t.bot_profile){t.bot_profile.id=n;return t.bot_profile}var i=TS.bots.getBotById(n);if(i){i.id=n;return i}return null},getBotByName:function e(t){var r=TS.model.bots;var n;if("undefined"===typeof t)return null;for(var i=0;i<r.length;i+=1){n=r[i];if(n.name.toLowerCase()==t.toLowerCase())return n}return null},getBotInfoByMsg:function e(t){var r=TS.members.getMemberById(t.user);var n=TS.bots.getBotByMsg(t);var i=_.get(n,"id")||_.get(r,"profile.bot_id");var a=_.get(n,"team_id");if(i&&!n)TS.warn("getBotInfoByMsg: failed to find a bot with ID '"+i+"'");var s=_.get(r,"profile.api_app_id")||_.get(n,"app_id");if(!s&&!i){TS.warn("Unable to get bot info for message",t);return null}if(a)return{bot_id:i,app_id:s,team_id:a};return{bot_id:i,app_id:s}},getBotNameById:function e(t){var r=TS.bots.getBotById(t);if(r&&r.name)return r.name},getBotNameByBotLink:function e(t){t=t.split("|");if(t.length>1){var r=t[1].slice(0,-1);if(r)return r}return null},upsertAndSignal:function e(t){var r=TS.bots.upsertBot(t);return n(r)},upsertBot:function t(n){var a=TS.bots.getBotById(n.id);var s="NOOP";var o=[];if(a){if(TS.has_pri[i])TS.log(i,'updating existing bot "'+n.id+'"');if(TS.useReduxMembers())a=_.assign({},a);for(var l in n)if("icons"===l){if(n[l]&&!TS.utility.areSimpleObjectsEqual(n[l],a[l],"bot:"+n.id+" "+n.name)){a.icons=n.icons;s="CHANGED";o.push(l)}}else if(a[l]!=n[l])if(n[l]&&!TS.utility.isScalar(n[l])){a[l]=n[l];TS.warn(l+" is not scalar! it needs to be handled by upsertBot specifically to test if it has changed! "+r(n[l]))}else if("boolean"!==typeof n[l]||!n[l]!=!a[l]){o.push(l);a[l]=n[l];s="CHANGED"}n=a}else{s="ADDED";if(TS.has_pri[i])TS.log(i,'adding bot "'+n.id+'"');TS.bots.processNewBotForUpserting(n);e[n.id]=n;if(!TS.useReduxMembers())TS.model.bots.push(n)}if("ADDED"===s||"CHANGED"===s)if(TS.useReduxMembers())if(TS.bots.is_in_bulk_upsert_mode)TS.redux.bots.addToBulkUpsertPayload(n);else TS.redux.bots.addBot(n);return{status:s,bot:n,what_changed:o}},processNewBotForUpserting:function e(){},configureUrl:function e(r){if(!r.is_bot)return;var n;var i=t(r);if(i)n="/apps/"+i;else if(r.profile.bot_id)n="/services/"+r.profile.bot_id;return n},startBatchUpsert:function e(){if(TS.bots.is_in_bulk_upsert_mode)return false;TS.bots.is_in_bulk_upsert_mode=true;return true},finishBatchUpsert:function e(){if(!TS.bots.is_in_bulk_upsert_mode)return false;TS.bots.is_in_bulk_upsert_mode=false;TS.bots.batch_upserted_sig.dispatch();return true},ensureBotsInDataArePresent:function e(t){var r=TS.interop.utility.extractAllBotIds(t);return TS.bots.ensureBotsArePresent(r)},ensureBotsArePresent:function e(t){var r=["B01","BSLACKBOT"];var n=_(t).difference(r).reject(function(e){var t=TS.bots.getBotById(e);return t&&!t.is_unknown&&!t.isUnknown}).value();if(!n.length)return Promise.resolve();var i;if(TS.useSocket())i=TS.flannel.fetchRawObjectsByIds(n).then(function(e){return TS.shared.batchUpsertObjects(e)});else i=TS.api.call("bots.info",{bots:n.join(",")}).then(function(e){return e.data.bots.map(function(e){return TS.bots.upsertAndSignal(e).bot})});return i.tap(function(e){if(e.length!==n.length)TS.warn("TS.bots.ensureBotsArePresent requested "+n.length+" bots but received "+e.length+". Missing bots: "+_.difference(n,_.map(e,"id")).join(","))})},fetchAndUpsertBotsWithQuery:function e(t){return TS.flannel.fetchRawObjectsWithQuery(t).then(function(e){e.objects=TS.shared.batchUpsertObjects(e.objects);return e})}});var e={};var t=function e(t){var r=t.profile.api_app_id;if(!r&&TS.model.apps&&TS.model.apps.length){var n=_.find(TS.model.apps,function(e){return e.name.toLowerCase()==t.name.toLowerCase()});if(n)r=n.id}return r};var n=function e(t){if("CHANGED"===t.status){if(-1!=t.what_changed.indexOf("icons"))TS.bots.changed_icons_sig.dispatch(t.bot);if(-1!=t.what_changed.indexOf("name"))TS.bots.changed_name_sig.dispatch(t.bot);if(-1!=t.what_changed.indexOf("deleted"))TS.bots.changed_deleted_sig.dispatch(t.bot)}return t};var i=5})()},4787:function(e,t){(function(){TS.registerModule("members.view",{team_filter_changed_sig:new signals.Signal,filter_timer:null,onStart:function e(){A=TS.web&&TS.web.admin;var t=500;l=TS.utility.debounceWithPromise(w,t);u=TS.utility.debounceWithPromise(w,t);d=TS.utility.debounceWithPromise(w,t)},switchTabs:function e(t){if(A&&"invites"===TS.web.admin.view)$("#"+t+"_invites_tab").trigger("click");else if(TS.client)$("#"+t+"_members_tab").find("a").trigger("click");else $("#"+t+"_members_tab").trigger("click")},bindTeamFilter:function t(r,n,i){i=i||{};var a=$(r);var s=a.find("input.member_filter");var o=a.find(".icon_close");f(n,i);e=null;if(i.full_profile_filter&&!i.is_long_list_view)s.on("focus",function(){TS.team.ensureTeamProfileFields()});s.bind("keyup update-team-filter",function(){var t=s.val();if(TS.members.view.filter_timer)window.clearTimeout(TS.members.view.filter_timer);var a=function a(){if(t.trim().toLocaleLowerCase()!==e)TS.members.view.filterTeam(t,r,n,i).then(function(){if(TS.view)TS.view.rebuildUserGroupList()});o.toggleClass("hidden",!t.trim())};if(i.is_long_list_view)a();else TS.members.view.filter_timer=window.setTimeout(a,TS.members.getMembersForUser().length>500?250:50)});o.bind("click",function(){TS.members.view.clearFilter(r,n);if(TS.view)TS.view.rebuildUserGroupList();e=null;setTimeout(function(){s.focus()},0)})},filterTeam:function e(t,r,n,i){var a=p(n);if(_.get(i,"full_profile_filter")||_.get(a,"full_profile_filter"))return TS.team.ensureTeamProfileFields().then(function(){if(m(a))return T(t,r,n,a);k(t,r,n,i);return Promise.resolve()});k(t,r,n);return Promise.resolve()},getTeamFilter:function t(){return e},selectMatch:function e(t){var r=$(t);var n=r.data("list-items-id");var i=$(n);var a=i.find(".member_item");var s=a.filter(".active");if(1==s.length){var o=s.first();var l=o.data("member-id");if(l){TS.ims.startImByMemberId(l);TS.menu.end()}}},clearFilter:function r(n,i){var a=p(i);var s=$(n);var o=s.find("input.member_filter");var l=s.find(".icon_close");var u=s.data("list-items-id");var d=$(u);var _=d.find(".member_item");e="";TS.storage.storeFilterState(e);if(TS.members.view.filter_timer){window.clearTimeout(TS.members.view.filter_timer);TS.members.view.filter_timer=null}o.val("");l.addClass("hidden");if(m(a)){S(i);TS.members.view.filterTeam(e,n,i,a)}else{$(".restricted_header, .bot_header, .ra_invite_prompt, .restricted_info").removeClass("hidden");d.find(".no_results").addClass("hidden");_.addClass("active");if(t[i]){t[i].detachEvents();delete t[i]}d.find(".member_item.clone").remove();d.find(".filter_header").remove();TS.members.view.team_filter_changed_sig.dispatch("",TS.members.getMembersForUser().length);if(TS.client&&i){var c=$(i);c.trigger("resize-immediate");TS.ui.utility.updateClosestMonkeyScroller(c)}}},onTeamDirectoryItemClick:function e(t){if($(t.target).closest("a").length)return;var r=$(this);var n=r.data("member-id");var i=TS.members.getMemberById(n);if(!i)return;if(TS.client)TS.client.ui.previewMember(n)},findMatchesInMemberList:function e(t,r,n){return E(t,r,n)},getHeaderLabelForMatchKey:function e(t){return x(t)}});var e="";var t={};var r={};var n={};var i={};var a={members:{},restricted:{},deleted:{}};var s=100;var o=TS.client?92:116;var l;var u;var d;var c=function e(){if("list"===_.get(TS,"web.admin.view")&&TS.boot_data.feature_api_admin_page&&TS.boot_data.page_needs_enterprise)return false;return TS.boot_data.page_needs_enterprise};var m=function e(t){if(TS.boot_data.page_needs_enterprise&&t&&t.is_long_list_view)return true;if("list"===_.get(TS,"web.admin.view")&&TS.boot_data.feature_api_admin_page&&(TS.boot_data.page_needs_enterprise||TS.boot_data.feature_api_admin_page_not_ent))return true};var f=function e(t,r){n[t]=r};var p=function e(t){var r=n[t];if(!r){TS.error("Missing arguments for a bound filter");return}if(_.isFunction(r))r=r()||{};r.include_org=c();return r};var h=function e(t){var r=$(t).find(".ts_icon_search");if(r.next().is(t+"_spinner"))return;var n=TS.templates.loading_indicator({id:t.substring(1)+"_spinner"});r.after(n);r.addClass("hidden")};var g=function e(t){$(t).find(".ts_icon_search").removeClass("hidden");$(t+"_spinner").remove()};var S=function e(t){if(a.filter_p)a.filter_p.cancel();if(a.filtered_items)a.filtered_items={};a.filter_last_query=null;a.filter_last_include_org=null;a.members.filter_cursor_mark="";a.members.filter_num_remaining=0;a.members.filter_num_found=0;a.members.filter_scroll_mark=0;a.restricted.filter_cursor_mark="";a.restricted.filter_num_remaining=0;a.restricted.filter_num_found=0;a.restricted.filter_scroll_mark=0;a.deleted.filter_cursor_mark="";a.deleted.filter_num_remaining=0;a.deleted.filter_num_found=0;a.deleted.filter_scroll_mark=0;if(TS.client)$(t).off("scroll.filter").scrollTop(0);else if(TS.web)$(window).off("scroll.filter").scrollTop(0)};var T=function t(r,n,i,s){var o=r.trim();e=o.toLocaleLowerCase();TS.storage.storeFilterState(e);var l=a.filter_last_query!==e||a.filter_last_include_org!==s.include_org||a.filter_last_sort!==s.sort||a.filter_last_sort_dir!==s.sort_dir;if(l){S(i);a.filter_last_query=e;a.filter_last_include_org=s.include_org;if(s.sort)a.filter_last_sort=s.sort;if(s.sort_dir)a.filter_last_sort_dir=s.sort_dir}h(n);var u=function t(){return Promise.resolve().then(function(){return v(a,l,e,s)}).then(function(t){g(n);return b(t,a,l,e,o,n,i,s)}).finally(function(){TS.utility.rAF(function(){if(TS.client)TS.ui.utility.updateClosestMonkeyScroller($(i))})})};if(l)a.filter_p=u();else a.filter_p=a.filter_p.then(u);return a.filter_p};var v=function e(t,r,n,i){var a=r||"active_members"===TS.model.ui_state.tab_name&&t.members.filter_num_remaining;var s=r||"restricted_members"===TS.model.ui_state.tab_name&&t.restricted.filter_num_remaining;var o=r||"disabled_members"===TS.model.ui_state.tab_name&&t.members.filter_num_remaining;if(!a&&!s&&!o)return Promise.resolve(t.filtered_items);var c=_.assign({},i,{restricted:false});t.members.filter_p=a?l(t.members,n,c):Promise.resolve([]);var m=_.assign({},i,{restricted:true});t.restricted.filter_p=s?u(t.restricted,n,m):Promise.resolve([]);var f=_.assign({},i,{include_deleted:2,include_restricted_and_full_members:true});t.deleted.filter_p=o?d(t.deleted,n,f):Promise.resolve([]);return Promise.join(t.members.filter_p,t.restricted.filter_p,t.deleted.filter_p,function(e,n,a){var s=(i.sort?P:TS.members.allocateTeamListMembers)(e.concat(n,a));s.members=_.uniqBy(s.members,function(e){return e.id});s.disabled_members=_.uniqBy(s.disabled_members,function(e){return e.id});s.restricted_members=_.uniqBy(s.restricted_members,function(e){return e.id});s.ultra_restricted_members=_.uniqBy(s.ultra_restricted_members,function(e){return e.id});if(r)t.filtered_items=s;else{t.filtered_items.members.push.apply(t.filtered_items.members,s.members);t.filtered_items.disabled_members.push.apply(t.filtered_items.disabled_members,s.disabled_members);t.filtered_items.deleted_bots.push.apply(t.filtered_items.deleted_bots,s.deleted_bots);t.filtered_items.bots.push.apply(t.filtered_items.bots,s.bots);t.filtered_items.restricted_members.push.apply(t.filtered_items.restricted_members,s.restricted_members);t.filtered_items.ultra_restricted_members.push.apply(t.filtered_items.ultra_restricted_members,s.ultra_restricted_members)}return Promise.resolve(t.filtered_items)})};var b=function e(t,r,n,l,u,d,c,m){if(!t)return;if(_.get(TS,"web.admin"))return TS.web.admin.setLongListAdminListItems({items:t,no_dividers:!!l,query:l,new_query:!!n,num_found:{members:a.members.filter_num_found||0,restricted:a.restricted.filter_num_found||0,disabled:a.deleted.filter_num_found||0},remaining:{members:a.members.filter_num_remaining||0,restricted:a.restricted.filter_num_remaining||0,disabled:a.deleted.filter_num_remaining||0}},function(){T(l,d,c,m)});if(TS.client)i=TS.view.buildLongListTeamListItems(t,!!l);var f=false;if("disabled_members"===TS.model.ui_state.tab_name&&0===(a.deleted.filter_num_found||0))f=true;if("restricted_members"===TS.model.ui_state.tab_name&&0===(a.restricted.filter_num_found||0))f=true;var p=TS.model.user_groups.filter(function(e){return!e.date_delete});if("user_groups"===TS.model.ui_state.tab_name&&0===p.length)f=true;if(f){TS.model.ui_state.tab_name="active_members";TS.storage.storeUIState(TS.model.ui_state);$("#active_members_tab").trigger("click")}var h=$("#active_members_list");if(h.length){h.longListView("setItems",i.active_members_list_items);if(n)h.longListView("scrollToTop")}var g=$("#restricted_members_list");if(g.length){g.longListView("setItems",i.restricted_members_list_items);if(n)g.longListView("scrollToTop")}var S=$("#deleted_members_list");if(S.length){S.longListView("setItems",i.deleted_members_list_items);if(n)S.longListView("scrollToTop")}var v=t.members.concat(t.bots);var b=t.restricted_members.concat(t.ultra_restricted_members);var y=t.disabled_members.concat(t.deleted_bots);var w=[{name:"active",label:TS.i18n.t("full members","members_view")(),matches:v},{name:"restricted",label:TS.i18n.t("multi-channel guests","members_view")(),matches:b},{name:"disabled",label:TS.i18n.t("deactivated accounts","members_view")(),matches:y}];w.forEach(function(e){var t=$("#"+e.name+"_no_results");function r(){var r={query:u,tab:e,active_matches:v,show_active_matches:"active"!==e.name&&v.length>0,restricted_matches:b,show_restricted_matches:"restricted"!==e.name&&b.length>0,disabled_matches:y,show_disabled_matches:"disabled"!==e.name&&y.length>0};var n=TS.templates.team_list_no_results(r);t.removeClass("hidden").html(n);t.find(".clear_members_filter").one("click",function(){TS.members.view.clearFilter(d,c)})}if(e.matches.length>0||!l)t.addClass("hidden").empty();else r()});if(n){if("#team_list_scroller"===c)if(TS.client){var k=$(c);var x=k.find("#team_list_members_wrapper");k.on("scroll.filter",function(){var e=k.scrollTop()+k.height()+o;var t;if("active_members"===TS.model.ui_state.tab_name){if(e<=r.members.filter_scroll_mark)return;t=x.height();if(e>t&&r.members.filter_p&&r.members.filter_p.isResolved()){T(l,d,c,m);r.members.filter_scroll_mark=e}}if("restricted_members"===TS.model.ui_state.tab_name){if(e<=r.restricted.filter_scroll_mark)return;t=x.height();if(e>t&&r.restricted.filter_p&&r.restricted.filter_p.isResolved()){T(l,d,c,m);r.restricted.filter_scroll_mark=e}}})}else if(TS.web)$(window).off("scroll.filter").on("scroll.filter",_.throttle(function(){var e=0;var t=0;var n=0;var u=null;if("active_members"===TS.model.ui_state.tab_name){e=_.parseInt($("#active_members_list > .list_items").css("height"));t=_.reject(i.active_members_list_items,{is_divider:true}).length;n=r.members.filter_num_remaining;u=r.members.filter_p}if("restricted_members"===TS.model.ui_state.tab_name){e=_.parseInt($("#restricted_members_list > .list_items").css("height"));t=_.reject(i.restricted_members_list_items,{is_divider:true}).length;n=r.restricted.filter_num_remaining;u=r.restricted.filter_p}if("disabled_members"===TS.model.ui_state.tab_name){e=_.parseInt($("#disabled_members_list > .list_items").css("height"));t=_.reject(i.deleted_members_list_items,{is_divider:true}).length;n=r.deleted.filter_num_remaining;u=a.deleted.filter_p}var f=.9*Math.min(t,s);e=_.isNaN(e)?0:e;e-=f*o;if(e&&n&&$(this).scrollTop()>e&&u&&u.isResolved())T(l,d,c,m)},50,{leading:true}));var C=(r.members.filter_num_found||0)+(r.restricted.filter_num_found||0)+(r.deleted.filter_num_found||0);TS.members.view.team_filter_changed_sig.dispatch(u,C)}};var y=function e(t,r,n){var i=[];if(r)i=r.split(/\s*,\s*|\s+/).map(function(e){return"@"===e.charAt("0")?e.substring(1):e}).filter(function(e){return!!e}).map(function(e){if(1===e.length||!n.full_profile_filter){var t=TS.utility.search.makeClause("real_name",e);var r=TS.utility.search.makeClause("display_name",e);var i=TS.utility.search.makeConjunction("OR",[t,r]);return i}return TS.utility.search.makeClause("fuzzy_with_email",e)});i.push(TS.utility.search.makeClause("is","user"));if(n.restricted){var a=TS.utility.search.makeClause("level","restricted");var o=TS.utility.search.makeClause("level","ultra_restricted");i.push(TS.utility.search.makeConjunction("OR",[a,o]))}var l=i.length>1?TS.utility.search.makeConjunction("AND",i):i[0];var u={query:l,count:s,include_bots:n.include_bots,exclude_slackbot:n.exclude_slackbot,include_deleted:n.include_deleted};if(n.sort)u.sort=n.sort;if(n.sort_dir)u.sort_dir=n.sort_dir;if(n.include_org)u.all_of_org=n.include_org;if(t.filter_cursor_mark)u.cursor_mark=t.filter_cursor_mark;if(n.endpoint)u.endpoint=n.endpoint;if(TS.web)u.solr=true;return u};var w=function e(t,r,n){var i=y(t,r,n);i.raw_query=r;return TS.utility.search.promiseToSearch(i).then(function(i){if(!t.filter_num_remaining){t.filter_num_remaining=i.data.num_found;t.filter_num_found=i.data.num_found}t.filter_num_remaining-=i.data.items.length;t.filter_cursor_mark=i.data.next_cursor_mark;if(!i.data.items.length)return Promise.resolve([]);var a=i.data.items.map(function(e){var t=TS.members.getMemberById(e.id);if(!t||!_.isEqual(t,e))t=TS.members.upsertMember(e).member;return t});if(!n.restricted&&!n.include_restricted_and_full_members)a=a.filter(function(e){return!e.is_restricted});if(a.length)return Promise.resolve(a);if(t.filter_num_remaining)return e(t,r,n);return Promise.resolve([])})};var k=function r(n,i,a,s){var o=$(i);var l=n.trim();e=l.toLocaleLowerCase();var u=o.data("list-items-id");var d=$(u);var _=d.find(".member_item:not(.clone)");var c=_.filter(".active");var m=d.find(".member_item.clone");var f=d.find(".filter_header");var p=!TS.web&&"#team_filter"===i;var h={};var g;var S;var T;TS.storage.storeFilterState(e);var v=false;var b;if(A&&"#team_filter"===i)b=d.find(".tab_pane.selected");if(!b&&!TS.web&&"#team_filter"===i)b=$("#team_list_members");if(b&&b.length)b.addClass("hidden");if(v){g=_.parent();S=document.activeElement?$(document.activeElement):null;_.detach()}if(t[a]){t[a].detachEvents();delete t[a]}m.remove();f.remove();c.removeClass("active");d.find(".no_results").addClass("hidden");if(v){g.append(_);if(S)S.focus()}var y;if(A&&"invites"===TS.web.admin.view){var w=[];var k=[];var x=[];$.each(_,function(e,t){var r;t=$(t);r=t.data("invite-id");h[r]=t});k=E(TS.web.admin.pending_invites,e).name||[];x=E(TS.web.admin.accepted_invites,e).name||[];w=k.concat(x);if(w.length>0){$.each(w,function(e,t){if(t&&t.member&&t.member.id&&h[t.member.id])h[t.member.id].addClass("active")});if(a)$(a).trigger("resize")}y=[{name:"pending",label:TS.i18n.t("pending invitations","members_view")(),matches:k},{name:"accepted",label:TS.i18n.t("accepted invitations","members_view")(),matches:x}];y.forEach(function(e){var t=$("#"+e.name+"_no_results");if(e.matches.length>0){t.addClass("hidden").empty();return}var r={query:l,tab:e,pending_matches:k,show_pending_matches:"pending"!==e.name&&k.length>0,accepted_matches:x,show_accepted_matches:"accepted"!==e.name&&x.length>0};var n=TS.templates.team_list_no_results(r);t.removeClass("hidden").html(n);t.find(".clear_members_filter").on("click",function(){TS.members.view.clearFilter(i,a)})});T=w}else{var C;var M=[];var P=[];var F=[];if(A)if(!n.length)C=TS.web.admin.getMembersForUser();else C=TS.members.getMembersForUser();else C=TS.members.getMembersForUser();$(".restricted_header, .bot_header, .ra_invite_prompt, .restricted_info").toggleClass("hidden",!!e);$.each(_,function(e,t){var r;t=$(t);r=t.data("member-id");h[r]=t});w=E(C,e,s.full_profile_filter);var O=Object.keys(w);if(O.length>0){I(w,O,h,F,P,M,p?a:"");if(a){var B=$(a);B.trigger("resize");TS.ui.utility.updateClosestMonkeyScroller(B)}}else if("#file_member_filter"===i){d.find(".query").text(l);d.find(".no_results").removeClass("hidden")}if("#team_filter"===i){y=[{name:"active",label:TS.i18n.t("full members","members_view")(),matches:M},{name:"restricted",label:TS.i18n.t("multi-channel guests","members_view")(),matches:P},{name:"disabled",label:TS.i18n.t("deactivated accounts","members_view")(),matches:F}];y.forEach(function(e){var t=$("#"+e.name+"_no_results");function r(){var r={query:l,tab:e,active_matches:M,show_active_matches:"active"!==e.name&&M.length>0,restricted_matches:P,show_restricted_matches:"restricted"!==e.name&&P.length>0,disabled_matches:F,show_disabled_matches:TS.web&&"disabled"!==e.name&&F.length>0};var n=TS.templates.team_list_no_results(r);t.removeClass("hidden").html(n);t.find(".clear_members_filter").on("click",function(){TS.members.view.clearFilter(i,a)})}if(e.matches.length>0){t.addClass("hidden").empty();return}r()})}T=M.concat(P,F)}if(b&&b.length)b.removeClass("hidden");TS.ui.utility.updateClosestMonkeyScroller($(a));TS.members.view.team_filter_changed_sig.dispatch(l,T.length)};var x=function e(t){return r[t]||t};var C=function e(t,r){var n=document.createElement("div");var i=document.createElement("strong");n.classList.add("filter_header");i.appendChild(document.createTextNode(t));if(r.length)i.appendChild(document.createTextNode(": "));n.appendChild(i);r.forEach(function(e,t){n.appendChild(e);if(t<r.length-1)n.appendChild(document.createTextNode(", "))});return n};var M=function e(t,r){var n=document.createElement("span");var i=document.createElement("strong");var a=t.split(r);i.appendChild(document.createTextNode(r));n.appendChild(document.createTextNode(a.shift()));n.appendChild(i);n.appendChild(document.createTextNode(a.join(r)));return n};var I=function e(n,i,a,s,o,l,u){var d=$(u);var _=document.createDocumentFragment();var c=document.createDocumentFragment();var m=document.createDocumentFragment();var f;var p;var h;var g=A&&TS.web.admin.isSubsetCase();i.sort(function(e,t){return TS.i18n.sorter(r[e],r[t])}).forEach(function(e){var t=document.createDocumentFragment();var r=document.createDocumentFragment();var i=document.createDocumentFragment();var u=[];var d=[];var S=[];var T={};var v={};var b={};if(g)if(!h){h=$("#active_members > div:first-of-type");p=$("#restricted_members > div:first-of-type");f=$("#disabled_members > div:first-of-type")}n[e].forEach(function(n){var _=n.member;var c;var m=false;if(_&&_.id){c=a[_.id];if(!c&&g){c=$(TS.web.admin.buildMemberHTML(_,false,false));m=true}if(c)if("name"===e&&!m)c.addClass("active");else if(_.deleted){if(!f)f=c.parent();if(n.value&&!T[n.value])T[n.value]=u.push(M(n.value,n.match));t.appendChild(c.clone().addClass("active clone").get(0))}else if(_.is_restricted){if(!p)p=c.parent();if(n.value&&!v[n.value])v[n.value]=d.push(M(n.value,n.match));r.appendChild(c.clone().addClass("active clone").get(0))}else{if(!h)h=c.parent();if(n.value&&!b[n.value])b[n.value]=S.push(M(n.value,n.match));i.appendChild(c.clone().addClass("active clone").get(0))}if(_.deleted)s.push(_);else if(_.is_restricted)o.push(_);else l.push(_)}});if(t.childNodes&&t.childNodes.length){_.appendChild(C(x(e),u));_.appendChild(t)}if(r.childNodes&&r.childNodes.length){c.appendChild(C(x(e),d));c.appendChild(r)}if(i.childNodes&&i.childNodes.length){m.appendChild(C(x(e),S));m.appendChild(i)}t=null;r=null;i=null;u=null;d=null;S=null;T=null;v=null;b=null});if(f)f.append(_);if(p)p.append(c);if(h)h.append(m);if(d.length){var S=d.find(".member_item.clone");t[u]=S.find(".lazy").lazyload({container:d,ignore_when_hidden_element:d,all_images_same_size:true});S.one("remove",function(){if(t[u]){t[u].detachEvents();delete t[u]}})}if(g){if(TS.web.admin.lazyload&&TS.web.admin.lazyload.detachEvents){TS.web.admin.lazyload.detachEvents();TS.web.admin.lazyload=null}if(!TS.web.admin.lazyload)TS.web.admin.lazyload=$("#admin_list").find(".lazy").lazyload()}_=null;c=null;m=null;f=null;p=null;h=null};var P=function e(t){return _.reduce(t,function(e,t){if(t.deleted)if(t.is_bot)e.deleted_bots.push(t);else e.disabled_members.push(t);else if(t.is_ultra_restricted)e.ultra_restricted_members.push(t);else if(t.is_restricted)e.restricted_members.push(t);else if(t.is_bot||t.is_slackbot)e.bots.push(t);else e.members.push(t);return e},{members:[],disabled_members:[],deleted_bots:[],bots:[],restricted_members:[],ultra_restricted_members:[]})};var A;var E=function e(t,n,i){var a=new RegExp("^"+TS.utility.regexpEscape(n),"i");var s=new RegExp("(-|_|\\+|\\s|\\.|@)"+TS.utility.regexpEscape(n),"i");var o={};var l=i&&n?TS.team.getVisibleTeamProfileFields():[];r={title:"What I Do",name:"Name"};t.forEach(function(e){var t;t=e._real_name_lc&&(e._real_name_lc.match(a)||e._real_name_lc.match(s))||e.email&&(e.email.match(a)||e.email.match(s))||e.profile&&e.profile.email&&(e.profile.email.match(a)||e.profile.email.match(s))||e.profile&&e.profile.real_name_normalized&&(e.profile.real_name_normalized.match(a)||e.profile.real_name_normalized.match(s))||e.profile&&e.profile.real_name&&(e.profile.real_name.match(a)||e.profile.real_name.match(s))||e.profile&&e.profile.display_name_normalized&&(e.profile.display_name_normalized.match(a)||e.profile.display_name_normalized.match(s))||e.profile&&e.profile.preferred_name&&(e.profile.preferred_name.match(a)||e.profile.preferred_name.match(s));if(t){if(!o.name)o.name=[];o.name.push({member:e})}if(i&&n){t=e.profile&&e.profile.title&&(e.profile.title.match(a)||e.profile.title.match(s));if(t){if(!o.title)o.title=[];o.title.push({member:e})}}if(l.length&&e.profile&&e.profile.fields)l.forEach(function(n){var i=e.profile.fields[n.id];if(!i)return;t=null;if("user"===n.type){if(i.value){var l="";i.value.split(/\s*,\s*/).some(function(e){l=TS.members.getPrefCompliantMemberNameById(e,false);return l.match(a)||l.match(s)});if(t){if(!o[n.id])o[n.id]=[];o[n.id].push({member:e,value:l,match:t[0]})}}}else{t=i.value&&(i.value.match(a)||i.value.match(s));if(t){if(!o[n.id])o[n.id]=[];o[n.id].push({member:e,value:i.value,match:t[0]})}else{t=i.alt&&(i.alt.match(a)||i.alt.match(s));if(t){if(!o[n.id])o[n.id]=[];o[n.id].push({member:e,value:i.alt,match:t[0]})}}}if(t&&!r[n.id])r[n.id]=n.label})});return o}})()},4788:function(e,t){var r="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};(function(){TS.registerModule("prefs",{all_notifications_prefs_changed_sig:new signals.Signal,highlight_words_changed_sig:new signals.Signal,seen_welcome_2_changed_sig:new signals.Signal,emoji_mode_changed_sig:new signals.Signal,obey_inline_img_limit_changed_sig:new signals.Signal,messages_theme_changed_sig:new signals.Signal,expand_inline_imgs_changed_sig:new signals.Signal,expand_internal_inline_imgs_changed_sig:new signals.Signal,expand_non_media_attachments_changed_sig:new signals.Signal,webapp_spellcheck_changed_sig:new signals.Signal,color_names_in_list_changed_sig:new signals.Signal,search_only_my_channels_changed_sig:new signals.Signal,search_exclude_channels_changed_sig:new signals.Signal,search_exclude_bots_changed_sig:new signals.Signal,search_only_current_team_changed_sig:new signals.Signal,box_enabled_changed_sig:new signals.Signal,dropbox_enabled_changed_sig:new signals.Signal,read_changed_sig:new signals.Signal,push_changed_sig:new signals.Signal,time24_changed_sig:new signals.Signal,sidebar_behavior_changed_sig:new signals.Signal,dtop_notif_changed_sig:new signals.Signal,muted_channels_changed_sig:new signals.Signal,mac_ssb_bullet_changed_sig:new signals.Signal,team_hide_referers_changed_sig:new signals.Signal,sidebar_theme_changed_sig:new signals.Signal,no_invites_widget_in_sidebar_changed_sig:new signals.Signal,no_omnibox_in_channels_changed_sig:new signals.Signal,k_key_omnibox_auto_hide_count_changed_sig:new signals.Signal,display_real_names_override_changed_sig:new signals.Signal,team_display_real_names_changed_sig:new signals.Signal,team_perms_pref_changed_sig:new signals.Signal,privacy_policy_seen_changed_sig:new signals.Signal,two_factor_update_seen_changed_sig:new signals.Signal,compliance_export_start_changed_sig:new signals.Signal,team_disallow_public_file_urls_changed_sig:new signals.Signal,msg_preview_changed_sig:new signals.Signal,mentions_exclude_at_channels_changed_sig:new signals.Signal,mentions_exclude_at_user_groups_changed_sig:new signals.Signal,team_auth_mode_changed_sig:new signals.Signal,team_sso_auth_restrictions_changed_sig:new signals.Signal,team_posts_migrating_changed_sig:new signals.Signal,preferred_skin_tone_changed_sig:new signals.Signal,separate_private_channels_changed_sig:new signals.Signal,separate_shared_channels_changed_sig:new signals.Signal,whats_new_read_changed_sig:new signals.Signal,team_dnd_enabled_changed_sig:new signals.Signal,team_dnd_start_hour_changed_sig:new signals.Signal,team_dnd_end_hour_changed_sig:new signals.Signal,team_invites_only_admins_changed_sig:new signals.Signal,tz_changed_sig:new signals.Signal,keyboard_changed_sig:new signals.Signal,msg_input_send_btn_changed_sig:new signals.Signal,msg_input_send_btn_auto_set_changed_sig:new signals.Signal,team_allow_calls_changed_sig:new signals.Signal,team_calling_app_name_changed_sig:new signals.Signal,team_calling_app_id_changed_sig:new signals.Signal,frecency_jumper_changed_sig:new signals.Signal,jumbomoji_changed_sig:new signals.Signal,hide_hex_swatch_changed_sig:new signals.Signal,channel_sort_changed_sig:new signals.Signal,show_memory_instrument_changed_sig:new signals.Signal,enable_unread_view_changed_sig:new signals.Signal,measure_css_usage_changed_sig:new signals.Signal,enable_react_emoji_picker_changed_sig:new signals.Signal,team_disable_file_editing_changed_sig:new signals.Signal,team_disable_file_deleting_changed_sig:new signals.Signal,team_display_email_addresses_changed_sig:new signals.Signal,all_unreads_sort_order_changed_sig:new signals.Signal,email_alerts_changed_sig:new signals.Signal,team_uses_customized_custom_status_presets_changed_sig:new signals.Signal,team_loud_channel_mentions_limit_changed_sig:new signals.Signal,locale_changed_sig:new signals.Signal,enable_shared_channels_changed_sig:new signals.Signal,a11y_animations_changed_sig:new signals.Signal,prefs_loaded:false,setPrefs:function e(t){var r=TS.prefs.getPref("muted_channels");TS.redux.prefs.setUserPrefs(t);TS.prefs.prefs_loaded=true;TS.prefs.mergeEmojiUse(TS.prefs.getPref("emoji_use"));TS.prefs.mergeFrecencyJumper(TS.ui.frecency.isEnterprise()?TS.prefs.getPref("frecency_ent_jumper"):TS.prefs.getPref("frecency_jumper"));TS.prefs.setUserColors(TS.prefs.getPref("user_colors"));TS.prefs.setLoudChannels(TS.prefs.getPref("loud_channels"));TS.prefs.setSuppressedChannels(TS.prefs.getPref("at_channel_suppressed_channels"));TS.prefs.setPushSuppressedChannels(TS.prefs.getPref("push_at_channel_suppressed_channels"));TS.prefs.setNeverChannels(TS.prefs.getPref("never_channels"));TS.prefs.setMutedChannels(TS.prefs.getPref("muted_channels"),r);TS.prefs.setLoudChannelsSet(TS.prefs.getPref("loud_channels_set"));TS.prefs.setPushLoudChannels(TS.prefs.getPref("push_loud_channels"));TS.prefs.setPushMentionChannels(TS.prefs.getPref("push_mention_channels"));TS.prefs.setPushLoudChannelsSet(TS.prefs.getPref("push_loud_channels_set"));TS.prefs.setSearchExcludeChannels(TS.prefs.getPref("search_exclude_channels"));TS.prefs.setChannelSort(TS.prefs.getPref("channel_sort"));TS.prefs.setSidebarThemeCustomValues(TS.utility.parseJSONOrElse(TS.prefs.getPref("sidebar_theme_custom_values"),void 0));TS.emoji.setEmojiMode();TS.prefs.setTheme();TS.prefs.setPrefLocal("emoji_autocomplete_big",false);TSSSB.call("runFromTray",!!TS.prefs.getPref("winssb_run_from_tray"));TSSSB.call("windowFlashBehavior",TS.prefs.getPref("winssb_window_flash_behavior"))},setChannelSort:function e(t){TS.model.channel_sort=t},setHighlightWords:function e(t){TS.prefs.setPrefLocal("highlight_words",t);TS.model.highlight_words=[];TS.model.highlight_words.push("<@"+TS.model.user.id);if(t&&"string"===typeof t)TS.model.highlight_words=TS.model.highlight_words.concat(t.split(","));TS.model.highlight_words_regex=null},setSuppressedChannels:function e(t){TS.prefs.setPrefLocal("at_channel_suppressed_channels",t);TS.model.at_channel_suppressed_channels=[];if(t&&"string"===typeof t)TS.model.at_channel_suppressed_channels=TS.model.at_channel_suppressed_channels.concat(t.split(","))},setPushSuppressedChannels:function e(t){TS.prefs.setPrefLocal("push_at_channel_suppressed_channels",t);TS.model.push_at_channel_suppressed_channels=[];if(t&&"string"===typeof t)TS.model.push_at_channel_suppressed_channels=TS.model.push_at_channel_suppressed_channels.concat(t.split(","))},setLoudChannels:function e(t){TS.prefs.setPrefLocal("loud_channels",t);TS.model.loud_channels=[];if(t&&"string"===typeof t)TS.model.loud_channels=TS.model.loud_channels.concat(t.split(","))},setNeverChannels:function e(t){TS.prefs.setPrefLocal("never_channels",t);TS.model.never_channels=[];if(t&&"string"===typeof t)TS.model.never_channels=TS.model.never_channels.concat(t.split(","))},setMutedChannels:function t(r,n){var i;if(!n)n=TS.prefs.getPref("muted_channels");if(n!==r||!e){i=TS.prefs.getPref("muted_channels")&&"string"===typeof TS.prefs.getPref("muted_channels")?TS.prefs.getPref("muted_channels").split(","):[];TS.prefs.setPrefLocal("muted_channels",r)}else return;e=true;var a;var s;var o=[];var l=[];if(r&&"string"===typeof r){o=o.concat(r.split(","));l=_.difference(i,o)}for(a=0;a<o.length;a+=1){s=TS.shared.getModelObById(o[a]);if(!s)continue;if(!s.unread_cnt)continue;s._show_in_list_even_though_no_unreads=true}TS.model.channels.forEach(function(e){if(TS.notifs.isCorGMuted(e.id))return;e._show_in_list_even_though_no_unreads=false});TS.model.groups.forEach(function(e){if(TS.notifs.isCorGMuted(e.id))return;e._show_in_list_even_though_no_unreads=false});TS.redux.channels.updateMutedChannels(o);return l},setLoudChannelsSet:function e(t){TS.prefs.setPrefLocal("loud_channels_set",t);TS.model.loud_channels_set=[];if(t&&"string"===typeof t)TS.model.loud_channels_set=TS.model.loud_channels_set.concat(t.split(","))},setPushLoudChannels:function e(t){TS.prefs.setPrefLocal("push_loud_channels",t);TS.model.push_loud_channels=[];if(t&&"string"===typeof t)TS.model.push_loud_channels=TS.model.push_loud_channels.concat(t.split(","))},setPushMentionChannels:function e(t){TS.prefs.setPrefLocal("push_mention_channels",t);TS.model.push_mention_channels=[];if(t&&"string"===typeof t)TS.model.push_mention_channels=TS.model.push_mention_channels.concat(t.split(","))},setPushLoudChannelsSet:function e(t){TS.prefs.setPrefLocal("push_loud_channels_set",t);TS.model.push_loud_channels_set=[];if(t&&"string"===typeof t)TS.model.push_loud_channels_set=TS.model.push_loud_channels_set.concat(t.split(","))},setSearchExcludeChannels:function e(t){TS.prefs.setPrefLocal("search_exclude_channels",t);TS.model.search_exclude_channels=[];if(t&&"string"===typeof t)TS.model.search_exclude_channels=TS.model.search_exclude_channels.concat(t.split(","))},mergeFrecencyJumper:function e(t){if(!t||"object"!==("undefined"===typeof t?"undefined":r(t)))t=TS.utility.parseJSONOrElse(t||null)||{};TS.model.frecency_jumper=t;return true},mergeEmojiUse:function e(t){if(!TS.model.emoji_names||!TS.model.emoji_names.length)TS.emoji.makeMenuLists();if(!t||"object"!==("undefined"===typeof t?"undefined":r(t))){t=TS.utility.parseJSONOrElse(t||null)||{};t=_.pickBy(t,function(e,t){return _.includes(TS.model.emoji_names,t)})}var n=false;for(var i in t)if(!TS.model.emoji_use.hasOwnProperty(i)||t[i]>TS.model.emoji_use[i]){TS.model.emoji_use[i]=t[i];n=true}if(!n){if(TS.has_pri[777])TS.log(777,"mergeEmojiUse TS.model.emoji_use unchanged");return false}if(TS.has_pri[777])TS.dir(777,TS.model.emoji_use,"mergeEmojiUse TS.model.emoji_use set to:");return true},setUserColors:function e(t){TS.prefs.setPrefLocal("user_colors",t);var r=t?JSON.parse(t):{};TS.model.user_colors=r||{}},setTheme:function e(){if("default"===TS.prefs.getPref("messages_theme"))TS.prefs.setPrefLocal("messages_theme","light_with_avatars");TS.prefs.setPrefLocal("theme","light");TS.prefs.setPrefLocal("avatars",true);if("dense"===TS.prefs.getPref("messages_theme")){TS.prefs.setPrefLocal("theme","dense");TS.prefs.setPrefLocal("avatars",false)}else if("light"===TS.prefs.getPref("messages_theme")){TS.prefs.setPrefLocal("theme","light");TS.prefs.setPrefLocal("avatars",false)}else if("light_with_avatars"===TS.prefs.getPref("messages_theme")){TS.prefs.setPrefLocal("theme","light");TS.prefs.setPrefLocal("avatars",true)}},onTeamPrefChanged:function e(t){if("msg_edit_window_mins"===t.name)TS.prefs.setTeamPrefLocal("msg_edit_window_mins",t.value);else if("allow_message_deletion"===t.name)TS.prefs.setTeamPrefLocal("allow_message_deletion",!!t.value);else if("hide_referers"===t.name){TS.prefs.setTeamPrefLocal("hide_referers",!!t.value);TS.prefs.team_hide_referers_changed_sig.dispatch()}else if("display_real_names"===t.name){TS.prefs.setTeamPrefLocal("display_real_names",!!t.value);TS.prefs.team_display_real_names_changed_sig.dispatch()}else if("display_email_addresses"===t.name){TS.prefs.setTeamPrefLocal("display_email_addresses",!!t.value);TS.prefs.team_display_email_addresses_changed_sig.dispatch()}else if(0===t.name.indexOf("who_can_")){if(TS.prefs.getTeamPref(t.name)!=t.value){TS.prefs.setTeamPrefLocal(t.name,t.value);TS.prefs.team_perms_pref_changed_sig.dispatch(t.name)}}else if("compliance_export_start"===t.name){if(TS.prefs.getTeamPref("compliance_export_start")!=t.value){TS.prefs.setTeamPrefLocal("compliance_export_start",t.value);TS.prefs.compliance_export_start_changed_sig.dispatch()}}else if("disallow_public_file_urls"===t.name){TS.prefs.setTeamPrefLocal("disallow_public_file_urls",!!t.value);TS.prefs.team_disallow_public_file_urls_changed_sig.dispatch()}else if("auth_mode"===t.name){TS.prefs.setTeamPrefLocal("auth_mode",t.value);TS.prefs.team_auth_mode_changed_sig.dispatch()}else if("sso_auth_restrictions"===t.name){TS.prefs.setTeamPrefLocal("sso_auth_restrictions",t.value);TS.prefs.team_sso_auth_restrictions_changed_sig.dispatch()}else if("posts_migrating"===t.name){TS.prefs.setTeamPrefLocal("posts_migrating",t.value);TS.prefs.team_posts_migrating_changed_sig.dispatch()}else if("dnd_enabled"===t.name){TS.prefs.setTeamPrefLocal("dnd_enabled",t.value);TS.prefs.team_dnd_enabled_changed_sig.dispatch()}else if("dnd_start_hour"===t.name){TS.prefs.setTeamPrefLocal("dnd_start_hour",t.value);TS.prefs.team_dnd_start_hour_changed_sig.dispatch()}else if("dnd_end_hour"===t.name){TS.prefs.setTeamPrefLocal("dnd_end_hour",t.value);TS.prefs.team_dnd_end_hour_changed_sig.dispatch()}else if("invites_only_admins"===t.name){TS.prefs.setTeamPrefLocal("invites_only_admins",t.value);TS.prefs.team_invites_only_admins_changed_sig.dispatch()}else if("allow_calls"===t.name){TS.prefs.setTeamPrefLocal("allow_calls",t.value);TS.prefs.team_allow_calls_changed_sig.dispatch()}else if("calling_app_id"===t.name){TS.prefs.setTeamPrefLocal("calling_app_id",t.value);TS.prefs.team_calling_app_id_changed_sig.dispatch()}else if("calling_app_name"===t.name){TS.prefs.setTeamPrefLocal("calling_app_name",t.value);TS.prefs.team_calling_app_name_changed_sig.dispatch()}else if("disable_file_editing"===t.name){TS.prefs.setTeamPrefLocal("disable_file_editing",t.value);TS.prefs.team_disable_file_editing_changed_sig.dispatch()}else if("disable_file_deleting"===t.name){TS.prefs.setTeamPrefLocal("disable_file_deleting",t.value);TS.prefs.team_disable_file_deleting_changed_sig.dispatch()}else if("who_can_post_general"===t.name){TS.prefs.setTeamPrefLocal(t.name,t.value);var r=TS.channels.getGeneralChannel().id;if(TS.permissions.members.canPostInGeneral())TS.channels.read_only.removeChannelFromList(r);else TS.channels.read_only.addChannelToList(r)}else if("uses_customized_custom_status_presets"===t.name){TS.prefs.setTeamPrefLocal(t.name,t.value);TS.prefs.team_uses_customized_custom_status_presets_changed_sig.dispatch()}else if("loud_channel_mentions_limit"===t.name){TS.prefs.setTeamPrefLocal(t.name,t.value);TS.prefs.team_loud_channel_mentions_limit_changed_sig.dispatch()}else if("enable_shared_channels"===t.name){TS.prefs.setTeamPrefLocal(t.name,t.value);TS.prefs.enable_shared_channels_changed_sig.dispatch()}else TS.prefs.setTeamPrefLocal(t.name,t.value)},updateTeamPrefCanUserManageSharedChannels:function e(t){TS.prefs.setTeamPrefLocal("can_user_manage_shared_channels",t.can_manage)},getPref:function e(t){return TS.redux.prefs.getUserPref(t)},setPrefLocal:function e(t,r){TS.redux.prefs.setUserPref(t,r)},getTeamPref:function e(t){return TS.redux.prefs.getTeamPref(t)},setTeamPrefLocal:function e(t,r){TS.redux.prefs.setTeamPref(t,r)},setMultiplePrefs:function e(t){TS.redux.prefs.setMultipleUserPrefs(t)},onPrefChanged:function e(t){switch(t.name){case"all_notifications_prefs":TS.prefs.setPrefLocal("all_notifications_prefs",t.value);TS.prefs.all_notifications_prefs_changed_sig.dispatch(t.value);break;case"locale":TS.prefs.setPrefLocal("locale",t.value);TS.prefs.locale_changed_sig.dispatch(t.value);break;case"flannel_server_pool":TS.prefs.setPrefLocal("flannel_server_pool",t.value);break;case"color_names_in_list":TS.prefs.setPrefLocal("color_names_in_list",!!t.value);TS.prefs.color_names_in_list_changed_sig.dispatch();break;case"display_real_names_override":TS.prefs.setPrefLocal("display_real_names_override",t.value);TS.prefs.display_real_names_override_changed_sig.dispatch();break;case"growls_enabled":TS.prefs.setPrefLocal("growls_enabled",!!t.value);TS.prefs.dtop_notif_changed_sig.dispatch();break;case"sidebar_theme":if(TS.prefs.getPref("sidebar_theme")!==t.value){TS.prefs.setPrefLocal("sidebar_theme",t.value);TS.prefs.sidebar_theme_changed_sig.dispatch()}break;case"sidebar_theme_custom_values":if(TS.prefs.getPref("sidebar_theme_custom_values")!==t.value){TS.prefs.setSidebarThemeCustomValues(JSON.parse(t.value));TS.prefs.sidebar_theme_changed_sig.dispatch()}break;case"expand_inline_imgs":TS.prefs.setPrefLocal("expand_inline_imgs",!!t.value);TS.prefs.expand_inline_imgs_changed_sig.dispatch();break;case"webapp_spellcheck":TS.prefs.setPrefLocal("webapp_spellcheck",!!t.value);TS.prefs.webapp_spellcheck_changed_sig.dispatch();break;case"expand_internal_inline_imgs":TS.prefs.setPrefLocal("expand_internal_inline_imgs",!!t.value);TS.prefs.expand_internal_inline_imgs_changed_sig.dispatch();break;case"expand_non_media_attachments":TS.prefs.setPrefLocal("expand_non_media_attachments",!!t.value);TS.prefs.expand_non_media_attachments_changed_sig.dispatch();break;case"messages_theme":TS.prefs.setPrefLocal("messages_theme",t.value);TS.prefs.setTheme();TS.prefs.messages_theme_changed_sig.dispatch();break;case"highlight_words":TS.prefs.setHighlightWords(t.value);TS.prefs.highlight_words_changed_sig.dispatch();break;case"at_channel_suppressed_channels":TS.prefs.setSuppressedChannels(t.value);TS.prefs.dtop_notif_changed_sig.dispatch();break;case"push_at_channel_suppressed_channels":TS.prefs.setPushSuppressedChannels(t.value);TS.prefs.push_changed_sig.dispatch();break;case"loud_channels":TS.prefs.setLoudChannels(t.value);break;case"never_channels":TS.prefs.setNeverChannels(t.value);break;case"muted_channels":var r=TS.prefs.setMutedChannels(t.value);TS.view.prefs.mutedChannelsChanged(r);TS.prefs.muted_channels_changed_sig.dispatch();break;case"loud_channels_set":TS.prefs.setLoudChannelsSet(t.value);TS.prefs.dtop_notif_changed_sig.dispatch();break;case"push_loud_channels":TS.prefs.setPushLoudChannels(t.value);break;case"push_mention_channels":TS.prefs.setPushMentionChannels(t.value);break;case"push_loud_channels_set":TS.prefs.setPushLoudChannelsSet(t.value);TS.prefs.push_changed_sig.dispatch();break;case"emoji_use":if(TS.prefs.mergeEmojiUse(t.value))TS.emoji.maybeRemakeMenuListsIfFrequentsChanged();break;case"user_colors":_.each(_.keys(TS.model.user_colors),function(e){var t=TS.members.getMemberById(e);if(t)TS.members.setMemberUserColor(t,t.color)});TS.prefs.setUserColors(t.value);_.forOwn(TS.model.user_colors,function(e,t){var r=TS.members.getMemberById(t);if(r)TS.members.setMemberUserColor(r,e)});break;case"graphic_emoticons":TS.rxns.clearHandyRxnsDisplayDataCache();TS.prefs.setPrefLocal("graphic_emoticons",t.value);TS.emoji.setEmojiMode();TS.prefs.emoji_mode_changed_sig.dispatch();break;case"ss_emojis":TS.prefs.setPrefLocal("ss_emojis",t.value);TS.emoji.setEmojiMode();TS.prefs.emoji_mode_changed_sig.dispatch();TS.emoji.makeMenuLists();break;case"emoji_mode":TS.rxns.clearHandyRxnsDisplayDataCache();if(TS.useReactMessages())TS.emoji.setEmojiMode(t.value);TS.prefs.setPrefLocal("emoji_mode",t.value);if(!TS.useReactMessages())TS.emoji.setEmojiMode();TS.prefs.emoji_mode_changed_sig.dispatch();TS.emoji.makeMenuLists();break;case"obey_inline_img_limit":TS.prefs.setPrefLocal("obey_inline_img_limit",t.value);TS.prefs.obey_inline_img_limit_changed_sig.dispatch();break;case"search_only_my_channels":TS.prefs.setPrefLocal("search_only_my_channels",!!t.value);TS.prefs.search_only_my_channels_changed_sig.dispatch();break;case"search_only_current_team":TS.prefs.setPrefLocal("search_only_current_team",!!t.value);TS.prefs.search_only_current_team_changed_sig.dispatch();break;case"search_exclude_channels":TS.prefs.setSearchExcludeChannels(t.value);TS.prefs.search_exclude_channels_changed_sig.dispatch();break;case"search_exclude_bots":TS.prefs.setPrefLocal("search_exclude_bots",!!t.value);TS.prefs.search_exclude_bots_changed_sig.dispatch();break;case"has_uploaded":TS.prefs.setPrefLocal("has_uploaded",!!t.value);break;case"has_invited":TS.prefs.setPrefLocal("has_invited",!!t.value);break;case"has_created_channel":TS.prefs.setPrefLocal("has_created_channel",!!t.value);break;case"no_joined_overlays":TS.prefs.setPrefLocal("no_joined_overlays",!!t.value);break;case"no_created_overlays":TS.prefs.setPrefLocal("no_created_overlays",!!t.value);break;case"seen_welcome_2":TS.prefs.setPrefLocal("seen_welcome_2",!!t.value);TS.prefs.seen_welcome_2_changed_sig.dispatch();break;case"box_enabled":TS.prefs.setPrefLocal("box_enabled",!!t.value);TS.prefs.box_enabled_changed_sig.dispatch();break;case"dropbox_enabled":TS.prefs.setPrefLocal("dropbox_enabled",!!t.value);TS.prefs.dropbox_enabled_changed_sig.dispatch();break;case"mark_msgs_read_immediately":if(TS.prefs.getPref("mark_msgs_read_immediately")!==!!t.value){TS.prefs.setPrefLocal("mark_msgs_read_immediately",!!t.value);TS.prefs.read_changed_sig.dispatch()}break;case"start_scroll_at_oldest":if(TS.prefs.getPref("start_scroll_at_oldest")!==!!t.value){TS.prefs.setPrefLocal("start_scroll_at_oldest",!!t.value);TS.prefs.read_changed_sig.dispatch()}break;case"mac_ssb_bullet":if(TS.prefs.getPref("mac_ssb_bullet")!==!!t.value){TS.prefs.setPrefLocal("mac_ssb_bullet",!!t.value);TS.prefs.mac_ssb_bullet_changed_sig.dispatch()}break;case"all_channels_loud":if(TS.prefs.getPref("all_channels_loud")!==!!t.value){TS.prefs.setPrefLocal("all_channels_loud",!!t.value);TS.prefs.dtop_notif_changed_sig.dispatch()}break;case"push_everything":if(TS.prefs.getPref("push_everything")!==!!t.value){TS.prefs.setPrefLocal("push_everything",!!t.value);TS.prefs.push_changed_sig.dispatch()}break;case"push_mention_alert":if(TS.prefs.getPref("push_mention_alert")!==!!t.value){TS.prefs.setPrefLocal("push_mention_alert",!!t.value);TS.prefs.push_changed_sig.dispatch()}break;case"push_dm_alert":if(TS.prefs.getPref("push_dm_alert")!==!!t.value){TS.prefs.setPrefLocal("push_dm_alert",!!t.value);TS.prefs.push_changed_sig.dispatch()}break;case"time24":if(TS.prefs.getPref("time24")!==!!t.value){TS.prefs.setPrefLocal("time24",!!t.value);TS.prefs.time24_changed_sig.dispatch()}break;case"sidebar_behavior":if(TS.prefs.getPref("sidebar_behavior")!=t.value){TS.prefs.setPrefLocal("sidebar_behavior",t.value);TS.prefs.sidebar_behavior_changed_sig.dispatch()}break;case"two_factor_update_seen":if(TS.model.two_factor_update_seen!=t.value){TS.mode.prefs.two_factor_update_seen=t.value;TS.prefs.two_factor_update_seen_changed_sig.dispatch()}break;case"privacy_policy_seen":if(TS.prefs.getPref("privacy_policy_seen")!=t.value){TS.prefs.setPrefLocal("privacy_policy_seen",t.value);TS.prefs.privacy_policy_seen_changed_sig.dispatch()}break;case"last_seen_at_channel_warning":if(TS.prefs.getPref("last_seen_at_channel_warning")!=t.value)TS.prefs.setPrefLocal("last_seen_at_channel_warning",t.value);break;case"msg_preview":if(TS.prefs.getPref("msg_preview")!=t.value){TS.prefs.setPrefLocal("msg_preview",t.value);TS.prefs.msg_preview_changed_sig.dispatch()}break;case"msg_preview_persistent":if(TS.prefs.getPref("msg_preview_persistent")!=t.value){TS.prefs.setPrefLocal("msg_preview_persistent",t.value);TS.prefs.msg_preview_changed_sig.dispatch()}break;case"winssb_run_from_tray":if(TS.prefs.getPref("winssb_run_from_tray")!=t.value){TS.prefs.setPrefLocal("winssb_run_from_tray",t.value);TSSSB.call("runFromTray",!!TS.prefs.getPref("winssb_run_from_tray"))}break;case"winssb_window_flash_behavior":if(TS.prefs.getPref("winssb_window_flash_behavior")!=t.value){TS.prefs.setPrefLocal("winssb_window_flash_behavior",t.value);TSSSB.call("windowFlashBehavior",TS.prefs.getPref("winssb_window_flash_behavior"))}break;case"mentions_exclude_at_channels":if(TS.prefs.getPref("mentions_exclude_at_channels")!=t.value){TS.prefs.setPrefLocal("mentions_exclude_at_channels",t.value);TS.prefs.mentions_exclude_at_channels_changed_sig.dispatch()}break;case"mentions_exclude_at_user_groups":if(TS.prefs.getPref("mentions_exclude_at_user_groups")!=t.value){TS.prefs.setPrefLocal("mentions_exclude_at_user_groups",t.value);TS.prefs.mentions_exclude_at_user_groups_changed_sig.dispatch()}break;case"no_invites_widget_in_sidebar":if(TS.prefs.getPref("no_invites_widget_in_sidebar")!=t.value){TS.prefs.setPrefLocal("no_invites_widget_in_sidebar",t.value);TS.prefs.no_invites_widget_in_sidebar_changed_sig.dispatch()}break;case"no_omnibox_in_channels":if(TS.prefs.getPref("no_omnibox_in_channels")!=t.value){TS.prefs.setPrefLocal("no_omnibox_in_channels",t.value);TS.prefs.no_omnibox_in_channels_changed_sig.dispatch();if(TS.prefs.getPref("no_omnibox_in_channels"))TS.clog.track("QUICKSWITCHER_ACTION",{trigger:"quick_switcher_pref_changed",action:"button_hidden"});else TS.clog.track("QUICKSWITCHER_ACTION",{trigger:"quick_switcher_pref_changed",action:"button_shown"})}break;case"k_key_omnibox_auto_hide_count":if(TS.prefs.getPref("k_key_omnibox_auto_hide_count")!=t.value){TS.prefs.setPrefLocal("k_key_omnibox_auto_hide_count",t.value);TS.prefs.k_key_omnibox_auto_hide_count_changed_sig.dispatch()}break;case"show_sidebar_quickswitcher_button":if(TS.prefs.getPref("show_sidebar_quickswitcher_button")!=t.value)TS.prefs.setPrefLocal("show_sidebar_quickswitcher_button",t.value);break;case"preferred_skin_tone":if(TS.prefs.getPref("preferred_skin_tone")!=t.value){TS.rxns.clearHandyRxnsDisplayDataCache();TS.prefs.setPrefLocal("preferred_skin_tone",t.value);TS.prefs.preferred_skin_tone_changed_sig.dispatch()}break;case"separate_private_channels":if(TS.prefs.getPref("separate_private_channels")!=t.value){TS.prefs.setPrefLocal("separate_private_channels",t.value);TS.prefs.separate_private_channels_changed_sig.dispatch()}break;case"separate_shared_channels":if(TS.prefs.getPref("separate_shared_channels")!=t.value){TS.prefs.setPrefLocal("separate_shared_channels",t.value);TS.prefs.separate_shared_channels_changed_sig.dispatch()}break;case"whats_new_read":if(TS.prefs.getPref("whats_new_read")!=t.value){TS.prefs.setPrefLocal("whats_new_read",t.value);TS.prefs.whats_new_read_changed_sig.dispatch()}break;case"tz":if(TS.prefs.getPref("tz")!=t.value){TS.prefs.setPrefLocal("tz",t.value);TS.prefs.tz_changed_sig.dispatch()}break;case"keyboard":if(TS.prefs.getPref("keyboard")!=t.value){TS.prefs.setPrefLocal("keyboard",t.value);TS.prefs.keyboard_changed_sig.dispatch()}break;case"msg_input_send_btn":if(TS.prefs.getPref("msg_input_send_btn")!=t.value){TS.prefs.setPrefLocal("msg_input_send_btn",t.value);TS.prefs.msg_input_send_btn_changed_sig.dispatch()}break;case"msg_input_send_btn_auto_set":if(TS.prefs.getPref("msg_input_send_btn_auto_set")!=t.value){TS.prefs.setPrefLocal("msg_input_send_btn_auto_set",t.value);TS.prefs.msg_input_send_btn_auto_set_changed_sig.dispatch()}break;case"frecency_jumper":if(TS.ui.frecency.isEnterprise())break;if(TS.prefs.mergeFrecencyJumper(t.value))TS.prefs.frecency_jumper_changed_sig.dispatch();break;case"frecency_ent_jumper":TS.log(666,"Received a pref_change event for frecency_ent_jumper.");if(TS.prefs.mergeFrecencyJumper(t.value))TS.prefs.frecency_jumper_changed_sig.dispatch();break;case"jumbomoji":if(TS.prefs.getPref("jumbomoji")!=t.value){TS.prefs.setPrefLocal("jumbomoji",t.value);TS.prefs.jumbomoji_changed_sig.dispatch()}break;case"hide_hex_swatch":if(TS.prefs.getPref("hide_hex_swatch")!=t.value){TS.prefs.setPrefLocal("hide_hex_swatch",t.value);TS.prefs.hide_hex_swatch_changed_sig.dispatch()}break;case"a11y_animations":if(TS.prefs.getPref("a11y_animations")!==t.value){TS.prefs.setPrefLocal("a11y_animations",t.value);TS.prefs.a11y_animations_changed_sig.dispatch();if(TS.client)TS.clog.track("PREF_USER_CLIENT_UPDATE",{a11y_animations:TS.prefs.getPref("a11y_animations")})}break;case"show_memory_instrument":if(TS.prefs.getPref("show_memory_instrument")!==t.value){TS.prefs.setPrefLocal("show_memory_instrument",t.value);TS.prefs.show_memory_instrument_changed_sig.dispatch()}break;case"channel_sort":if(TS.prefs.getPref("channel_sort")!==t.value){TS.prefs.setPrefLocal("channel_sort",t.value);TS.prefs.setChannelSort(TS.prefs.getPref("channel_sort"));TS.prefs.channel_sort_changed_sig.dispatch()}break;case"enable_unread_view":if(TS.prefs.getPref("enable_unread_view")!==t.value){TS.prefs.setPrefLocal("enable_unread_view",t.value);TS.prefs.enable_unread_view_changed_sig.dispatch()}break;case"measure_css_usage":if(TS.prefs.getPref("measure_css_usage")!==t.value){TS.prefs.setPrefLocal("measure_css_usage",t.value);TS.prefs.measure_css_usage_changed_sig.dispatch()}break;case"enable_react_emoji_picker":if(TS.prefs.getPref("enable_react_emoji_picker")!==t.value){TS.prefs.setPrefLocal("enable_react_emoji_picker",t.value);TS.prefs.enable_react_emoji_picker_changed_sig.dispatch()}break;case"client_logs_pri":TS.prefs.setPrefLocal(t.name,t.value);TS.console.setAppropriatePri();break;case"email_alerts":TS.prefs.setPrefLocal(t.name,t.value);TS.prefs.email_alerts_changed_sig.dispatch();break;default:TS.prefs.setPrefLocal(t.name,t.value)}},hex_regex:new RegExp(/^#?([0-9a-f]{6})$/i),setSidebarThemeCustomValues:function e(t){var n=false;if(t&&"object"===("undefined"===typeof t?"undefined":r(t))&&void 0===t.length)_.forOwn(t,function(e,r){n=false;if(!e)return false;if(!e.substr)return false;t[r]=e.substr(0,7);if(!e.match(TS.prefs.hex_regex))return false;n=true});if(n)TS.prefs.setPrefLocal("sidebar_theme_custom_values",JSON.stringify(t));else{TS.prefs.setPrefLocal("sidebar_theme","default");TS.prefs.setPrefLocal("sidebar_theme_custom_values",JSON.stringify(TS.sidebar_themes.default_themes.default_theme))}},setMultiPrefsByAPI:function e(t,r){var n="";_.forOwn(t,function(e,t){n+="&"+encodeURIComponent(t)+"="+encodeURIComponent(e)});if(!n){TS.error(" no prefs to set?");return}var i={prefs:n};return TS.prefs.setPrefByAPI(i,r)},setPrefByAPI:function e(t,r){return TS.api.callImmediately("users.prefs.set",t).then(function(e){var t=true;var n=e.data,i=e.args;if(r)return r(t,n,i)}).catch(function(e){var t=e.args;var r;if(t.hasOwnProperty("name"))r="pref name: "+t.name;else if(t.prefs)r="(multiple prefs)";TS.logError(r,"TS.prefs.setPrefByAPI call got a not ok rsp","API response error");setTimeout(function(){if(t.prefs)TS.error("multi preferences setting failed.");else TS.error('"'+t.name+'" preference setting failed.')},0)})},setTeamPrefByAPI:function e(t,r,n){return TS.api.callImmediately("team.prefs.set",{prefs:JSON.stringify(t)}).then(function(e){var r=e.data;if(TS.web){n=n||[];var i=Object.keys(t).concat(n);i.forEach(function(e){if(r.prefs.hasOwnProperty(e))if(t.hasOwnProperty(e)||TS.prefs.getTeamPref(e)!==r.prefs[e])TS.prefs.onTeamPrefChanged({name:e,value:r.prefs[e]})})}return Promise.resolve(r.prefs)}).catch(function(e){var t=e.data;if(r)r(t);return Promise.reject(t)})},saveHighlightWords:function e(r,n,i){var a=t(r);if(i||TS.notifs.getGlobalHighlightWords()!=a){n=n||_.noop;return TS.notifs.setGlobalHighlightWords(a).then(n)}return Promise.resolve()},getReadStateTrackingPref:function e(){var t="default";if(TS.prefs.getPref("mark_msgs_read_immediately")&&TS.prefs.getPref("start_scroll_at_oldest"))t="immediate_scroll";else if(TS.prefs.getPref("mark_msgs_read_immediately"))t="immediate";return t},setReadStateTrackingPref:function e(t,r){var n={};if("immediate_scroll"===t||"immediate"===t){n.mark_msgs_read_immediately=true;TS.prefs.setPrefLocal("mark_msgs_read_immediately",true);if("immediate_scroll"===t){n.start_scroll_at_oldest=true;TS.prefs.setPrefLocal("start_scroll_at_oldest",true)}else{n.start_scroll_at_oldest=false;TS.prefs.setPrefLocal("start_scroll_at_oldest",false)}}else{n.mark_msgs_read_immediately=false;TS.prefs.setPrefLocal("mark_msgs_read_immediately",false);n.start_scroll_at_oldest=false;TS.prefs.setPrefLocal("start_scroll_at_oldest",false)}TS.prefs.setMultiPrefsByAPI(n,r)},removeTeamFromEnterpriseExcluedTeamPref:function e(t){if(!TS.boot_data.page_needs_enterprise)return;var r=TS.prefs.getPref("enterprise_excluded_app_teams");if(!r)return;var n=r?r.split(","):[];_.pull(n,t);TS.prefs.setPrefByAPI({name:"enterprise_excluded_app_teams",value:n.join(",")})},test:function e(){return{_cleanHighlightWords:t}}});var e=false;var t=function e(t){if(!_.isString(t))return"";t=TS.format.replaceUnicodeDoppelgangers(t);return _(t).split(",").map(_.trim).compact().join(",")}})()},4789:function(e,t){(function(){TS.registerModule("search",{search_dispatched_sig:new signals.Signal,quick_search_results_fetched_sig:new signals.Signal,all_search_results_fetched_sig:new signals.Signal,message_search_results_fetched_sig:new signals.Signal,file_search_results_fetched_sig:new signals.Signal,autosuggest_search_results_fetched_sig:new signals.Signal,search_filter_set_sig:new signals.Signal,search_filetype_filter_set_sig:new signals.Signal,search_sort_set_sig:new signals.Signal,search_channel_set_sig:new signals.Signal,search_group_set_sig:new signals.Signal,search_member_set_sig:new signals.Signal,message_search_more_results_fetched_sig:new signals.Signal,query:"",query_string:"",query_string_for_display:"",last_search_query:"",previous_query:"",sort:"timestamp",filter:"messages",filetype:"all",results:{},submit_tim:0,delay:500,suggestions:[],input:"",from_regex:/from:[@*\-.\w]+/gi,member:null,from:null,in_regex:/in:[#*\-.\w]+/gi,channel:null,group:null,im:null,per_page:-1,keyword_modifiers:["after","before","bot","during","from","to","has","in","on"],keyword_modifier_pair_regex:null,keyword_modifier_extract_regex:null,search_query_max_length:250,skip_next_search:false,onStart:function e(){TS.search.keyword_modifier_pair_regex=new RegExp("^("+TS.search.keyword_modifiers.join("|")+"):\\S+$");TS.search.keyword_modifier_extract_regex=new RegExp("^("+TS.search.keyword_modifiers.join("|")+"):\\w*");TS.search.per_page=parseInt(TS.qs_args.search_count,10)||20;if(TS.client)TS.search.delay=10;if(TS.client)TS.client.login_sig.add(TS.search.loggedIn,TS.search);else if(TS.web)TS.web.login_sig.add(TS.search.loggedIn,TS.search);TS.search.search_channel_set_sig.add(TS.search.searchAll,TS.search);TS.search.search_group_set_sig.add(TS.search.searchAll,TS.search);TS.search.search_member_set_sig.add(TS.search.searchAll,TS.search);TS.prefs.search_only_my_channels_changed_sig.add(TS.search.searchAll,TS.search);TS.prefs.search_only_current_team_changed_sig.add(TS.search.searchAll,TS.search);TS.prefs.search_exclude_bots_changed_sig.add(TS.search.searchAll,TS.search);TS.files.team_file_changed_sig.add(f);if(TS.qs_args.delay)TS.search.delay=TS.qs_args.delay;TS.search.input=$("#search_terms");var t=[];if(!TS.search.autocomplete||!TS.search.autocomplete.unifiedAutocompleteIsEnabled())t=["members"];if(TS.search.sliFileSearchIsEnabled())TS.search.filter="all";TS.utility.contenteditable.create(TS.search.input,{modules:{slacksearch:true,tabcomplete:{completers:t,isSearchInput:true,matchOptions:{allowed_preceding_symbols:[":"]},searchOptions:{include_deleted:true},onEnter:function e(){TS.search.submitSearch();TS.search.autocomplete.triggerInputEvent("on-enter")},positionMenu:function e(t){var r=$(TS.search.input);var n=r.offset();var i=355;var a=31;var s=i-r.outerWidth();var o=n.left-s+a;var l=12;var u=n.top+r.height()+l;t.style.width=i+"px";t.style.top=u+"px";t.style.left=o+"px"},render:function e(t,r,n){var i=_.filter(n,function(e){if(e.is_usergroup)return false;return true});var a=_.remove(i,function(e){return e.deleted});var s={menu_type:"user",noResults:!i&&!a,users:i,users_deleted:a,show_ja_modifier_subtitle:TS.boot_data.feature_show_ja_modifier_subtitle&&"ja-JP"==TS.i18n.locale()};return TS.templates.search_menu(s)},onRender:function e(){TS.tips.texty.hide();TS.utility.rAF(function(){$("#chat_input_tab_ui").addClass("search_menu");p()})}}},singleLineInput:true,placeholder:TS.i18n.t("Search","page_client")(),onFocus:function e(){$("#client-ui").addClass("search_focused");TS.utility.contenteditable.setCursorAtEnd(TS.search.input);TS.search.autocomplete.setUpMenu();TS.search.autocomplete.onInputFocus();TS.search.autocomplete.triggerInputEvent("focus")},onBlur:function e(){$("#client-ui").removeClass("search_focused");TS.search.autocomplete.maybeLogSearchInputBlur();TS.search.autocomplete.triggerInputEvent("blur")},onEnter:function e(){TS.search.autocomplete.triggerInputEvent("on-enter");if(!TS.search.skip_next_search)TS.search.submitSearch();TS.search.skip_next_search=false;return true},onTextChange:function e(){var t=TS.utility.contenteditable.isEmpty(TS.search.input);$("#header_search_form").toggleClass("active",!t);TS.search.autocomplete.triggerInputEvent("input")},onEscape:function e(){if(!$(".search_menu").is(":visible"))TS.utility.contenteditable.blur(TS.search.input);TS.search.autocomplete.triggerInputEvent("on-escape")},onTab:function e(){TS.search.autocomplete.triggerInputEvent("on-tab");return true}})},loggedIn:function e(){TS.search.sort="timestamp"},startSearchTimer:function e(t,r,n,i){clearTimeout(TS.search.submit_tim);TS.search.submit_tim=setTimeout(TS.search.dispatchSearch,TS.search.delay,t,r,n,i);TS.search.search_dispatched_sig.dispatch()},getNextPageOfSearchResults:function e(t,r,n){TS.search.dispatchSearch(t,r,TS.search.per_page,TS.search.onSearchAll,n)},getNextPageOfMessageResults:function e(t,r,n){u("search.messages",t,r,TS.search.per_page,n,d)},getNextPageOfFileResults:function e(t,r,n){u("search.files",t,r,TS.search.per_page,n,c)},extractNonModifierSearchTxt:function e(t){var r="";var n=t.split(" ");n.forEach(function(e){if(e.match(TS.search.keyword_modifier_extract_regex))return;r+=" "+e});r=$.trim(r);return r},dispatchSearch:function e(t,r,n,i,a){if(TS.isPartiallyBooted()){if(!l){var s=this;var o=function e(){TS.search.dispatchSearch.apply(s,l);l=void 0};TS.redux.socket.connectedSig.addOnce(o)}l=arguments;return}if(!a||1===a){var d=TS.search.extractNonModifierSearchTxt(t);if(d)TSSSB.call("writeFindString",d)}TS.search.updateSessionsUponSearch();if(TS.search.separateMessagesAndFiles()){if(!a||1===a)TS.search.results[t]=null;var _=m();u("search.messages",t,r,n,a,_.msgs);u("search.files",t,r,n,a,_.files)}else u("search.all",t,r,n,a,i)},setFilter:function e(t){TS.search.filter=t;TS.search.search_filter_set_sig.dispatch()},setFiletypeFilter:function e(t){TS.search.filetype=t;TS.search.search_filetype_filter_set_sig.dispatch()},getModuleSort:function e(){if("files"==TS.search.filter)return"auto";if("messages"==TS.search.filter)return TS.search.sort;return null},getLastRequestId:function e(){if("files"==TS.search.filter)return TS.search.last_files_request_id;if("messages"==TS.search.filter)return TS.search.last_request_id;return null},hasCachedRelevantResults:function e(){return("messages"===TS.search.filter||"all"===TS.search.filter)&&_.has(TS.search.results[TS.search.query].messages,"modules.score")},hasCachedRecentResults:function e(){return("messages"===TS.search.filter||"all"===TS.search.filter)&&_.has(TS.search.results[TS.search.query].messages,"timestamp_messages")},switchToRelevant:function e(t){var r=TS.search.results[TS.search.query].messages;TS.search.results[TS.search.query].messages=r.modules.score;TS.search.results[TS.search.query].messages.timestamp_messages=r;TS.search.results[TS.search.query].messages.order=0;TS.search.search_sort_set_sig.dispatch(t);TS.search.view.renderResults(true)},switchToRecent:function e(){TS.search.results[TS.search.query].messages=TS.search.results[TS.search.query].messages.timestamp_messages;TS.search.view.renderResults(true)},topResultsFeedback:function e(t,r){var n=[":bow:"];if("top_results_useful"===r){var i=Math.floor(5*Math.random())+2;n=[":tada:",":raised_hands::skin-tone-"+i+":"]}var a=n[Math.floor(Math.random()*n.length)];$(t).closest(".top_results_feedback").html("Thanks for your feedback! "+TS.emoji.graphicReplace(a));TS.clog.track("SEARCH_FEEDBACK",{search_feedback_value:r,request_id:TS.search.last_request_id,search_session_id:TS.search.getSearchSessionId()})},setSort:function e(t,r){if(TS.search.sort===t)return;$(".search_toggle").toggleClass("active");TS.search.sort=t;TS.search.search_sort_set_sig.dispatch();if("score"!==t&&"model"!==t)t="timestamp";TS.prefs.setPrefByAPI({name:"search_sort",value:t});if("timestamp"===t&&TS.search.hasCachedRecentResults())TS.search.switchToRecent();else if("score"===t&&TS.search.hasCachedRelevantResults())TS.search.switchToRelevant();else if(!r)TS.search.searchAll()},setChannel:function e(t){var r=TS.channels.getChannelById(t);if(r){TS.search.channel=r;TS.search.group=null;TS.search.im=null}else TS.search.channel=null;TS.search.search_channel_set_sig.dispatch()},setGroup:function e(t){var r=TS.groups.getGroupById(t);if(r){TS.search.group=r;TS.search.channel=null;TS.search.im=null}else TS.search.group=null;TS.search.search_group_set_sig.dispatch()},setMember:function e(t){var r=TS.members.getMemberById(t);if(r)TS.search.member=r;else{TS.search.member=null;TS.search.from=null;var n=TS.utility.contenteditable.value(TS.search.input).trim();var i=n.match(TS.search.from_regex);if(i){$.each(i,function(e,t){n=$.trim(n.replace(t,""))});TS.utility.contenteditable.value(TS.search.input,n)}}TS.search.search_member_set_sig.dispatch()},searchAll:function e(t){if(!TS.client)clearTimeout(TS.search.widget.key_tim);TS.search.previous_query=TS.search.query;if(t)TS.search.query_string=_.trim(t);else TS.search.query_string=_.trim(TS.utility.contenteditable.value(TS.search.input));TS.search.query=TS.format.texty.convertContentsStringForEncodedMembers(TS.search.query_string);TS.search.query_string_for_display=TS.format.texty.convertContentsStringToDisplayString(TS.search.query_string);if(TS.search.query_string){if(TS.search.sliFileSearchIsEnabled()&&!TS.search.view.searchIsVisible())TS.search.view.renderResults();TS.search.startSearchTimer(TS.search.query,TS.search.query_string,TS.search.per_page,TS.search.onSearchAll)}else{TS.search.view.updateOptions();if(TS.client)TS.search.autocomplete.stopSpinner();else TS.search.widget.stopSpinner()}},onSearchAll:function e(t,r,n){if("1"===TS.qs_args.force_search_fail){window.failed_once=true;t=false;r={ok:false,error:"solr_failed"}}if(!t){var i=r&&r.error?r.error:"unknown_error";if(!r)r={ok:false,error:i};r.query=r.query||n.query;r.messages=r.messages||{total:0,paging:{count:TS.search.per_page,total:0,page:1,pages:0},matches:[]};r.files=r.files||{total:0,paging:{count:TS.search.per_page,total:0,page:1,pages:0},matches:[]}}if(n.query!==TS.search.query)if(!TS.search.results[n.query]||!TS.search.results[n.query].error)return;TS.search.last_search_query=n.query;if(TS.client)TS.search.upsertFiles(r);TS.search.expandChannelsAndCheckForMsgsInModel(r);if(1===n.page){TS.search.results[n.query]=r;TS.search.results[n.query]._time_of_search=Date.now();TS.search.all_search_results_fetched_sig.dispatch(r,n);TS.search.getNextPageOfSearchResults(n.query,n.query_string,2)}else{var a=TS.search.results[n.query];if(a.messages.matches)r.messages.matches=a.messages.matches.concat(r.messages.matches);if(a.files.matches)r.files.matches=a.files.matches.concat(r.files.matches);TS.search.results[n.query]=r;TS.search.all_search_results_fetched_sig.dispatch(r,n)}},searchSuggest:function e(t){var r=TS.search.getQuerySessionId();var n=(new Date).getTime();TS.api.call("search.autocomplete",{query:t,client_request_id:r,search_session_id:TS.search.getSearchSessionId()}).then(function(e){var t=e.data,i=e.args,a=e.request_id;var s=true;if(TS.search.onSearchSuggest)TS.search.onSearchSuggest(s,t,i,a);TS.clog.track("SEARCH_AUTOCOMPLETE",{client_request_id:r,search_session_id:TS.search.getSearchSessionId(),request_duration_ms:(new Date).getTime()-n});return{data:t,args:i,request_id:a}}).catch(function(e){var t=e.data,r=e.args,n=e.request_id;var i=false;if(TS.search.onSearchSuggest)TS.search.onSearchSuggest(i,t,r,n);return{data:t,args:r,request_id:n}})},onSearchSuggest:function e(t,r,n,i){if(!TS.client)if(TS.search.widget.suppress_suggestions){TS.search.widget.suppress_suggestions=false;return}if(!t)return;TS.search.suggestions=[];if(r.suggestions[0]===TS.search.query&&1===r.suggestions.length)TS.search.suggestions=[];else{var a=/<@([^>]+)>/gi;var s=[];r.suggestions.forEach(function(e){e.replace(a,function(e,t){s.push(t)})});s=_.uniq(s);TS.members.ensureMembersArePresent(s).then(function(){for(var e=0;e<r.suggestions.length;e+=1){var t=r.suggestions[e];t=t.replace(a,function(e,t){var r=TS.members.getMemberById(t);if(r)return TS.format.texty.getMemberAsContentsString(r);return e});TS.search.suggestions[e]={value:t,highlighted:TS.search.highlightSuggestion(_.escape(t))};r.suggestions[e]=t}TS.search.autosuggest_search_results_fetched_sig.dispatch(r,n,i)})}},highlightSuggestion:function e(t){var r=TS.utility.contenteditable.value(TS.search.input);var n=new RegExp("("+TS.utility.preg_quote(r)+")","gi");var i=t.replace(n,"<b>$1</b>");return i},expandChannelsAndCheckForMsgsInMatch:function e(t){var r;var n=t.channel.id;var i;o(t,n);s.forEach(function(e){if(!t[e])return;o(t[e],n)});i=TS.rxns.getExistingRxnsByKey(t._rxn_key);if(i&&!t.reactions)TS.warn("msg:"+t.ts+" has reactions in local model, but we got an object in search results that does NOT have reactions, which seems suspicious");else TS.rxns.upsertRxnsFromDataAndUpdateUI(t._rxn_key,t.reactions);r=TS.shared.getModelObById(n);if(r){if("im"===t.type&&!TS.ims.isImWithDeletedMember(r))t.im_exists=true;if(r.msgs)t.is_loaded=!!TS.utility.msgs.getMsg(t.ts,r.msgs);else if(TS.client)TS.warn(r.id+" has no msgs");t.channel=r;if(!t.permalink)t.permalink=TS.utility.msgs.constructMsgPermalink(r,t.ts)}},expandChannelsAndCheckForMsgsInModel:function e(t){var r;var n;if(!t.messages||!t.messages.matches)return;for(n=0;n<t.messages.matches.length;n+=1){r=t.messages.matches[n];if(!r)continue;TS.search.expandChannelsAndCheckForMsgsInMatch(r)}if(t.messages.modules&&t.messages.modules.score){for(n=0;n<t.messages.modules.score.matches.length;n+=1){r=t.messages.modules.score.matches[n];if(!r)continue;TS.search.expandChannelsAndCheckForMsgsInMatch(r)}if(t.messages.modules.score.top_results)for(n=0;n<t.messages.modules.score.top_results.length;n+=1){r=t.messages.modules.score.top_results[n];if(!r)continue;TS.search.expandChannelsAndCheckForMsgsInMatch(r)}}},upsertFiles:function e(t){if(!t.files||!t.files.matches)return;for(var r=0;r<t.files.matches.length;r+=1){if(t.files.matches[r].preview){t.files.matches[r].preview_search=t.files.matches[r].preview;delete t.files.matches[r].preview}t.files.matches[r]=TS.files.upsertFile(t.files.matches[r]).file}},getResultsByQuery:function e(t){return TS.search.results[t]},getMatchByQueryAndTs:function e(t,r){return TS.search.getMatchByQueryByThings(t,r)},getMatchByQueryAndChannelAndTs:function e(t,r,n){return TS.search.getMatchByQueryByThings(t,n,r)},getMatchByQueryAndChannelAndTsAndModule:function e(t,r,n,i,a){var s=TS.search.getResultsByQuery(r);if(!s){TS.error("WTF no results?");return null}if(!s.messages.modules){TS.error("WTF no results.messages.modules?");return null}if(!s.messages.modules[a])TS.error("WTF no results.messages.modules."+a+"?");var o;for(var l=0;l<s.messages.modules[a].top_results.length;l+=1){o=s.messages.modules[a].top_results[l];if(!o){TS.error("WTF no match?");continue}if((!n||o.channel.id===n)&&o.ts===i){if(t)return{match:o,index:l};return o}}return null},getMatchByQueryByThings:function e(t,r,n){var i=TS.search.getResultsByQuery(t);if(!i){TS.error("WTF no results?");return null}return TS.search.getMatchFromResultsByThings(true,i,r,n)},getMatchFromResultsByThings:function e(t,r,n,i){if(!r){TS.error("WTF no results?");return null}if(!r.messages){TS.error("WTF no results.messages?");return null}if(!r.messages.matches){TS.error("WTF no results.messages.matches?");return null}var a;for(var s=0;s<r.messages.matches.length;s+=1){a=r.messages.matches[s];if(!a){TS.error("WTF no match?");continue}if((!i||a.channel.id===i)&&a.ts===n){if(t)return{match:a,index:s};return a}}return null},truncateQuery:function e(t){if(t.length>TS.search.search_query_max_length)return t.substring(0,TS.search.search_query_max_length);return t},resetSearchOptions:function e(){TS.search.channel=null;TS.search.group=null;TS.search.im=null;TS.search.member=null;TS.search.from=null;TS.search.searchAll()},saveSearch:function e(t,r){if(!t.terms)return;t.terms=$.trim(t.terms);if(TS.search.keyword_modifier_pair_regex.test(t.terms))return;TS.api.call("search.save",t).then(function(e){var t=e.data,n=e.args,i=e.request_id;var a=true;if(r)r(a,t,n,i);return{data:t,args:n,request_id:i}}).catch(function(e){var t=e.data,n=e.args,i=e.request_id;var a=false;if(r)r(a,t,n,i);return{data:t,args:n,request_id:i}})},separateMessagesAndFiles:function e(){return!!TS.client},setInputVal:function e(t){TS.utility.contenteditable.value(TS.search.input,t);TS.utility.contenteditable.focus(TS.search.input)},submitSearch:function e(){TS.search.input.closest("form").trigger("submit")},searchSessionExpired:function r(){var n=e;e=new Date;return n&&Date.now()-n>t},querySessionExpired:function e(){return TS.search.searchSessionExpired()},getSearchSessionId:function e(){if(null==r||TS.search.searchSessionExpired())r=TS.utility.uuidv4();return r},getQuerySessionId:function e(){if(null==i||TS.search.querySessionExpired())i=TS.utility.uuidv4();return i},getSearchSessionIdForResults:function t(){if(TS.search.getSearchSessionId()==n)e=new Date;return n},getQuerySessionIdForResults:function e(){return a},querySessionEnd:function e(){i=null},searchSessionEnd:function e(){r=null;TS.search.querySessionEnd()},updateSessionsUponSearch:function e(){a=TS.search.getQuerySessionId();n=TS.search.getSearchSessionId();TS.search.querySessionEnd()},debugQuery:function e(t,r){var n="/mc/search_eval_query.php?team_id="+t+"&user_id="+r+"&query="+encodeURIComponent(TS.search.query);window.open(n)},debugFileQuery:function e(t,r){var n="/mc/search_eval_file_query.php?team_id="+t+"&user_id="+r+"&active_cid="+TS.model.active_cid+"&query="+encodeURIComponent(TS.search.query);window.open(n)},getSort:function e(t){return"search.files"===t?"auto":TS.search.sort},sliFileSearchIsEnabled:function e(){return TS.boot_data.feature_sli_file_search&&"sli_file_search"===TS.boot_data.sli_file_search}});var e;var t=3e5;var r=null;var n=null;var i=null;var a=null;var s=["next","next_2","previous","previous_2"];var o=function e(t,r){t._rxn_key=TS.rxns.getRxnKey("message",t.ts,r);TS.utility.msgs.processAttachments(t.attachments);if(t.extracts&&t.extracts.length)t.extracts.forEach(function(e){e._rxn_key=t._rxn_key})};var l;var u=function e(t,r,n,i,a,s){var o=t.replace(".","_");var l="start_dispatch_"+o;TS.metrics.mark(l);var u=a||1;var d={query:TS.emoji.maybeGetCanonicalEmojiString(r),query_string:n,highlight:true,count:i,types:[TS.search.filetype],sort:TS.search.getSort(t),page:u,extracts:1,extra_message_data:1,max_extract_len:150,highlight_attachments:1,active_cid:TS.model.active_cid,top_results:1==u?1:0,experts:1==u?1:0,locale:TS.i18n.localeOrPseudo(),search_tab_open:"search"==TS.model.ui.active_tab_id,search_tab_filter:TS.search.filter,search_tab_sort:TS.search.getModuleSort(TS.search.filter),client_req_id:TS.search.getQuerySessionIdForResults(),search_session_id:TS.search.getSearchSessionIdForResults()};if("search.all"===t)d.no_posts=1;if("search.files"!==t)d.more_matches=true;if(TS.boot_data.page_needs_enterprise&&TS.boot_data.enterprise_api_token){d.enterprise_token=TS.boot_data.enterprise_api_token;if("search.messages"===t)d.team=TS.model.team.id}if(TS.boot_data.feature_search_skip_context)d.skip_context=1;TS.api.call(t,d).then(function(e){var t=e.data,r=e.args,n=e.request_id;TS.metrics.measure(o+"_response",l);var i=true;if(s)s(i,t,r,n);return{data:t,args:r,request_id:n}}).catch(function(e){var t=e.data,r=e.args,n=e.request_id;var i=false;if(s)s(i,t,r,n);return{data:t,args:r,request_id:n}})};var d=function e(t,r,n,i){if(!t||!r.messages){var a=r&&r.error?r.error:"unknown_error";if(!r)r={ok:false,error:a};r.query=r.query||n.query;r.messages=r.messages||{total:0,paging:{count:TS.search.per_page,total:0,page:1,pages:0},matches:[]}}r.query=TS.emoji.maybeGetLocalizedEmojiString(r.query);n.query=TS.emoji.maybeGetLocalizedEmojiString(n.query);if(n.query!==TS.search.query)if(!TS.search.results[n.query]||!TS.search.results[n.query].error)return;if(TS.search.last_search_query!==n.query)delete TS.search.results[TS.search.last_search_query];TS.search.last_search_query=n.query;TS.search.last_request_id=i;TS.search.expandChannelsAndCheckForMsgsInModel(r);var s=TS.search.results[n.query];if(1==n.page){if(!s){TS.search.results[n.query]=r;s=r}else $.extend(s,r);s.initial_messages_total=r.messages.total;s.messages.pages=[{start:0,count:_.get(r.messages,"matches.length",0)}];if(_.has(s,"messages.modules.score.matches"))s.messages.modules.score.pages=[{start:0,count:_.get(s.messages.modules.score,"matches.length",0)}];s._time_of_search=Date.now();TS.search.message_search_results_fetched_sig.dispatch(s,n)}else{if(s.messages&&s.messages.matches){r.messages.matches=s.messages.matches.concat(r.messages.matches);r.messages.pages=s.messages.pages.concat([{start:s.messages.matches.length,count:_.get(r.messages,"matches.length",0)}])}$.extend(s,r);TS.search.message_search_results_fetched_sig.dispatch(s,n)}};var c=function e(t,r,n,i){if(!t||!r.files){var a=r&&r.error?r.error:"unknown_error";if(!r)r={ok:false,error:a};r.query=r.query||n.query;r.files=r.files||{total:0,paging:{count:TS.search.per_page,total:0,page:1,pages:0},matches:[]}}r.query=TS.emoji.maybeGetLocalizedEmojiString(r.query);n.query=TS.emoji.maybeGetLocalizedEmojiString(n.query);if(n.query!==TS.search.query)if(!TS.search.results[n.query]||!TS.search.results[n.query].error)return;if(TS.search.last_search_query!==n.query)delete TS.search.results[TS.search.last_search_query];TS.search.last_search_query=n.query;TS.search.last_files_request_id=i;if(TS.client)TS.search.upsertFiles(r);var s=TS.search.results[n.query];if(1===n.page){if(!s){TS.search.results[n.query]=r;s=r}else $.extend(s,r);s.initial_files_total=r.files.total;s._time_of_search=Date.now();TS.search.file_search_results_fetched_sig.dispatch(s,n)}else{if(s.files&&s.files.matches)r.files.matches=s.files.matches.concat(r.files.matches);$.extend(s,r);TS.search.file_search_results_fetched_sig.dispatch(s,n)}};var m=function e(){var t=false;var r=false;var n=function e(){if(t&&r)TS.search.all_search_results_fetched_sig.dispatch()};return{msgs:function e(){t=true;d.apply(this,arguments);n()},files:function e(){r=true;c.apply(this,arguments);n()}}};var f=function e(t){TS.files.updateFileListItem(t,$("#search_results_items"))};var p=function e(){var t=$(".reveal_hidden_items");t.one("click enter",function(e){var r=$(".results .deleted");if(r){e.stopPropagation();r.removeClass("deleted");t.remove()}})}})()},4790:function(e,t){var r="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};(function(){TS.registerModule("ms.msg_handlers",{getMsgHandlers:function e(){return TS.ms.msg_handlers},onStart:function e(){I=window.performance&&TS.boot_data&&TS.boot_data.feature_ms_msg_handlers_profiling;Y=TS.utility.enableFeatureForUser(1);if(TS.client&&TS.client.stats){TS.client.stats.start_collecting_sig.add(function(){n=TS.boot_data.feature_queue_metrics&&TS.utility.enableFeatureForUser(N);j.enableStatsCollecting()});TS.client.stats.stop_collecting_sig.add(function(){n=false;j.disableStatsCollecting()})}if(TS.web&&!TS.web.space)return;if(!TS.boot_data.feature_modern_rtm_dispatch)TS.redux.socket.socketMessageReceivedSig.add(TS.ms.msg_handlers.msgReceived);TS.redux.socket.connectedSig.add(function(){if(!TS.boot_data.feature_tinyspeck)return;if(u)clearTimeout(u);u=setTimeout(function(){if(!TS.redux.socket.isConnected())return;if(o.length<50)return;var e=o[0];setTimeout(function(){if(o[0]!==e)return;var t=_.compact([o[0].type,o[0].subtype]).join(".");TS.warn("Looks like our msg_handlers queue might be wedged (it has "+o.length+" items in it, first one of type "+t+"). Kicking it.");var r=new Error("msg_handlers_queue_stuck_v2");TS.console.logError(r,"size = "+o.length+", first item = "+t)},1e4)},3e4)})},debugGetQueueSize:function e(){if(TS.boot_data.feature_modern_rtm_dispatch){TS.console.warn("TS.ms.msg_handlers.debugGetQueueSize() is deprecated; start using TS.interop.rtm.debugGetPendingMessages() instead");return TS.interop.rtm.debugGetPendingMessages().length}return o.length},msgReceived:function e(t){if(TS.boot_data.feature_modern_rtm_dispatch)return;if(I){D+=1;if(!H)H=Date.now()}if(t.reply_to)return;if(!TS.ms.msg_handlers[t.type])return;c(t)},message:function e(t){if(!TS.client)return;if(TS.has_pri[U])TS.log(U,"recved message type "+t.type);if(t.is_ephemeral&&!t.ts)t.ts=TS.interop.datetime.makeTsStamp();var r;var n="subtype__"+t.subtype;if(n in TS.ms.msg_handlers){if(TS.boot_data.feature_channel_eventlog_client){if("message_changed"===t.subtype||"message_deleted"===t.subtype||"channel_history_changed"===t.subtype||"group_history_changed"===t.subtype||"im_history_changed"===t.subtype||"mpim_history_changed"===t.subtype||"message_replied"===t.subtype){t.type=t.subtype;delete t.subtype;if(I)r=j.start(t.type);TS.ms.msg_handlers[t.type](t);if(r)r();return}if(t.hidden){TS.error(2,"WE SHOULD NOT BE GETTING ANY HIDDEN MESSAGES ANYMORE");TS.console.dir(2,0,t)}}if(I)r=j.start(n);TS.ms.msg_handlers[n](t);if(r)r()}if(I)r=j.start(t.type);var i=TS.utility.msgs.processImsg(t,t.channel);if(TS.ims.getImById(t.channel)){if("start_profile_AAAAAA"===t.text)TS.model.profiling_keys=true;else if("end_profile_AAAAAA"===t.text){TS.model.profiling_keys=false;if(TS.model.profiling_key_times){TS.files.upload({text:JSON.stringify(TS.model.profiling_key_times,null,"\t"),title:"auto profile",filetype:"javascript",channels:[t.channel],initial_comment:""});delete TS.model.profiling_key_times}}TS.ims.addMsg(t.channel,i)}else if(TS.mpims.getMpimById(t.channel))TS.mpims.addMsg(t.channel,i);else if(TS.groups.getGroupById(t.channel))TS.groups.addMsg(t.channel,i);else TS.channels.addMsg(t.channel,i);var a=TS.shared.getModelObById(t.channel);var s=TS.members.getMemberById(i.user);if(TS.typing&&s&&a)TS.typing.memberEnded(a,s);if(r)r()},subtype__file_share:function e(t){if(!t.file)return;if(t.file.id==TS.files.polling_file_id)TS.files.uploadProcessingOver(true,t.file.id)},message_changed:function e(t){if(TS.has_pri[U])TS.log(U,"recved message type "+t.type);TS.ms.msg_handlers.message_changed_worker(t)},subtype__message_changed:function e(t){if(TS.has_pri[U])TS.log(U,"recved subtype "+t.subtype);if(TS.boot_data.feature_channel_eventlog_client)TS.warn("feature_channel_eventlog_client=1 so we should never be getting subtype "+t.subtype);TS.ms.msg_handlers.message_changed_worker(t)},message_changed_worker:function e(t){if(!t.message){TS.error("no message?");return}TS.mentions.replaceMsg(t.message);var r=TS.shared.getModelObById(t.channel);if(!r){TS.error("unknown imsg.channel:"+t.channel);return}if(TS.pins)TS.pins.replaceMsg(t.message,r);if(t.message.imgs||TS.utility.msgs.hasImgs(t.message))TS.model.show_inline_img_size_pref_reminder=true;var n=true;TS.utility.msgs.replaceMsg(r,t.message,n)},message_deleted:function e(t){if(TS.has_pri[U])TS.log(U,"recved message type "+t.type);TS.ms.msg_handlers.message_deleted_worker(t)},subtype__message_deleted:function e(t){if(TS.has_pri[U])TS.log(U,"recved subtype "+t.subtype);if(TS.boot_data.feature_channel_eventlog_client)TS.warn("feature_channel_eventlog_client=1 so we should never be getting subtype "+t.subtype);TS.ms.msg_handlers.message_deleted_worker(t)},message_deleted_worker:function e(t){if(!t.deleted_ts){TS.error("no deleted_ts?");return}TS.mentions.removeMsg(t.deleted_ts);var r=TS.channels.getChannelById(t.channel);var n;var i;var a;if(!r)n=TS.ims.getImById(t.channel);if(!r&&!n)a=TS.mpims.getMpimById(t.channel);if(!r&&!n&&!a)i=TS.groups.getGroupById(t.channel);if(!n&&!r&&!a&&!i){TS.error("unknown imsg.channel:"+t.channel);return}var s=n||r||a||i;if(TS.pins)TS.pins.removeMsg(t.deleted_ts,s);var o=TS.utility.msgs.getMsg(t.deleted_ts,s.msgs);if(!o&&s._archive_msgs)o=TS.utility.msgs.getMsg(t.deleted_ts,s._archive_msgs);if(!o)o=TS.client.unread.getMessage(s,t.deleted_ts);if(!o)o=TS.ui.replies.getActiveMessage(s,t.deleted_ts);if(!o)o=TS.client.threads.getMessage(s,t.deleted_ts);if(TS.useReactMessages()){TS.redux.messages.removeMessage({channel:t.channel,ts:t.deleted_ts},t._from_evt_log);TS.redux.messages.recordDeletedMessage(t.channel,t.deleted_ts)}if(!o)return;if(n)TS.ims.removeMsg(s.id,o);else if(r)TS.channels.removeMsg(s.id,o);else if(a)TS.mpims.removeMsg(s.id,o);else if(i)TS.groups.removeMsg(s.id,o)},subtype__sh_room_created:function e(t){if(!t.room)return;TS.dir(441,t)},subtype__sh_room_shared:function e(t){if(!t.room)return;TS.dir(441,t)},channel_left:function e(t){TS.info("You left channel "+t.channel);var r=TS.channels.getChannelById(t.channel);if(!r){if(!TS.channels.temp_list_of_removed_channels[t.channel])TS.error('unknown channel: "'+t.channel);return}r.is_member=false;if(TS.model.active_channel_id==t.channel&&!r.was_archived_this_session)if(TS.client)TS.client.activeChannelDisplayGoneAway();TS.channels.calcUnreadCnts(r,true);TS.members.invalidateMembersUserCanSeeArrayCaches();TS.channels.left_sig.dispatch(r)},member_left_channel:function e(t){var r;var n=t.user;var i;if("C"===t.channel_type){r=TS.channels.getChannelById(t.channel);if(r){if(!r.is_member){TS.info(n+" left channel "+t.channel+" but we are not a member; ignoring");return}TS.info(n+" left channel "+t.channel);t.no_display=TS.utility.msgs.shouldHideChannelJoinOrLeaveMsg(t,r);var a=!t.no_display;var s=false;var o=TS.membership.setUserChannelMembership(n,r,s);if(o)TS.membership.notifyChannelMembershipChanged(n,r,s,a);if(o&&!TS.model.user.is_admin){i=TS.members.getMemberById(n);if(TS.utility.teams.isMemberExternal(i)&&!i.is_stranger)TS.members.removeMembers([i])}}}else if("G"===t.channel_type){r=TS.groups.getGroupById(t.channel);if(r){i=TS.members.getMemberById(n);if(!i){TS.error('unknown member: "'+n+'"');V("member_left_channel");return}K("member_left_channel");TS.info(i.id+" left group "+t.channel);var l=_.findIndex(_.get(r,"members",[]),i.id);if(l>-1){r.members.splice(l,1);TS.groups.calcActiveMembersForGroup(r)}TS.members.invalidateMembersUserCanSeeArrayCaches();TS.groups.member_left_sig.dispatch(r,i)}}},channel_joined:function e(t){TS.info("You joined channel "+t.channel.id);var r=TS.channels.upsertChannel(t.channel);TS.members.invalidateMembersUserCanSeeArrayCaches();TS.channels.joined_sig.dispatch(r)},channel_created:function e(t){if(TS.model.user.is_restricted)return;TS.info("created channel "+t.channel.id);var r=TS.channels.upsertChannel(t.channel);TS.channels.created_sig.dispatch(r)},channel_changed:function e(t){if(!t.channel)return;TS.channels.backfills.updateBackfillingList(t.channel)},channel_updated:function e(t){if(!t.channel){TS.error("No channel id sent");return}var r=TS.channels.getChannelById(t.channel);if(!r){TS.error('unknown channel: "'+t.channel);return}if(!t.updates){TS.error('nothing changed in channel: "'+t.channel);return}var n=t.updates;n.id=t.channel;r=TS.channels.upsertChannel(n);if(TS.shared.isModelObShared(r)&&!TS.shared.isModelObPendingShared(r)){TS.channels.shared_invite_accepted_sig.dispatch(r);var i=TS.shared.getActiveModelOb();if(i.id===r.id)TS.channels.converted_to_shared_sig.dispatch(r)}else if(TS.shared.isModelObPendingShared(r)&&n.pending_shared.length)TS.channels.shared_invite_pending_sig.dispatch(r);else if(!TS.shared.isModelObShared(r)&&!TS.shared.isModelObPendingShared(r))TS.channels.unshared_sig.dispatch(r)},channel_converted_to_shared:function e(t){if(TS.boot_data.feature_channel_updated_event&&!TS.boot_data.page_needs_enterprise)return;if(!t.channel||!t.channel.id){TS.error("No channel info sent");return}var r=TS.channels.getChannelById(t.channel.id);if(!r){TS.error('unknown channel: "'+t.channel.id);return}delete t.channel.is_member;TS.channels.upsertChannel(t.channel);if(r._name_lc!==_.toLower(t.channel.name))TS.channels.channelRenamed(t.channel);var n=TS.shared.getActiveModelOb();if(n.id===r.id)TS.channels.converted_to_shared_sig.dispatch(r)},channel_unshared:function e(t){if(!t.channel||!t.channel.id){TS.error("No channel info sent");return}delete t.channel.is_member;var r=TS.channels.upsertChannel(t.channel);TS.channels.unshared_sig.dispatch(r)},channel_shared_invite_pending:function e(t){if(TS.boot_data.feature_channel_updated_event&&!TS.boot_data.page_needs_enterprise)return;if(!t.channel||!t.channel.id){TS.error("No channel info sent");return}delete t.channel.is_member;var r=TS.channels.upsertChannel(t.channel);TS.channels.shared_invite_pending_sig.dispatch(r)},channel_shared_invite_revoked:function e(t){if(!t.channel||!t.channel.id){TS.error("No channel info sent");return}delete t.channel.is_member;var r=TS.channels.upsertChannel(t.channel);TS.channels.shared_invite_revoked_sig.dispatch(r)},channel_shared_invite_accepted:function e(t){if(TS.boot_data.feature_channel_updated_event&&!TS.boot_data.page_needs_enterprise)return;if(!t.channel||!t.channel.id){TS.error("No channel info sent");return}delete t.channel.is_member;var r=TS.channels.upsertChannel(t.channel);TS.channels.shared_invite_accepted_sig.dispatch(r)},group_converted_to_shared:function e(t){if(!t.group||!t.group.id){TS.error("No group info sent");return}var r=TS.groups.getGroupById(t.group.id);if(!r){TS.error('unknown group: "'+t.group.id);return}if(r.is_member)t.group.is_member=true;TS.groups.upsertGroup(t.group);var n=TS.shared.getActiveModelOb();if(n.id===r.id)TS.groups.converted_to_shared_sig.dispatch(r)},teams_joined_shared_channel:function e(t){if(!TS.boot_data.page_needs_enterprise){TS.error("org-shared channel event sent to non-enterprise team:"+t.channel);return}var r=TS.channels.getChannelById(t.channel);if(!r)r=TS.groups.getGroupById(t.channel);if(!r){TS.error('unknown channel or group: "'+t.channel);return}if(!TS.shared.isModelObOrgShared(r)){TS.error("org-shared channel event sent for non-org-shared channel:"+t.channel);return}if(TS.channels.temp_list_of_removed_channels[r.id])delete TS.channels.temp_list_of_removed_channels[r.id];if(t.is_global_shared)r.is_global_shared=t.is_global_shared;else TS.enterprise.addTeamsToSharedForChannel(r,t.teams);var n=TS.shared.getActiveModelOb();if(!n.id===r.id)return;if(r.is_group)TS.groups.shared_teams_updated_sig.dispatch(r);else TS.channels.shared_teams_updated_sig.dispatch(r)},teams_left_shared_channel:function e(t){if(!TS.boot_data.page_needs_enterprise){TS.error("org-shared channel event sent to non-enterprise team:"+t.channel);return}var r=TS.channels.getChannelById(t.channel);if(!r)r=TS.groups.getGroupById(t.channel);if(!r){TS.error('unknown channel or group: "'+t.channel);return}if(!TS.shared.isModelObOrgShared(r)){TS.error("org-shared channel event sent for non-org-shared channel:"+t.channel);return}if(t.teams.indexOf(TS.model.team.id)<0){if(r.is_group||r.is_private)TS.groups.removeGroup(r);else TS.channels.removeChannel(r);return}TS.enterprise.updateSharesForChannel(r,t.teams,t.is_global_shared);var n=TS.shared.getActiveModelOb();if(!n.id===r.id)return;if(r.is_group)TS.groups.shared_teams_updated_sig.dispatch(r);else TS.channels.shared_teams_updated_sig.dispatch(r)},enterprise_rename:function e(t){var r=t.name;TS.redux.enterprise.updateEnterpriseOrgName(r);var n=$(".team_menu.slack_menu");n.find(".slack_menu_header .current_team_name").text(r);n.find(".menu_list .enterprise_logout_url a strong").text(r);$(".enterprise-name").text(r)},enterprise_team_added:function e(t){if(!t.team||!TS.boot_data.page_needs_enterprise)return;TS.teams.upsertTeam(t.team)},channel_deleted:function e(t){var r=TS.channels.getChannelById(t.channel);if(!r){TS.error('unknown channel: "'+t.channel);return}TS.info("deleted channel "+t.channel);TS.channels.removeChannel(r)},channel_archive:function e(t){if(TS.boot_data.feature_modern_rtm_dispatch)return;var r=TS.channels.getChannelById(t.channel);if(!r){TS.error('unknown channel: "'+t.channel);return}if(r.is_archived)return;TS.info("archived channel "+t.channel);r.is_archived=true;if(t.is_moved)r.is_moved=1===t.is_moved;if(!TS.model.user.is_restricted)if(r.is_member)r.was_archived_this_session=true;TS.channels.archived_sig.dispatch(r)},channel_unarchive:function e(t){var r=TS.channels.getChannelById(t.channel);if(!r){TS.error('unknown channel: "'+t.channel);return}if(!r.is_archived)return;TS.info("unarchived channel "+t.channel);if(r.was_archived_this_session){var n=true;TS.channels.joinById(r.id,null,{in_background:n})}if(t.is_moved)r.is_moved=1===t.is_moved;r.is_archived=false;r.was_archived_this_session=false;TS.channels.unarchived_sig.dispatch(r)},channel_rename:function e(t){var r=TS.channels.getChannelById(t.channel.id);if(!r){TS.error('unknown channel: "'+t.channel);return}TS.info("renamed channel "+t.channel.id);TS.channels.channelRenamed(t.channel)},member_joined_channel:function e(t){var r;var n=t.user;var i;if("C"===t.channel_type){r=TS.channels.getChannelById(t.channel);if(r){if(!r.is_member){TS.info(n+" joined channel "+t.channel+" but we are not a member; ignoring");return}TS.info(n+" joined channel "+t.channel);if(n==TS.model.user.id&&t.inviter){r.needs_invited_message=true;r.inviter=t.inviter}t.no_display=TS.utility.msgs.shouldHideChannelJoinOrLeaveMsg(t,r);var a=!t.no_display;var s=true;var o=TS.membership.setUserChannelMembership(n,r,s);if(o)TS.membership.notifyChannelMembershipChanged(n,r,s,a);if(o&&!TS.model.user.is_admin){i=TS.members.getMemberById(n);if(TS.utility.teams.isMemberExternal(i)&&i.is_stranger)TS.members.removeMembers([i])}}}else if("G"===t.channel_type){r=TS.groups.getGroupById(t.channel);if(r){i=TS.members.getMemberById(n);if(!i){TS.error('unknown member: "'+n+'"');V("member_joined_channel");return}K("member_joined_channel");if(t.is_mpim)return;TS.info(i.id+" joined group "+t.channel);var l=_.findIndex(_.get(r,"members",[]),i.id);if(l<0&&r.members){r.members.push(i.id);TS.groups.calcActiveMembersForGroup(r)}if(i.is_self&&t.inviter){r.needs_invited_message=true;r.inviter=t.inviter}TS.members.invalidateMembersUserCanSeeArrayCaches();TS.groups.member_joined_sig.dispatch(r,i)}}},channel_marked:function e(t){if(!TS.client)return;var r=TS.channels.getChannelById(t.channel);if(!r){TS.error('unknown channel: "'+t.channel+'"');return}r.needs_invited_message=false;if(!TS.useReactMessages())delete TS.model.last_reads_set_by_client[r.id+"_"+t.ts];if(TS.has_pri[q]&&r.last_read!==t.ts)TS.log(q,"channel_marked for "+r.id+", "+r.last_read+" -> "+t.ts);TS.channels.setLastRead(r,t.ts)},subtype__channel_topic:function e(t){var r=TS.channels.getChannelById(t.channel);if(!r){TS.error('unknown channel: "'+t.channel+'"');return}var n=t.user;var i=TS.members.getMemberById(n);if(!i){TS.error('unknown member: "'+n+'"');V("subtype__channel_topic");return}K("subtype__channel_topic");TS.info(i.id+" changed topic for channel "+t.channel);TS.channels.topicChanged(r,i.id,t.ts,t.topic)},subtype__channel_purpose:function e(t){var r=TS.channels.getChannelById(t.channel);if(!r){TS.error('unknown channel: "'+t.channel+'"');return}var n=t.user;var i=TS.members.getMemberById(n);if(!i){TS.error('unknown member: "'+n+'"');V("subtype__channel_purpose");return}K("subtype__channel_purpose");TS.info(i.id+" changed purpose for channel "+t.channel);TS.channels.purposeChanged(r,i.id,t.ts,t.purpose)},channel_history_changed:function e(t){TS.ms.msg_handlers.channel_history_changed_worker(t)},subtype__channel_history_changed:function e(t){if(TS.boot_data.feature_channel_eventlog_client)TS.warn("feature_channel_eventlog_client=1 so we should never be getting subtype "+t.subtype);TS.ms.msg_handlers.channel_history_changed_worker(t)},channel_history_changed_worker:function e(t){TS.info("channel_history_changed for "+t.channel);return k(t,TS.channels)},mpim_joined:function e(t){var r=TS.mpims.getMpimById(t.channel.id);if(r)return;if(TS.shared.isModelObShared(t.channel)&&t.channel.is_channel){TS.ms.msg_handlers.channel_joined(t);return}var n=TS.mpims.upsertMpim(t.channel);TS.members.invalidateMembersUserCanSeeArrayCaches();TS.mpims.joined_sig.dispatch(n);if(TS.client)TS.shared.checkInitialMsgHistory(n,TS.mpims)},subtype__mpim_join:function e(t){var r=t.user;var n=TS.members.getMemberById(r);if(!n){TS.error('unknown member: "'+r+'"');V("subtype__mpim_join");return}K("subtype__mpim_join");TS.info(n.id+" joined mpim "+t.channel)},mpim_open:function e(t){var r=TS.mpims.getMpimById(t.channel);if(!r)r=TS.channels.getChannelById(t.channel);if(!r){TS.error("unknown mpim! "+t.channel);return}r.is_open=true;if(TS.model.requested_mpim_opens[t.channel]){if(r.is_channel)TS.channels.displayChannel({id:r.id,and_send_txt:TS.model.requested_mpim_opens[t.channel].and_send_txt});else TS.mpims.displayMpim({id:r.id,and_send_txt:TS.model.requested_mpim_opens[t.channel].and_send_txt});delete TS.model.requested_mpim_opens[t.channel]}r.opened_this_session=true;if(r.is_channel)TS.channels.created_sig.dispatch(r);else TS.mpims.opened_sig.dispatch(r);if(TS.client)TS.shared.checkInitialMsgHistory(r,TS.shared.getControllerForModelOb(r))},mpim_close:function e(t){var r=TS.mpims.getMpimById(t.channel);if(!r)r=TS.channels.getChannelById(t.channel);if(!r){TS.error('unknown mpim: "'+t.channel+'"');return}r.is_open=false;var n=t.converted_to;if(n&&TS.groups.getGroupById(n)){r.latest=null;TS.shared.moveLastMsgInput(r,TS.groups.getGroupById(n))}if(TS.model.active_cid==t.channel)if(TS.client&&n&&TS.groups.getGroupById(n))TS.groups.displayGroup({id:n});else if(TS.client)TS.client.activeChannelDisplayGoneAway();TS.mpims.closed_sig.dispatch(r)},mpim_marked:function e(t){if(!TS.client)return;var r=TS.mpims.getMpimById(t.channel);if(!r){TS.error('unknown mpim: "'+t.channel+'"');return}r.needs_invited_message=false;if(TS.has_pri[q]&&r.last_read!==t.ts)TS.log(q,"mpim_marked for "+r.id+", "+r.last_read+" -> "+t.ts);if(!TS.useReactMessages())delete TS.model.last_reads_set_by_client[r.id+"_"+t.ts];TS.mpims.setLastRead(r,t.ts)},mpim_history_changed:function e(t){TS.ms.msg_handlers.mpim_history_changed_worker(t)},subtype__mpim_history_changed:function e(t){if(TS.boot_data.feature_channel_eventlog_client)TS.warn("feature_channel_eventlog_client=1 so we should never be getting subtype "+t.subtype);TS.ms.msg_handlers.mpim_history_changed_worker(t)},mpim_history_changed_worker:function e(t){TS.info("mpim_history_changed for "+t.channel);return k(t,TS.mpims)},group_left:function e(t){TS.info("You left group "+t.channel);var r=TS.groups.getGroupById(t.channel);if(!r){if(!TS.channels.temp_list_of_removed_channels[t.channel])TS.error('unknown group: "'+t.channel);return}TS.groups.removeGroup(r);TS.members.invalidateMembersUserCanSeeArrayCaches();TS.groups.left_sig.dispatch(r)},group_joined:function e(t){TS.info("You joined group "+t.channel.id);if(t.channel.is_mpim)return;var r=TS.groups.getGroupById(t.channel.name);if(r){TS.error("should not be getting a group_joined message if we already know about the group: "+t.channel.name+" "+t.channel.id);return}var n=TS.groups.upsertGroup(t.channel);TS.members.invalidateMembersUserCanSeeArrayCaches();TS.groups.joined_sig.dispatch(n);if(TS.client)TS.shared.checkInitialMsgHistory(n,TS.groups)},group_deleted:function e(t){var r=TS.groups.getGroupById(t.channel);if(!r){TS.error('unknown group: "'+t.channel);return}TS.info("deleted group "+t.channel);TS.groups.removeGroup(r)},group_archive:function e(t){var r=TS.groups.getGroupById(t.channel);if(!r){TS.error('unknown group: "'+t.channel);return}if(r.is_archived)return;TS.info("archived group "+t.channel);r.is_archived=true;if(t.is_moved)r.is_moved=1===t.is_moved;if(r.is_open)r.was_archived_this_session=true;TS.groups.archived_sig.dispatch(r)},group_unarchive:function e(t){var r=TS.groups.getGroupById(t.channel);if(!r){TS.error('unknown group: "'+t.channel);return}if(t.is_moved)r.is_moved=1===t.is_moved;if(!r.is_archived)return;TS.info("unarchived group "+t.channel);r.is_archived=false;r.was_archived_this_session=false;TS.groups.unarchived_sig.dispatch(r)},group_rename:function e(t){var r=TS.groups.getGroupById(t.channel.id);if(!r){TS.error('unknown group: "'+t.channel.id);return}TS.info("renamed group "+t.channel.id);TS.groups.groupRenamed(t.channel)},group_open:function e(t){if(TS.mpims.getMpimById(t.channel))return TS.ms.msg_handlers.mpim_open(t);var r=TS.groups.getGroupById(t.channel);if(!r){TS.error("unknown group! "+t.channel);return}r.is_open=true;if(TS.model.requested_group_opens[t.channel]){TS.groups.displayGroup({id:r.id,and_send_txt:TS.model.requested_group_opens[t.channel].and_send_txt});delete TS.model.requested_group_opens[t.channel]}r.opened_this_session=true;TS.groups.opened_sig.dispatch(r);if(TS.client)TS.shared.checkInitialMsgHistory(r,TS.groups)},group_marked:function e(t){if(!TS.client)return;if(TS.mpims.getMpimById(t.channel))return TS.ms.msg_handlers.mpim_marked(t);var r=TS.groups.getGroupById(t.channel);if(!r){TS.error('unknown group: "'+t.channel+'"');return}r.needs_invited_message=false;if(TS.has_pri[q]&&r.last_read!==t.ts)TS.log(q,"group_marked for "+r.id+", "+r.last_read+" -> "+t.ts);if(!TS.useReactMessages())delete TS.model.last_reads_set_by_client[r.id+"_"+t.ts];TS.groups.setLastRead(r,t.ts)},group_close:function e(t){if(TS.mpims.getMpimById(t.channel))return;var r=TS.groups.getGroupById(t.channel);if(!r){TS.error('unknown group: "'+t.channel+'"');return}r.is_open=false;if(TS.model.active_group_id==t.channel)if(TS.client)TS.client.activeChannelDisplayGoneAway();TS.groups.closed_sig.dispatch(r)},subtype__group_topic:function e(t){var r=TS.mpims.getMpimById(t.channel);if(r)return;var n=TS.groups.getGroupById(t.channel);if(!n){TS.error('unknown group: "'+t.channel+'"');return}var i=t.user;var a=TS.members.getMemberById(i);if(!a){TS.error('unknown member: "'+i+'"');V("subtype__group_topic");return}K("subtype__group_topic");TS.info(a.id+" changed topic for group "+t.channel+" to "+t.topic);TS.groups.topicChanged(n,a.id,t.ts,t.topic)},subtype__group_purpose:function e(t){var r=TS.mpims.getMpimById(t.channel);if(r)return;var n=TS.groups.getGroupById(t.channel);if(!n){TS.error('unknown group: "'+t.channel+'"');return}var i=t.user;var a=TS.members.getMemberById(i);if(!a){TS.error('unknown member: "'+i+'"');V("subtype__group_purpose");return}K("subtype__group_purpose");TS.info(a.id+" changed purpose for group "+t.channel);TS.groups.purposeChanged(n,a.id,t.ts,t.purpose)},group_history_changed:function e(t){TS.ms.msg_handlers.group_history_changed_worker(t)},subtype__group_history_changed:function e(t){if(TS.boot_data.feature_channel_eventlog_client)TS.warn("feature_channel_eventlog_client=1 so we should never be getting subtype "+t.subtype);TS.ms.msg_handlers.group_history_changed_worker(t)},group_history_changed_worker:function e(t){if(t.is_mpim)return;TS.info("group_history_changed for "+t.channel);return k(t,TS.groups)},im_created:function e(t){var r=TS.ims.getImById(t.channel.id);if(r){TS.warn("we already have an im for this user: "+t.user);return}TS.ims.upsertIm(t.channel);r=TS.ims.getImById(t.channel.id);if(!r){TS.error("error why can we not find this im: "+t.channel.id);return}var n=TS.members.getMemberById(t.user);if(!n){TS.error('unknown member: "'+t.user+'"');V("im_created");return}K("im_created");TS.members.invalidateMembersUserCanSeeArrayCaches();if(r.is_open){if(TS.model.requested_im_opens[n.id]){TS.ims.displayIm(r.id,false,TS.model.requested_im_opens[n.id].and_send_txt);delete TS.model.requested_im_opens[n.id]}TS.ims.opened_sig.dispatch(r)}r.opened_this_session=true},im_open:function e(t){var r=TS.ims.getImById(t.channel);if(!r){TS.error("unknown im! "+t.channel);return}r.is_open=true;var n=TS.members.getMemberById(t.user);if(!n){TS.error('unknown member: "'+t.user+'"');V("im_open");return}K("im_open");if(TS.model.requested_im_opens[n.id]){TS.ims.displayIm(r.id,false,TS.model.requested_im_opens[n.id].and_send_txt);delete TS.model.requested_im_opens[n.id]}r.opened_this_session=true;TS.ims.opened_sig.dispatch(r);if(TS.client)TS.shared.checkInitialMsgHistory(r,TS.ims)},im_marked:function e(t){if(!TS.client)return;var r=TS.ims.getImById(t.channel);if(!r){TS.error('unknown im: "'+t.channel+'"');return}if(TS.has_pri[q]&&r.last_read!==t.ts)TS.log(q,"im_marked for "+r.id+", "+r.last_read+" -> "+t.ts);if(!TS.useReactMessages())delete TS.model.last_reads_set_by_client[r.id+"_"+t.ts];TS.ims.setLastRead(r,t.ts)},im_close:function e(t){var r=TS.ims.getImById(t.channel);if(!r){TS.error('unknown im: "'+t.channel+'"');return}if(!r.is_open)return;r.is_open=false;if(TS.model.active_im_id==t.channel)if(TS.client)TS.client.activeChannelDisplayGoneAway();TS.ims.closed_sig.dispatch(r)},im_history_changed:function e(t){TS.ms.msg_handlers.im_history_changed_worker(t)},subtype__im_history_changed:function e(t){if(TS.boot_data.feature_channel_eventlog_client)TS.warn("feature_channel_eventlog_client=1 so we should never be getting subtype "+t.subtype);TS.ms.msg_handlers.im_history_changed_worker(t)},im_history_changed_worker:function e(t){TS.info("im_history_changed for "+t.channel);return k(t,TS.ims)},manual_presence_change:function e(t){var r=TS.model.user;if("away"!==t.presence&&"active"!==t.presence){TS.error('unknown presence: "'+t.presence+'"');return}r.manual_presence=t.presence;TS.members.presence_changed_sig.dispatch(r)},presence_change:function e(t){t.team=t.team||TS.model.team.id;if(t.hasOwnProperty("users")&&_.isArray(t.users))t.users.forEach(function(e){x(e,t.presence)});else x(t.user,t.presence)},status_change:function e(t){var r=TS.members.getMemberById(t.user);if(!r){TS.error('unknown member: "'+t.user+'"');V("status_change");return}K("status_change");if(r.status==t.status)return;r.status=t.status;TS.members.status_changed_sig.dispatch(r)},user_can_manage_shared_channels:function e(t){TS.prefs.updateTeamPrefCanUserManageSharedChannels(t)},pref_change:function e(t){TS.prefs.onPrefChanged(t)},team_pref_change:function e(t){TS.prefs.onTeamPrefChanged(t)},user_read_only_channels:function e(t){if(!TS.boot_data.feature_default_shared_channels)TS.channels.read_only.updateList(t.channel_ids)},team_profile_change:function e(t){TS.team.upsertAndSignal({profile:t.profile})},team_profile_reorder:function e(t){TS.team.upsertAndSignal({profile:t.profile})},team_profile_delete:function e(t){TS.team.upsertAndSignal({profile:t.profile})},team_plan_change:function e(t){TS.team.team_plan_changed_sig.dispatch(t)},file_created:function e(t){var r=TS.files.getFileById(t.file.id);if(r)TS.warn("we already know about this file, which probably means the files.upload response came in before this message (so np) "+t.file.id);else TS.files.upsertAndSignal(t.file)},file_public:function e(t){TS.files.upsertAndSignal(t.file)},file_deleted:function e(t){var r=t.file_ids||[t.file_id];r.forEach(function(e){TS.files.removeFile(e)})},file_private:function e(t){TS.files.fetchFileInfo(t.file_id)},file_change:function e(t){TS.files.upsertAndSignal(t.file);TS.files.fileWasMaybeRefreshed(t.file)},file_shared:function e(t){TS.files.upsertAndSignal(t.file);TS.files.team_file_shared_sig.dispatch(t.file)},file_unshared:function e(t){TS.files.upsertAndSignal(t.file)},file_comment_added:function e(t){var r=TS.files.getFileById(t.file.id);if(!r)return;if(!TS.files.editCommentOnFile(t.comment,r))TS.files.addCommentToFile(t.comment,r);TS.files.upsertFile(t.file)},file_comment_edited:function e(t){var r=TS.files.getFileById(t.file.id);if(!r)return;TS.files.editCommentOnFile(t.comment,r);TS.files.upsertFile(t.file)},file_comment_deleted:function e(t){var r=TS.files.getFileById(t.file.id);if(!r)return;TS.files.deleteCommentOnFile(t.comment,r);TS.files.upsertFile(t.file)},hello:function e(){},team_join:function e(t){var r=t.user;TS.info(r.id+" joined the team");TS.members.upsertMember(r);r=TS.members.getMemberById(r.id);if(!r){TS.error("team_join: wtf no member "+r.id+"?");V("team_join");return}K("team_join");TS.members.joined_team_sig.dispatch(r);if(TS.client)TS.view.showProperTeamPaneFiller()},user_change:function e(t){if(TS.boot_data.feature_modern_rtm_dispatch)return;var r=TS.members.getMemberById(t.user.id);if(!r){if(TS.has_pri[1989])TS.log(1989,"Flannel: user_change for member not in model; ignoring");V("user_change");return}K("user_change");if(t.user&&t.user.id===TS.model.user.id)if(TS.model.team&&!TS.prefs.getTeamPref("display_email_addresses")&&t.user.profile&&!t.user.profile.email){var n=r.profile&&r.profile.email;if(n){TS.info("user_change: email hidden via team pref. appending email from model for local user, so it is not lost in upsert.");t.user.profile.email=n}}TS.members.upsertAndSignal(t.user)},star_added:function e(t){if(!t.item){TS.error(t.type+" has no item");return}var r=TS.members.getMemberById(t.user);if(!r){TS.error('unknown member: "'+t.user+'"');V("star_added");return}K("star_added");if(!r.is_self)return;TS.stars.userStarStatusHasChanged(true,t.item,t.type);TS.stars.maybeUpdateUserStarredList({delta:1})},star_removed:function e(t){if(!t.item){TS.error(t.type+" has no item");return}var r=TS.members.getMemberById(t.user);if(!r){TS.error('unknown member: "'+t.user+'"');return}if(!r.is_self)return;TS.stars.userStarStatusHasChanged(false,t.item,t.type);TS.stars.maybeRemoveStarredListItem(t.item)},reaction_added:function e(t){if(!t.item){TS.error(t.type+" has no item");return}TS.rxns.changeRxnsFromIMsg(t)},reaction_removed:function e(t){if(!t.item){TS.error(t.type+" has no item");return}TS.rxns.changeRxnsFromIMsg(t)},email_domain_changed:function e(t){TS.team.upsertAndSignal({email_domain:t.email_domain});if(TS.client)TS.view.showProperTeamPaneFiller()},team_domain_change:function e(t){TS.team.upsertAndSignal({domain:t.domain});TS.model.last_team_domain=TS.model.team.domain;TSSSB.call("teamDomainChanged",t.url)},slack_broadcast:function e(t){var r=null;var n=t.title||TS.i18n.t("Broadcast message","msg_handlers")();var i=t.body||"";var a="";var s=t.button||(t.reload?"Reload":"OK");var o=false;if(t.reload){if(t.force_reload){TS.info("reloading because imsg.force_reload");o=true}else if(!TS.boot_data.version_ts){TS.info("reloading because we dont have an version_ts");o=true}else if("dev"===t.version_ts){TS.info("reloading because dev");o=true}else if(parseInt(TS.boot_data.version_ts,10)<parseInt(t.version_ts,10)){TS.info("reloading because "+TS.boot_data.version_ts+" < "+t.version_ts);o=true}if(!o)return;r=function e(){if(TS.client)TS.reload()}}if(o){var l=_.random(10,20);var u=TS.i18n.t('(You will be auto reloaded in <span id="auto_secs">{secs}</span> seconds.)',"msg_handlers")({secs:l});a='<p class="top_margin">'+u+"</p>";setTimeout(function(){if(TS.client)TS.reload()},1e3*l);setInterval(function(){l-=1;if(l<1)return;$("#auto_secs").text(l)},1e3)}TS.generic_dialog.start({title:TS.format.formatNoHighlightsNoSpecials(n),body:TS.format.formatNoHighlightsNoSpecials(i)+a,go_button_text:s,show_cancel_button:false,esc_for_ok:true,onGo:r})},team_rename:function e(t){if(t.source_team&&t.source_team!==TS.model.team.id)TS.teams.updateTeamName(t);else{$("#team_name").text(t.name);document.title=document.title.replace(TS.model.last_team_name,t.name);if(TS.ui.growls.original_document_title)TS.ui.growls.original_document_title=TS.ui.growls.original_document_title.replace(TS.model.last_team_name,t.name);TS.model.team.name=t.name;TS.model.last_team_name=TS.model.team.name;TS.team.team_name_changed_sig.dispatch(TS.model.team);TSSSB.call("teamNameChanged",t.name)}},team_icon_change:function e(t){if(!t.icon)return;if(t.source_team&&t.source_team!==TS.model.team.id)TS.teams.updateTeamIcon(t);else{TS.model.team.icon=t.icon;TS.teams.changed_icon_sig.dispatch(TS.model.team);if(TS.client)TS.client.updateTeamIcon()}},bot_added:function e(t){if(TS.boot_data.feature_modern_rtm_dispatch)return;var r=t.bot;TS.info(r.id+" was added");TS.bots.upsertBot(r);r=TS.bots.getBotById(r.id);if(!r){TS.error("error no bot "+r.id+"?");return}TS.bots.added_sig.dispatch(r)},bot_changed:function e(t){if(TS.boot_data.feature_modern_rtm_dispatch)return;var r=TS.bots.getBotById(t.bot.id);if(!r&&TS.has_pri[1989])TS.log(1989,"Flannel: bot_changed for member not in model; upserting");TS.bots.upsertAndSignal(t.bot)},bot_removed:function e(t){if(TS.boot_data.feature_modern_rtm_dispatch)return;var r=TS.bots.getBotById(t.bot.id);if(!r){if(TS.has_pri[1989])TS.log(1989,"Flannel: bot_removed for bot not in model; ignoring");return}TS.bots.upsertAndSignal(t.bot)},error:function e(){},user_typing:function e(t){if(TS.boot_data.feature_modern_rtm_dispatch)return;if(!TS.typing)return;var r=TS.members.getMemberById(t.user);if(!r){TS.error("unknown imsg.user:"+t.user);V("user_typing");return}K("user_typing");var n=TS.shared.getModelObById(t.channel);if(!n){TS.error("unknown imsg.channel:"+t.channel);return}TS.typing.memberStarted(n,r)},issue_change:function e(t){TS.help.onIssueChange(t.issue)},emoji_changed:function e(t){switch(t.subtype){case"add":if(!t.hasOwnProperty("name")||!t.hasOwnProperty("value")){TS.warn("Bad emoji_changed__add event; expected `name` and `value` to be present");return}TS.emoji.addCustomEmoji(t.name,t.value,t.event_ts);break;case"remove":if(!_.isArray(t.names)){TS.warn("Bad emoji_changed__remove event; expected `names` to be an array");return}t.names.forEach(function(e){TS.emoji.removeCustomEmoji(e,t.event_ts)});break;default:M("emoji_changed",t.event_ts,function(e){if(e)TS.model.emoji_cache_ts=e;TS.emoji.resetUpEmoji()})}},commands_changed:function e(t){if(!t.commands_removed&&!t.commands_updated){M("commands_changed",t.event_ts,function(e){if(e)TS.model.commands_cache_ts=e;TS.cmd_handlers.resetUpCmds()});return}if(_.isArray(t.commands_removed))t.commands_removed.forEach(function(e){TS.cmd_handlers.removeCommand(e.name,t.event_ts)});if(_.isArray(t.commands_updated))t.commands_updated.forEach(function(e){TS.cmd_handlers.updateCommand(e,t.event_ts)})},accounts_changed:function e(){setTimeout(TS.refreshTeams,1e3)},pin_added:function e(t){var r=TS.shared.getModelObById(t.channel_id);if(r){TS.pins.pinStatusHasChanged(true,t.item,t.item.type,r,t.pin_count);r.has_pins=true}},pin_removed:function e(t){var r=TS.shared.getModelObById(t.channel_id);if(r){TS.pins.pinStatusHasChanged(false,t.item,t.item.type,r,t.pin_count);if(false===t.has_pins)r.has_pins=false}},sh_room_join:function e(t){TS.dir(441,t);TS.rooms.upsertAndSignal(t.room)},sh_room_leave:function e(t){TS.dir(441,t);TS.rooms.upsertAndSignal(t.room)},sh_room_update:function e(t){TS.dir(441,t);TS.rooms.upsertAndSignal(t.room)},subteam_updated:function e(t){TS.user_groups.upsertUserGroupAndSignal(t.subteam)},subteam_members_changed:function e(t){if(!TS.boot_data.feature_subteam_members_diff)return;TS.info("TS.ms.msg_handlers.subteam_members_changed",t);TS.user_groups.userGroupMembersChanged(t)},subteam_created:function e(t){TS.user_groups.upsertUserGroupAndSignal(t.subteam)},subteam_deleted:function e(t){TS.user_groups.removeUserGroupAndSignal(t.subteam)},subteam_self_added:function e(t){TS.user_groups.upsertSelfUserGroup(t.subteam_id)},subteam_self_removed:function e(t){TS.user_groups.removeSelfUserGroup(t.subteam_id)},apps_changed:function e(t){if(t.event_ts)TS.model.apps_cache_ts=t.event_ts;TS.apps.ingestApp(t.app)},dnd_override:function e(t){TS.dnd.dndOverride(t.channel,t.timestamp)},dnd_updated:function e(t){var r=TS.members.getMemberById(t.user);if(!r){TS.error('unknown member: "'+t.user+'"');return}TS.dnd.updateUserPropsAndSignal(r.id,t.dnd_status)},dnd_updated_user:function e(t){var r=TS.members.getMemberById(t.user);if(!r){TS.log(2002,'unknown member in dnd_updated_user: "'+t.user+'"');V("dnd_updated_user");return}K("dnd_updated_user");TS.dnd.updateUserPropsAndSignal(r.id,t.dnd_status)},message_replied:function e(t){var r=t.message;var n;if(TS.boot_data.feature_threads_perf&&r&&r.latest_reply)n=r.latest_reply;else if(r&&r.replies&&r.replies.length)n=_.maxBy(r.replies,"ts").ts;var i=TS.shared.getModelObById(t.channel);if(n&&i&&i.msgs){var a=TS.utility.msgs.findMsg(r.ts,i.id);if(a&&a.reply_count){var s;if(TS.boot_data.feature_threads_perf&&a&&a.latest_reply)s=a.latest_reply;else if(a&&a.replies&&a.replies.length)s=_.maxBy(a.replies,"ts").ts;if(n<s){TS.log(2004,"Not processing older message_replied event, "+n+" < "+s+", in "+t.channel);return}}}TS.ms.msg_handlers.message_changed_worker(t)},subtype__message_replied:function e(t){if(TS.has_pri[U])TS.log(U,"recved subtype "+t.subtype);if(TS.boot_data.feature_channel_eventlog_client)TS.warn("feature_channel_eventlog_client=1 so we should never be getting subtype "+t.subtype);TS.ms.msg_handlers.message_changed_worker(t)},thread_subscribed:function e(t){var r=t.subscription;if(!r||"thread"!==r.type)return;if(!r.channel||!r.thread_ts)return;TS.replies.threadSubscribed(r.channel,r.thread_ts,r)},thread_unsubscribed:function e(t){var r=t.subscription;if(!r||"thread"!==r.type)return;if(!r.channel||!r.thread_ts)return;TS.replies.threadUnsubscribed(r.channel,r.thread_ts,r)},thread_marked:function e(t){var r=t.subscription;if(!r||"thread"!==r.type)return;if(!r.channel||!r.thread_ts)return;TS.replies.threadMarked(r.channel,r.thread_ts,r.last_read,r.unread_count)},desktop_notification:function e(t){if(!TS.ui||!TS.ui.growls)return;TS.ui.growls.handleDesktopNotificationMessage(t)},user_added_to_team:function e(t){if(TS.boot_data.feature_modern_rtm_dispatch)return;TS.info("TS.ms.msg_handlers.user_added_to_team, team_id = "+t.team_id);TS.members.userAddedToTeam(t.team_id)},user_removed_from_team:function e(t){if(TS.boot_data.feature_modern_rtm_dispatch)return;TS.info("TS.ms.msg_handlers.user_removed_from_team, team_id = "+t.team_id);TS.members.userRemovedFromTeam(t.team_id)},update_thread_state:function e(t){if(!TS.client)return;TS.client.threads.updateThreadState(t.has_unreads,t.mention_count,t.timestamp,t.mention_count_by_channel);TS.replies.updateThreadStateReceived()},shared_invite_code_created:function e(){if(!TS.client)return;TS.ui.shared_invites_modal.updateCode()},shared_invite_code_disabled:function e(){if(!TS.client)return;TS.ui.shared_invites_modal.updateCode()},app_permission_request:function e(t){if(!TS.interop.client_action_token.check(t.client_token))return;TS.apps.permissions.requestPermissions(t.app_user,t.scope_info,t.trigger_id)},dialog_opened:function e(t){if(!TS.interop.client_action_token.check(t.client_token))return;var r=TS.interop.client_action_token.getTimeDelta(t.client_token),n=r.delta,i=r.nowTs,a=r.tokenTs;TS.clog.track("APP_DIALOG_OPEN_ATTEMPTED",{app_id:t.app_id,debug_date_now_fn:_.get(Date,"now","function not defined").toString(),dialog_id:t.dialog_id,dialog_client_token_ts:a,dialog_ms_event_received_ts:i});if(n>=t.timeout_range){TS.statsd.timing("app_dialog.initiation_to_timeout_delta",n);return}TS.statsd.timing("app_dialog.initiation_to_open_delta",n);var s=document.getElementById("app_dialog_mount_point");TS.interop.mountAppDialog(TS.boot_data.team_id,s,{appId:t.app_id,id:t.dialog_id,submitLabel:t.dialog_submit_label,title:t.dialog_title})},lesson_assigned:function e(t){TS.lessons.lesson_assigned_sig.dispatch(t.payload.user_lessons)},lesson_user_action:function e(t){switch(t.user_event){case"channel_created":TS.lessons.channel_created_sig.dispatch(t);break;case"message_sent":TS.lessons.message_sent_sig.dispatch(t);break;case"file_share":TS.lessons.file_uploaded_sig.dispatch(t);break;default:TS.info("Unknown user event")}},slackbot_response_sent:function e(t){TS.newxp.slackbot_response_sent_sig.dispatch(t)},slackbot_skip_or_stop:function e(t){TS.newxp.slackbot_skip_or_stop_sig.dispatch(t)},slackbot_continue:function e(t){TS.newxp.slackbot_continue_sig.dispatch(t)},app_canvas_created:function e(t){if(TS.apps.isAppCanvasesEnabled())TS.redux.canvases.addCanvas(t.canvas)},app_canvas_changed:function e(t){if(TS.apps.isAppCanvasesEnabled())TS.redux.canvases.updateCanvas(t.canvas)}});var e=10;var t;var n;var i=0;var a=function e(t,r){if(!r)return false;if(TS.web&&TS.web.space&&!TS.web.space.isFileRelevant(r))return false;if("file_created"===t.type&&t.user_id==TS.model.user.id)return true;return!!TS.files.getFileById(r)};var s=function e(t){var r=["message","file_deleted","file_private"];if(_.includes(r,t.type))return false;if(t._file_attached)return false;var n=t;var i=t.file&&t.file.id||t.file_id;if(!i&&t.item){i=t.item.file&&t.item.file.id||t.item.file_id;if(i)n=t.item}if(!i)return false;return{ob_with_file:n,file_id:i}};var o=[];var l=false;var u;var d=function(){var e=500;var t={trailing:true};return _.debounce(function(e,t){if(TS.has_pri[U])TS.log(U,"TS.metrics: "+e+", Q length = "+t);TS.metrics.store(e,t,{is_count:true})},e,t)}();var c=function e(t){if(t._from_evt_log)l=true;t._enqueued_at=performance.now();o.push(t);if(n){i+=1;t._id=i;TS.metrics.mark("ms_event_queue_add_"+i)}if(1==o.length)m();else{if(TS.has_pri[U])TS.log(U,t.type+" is Qed and not being handled immediately _Q.length:"+o.length);if(!TS.client||!TS.client.stats.isEnabled())return;if(l){if(o.length>100)d("ms_event_from_log_q",o.length)}else if(o.length>10)d("ms_event_q",o.length)}};var m=function e(){if(u){clearTimeout(u);u=void 0}if(!o.length)return;if(!t)t=performance.now();if(n)TS.metrics.mark("ms_event_processing");var r=o[0];if(r._enqueued_at&&TS.client&&TS.client.stats.isEnabled()){var i=performance.now()-r._enqueued_at;TS.metrics.store("ms_time_in_queue",i,{allow_zero:true});delete r._enqueued_at}f(r)};var f=function e(t){var r=s(t);if(!r){TS.files.maybePruneChannels(t.file);return T(t)}var n=r.ob_with_file;var i=r.file_id;TS.files.maybePruneChannels(n.file);if(!a(t,i)){if(TS.has_pri[G])TS.warn(G,t.type+" referenced an irrelevant file: "+i);return Promise.resolve().then(function(){return b()})}if(TS.has_pri[G])TS.dir(G,t,t.type+" -> _ensureFileObjectsOnMsgAndProceed()");if(!i){if(TS.has_pri[G])TS.maybeWarn(G,t.type+" referenced a relevant file but there is no file_id");return T(t)}if(TS.has_pri[G])TS.log(G,t.type+" referenced a relevant file and we have to look it up via the API: "+i);var l=_.includes(L,t.type);if(o.length>1)g(t,i,n,l);else p(t,i,n,l)};var p=function e(t,r,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:false;if(i){var a=TS.files.getFileById(r);if(a)return h(t,r,n,a)}if(Y)TS.metrics.count("fetch_file_single",1);TS.files.fetchFileInfoRaw(r,function(e,i){if(!i){if(TS.has_pri[G])TS.warn(G,t.type+" file fetch failed (or the file has been deleted)");return Promise.resolve().then(function(){return b()})}h(t,r,n,i)},t.type)};var h=function e(t,r,n,i){TS.files.maybePruneChannels(i);n.file=i;if(TS.has_pri[G])TS.log(G,t.type+" now has a file definition");t._file_attached=true;_.forEach(o,function(e){var n=s(e);if(n&&n.file_id===r){n.ob_with_file.file=i;e._file_attached=true;if(TS.has_pri[G])TS.log(G,t.type+" now has a file definition (courtesy of a previously queued imsg for "+r+")")}});T(t)};var g=function e(t,r,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:false;if(Y)TS.metrics.count("fetch_file_multi",1);var l=[r];_.forEach(o,function(e){if(l.length>=20)return false;var t=s(e);if(t&&!_.includes(l,t.file_id)&&a(e,t.file_id))l.push(t.file_id)});if(Y)TS.metrics.count("fetch_file_multi_count",l.length);if(l.length>1){var u=true;TS.files.fetchMultipleFiles(l,function(e,i){var a=i&&i.files;if(!e||!_.isArray(a)){if(TS.has_pri[G])TS.maybeWarn(G,t.type+" multi-file fetch failed");return Promise.resolve().then(function(){return b()})}var l={};_.forEach(a,function(e){TS.files.maybePruneChannels(e);l[e.id]=e});_.forEach(o,function(e){var r=s(e);if(!r)return;var n=l[r.file_id];if(!n)return;r.ob_with_file.file=n;e._file_attached=true;if(TS.has_pri[G])TS.log(G,t.type+" now has a file definition ("+r.file_id+")")});if(!l[r])p(t,r,n);else T(t)},u)}else p(t,r,n,i)};var S=function e(t){if(!TS.boot_data.feature_stop_loud_channel_mentions)return Promise.resolve();if(!t||"message"!==t.type||!t.text)return Promise.resolve();var r=TS.model.here_regex.test(t.text)||TS.model.channel_regex.test(t.text)||TS.model.everyone_regex.test(t.text)||TS.model.group_regex.test(t.text);if(r){var n=TS.shared.getModelObById(t.channel);if(!n){TS.maybeWarn(794,"_maybeEnsureMemberCount: Could not find model_ob for id "+t.channel);return Promise.resolve()}if(n.is_im&&!n.is_mpim)return Promise.resolve();if(n.is_mpim&&!TS.membership.lazyLoadMpimMembership())return Promise.resolve();if(n.is_group&&!TS.membership.lazyLoadGroupMembership())return Promise.resolve();return TS.membership.promiseToGetMembershipCounts(n).catch(_.noop)}return Promise.resolve()};var T=function e(n){if(TS.has_pri[U])TS.log(U,n.type+" is now being handled");var i;var a=true;var s=true;if(I)i=j.start(n.type);var o=function e(){return TS.shared.ensureModelObsArePresent(T).catch(function(e){if(n.channel&&"string"===typeof n.channel&&TS.channels.temp_list_of_removed_channels[n.channel])return;if(n.channel&&"string"===typeof n.channel&&!TS.shared.getModelObById(n.channel)){TS.error(m+" could not be handled because imsg.channel could not be fetched. full err: "+e.message);TS.warn("imsg.ts:"+n.ts+", imsg.channel:"+n.channel);throw e}if(TS.has_pri[z]){TS.warn(z,m+" held some references to model_obs we could not fetch, but we have imsg.channel (or there was no imsg.channel) so we can still proceed");TS.log(z,"imsg.ts:"+n.ts+", missing c ids:"+JSON.stringify(T))}})};var l=function e(){return TS.bots.ensureBotsArePresent(k).catch(function(e){TS.error(e)})};var u=function e(){return TS.members.ensureMembersArePresent(y.m_ids,y.c_ids,y.t_ids).catch(function(e){if(n.user&&"string"===typeof n.user&&!TS.members.getMemberById(n.user)||n.channel&&"object"===r(n.channel)&&n.channel.user&&"string"===typeof n.channel.user&&!TS.members.getMemberById(n.channel.user)){TS.error(m+" could not be handled because imsg.user or imsg.channel.user could not be fetched. full err: "+e.message);TS.warn("imsg.ts:"+n.ts+", imsg.user:"+n.user+", imsg.channel.user:"+n.channel&&n.channel.user);throw e}if(TS.has_pri[z]){TS.maybeWarn(z,m+" held some references to members we could not fetch, but we have imsg.user and imsg.channel.user (or they did not exist) so we can still proceed");TS.log(z,"imsg.ts:"+n.ts+", missing_m_ids:"+JSON.stringify(y))}})};var d=function e(){return TS.teams.ensureTeamsArePresent(x).catch(function(e){TS.error(e)})};var c=function e(r){try{w(n)}catch(e){TS.error(m+" errored out when being handled, with err: "+e.message,e);TS.console.logStackTrace()}if(!r)t=null;if(i)i(a);return b()};if(_.includes(R,n.type))return c(s);var m="type:"+n.type+(n.subtype?" subtype:"+n.subtype:"");var f=TS.interop.utility.extractAllModelObIds(n);var p=TS.interop.utility.extractAllMemberIds(n);var h=TS.interop.utility.extractAllBotIds(n);var g=TS.interop.utility.extractAllTeamIds(n);var T=TS.shared.getModelObIdsNotPresent(f);var y=TS.shared.getModelObIdsNotPresent(p);var k=_.reject(h,TS.bots.getBotById);var x=_.reject(g,TS.teams.getTeamById);var C=!!(T.length||y.length||k.length||x.length);if(C&&"user_typing"===n.type&&v(n.channel))return b();Promise.join(o(),l(),u(),d()).then(function(){return S(n)}).then(function(){return c()}).catch(function(){if(i)i(a);return b(!C)})};var v=function e(t){if(t===TS.model.active_cid)return false;var r=TS.shared.getModelObById(t);if(!r)return true;return!r.is_im&&!r.is_mpim};var b=function e(){if(!o.length)return Promise.resolve();if(n){var r=o.shift();TS.metrics.store("ms_event_q_length",o.length,{is_count:true});TS.metrics.measureAndClear("ms_event_duration","ms_event_processing");TS.metrics.measureAndClear("ms_event_and_queue_duration","ms_event_queue_add_"+r._id)}else o.shift();if(!o.length)l=false;if(y())return new Promise(function(e){setTimeout(function(){if(TS.has_pri[z])TS.log(z,"too much work per frame; need to take a break");t=null;m();return e()},0)});m();return Promise.resolve()};var y=function r(){return t&&o.length&&performance.now()-t>e};var w=function e(t){TS.ms.msg_handlers[t.type](t);if(TS.client&&TS.model.is_our_app){TS.dir(236,t,"calling TS.client.windows.distributeMsgToWins");TS.client.windows.distributeMsgToWins(t)}};var k=function e(t,r){var n=TS.shared.getModelObById(t.channel);if(!n){TS.error('unknown model_ob: "'+t.channel+'"');return}if(TS.useReactMessages()){TS.redux.messages.channelHistoryChanged(n.id);return}n.history_changed=true;r.fetchHistory(n,{channel:n.id,latest:t.latest,inclusive:true,count:_.clamp(n.msgs.length,TS.model.initial_msgs_cnt,1e3)},function(e,i,a){if(!e)TS.error("could not retrieve history for "+n.id);else{TS.info("_history_changed: dumping old messages for "+n.id);n.is_limited=false;TS.utility.msgs.resetOldestMsgsTs(n);TS.warn("imsg.latest: "+t.latest);for(var s=n.msgs.length-1;s>-1;s-=1){var o=n.msgs[s];if(o.ts<t.latest)continue;i.messages.unshift(o)}n.msgs.length=0}r.onHistory(e,i,a);if(!n.latest){TS.info("history_changed: latest not set for "+n.id,t,n);var l=TS.shared.getLatestMsgTs(n);if(!l){TS.warn("history_changed: could not find latest via TS.shared.getLatestMsgTs(), using live msgs");l=n&&n.msgs.length?n.msgs[n.msgs.length-1]:null}if(!l)TS.warn("history_changed: still no latest ts for "+n.id+"?",l);else if(l){TS.info("history_changed: assigning latest of "+l+" to model_ob",l,n);n.latest=l}}n.history_changed=false})};var x=function e(t,r){if("away"!==r&&"active"!==r){TS.error('unknown presence: "'+r+'"');return}var n=TS.members.getMemberById(t);if(!n){V("presence_change");return}K("presence_change");if(n.presence==r)return;if(_.get(n,"profile.always_active"))r="active";if(n.is_self)n._presence_last_changed=new Date;n.presence=r;TS.members.presence_changed_sig.dispatch(n)};var C={};var M=function e(t,r,n){C[t]=C[t]||{};var i=C[t];if(r)i.cache_ts=r;if(i.timer)return;var a=_.random(0,5e3);TS.info("Waiting "+a+" ms before handling "+t+" event");i.timer=setTimeout(function(){delete C[t];n(i.cache_ts)},a)};var I=false;var P=false;var A=1e3;var E=null;var F=6e4;var O={};var B={};var D=0;var H=0;var j={start:function e(t,r){if(!P)return;r=r&&parseInt(r,10)||A;var n={start:performance.now(),end:0};var i=function e(i){i=!!i;n.end=performance.now();var a=n.end-n.start;if(a>r)TS.warn("'"+t+"' msg_handler took "+_.round(a,2)+"ms"+(r!==A?" (threshold = "+r+")":""));j.count(t,a,i)};return i},count:function e(t,r,n){if(!B.start_time)B.start_time=performance.now();if(!O[t])O[t]={call_count:0,elapsed_time:0,async:!!n};if(n)O[t].async=n;O[t].call_count+=1;O[t].elapsed_time+=r;j.maybeReport()},report:function e(){j.finish();if(_.size(O)){var t=_.sum(_.map(O,"call_count"));if(TS.has_pri[W])TS.log(W,"🏔️ MS message stats: "+t+" handler calls in "+parseInt(B.elapsed_time/1e3,10)+"s window, "+D+" imsgs since "+new Date(H),O);j.beacon()}j.reset()},beacon:function e(){var t="ms_handler_";_.each(O,function(e,r){if(e.async)r=t+"async_"+r;else r=t+r;TS.metrics.count(r+"_count",e.call_count);TS.metrics.store(r+"_time",e.elapsed_time)});TS.metrics.store(t+"imsgs_received_total",D,{is_count:true})},finish:function e(){B.end_time=performance.now();B.elapsed_time=B.end_time-B.start_time},reset:function e(){O={};B={};E=null},maybeReport:function e(){if(E)return;E=window.setTimeout(j.report,F)},enableStatsCollecting:function e(){if(TS.has_pri[W])TS.log(W,"🏔️ MS message handler stat collecting enabled");P=true},disableStatsCollecting:function e(){if(TS.has_pri[W])TS.log(W,"🏔️ MS message handler stat collecting disabled");P=false}};var R=["channel_joined","dnd_updated","dnd_updated_user","manual_presence_change","member_left_channel","presence_change","status_change","subteam_created","user_removed_from_team","user_change"];var L=["file_comment_added","file_comment_deleted","file_comment_edited"];var N=50;var U=2;var q=141;var G=552;var W=808;var z=794;var K=function e(t){if(TS.utility.enableFeatureForUser(1))TS.metrics.count("ms_event_handled_"+t)};var V=function e(t){if(TS.utility.enableFeatureForUser(1))TS.metrics.count("ms_event_dropped_"+t)};var Y=false})()},4791:function(e,t){(function(){TS.registerModule("flannel",{test:function t(){var r={};Object.defineProperty(r,"_mutation_counter",{get:function t(){return e},set:function t(r){e=r}});return r},mutateFlannelUrl:function t(){e+=1},fetchMemberCounts:function e(){return TS.interop.Flannel.query("user_counts_request").then(function(e){return e.counts})},getFlannelConnectionUrl:function e(){var t=TS.getSocketStartArgs();return o(t)},fetchChannelMembershipForUsers:function e(r,n){if(!_.isString(r))throw new Error("Expected channel_id to be a string");if(!_.isArray(n)||!_.every(n,_.isString))throw new Error("Expected user_ids to be an array of strings");if(_.isEmpty(n))return Promise.resolve({});n=_.uniq(n);var i={};var a=_.chunk(n,t).map(function(e){var t={channel:r,users:e};var n=TS.interop.Flannel.query("membership_query",t).then(function(e){var t=e.members||[];var r=e.non_members||[];var n=t.concat(r);n.forEach(function(e){i[e]=t.indexOf(e)>=0});return null});return n.reflect()});return Promise.all(a).then(function(){if(Object.keys(i).length!==n.length){var e=Object.keys(i);var t=_.difference(n,e);throw new Error("Flannel did not return membership status of "+r+" for some users: "+t.join(", "))}return i})},fetchMembershipCountsForChannel:function e(t){if(!_.isString(t))throw new Error("Expected channel_id to be a string");return TS.interop.Flannel.query("user_counts_request",{channel:t}).then(function(e){return e.counts})},fetchRawUpdatedObjectsByIds:function e(t){return i(t)},fetchRawObjectsByIds:function e(t){return a(t)},fetchRawObjectsWithQuery:function e(t,r){return s(t,r)}});var e=0;var t=100;var r=2;var n=function e(t,r,n){return TS.interop.Flannel.query("user_query_request",t).then(function(i){if(_.get(i,"results.length")){r=r.concat(i.results);if(n&&(r.length>=n||!i.next_marker))return{objects:r.slice(0,n),next_marker:r.length>n?r[n].id:i.next_marker}}if(!i.next_marker||r.length>=t.count&&!n){if(TS.has_pri[l])TS.log(l,"Flannel: finished fetching results for query",t);return{objects:r.slice(0,t.count),next_marker:r.length>t.count?r[t.count].id:i.next_marker}}t.marker=i.next_marker;if(TS.has_pri[l])TS.log(l,"Flannel: fetching next page for query",t);return e(t,r,n)})};var i=function e(n){var i=_.chunk(n,t);var a=Promise.map(i,function(e){var t=_.reduce(e,function(e,t){var r=TS.members.getMemberById(t);var n=r?r.updated||0:0;e[t]=n;return e},{});var r=s({updated_ids:t});r.catch(function(r){TS.warn("Flannel chunk fetch failed: ",t,e,i);TS.logError(r)});return r.reflect()},{concurrency:r});return a.then(function(e){var t=e.filter(function(e){return e.isRejected()}).map(function(e){return e.reason()});if(t.length){var r=new Error("Some Flannel fetches failed");r.rejection_reasons=t;return Promise.reject(r)}var n=_(e).map(function(e){return e.value().objects}).flatten().value();return Promise.resolve(n)})};var a=function e(n){var i=_.chunk(n,t);var a=Promise.map(i,function(e){var t=s({ids:e});t.catch(function(t){TS.warn("Flannel chunk fetch failed: ",e,i);TS.logError(t)});return t.reflect()},{concurrency:r});return a.then(function(e){var t=e.filter(function(e){return e.isRejected()}).map(function(e){return e.reason()});if(t.length){var r=new Error("Some Flannel fetches failed");r.rejection_reasons=t;return Promise.reject(r)}var n=_(e).map(function(e){return e.value().objects}).flatten().value();return Promise.resolve(n)})};var s=function e(t,r){if(_.isString(t))t={query:t};var i=[];return n(t,i,r)};var o=function t(r){var n=TS.boot_data.ms_connect_url;if(e>0){var i=TS.interop.url.getHostName(n).split(".");i[0]=i[0]+"-"+e;var a=i.join(".");n=TS.interop.url.setHostName(n,a)}return TS.interop.url.setUrlQueryStringValue(n,"start_args",TS.interop.url.queryStringEncode(r))};var l=1989})()},4792:function(e,t){(function(){TS.registerModule("ds",{last_pong_time:0,sent_map:{},connected_sig:new signals.Signal,disconnected_sig:new signals.Signal,trouble_sig:new signals.Signal,reconnecting_sig:new signals.Signal,pong_sig:new signals.Signal,on_msg_sig:new signals.Signal,reconnect_requested_sig:new signals.Signal,onStart:function e(){b(TS.model.ui.is_window_focused||false);TS.ui.window_focus_changed_sig.add(b);setInterval(function(){if(!TS.model.ds_connected)return;if(TS.model.rtd_start_throttler<1)return;TS.model.rtd_start_throttler-=1},6e4)},send:function e(t,r,n){g+=1;t.id=g;TS.ds.sent_map[t.id.toString()]={msg:t,handler:r,ts:Date.now(),temp_ts:n};if("ping"===t.type||"pong"===t.type){if(TS.has_pri[$])TS.log($,"DS TS.ds ping --\x3e\n"+JSON.stringify(t,null,"  "))}else{TS.model.last_net_send=Date.now();if(TS.has_pri[$])TS.log($,"TS.ds --\x3e\n"+JSON.stringify(t,null,"  "))}if(h&&TS.model.ds_connected)h.send(JSON.stringify(t));else TS.ds.Q.push(t);return t.id},Q:[],sendTyping:function e(t){var r='{"type":"typing", "channel":"'+t+'"}';h.send(r)},handleMsg:function e(t){var r=t.reply_to&&!("ok"in t)&&"message"===t.type;var n;if(t.reply_to)if(t.reply_to.toString()in TS.ds.sent_map){n=TS.ds.sent_map[t.reply_to];t.SENT_MSG=n.msg;delete TS.ds.sent_map[t.reply_to]}else if(!r)TS.error('received msg "'+t.reply_to+'" with type "'+t.type+'" but we have no record of it in sent_map');if("ping"===t.type||"pong"===t.type){if(TS.has_pri[$]){TS.log($,"DS msg "+t.type+" time: "+(Date.now()-n.ts)+"ms");TS.log($,"DS TS.ds ping <--\n"+JSON.stringify(t,null,"  "))}TS.ds.last_pong_time=Date.now();TS.ds.pong_sig.dispatch();S=false}else{if(n){var i=t.type||t.SENT_MSG.type||"";if(TS.has_pri[$])TS.log($,"msg "+(i?'"'+i+'" ':"")+"rsp time "+(Date.now()-n.ts)+"ms")}if(TS.has_pri[$])TS.log($,"TS.ds <-- \n"+JSON.stringify(t,null," "))}if("error"===t.type)O(t);else if(!t.reply_to){TS.ds.on_msg_sig.dispatch(t);if("hello"===t.type)B(t)}if(n){if(!t.ok)t.error=t.error||{code:0,msg:"unknown error (not specified by MS)"};if(r)t.ok=true;if(n.handler)n.handler(t.ok,t)}},onFailure:function t(n){if(n)M("You got disconnected, so here are some details:\n>>>"+n);S=false;I();if(TS.model.ds_connected){TS.info("Disconnected from DS, TS.model.rtd_start_throttler:"+TS.model.rtd_start_throttler);TS.ds.logConnectionFlow("on_connected_failure");TS.model.ds_reconnect_ms=100;TS.ds.disconnect()}else{TS.ds.logConnectionFlow("on_notconnected_failure");TS.model.ds_reconnect_ms=1.3*(TS.model.ds_reconnect_ms+1e3);var i=TS.model.ds_reconnect_ms;if(TS.model.ds_reconnect_ms>4e3)TS.model.ds_reconnect_ms=_.random(i,i+i/3);TS.model.ds_reconnect_ms=Math.min(TS.model.ds_reconnect_ms,3e5)}if(TS.model.rtd_start_throttler>5){var a=2e3*TS.model.rtd_start_throttler;if(TS.model.ds_reconnect_ms<a){TS.info("because TS.model.rtd_start_throttler:"+TS.model.rtd_start_throttler+" we are increasing time until next login call");TS.model.ds_reconnect_ms=a}}if(TS.model.ds_connected){TS.model.ds_connected=false;TS.ds.disconnected_sig.dispatch()}TS.model.ds_connected=false;clearInterval(r);clearInterval(e);if(TS.model.ds_asleep){TS.warn("NOT doing startReconnection(), we are asleep");return}TS.ds.startReconnection()},startReconnection:function e(){TS.model.ds_reconnect_time=Date.now()+TS.model.ds_reconnect_ms;TS.info("Attempting to reconnect in "+TS.model.ds_reconnect_ms+"ms");clearInterval(m);m=setInterval(P,f);P();clearTimeout(p);p=setTimeout(function(){if(!TS.model.window_unloading)TS.ds.reconnect_requested_sig.dispatch()},TS.model.ds_reconnect_ms)},manualReconnectNow:function e(){TS.ds.logConnectionFlow("manual_reconnect");clearTimeout(p);clearInterval(m);clearTimeout(i);v=0;if(!TS.model.window_unloading){TS.ds.reconnect_requested_sig.dispatch();TS.ds.reconnecting_sig.dispatch(0)}},disconnect:function e(){if(h&&TS.model.ds_connected){TS.ds.logConnectionFlow("disconnect");h.close()}else TS.warn("TS.ds.disconnect called, but _websocket="+h+" TS.model.ds_connected="+TS.model.ds_connected)},logConnectionFlow:function e(t){var r=TS.model.ds_conn_log;var n=Date.now();r.push({name:t,time:n,delta:r.length?n-r[r.length-1].time:0});if(TS.has_pri[$])TS.log($,"logConnectionFlow "+t+" "+r[r.length-1].delta)},getConnectionFlowLog:function e(){var t=TS.model.ds_conn_log;var r=[];for(var n=0;n<t.length;n+=1)r.push(encodeURIComponent(t[n].name+"-"+(t[n].delta?Math.round(t[n].delta/1e3):0)+"-"+Math.round(t[n].time/1e3)));TS.dir(2,TS.model.ds_conn_log);var i="_x_connection_log="+r.join(",");return i},connect:function e(){if(!window.WebSocket)window.WebSocket=window.MozWebSocket;if(window.WebSocket){var t;try{TS.ds.logConnectionFlow("connect");t=TS.web.space.login_data.ws;var r=1==TS.qs_args.simulate_old_token?"&TRIGGER_OLD_TOKEN=1":"";t+="?version_uid="+TS.boot_data.version_uid+r;t=TS.utility.appendLogToUrlWithLimit(t,TS.ds.getConnectionFlowLog());TS.info("Connecting to: "+t);if(1==TS.qs_args.simulate_first_connect_failure&&!window.already_simulated_first_connect_failure){t=t.replace("e","w");TS.info("simulate_first_connect_failure url:"+t);window.already_simulated_first_connect_failure=true}a=window.WEB_SOCKET_USING_FLASH?o:s;clearTimeout(i);i=setTimeout(E,a);TS.ds.last_url=t;TS.ds.last_start_ms=Date.now();I();h=new WebSocket(t)}catch(e){TS.warn("failed to create new WebSocket");TS.error(e);TS.ds.onFailure("failed to create new WebSocket");return}TS.model.ds_connecting=true;if(1==TS.qs_args.simulate_first_connect_timeout&&v<1)TS.info("simulate_first_connect_timeout url:"+t);else h.onopen=w;h.onclose=C;h.onerror=F}else alert(TS.i18n.t("Your browser does not support Web Sockets.","ds")())},sleep:function e(){if(TS.model.ds_asleep)return;if(!TS.model.ds_connected)return;TS.model.ds_asleep=true;TS.ds.disconnect()},wake:function e(){if(!TS.model.ds_asleep)return;TS.model.ds_asleep=false;TS.ds.startReconnection()}});var e=0;var t=3e3;var r=0;var n=1e4;var i=0;var a=0;var s=1e4;var o=2e4;var l=0;var u=3e4;var d=0;var c=5e3;var m=0;var f=1e3;var p=0;var h=null;var g=0;var S=false;var T=0;var v=0;var b=function e(t){if(t)T=1e4;else T=6e4;T+=n;if(TS.has_pri[$])TS.log($,"DS _pong_timeout_ms set to:"+T+" has_focus:"+t)};var y=function e(t){var r=JSON.parse(t.data);TS.ds.handleMsg(r)};var w=function e(){clearTimeout(i);v=0;if(1==TS.qs_args.simulate_hello_timeout&&!window.already_simulated_hello_timeout){TS.info("simulate_hello_timeout");window.already_simulated_hello_timeout=true}else h.onmessage=y;TS.model.ds_conn_log.length=0;TS.info("DS WS connected!");TS.ds.logConnectionFlow("on_connect");clearTimeout(l);l=setTimeout(A,u)};var k=function e(){if(!S)return;var t=Date.now()-TS.ds.last_pong_time;if(TS.has_pri[$])TS.log($,"DS MS since_last_pong_ms:"+t+" pong_timeout_ms:"+T);if(t<T)return;TS.warn("since_last_pong_ms too long! "+t+" > "+T);TS.warn("calling disconnect(), expect to get an onDisconnect() callback");TS.ds.logConnectionFlow("on_ping_timeout");TS.ds.trouble_sig.dispatch();S=false;M("You are on team Tiny Speck, so here are some pong details:\n>>>since_last_pong_ms too long! "+t+" > "+T+" ... calling disconnect(), expect to get an onDisconnect() callback");try{TS.ds.disconnect();clearTimeout(d);d=setTimeout(function(){TS.info("called disconnect, no onDisconnect callback happened in "+c+"ms, so calling _onDisconnect() manually now");C(null,"since_last_pong_ms too long! then called disconnect, but no onDisconnect callback happened in "+c+"ms, so calling _onDisconnect() manually now")},c)}catch(e){TS.info("since_last_pong_ms too long! then an error calling disconnect, going to assume it is because it is already closed, calling _onDisconnect() manually now");TS.warn(e);C(null,"error calling disconnect, going to assume it is because it is already closed, calling _onDisconnect() manually now")}};var x=function e(){TS.ds.send({type:"ping"});S=true};var C=function e(t,r){r=r||"_onDisconnect called with event:"+t;TS.info("DS WS disconnected");TS.ds.logConnectionFlow("on_disconnect");clearTimeout(d);clearTimeout(l);clearTimeout(i);if(t)TS.info("_onDisconnect event.code:"+t.code);else TS.info("no event");TS.ds.onFailure(r)};var M=function e(t){TS.warn("_reportDisconnect reason_str:"+t)};var I=function e(){if(!h)return;h.onmessage=null;h.onopen=null;h.onerror=null;h.onclose=null;try{h.close()}catch(e){}};var P=function e(){var t=TS.model.ds_reconnect_time-Date.now();var r=Math.round(t/1e3);if(r>=0)TS.ds.reconnecting_sig.dispatch(r);if(TS.model.window_unloading)clearInterval(m)};var A=function e(){var t="socket received no hello msg "+u+"ms after connection";TS.warn(t);TS.ds.logConnectionFlow("_onHelloTimeout");TS.ds.onFailure(t)};var E=function e(){v+=1;var t="socket not connected "+a+"ms after creation. _connect_timeout_count:"+v;TS.warn(t);TS.ds.logConnectionFlow("_onConnectTimeout");if(3==v){TS.client.showConnectionTroubleDialog();return}else if(2==v)if(window.WEB_SOCKET_USING_FLASH);else if(TS.model.is_chrome_desktop){s=2e4;return}TS.ds.onFailure(t)};var F=function e(t){var r="";if(t){if(t.name)r+=" e.name="+t.name;if(t.message)r+=" e.message="+t.message;if(t.data)r+=" e.data="+t.data}TS.warn("_onError err_str: "+r);TS.dir(0,t)};var O=function e(t){if(t.error)if(1==t.error.code)TS.ds.logConnectionFlow("msg_error_code_1");else{TS.info("_onErrorMsg websocket is connected but we got an error message: "+JSON.stringify(t));TS.ds.onFailure("_onErrorMsg imsg.error:"+t.error)}else TS.info("_onErrorMsg: "+(t?JSON.stringify(t):"no imsg?"))};var B=function i(){clearTimeout(l);var a=Date.now()-TS.ds.last_pong_time;TS.info("Hello msg recvd, since_last_pong_ms:"+a);TS.ds.logConnectionFlow("on_hello");clearInterval(m);S=true;TS.ds.last_pong_time=Date.now();clearInterval(e);e=setInterval(k,t);clearInterval(r);r=setInterval(x,n);TS.model.ds_connecting=false;TS.model.ds_connected=true;var s;for(var o=0;o<TS.ds.Q.length;o+=1){s=TS.ds.Q.shift();if(TS.has_pri[$])TS.log($,"TS.ds (Q) --\x3e\n"+JSON.stringify(s,null,"  "));h.send(JSON.stringify(s))}TS.ds.connected_sig.dispatch();x()};var $=2})()},4793:function(e,t){(function(){TS.registerModule("templates",{onStart:function t(){r();if(TS.members)TS.members.user_color_changed_sig.add(TS.templates.memberUserColorChanged,TS.templates);if(TS.prefs)TS.prefs.sidebar_behavior_changed_sig.add(TS.templates.sidebarBehaviorPrefChanged,TS.templates);TS.environment.retina_changed_sig.add(e)},makeUnreadMessagesDomId:function e(t){return TS.utility.makeSafeForDomId("activity_unread_messages_"+t.id)},makeRxnKeyDomClass:function e(t){return TS.utility.makeSafeForDomId("rxns_key_"+t)},makeUnreadGroupMessagesDomId:function e(t){return TS.utility.makeSafeForDomId("activity_unread_group_messages_"+t.id)},makeUnreadDmsDomId:function e(t){return TS.utility.makeSafeForDomId("activity_unread_dms_"+t.id)},makeSentMessagesDomId:function e(t){return TS.utility.makeSafeForDomId("activity_sent_messages_"+t.id)},makeSentGroupMessagesDomId:function e(t){return TS.utility.makeSafeForDomId("activity_sent_group_messages_"+t.id)},makeIssueListDomId:function e(t){return"issue_list_"+t},makeSentDmsDomId:function e(t){return TS.utility.makeSafeForDomId("activity_sent_dms_"+t.id)},makeMsgDomId:function e(t){return TS.utility.makeSafeForDomId("msg_"+t)},makeMsgLabelDomId:function e(t){return TS.utility.makeSafeForDomId("msg_"+t+"_label")},makeMsgAttachmentTextExpanderDomId:function e(t,r){return TS.utility.makeSafeForDomId("msg_rest_text_expander_"+t+"_"+r)},makeMSRDomId:function e(t){return TS.utility.makeSafeForDomId("MSR_"+t.channel.id+"_"+t.ts)},makeMSRDomIdWithModule:function e(t,r){return TS.utility.makeSafeForDomId("MSR_"+t.channel.id+"_"+t.ts+"_"+r)},makeSHRoomClass:function e(t){return TS.utility.makeSafeForDomId("screenhero_room_"+t)},makeChannelDomId:function e(t){return"channel_"+t.id},makeChannelDragData:function e(t){return JSON.stringify({id:t.id,name:t.name,is_channel:t.is_channel||false,is_group:t.is_group||false,is_im:t.is_im||false,is_mpim:t.is_mpim||false,is_self_im:t.is_self_im||false,is_slackbot_im:t.is_slackbot_im||false,purpose:t.purpose?t.purpose.value:"",topic:t.topic?t.topic.value:""})},makeFileDragData:function e(t){return JSON.stringify({id:t.id,name:t.name,title:t.title,mimetype:t.mimetype,filetype:t.filetype,size:t.size})},makeDayDividerDomId:function e(t){return TS.utility.makeSafeForDomId("day_divider_"+t)},makeGroupDomId:function e(t){return"group_"+t.id},makePriorityIconDomId:function e(t){return"priority_"+t.id},makeStarredIconDomId:function e(t){return"starred_"+t.id},makeMutedIconDomId:function e(t){return"muted_"+t.id},makeMemberDomId:function e(t){if(!t)return;return TS.templates.makeMemberDomIdById(t.id)},makeMemberDomIdById:function e(t){if(!t)return;return"member_"+t},makeMpimDomId:function e(t){return"mpim_"+t.id},makeChannelListDomId:function e(t){return"channel_"+t.id+"_member_list"},makeFileDomId:function e(t){return"file_"+t.id},makeFileCommentsDomId:function e(t){return"file_comments_"+t.id},makeFileContentsDomId:function e(t){return"file_contents_"+t.id},makeUnreadMsgsDomId:function e(t){return"unread_msg_"+t.id},makeUnreadHighlightDomId:function e(t){if(!t)return;return"unread_highlight_"+t.id},makeMemberPresenceDomClass:function e(t){return"member_presence_"+t},makeMemberPresenceStateClass:function e(t){var r=TS.redux.presence.getPresenceByMemberId(t.id);if(TS.dnd.isMemberInDnd(t))r+=" dnd";return r},makeMemberPresenceStateAriaLabel:function e(t){var r=t.presence;var n="";if("active"===r)n+="active";else if("away"===r)n+="away";if(TS.dnd.isMemberInDnd(t))n+=", do not disturb";return n},makeMemberPresenceIcon:function e(t){if(t.deleted)return"";var r=TS.templates.makeMemberPresenceDomClass(t.id);var n="ts_icon_presence";var i="active"===t.presence?TS.i18n.t("active","templates_helpers")():TS.i18n.t("away","templates_helpers")();if(t.is_ultra_restricted){r+=" ura";n="ts_icon_presence_ura"}else if(t.is_restricted){r+=" ra";n="ts_icon_presence_ra"}else if(TS.utility.teams.isMemberExternal(t)){r+=" external";n="ts_icon_presence_external"}else if(t.is_slackbot)n="ts_icon_heart";var a='<i aria-hidden="true" class="ts_icon '+n+' presence_icon"></i>';var s=TS.templates.makeMemberPresenceStateClass(t);var o='<span data-member-presence="'+t.id+'" class="presence '+s+" "+r+'" title="'+i+'">'+a+"</span>";return o},makeMemberStatusDomClass:function e(t){return"member_status_"+t},memberUserColorChanged:function e(t){var r="color_"+t.id;if(t.color==t.member_color){var n="color_rule_"+r;var i=$("#"+n);i.remove();return}TS.templates.makeUserColorRule(t)},makeUserColorRule:function e(t){var r="color_"+t.id;var n="#"+_.escape(t.member_color);var i;if(TS.client)i="\t\t\t\t."+r+":not(.nuc), \t\t\t\t#col_channels ul li:not(.active):not(.away) > ."+r+":not(.nuc) {\t\t\t\t\tcolor:"+n+";\t\t\t\t}\t\t\t";else i="\t\t\t\t."+r+":not(.nuc) {\t\t\t\t\tcolor:"+n+";\t\t\t\t}\t\t\t";var a="color_rule_"+r;var s=$("#"+a);if(s.length)s.text(i);else $('<style type="text/css" id="'+a+'">'+i+"</style>").appendTo("body")},sidebarBehaviorPrefChanged:function e(){TS.templates.makeSidebarBehaviorRule()},makeSidebarBehaviorRule:function e(){var t;var r="sidebar_behavior";var n=$("#"+r);if("hide_read_channels"===TS.prefs.getPref("sidebar_behavior"))t="\t\t\t\t.channels_list_holder ul li:not(.unread):not(.active):not(.show_in_list_even_though_no_unreads) {\t\t\t\t\tdisplay: none;\t\t\t}";else if("hide_read_channels_unless_starred"===TS.prefs.getPref("sidebar_behavior"))t="\t\t\t\t.channels_list_holder div:not(#starred_div)>ul li:not(.unread):not(.active):not(.is_starred):not(.show_in_list_even_though_no_unreads) {\t\t\t\t\tdisplay: none;\t\t\t}";if(t)if(n.length)n.text(t);else $('<style type="text/css" id="'+r+'">'+t+"</style>").appendTo("head");else $("#"+r).remove()},makeMsgDomIdInConversation:function e(t){return TS.templates.makeMsgDomId(t)+"_conversation"},makeMsgDomIdInSearch:function e(t,r){return TS.templates.makeMsgDomId(t)+"_"+TS.templates.makeMSRDomId(r)},makeMsgDomIdInSearchTopResults:function e(t,r,n){return TS.templates.makeMsgDomId(t)+"_"+TS.templates.makeMSRDomId(r)+"_"+n},makeMsgDomIdInUnreadView:function e(t){return TS.templates.makeMsgDomId(t)+"_unread_view"},makeMsgDomIdInThreadsView:function e(t){return TS.templates.makeMsgDomId(t)+"_threads_view"},promiseToRenderAsync:function e(t,r){if(!t)return Promise.reject(new Error("No template to render"));return Promise.resolve(r).then(function(e){return t(e)})}});var e=function e(){var t;var r;var n;var i;$(".member_image").each(function(){i=$(this);t=i.data("member-id");r=i.data("thumb-size");n=!i.is("a");if(t&&r)$(this).replaceWith(TS.templates.builders.makeMemberPreviewLinkImage(t,r,false,n))});i=null};var t=/{{\s*i18n_ns\s*('|")[a-zA-Z0-9]+('|")\s*}}/;var r=function e(){Object.keys(TS.raw_templates).forEach(function(e){TS.templates[e]=n(e,TS.raw_templates[e]);Handlebars.registerPartial(e,TS.templates[e])});delete TS.raw_templates};var n=function e(r,n){if(!n){TS.warn(r+" was passed no html");return null}if(t.test(n))n+=" {{_i18n_ns_end}}";var i=Handlebars.compile(n);return function(e){e=e||{};return i(e)}}})()},4794:function(e,t){var r="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};(function(){TS.registerModule("templates.builders",{debug_items:{},debug_items_index:0,buildStarComponents:function e(r,n,i){return t(r,n,i)},fileHTML:function e(t,r){r=r||{};var n=TS.utility.members.getEntityFromFile(t);var i=TS.files.getFileActions(t);var a;var s="hosted"===t.mode||"external"===t.mode;var o={member:n,file:t,for_search:r.for_search,is_enterprise:r.is_enterprise,for_files_list:!r.for_share_dialog,show_channel_name:r.show_channel_name,icon_class:TS.utility.getImageIconClass(t,"thumb_80"),is_email:"email"===t.mode,is_space:"space"===t.mode,is_post:"post"===t.mode,is_snippet:"snippet"===t.mode,is_hosted_or_external:s,has_image:s&&t.thumb_80&&!t.has_rich_preview,can_share:!!i.share};if(TS.client)o.info_pane_visible="details"===TS.model.ui_state.flex_name;o.supports_line_clamp=TS.environment.supports_line_clamp;if("external"===t.mode)o.external_filetype_html=TS.templates.builders.makeExternalFiletypeHTML(t);if("email"===t.mode){o.to_more_count=t.to.length-1;o.cc_more_count=t.cc.length-1}a=TS.templates.file_list_item(o);return a},buildReplyBarHTML:function e(t,r){var n={msg:t,model_ob:r,conversation_permalink:TS.utility.msgs.constructConversationPermalink(r,t.thread_ts)};var i=t.replies;if(TS.boot_data.feature_threads_perf&&t.reply_count){n.num_replies=t.reply_count;n.first_repliers=_.chain(t.reply_users).take(5).map(function(e){return TS.members.getPotentiallyUnknownMemberById(e)}).compact().value();n.additional_reply_count=t.reply_users_count-n.first_repliers.length}else if(i&&i.length){n.num_replies=i.length;var a=_.chain(i).uniqBy("user").map(function(e){return TS.members.getPotentiallyUnknownMemberById(e.user)}).compact().value();n.first_repliers=_.take(a,5);n.additional_reply_count=a.length-n.first_repliers.length}if(n.num_replies){var s=TS.boot_data.feature_threads_perf?t.latest_reply:_.last(i).ts;var o=TS.interop.datetime.toDateObject(s);if(TS.interop.datetime.isSameDay(o,new Date))if(1===n.num_replies)n.last_reply_at=TS.i18n.t("Today at {time}","threads")({time:TS.interop.datetime.toTime(s,{do24hrTime:TS.utility.date.do24hrTime()})});else n.last_reply_at=TS.i18n.t("Last reply today at {time}","threads")({time:TS.interop.datetime.toTime(s,{do24hrTime:TS.utility.date.do24hrTime()})});else if(1===n.num_replies)n.last_reply_at=TS.interop.datetime.toTimeAgo(s);else n.last_reply_at=TS.i18n.t("Last reply {time_ago}","threads")({time_ago:TS.interop.datetime.toTimeAgo(s)})}return TS.templates.message_reply_bar(n)},formatSoundUrl:function e(t,r){return""},buildAttachmentActions:function e(t,r,n){var i=t.actions.map(function(e){switch(e.type){case"button":return TS.templates.builders.buildAttachmentActionButtonHTML(e,n);case"select":return TS.templates.builders.buildAttachmentActionSelectHTML(e,n,r,t.id)}return});var a=i.join("");return a},buildAttachmentHTML:function e(t){var r=t.msg_dom_id||TS.templates.makeMsgDomId(t.msg.ts);var n=t.attachment;var i=t.model_ob||TS.shared.getActiveModelOb();if(TS.templates.builders.shouldDoSimpleAttachment(n,t.msg))if(n.video_html)return TS.templates.builders.buildInlineVideoTogglerAndDiv(n.from_url,r);else if(n.image_url)return TS.templates.builders.buildInlineImgTogglerAndDiv(n.from_url,r,t);else if(n.audio_url)return" "+TS.templates.builders.formatSoundUrl(n,t.msg);if(n.color){if("number"===typeof n.color)n.color=n.color.toString();if(!n.color.indexOf){TS.warn("msg "+t.msg.ts+" has an invalid (non string) color:"+n.color+" (removed in client)");delete n.color}else n.color=n.color.replace(/#/g,"")}var a=[];var s=[];if(n.fields){var o;var l;var u;for(var d=0;d<n.fields.length;d+=1){l=true;o=n.fields[d];if(u&&o.short&&u.short&&u._new_row)l=false;o._new_row=l;u=o;if(o.short)a.push(o);else s.push(o)}}var c=!n._always_expand&&n._short_text&&!TS.inline_attachments.shouldExpandText(TS.templates.makeMsgAttachmentTextExpanderDomId(t.msg.ts,n._index));var m=!!n.more;var f=n.from_url||n.ts_link||n.title_link||n.author_link;var p="reply_broadcast"===_.get(t.msg,"subtype");var h=n.thumb_link||f;var g=false;if(!i)TS.warn("need to get model_ob passed in here somehow! for expanding messages in activity feed");else if(false!==t.can_delete)g=(n.id||0===n.id)&&(n.from_url||t.msg.text)&&(TS.model.user.is_admin&&!i.is_im||TS.model.user.id==t.msg.user)&&"pinned_item"!==t.msg.subtype&&!p;var S=n.thumb_url&&!n.image_url&&!n.video_html&&!n.audio_html;var T=S?n.proxied_thumb_url||n.thumb_url:null;var v=false;var b="";if(n.is_msg_unfurl){var y=TS.utility.msgs.getMsg(n.ts,i.msgs);if(y&&y.pinned_to&&y.pinned_to.length>0){v=_.some(y.pinned_to,function(e){return e===i.id});if(v&&!p)b=TS.templates.builders.buildPinInfoHtml(y)}}var w=false;if(p)if(n.ts)w=TS.interop.datetime.toTime(n.ts,{do24hrTime:TS.utility.date.do24hrTime()});else w=TS.interop.datetime.toTime(t.msg.ts,{do24hrTime:TS.utility.date.do24hrTime()});var k=n.from_url&&t.has_container;if(p)k=true;var x={is_text_collapsed:c,has_more:m,attachment:n,attachment_meta:w,pin_html:b,short_fields:a,long_fields:s,msg:t.msg,msg_dom_id:r,real_src:TS.utility.attachments.getMediaSource(n),is_standalone:!t.msg.text||t.msg.ignore_if_attachments_supported||!n.pretext,show_fields_table:"0"!=TS.qs_args.show_fields_table,can_delete:g,thumb_link:h,small_thumb_url:T,show_fallback:TS.model.show_attachment_fallback,enable_slack_action_links:true===t.enable_slack_action_links};if(!t.from_post){var C="web"===TS.boot_data.app||true!==t.enable_slack_action_links;var M;if(C)if("web"===TS.boot_data.app)M="ARCHIVES";else if(TS.shared.getActiveModelOb().is_channel&&!TS.shared.getActiveModelOb().is_member)M="CHANNEL_PREVIEW";else M="OTHER";x=_.assign(x,{attachment:n,has_actions:!!(!_.isEmpty(n.actions)||!_.isEmpty(n.legacy_actions)),has_source:_.some(n._source),has_border:t.has_border,has_indent:n.indent,has_container:t.has_container,has_media:t.show_media_caret,has_text_content:!!(n.text||n.title),has_thumb:!!S,has_footer:!!(n.footer||n.footer_icon||n.ts||n._attribution)&&!p,disable_actions:C,disable_actions_reason:M,border_color:n.color&&"#"+n.color||null,break_border:t.break_border,caret_location:TS.utility.attachments.getMediaCaretLocation(n)});x.applied_classes=TS.utility.getAppliedClasses({inline_attachment:true,standalone:x.is_standalone,has_thumb:x.has_thumb,can_delete:x.can_delete,clickable:k,message_unfurl:n._unfurl_type_message,reply_broadcast:p,is_pinned:v});if(n.callback_id){var I=TS.attachment_actions.client_buttons.fetchClientButtonData(t.msg);if(I){x.client_buttons=TS.attachment_actions.client_buttons.generateActions(I,n);x.has_text_content=!x.client_buttons.actions}}if(x.has_footer&&x.attachment.is_msg_unfurl){var P=TS.utility.attachments.getSlackMessageFooterText(x.attachment,x.msg);if(P)x.attachment.footer=P}return TS.templates.message_attachment(x)}var A=true;var E="";if(t.show_initial_caret||t.show_media_caret){var F=TS.utility.attachments.getMediaType(n);switch(F){case"video":var O=TS.model.inline_videos[n.from_url||n.thumb_url];if(O){var B=true;E=TS.templates.builders.buildInlineVideoToggler(n.from_url||n.thumb_url,r,B);A=TS.inline_videos.shouldExpand(r,O)}break;case"audio":var $=TS.model.inline_audios[n.audio_html||n.audio_url];if($){E=TS.templates.builders.buildInlineAudioToggler(n.audio_html||n.audio_url,r);A=TS.inline_audios.shouldExpand(r,$)}break;case"other":var D=TS.model.inline_others[n.other_html];if(D){E=TS.templates.builders.buildInlineOtherToggler(n.other_html,r);A=TS.inline_others.shouldExpand(r,D)}break;case"image":var H=TS.model.inline_imgs[n.from_url||n.image_url];if(H){var j=!t.show_media_caret;E=TS.templates.builders.buildInlineImgToggler(n.from_url||n.image_url,r,j);A=TS.inline_imgs.shouldExpand(r,H)}break;default:var R=TS.model.inline_attachments[n.from_url];if(R){E=TS.templates.builders.buildInlineAttachmentToggler(n.from_url,r);A=TS.inline_attachments.shouldExpand(r,R)}else TS.warn("no inline_attachment for "+n.from_url)}}_.assign(x,{initial_caret_html:t.show_initial_caret?new Handlebars.SafeString(E):"",media_caret_html:t.show_media_caret?new Handlebars.SafeString(E):"",expand_media:t.show_media_caret?A:true,expand_it:t.show_initial_caret?A:true,bg_color:n.color||"e3e4e6",thumb_at_top:!window.attach_thumb_align_title,ts_link:f,small_thumb:S,max_width_class:S?"right_thumb_max_w":"",show_action_links:true===t.enable_slack_action_links,has_content:t.has_content});return TS.templates.spaces_attachment(x)},buildAttachmentActionButtonHTML:function e(t,r){r=true===r;var n={_disabled:r,_loading:false,id:"",name:"",style:"default",text:"",value:""};var i={default:"",primary:"btn_primary",danger:"btn_danger"};var a=t.clicked&&t.clicked_text?t.clicked_text:t.text;var s=TS.emoji.graphicReplace(a);var o=_.merge({},n,t,{btn_class:i[t.style],current_text:a,formatted_text:new Handlebars.SafeString(s)});o.data_qa_value="button-"+o.name.replace("_","-");return TS.templates.attachment_actions_button(o)},buildAttachmentActionSelectHTML:function e(t,r,n,i){var a=TS.attachment_actions.select.getActionModel(t,r);if(a._disabled){var s='ts-message[data-ts="'+n+'"]';var o='[data-attachment-id="'+i+'"]';var l='[data-action-id="'+t.id+'"]';var u=[s,o,l].join(" ");var d=$(u).next(".lazy_filter_select");if(!d.length)return"";var _=d.clone().addClass("disabled");return _[0].outerHTML}return TS.templates.attachment_actions_select(a)},shouldDoSimpleAttachment:function e(t,r){var n=false;if(r.standalone_attachment)return false;if((t.image_url||t.audio_url)&&t.from_url){if(r&&r.text){if(-1!=r.text.indexOf(t.from_url))n=true;if(TS.model.ampersands_are_inconsistent_in_from_urls)if(-1!=r.text.indexOf(t.from_url.replace(/&/g,"&amp;")))n=true}if(t.service_name||t.title)n=false}return n},formatAttachments:function e(t,r,n,i){if(!t.attachments)return"";var a="";var s;var o=[];var l;var u=t.attachments.length;var d=20;if(t.attachments.length>=d){if(!t._shown_attachments)t._shown_attachments=d;u=t._shown_attachments}for(s=0;s<u;s+=1){l=t.attachments[s];if(l.pretext||0===s)o.push([]);_.last(o).push(l)}for(s=0;s<o.length;s+=1)a+=TS.templates.builders.formatAttachmentGroup(o[s],t,n,i,r);if(t._shown_attachments<t.attachments.length)a+=TS.templates.builders.getShowMoreAttachmentHTML(t);return a},formatAttachmentGroup:function e(t,r,n,i,a){n=true===n;var s="";var o=false;t=t.map(function(e){return TS.utility.attachments.getDecoratedAttachment(e,r)});var l=r&&"reply_broadcast"===r.subtype;if(l)o=true;var u=o&&_.some(t,TS.utility.attachments.getMediaType);var d=o?_.some(t,"color"):true;var c=_.some(t,"from_url");var m=_.some(t,"indent");var f=false;if(l){var p=r.channel_id||_.get(t[1],"channel_id");var h=r.broadcast_thread_ts;if((!p||!/\d+\.\d+/.test(h))&&t[1]&&t[1].from_url){var g=t[1].from_url;var S=TS.interop.url.urlQueryStringParse(g);if(S.cid)p=S.cid;if(S.thread_ts)h=S.thread_ts}a=TS.shared.getModelObById(p);if(a&&h){if(h.indexOf(".")<0)h=h.substr(0,10)+"."+h.substr(10);var T={thread_ts:h,model_ob_id:a.id,convo_href:TS.utility.msgs.constructConversationPermalink(a,h)};f=TS.templates.reply_broadcast_preamble(T);f=new Handlebars.SafeString(f)}}var v;for(var b=0;b<t.length;b+=1){v=t[b];if(!v){TS.info("formatAttachments bad attach");TS.dir(0,r);continue}if(v.from_url&&(TS.boot_data.feature_attachments_inline||TS.templates.builders.shouldDoSimpleAttachment(v,r))){s+="";continue}if(v.ts)v.ts_link=TS.utility.msgs.constructMsgPermalink(a,v.ts.toString());if(!TS.inline_attachments.shouldShow(v,r)){s+="";continue}if(v.actions&&v.actions.length){var y=["button","select"];var w;var k=[];var x=[];for(var C=0;C<v.actions.length;C+=1){w=v.actions[C];if(_.includes(y,w.type))x.push(w);else k.push(w)}if(k.length)v.legacy_actions=k;if(x.length)v.actions=x}var M=TS.utility.attachments.hasContent(v,["pretext"]);if(M){var I=t[b+1];s+=TS.templates.builders.buildAttachmentHTML({model_ob:a,attachment:v,has_border:d,has_indent:m,has_container:o,break_border:d&&I&&v.color!=I.color,url:null,msg:r,msg_dom_id:i,show_initial_caret:TS.templates.builders.shouldDoSimpleAttachment(v,r),show_media_caret:v.video_html||v.image_url||v.audio_html||v.audio_url||v.other_html,enable_slack_action_links:n,has_content:M})}if(l&&0===b)s+=TS.templates.reply_broadcast_count(v)}if(s||v.pretext)return TS.templates.attachment_group({model_ob:a,first_attachment:t[0],preamble:f,msg:r,has_border:d,has_indent:m,has_container:o,has_link:c,use_shrink_wrap:u,attachments_html:s&&new Handlebars.SafeString(s),enable_slack_action_links:n});return s},getShowMoreAttachmentHTML:function e(t){var r=t.attachments.length-t._shown_attachments;var n="";var i=t.ts;var a=TS.shared.getActiveModelOb();var s=false;if(TS.client&&!(a.is_channel&&!a.is_member)){s=true;if(t.attachments.length-t._shown_attachments>20)n=TS.i18n.t("Show next 20 items","attachments")();else n=TS.i18n.t("{count, plural, =1 {Show remaining # item} other {Show remaining # items}}","attachments")({count:r})}else n=TS.i18n.t("{count, plural, =1 {# more attachment} other {# more attachments}}","attachments")({count:r});return TS.templates.show_more_attachment({ts:i,btn_text:n,clickable_show_more_link:s})},formatMessageAsAttachment:function e(t,r){var n;var i;var a;if(t.user)i=t.user;else if("file_comment"===t.subtype&&t.comment&&t.comment.user)i=t.comment.user;else if(t.bot_id)a=t.bot_id;if(!t.text&&t.attachments&&t.attachments.length>=1&&t.attachments[0].is_share)n={author_name:t.attachments[0].author_name,author_subname:t.attachments[0].author_subname,author_icon:t.attachments[0].author_icon,author_link:t.attachments[0].author_link};else if(i){var s=TS.members.getMemberById(i);n={};n.author_name=TS.members.getPrefCompliantMemberName(s);if(s.profile)n.author_icon=s.profile.image_24;n.author_link="/team/"+i}else if(a){var o=TS.bots.getBotByMsg(t);n={author_subname:t.username||o.name,author_icon:o&&o.icons.image_48,author_link:"/services/"+a};if(t.icons&&t.icons.emoji&&t.icons.image_64)n.author_icon=t.icons.image_64}if(!n){TS.error("no author for msg "+t.ts);return""}var l=_.extend({},n,{is_msg_unfurl:true,id:1,ts:t.ts,from_url:TS.utility.msgs.constructAbsoluteMsgPermalink(r,t.ts),msg_subtype:t.subtype});if(t.text){l.text=t.text;l.mrkdwn_in_hash={text:true}}else if(t.attachments&&t.attachments.length>=1){var u=t.attachments[0];l.text=u.text||u.pretext}TS.inline_attachments.massageAttachment(l,0);l=TS.utility.attachments.getDecoratedAttachment(l,t);var d=TS.templates.builders.buildAttachmentHTML({attachment:l,msg:t,can_delete:false,has_content:true,has_border:true});d=TS.templates.attachment_group({msg:t,attachments_html:new Handlebars.SafeString(d)});return d},buildSHRoomAttachment:function e(t){var r=t.participants.map(function(e){return TS.members.getPotentiallyUnknownMemberById(e)});var n=t.created_by===TS.model.user.id;var i=TS.model.active_im_id?TS.members.getMemberById(TS.ims.getImById(TS.model.active_im_id).user):null;var a=i?TS.members.getPrefCompliantMemberName(i):"";var s=t.date_end?t.date_end-t.date_start:0;var o=TS.i18n.t("Shared a call","calls")();if(t.channels&&t.channels[0]===TS.model.active_cid)o=TS.i18n.t("Started a call","calls")();var l="";if(t.date_end)if(t.is_dm_call&&t.was_missed)if(t.was_rejected)if(n)l=TS.i18n.t("{name} declined the call","calls")({name:a});else l=TS.i18n.t("You declined the call","calls")();else if(n)l=TS.i18n.t("{name} missed the call","calls")({name:a});else l=TS.i18n.t("You missed the call","calls")();else l=TS.i18n.t("This call has ended","calls")();else if(!t.is_dm_call)l=-1!=t.participants.indexOf(TS.model.user.id)?TS.i18n.t("You are on this call","calls")():TS.i18n.t("Join this call","calls")();else if(2===t.participants.length)l=TS.i18n.t("On a call with {name}","calls")({name:a});else l=(n?TS.i18n.t("Calling {name}","calls"):TS.i18n.t("{name} is calling you","calls"))({name:a});var u;if(t.name)u=TS.i18n.t("{room_name} call","calls")({room_name:t.name});else u=TS.i18n.t("Untitled","calls")();return TS.templates.message_screenhero_attachment({room:t,participants:r,room_url:TS.utility.calls.getUrlForRoom(t),meta_room_name:_.escape(u),room_name:_.escape(t.name),title:o,description:l,show_description_ellipsis:2===t.participants.length,show_room_link:!t.date_end,expand_it:TS.inline_room_previews.shouldExpand(t.id),duration:s})},buildBotStr:function e(t,r){var n;if(TS.shared.isModelObShared(r)||TS.shared.isModelObOrgShared(r))if(t.bot_link)n=TS.bots.getBotNameByBotLink(t.bot_link);else n=TS.bots.getBotNameByBotLink(t.text);else n=TS.bots.getBotNameById(t.bot_id);var i="<"+TS.boot_data.team_url+"services/"+t.bot_id+"/|"+n+">";switch(t.subtype){case"bot_add":return TS.i18n.t("added an integration to this channel: {bot_url}","templates_builders")({bot_url:i});case"bot_enable":return TS.i18n.t("enabled an integration in this channel: {bot_url}","templates_builders")({bot_url:i});case"bot_disable":return TS.i18n.t("disabled an integration in this channel: {bot_url}","templates_builders")({bot_url:i});case"bot_remove":return TS.i18n.t("removed an integration from this channel: {bot_url}","templates_builders")({bot_url:i});default:return TS.i18n.t("updated an integration in this channel: {bot_url}","templates_builders")({bot_url:i})}},formatMessageByType:function e(t,r,n,i,a){var s="";var o;if(t.ignore_if_attachments_supported)return s;r=true===r;n=true===n;var l;var u;var d;var c;var m;var f;var p;var h;var g;var S;var T;var v;if(t._jl_rollup_hash&&t.user in t._jl_rollup_hash.users){var b=false;var y=true;var w=function e(t){t=t.map(function(e){return e.id});var r=_.remove(t,function(e){return!TS.members.getMemberById(e)});if(0===t.length)return[];var n;var i=100;if(t.length>i+1){var a=t.length-i+r.length;t=t.splice(0,i);n=TS.i18n.t("{count, plural, =1 {# other} other {# others}}","joined_left")({count:a})}else if(r.length)n=TS.i18n.t("{count, plural, =1 {# other} other {# others}}","joined_left")({count:r.length});t=t.map(function(e){return TS.members.getPrefCompliantMemberNameById(e,false,b)});if(n)t.push(n);return t};var k=function e(t){var r=TS.members.getPrefCompliantMemberNameById(t,y,b);return'<button type="button" class="btn_unstyle internal_member_link member_preview_link" data-member-id="'+t+'">'+r+"</button>"};var x;var C;var M;var I;var P;var A={joined:[],joined_left:[],left:[],left_rejoined:[]};for(var E in t._jl_rollup_hash.users)if(E!==t.user){I=t._jl_rollup_hash.users[E];var F={id:E,inviter:I.inviter};if(I.is_in)if(I.left&&I.joined)A.left_rejoined.push(F);else A.joined.push(F);else if(I.joined&&I.left)A.joined_left.push(F);else A.left.push(F)}if(i.is_group||i.is_private)c=TS.model.group_prefix+i.name;else if(i)c="#"+i.name;else c="no_name";I=t._jl_rollup_hash.users[t.user];if(I.is_in)if(I.left&&I.joined)if(I.inviter){var O=A.left_rejoined.filter(function(e){return e.inviter===I.inviter});A.left_rejoined=A.left_rejoined.filter(function(e){return e.inviter===I.inviter});x=O.length?O[0].id:null;P=w(O);s=TS.i18n.t('left and rejoined {channel_name, select, no_name {the channel} other {{channel_name}}} by invitation from {inviter}{count, plural, =0 {} =1 {, along with {user}} other {, along with <span class="{classes}" title="{others}"># others</span>}}.',"joined_left")({count:O.length,user:k(x),channel_name:c,inviter:k(I.inviter),others:TS.i18n.listify(P).join(""),classes:P.length>0?"ts_tip ts_tip_multiline ts_tip_lazy ts_tip_top ts_tip_float":""})}else{x=A.left_rejoined.length?A.left_rejoined[0].id:null;P=w(A.left_rejoined);s=TS.i18n.t('left and rejoined {channel_name, select, no_name {the channel} other {{channel_name}}}{count, plural, =0 {} =1 { along with {user}} other { along with <span class="{classes}" title="{others}"># others</span>}}.',"joined_left")({count:A.left_rejoined.length,user:k(x),channel_name:c,others:TS.i18n.listify(P).join(""),classes:P.length>0?"ts_tip ts_tip_multiline ts_tip_lazy ts_tip_top ts_tip_float":""});A.joined_left=[]}else if(I.inviter){var B=A.joined.filter(function(e){return e.inviter===I.inviter});A.joined=A.joined.filter(function(e){return e.inviter!==I.inviter});x=B.length?B[0].id:null;P=w(B);s=TS.i18n.t('joined {channel_name, select, no_name {the channel} other {{channel_name}}} by invitation from {inviter}{count, plural, =0 {} =1 {, along with {user}} other {, along with <span class="{classes}" title="{others}"># others</span>}}.',"joined_left")({count:B.length,user:k(x),channel_name:c,inviter:k(I.inviter),others:TS.i18n.listify(P).join(""),classes:P.length>0?"ts_tip ts_tip_multiline ts_tip_lazy ts_tip_top ts_tip_float":""})}else{x=A.joined.length?A.joined[0].id:null;P=w(A.joined);s=TS.i18n.t('joined {channel_name, select, no_name {the channel} other {{channel_name}}}{count, plural, =0 {} =1 { along with {user}} other { along with <span class="{classes}" title="{others}"># others</span>}}.',"joined_left")({count:A.joined.length,user:k(x),channel_name:c,others:TS.i18n.listify(P).join(""),classes:P.length>0?"ts_tip ts_tip_multiline ts_tip_lazy ts_tip_top ts_tip_float":""});A.joined=[]}else if(I.joined&&I.left){x=A.joined_left.length?A.joined_left[0].id:null;P=w(A.joined_left);s=TS.i18n.t('joined and left {channel_name, select, no_name {the channel} other {{channel_name}}}{count, plural, =0 {} =1 { along with {user}} other { along with <span class="{classes}" title="{others}"># others</span>}}.',"joined_left")({count:A.joined_left.length,user:k(x),channel_name:c,others:TS.i18n.listify(P).join(""),classes:P.length>0?"ts_tip ts_tip_multiline ts_tip_lazy ts_tip_top ts_tip_float":""});A.joined_left=[]}else{x=A.left.length?A.left[0].id:null;P=w(A.left);s=TS.i18n.t('left {channel_name, select, no_name {the channel} other {{channel_name}}}{count, plural, =0 {} =1 { along with {user}} other { along with <span class="{classes}" title="{others}"># others</span>}}.',"joined_left")({count:A.left.length,user:k(x),channel_name:c,others:TS.i18n.listify(P).join(""),classes:P.length>0?"ts_tip ts_tip_multiline ts_tip_lazy ts_tip_top ts_tip_float":""});A.left=[]}var $=true;if(A.left_rejoined.length){C=A.left_rejoined.shift().id;M=A.left_rejoined.length?A.left_rejoined[0].id:null;var D=$?TS.i18n.t('Also, {userA}{count, plural, =0 {} =1 { and {userB}} other { and <span class="{classes}" title="{others}"># others</span>}} left and rejoined.',"joined_left"):TS.i18n.t('{userA}{count, plural, =0 {} =1 { and {userB}} other { and <span class="{classes}" title="{others}"># others</span>}} left and rejoined.',"joined_left");$=false;P=w(A.left_rejoined);s+=" ";s+=D({count:A.left_rejoined.length,userA:k(C),userB:k(M),others:TS.i18n.listify(P).join(""),classes:P.length>0?"ts_tip ts_tip_multiline ts_tip_lazy ts_tip_top ts_tip_float":""})}if(A.joined.length){C=A.joined.shift().id;M=A.joined.length?A.joined[0].id:null;var H=$?TS.i18n.t('Also, {userA}{count, plural, =0 {} =1 { and {userB}} other { and <span class="{classes}" title="{others}"># others</span>}} joined.',"joined_left"):TS.i18n.t('{userA}{count, plural, =0 {} =1 { and {userB}} other { and <span class="{classes}" title="{others}"># others</span>}} joined.',"joined_left");$=false;P=w(A.joined);s+=" ";s+=H({count:A.joined.length,userA:k(C),userB:k(M),others:TS.i18n.listify(P).join(""),classes:P.length>0?"ts_tip ts_tip_multiline ts_tip_lazy ts_tip_top ts_tip_float":""})}if(A.joined_left.length){C=A.joined_left.shift().id;M=A.joined_left.length?A.joined_left[0].id:null;var j=$?TS.i18n.t('Also, {userA}{count, plural, =0 {} =1 { and {userB}} other { and <span class="{classes}" title="{others}"># others</span>}} joined and left.',"joined_left"):TS.i18n.t('{userA}{count, plural, =0 {} =1 { and {userB}} other { and <span class="{classes}" title="{others}"># others</span>}} joined and left.',"joined_left");$=false;P=w(A.joined_left);s+=" ";s+=j({count:A.joined_left.length,userA:k(C),userB:k(M),others:TS.i18n.listify(P).join(""),classes:P.length>0?"ts_tip ts_tip_multiline ts_tip_lazy ts_tip_top ts_tip_float":""})}if(A.left.length){C=A.left.shift().id;M=A.left.length?A.left[0].id:null;var R=$?TS.i18n.t('Also, {userA}{count, plural, =0 {} =1 { and {userB}} other { and <span class="{classes}" title="{others}"># others</span>}} left.',"joined_left"):TS.i18n.t('{userA}{count, plural, =0 {} =1 { and {userB}} other { and <span class="{classes}" title="{others}"># others</span>}} left.',"joined_left");$=false;P=w(A.left);s+=" ";s+=R({count:A.left.length,userA:k(C),userB:k(M),others:TS.i18n.listify(P).join(""),classes:P.length>0?"ts_tip ts_tip_multiline ts_tip_lazy ts_tip_top ts_tip_float":""})}}else if("channel_join"===t.subtype){u=TS.members.getMemberById(t.inviter);if(i.is_private)c=TS.model.group_prefix+i.name;else if(i)c="#"+i.name;else c=TS.i18n.t("the channel","templates_builders")();if(u){m="<@"+u.id+"|"+u.name+">";o=TS.i18n.t("joined {channel_name} from an invitation by {inviter}","templates_builders")({channel_name:c,inviter:m});s=TS.format.formatNoHighlightsNoSpecials(o,t)}else s=TS.i18n.t("joined {channel_name}","templates_builders")({channel_name:c})}else if("channel_leave"===t.subtype){if(i.is_private)c=TS.model.group_prefix+i.name;else if(i)c="#"+i.name;else c=TS.i18n.t("the channel","templates_builders")();s=TS.i18n.t("left {channel_name}","templates_builders")({channel_name:c})}else if("channel_name"===t.subtype)s=TS.i18n.t('renamed the channel from "{old_name}" to "{new_name}"',"templates_builders")({old_name:t.old_name,new_name:t.name});else if("channel_topic"===t.subtype)if(!t.topic)s=TS.i18n.t("cleared the channel topic","templates_builders")();else{p=_.unescape(t.topic);p=TS.format.formatWithOptions(t.topic,t,{no_highlights:true});s=TS.i18n.t('set the channel topic: <span class="topic no_jumbomoji">{topic}</span>',"templates_builders")({topic:p})}else if("channel_purpose"===t.subtype)if(!t.purpose)s=TS.i18n.t("cleared the channel purpose","templates_builders")();else{h=_.unescape(t.purpose);h=TS.format.formatWithOptions(h,t,{no_highlights:true});s=TS.i18n.t('set the channel purpose: <span class="purpose no_jumbomoji">{purpose}</span>',"templates_builders")({purpose:h})}else if("group_join"===t.subtype){l=i;f=l?TS.model.group_prefix+l.name:TS.i18n.t("the private channel","templates_builders")();u=TS.members.getMemberById(t.inviter);if(u){m="<@"+u.id+"|"+u.name+">";o=TS.i18n.t("joined {group_name} from an invitation by {inviter}","templates_builders")({group_name:f,inviter:m});s=TS.format.formatNoHighlightsNoSpecials(o,t)}else s=TS.i18n.t("joined {group_name}","templates_builders")({group_name:f})}else if("group_leave"===t.subtype){l=i;f=l?TS.model.group_prefix+l.name:TS.i18n.t("the private channel","templates_builders")();s=TS.i18n.t("left {group_name}","templates_builders")({group_name:f})}else if("group_name"===t.subtype)s=TS.i18n.t('renamed the private channel from "{old_name}" to "{new_name}"',"templates_builders")({old_name:t.old_name,new_name:t.name});else if("group_topic"===t.subtype)if(!t.topic)s=TS.i18n.t("cleared the channel topic","templates_builders")();else{p=TS.format.formatWithOptions(t.topic,t,{no_highlights:true});s=TS.i18n.t('set the channel topic: <span class="no_jumbomoji">{topic}</span>',"templates_builders")({topic:p})}else if("group_purpose"===t.subtype)if(!t.purpose)s=TS.i18n.t("cleared the channel purpose","templates_builders")();else{h=TS.format.formatWithOptions(t.purpose,t,{no_highlights:true});s=TS.i18n.t('set the channel purpose: <span class="no_jumbomoji">{purpose}</span>',"templates_builders")({purpose:h})}else if("group_archive"===t.subtype){l=i;f=l?TS.model.group_prefix+l.name:TS.i18n.t("the private channel","templates_builders")();g=_.escape(TS.redux.enterprise.getEnterpriseOrgName());T=TS.i18n.t("your workspace admin","templates_builders")();if(t.user){S=TS.members.getMemberById(t.user);T=TS.format.formatNoHighlightsNoSpecials("<@"+S.id+"|"+S.name+">")}if(TS.client&&l&&l.is_archived)if(TS.model.archive_view_is_showing)if(1==l.is_moved)s=TS.i18n.t("moved {group_name} to another {enterprise_name} workspace. The contents up until this point are still browsable and available in search.","templates_builders")({group_name:f,enterprise_name:g,mover_name:T,name_for_url:l.id});else s=TS.i18n.t("archived {group_name}. The contents will still be browsable and available in search.","templates_builders")({group_name:f,name_for_url:l.id});else{var L="TS.shared.closeArchivedChannel";var N="'"+l.id+"'";if(1==l.is_moved)s=TS.i18n.t("moved {group_name} to another {enterprise_name} workspace. The contents up until this point are still browsable and available in search.","templates_builders")({group_name:f,enterprise_name:g,mover_name:T,name_for_url:l.id});else s=TS.i18n.t('archived {group_name}. The contents will still be browsable and available in search. \t\t\t\t\t\t\tIt can also be un-archived at any time. To close it now, <a onclick="{method}({group_id})">click here</a>.',"templates_builders")({group_name:f,name_for_url:l.id,method:L,group_id:N})}else if(1==l.is_moved)s=TS.i18n.t("moved {group_name} to another {enterprise_name} workspace","templates_builders")({group_name:f,enterprise_name:g});else if(0==l.is_moved)s=TS.i18n.t("archived {group_name}","templates_builders")({group_name:f})}else if("group_unarchive"===t.subtype){l=i;f=l?TS.model.group_prefix+l.name:TS.i18n.t("the private channel","templates_builders")();s=TS.i18n.t("un-archived {group_name}","templates_builders")({group_name:f})}else if("channel_archive"===t.subtype){var U="'"+i.id+"'";if(i.is_private)c=TS.model.group_prefix+i.name;else if(i)c="#"+i.name;else c=TS.i18n.t("the channel","templates_builders")();g=_.escape(TS.redux.enterprise.getEnterpriseOrgName());if(TS.client&&1==i.is_moved){if(t.user){S=TS.members.getMemberById(t.user);T=TS.format.formatNoHighlightsNoSpecials("<@"+S.id+"|"+S.name+">")}if(TS.model.archive_view_is_showing)s=TS.i18n.t("moved {channel_name} to another {enterprise_name} workspace. The contents up until this point are still browsable and available in search.","templates_builders")({channel_name:c,enterprise_name:g,mover_name:T,name_for_url:i.id});else s=TS.i18n.t('moved {channel_name} to another {enterprise_name} workspace. The contents up until this point are still browsable and available in search. \t\t\t\t\t\tTo close it now, <a onclick="TS.channels.closeArchivedChannel({channel_id})">click here</a>.',"templates_builders")({channel_name:c,enterprise_name:g,mover_name:T,name_for_url:i.id,channel_id:U})}else if(TS.client&&i)if(TS.model.archive_view_is_showing)s=TS.i18n.t("archived {channel_name}. The contents will still be browsable and available in search.","templates_builders")({channel_name:c,name_for_url:i.id});else s=TS.i18n.t('archived {channel_name}. The contents will still be browsable and available in search. \t\t\t\t\t\tIt can also be un-archived at any time. To close it now, <a onclick="TS.channels.closeArchivedChannel({channel_id})">click here</a>.',"templates_builders")({channel_name:c,name_for_url:i.id,channel_id:U});else if(i&&1==i.is_moved)s=TS.i18n.t("moved {channel_name} to another {enterprise_name} workspace","templates_builders")({channel_name:c,enterprise_name:g})}else if("channel_unarchive"===t.subtype){if(i.is_private)c=TS.model.group_prefix+i.name;else if(i)c="#"+i.name;else c=TS.i18n.t("the channel","templates_builders")();s=TS.i18n.t("un-archived {channel_name}","templates_builders")({channel_name:c})}else if("me_message"===t.subtype)s="<i>"+TS.format.formatWithOptions(t.text,t,{do_inline_imgs:r})+"</i>";else if("play_sound"===t.subtype)s=TS.i18n.t('played "{msg_sound}"',"templates_builders")({msg_sound:t.sound});else if("sh_room_shared"===t.subtype||"sh_room_created"===t.subtype){if("sh_room_shared"===t.subtype);if(!a&&t._room_id)d=TS.rooms.getRoomById(t._room_id);if(a)s+="<span>"+TS.i18n.t("Shared a call","templates_builders")()+"</span>";else if(d)s+=TS.templates.builders.buildSHRoomAttachment(d)}else if("bot_add"===t.subtype||"bot_enable"===t.subtype||"bot_updated"===t.subtype||"bot_disable"===t.subtype||"bot_remove"===t.subtype){v=TS.templates.builders.buildBotStr(t,i);s=TS.format.formatWithOptions(v,t,{do_inline_imgs:r,enable_slack_action_links:n,no_highlights:true})}else if("reminder_add"===t.subtype||"reminder_delete"===t.subtype)s=TS.format.formatWithOptions(t.text,t,{do_inline_imgs:r,enable_slack_action_links:n,no_highlights:true});else s=TS.format.formatWithOptions(t.text,t,{do_inline_imgs:r,enable_slack_action_links:n});if(!s&&""!==s){TS.warn("no html msg.subtype:"+t.subtype);return""}s=TS.utility.msgs.handleSearchHighlights(s);return s},msgHtmlForSearch:function e(t,r,n,i,a,s,o){if("bot_message"!==t.subtype)t.subtype=null;var l="";if("extract"===n){l+='<div class="search_result_with_extract '+("context"===i?"last_extract_message_in_group":"")+" "+("context"===a?"first_extract_message_in_group":"")+'">';l+='<div class="extract_expand_text">'+TS.i18n.t("Expand","template_builders")()+"</div>";l+='<div class="extract_expand_icons blue"><i class="ts_icon ts_icon_chevron_up up_arrow"></i><i class="ts_icon ts_icon_chevron_down down_arrow"></i></div>'}else if("context"===n)l+='<div class="search_result_for_context">';else l+='<div class="search_result_for_extra_context">';l+=TS.templates.builders.msgs.buildHTML({msg:t,msg_dom_id:TS.templates.makeMsgDomIdInSearch(t.ts,s),model_ob:r,container_id:"search_message_results",standalone:true,for_search_display:true,search_result_type:n,prev_msg:o});l+="</div>";return l},msgHtmlForSearchTopResults:function e(t){if("bot_message"!==t.subtype)t.subtype=null;var r=(!t.extracts||0==t.extracts.length)&&t.attachments;var n=TS.templates.builders.msgs.buildHTML({msg:t,msg_dom_id:TS.templates.makeMsgDomIdInSearchTopResults(t.ts,t,t.module_name),model_ob:t.channel,container_id:"search_message_results",standalone:true,for_top_results_search_display:true,no_attachments:!r});return n},buildMsgHTMLForSearchTopResults:function e(t){return TS.templates.builders.msgHtmlForSearchTopResults(t)},buildMsgHTMLForSearch:function e(t){var r=t.channel;var n="";var i=[];if(t.previous_2)i.push(t.previous_2);if(t.previous)i.push(t.previous);i.push(t);if(t.next)i.push(t.next);if(t.next_2)i.push(t.next_2);if(i.length>1&&!TS.search.view.resultHasExtracts(t)){t.force_extract_type="extract";if(t.previous)t.previous.force_extract_type="context";if(t.next)t.next.force_extract_type="context"}var a;i.forEach(function(e,s){var o;if(e.force_extract_type)o=e.force_extract_type;else o=TS.search.view.determineMessageResultType(i,s);var l=i[s-1]?TS.search.view.determineMessageResultType(i,s-1):null;var u=i[s+1]?TS.search.view.determineMessageResultType(i,s+1):null;if(!e.permalink&&t.permalink&&"extract"!==o)e.permalink=t.permalink;if(!e.team&&t.team)e.team=t.team;if(!e.channel&&t.channel)e.channel=t.channel;n+=TS.templates.builders.msgHtmlForSearch(e,r,o,u,l,t,a,s);a=e});return n},search_ellipsis:'<span class="extract_ellipsis">&hellip;</span>',buildStar:function e(r,n,i){var a=t(r,n,i);if(!_.isObject(a))return{};return TS.templates.star(a)},buildStarWithTip:function e(r,n,i){var a=t(r,n,i);if(!_.isObject(a))return{};return TS.templates.star_with_tip(a)},buildMentionHTML:function e(t){var r=t.message;var n="";if(!r)return n;if("file_share"===r.subtype||"file_mention"===r.subtype||"file_comment"===r.subtype||"file_reaction"===r.subtype)if(!r.file)return n;var i=TS.shared.getModelObById(t.channel);if(!i)return n;var a;var s=4;var o=[];var l="";var u="";var d="";var _="reaction"===t.type;u=TS.templates.builders.strBuilder('<button type="button" class="btn_link msg_right_link msg_jump" data-cid="${cid}">'+TS.i18n.t("Jump","templates_builders")()+"</button>",{cid:i.id});d=TS.templates.builders.msgs.buildHTML({msg:r,model_ob:i,standalone:true,jump_link:u,no_attachments:!!r.text,for_mention_display:true,for_mention_rxn_display:_});n=d;if(_){var c=TS.rxns.getRxnKeyByMsgType(r);a=TS.rxns.getExistingRxnsByKey(c);if(!a)return"";var m=a[a.length-1];var f=m.users[m.users.length-1];if(!TS.rxns.getRxnFromRxns(a,m.name))return"";var p=TS.members.getPotentiallyUnknownMemberById(f);var h=TS.rxns.getAllUniqueRxners(a,f);var g=h.length+1;var S="file_reaction"===r.subtype;var T;if(2==g){var v=TS.members.getPotentiallyUnknownMemberById(h[0]);if(S)T=TS.i18n.t('<span class="mention_rxn_summary_members">{user} & {another_user}</span> reacted to your file.',"rxn");else T=TS.i18n.t('<span class="mention_rxn_summary_members">{user} & {another_user}</span> reacted to your message.',"rxn");l=T({user:TS.templates.builders.makeMemberPreviewLink(p,true),another_user:TS.templates.builders.makeMemberPreviewLink(v)})}else if(g>2){var b=true;var y=false;var w=h.map(function(e){return TS.members.getPrefCompliantMemberNameById(e,b,y)});var k=g-1;if(S)T=TS.i18n.t('<span class="mention_rxn_summary_members">{user} & <span class="ts_tip ts_tip_float ts_tip_multiline ts_tip_lazy ts_tip_top" title="{names}">{count, plural, =1 {# other} other {# others}}</span></span> reacted to your file.',"rxn");else T=TS.i18n.t('<span class="mention_rxn_summary_members">{user} & <span class="ts_tip ts_tip_float ts_tip_multiline ts_tip_lazy ts_tip_top" title="{names}">{count, plural, =1 {# other} other {# others}}</span></span> reacted to your message.',"rxn");l=T({user:TS.templates.builders.makeMemberPreviewLink(p,true),names:TS.i18n.listify(w).join(""),count:k})}else{if(S)T=TS.i18n.t('<span class="mention_rxn_summary_members">{user}</span> reacted to your file.',"rxn");else T=TS.i18n.t('<span class="mention_rxn_summary_members">{user}</span> reacted to your message.',"rxn");l=T({user:TS.templates.builders.makeMemberPreviewLink(p,true)})}o=a.filter(function(e){return TS.emoji.isValidName(e.name)}).slice(0,s).map(function(e){return new Handlebars.SafeString(TS.emoji.graphicReplace(":"+e.name+":"))});var x={ts:r.ts,rxns_to_display:o,msg_html:new Handlebars.SafeString(d),rxn_members:new Handlebars.SafeString(l),jump_link_html:new Handlebars.SafeString(u),is_file_reaction:S};if(r.thread_ts)x.thread_ts=r.thread_ts;n=TS.templates.mentions_rxn(x)}return n},buildMentions:function e(){TS.mentions.weaveInRxnRecords();var t="";var r=null;var n=TS.mentions.getAllMentions();if(!n||!n.length)return t;$.each(n,function(e,n){var i;try{i=TS.templates.builders.buildMentionHTML(n)}catch(e){TS.error("Problem building mention html for "+n.message.ts+" in "+n.channel);TS.error(e)}if(!i)return;var a="";var s=TS.shared.getModelObById(n.channel);var o=n.message;var l=!r;if(r&&!TS.interop.datetime.isSameDay(TS.interop.datetime.toDateObject(r.rxn_ts||r.message.ts),TS.interop.datetime.toDateObject(n.rxn_ts||o.ts)))l=true;if(l){if(r)a="</div>";a+='<div class="mention_day_container_div">'+TS.templates.messages_day_divider({ts:n.rxn_ts||o.ts})}var u=r&&r.channel;if(s&&(s.is_channel||s.is_mpim||s.is_group))if(u!=s.id||l)a+=TS.templates.mentions_item({model_ob:s});t+=a+i;r=n});if(t)t+="</div>";return t},buildStarredItemHTML:function e(t){var r="<div class='star_item'>";var n={star:t,current_user_id:TS.model.user.id};var i;if("message"===t.type){var a=t.message;var s=false;i=TS.shared.getModelObById(t.channel);if(!i){TS.warn("channel "+t.channel+" for this starred message was probably deleted");return""}if(i.is_im){var o=TS.members.getMemberById(i.user);t.message.recipient=o;if(TS.ims.isImWithDeletedMember(i))s=true}var l="";if(!s)l=TS.templates.builders.strBuilder('<button type="button" class="btn_unstyle star_jump msg_right_link btn btn_outline" data-cid="${cid}">'+TS.i18n.t("Jump","templates_builders")()+"</button>",{cid:i.id});r+=TS.templates.builders.msgs.buildHTML({msg:a,model_ob:i,standalone:true,starred_items_list:true,starred_items_actions:true,jump_link:l,no_attachments:!!a.text,full_date:true})}else if("file"===t.type)r+=TS.templates.builders.fileHTML(t.file);else if("channel"===t.type||"group"===t.type){i=TS.shared.getModelObById(t.channel);if(!i){TS.warn("channel or group "+t.channel+" was probably deleted");return""}n.model_ob=i;r+=TS.templates.star_item(n)}else{n.from_starred_item=true;r+=TS.templates.star_item(n)}r+="</div>";return r},buildPinInfoHtml:function e(t){var r={};var n=TS.pins.getPinData(t);var i={};if(n&&n.created_by&&n.created){i=TS.members.getPotentiallyUnknownMemberById(n.created_by);r.user=i;r.ts=n.created;r.complete_data=r.user&&r.ts}else r.complete_data=false;r.unknown_member_token=new Handlebars.SafeString(TS.templates.unknown_member({id:i.id}));var a=TS.templates.pinned_message_info(r);return new Handlebars.SafeString(a)},buildHighlightsInfoHtml:function e(t){var r=TS.templates.highlights_message_info(t);return new Handlebars.SafeString(r)},buildInlineImgTogglerAndDiv:function e(t,r,n){var i=TS.model.inline_imgs[t];if(!i)return"";return TS.templates.builders.buildInlineImgToggler(t,r)+" "+TS.templates.builders.buildInlineImgDiv(t,r,n)},buildInlineImgToggler:function e(t,r,n,i){var a=TS.model.inline_imgs[t];if(!a){TS.warn(8675309,"buildInlineImgToggler did not find anything in TS.model.inline_imgs for key:"+t);return""}var s=TS.inline_imgs.shouldExpand(r,a,i);var o=a.link_url||t;var l=a.bytes&&a.bytes>TS.model.inline_img_byte_limit;var u=a.width&&a.height&&a.width*a.height>TS.model.inline_img_pixel_limit;var d=!u;var c="";var m="";if(!s&&(!TS.prefs.getPref("obey_inline_img_limit")||l)||u){var f=!a.internal_file_id&&TS.prefs.getPref("expand_inline_imgs")&&false!==TS.model.expandable_state["img_"+r+a.src];if(f&&u){d=false;m=TS.i18n.t("(Not automatically expanded because {img_width}x{img_height} is too large to display inline.)","templates_builders")({img_width:a.width,img_height:a.height});c='<span class="too_large_for_auto_expand"> '+m+"</span>"}else if(f&&l){var p=TS.i18n.t("Open original in new tab","templates_builders")();var h="<a "+TS.utility.makeRefererSafeLink(o)+' target="_blank" title="'+p+'">';if(TS.model.show_inline_img_size_pref_reminder&&!TS.model.shown_inline_img_size_pref_reminder_once){m=TS.i18n.t('(Not automatically expanded because {file_size} is too large. \t\t\t\t\t\tYou can <a class="cursor_pointer too_large_but_expand_anyway" data-real-src="{real_src}">expand it anyway</a> or {referer_link_a_tag}open it in a new window</a>. \t\t\t\t\t\tYou can also <a class="cursor_pointer" onclick="TS.ui.prefs_dialog.start(\'messages_media\', \'#prefs_inline_media\')">change your preferences</a> to allow images of any file size to auto expand.)',"templates_builders")({file_size:TS.utility.convertFilesize(a.bytes),real_src:_.escape(a.src),referer_link_a_tag:h});TS.model.shown_inline_img_size_pref_reminder_once=true}else m=TS.i18n.t('(Not automatically expanded because {file_size} is too large. \t\t\t\t\t\tYou can <a class="cursor_pointer too_large_but_expand_anyway" data-real-src="{real_src}">expand it anyway</a> or {referer_link_a_tag}open it in a new window</a>.)',"templates_builders")({file_size:TS.utility.convertFilesize(a.bytes),real_src:_.escape(a.src),referer_link_a_tag:h});c='<span class="too_large_for_auto_expand"> '+m+"</span>"}}var g=a.bytes&&true!==n?'<span class="inline_img_bytes '+(c?"hidden":"")+'"> ('+TS.utility.convertFilesize(a.bytes)+")</span>":"";var S={collapser_class:"msg_inline_img_collapser",expander_class:"msg_inline_img_expander",real_src:a.src,expand_it:s};var T=TS.templates.inline_attachment_toggler({inline_attachment:S});return g+c+(d?T:"")},buildInlineImgDiv:function e(t,r,n){n=n||{};var i=TS.model.inline_imgs[t];if(!i)return"";var a=TS.inline_imgs.shouldExpand(r,i,n);var s=i.link_url||t;var o=!n.flush_with_attachment&&i.width>0&&i.height>0;var l;if(i.internal_file_id)l=TS.files.getFileById(i.internal_file_id);var u="";var d="clear_both msg_inline_img_holder msg_inline_holder";if(!a)d+=" hidden";var c=i.height<50;var m=i.width<200;var f=m||c;if(f){d+=" overflow_preview_actions";if(m)d+=" overflow_preview_actions_width"}if(l)d+=" file_container";d+=" msg_inline_holder_rounded";if(!o)d+=" file_container_fixed_dimensions";u+='<div data-real-src="'+_.escape(i.src)+'" class="'+d+'" ';if(i.internal_file_id)u+='data-file-id="'+i.internal_file_id+'" ';if(o)u+='style="width:'+i.width+'px;" ';u+=">";var p="ctrl";if(TS.model.is_mac)p="cmd";var h=TS.i18n.t("{cmd_key}+click to open original in new tab","templates_builders")({cmd_key:p});var g=n&&n.hasOwnProperty("maybe_show_file_viewer")?n.maybe_show_file_viewer:true;var S;if(i.internal_file_id)if(l&&0===l.mimetype.indexOf("image/")){S=g;if("dropbox"===l.external_type||"gdrive"===l.external_type||"box"===l.external_type||"onedrive"===l.external_type){var T=l.thumb_720?l.thumb_720:l.thumb_360;u+="<a "+TS.utility.makeRefererSafeLink(s)+' target="_blank" title="'+h+'" class="file_viewer_external_link" data-src="'+_.escape(T)+'"data-link-url="'+_.escape(s)+'">'}else if(S)u+='<a href="'+s+'" target="_blank" class="file_viewer_channel_link file_viewer_link" data-file-id="'+i.internal_file_id+'">';else u+='<a href="'+s+'" target="_blank" title="'+h+'" class="file_preview_link thumbnail_link" data-file-id="'+i.internal_file_id+'">'}else u+="<a "+TS.utility.makeRefererSafeLink(s)+' target="_blank" class="'+l.filetype+'">';else{var v="";var b="";if(g)v="file_viewer_external_link";else b=TS.i18n.t("Click to open original in new tab","templates_builders")();u+="<a "+TS.utility.makeRefererSafeLink(s)+' target="_blank" title="'+b+'" class="'+v+'" data-src="'+_.escape(i.src)+'" data-link-url="'+_.escape(i.link_url)+'"';if(i.width)u+=' data-width="'+_.escape(i.width)+'"';if(i.height)u+=' data-height="'+_.escape(i.height)+'"';if(i.rotation)u+=' data-rotation="'+_.escape(i.rotation)+'"';if(i.content_type)u+=' data-content-type="'+_.escape(i.content_type)+'"';u+=">"}if(o)u=u.replace("<a ",'<a style="width:'+i.width+'px;" ');u+='<div class="msg_inline_img_container">';u+='<div class="file_preview_preserve_aspect_ratio" ';if(o)if(!l||!f){var y="calc("+i.height+" / "+i.width+" * 100% )";u+='style="padding-top: -moz-'+y+"; padding-top: -webkit-"+y+"; padding-top: "+y+';" '}else u+='style="padding-top: '+i.height+'px;" ';else{var w=574;var k=300;var x=w/k;var C=i.display_w||i.width;var M=i.display_h||i.height;var I=C/M;var P;var A;if(C<=w&&M<=k){P=C;A=M}else if(x>I){P=C*k/M;A=k}else{P=w;A=M*w/C}u+='style="width: '+Math.round(P)+"px; height: "+Math.round(A)+'px;"'}u+=">";i.proxied_src=TS.utility.getImgProxyURLWithOptions(i.src,{});var E=_.escape(i.proxied_src||i.src);var F="msg_inline_img msg_inline_child";var O='style="background-image:url('+E+');"';var B='src="'+E+'"';u+='<figure class="'+F+'" '+O+">";u+="<img "+B+" />";u+="</figure>";u+="</div>";u+="</div>";u+="</a>";if(l)u+=TS.templates.message_file_preview_actions({file:l,download:"hosted"===l.mode,new_window:true,external_file_author:TS.files.isFileAuthorExternal(l)});u+="</div>";return u},buildInlineEmailDiv:function e(t,r){var n=TS.files.getFileById(t);if(!n)return"";var i={file:n,is_message:true,to_more_count:n.to.length-1,cc_more_count:n.cc.length-1,msg_dom_id:r};return TS.templates.file_email(i)},buildInlineAttachmentToggler:function e(t,r){var n=TS.model.inline_attachments[t];if(!n)return"";var i=TS.inline_attachments.shouldExpand(r,n);var a={real_src:n.from_url,expand_it:i};var s=TS.templates.inline_attachment_toggler({inline_attachment:a});return s},buildInlineRoomPreviewToggler:function e(t){var r=TS.inline_room_previews.shouldExpand(t);var n={collapser_class:"msg_inline_room_preview_collapser",expander_class:"msg_inline_room_preview_expander",expand_it:r};var i=TS.templates.inline_attachment_toggler({inline_attachment:n});return" "+i},buildInlineAudioToggler:function e(t,r){var n=TS.model.inline_audios[t];if(!n)return"";return TS.templates.attachment_inline_media_toggler({is_expanded:TS.inline_audios.shouldExpand(r,n),src:n.src,media_type:"audio"})},buildInlineAudioDiv:function e(t,r,n){var i=TS.model.inline_audios[t];if(!i)return"";var a=TS.inline_audios.shouldExpand(r,i);var s={src:i.src,expand_it:a,content:n};var o=TS.templates.attachment_inline_audio_div({inline_audio:s});return o},buildInlineOtherToggler:function e(t,r){var n=TS.model.inline_others[t];if(!n)return"";return TS.templates.attachment_inline_media_toggler({is_expanded:TS.inline_others.shouldExpand(r,n),src:n.src,media_type:"other"})},buildInlineOtherDiv:function e(t,r,n){var i=TS.model.inline_others[t];if(!i)return"";var a=TS.inline_others.shouldExpand(r,i);return'<div data-real-src="'+_.escape(i.src)+'" class="clear_both msg_inline_other_holder msg_inline_holder '+(a?"":"hidden")+'">'+n+"</div>"},buildInlineVideoTogglerAndDiv:function e(t,r){var n=TS.model.inline_videos[t];if(!n)return"";return TS.templates.builders.buildInlineVideoToggler(t,r)+" "+TS.templates.builders.buildInlineVideoDiv(t,r)},buildInlineVideoToggler:function e(t,r,n){var i=TS.model.inline_videos[t];if(!i)return"";return TS.templates.attachment_inline_media_toggler({is_expanded:TS.inline_videos.shouldExpand(r,i),src:i.src,title:n?"":i.title,media_type:"video",is_keyboard_navigable:true})},buildInlineVideoDiv:function e(t,r){var n=TS.model.inline_videos[t];if(!n)return"";var i=TS.inline_videos.shouldExpand(r,n);var a=n.link_url||t;var s=true;if(!n.html)s=false;var o={real_src:n.src,data_url:t,referrer_safe_url_attributes:TS.utility.makeRefererSafeLink(a),show_play:s,proxied_src_or_src:n.proxied_src||n.src,display_w:n.display_w,display_h:n.display_h,expand_it:i};var l=TS.templates.message_inline_video({inline_video:o});return l},buildComments:function e(t){var r;var n=t.comments;var i="";for(var a=0;a<n.length;a+=1){r=TS.members.getPotentiallyUnknownMemberById(n[a].user);i+=TS.templates.builders.buildCommentHTML({file:t,comment:n[a],show_comment_actions:true,member:r})}return i},buildCommentHTML:function e(t){return TS.templates.comment(t)},buildCommentStandalone:function e(t,r){var n=TS.utility.members.getEntityFromFile(r);var i;if("snippet"===r.mode)i="snippet";else if("post"===r.mode)i="post";else if("space"===r.mode)i="space";else if("hosted"===r.mode||"external"===r.mode)i="file";return TS.templates.comment_standalone({comment:t,file:r,file_type:i,entity:n,current_user_id:TS.model.user.id})},buildTeamListHTML:function e(t,r,n){var i=t.filter(function(e){return!TS.utility.teams.isMemberExternal(e)});var a=TS.members.allocateTeamListMembers(i);var s=a.members;var o=a.disabled_members;var l=a.deleted_bots;var u=a.bots;var d=a.restricted_members;var _=a.ultra_restricted_members;var c=false;if(u.length||l.length)c=true;var m=false;if(d.length||_.length||n)m=true;var f=false;if(o.length||n)f=true;var p=false;var h=false;var g;p=""!==TS.model.team.plan&&!TS.model.user.is_restricted;g=TS.model.user_groups.filter(function(e){return!e.date_delete});h=!g.length;var S=$("#team_tabs");var T=TS.permissions.members.canEditUserGroups();var v=TS.permissions.members.canCreateAndDeleteUserGroups();S.html(TS.templates.user_group_tabs({show_members:!!s.length,members:n?[]:s,show_restricted_members:m,restricted_members:n?[]:d.concat(_),show_disabled_members:f,disabled_members:n?[]:o,show_user_groups:p,user_groups:g,show_user_groups_edit:T,show_user_groups_add:v,is_enterprise:TS.boot_data.page_needs_enterprise}));var b={full_profile_filter:true,is_long_list_view:r,include_bots:true,include_deleted:false};TS.members.view.bindTeamFilter("#team_filter","#team_list_scroller",b);$("#team_filter input").bind("focus",function(){$("#team_filter .icon_search").addClass("indifferent_grey")}).bind("blur",function(){$("#team_filter .icon_search").removeClass("indifferent_grey")});if(p){var y=S.find(".tab_action:not(#search)");var w=$("#team_block");S.find("li a").on("click",function(){var e=$(this).data("action");var t=TS.permissions.members.canEditUserGroups();var r=TS.permissions.members.canCreateAndDeleteUserGroups();y.addClass("hidden");if("user_group_edit"===e){if(!t&&!r)return;y.removeClass("hidden");w.addClass("hidden")}else w.removeClass("hidden");S.find("#"+e).removeClass("hidden")})}$("#team_tabs").find("li.tab").on("click",function(e){var t=$(e.currentTarget).find("a").data("name");TS.model.ui_state.tab_name=t;TS.storage.storeUIState(TS.model.ui_state);var r=$("#search");if(TS.client)TS.ui.utility.updateClosestMonkeyScroller($("#team_list_members"));$("#team_list_members").trigger("resize");if("user_groups"===t){TS.view.rebuildUserGroupList();r.toggleClass("hidden",!TS.model.user_groups.length)}else r.removeClass("hidden")});return TS.templates.team_list({members:s,bots:u,show_bots:c,show_restricted_members:m,restricted_members:d,ultra_restricted_members:_,show_disabled_members:f,disabled_members:o,deleted_bots:l,show_user_groups:p,user_groups:g,show_user_groups_help:h,is_long_list_view:r})},buildUserGroupHTML:function e(t,r){return TS.templates.user_group_list_item({user_group:t,is_flexpane:r})},buildUserGroupListHTML:function e(t,r){var n;var i=[];var a=[];var s=TS.permissions.members.canCreateAndDeleteUserGroups();for(var o=0;o<t.length;o+=1){n=t[o];if(n.date_delete){n.can_delete=!n.auto_type&&!n.is_external;a.push(n)}else i.push(n)}var l=!r&&!i.length&&!a.length||r&&!i.length;return TS.templates.user_group_list({user_groups:i,disabled_user_groups:a,show_toggle:s,is_flexpane:r,show_user_groups_help:l})},makeChannelPrefix:function e(t){if(!t)return"";if(t.is_mpim||t.is_im)return"";if(t.is_group||t.is_private)return'<ts-icon class="ts_icon_lock"></ts-icon>';else if(t.is_channel)return"#";return""},makeModelObNameForDisplay:function e(t,r){if(!t)return"ERROR: MISSING CHANNEL";r=r||{};var n=_.trim(TS.templates.builders.maybeMakeSharedIcon(t,r.show_tooltip,r.tooltip_position,r.inherit_font_size));var i=TS.templates.builders.makeChannelPrefix(t);var a;if(t.is_im)a=TS.members.getPrefCompliantMemberNameById(t.user);else if(t.is_mpim)a=TS.mpims.getDisplayName(t);else a=_.escape(t.name);var s=r.allow_wrap?"<span>":'<span class="no_wrap">';if(r.overflow_ellipsis)s+='<span class="overflow_ellipsis">';s+=r.omit_prefix?"":i;s+=a;if(r.overflow_ellipsis)s+="</span>";s+=n+"</span>";return s},makeChannelLink:function e(t,r){if(!t)return"ERROR: MISSING CHANNEL";r=r||{};var n=t.id;var i=TS.utility.shouldLinksHaveTargets()?'target="/archives/'+n+'"':"";var a=TS.templates.builders.makeModelObNameForDisplay(t,r);if(r.overflow_ellipsis)return'<a href="/archives/'+n+'" '+i+' class="channel_link display_flex flex_wrap_none" data-channel-id="'+t.id+'">'+a+"</a>";return'<a href="/archives/'+n+'" '+i+' class="channel_link" data-channel-id="'+t.id+'">'+a+"</a>"},maybeMakeSharedIcon:function e(t,r,n,i){var a="";if(TS.shared.isModelObOrgShared(t)&&!t.is_mpim&&!t.is_im)a=TS.templates.shared_channel_icon({tooltip:r,tooltip_position:n});else if(TS.shared.isModelObShared(t)&&!t.is_mpim&&!t.is_im)a=TS.templates.shared_channels_icon({model_ob:t,tooltip:_.isUndefined(r)||r,tooltip_position:n,shared_team_ids:TS.shared.isModelObPendingShared(t)?t.pending_shared:t.shared_team_ids,inherit:i});return new Handlebars.SafeString(a)},makeChannelLinkEnterpriseSearchResult:function e(t,r){var n=t.permalink;var i=TS.templates.builders.makeModelObNameForDisplay(t.channel,r);var a='target="'+TS.templates.builders.newWindowName()+'"';return'<a href="'+n+'"'+a+' data-channel-id="'+t.channel.id+'">'+i+"</a>"},makeChannelPath:function e(t){return"/messages/"+t.id},makeChannelLinkAriaLabelSafe:function t(r){if(!r)TS.warn("No valid channel to make channel link aria label");var n=_.escape(r.name);var i=TS.model.active_channel_id===r.id?TS.i18n.t("active channel","templates_builders")():TS.i18n.t("channel","templates_builders")();var a=e(r);var s=null;if(TS.templates.builders.showDraftIcon(r))s=TS.i18n.t("draft","messages")();var o=n+", "+i+(a?", "+a:"")+(s?", "+s:"");return new Handlebars.SafeString(o)},makeGroupLink:function e(t,r){if(!t)return"ERROR: MISSING GROUP";r=r||{};var n=TS.utility.shouldLinksHaveTargets()?'target="/archives/'+t.id+'"':"";var i=TS.templates.builders.makeModelObNameForDisplay(t,r);if(r.overflow_ellipsis)return'<a href="/archives/'+t.id+'" '+n+' class="group_link display_flex flex_wrap_none" data-group-id="'+t.id+'">'+i+"</a>";return'<a href="/archives/'+t.id+'" '+n+' class="group_link" data-group-id="'+t.id+'">'+i+"</a>"},makeGroupLinkAriaLabelSafe:function t(r){if(!r)TS.warn("No valid group to make private channel link aria label");var n=_.escape(r.name);var i=TS.model.active_group_id===r.id?TS.i18n.t("active channel","templates_builders")():TS.i18n.t("channel","templates_builders")();var a=e(r);var s=null;if(TS.templates.builders.showDraftIcon(r))s=TS.i18n.t("draft","messages")();var o=n+", "+i+(a?", "+a:"")+(s?", "+s:"");return new Handlebars.SafeString(o)},makeMpimLink:function e(t,r){if(!t)return"ERROR: MISSING MPIM";var n;var i;var a=TS.mpims.getMpimArchivesPath(t);if(TS.utility.shouldLinksHaveTargets())n=TS.mpims.getMpimArchivesPath(t);if(r)i=TS.mpims.getTooltipText(t);return TS.templates.mpim_link({target:n,href:a,title:i,mpim:t})},makeMemberPreviewLink:function e(t,r){if(!t)return"";if(true!==r)r=false;var n=TS.templates.builders.makeMemberColorClass(t);var i;var a;if(t.is_service){a=TS.utility.shouldLinksHaveTargets()?'target="/services/'+t.id+'"':"";n+=" app_preview_link";i='<a href="/services/'+t.id+'" '+a+' data-bot-id="'+t.id+'" class="message_sender service_link '+n+'">'}else{a=TS.utility.shouldLinksHaveTargets()?'target="/team/'+t.id+'"':"";n+=t.is_bot?" app_preview_link":" member member_preview_link";n+=" "+TS.templates.builders.makeMemberTypeBadgeClass(t);i='<a href="/team/'+t.id+'" '+a+' class="message_sender '+n+'" data-member-id="'+t.id+'">'}if(r&&t.id==TS.model.user.id)i+=TS.i18n.t("You","templates_builders")();else i+=TS.members.getPrefCompliantMemberName(t,true);i+=TS.templates.builders.makeMemberTypeBadgeCompact(t,false);i+="</a>";if(t.is_bot||t.is_service){var s=TS.boot_data.feature_unified_app_display?"c-app_label":"bot_label";i+='<span class="'+s+'">'+TS.i18n.t("APP","templates_builders")()+"</span>"}if(t.is_unknown)i=TS.templates.unknown_member({id:t.id});return i},showDraftIcon:function e(t){if(!_.isObject(t))return false;var r;var n=t.id;r=t.last_msg_input;if(!r&&t.presence){var i=TS.ims.getImByMemberId(t.id);r=i&&i.last_msg_input;n=i&&i.id}var a=TS.shared.getActiveModelOb();if(a){var s=a.id;if(s&&s==n&&!TS.client.activeChannelIsHidden())r=null}if(t.is_channel)if(t.is_archived||!t.is_member)r=null;if(t.is_group&&!t.is_mpim)if(t.is_archived)r=null;if(!TS.permissions.members.canPostInChannel(t))r=null;if(_.trim(r))return true;return false},makeProfileImage:function e(t,r){if(_.isString(t)){var n=TS.members.getMemberById(t);if(n)t=n;else t=TS.bots.getBotById(t)}if(!t)return false;var i=r.hash.is_lazy||false;var a=t.profile||t.icons||{};var s=r.hash.title||false;var o;if(a.emoji)o="64";else o="48";var l=r.hash.size||o;var u=Object.keys(TS.constants.avatar_size_map).reduce(function(e,t){if(t===l&&m(a,t))return t;return e},o);var d={entity:t,size:l,css_classes:f(t,l),image:c(t,m(a,u)),is_lazy:i,is_targettable:TS.utility.shouldLinksHaveTargets(),title:s};function c(e,t){var r=[];r.push("url('"+t+"')");return r.join(",")}function m(e,t){var r="image_"+t;if(e.hasOwnProperty(r)){if(TS.environment.is_retina)return e[TS.constants.avatar_size_map[t].retina]||e[TS.constants.avatar_size_map[t].standard];return e[TS.constants.avatar_size_map[t].standard]}return false}function f(e,t){var r=[];r.push("thumb_"+t);if(e.is_bot){r.push("is_bot");r.push("app_preview_link")}else r.push("member_preview_link");return r.join(" ")}return new Handlebars.SafeString(TS.templates.member_profile_image(d))},makeMemberPreviewLinkImage:function e(t,n,i,a,s,o,l){var u;if("object"===("undefined"===typeof t?"undefined":r(t)))u=t;else u=TS.members.getPotentiallyUnknownMemberById(t);if(!u||!u.profile)return"";i=true===i;a=true===a;s=true===s;o=true===o;l="string"===typeof l?l:false;if("USLACKBOT"===t&&l)u=TS.utility.slackbot.getWithFeels(l);var d=TS.templates.builders.getImageStyleForMemberPreviewImage(u,n,i);var _={omit_link:a,omit_badge:s,lazy:i,member:u,size:n,include_restricted_overlay:!o||true,bg_img_style:d};return TS.templates.member_preview_link_image(_)},getImageStyleForMemberPreviewImage:function e(t,r,n){var i;var a;var s;a="background-image: ";s=[];switch(r){case 20:case 24:if(TS.environment.is_retina)i=t.profile.image_48;else i=t.profile.image_24;break;case 32:if(TS.environment.is_retina)i=t.profile.image_72;else i=t.profile.image_32;break;case 36:case 48:if(TS.environment.is_retina)i=t.profile.image_72;else i=t.profile.image_48;break;case 72:if(TS.environment.is_retina)i=t.profile.image_192;else i=t.profile.image_72;break;case 192:if(TS.environment.is_retina)i=t.profile.image_512||t.profile.image_192;else i=t.profile.image_192;break;case 512:if(TS.environment.is_retina)i=t.profile.image_1024||t.profile.image_512||t.profile.image_192;else i=t.profile.image_512||t.profile.image_192;break;default:if(TS.environment.is_retina)i=t.profile.image_72;else i=t.profile.image_48}s.push("url('"+i+"')");if(512===r){var o=TS.environment.is_retina?t.profile.image_72:t.profile.image_48;s.push("url('"+o+"')")}if(n)a=s.length?s.join(", "):"";else a=s.length?a+s.join(", "):"";return a},makeMemberPreviewCardLinkImage:function e(t){var r=TS.members.getPotentiallyUnknownMemberById(t);if(!r||!r.profile)return"";var n=TS.templates.builders.makeMemberPreviewCardLinkImageBackground(t);var i=TS.utility.shouldLinksHaveTargets()?'target="/team/'+r.id+'"':"";return'<a href="/team/'+r.id+'" '+i+' class="member_preview_link member_image thumb_512" data-member-id="'+r.id+'" data-thumb-size="512" style="background-image: '+n+'" aria-hidden="true"></a>'},makeMemberPreviewCardLinkImageBackground:function e(t){var r=TS.members.getPotentiallyUnknownMemberById(t);if(!r||!r.profile)return"";var n;if(TS.environment.is_retina)n=r.profile.image_1024||r.profile.image_512||r.profile.image_192;else n=r.profile.image_512||r.profile.image_192;var i=TS.environment.is_retina?r.profile.image_72:r.profile.image_48;var a=TS.model.mac_version&&(0===TS.utility.compareSemanticVersions(TS.model.mac_version,"10.7")||0===TS.utility.compareSemanticVersions(TS.model.mac_version,"10.8"))?"-webkit-":"";var s=[a+"linear-gradient(rgba(0,0,0,0), rgba(0,0,0,0) 34%, rgba(0,0,0,0.2) 66%, rgba(0,0,0,0.2) 83%, rgba(0,0,0,0.6))","url('"+n+"')","url('"+i+"')"];return s.join(", ")},makeMemberLinkAriaLabelSafe:function t(r){if(!r)TS.warn("No valid direct message object to make member link aria label");var n=r.member;var i=r.model_ob;var a="";if(n&&i){var s=_.escape(TS.ims.getDisplayNameOfUserForIm(i));var o=TS.model.active_im_id===n.id?TS.i18n.t("active direct message","templates_builders")():TS.i18n.t("direct message","templates_builders")();var l=TS.templates.makeMemberPresenceStateAriaLabel(n);var u=e(i);var d=null;if(TS.templates.builders.showDraftIcon(i))d=TS.i18n.t("draft","messages")();a=s+", "+o+", "+l+(u?", "+u:"")+(d?", "+d:"")}return new Handlebars.SafeString(a)},makePendingUserImage:function e(t,r){if(!t||!r)return"";var n=[];var i=[];var a;switch(r){case 24:a=48;break;case 36:a=72;break;default:a=48}var s="/img/new_channel_modal/airplane_"+a.toString()+".png";i.push("url('"+vvv(s)+"')");var o=i.join(",");var l={restricted:t.invite_prefs&&"restricted"===t.invite_prefs.type,img_classes:n.join(" "),bg_img_urls:o,size:r};return TS.templates.pending_user_image(l)},newWindowName:function e(){if("web"===TS.boot_data.app||"calls"===TS.boot_data.app)return"_self";return"new_"+n.toString()},getBotIdentifier:function e(t){if(!t.bot_id&&!t.username)return null;var r=TS.bots.getBotByMsg(t);var n=!t.username&&r&&r.name?r.name:t.username;var i=r?r.id:"NOBOTID";return i+"_"+n},getBotName:function e(t){var r=t.username;if(!r){var n=TS.bots.getBotByMsg(t);if(n&&n.name)r=n.name}return r},getBotNameWithLink:function e(t){var r=t.username;var n=TS.bots.getBotByMsg(t);var i=TS.templates.builders.makeBotLink(n);if(!r)if(n&&n.name)r=n.name;else if(t.bot_profile&&t.bot_profile.name)r=t.bot_profile.name;return new Handlebars.SafeString(i.start_a+_.escape(r)+i.end_a)},makeBotLink:function e(t,r){var n="";var i="";var a=r||{};if(t&&!t.deleted){n='<a class="app_preview_link '+(a.classes?a.classes:" ")+'" target="/services/'+t.id+'" style="'+(a.style?a.style:" ")+'" href="/services/'+t.id+'">';i=(a.external_badge?a.external_badge:" ")+"</a>"}else{n='<a class="app_preview_link">';i="</a>"}return{start_a:n,end_a:i}},makeFiletypeHTML:function e(t){if(t.external_type)return TS.templates.builders.makeExternalFiletypeHTML(t);var r="";r+='<a href="'+t.url_private_download+'" ';r+='target="'+t.url_private_download+'" ';r+='title="'+TS.i18n.t("Download this file","templates_builders")()+'" ';r+='data-file-id="'+t.id+'" ';r+='class="subtle_silver file_ssb_download_link">';r+=TS.utility.convertFilesize(t.size)+" ";r+="<span>"+t.pretty_type+"</span>";if("snippet"===t.mode)r+=" "+TS.i18n.t("snippet","templates_builders")();r+="</a>";return r},makeExternalFiletypeHTML:function e(t){if(!t.is_external)return;var r="";switch(t.external_type){case"gdrive":switch(t.filetype){case"gsheet":r=TS.i18n.t("Spreadsheet from Google Drive","templates_builders")();break;case"gdoc":r=TS.i18n.t("Document from Google Drive","templates_builders")();break;case"gpres":r=TS.i18n.t("Presentation from Google Drive","templates_builders")();break;case"gdraw":r=TS.i18n.t("Drawing from Google Drive","templates_builders")();break;default:r=TS.i18n.t("<span>{file_type}</span> from Google Drive","templates_builders")({file_type:t.pretty_type})}break;case"dropbox":r=TS.i18n.t("<span>{file_type}</span> from Dropbox","templates_builders")({file_type:t.pretty_type});break;case"box":r=TS.i18n.t("<span>{file_type}</span> from Box","templates_builders")({file_type:t.pretty_type});break;case"onedrive":r=TS.i18n.t("<span>{file_type}</span> from OneDrive","templates_builders")({file_type:t.pretty_type});break;default:r=TS.i18n.t("File","templates_builders")()}return r},makeUnshareLink:function e(t,r){var n=(t.is_channel?"#":"")+t.name;var i=TS.i18n.t("Unshare from {channel}","templates_builders")({channel:n});return'<a class="unshare_link ts_tip ts_tip_top ts_tip_float ts_tip_unshare_link ts_tip_multiline" onclick="TS.files.promptForFileUnshare(\''+r.id+"', '"+t.id+'\')"><span class="ts_tip_tip"><span class="ts_tip_multiline_inner">'+i+'</span></span><i class="ts_icon ts_icon_minus_circle_small"></i></a>'},updateFileShareLabels:function e(t){var r=$('.file_share_label[data-file-id="'+t.id+'"]');r.each(function(){$(this).replaceWith(TS.templates.builders.makeFileShareLabel(t))});if(t.is_shared){$('.file_share_shared_label[data-file-id="'+t.id+'"]').removeClass("hidden");$('.file_share_unshared_label[data-file-id="'+t.id+'"]').addClass("hidden")}else{$('.file_share_shared_label[data-file-id="'+t.id+'"]').addClass("hidden");$('.file_share_unshared_label[data-file-id="'+t.id+'"]').removeClass("hidden")}if(t.is_public){$('.file_share_private_label[data-file-id="'+t.id+'"]').addClass("hidden");$('.file_share_public_label[data-file-id="'+t.id+'"]').removeClass("hidden")}else{$('.file_share_private_label[data-file-id="'+t.id+'"]').removeClass("hidden");$('.file_share_public_label[data-file-id="'+t.id+'"]').addClass("hidden")}},makeFileShareLabel:function e(t){var r='<span class="file_share_label" data-file-id="'+t.id+'">';var n=TS.templates.builders.makeFileGroupChannelList(t);if(!n.length){if(!t.is_public&&t.user!==TS.model.user.id)r+=TS.i18n.t("shared with you","templates_builders")()}else r+=TS.i18n.t("in {share_list}","templates_builders")({share_list:n});r+="</span>";return r},makeFileGroupChannelList:function e(t){var r=[];var n;var i;var a;for(a=0;a<t.channels.length;a+=1){i=TS.channels.getChannelById(t.channels[a]);if(!i)continue;if(i.is_mpim)continue;n='<span class="no_wrap">';n+=TS.templates.builders.makeChannelLink(i,{inherit_font_size:true});n+="&nbsp;"+TS.templates.builders.makeUnshareLink(i,t);n+="</span>";r.push(n)}var s;for(a=0;a<t.groups.length;a+=1){s=TS.groups.getGroupById(t.groups[a]);if(!s)continue;n='<span class="no_wrap">';n+=TS.templates.builders.makeGroupLink(s,{inherit_font_size:true});n+="&nbsp;"+TS.templates.builders.makeUnshareLink(s,t);n+="</span>";r.push(n)}if(!r.length)return"";return r.join(", ")},makeFileCommentHelpHTML:function e(t){if(t&&t.is_public&&(t.channels&&t.channels.length||t.groups&&t.groups.length)){var r=[];if(t.channels&&t.channels.length)r=r.concat(t.channels);if(t.groups&&t.groups.length)r=r.concat(t.groups);r=_.chain(r).map(TS.shared.getModelObById).filter(function(e){return e&&!e.is_im&&!e.is_mpim&&!TS.shared.isModelObShared(e)}).value();if(r.length<1)return"";return TS.i18n.t("Commenting in {channel_names}","templates_builders")({channel_names:TS.templates.builders.makeLinksFromModelObs(r)})}return""},makeLinksFromModelObs:function e(t,r){r=r||{};t=TS.utility.parseJSONOrElse(t,t);t=_.isArray(t)?t:[t];var n=0;t=_.chain(t).map(function(e){if(_.isString(e))return TS.shared.getModelObById(e);return e}).filter(function(e){if(!e)n+=1;return e&&!e.is_im&&!e.is_mpim}).value();var i=TS.sorter.search("",{groups:t},{allow_empty_query:true});var a=i.sort().map(function(e){var t=r.new_lines?'<span class="block">':"";t+=e.is_channel?TS.templates.builders.makeChannelLink(e,{overflow_ellipsis:r.overflow_ellipsis,inherit_font_size:r.inherit_font_size}):TS.templates.builders.makeGroupLink(e,{overflow_ellipsis:r.overflow_ellipsis,inherit_font_size:r.inherit_font_size});t+=r.new_lines?"</span>":"";return t});if(n){var s=TS.i18n.t("{private_channel_or_group_count, plural, =1{# private channel}other{# private channels}}","templates_builders")({private_channel_or_group_count:n});a.push('<span class="no_wrap'+(r.new_lines?" block":"")+'">'+s+"</span>")}if(r.new_lines)return a.join("");return TS.i18n.listify(a,{no_escape:true}).join("")},makeMessageShareLabelSafe:function e(t){var r='<span class="message_share_label">';var n="";if(t.is_channel)n=TS.templates.builders.makeChannelLink(t,{inherit_font_size:true});else if(t.is_group)n=TS.templates.builders.makeGroupLink(t,{inherit_font_size:true});r+=TS.i18n.t("in {channel}","templates_builders")({channel:n});r+="</span>";return new Handlebars.SafeString(r)},makeMessageLinkLabelSafe:function e(t){var r=TS.i18n.t("From URL:","templates_builders")()+" <a "+TS.utility.makeRefererSafeLink(t)+' class="external_link"title="'+_.escape(t)+'"target="_blank">'+_.escape(t)+"</a>";return new Handlebars.SafeString(r)},makeSHRoomParticipantList:function e(t){var r=t.date_end?t.participant_history:t.participants;var n=_.compact(r.map(function(e){var t=TS.members.getMemberById(e);if(t&&t.is_unknown)return TS.templates.unknown_member({id:t.id});else if(t)return _.escape(TS.members.getPrefCompliantMemberName(t));return})).join(", ");return new Handlebars.SafeString(n)},makeSHRoomSharedList:function e(t){if(!t.channels||!t.channels.length)return"";var r=[];var n;var i;var a;for(var s=0;s<t.channels.length;s+=1){a=TS.shared.getModelObById(t.channels[s]);if(!a)continue;if(a.is_channel)n=TS.templates.builders.makeChannelLink(a);else if(a.is_group)n=TS.templates.builders.makeGroupLink(a);else if(a.is_im){i=TS.members.getMemberById(a.user);if(!i)continue;n=TS.templates.builders.makeMemberPreviewLink(i)}else continue;r.push(n)}if(!r.length)return"";return r.join(", ")},buildFileSharingControls:function e(t,r,n,i,a){var s;if(TS.client){if(!TS.client.activeChannelIsHidden())s=TS.shared.getActiveModelOb()}else if(TS.web&&TS.web.space)s=TS.shared.getModelObById(TS.web.space.getOriginChannel());if(s&&TS.channels.isChannelRequired(s)&&!TS.permissions.members.canPostInChannel(s))s={};var o=[];var l=[];var u=[];n=n||"";$("#file_sharing_div").remove();var d=false;var c=false;if(!t)d=true;else if(t.user===TS.model.user.id)d=true;else if(t.user){var m=TS.members.getMemberById(t.user);if(m&&m.is_external)c=TS.teams.getTeamNameByMember(m)}if(t&&t.id&&TS.files.isFilePrivate(t)&&!d&&!t.bot_id)var f=new Handlebars.SafeString(TS.i18n.t("This file was sent to you privately. You may want to check with <strong>{user_names}</strong> before sharing it.","files")({user_names:TS.members.getPrefCompliantMemberNameById(t.user),file_owners_count:1,file_count:1,file_title:t.title?TS.format.formatNoSpecials(t.title||"Untitled"):""}));if(TS.shared.isModelObShared(s)&&s.shared_team_ids&&s.shared_team_ids.length){var p=TS.i18n.listify(_.map(s.shared_team_ids,TS.teams.getTeamNameById)).join("");var h=new Handlebars.SafeString(TS.i18n.t("<strong>This is a Shared channel</strong>. Messages and files sent here will be seen by members of <strong>{shared_teams_list}</strong>.","shared_channels")({shared_teams_list:p}))}var g=TS.web&&TS.web.space&&d&&!TS.prefs.getTeamPref("disable_file_editing")&&!t.channels.concat(t.groups).concat(t.ims).length;if(t)if(t&&t.mimetype&&-1!=t.mimetype.indexOf("application/vnd.google-apps")){var S=t.pretty_type?t.pretty_type.replace(/GDocs /,""):null;if(S){var T={teamFileSpreadsheet:TS.i18n.t("Anyone at {team_name} with the link will be able to edit this Google Spreadsheet","templates_builders"),teamFilePresentation:TS.i18n.t("Anyone at {team_name} with the link will be able to edit this Google Presentation","templates_builders"),teamFileDocument:TS.i18n.t("Anyone at {team_name} with the link will be able to edit this Google Document","templates_builders"),fileSpreadsheet:TS.i18n.t("Anyone with the link will be able to edit this Google Spreadsheet","templates_builders"),filePresentation:TS.i18n.t("Anyone with the link will be able to edit this Google Presentation","templates_builders"),fileDocument:TS.i18n.t("Anyone with the link will be able to edit this Google Document","templates_builders"),fallback:TS.i18n.t("Anyone at {team_name} with the link will be able to edit this Google file","templates_builders")};var v;if(TS.model.team.name){if(S&&"Document"===S)v=T.teamFileDocument({team_name:TS.model.team.name});else if(S&&"Spreadsheet"===S)v=T.teamFileSpreadsheet({team_name:TS.model.team.name});else if(S&&"Presentation"===S)v=T.teamFilePresentation({team_name:TS.model.team.name})}else if(!TS.model.team.name){if(S&&"Document"===S)v=T.fileDocument();else if(S&&"Spreadsheet"===S)v=T.fileSpreadsheet();else if(S&&"Presentation"===S)v=T.filePresentation()}else v=T.fallback()}}return TS.templates.file_sharing({channels:o,groups:l,members:u,model_ob:s,file:t,shared_channel_warning:h,file_sharing_notice:v,is_owner:d,owner_team:c,reshare_private_file:f,has_title:i,hide_checkbox:r,comment:n,selection:a,show_channel_join_note:s&&s.is_channel&&!s.is_member&&!s.is_archived,disable_file_sharing_dialog_comment:c||s&&TS.shared.isModelObShared(s),enable_collab_editing:g})},buildNonDefaultNotificationBlock:function e(t){t=t||"";var r="";var n;var i=TS.notifs.getCorGsNotUsingGlobalNotificationSetting();if(i.everything.length){r+='<div class="'+t+'">'+TS.i18n.t("Set to notify for <strong>all activity</strong>:","templates_builders")();for(n=0;n<i.everything.length;n+=1)r+=" "+("C"===i.everything[n].id.charAt(0)?"#":"")+i.everything[n].name+(n!=i.everything.length-1?",":"");r+="</div>"}if(i.mentions.length){r+='<div class="'+t+'">'+TS.i18n.t("Set to notify only for <strong>Highlight Words</strong>:","templates_builders")();for(n=0;n<i.mentions.length;n+=1)r+=" "+("C"===i.mentions[n].id.charAt(0)?"#":"")+i.mentions[n].name+(n!=i.mentions.length-1?",":"");r+="</div>"}if(i.nothing.length){r+='<div class="'+t+'">'+TS.i18n.t("Set to <strong>never notify</strong>:","templates_builders")();for(n=0;n<i.nothing.length;n+=1)r+=" "+("C"===i.nothing[n].id.charAt(0)?"#":"")+i.nothing[n].name+(n!=i.nothing.length-1?",":"");r+="</div>"}return r},strBuilder:function e(t,r){return t.replace(/\${([a-z_]+)}/g,function(e,t){if(t.indexOf("_html")>-1)return r[t];return _.escape(r[t])})},buildRxnTitle:function e(t,r){if(!r)return;var n;var i=":"+t.name+":";if(TS.i18n.locale()!==TS.interop.I18n.DEFAULT_LOCALE)i=TS.emoji.maybeGetLocalizedEmojiString(i);if(t.is_handy||t.is_poll&&!t.count){n=_.escape(i||t.name);return TS.i18n.t("Add reaction {emoji}","rxn")({emoji:n})}var a=false;var s=false;var o=true;n=_.escape(i||t.name);if(!TS.emoji.isValidName(t.name)&&!t.url)n+=TS.i18n.t("(emoji has been removed)","rxn")();if(1===t.count){if(t.user_reacted)return TS.i18n.t('You (click to remove) <span class="subtle_silver">reacted with {emoji}</span>',"rxn")({emoji:n});return TS.i18n.t('{user} <span class="subtle_silver">reacted with {emoji}</span>',"rxn")({user:_.escape(TS.members.getPrefCompliantMemberNameById(t.member_ids[0],a,s,o)),emoji:n})}var l=false;var u=t.member_ids.length!=t.count;var d=t.member_ids.map(function(e,t){var r;if(TS.model.user.id===e){l=true;r=0===t?TS.i18n.t("You","rxn")():TS.i18n.t("you","rxn")()}else r=TS.members.getPrefCompliantMemberNameById(e,a,s,o);return r});if(u)d.push(TS.i18n.t("others","rxn")());if(l)return TS.i18n.t('{users_and_you} <span class="subtle_silver">reacted with {emoji}</span>',"rxn")({users_and_you:_.escape(TS.i18n.listify(d,{no_escape:true}).join("")),emoji:n});return TS.i18n.t('{users} <span class="subtle_silver">reacted with {emoji}</span>',"rxn")({users:_.escape(TS.i18n.listify(d,{no_escape:true}).join("")),emoji:n})},buildRxnHtml:function e(t){var r;if(t.url)r='<span class="emoji-outer emoji-sizer emoji-bg-contain" style="background-image: url('+t.url+');"></span>';else if(TS.emoji.isValidName(t.name)){var n=t.is_handy&&TS.emoji.isNameSkinToneModifiable(t.name)?TS.emoji.getChosenSkinToneModifier():"";r=TS.emoji.graphicReplace(":"+t.name+":"+n,{no_skin_tone_squares:t.is_handy})}else r=TS.emoji.MISSING_EMOJI_HTML;var i=TS.templates.builders.buildRxnTitle(t);var a=[];if(t.user_reacted)a.push("user_reacted");if(t.is_handy)a.push("is_handy");if(t.is_hidden)a.push("hidden");return TS.templates.rxns_rxn({name:t.name,url:t.url,css_classes:a.join(" "),emoji_html:new Handlebars.SafeString(r),title:i,count:t.count,is_handy:!!t.is_handy})},updateRxnHtml:function e(t,r){var n=t.children('.rxn[data-emoji="'+r.name+'"]');if(n.length){n.find(".emoji_rxn_count").attr("aria-label",r.count);n.toggleClass("user_reacted",r.user_reacted);var i=true;var a=TS.templates.builders.buildRxnTitle(r,i);var s;var o=n.find(".ts_tip_tip_inner");if(!o.length)o=n.find(".ts_tip_multiline_inner");if(o.length){s=o.html();if(s!=a)TS.tips.updateTipTitle(n,a)}else{s=n.prop("title");if(s!=a)TS.tips.updateTipTitle(n,a)}if(r.animate_it_dramatically)setTimeout(r.animate_callback,0);else if(r.animate_it)setTimeout(r.animate_callback,0)}else{t.children(".rxn_hover_container").before($(TS.templates.builders.buildRxnHtml(r)));n=t.children('.rxn[data-emoji="'+r.name+'"]');if(r.animate_it_dramatically)n.css("opacity",0).transition({opacity:1},300,r.animate_callback);else if(r.animate_it)n.css("opacity",0).transition({opacity:1},300,r.animate_callback)}},updateRxnPanels:function e(t,r,n){var i=TS.rxns.getExistingRxnsByKey(t);var a=$("."+TS.templates.makeRxnKeyDomClass(t));var s=function e(a){var s;var o;if(i)i.forEach(function(e){s=e.name==r;o=s&&n==TS.model.user.id;TS.templates.builders.updateRxnHtml(a,{animate_it:s,animate_it_dramatically:o,name:e.name,url:e.url,count:e.count,user_reacted:TS.rxns.doesRxnsHaveRxnFromUser(i,e.name),member_ids:e.users,rxn_key:t})});var l=a.children(".rxn");l.each(function(e,t){var r=$(t);var n=String(r.data("emoji"));if(!TS.rxns.doesRxnsHaveRxn(i,n)){r.addClass("going_away");r.transition({opacity:0},300,function(){r.remove()})}});TS.ui.messages.maybeUpdateMessageHoverContainer(a.closest("ts-message"));var u=a.children(".rxn_hover_container").find(".rxn.is_handy");u.each(function(e,t){var r=$(t);var n=String(r.data("emoji"));r.toggleClass("hidden",TS.rxns.doesRxnsHaveSkinlessRxn(i,n))})};a.each(function(e,r){var n=$(r);if(!i){n.empty();TS.ui.messages.maybeUpdateMessageHoverContainer(n.closest("ts-message"));return}if(!n.children().length)n=$(TS.templates.builders.rxnPanel(t)).replaceAll(n);s(n)})},rxnPanel:function e(t){if(!t)return;var r=[];var n={};var i="";var a=TS.rxns.getExistingRxnsByKey(t);var s="";var o=function e(){if(a){a=_.sortBy(a,function(e){return TS.emoji.isValidName(e.name)?0:1});a.forEach(function(e){s+=TS.templates.builders.buildRxnHtml({name:e.name,url:e.url,count:e.count,user_reacted:TS.rxns.doesRxnsHaveRxnFromUser(a,e.name),member_ids:e.users,rxn_key:t})})}_.each(_.keys(n.items),function(e){i+=TS.templates.builders.buildRxnHtml({name:e,is_handy:true,is_hidden:TS.rxns.doesRxnsHaveSkinlessRxn(a,e),rxn_key:t})})};o();return TS.templates.rxns_panel({css_classes:r.join(" "),rxn_key:t,rxns_html:new Handlebars.SafeString(s),handy_rxns_html:new Handlebars.SafeString(i),id_class:TS.templates.makeRxnKeyDomClass(t),has_hovers:!n.is_poll})},filePreviewBackIcon:function e(){return'<i class="ts_icon ts_icon_chevron_medium_left back_icon"></i>'},buildQuickSwitcherBtnHtml:function e(){var t=TS.i18n.t("Quick Switcher","templates_builders")();if(TS.model.is_our_app||TS.prefs.getPref("k_key_omnibox"))t+=[" ",'<span class="subtle_silver">(',TS.model.is_mac?"&#8984K":"Ctrl+K",")</span>"].join("");return'<i class="ts_icon ts_icon_filter"></i><span id="quick_switcher_label" class="ts_tip_tip">'+t+"</span>"},atLabel:function e(t){if("group"===t)t="channel";var r=_.keyBy(TS.model.BROADCAST_KEYWORDS,"ms_name")[t].name||t;return"@"+r},makeMemberTypeBadge:function e(t,r,n,i){if(!TS.boot_data.page_needs_enterprise)return"";r=parseInt(r,10);if(isNaN(r))r=16;if("boolean"!==typeof n)n=false;if("boolean"!==typeof i)i=false;var a={size:"member_type_badge_"+r,big:r>=20,is_standalone:n,with_tooltip:i};if(t.is_external)return"";if(t.is_ultra_restricted)return TS.templates.member_type_guest_badge(a);if(t.is_restricted)return TS.templates.member_type_restricted_badge(a);return""},makeMemberTypeBadgeClass:function e(t){if(!TS.boot_data.page_needs_enterprise)return"";if(!t.is_restricted)return"";return"has_member_type_badge"},makeMemberColorClass:function e(t){var r="color_";if(t)r+=t.id+" color_"+t.color;else r+="unknown";return r},makeMemberTypeBadgeCompact:function e(t,r){if(!TS.boot_data.page_needs_enterprise)return"";if("boolean"!==typeof r)r=false;var n={icon_class:"",with_tooltip:r,tooltip:{member_type:"",type_description:""}};var i=TS.boot_data.page_needs_enterprise?TS.i18n.t("organization directory","templates_builders")():TS.i18n.t("workspace directory","templates_builders")();if(t.is_external)return"";else if(t.is_ultra_restricted){n.icon_class="ts_icon_single_channel_guest";n.tooltip.member_type=TS.i18n.t("Single-Channel Guests","templates_builders")();n.tooltip.type_description=TS.i18n.t("see a partial {directory_name} and can only access messages and files from the channel they belong to.","templates_builders")({directory_name:i});return TS.templates.member_type_icon(n)}else if(t.is_restricted){n.icon_class="ts_icon_restricted_user";n.tooltip.member_type=TS.i18n.t("Multi-Channel Guests","templates_builders")();n.tooltip.type_description=TS.i18n.t("see only a partial {directory_name} and can only access messages and files from selected channels.","templates_builders")({directory_name:i});return TS.templates.member_type_icon(n)}return""},getMemberTypeClass:function e(t){if(t.is_restricted)return" ra";return""},makeTeamlabel:function e(t){if(!t)return"ERROR: MISSING TEAM ID";var r="";var n=TS.teams.getTeamById(t);if(!n)return"ERROR: UNABLE TO GET TEAM INFO";r='<span class="org_team_tag_name">'+_.escape(n.name)+"</span>";return r},loadingHTML:function e(){var t=cdn_url+"/9c217/img/loading_hash_animation_@2x.gif";var r=cdn_url+"/9c217/img/loading_hash_animation.gif";var n=TS.i18n.t("loading&hellip;","templates_builders")();return'<div class="loading_hash_animation"><img src="'+t+'" alt="'+n+'" srcset="'+r+" 1x, "+t+' 2x" /><br />'+n+"</div>"},buildThreadMsgHTML:function e(t,r,n,i){var a=!!_.get(i,"inline");var s=a?TS.templates.makeMsgDomId(t.ts):TS.templates.makeMsgDomIdInThreadsView(t.ts);return TS.templates.builders.msgs.buildHTML({msg_dom_id:s,model_ob:r,msg:t,is_threads_view:true,is_new_reply:TS.utility.msgs.isMsgReply(t)&&n&&t.ts>n.initial_last_read,relative_ts:true,enable_slack_action_links:true})},buildThreadParticipantListHTML:function e(t){var r;if(TS.boot_data.feature_threads_perf)r=t.reply_users;else{r=_.map(t.replies,"user");var n=_.map(t.replies,"bot_id");r=r.concat(n)}r=_.without(r,"U00",void 0);if("tombstone"!==t.subtype&&t.user)r.unshift(t.user);r=_.uniq(r);if(_.includes(r,TS.model.user.id)){r=_.without(r,TS.model.user.id);r.push(TS.model.user.id)}var i=_.map(r,function(e){var t;if("B"===e.charAt(0))t=TS.bots.getBotNameById(e);else if(e===TS.model.user.id)t=TS.i18n.t("you","threads")();else t=TS.members.getPrefCompliantMemberNameById(e);return t});if(1===r.length){if(r[0]===TS.model.user.id)return TS.i18n.t("Just you","threads")();return _.escape(i[0])}else if(2===r.length){if(r[1]===TS.model.user.id)return TS.i18n.t("{user_name} and you","threads")({user_name:_.escape(i[0])});return TS.i18n.t("{user_name1} and {user_name2}","threads")({user_name1:_.escape(i[0]),user_name2:_.escape(i[1])})}else if(3===r.length){if(r[2]===TS.model.user.id)return TS.i18n.t("{user_name1}, {user_name2}, and you","threads")({user_name1:_.escape(i[0]),user_name2:_.escape(i[1])});return TS.i18n.t("{user_name1}, {user_name2}, and {user_name3}","threads")({user_name1:_.escape(i[0]),user_name2:_.escape(i[1]),user_name3:_.escape(i[2])})}else if(r.length>3){var a=TS.boot_data.feature_threads_perf?t.reply_users_count:r.length;var s=a-2;var o=_.drop(i,2);if(TS.boot_data.feature_threads_perf&&o.length<s)o.push(TS.i18n.t("others","threads")());else{var l=25;if(o.length>l){o=_.take(o,l);o.push(TS.i18n.t("others","threads")())}}var u=TS.i18n.listify(o,{no_escape:true}).join("");return TS.templates.thread_participants_with_overflow({num_others:s,user_name1:i[0],user_name2:i[1],other_names:u})}},buildBroadcastRepliersSummaryHTML:function e(t){var r=t.reply_count;var n;var i;if(TS.boot_data.feature_threads_perf){n=t.reply_users;i=t.reply_users_count}else{var a=t.replies;if(!a||!a.length)return"";n=_.map(a,"user");n=_.uniq(n);i=n.length}var s=_.map(n,function(e){if("U00"===e)return null;var t=e.charAt(0);var r;if("B"===t)r=TS.bots.getBotById(e);else r=TS.members.getPotentiallyUnknownMemberById(e);return r});s=_.compact(s);if(!r||!s.length)return"";if(1===r)return TS.i18n.t("1 reply","threads")();var o=!!_.find(s,{is_self:true});if(o){s=_.reject(s,{is_self:true});s.push(TS.model.user)}var l=_.map(s,function(e){if(e.is_bot)return e.name;else if(e.is_self)return TS.i18n.t("you","threads")();return TS.members.getPrefCompliantMemberName(e)});if(1===s.length){if(o)return TS.i18n.t("{reply_count, plural, =1{1 reply} other{# replies}} from you","threads")({reply_count:r});return TS.i18n.t("{reply_count, plural, =1{1 reply} other{# replies}} from {user_name}","threads")({reply_count:r,user_name:_.escape(l[0])})}else if(2===s.length){if(o)return TS.i18n.t("{reply_count, plural, =1{1 reply} other{# replies}} from {user_name} and you","threads")({reply_count:r,user_name:_.escape(l[0])});return TS.i18n.t("{reply_count, plural, =1{1 reply} other{# replies}} from {user_name1} and {user_name2}","threads")({reply_count:r,user_name1:_.escape(l[0]),user_name2:_.escape(l[1])})}else if(3===s.length){if(o)return TS.i18n.t("{reply_count, plural, =1{1 reply} other{# replies}} from {user_name1}, {user_name2}, and you","threads")({reply_count:r,user_name1:_.escape(l[0]),user_name2:_.escape(l[1])});return TS.i18n.t("{reply_count, plural, =1{1 reply} other{# replies}} from {user_name1}, {user_name2}, and {user_name3}","threads")({reply_count:r,user_name1:_.escape(l[0]),user_name2:_.escape(l[1]),user_name3:_.escape(l[2])})}else if(s.length>3){var u=_.drop(l,2);if(u.length<i-2)u.push(TS.i18n.t("others","threads")());var d=TS.i18n.listify(u,{no_escape:true}).join("");return TS.templates.thread_broadcast_repliers_with_overflow({reply_count:r,num_others:i-2,user_name1:l[0],user_name2:l[1],other_names:d})}return""},replaceEmojiForPosts:function e(t){if(t.childNodes)for(var r=0;r<t.childNodes.length;r+=1)TS.templates.builders.replaceEmojiForPosts(t.childNodes[r]);if(t.nodeType==Node.TEXT_NODE){var n=_.escape(t.textContent);var i=TS.emoji.graphicReplace(TS.emoji.replaceEmoticons(n),{include_title:true,include_text:false});if(i!==n){var a=$("<span>").html(i)[0];[].slice.apply(a.childNodes).forEach(function(e){t.parentNode.insertBefore(e,t)});t.parentNode.removeChild(t)}}},formatPostsForModern:function e(t){var r=$("<div>").html(t);TS.templates.builders.replaceEmojiForPosts(r[0]);TS.utility.makeSureAllLinksHaveTargets(r);return r.html()},proxyImgUrlsForEmails:function e(t){t.find("img").each(function(){var e=$(this).attr("src");var t=$(this).attr("width");var r=$(this).attr("height");var n;if(t&&r)n=TS.utility.getImgProxyURL(e,t,r);else n=TS.utility.getImgProxyURL(e);$(this).attr("src",n)})},formatEmailsForModern:function e(t){var r=$("<div>").html(t);TS.templates.builders.proxyImgUrlsForEmails(r);TS.utility.makeSureAllLinksHaveTargets(r);return r.html()},test:function e(){var r={};Object.defineProperty(r,"_buildStarComponents",{get:function e(){return t},set:function e(r){t=r}});return r}});function e(e){var t="";var r=e.unread_highlight_cnt;var n=e.unread_cnt;if(r&&!e.is_im)t+=r+" "+TS.i18n.t("unread highlight","templates_builders")()+" ";else if(n)t+=n+" "+TS.i18n.t("unread","templates_builders")()+" ";if(n)t+=TS.i18n.t("{count, plural, =1 {message} other {messages}}","templates_builders")({count:n});return t}function t(e,t,r){if(!e)return{};if(t&&"string"===typeof t&&("channel"===e||"group"===e||"mpim"===e||"im"===e))t=TS.shared.getModelObById(t);if(!t)return{};if("message"===e&&r&&"string"===typeof r){var n=r;r=TS.channels.getChannelById(n);if(!r)r=TS.ims.getImById(n);if(!r)r=TS.groups.getGroupById(n)}var i={};var a=[];var s=[];s=["star","ts_icon","ts_icon_star_o","ts_icon_inherit"];var o="ts_tip_top";var l=t.id||t.ts;var u=r?r.id:null;if("message"===e){if(!u)return{};i["data-msg-id"]=l;i["data-c-id"]=u;if(TS.utility.msgs.isTempMsg(t))s.push("invisible")}else if("file"===e)i["data-file-id"]=l;else if("file_comment"===e){i["data-comment-id"]=l;i["data-file-id"]=u;s.push("star_comment")}else if("channel"===e){o="ts_tip_bottom";i["data-channel-id"]=l}else if("group"===e){o="ts_tip_bottom";i["data-group-id"]=l}else if("im"===e){if(TS.apps.isAppSpaceEnabled()&&TS.apps.isCurrentModelViewAnApp())e="app";o="ts_tip_bottom";i["data-im-id"]=l}else if("mpim"===e){o="ts_tip_bottom";i["data-mpim-id"]=l}else{TS.error("buildStar needs to handle star item type:"+e);return{}}s=_.concat(s,o);if(t.is_starred){s.push("starred","ts_icon_star");s.splice(s.indexOf("ts_icon_star_o"),1)}s.push("star_"+e);$.each(i,function(e,t){a.push(e+'="'+t+'"')});var d={message:TS.i18n.t("message","templates_builders")(),file:TS.i18n.t("file","templates_builders")(),file_comment:TS.i18n.t("file comment","templates_builders")(),channel:TS.i18n.t("channel","templates_builders")(),group:TS.i18n.t("channel","templates_builders")(),im:TS.i18n.t("direct message","templates_builders")(),app:TS.i18n.t("app","templates_builders")(),mpim:TS.i18n.t("direct message","templates_builders")()};var c;var m;switch(e){case"message":c=TS.i18n.t("Star this message","templates_builders")();m=TS.i18n.t("Unstar this message","templates_builders")();break;case"file":c=TS.i18n.t("Star this file","templates_builders")();m=TS.i18n.t("Unstar this file","templates_builders")();break;case"file_comment":c=TS.i18n.t("Star this file comment","templates_builders")();m=TS.i18n.t("Unstar this file comment","templates_builders")();break;case"channel":case"group":c=TS.i18n.t("Star this channel","templates_builders")();m=TS.i18n.t("Unstar this channel","templates_builders")();break;case"im":case"mpim":c=TS.i18n.t("Star this direct message","templates_builders")();m=TS.i18n.t("Unstar this direct message","templates_builders")();break;case"app":c=TS.i18n.t("Star this app","templates_builders")();m=TS.i18n.t("Unstar this app","templates_builders")();break;default:c=TS.i18n.t("Star","templates_builders")();m=TS.i18n.t("Unstar","templates_builders")()}return{attributes:a,class_names:s,html_attrs:i,readable_type:d[e],type:e,is_starred:t.is_starred,star_str:c,unstar_str:m}}var n=Date.now()})()},4795:function(e,t,r){(function(){TS.registerModule("templates.builders.msgs",{buildHTML:function t(r,n){if(n)TS.dir(0,r);try{var i=r.msg;var a=r.model_ob;var s=r.prev_msg;var o=!!r.highlight;var l=!!r.no_attachments;var u=!!r.standalone;var d=!!(u||r.hide_actions);var c=!!r.full_date;if(TS.prefs.getPref("fuller_timestamps")&&!c)c=!TS.interop.datetime.isSameDay(TS.interop.datetime.toDateObject(i.ts),new Date);var m=!!r.relative_ts;var f=r.jump_link?new Handlebars.SafeString(r.jump_link):"";var p=!!r.starred_items_list;var h=r.starred_items_actions;var g=r.container_id?"#"+r.container_id:"";var S=!!r.enable_slack_action_links;var T=!!(r&&r.highlight_as_new);var v="";var b=TS.utility.members.getEntityFromMessage(i);var y=true;var w=TS.interop.datetime.toDateObject(i.ts);var k=false;var x=false;var C=!!i.is_pending;var M=i.user;var I;var P=i.is_ephemeral;var A=TS.templates.makeMsgDomId(i.ts);var E=TS.utility.msgs.getMsgActions(i,a);if(!M)M=TS.templates.builders.getBotIdentifier(i);var F=TS.utility.msgs.shouldHaveBotLabel(i,b);var O;var B;var D;var H;A=r.msg_dom_id||A;var j=!!r.is_in_conversation;var R=!!r.is_threads_view;if(false){i=_.cloneDeep(i);i.text+=" <slack-action://BSLACKBOT/help/files/D026MK7NF|testing>"}if(F){var L=TS.bots.getBotInfoByMsg(i);if(L){O=_.get(L,"app_id");B=_.get(L,"bot_id");D=_.get(L,"team_id")?L.team_id:_.get(i,"source_team_id")}H=true}if(s){I="file_comment"===s.subtype&&s.comment?s.comment.user:s.user;if(!I)I=TS.templates.builders.getBotIdentifier(s)}if(!i.no_display&&!u)if(s){var N=TS.interop.datetime.toDateObject(s.ts);if(i.subtype&&"file_comment"===i.subtype&&i.comment)M=i.comment.user;var U=TS.interop.rules.messages.isAutomatedSubtype(i.subtype);if(U||"thread_broadcast"===i.subtype)y=true;else if(I==M&&!U)if(!i.subtype&&s.subtype&&"file_comment"===s.subtype)y=true;else{if(!s.subtype||TS.templates.builders.getBotIdentifier(s)){var q=s.thread_ts||s.ts;var G=i.thread_ts==q;var W=!i.thread_ts&&!s.thread_ts;if(G||W)y=false}if(TS.utility.msgs.isTempMsg(i)&&("bot_message"===i.type||"USLACKBOT"===i.user))y=true}if(!C&&!TS.interop.datetime.isSameDay(w,N)&&!j){k=true;var z=$(g+" div.day_divider");if(z.length>0){var K;var V=$(z[z.length-1]);if(V.length){K="";try{K=TS.templates.messages_day_divider({ts:V.data("ts")})}catch(e){if(!e.message)e.message="";e.message+=" $last_divider.data('ts'):"+V.data("ts");TS.info("Problem with TS.templates.messages_day_divider 2.1: "+JSON.stringify(e))}V.replaceWith(K)}if(z.length>1){var Y=$(z[z.length-2]);if(Y.length){K="";try{K=TS.templates.messages_day_divider({ts:Y.data("ts")})}catch(e){if(!e.message)e.message="";e.message+=" $second_last_divider.data('ts'):"+Y.data("ts");TS.info("Problem with TS.templates.messages_day_divider 3.1: "+JSON.stringify(e))}Y.replaceWith(K)}}}}if(!C&&TS.interop.datetime.distanceInMinutes(w,N)>TS.model.msg_activity_interval)x=true}else if(!j)x=true;if(x)y=true;if("message"!==i.type)y=true;if("me_message"===i.subtype||s&&"me_message"===s.subtype)y=true;var J=true;if(u)J=false;var Q=false;var X=TS.rxns.getExistingRxnsByKey(i._rxn_key);if(X)Q=true;if(r.for_mention_rxn_display)y=false;var Z;var ee;var te="#msgs_div"===g||"#unread_msgs_div"===g;if(TS.client&&TS.client.highlights&&!u){Z=te&&TS.client.highlights.msgIsHighlight(a.id,i.ts);ee=te&&TS.client.highlights.msgIsHighlightUnfurl(a.id,i.ts)}d=!!(d||C);var re={msg:i,model_ob:a,member:b,actions:E,show_user:y,unprocessed:C,highlight:o,do_inline_imgs:J,msg_dom_id:A,standalone:u,hide_actions:d,full_date:c,relative_ts:m,jump_link:f,show_resend_controls:i.ts in TS.model.display_unsent_msgs,starred_items_list:p,starred_items_actions:h,no_attachments:l,is_ephemeral:P,enable_slack_action_links:S,is_bot:F,bot_id:B,app_id:O,team_id:D,is_app_data_enabled:H,highlight_as_new:T,show_star:!p&&!P,has_rxns:Q,for_mention_display:r.for_mention_display,for_mention_rxn_display:r.for_mention_rxn_display,for_search_display:r.for_search_display,for_top_results_search_display:r.for_top_results_search_display,ts_tip_delay_class:"ts_tip_delay_600",is_root_msg:r.is_root_msg,is_in_conversation:j,is_threads_view:R,file_title_only:"file_reaction"===i.subtype,is_slackbot_response:"slackbot_response"===i.subtype,show_channel_highlight:Z,is_highlighted_unfurl:ee,show_briefing_feedback:r.briefing||o};if(E.add_rxn||E.add_file_rxn||E.add_file_comment_rxn)re.show_rxn_action=true;re.star_components=TS.templates.builders.buildStarComponents("message",i,a);var ne=true;if(u)ne=false;if(TS.utility.msgs.isFileMsg(i))ne=false;re.selectable=ne;if(j)re.msg_dom_id=TS.templates.makeMsgDomIdInConversation(i.ts);if(TS.utility.msgs.isMsgReply(i))re.show_reply_action=false;else{var ie=true;re.show_reply_action=TS.replies.canReplyToMsg(a,i,ie)&&!r.is_root_msg;if(!re.show_reply_action&&TS.utility.msgs.isFileMsg(i)&&i.file)re.show_comment_action=true}var ae=i.ts==i.thread_ts;if((ae||!i.thread_ts)&&j&&TS.client){re.format_for_thread_root=true;if(a.is_im||a.is_mpim)re.model_ob_name=TS.i18n.t("Direct message","messages")();else re.model_ob_name=TS.i18n.t("in {channel_display_name}","messages")({channel_display_name:TS.shared.getDisplayNameForModelOb(a)})}if(ae&&i.reply_count&&!j&&!u&&!r.for_search_display&&!r.for_top_results_search_display&&!r.is_threads_view)re.show_reply_bar=true;re.is_tombstone="tombstone"===i.subtype;re.is_new_reply=!!r.is_new_reply;if(TS.utility.msgs.isMsgReply(i)&&"thread_broadcast"===i.subtype&&!j&&!u&&!r.is_threads_view){re.is_broadcast=true;re.show_reply_action=true}if(re.is_broadcast&&i.root){re.root_repliers_summary=new Handlebars.SafeString(TS.templates.builders.buildBroadcastRepliersSummaryHTML(i.root));if("tombstone"!==i.root.subtype){var se=i.root.text;var oe=_.first(i.root.attachments);if(_.get(oe,"is_msg_unfurl")){var le=oe.from_url&&i.root.text==="<"+oe.from_url+">";if(!se||le)se=oe.text}if(se){var ue=TS.format.formatBroadcastExcerpt(se,i.root);if(ue.length>150)ue=TS.utility.truncateHTML(ue,150);re.root_excerpt=new Handlebars.SafeString(ue)}}}var de;if("file_share"===i.subtype||"file_mention"===i.subtype||TS.boot_data.feature_file_threads&&!i.subtype&&i.file)de=i.file;else if("file_comment"===i.subtype)de=i.comment;else de=i;if(de&&de.pinned_to&&de.pinned_to.length>0)re.is_pinned=_.some(de.pinned_to,function(e){return e===a.id});else re.is_pinned=false;if(re.is_pinned)re.pin_html=TS.templates.builders.buildPinInfoHtml(i);else re.pin_html="";if(TS.client&&TS.client.highlights&&!u){re.is_recap=Z;if(TS.client.highlights.shouldRenderHighlightsUI(a.id,i.ts))re.highlights_html=TS.templates.builders.buildHighlightsInfoHtml({recap:{data:TS.client.highlights.getHighlight(a.id,i.ts)}});re.show_recap_debug=TS.client.highlights.canShowRecapDebug(a.id,i.ts);re.highlight_is_leaving_feedback=TS.client.highlights.msgIsLeavingFeedback(a.id,i.ts)}if(TS.boot_data.feature_sli_briefing&&TS.highlights_briefing&&r.briefing)re.show_recap_debug="sli_debug_info"===TS.highlights_briefing.sli_recaps_debug_group;if(!i.subtype&&(r.for_search_display||r.for_top_results_search_display)&&i.file)if(i.comment)re.star_components=TS.templates.builders.buildStarComponents("file_comment",i.comment,i.file);else re.star_components=TS.templates.builders.buildStarComponents("file",i.file,null);if(!TS.utility.msgs.isTempMsg(i)&&!i.is_ephemeral){re.permalink=TS.utility.msgs.constructMsgPermalink(a,i.ts,i.thread_ts);re.abs_permalink=TS.utility.msgs.constructAbsoluteMsgPermalink(a,i.ts,i.thread_ts)}if((r.for_top_results_search_display||r.for_search_display)&&TS.boot_data.page_needs_enterprise){re.abs_permalink=i.permalink;re.archive_link=i.permalink;re.permalink=i.permalink}if("file_share"===i.subtype||"file_mention"===i.subtype||"file_reaction"===i.subtype||TS.boot_data.feature_file_threads&&!i.subtype&&i.file){if(i.file){re.file=i.file;re.edit=TS.files.getFileActions(i.file).edit;re.download=!("snippet"===i.file.mode||"post"===i.file.mode||"space"===i.file.mode||i.file.is_external);re.new_window=!re.edit&&!re.download;re.abs_permalink=i.file.permalink;if(!p)re.star_components=TS.templates.builders.buildStarComponents("file",i.file,null);$.extend(re,TS.files.getFileTemplateArguments(i.file,360));re.is_message=true;re.lightbox=true;if(("file_share"===i.subtype||TS.boot_data.feature_file_threads)&&i.upload){if("email"===i.file.mode)re.is_added=true;re.icon_class=TS.utility.getImageIconClass(i.file,"thumb_80")}else if(i.file.user!=i.user)re.uploader=TS.utility.members.getEntityFromFile(i.file);if((TS.boot_data.feature_file_threads||"file_share"===i.subtype)&&i.upload&&i.file.initial_comment)re.show_initial_comment=true;if(TS.files.isFileAuthorExternal(i.file))re.show_comment_action=false}var _e=TS.templates.builders.msgs.buildFileShareMetaText(i);re.file_share_html=new Handlebars.SafeString(_e)}else if("file_comment"===i.subtype){if(s&&!s.no_display&&s.file&&i.file&&i.file.id==s.file.id)if(!k)re.is_file_convo_continuation=true;re.show_comment_quote_icon=true;if(s&&!s.no_display&&s.file&&i.file&&i.file.id==s.file.id){if((TS.boot_data.feature_file_threads&&!i.subtype||"file_share"===s.subtype)&&s.upload&&s.file.initial_comment)if(!k)re.show_comment_quote_icon=false;if("file_comment"===s.subtype)if(!k)re.show_comment_quote_icon=false}re.file=i.file;re.icon_class=TS.utility.getImageIconClass(i.file,"thumb_40");re.comment=i.comment;re.member=TS.utility.members.getEntityFromMessage(i);if(i.file&&i.file.user!=i.comment.user)re.uploader=TS.utility.members.getEntityFromFile(i.file);if(!p)re.star_components=TS.templates.builders.buildStarComponents("file_comment",i.comment,i.file)}var ce=e(i,re);re.msg_classes=ce.join(" ");v+=TS.templates.message(re);v=TS.format.replaceHighlightMarkers(v);return v}catch(e){var me="";if(i){me="msg.ts:"+i.ts;delete r.model_ob;try{r.msg=_.cloneDeep(i);r.msg.text="REDACTED";if(r.msg.attachments)r.msg.attachments="REDACTED";if(r.prev_msg)r.prev_msg=r.prev_msg.ts;if(r.msg.channel&&r.msg.channel.id)r.msg.channel=r.msg.channel.id;me+=" "+JSON.stringify(r,null,"  ")}catch(e){}}if(!e.message)e.message="";e.message+=" "+me;TS.warn("Problem in TS.templates.builders.msgs.buildHTML with args: "+JSON.stringify(e.message));if(e.stack)TS.info(e.stack);if(TS.boot_data.feature_tinyspeck)return TS.templates.message_failed({subtype:i&&i.subtype?i.subtype:"",msg_ts:i?i.ts:"",model_ob_id:a?a.id:""});return""}},getFileMetaTemplate:function e(t){if(t){if(/(snippet)/.test(t.mode))return{addedCommentedPossessive:TS.i18n.t("added and commented on {uploader_name_possessive_html} {file_pretty_name} snippet","message"),uploadedCommentedPossessive:TS.i18n.t("uploaded and commented on {uploader_name_possessive_html} {file_pretty_name} snippet","message"),addedPossessive:TS.i18n.t("added {uploader_name_possessive_html} {file_pretty_name} snippet","message"),uploadedPossessive:TS.i18n.t("uploaded {uploader_name_possessive_html} {file_pretty_name} snippet","message"),mentionedPossessive:TS.i18n.t("mentioned {uploader_name_possessive_html} {file_pretty_name} snippet","message"),sharedPossessive:TS.i18n.t("shared {uploader_name_possessive_html} {file_pretty_name} snippet","message"),addedCommented:TS.i18n.t("added and commented on this {file_pretty_name} snippet","message"),uploadedCommented:TS.i18n.t("uploaded and commented on this {file_pretty_name} snippet","message"),added:TS.i18n.t("added this {file_pretty_name} snippet","message"),uploaded:TS.i18n.t("uploaded this {file_pretty_name} snippet","message"),mentioned:TS.i18n.t("mentioned this {file_pretty_name} snippet","message"),shared:TS.i18n.t("shared this {file_pretty_name} snippet","message")};else if(/(email)/.test(t.mode))return{addedCommentedPossessive:TS.i18n.t("added and commented on {uploader_name_possessive_html} email","message"),uploadedCommentedPossessive:TS.i18n.t("uploaded and commented on {uploader_name_possessive_html} email","message"),addedPossessive:TS.i18n.t("added {uploader_name_possessive_html} email","message"),uploadedPossessive:TS.i18n.t("uploaded {uploader_name_possessive_html} email","message"),mentionedPossessive:TS.i18n.t("mentioned {uploader_name_possessive_html} email","message"),sharedPossessive:TS.i18n.t("shared {uploader_name_possessive_html} email","message"),addedCommented:TS.i18n.t("added and commented on this email","message"),uploadedCommented:TS.i18n.t("uploaded and commented on this email","message"),added:TS.i18n.t("added this email","message"),uploaded:TS.i18n.t("uploaded this email","message"),mentioned:TS.i18n.t("mentioned this email","message"),shared:TS.i18n.t("shared this email","message")};else if(/(post|space)/.test(t.mode))return{addedCommentedPossessive:TS.i18n.t("added and commented on {uploader_name_possessive_html} post","message"),uploadedCommentedPossessive:TS.i18n.t("uploaded and commented on {uploader_name_possessive_html} post","message"),addedPossessive:TS.i18n.t("added {uploader_name_possessive_html} post","message"),uploadedPossessive:TS.i18n.t("uploaded {uploader_name_possessive_html} post","message"),mentionedPossessive:TS.i18n.t("mentioned {uploader_name_possessive_html} post","message"),sharedPossessive:TS.i18n.t("shared {uploader_name_possessive_html} post","message"),addedCommented:TS.i18n.t("added and commented on this post","message"),uploadedCommented:TS.i18n.t("uploaded and commented on this post","message"),added:TS.i18n.t("added this post","message"),uploaded:TS.i18n.t("uploaded this post","message"),mentioned:TS.i18n.t("mentioned this post","message"),shared:TS.i18n.t("shared this post","message")};else if((t.thumb_360||t.thumb_360_gif)&&-1!==t.mimetype.indexOf("image/"))return{addedCommentedPossessive:TS.i18n.t("added and commented on {uploader_name_possessive_html} image","message"),uploadedCommentedPossessive:TS.i18n.t("uploaded and commented on {uploader_name_possessive_html} image","message"),addedPossessive:TS.i18n.t("added {uploader_name_possessive_html} image","message"),uploadedPossessive:TS.i18n.t("uploaded {uploader_name_possessive_html} image","message"),mentionedPossessive:TS.i18n.t("mentioned {uploader_name_possessive_html} image","message"),sharedPossessive:TS.i18n.t("shared {uploader_name_possessive_html} image","message"),addedCommented:TS.i18n.t("added and commented on this image","message"),uploadedCommented:TS.i18n.t("uploaded and commented on this image","message"),added:TS.i18n.t("added this image","message"),uploaded:TS.i18n.t("uploaded this image","message"),mentioned:TS.i18n.t("mentioned this image","message"),shared:TS.i18n.t("shared this image","message")};return{addedCommentedPossessive:TS.i18n.t("added and commented on {uploader_name_possessive_html} file","message"),uploadedCommentedPossessive:TS.i18n.t("uploaded and commented on {uploader_name_possessive_html} file","message"),addedPossessive:TS.i18n.t("added {uploader_name_possessive_html} file","message"),uploadedPossessive:TS.i18n.t("uploaded {uploader_name_possessive_html} file","message"),mentionedPossessive:TS.i18n.t("mentioned {uploader_name_possessive_html} file","message"),sharedPossessive:TS.i18n.t("shared {uploader_name_possessive_html} file","message"),addedCommented:TS.i18n.t("added and commented on this file","message"),uploadedCommented:TS.i18n.t("uploaded and commented on this file","message"),added:TS.i18n.t("added this file","message"),uploaded:TS.i18n.t("uploaded this file","message"),mentioned:TS.i18n.t("mentioned this file","message"),shared:TS.i18n.t("shared this file","message")}}return null},buildFileShareMetaText:function e(n,i){if(!n||!n.file)return"";var a=(TS.boot_data.feature_file_threads&&!n.subtype||"file_share"===n.subtype)&&n.upload;var s=n.file.user!=n.user&&!a;var o=!t(n);var l;if(s&&o)if(("file_share"===n.subtype||TS.boot_data.feature_file_threads&&!n.subtype)&&n.upload)if(n.file.initial_comment)if(r.test(n.file.mode))l=TS.templates.builders.msgs.getFileMetaTemplate(n.file).addedCommentedPossessive;else l=TS.templates.builders.msgs.getFileMetaTemplate(n.file).uploadedCommentedPossessive;else if(r.test(n.file.mode))l=TS.templates.builders.msgs.getFileMetaTemplate(n.file).addedPossessive;else return TS.templates.builders.msgs.getFileMetaTemplate(n.file).uploadedPossessive;else if("file_mention"===n.subtype)l=TS.templates.builders.msgs.getFileMetaTemplate(n.file).mentionedPossessive;else l=TS.templates.builders.msgs.getFileMetaTemplate(n.file).sharedPossessive;else if(("file_share"===n.subtype||TS.boot_data.feature_file_threads&&!n.subtype)&&n.upload)if(n.file.initial_comment)if(r.test(n.file.mode))l=TS.templates.builders.msgs.getFileMetaTemplate(n.file).addedCommented;else l=TS.templates.builders.msgs.getFileMetaTemplate(n.file).uploadedCommented;else if(r.test(n.file.mode))l=TS.templates.builders.msgs.getFileMetaTemplate(n.file).added;else l=TS.templates.builders.msgs.getFileMetaTemplate(n.file).uploaded;else if("file_mention"===n.subtype)l=TS.templates.builders.msgs.getFileMetaTemplate(n.file).mentioned;else l=TS.templates.builders.msgs.getFileMetaTemplate(n.file).shared;var u=TS.utility.members.getEntityFromFile(n.file);var d;if(i){var _=TS.members.getPrefCompliantMemberName(u);d=TS.i18n.fullPossessiveString(_)}else{var c=TS.templates.builders.makeMemberPreviewLink(u,false);var m=TS.i18n.possessive(TS.members.getPrefCompliantMemberName(u));var f="client"===TS.boot_data.app?'target="'+n.file.permalink+'" ':"";var p='<a href="'+n.file.permalink+'" '+f+'data-file-id="'+n.file.id+'">';var h=TS.i18n.t("{uploader_name}{uploader_name_affix}","message")({uploader_name:c,uploader_name_affix:m});d="</a> "+h+p}return l({uploader_name_possessive_html:d,file_pretty_name:n&&n.file&&n.file.pretty_type?n.file.pretty_type:""})}});function e(e,t){var r=["message"];if(e.subtype)if("channel_join"===e.subtype||"group_join"===e.subtype)r.push("joined","automated");else if("channel_leave"===e.subtype||"group_leave"===e.subtype)r.push("left","automated");else if("channel_topic"===e.subtype||"group_topic"===e.subtype)r.push("topic","automated");else if("channel_name"===e.subtype||"group_name"===e.subtype)r.push("rename","automated");else if("channel_purpose"===e.subtype||"group_purpose"===e.subtype)r.push("purpose","automated");else if("channel_archive"===e.subtype||"group_archive"===e.subtype)r.push("archived","automated");else if("channel_unarchive"===e.subtype||"group_unarchive"===e.subtype)r.push("unarchived","automated");else if("bot_message"===e.subtype)r.push("bot_message");else if("sh_room_shared"===e.subtype)r.push("sh_shared","automated");else if("sh_room_created"===e.subtype)r.push("sh_created","automated");else if("bot_add"===e.subtype||"bot_remove"===e.subtype||"bot_enable"===e.subtype||"bot_disable"===e.subtype)r.push("bot_change","automated");else if("reminder_add"===e.subtype||"reminder_delete"===e.subtype)r.push("reminder_change","automated");if(e.alert_type)if("shared_channel_join"===e.alert_type)r.push("highlight_yellow_bg");if(TS.boot_data.feature_fix_files)r.push("feature_fix_files");if(e.no_display)r.push("hidden");if(t.for_search_display)r.push("for_search_display");if(t.for_top_results_search_display)r.push("for_top_results_search_display");if(t.starred_items_list)r.push("for_star_display");if(t.for_mention_display)r.push("for_mention_display");if(t.for_mention_rxn_display)r.push("for_mention_rxn_display");if(t.is_ephemeral)r.push("ephemeral");if(t.unprocessed)r.push("unprocessed");if(t.show_resend_controls)r.push("resend");if(t.highlight)r.push("highlight");if(t.highlight_as_new)r.push("new");if(t.app_id)r.push("is_app");if(t.is_pinned)r.push("is_pinned");if(t.show_channel_highlight&&TS.boot_data.feature_sli_recaps_interface)r.push("show_recap");if(t.is_highlighted_unfurl&&TS.boot_data.feature_sli_recaps_interface)r.push("is_recap_unfurl");if(t.highlight_feedback_options&&TS.boot_data.feature_sli_recaps_interface)r.push("has_feedback_options");if(t.highlight_is_leaving_feedback&&TS.boot_data.feature_sli_recaps_interface)r.push("is_leaving_feedback");if(t.highlight_has_left_feedback&&TS.boot_data.feature_sli_recaps_interface)r.push("has_left_feedback");if(t.standalone)r.push("standalone");else r.push("dirty_hover_container");if(t.show_user)r.push("first");else{if(t.file)r.push("first");if(t.is_in_conversation)r.push("first")}if(t.file){r.push("file_reference");if(t.is_mention)r.push("file_mention");else r.push("file_share")}if(t.comment)if(t.is_file_convo_continuation)r.push("comment_continuation");else r.push("first");if(t.is_root_msg)r.push("selected");if(t.is_new_reply)r.push("new_reply");if(t.is_tombstone)r.push("deleted");if(TS.boot_data.feature_sli_recaps){if(t.is_recap){r.push("is_recap");if(TS.boot_data.feature_sli_recaps_interface)r.push("show_recap_highlight")}if(t.show_recap_debug)r.push("show_recap_debug")}if(t.is_broadcast)r.push("thread_broadcast");if(_.get(t.member,"is_unknown"))r.push("member_is_unknown");return r}function t(e){return e.file.name===TS.utility.welcome_post.WELCOME_POST_NAME&&"USLACKBOT"===e.user&&e.file.user===TS.model.user.id}var r=/(snippet)/})()},4796:function(e,t){var r="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};(function(){TS.registerModule("templates.helpers",{onStart:function e(){TS.templates.helpers.register()},register:function i(){Handlebars.registerHelper("debugger",function(){});Handlebars.registerHelper("i18n_ns",function(e){if(!_.isObject(this)){TS.warn('Cannot set i18n namespace "'+e+'". Chances are you’ve inadvertently changed the context in a Handlebars partial to something that’s not an object.');return}if(this._i18n_ns)if(this._i18n_ns_history)this._i18n_ns_history.push(this._i18n_ns);else this._i18n_ns_history=[this._i18n_ns];this._i18n_ns=e});Handlebars.registerHelper("_i18n_ns_end",function(){if(this._i18n_ns_history&&this._i18n_ns_history.length)this._i18n_ns=this._i18n_ns_history.pop()});Handlebars.registerHelper("i18n_img",function(e){var t=e.fn(this);var r=e&&e.hash&&e.hash.locales?e.hash.locales:null;if(r){r=r.replace(/\s/g,"");if(r.split(",").indexOf(TS.i18n.locale())>-1)t=t.replace(/(\..+$)/,"."+TS.i18n.locale()+"$1")}return t});Handlebars.registerHelper("t",function(e){var t;if("string"===typeof e){t=e;e=arguments[1]}else t=e.fn();var r;if(void 0!==e.hash.ns)r=e.hash.ns;else if(void 0!==this._i18n_ns)r=this._i18n_ns;else r=e.data.root&&e.data.root._i18n_ns?e.data.root._i18n_ns:"";var n=this;if(!_.isObject(n))n={this:n};var i={};var a;_.forOwn(e.hash,function(e,t){i[t]=n[t];n[t]=Handlebars.Utils.escapeExpression(e)});var s=t.match(/{[^\s}]+}/g);if(s&&s.length){var o=function e(t){var r=t.split(".");if(r.length>1){var i=0;var a=r.length;var s=n;for(i;i<a;i+=1){s=s[r[i]];if(void 0===s)return}return s}return n[t]};var l;var u=0;var d=s.length;for(u;u<d;u+=1){a=s[u].substr(1,s[u].length-2);if(void 0===e.hash[a]){l=o(a);if(void 0!==l){i[a]=n[a];n[a]=Handlebars.Utils.escapeExpression(l)}}}}if(e.hash.debug){TS.info("debug handlerbars t helper");TS.info(this)}t=TS.i18n.t(t,r)(n);_.forOwn(i,function(e,t){n[t]=e});return t});Handlebars.registerHelper("zdLocale",function(){return TS.i18n.zdLocale()});Handlebars.registerHelper("exampleEmail",function(e){return TS.utility.exampleEmailAddress(e)});Handlebars.registerHelper("convertTimestampToMilliseconds",function(e){return 1e3*e});Handlebars.registerHelper("i18n_number",function(e){return TS.i18n.number(e)});Handlebars.registerHelper("listify",function(e,t){if(t.hash.map)e=_.map(e,t.hash.map);var r=_.get(t.hash,"conjunction");var n=_.get(t.hash,"strong");var i=_.get(t.hash,"no_escape");var a=_.get(t.hash,"item_prefix");var s=TS.i18n.listify(e,{conj:r,strong:n,no_escape:i,item_prefix:a});return new Handlebars.SafeString(s.join(""))});Handlebars.registerHelper("ifInArray",function(e,t,r){if(t.indexOf(e)>-1)return r.fn(this);return r.inverse(this)});Handlebars.registerHelper("getDisplayNames",function(e){var t=e.map(function(e){var t=_.isString(e)?e:e.id;return TS.members.getPrefCompliantMemberNameById(t,true,false)});return t});Handlebars.registerHelper("isClient",function(e){if("client"===TS.boot_data.app)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("isChrome",function(e){if(TS.model.is_chrome_desktop||TS.model.is_chrome_mobile)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("isFF",function(e){if(TS.model.is_FF)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("isSafariDesktop",function(e){if(TS.model.is_safari_desktop)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("isWeb",function(e){if("web"===TS.boot_data.app||"space"===TS.boot_data.app||"calls"===TS.boot_data.app)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("isMac",function(e){if(TS.model.is_mac)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("isWin",function(e){if(TS.model.is_win)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("isLin",function(e){if(TS.model.is_lin)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("isOurApp",function(e){if(TS.model.is_our_app)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("needCrossWorkspaceLink",function(e,t){if(TS.model.is_our_app&&e&&e.is_cross_workspace)return t.fn(this);return t.inverse(this)});Handlebars.registerHelper("unlessOurApp",function(e){return Handlebars.helpers.isOurApp.call(this,{fn:e.inverse,inverse:e.fn,hash:e.hash})});Handlebars.registerHelper("isMacAppStorebuild",function(e){if(TSSSB.call("isAppStoreBuild")&&navigator.userAgent.match("MacAppStore"))return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("feature",function(e){var t=e.hash.flag;if(1==TS.qs_args[t]||1==TS.boot_data[t])return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("pageNeedsEnterprise",function(e){if(TS.boot_data.page_needs_enterprise)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("sharedChannelsEnabled",function(e){if(TS.permissions.members.canRequestSharedChannel())return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("canDisconnectSharedChannels",function(e){if(TS.permissions.members.canDisconnectSharedChannels())return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("isChannelRequired",function(e,t){return TS.channels.isChannelRequired(e)?t.fn(this):t.inverse(this)});Handlebars.registerHelper("canPostInModelOb",function(e,t){return TS.permissions.members.canPostInModelOb(TS.model.user,e)?t.fn(this):t.inverse(this)});Handlebars.registerHelper("experiment",function(e){var t=e.hash.name;var r=e.hash.group||"treatment";if(TS.experiment.getGroup(t)===r)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("enterprisePOEmail",function(){if(TS.boot_data.page_needs_enterprise){var e=TS.redux.enterprise.getEnterprise().primary_owner.email;return e}return""});Handlebars.registerHelper("versioned_x_icon",function(){return cdn_url+"/52b9/img/enterprise/icon_times_in_circle.svg"});Handlebars.registerHelper("comments",function(e){return new Handlebars.SafeString(TS.templates.builders.buildComments(e))});Handlebars.registerHelper("comment_standalone",TS.templates.builders.buildCommentStandalone);Handlebars.registerHelper("star",function(e,t,r){return new Handlebars.SafeString(TS.templates.builders.buildStar(e,t,r))});Handlebars.registerHelper("starWithTip",function(e,t,r){return new Handlebars.SafeString(TS.templates.builders.buildStarWithTip(e,t,r))});Handlebars.registerHelper("inlineRoomPreviewToggler",TS.templates.builders.buildInlineRoomPreviewToggler);Handlebars.registerHelper("isInlineFilePreviewExpanded",function(e){var r=e.hash.container_id;var n=e.hash.file_id;var i=360;var a=false;var s=t(n,i);if(s)a=TS.inline_imgs.shouldExpand(r,TS.model.inline_imgs[s]);else a=TS.inline_file_previews.shouldExpand(r,n);if(a)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("shouldTruncateInlineFilePreview",function(e,t){if("string"===typeof e)e=TS.files.getFileById(e);if(e&&TS.inline_file_previews.shouldTruncate(e))return t.fn(this);return t.inverse(this)});Handlebars.registerHelper("shouldNotTruncateInlineFilePreview",function(e,t){return Handlebars.helpers.shouldTruncateInlineFilePreview.call(this,e,{fn:t.inverse,inverse:t.fn,hash:t.hash})});Handlebars.registerHelper("isInlineFilePreviewTruncated",function(e,t,r){if("string"===typeof t)t=TS.files.getFileById(t);if(t&&TS.inline_file_previews.isTruncated(e,t))return r.fn(this);return r.inverse(this)});Handlebars.registerHelper("isInlineFilePreviewNotTruncated",function(e,t,r){return Handlebars.helpers.isInlineFilePreviewTruncated.call(this,e,t,{fn:r.inverse,inverse:r.fn,hash:r.hash})});Handlebars.registerHelper("formatActionLink",function(e,t,r){if(!e)return"";var n="<"+e.url+"|"+e.title+">";var i=TS.format.formatWithOptions(n,t,{no_highlights:true,no_specials:true,enable_slack_action_links:true===r});return new Handlebars.SafeString(i)});Handlebars.registerHelper("ellipsize",function(e,t){TS.info("len"+t);return TS.utility.ellipsize(e,t)});Handlebars.registerHelper("stripWhitespace",function(e){return e.replace(/\s+/g,"")});Handlebars.registerHelper("cash",function(e){var t=e.hash.all_digits||false;var r=e.hash.currency_code||"USD";var n=parseInt(e.hash.value,10);var i=TS.utility.money.formatMoney(n,r,{all_digits:t});return i});Handlebars.registerHelper("possessive",function(e){return TS.i18n.possessive(e)});Handlebars.registerHelper("fullPossessiveString",function(e){return TS.i18n.fullPossessiveString(e)});Handlebars.registerHelper("possessiveForMemberById",function(e){var t=TS.members.getMemberById(e);if(!t)return"";return Handlebars.helpers.possessiveForMember(t)});Handlebars.registerHelper("possessiveForMember",function(e){var t=TS.members.getPrefCompliantMemberName(e);return TS.i18n.possessive(t)});Handlebars.registerHelper("concatStr",function(){return Array.prototype.slice.call(arguments,0,arguments.length-1).join("")});Handlebars.registerHelper("initialsSafe",function(e){var t=TS.interop.utility.getInitials(e,{numLetters:2});return new Handlebars.SafeString(t)});Handlebars.registerHelper("json",function(e){if("object"===("undefined"===typeof e?"undefined":r(e))&&null!==e&&"json"===e.name)return JSON.stringify(this);return JSON.stringify(e)});Handlebars.registerHelper("prettyJson",function(e){if("object"===("undefined"===typeof e?"undefined":r(e))&&null!==e&&"json"===e.name)return JSON.stringify(this,null,2);return JSON.stringify(e,null,2)});Handlebars.registerHelper("currentTeamName",function(){return _.escape(_.get(TS.model.team,"name",""))});Handlebars.registerHelper("currentTeamHostSafe",function(){return new Handlebars.SafeString(window.location.hostname)});Handlebars.registerHelper("canUserCreateGroups",function(e){return TS.permissions.members.canCreateGroups()?e.fn(this):e.inverse(this)});Handlebars.registerHelper("canCreateMpims",function(e){return TS.permissions.members.canCreateMpims()?e.fn(this):e.inverse(this)});Handlebars.registerHelper("canKickFromChannels",function(e){return TS.permissions.members.canKickFromChannels()?e.fn(this):e.inverse(this)});Handlebars.registerHelper("canKickFromGroups",function(e){return TS.permissions.members.canKickFromGroups()?e.fn(this):e.inverse(this)});Handlebars.registerHelper("shouldShowMemberEmail",function(e){return e.is_self||TS.prefs.getTeamPref("display_email_addresses")});Handlebars.registerHelper("teamUsesCustomizedCustomStatusPresets",function(e){return TS.prefs.getTeamPref("uses_customized_custom_status_presets")?e.fn(this):e.inverse(this)});Handlebars.registerHelper("numberWithMax",function(e,t){if(e>=t)return t-1+"+";return e});Handlebars.registerHelper("convertFilesize",function(e){return TS.utility.convertFilesize(e)});Handlebars.registerHelper("roundToThree",function(e){return TS.utility.roundToThree(e)});Handlebars.registerHelper("toDate",function(e){return TS.interop.datetime.toDate(e)});Handlebars.registerHelper("toCalendarDate",function(e){return TS.interop.datetime.toCalendarDate(e)});Handlebars.registerHelper("toCalendarDateShort",function(e){var t={shortenMonth:true};return TS.interop.datetime.toCalendarDate(e,t)});Handlebars.registerHelper("toCalendarDateOrNamedDay",function(e){return TS.interop.datetime.toCalendarDateOrNamedDay(e)});Handlebars.registerHelper("toCalendarDateIfYesterdayOrToday",function(e){return TS.interop.datetime.toCalendarDateIfYesterdayOrToday(e)});Handlebars.registerHelper("toCalendarDateOrNamedDayShort",function(e){return TS.interop.datetime.toCalendarDateOrNamedDay(e,{shortenMonth:true})});Handlebars.registerHelper("dayDividerPretty",function(e){return TS.interop.datetime.formatDate(e,"{day_divider_pretty}")});Handlebars.registerHelper("toTime",function(e,t,r){if(!e||_.isObject(e))e=window.moment().unix();return TS.interop.datetime.toTime(e,{do24hrTime:TS.utility.date.do24hrTime(),includeMeridiem:false!==t,includeSeconds:true===r})});Handlebars.registerHelper("toTimeShort",function(e){if(TS.utility.date.do24hrTime())return TS.interop.datetime.toTime(e,{timeFormat:"HH:mm"});return TS.interop.datetime.toTime(e,{timeFormat:"h:mm"})});Handlebars.registerHelper("toTimeAgo",function(e){return TS.interop.datetime.toTimeAgo(e,{alwaysAgo:true})});Handlebars.registerHelper("toTimeAgoShort",function(e,t){t=_.isBoolean(t)?t:false;var r=TS.interop.datetime.toTimeAgo(e,{compact:t,alwaysAgo:true});var n='<span class="relative_ts" data-ts="'+_.escape(e)+'" data-really-short="'+!!t+'">'+_.escape(r)+"</span>";return new Handlebars.SafeString(n)});Handlebars.registerHelper("toTimeDuration",function(e){return TS.interop.datetime.toTimeDuration(e)});Handlebars.registerHelper("msgTsTitle",function(e,t){var r;var n;var i=TS.model.unread_view_is_showing&&_.isString(t)&&t===TS.templates.makeMsgDomIdInUnreadView(e.ts);var a=TS.model.threads_view_is_showing&&_.isString(t)&&t===TS.templates.makeMsgDomIdInThreadsView(e.ts);var s=TS.client&&TS.ui.replies.activeConvoThreadTs()===e.thread_ts&&_.isString(t)&&TS.templates.makeMsgDomIdInConversation(e.ts)===t;if(i)n=TS.i18n.t("Jump to conversation","templates_helpers")();else if(a)if(e.ts===e.thread_ts)n=TS.i18n.t("Open in channel","templates_helpers")();else n=TS.i18n.t("Open in sidebar","templates_helpers")();else if(s)if(e.ts===e.thread_ts)n=TS.i18n.t("Open in channel","templates_helpers")();var o=TS.i18n.t("{date} at {time}","templates_helpers")({date:TS.interop.datetime.toCalendarDateOrNamedDay(e.ts,{shortenMonth:true}),time:TS.interop.datetime.toTime(e.ts,{do24hrTime:TS.utility.date.do24hrTime(),includeSeconds:true})}).replace(/\s/g,"&nbsp;");if(n)r=n+'<br><span class="subtle_silver no_wrap">'+o+"</span>";else r=o;return new Handlebars.SafeString(r)});Handlebars.registerHelper("toHour",function(e){return TS.interop.datetime.toHour(e)});Handlebars.registerHelper("memberLocalTime",function(e){var t=e&&e.tz?e.tz:"America/Los_Angeles";var r=TS&&TS.boot_data&&TS.boot_data.dst_offsets&&TS.boot_data.dst_offsets[e.tz]&&TS.boot_data.dst_offsets[e.tz].tz_offset?TS.boot_data.dst_offsets[e.tz].tz_offset:-25200;var n=TS.interop.datetime.memberLocalTime(Date.now(),{timeZone:t,timeZoneOffset:r,do24hrTime:TS.utility.date.do24hrTime()});var i=TS.i18n.t('<span class="timezone_value">{local_time}</span> local time',"date_utilities")({local_time:n});return new Handlebars.SafeString(i)});Handlebars.registerHelper("memberUTCOffset",function(e){return TS.utility.date.memberUTCOffset(e)});Handlebars.registerHelper("isInDifferentTimeZone",function(e,t){if(e.tz_offset!==TS.model.user.tz_offset)return t.fn(this);return t.inverse(this)});Handlebars.registerHelper("isToday",function(e,t){if(TS.interop.datetime.isToday(TS.interop.datetime.toDateObject(e)))return t.fn(this);return t.inverse(this)});Handlebars.registerHelper("toMonthYearFormat",function(e){return TS.interop.datetime.toCalendarDate(e,{excludeDay:true})});Handlebars.registerHelper("if_equal",function(t,r){r=e(r);if(t==r.hash.compare)return r.fn(this);return r.inverse(this)});Handlebars.registerHelper("if_not_equal",function(t,r){r=e(r);if(t!=r.hash.compare)return r.fn(this);return r.inverse(this)});Handlebars.registerHelper("if_gt",function(t,r){r=e(r);if(t>r.hash.compare)return r.fn(this);return r.inverse(this)});Handlebars.registerHelper("if_lt",function(t,r){r=e(r);if(t<r.hash.compare)return r.fn(this);return r.inverse(this)});Handlebars.registerHelper("or",function(t,r,n){n=e(n);if(t||r)return n.fn(this);return n.inverse(this)});Handlebars.registerHelper("and",function(t,r,n){n=e(n);if(t&&r)return n.fn(this);return n.inverse(this)});Handlebars.registerHelper("foreach",function(e,t){if(t.inverse&&!e.length)return t.inverse(this);return e.map(function(r,n){var i={index:n,value:r,length:e.length};i.first=0===n;i.last=n===e.length-1;return t.fn(i)}).join("")});Handlebars.registerHelper("repeat",function(e,t){var r="";for(var n=0;n<e;n+=1)r+=t.fn(n);return r});Handlebars.registerHelper("makeDayDividerDomId",function(e){return TS.templates.makeDayDividerDomId(e)});Handlebars.registerHelper("formatFileTitle",function(e){if(!e||!e.title)return"";var t=e.title;t=_.unescape(t);t=_.escape(t);return new Handlebars.SafeString(TS.format.formatWithOptions(t,null,{no_specials:true}))});Handlebars.registerHelper("formatMessageByType",function(e,t,r,n,i){return new Handlebars.SafeString(TS.templates.builders.formatMessageByType(e,t,r,n,i))});Handlebars.registerHelper("formatAttachments",function(e,t,r,n){return new Handlebars.SafeString(TS.templates.builders.formatAttachments(e,t,r,n))});Handlebars.registerHelper("formatMessage",function(e,t){return new Handlebars.SafeString(TS.format.formatDefault(e,t))});Handlebars.registerHelper("formatNoHighlightsNoSpecials",function(e,t){return TS.format.formatNoHighlightsNoSpecials(e,t)});Handlebars.registerHelper("formatMessageAttachmentPartEscaped",TS.utility.attachments.formatMessageAttachmentPart);Handlebars.registerHelper("formatMessageAttachmentPart",function(e,t,r,n,i,a){return new Handlebars.SafeString(TS.utility.attachments.formatMessageAttachmentPart(e,t,r,n,i,a))});Handlebars.registerHelper("formatMessageAttachmentSlackFooter",function(e,t){var r;if(TS.boot_data.feature_grid_archive_link_fixes){if(!e.channel_name||!e.channel_id){r=TS.format.formatJustText(TS.format.cleanMsg(e.footer));return new Handlebars.SafeString(r)}r=TS.utility.attachments.getSlackMessageFooterText(e,t,true)}else r=TS.format.formatJustText(TS.format.cleanMsg(e.footer));return new Handlebars.SafeString(r)});Handlebars.registerHelper("formatTopicOrPurpose",function(e){return new Handlebars.SafeString(TS.utility.formatTopicOrPurpose(e))});Handlebars.registerHelper("unFormatMessage",function(e,t){return TS.format.unFormatMsg(e,t)});Handlebars.registerHelper("formatMessageResult",function(e){e=TS.format.formatJustText(e);e=TS.utility.msgs.handleSearchHighlights(e);return e});Handlebars.registerHelper("formatCurrentStatus",function(e,t){t=t||{};t=t.hash||t;return new Handlebars.SafeString(TS.format.formatCurrentStatus(e,void 0,t))});Handlebars.registerHelper("formatCurrentStatusWithoutAnimations",function(e,t){t=t||{};t=t.hash||t;return new Handlebars.SafeString(TS.format.formatCurrentStatus(e,void 0,_.assign({stop_animations:true},t)))});Handlebars.registerHelper("rxnPanel",function(e){var t=TS.templates.builders.rxnPanel(e);if(!t)return"";return new Handlebars.SafeString(t)});Handlebars.registerHelper("makeRefererSafeLink",function(e){if("string"!==typeof e.hash.url)return"";return new Handlebars.SafeString(TS.utility.makeRefererSafeLink(e.hash.url))});Handlebars.registerHelper("makeSafeForDomId",TS.utility.makeSafeForDomId);Handlebars.registerHelper("makeMsgAttachmentTextExpanderDomId",TS.templates.makeMsgAttachmentTextExpanderDomId);Handlebars.registerHelper("makeMsgDomId",TS.templates.makeMsgDomId);Handlebars.registerHelper("makeMsgLabelDomId",TS.templates.makeMsgLabelDomId);Handlebars.registerHelper("makeMSRDomId",TS.templates.makeMSRDomId);Handlebars.registerHelper("makeMSRDomIdWithModule",TS.templates.makeMSRDomIdWithModule);Handlebars.registerHelper("makeSHRoomClass",TS.templates.makeSHRoomClass);Handlebars.registerHelper("makeMemberColorClass",function(){return TS.templates.builders.makeMemberColorClass.apply(this,arguments)});Handlebars.registerHelper("buildMsgHTMLForSearch",function(){var e=TS.templates.builders.buildMsgHTMLForSearch.apply(this,arguments);return new Handlebars.SafeString(e)});Handlebars.registerHelper("buildMsgHTMLForSearchTopResults",function(){var e=TS.templates.builders.buildMsgHTMLForSearchTopResults.apply(this,arguments);return new Handlebars.SafeString(e)});Handlebars.registerHelper("ifExtracts",function(e,t){if(e.previous||e.previous_2||e.next||e.next_2)return t.fn(this);return t.inverse(this)});Handlebars.registerHelper("willForceExtracts",function(e,t){if(!e.previous&&!e.next||TS.search.view.resultHasExtracts(e))return t.inverse(this);var r=TS.search.query;var n=r.split(" ");var i;var a;var s=false;for(i=0;i<n.length;i+=1){a=_.trim(n[i]);if(a.length>0&&!TS.search.keyword_modifier_pair_regex.test(a)){s=true;break}}if(!s)return t.fn(this);return t.inverse(this)});Handlebars.registerHelper("formatAttachmentExtracts",function(e,t){var r=e.color||"e3e4e6";return TS.templates.search_attachment_extracts({attachment:e,message:t,bg_color:r})});Handlebars.registerHelper("getAttachmentAuthorMemberId",function(e){var t=TS.utility.attachments.getDecoratedAttachment(e);if(!t)return"";return t._slack_author_id||""});Handlebars.registerHelper("concatMsgExtracts",function(e){if(!e.extracts||0===e.extracts.length)return"";var t=TS.templates.builders.search_ellipsis;var r=e.extracts.map(function(r){if(r.text)r.text=r.text.replace(/&&gt;t;>&gt;/g,"&gt;&gt;&gt;");var n=TS.format.replaceHighlightMarkers(r.text);if(TSF.jumbomoji_rx.match(n))return TS.format.formatDefault(n,e);var i=TS.format.formatWithOptions(r.text,e,{custom_linebreak:t});i=TS.utility.msgs.handleSearchHighlights(i);return i});var n=r.join(t);if(e.extracts[0].truncated_head)n=t+n;if(e.extracts[e.extracts.length-1].truncated_tail)n+=t;return n});Handlebars.registerHelper("concatAttachmentExtracts",function(e,t){var r=[];var n=e.extracts;var i;var a=TS.templates.builders.search_ellipsis;if(!n||0===n.length)return"";["title","text"].forEach(function(e){if(n[e])n[e].forEach(function(e){var n=TS.format.formatWithOptions(e.text,t,{custom_linebreak:a});n=TS.utility.msgs.handleSearchHighlights(n);if(0===r.length&&e.truncated_head)n=a+n;i=e;r.push(n)})});var s=r.join(a);if(s&&i&&i.truncated_tail)s+=a;if(!s&&n.fields&&!n.fallback)n.fields.forEach(function(e){var t=_.escape(e.value.text);t=TS.utility.msgs.handleSearchHighlights(t);if(e.value.truncated_head)t=a+t;if(e.value.truncated_tail)t+=a;s+="<strong>"+_.escape(e.title)+"</strong> &bull; "+t+"<br>"});if(!s&&e.fallback){var o=e.fallback;if(n.fallback&&n.fallback.length>0)o=n.fallback[0].text;var l=TS.format.formatWithOptions(o,t,{custom_linebreak:a});l=TS.utility.msgs.handleSearchHighlights(l);return l}return s});Handlebars.registerHelper("newWindowName",TS.templates.builders.newWindowName);Handlebars.registerHelper("nl2br",function(e){if(!e)return e;e=_.escape(e);return e.replace(/\n/g,"<br />").replace(/&amp;#95;/g,"_")});Handlebars.registerHelper("smartnl2br",function(e){if(!e)return e;e=_.escape(e);e=e.replace(/\n\r\n\r/g,'<span class="para_break"><br /></span>');e=e.replace(/\n\r\n/g,'<span class="para_break"><br /></span>');e=e.replace(/\n\n/g,'<span class="para_break"><br /></span>');e=e.replace(/\n/g,"<br />");return new Handlebars.SafeString(e.replace(/&amp;#95;/g,"_"))});Handlebars.registerHelper("truncate",function(e,t){var r=truncate(e,t);return r.replace(/&#64;/g,"@")});Handlebars.registerHelper("truncateToNearestWordBoundary",TS.utility.truncateToNearestWordBoundary);Handlebars.registerHelper("proxyImgUrls",function(e){var t=$("<div>"+e+"</div>");TS.templates.builders.proxyImgUrlsForEmails(t);return t.html()});Handlebars.registerHelper("stripImageTags",function(e){var t=$("<div>"+e+"</div>");var r=t.find("img").remove().end().html();return new Handlebars.SafeString(r)});Handlebars.registerHelper("generalName",function(){var e=TS.channels.getGeneralChannel();return e?e.name:""});Handlebars.registerHelper("makeChannelDomId",function(e){return TS.templates.makeChannelDomId(e)});Handlebars.registerHelper("makeLinksFromModelObs",function(e){return new Handlebars.SafeString(TS.templates.builders.makeLinksFromModelObs(e,{new_lines:true,overflow_ellipsis:true}))});Handlebars.registerHelper("makeChannelDragData",function(e){return TS.templates.makeChannelDragData(e)});Handlebars.registerHelper("makeFileDragData",function(e){return TS.templates.makeFileDragData(e)});Handlebars.registerHelper("firstListedChannel",function(){var e=TS.channels.getChannelsForUser()[0];if(e)return"#"+e.name});Handlebars.registerHelper("ChannelNameMaxLength",function(){return TS.model.channel_name_max_length});Handlebars.registerHelper("ChannelPurposeMaxLength",function(){return TS.model.channel_purpose_max_length});Handlebars.registerHelper("ChannelTopicMaxLength",function(){return TS.model.channel_topic_max_length});Handlebars.registerHelper("makeUnreadMsgsDomId",function(e){return TS.templates.makeUnreadMsgsDomId(e)});Handlebars.registerHelper("getCorGNameWithPrefixById",function(e,t){var r=TS.shared.getModelObById(e);if(!r){var n="getCorGNameWithPrefixById: Could not find model ob for ID "+e;TS.warn(n);if(t)return;return e}if(r.is_group)return TS.model.group_prefix+r.name;else if(r.is_channel)return TS.templates.builders.makeChannelPrefix(r)+r.name;if(t)return;return e});Handlebars.registerHelper("makeChannelPrefix",function(e){return new Handlebars.SafeString(TS.templates.builders.makeChannelPrefix(e))});Handlebars.registerHelper("makeChannelLink",function(e,t){t=t||{};t=t.hash||t;return new Handlebars.SafeString(TS.templates.builders.makeChannelLink(e,t))});Handlebars.registerHelper("makeModelObNameForDisplay",function(e,t){t=t||{};t=t.hash||t;return new Handlebars.SafeString(TS.templates.builders.makeModelObNameForDisplay(e,t))});Handlebars.registerHelper("makeChannelPath",TS.templates.builders.makeChannelPath);Handlebars.registerHelper("makeChannelLinkEnterpriseSearchResult",function(e){return new Handlebars.SafeString(TS.templates.builders.makeChannelLinkEnterpriseSearchResult(e))});Handlebars.registerHelper("makeChannelLinkById",function(e){var t=TS.channels.getChannelById(e);if(t)return TS.templates.builders.makeChannelLink(t)});Handlebars.registerHelper("makeChannelLinkAriaLabelSafe",TS.templates.builders.makeChannelLinkAriaLabelSafe);Handlebars.registerHelper("makeUnreadHighlightDomId",function(e){return TS.templates.makeUnreadHighlightDomId(e)});Handlebars.registerHelper("makeChannelDomClass",function(e){var t="";if(TS.model.active_channel_id==e.id&&!TS.client.activeChannelIsHidden())t+="active ";if(e.unread_cnt>0)t+="unread ";if(e.unread_highlight_cnt>0)t+="mention ";if(e.is_starred)t+="is_starred ";if(TS.notifs.isCorGMuted(e.id))t+="muted_channel ";if(e._show_in_list_even_though_no_unreads||_.trim(e.last_msg_input))t+="show_in_list_even_though_no_unreads ";return t});Handlebars.registerHelper("makeChannelOrGroupLinkById",function(e,t){var r=TS.shared.getModelObById(e);var n="";if(r.is_mpim)n=TS.templates.builders.makeMpimLink(r,false);else if(r.is_group)n=TS.templates.builders.makeGroupLink(r,{omit_prefix:t});else if(r.is_channel)n=TS.templates.builders.makeChannelLink(r,{omit_prefix:t});return new Handlebars.SafeString(n)});Handlebars.registerHelper("makeChannelOrGroupSSBLinkById",function(e){var t=TS.shared.getModelObById(e);if(!t)return;var r;var n="slack://channel?team="+TS.model.team.id+"&id="+e;if(t.is_group||t.is_private){r=TS.model.group_prefix+t.name;return"<a href="+n+">"+r+"</a>"}else if(t.is_channel){var i=TS.channels.getChannelById(e);r="#"+i.name;return"<a href="+n+">"+r+"</a>"}});Handlebars.registerHelper("isEnterpriseTeam",function(e){return TS.boot_data.page_needs_enterprise?e.fn(this):e.inverse(this)});Handlebars.registerHelper("isLocalTeam",function(t,r){r=e(r);if(!TS.boot_data.page_needs_enterprise)return r.inverse(this);if(t==TS.model.team.id)return r.fn(this);return r.inverse(this)});Handlebars.registerHelper("currentEnterpriseName",function(){if(!TS.boot_data.page_needs_enterprise)return"";var e=TS.redux.enterprise.getEnterpriseOrgName();return e||""});Handlebars.registerHelper("isOnEnterpriseTeam",function(e){if(!TS.boot_data.page_needs_enterprise)return e.inverse(this);return TS.model.user.enterprise_user.teams.indexOf(e.hash.team_id)>-1?e.fn(this):e.inverse(this)});Handlebars.registerHelper("isModelObPendingExtShared",function(e,t){if(TS.shared.isModelObPendingShared(e))return t.fn(this);return t.inverse(this)});Handlebars.registerHelper("isModelObExtShared",function(e,t){if(TS.shared.isModelObShared(e))return t.fn(this);return t.inverse(this)});Handlebars.registerHelper("makeTeamlabel",function(e,t){var r=TS.templates.builders.makeTeamlabel(e,t);return new Handlebars.SafeString(r)});Handlebars.registerHelper("makeTeamNameList",function(e,t){t=t||{};t=t.hash||t;if(!e)return"";var r=TS.i18n.listify(_.map(e,TS.teams.getTeamNameById),t).join("");if(r)return new Handlebars.SafeString(r)});Handlebars.registerHelper("makeGroupDomId",function(e){return TS.templates.makeGroupDomId(e)});Handlebars.registerHelper("groupPrefix",function(){return new Handlebars.SafeString(TS.model.group_prefix)});Handlebars.registerHelper("makeGroupLink",function(e,t){t=t||{};t=t.hash||t;var r=TS.templates.builders.makeGroupLink(e,t);return new Handlebars.SafeString(r)});Handlebars.registerHelper("makeGroupLinkById",function(e){var t=TS.groups.getGroupById(e);if(t)return TS.templates.builders.makeGroupLink(t)});Handlebars.registerHelper("makeGroupLinkAriaLabelSafe",TS.templates.builders.makeGroupLinkAriaLabelSafe);Handlebars.registerHelper("makeGroupDomClass",function(e){var t="";if(TS.model.active_group_id==e.id&&!TS.client.activeChannelIsHidden())t+="active ";if(e.unread_cnt>0)t+="unread ";if(e.unread_highlight_cnt>0)t+="mention ";if(e.is_starred)t+="is_starred ";if(TS.notifs.isCorGMuted(e.id))t+="muted_channel ";if(e._show_in_list_even_though_no_unreads||_.trim(e.last_msg_input))t+="show_in_list_even_though_no_unreads ";return t});Handlebars.registerHelper("mpimMemberCount",function(e){return TS.mpims.getMemberCount(e)});Handlebars.registerHelper("mpimDisplayName",function(e,t,r,n,i){t=true===t;i=true===i;var a=TS.mpims.getDisplayName(e,t,true===r,n,i);if(t||i)return new Handlebars.SafeString(a);return a});Handlebars.registerHelper("makeMpimDomClass",function(e){var t="";if(!e)return t;if(e.id===TS.model.active_mpim_id&&!TS.client.activeChannelIsHidden())t+="active ";if(e.unread_cnt>0||e.unread_highlight_cnt>0)t+="unread mention ";if(TS.notifs.isCorGMuted(e.id))t+="muted_channel ";if(e.is_starred)t+="is_starred ";if(_.trim(e.last_msg_input))t+="show_in_list_even_though_no_unreads ";return t});Handlebars.registerHelper("makeMpimDomId",function(e){return TS.templates.makeMpimDomId(e)});Handlebars.registerHelper("makeMpimLink",function(e,t){var r=TS.templates.builders.makeMpimLink(e,t);return new Handlebars.SafeString(r)});Handlebars.registerHelper("mpimArchivesPath",function(e){return TS.mpims.getMpimArchivesPath(e)});Handlebars.registerHelper("isCorGMuted",function(e,t){if(TS.notifs.isCorGMuted(e))return t.fn(this);return t.inverse(this)});Handlebars.registerHelper("currentUserId",function(){return TS.model.user.id});Handlebars.registerHelper("makeMemberDomId",function(e){return TS.templates.makeMemberDomId(e)});Handlebars.registerHelper("makeChannelListDomId",function(e){return TS.templates.makeChannelListDomId(e)});Handlebars.registerHelper("makeMemberPresenceDomClass",function(e){return TS.templates.makeMemberPresenceDomClass(e.id)});Handlebars.registerHelper("makeMemberPresenceIcon",function(e){if(!TS.client)TS.warn("Presence icons should not be used outside of the client application, because they rely on a WS connection to keep presence up to date. Rendering anyway, but be careful out there!");return new Handlebars.SafeString(TS.templates.makeMemberPresenceIcon(e))});Handlebars.registerHelper("makeMemberTypeBadge",function(){var e=TS.templates.builders.makeMemberTypeBadge.apply(this,arguments);return new Handlebars.SafeString(e)});Handlebars.registerHelper("makeMemberTypeBadgeCompact",function(){var e=TS.templates.builders.makeMemberTypeBadgeCompact.apply(this,arguments);return new Handlebars.SafeString(e)});Handlebars.registerHelper("makeMemberStatusDomClass",function(e){return TS.templates.makeMemberStatusDomClass(e.id)});Handlebars.registerHelper("makeMemberDomClass",function(e){var t="";if(!e)return t;if(!e.is_self&&"away"===e.presence)t+="away ";if(TS.model.active_im_id){var r=TS.ims.getImById(TS.model.active_im_id);if(r.user==e.id&&!TS.client.activeChannelIsHidden())t+="active "}var n=TS.ims.getImByMemberId(e.id);if(n){if(n.unread_cnt>0||n.unread_highlight_cnt>0)t+="unread mention ";if(n.is_starred)t+="is_starred ";if(_.trim(n.last_msg_input))t+="show_in_list_even_though_no_unreads "}return t});Handlebars.registerHelper("showDraftIcon",function(e,t){if(TS.templates.builders.showDraftIcon(e))return t.fn(this);return t.inverse(this)});Handlebars.registerHelper("makeMemberListDomClass",function(e){var t="member ";if("away"===e.presence)t+="away ";return t});Handlebars.registerHelper("makeMemberPreviewLink",function(){var e=TS.templates.builders.makeMemberPreviewLink.apply(this,arguments);return new Handlebars.SafeString(e)});Handlebars.registerHelper("makeMemberPreviewLinkById",function(e,t){if(true!==t)t=false;var r=TS.members.getPotentiallyUnknownMemberById(e);if(!r||r.is_non_existent)r=TS.bots.getBotById(e);if(!r)return new Handlebars.SafeString(_.escape(e));return new Handlebars.SafeString(TS.templates.builders.makeMemberPreviewLink(r,t))});Handlebars.registerHelper("makeMemberPreviewLinkImage",function(){return new Handlebars.SafeString(TS.templates.builders.makeMemberPreviewLinkImage.apply(this,arguments))});Handlebars.registerHelper("makeMemberPreviewCardLinkImage",function(){return new Handlebars.SafeString(TS.templates.builders.makeMemberPreviewCardLinkImage.apply(this,arguments))});Handlebars.registerHelper("makeProfileImage",TS.templates.builders.makeProfileImage);Handlebars.registerHelper("makePendingUserImage",function(){return new Handlebars.SafeString(TS.templates.builders.makePendingUserImage.apply(this,arguments))});Handlebars.registerHelper("emojiGraphicReplace",function(e,t){var r={};if(t&&"string"===typeof t)r.force_style=t;else r.obey_emoji_mode_pref=true;return new Handlebars.SafeString(TS.emoji.graphicReplace(e,r))});Handlebars.registerHelper("emojiGraphicReplaceByName",function(e){return TS.emoji.graphicReplace(":"+e+":")});Handlebars.registerHelper("emojiModePref",function(){return TS.prefs.getPref("emoji_mode")});Handlebars.registerHelper("makeUsernameImage",function(e,t){var r;var i;var a;var s;var o;var l=TS.bots.getBotByMsg(e);if(e.icons)o=e.icons;else if(l&&l.icons)o=l.icons;else if(e.bot_profile&&e.bot_profile.icons)o=e.bot_profile.icons;if(o)if(o.image_36&&!TS.environment.is_retina)r=o.image_36;else if(o.image_72&&TS.environment.is_retina)r=o.image_72;else if(o.image_48)r=o.image_48;else if(o.emoji&&":"===o.emoji.substr(0,1)&&":"===o.emoji.substr(o.emoji.length-1,1))a=o.emoji;var u={};var d=TS.templates.builders.makeBotLink(l,u);var c=e&&e.is_ephemeral&&"slackbot"===e.username?TS.members.getMemberById("USLACKBOT"):null;switch(t){case 24:i="thumb_24";s=cdn_url+"/66f9/img/avatars/ava_0002-24.png";if(c)s=c.profile.image_24;break;case 32:i="thumb_32";s=cdn_url+"/0180/img/avatars/ava_0002-32.png";if(c)s=c.profile.image_32;break;case 36:i="thumb_36";s=cdn_url+"/66f9/img/avatars/ava_0002-48.png";if(c)s=c.profile.image_48;break;case 72:i="thumb_72";s=cdn_url+"/66f9/img/avatars/ava_0002-72.png";if(c)s=c.profile.image_72;break;case 192:i="thumb_192";s=cdn_url+"/7fa9/img/avatars/ava_0002-192.png";if(c)s=c.profile.image_192;break;default:i="thumb_48";s=cdn_url+"/7fa9/img/avatars/ava_0002-192.png";if(c)s=c.profile.image_48}var m;if(r)if(e.bot_profile&&TS.bots.isBotExternal(e.bot_profile)){u.classes="member_image "+i;u.style="background-image:url('"+r+"')";u.external_badge=TS.templates.member_type_external_badge({team:TS.teams.getTeamById(e.bot_profile.team_id),size:t,badge_size:n(16),with_tooltip:true});d=TS.templates.builders.makeBotLink(l,u);m=""+d.start_a+d.end_a}else m=d.start_a+'<img style="border: 0" src="'+r+'" class="member_image '+i+'" />'+d.end_a;else if(a)m=d.start_a+'<div style="border: 0" class="member_image '+i+'">'+TS.emoji.graphicReplace(_.escape(a))+"</div>"+d.end_a;else if(c)m=d.start_a+'<img src="'+s+'" class="member_image '+i+'" />'+d.end_a;else m=d.start_a+'<img src="'+s+'" class="member_image bot_icon_default '+i+'" />'+d.end_a;return new Handlebars.SafeString(m)});Handlebars.registerHelper("getMemberPreviewLinkImageArgs",function(e,t,n,i,a,s,o){var l;if("object"===("undefined"===typeof e?"undefined":r(e)))l=e;else l=TS.members.getMemberById(e);if(!l||!l.profile)return"";n=true===n;i=true===i;a=true===a;s=true===s;o="string"===typeof o?o:false;if("USLACKBOT"===e&&o)l=TS.utility.slackbot.getWithFeels(o);var u;var d;var _;d="background-image: ";_=[];switch(t){case 20:case 24:if(TS.environment.is_retina)u=l.profile.image_48;else u=l.profile.image_24;break;case 32:if(TS.environment.is_retina)u=l.profile.image_72;else u=l.profile.image_32;break;case 36:case 48:if(TS.environment.is_retina)u=l.profile.image_72;else u=l.profile.image_48;break;case 56:case 72:if(TS.environment.is_retina)u=l.profile.image_192;else u=l.profile.image_72;break;case 192:if(TS.environment.is_retina)u=l.profile.image_512||l.profile.image_192;else u=l.profile.image_192;break;case 512:if(TS.environment.is_retina)u=l.profile.image_1024||l.profile.image_512||l.profile.image_192;else u=l.profile.image_512||l.profile.image_192;break;default:if(TS.environment.is_retina)u=l.profile.image_72;else u=l.profile.image_48}_.push("url('"+u+"')");if(512===t){var c=TS.environment.is_retina?l.profile.image_72:l.profile.image_48;_.push("url('"+c+"')")}if(n)d=_.length?_.join(", "):"";else d=_.length?d+_.join(", "):"";var m={omit_link:i,omit_badge:a,lazy:n,member:l,size:t,include_restricted_overlay:!s||true,bg_img_style:d};return m});Handlebars.registerHelper("getGuestBadgeSize",function(e){var t;switch(e){case 24:t=10;break;case 32:case 36:case 48:t=16;break;case 72:t=24;break;case 192:t=48;break;case 512:t=96;break;default:t=16}return t});Handlebars.registerHelper("getTeamBadgeSize",n);Handlebars.registerHelper("getMemberNameById",function(e){var t=TS.members.getMemberById(e);return t?t.name:e});Handlebars.registerHelper("getPrefCompliantMemberNameById",function(e){return TS.members.getPrefCompliantMemberNameById(e)});Handlebars.registerHelper("getMemberNameNoModel",function(e,t){if(TS.boot_data.name_tagging_client)return e.display_name||e.real_name||t;return e.real_name||t});Handlebars.registerHelper("getMemberComponentPrimaryName",function(e,t){if(t){if("real_name"===t)return TS.members.getMemberRealName(e);return TS.members.getMemberMentionName(e)}return TS.members.getPrefCompliantMemberName(e,false,false)});Handlebars.registerHelper("memberComponentHasSecondaryName",function(e,t,r){var n=false;if(e)if(t)if("real_name"===t)n=!!TS.members.getMemberProfileFieldDisplayName(e);else n=!!TS.members.getMemberRealName(e);else n=!!TS.members.getMemberSecondaryName(e);if(n)return r.fn(this);return r.inverse(this)});Handlebars.registerHelper("getMemberComponentSecondaryName",function(e,t){if(t)if("real_name"===t)return TS.members.getMemberProfileFieldDisplayName(e);else if("display_name"===t){if(TS.members.getMemberProfileFieldDisplayName(e))return TS.members.getMemberRealName(e);return""}return TS.members.getMemberSecondaryName(e)});Handlebars.registerHelper("getPrefCompliantMemberName",function(e,t,r){return TS.members.getPrefCompliantMemberName(e,true===t,true===r)});Handlebars.registerHelper("getMemberAsContentsString",function(e){return TS.format.texty.getMemberAsContentsString(e)});Handlebars.registerHelper("shouldShowMemberRestrictionBanner",function(t,r){r=e(r);if(_.isString(t))t=TS.members.getMemberById(t);if(!t)return r.inverse(this);var n=t.is_restricted||t.is_external;if(n)return r.fn(this);return r.inverse(this)});Handlebars.registerHelper("shouldShowMemberActionBar",function(t,r){r=e(r);if(_.isString(t))t=TS.members.getMemberById(t);var n=t&&(!t.is_stranger||TS.ims.getImByMemberId(t.id));if(n)return r.fn(this);return r.inverse(this)});Handlebars.registerHelper("getTeamNameByMember",function(e){return TS.teams.getTeamNameByMember(e)});Handlebars.registerHelper("getTeamById",function(e){return TS.teams.getTeamById(e)});Handlebars.registerHelper("getTeamNameById",function(e){return TS.teams.getTeamNameById(e)});Handlebars.registerHelper("getMemberPreviewLinkTarget",function(e){if(TS.utility.shouldLinksHaveTargets())return new Handlebars.SafeString('target="/team/'+e.id+'"');return""});Handlebars.registerHelper("getMemberProfileFieldDisplayName",function(e){return TS.members.getMemberProfileFieldDisplayName(e)});Handlebars.registerHelper("getMemberSecondaryName",function(e){return TS.members.getMemberSecondaryName(e)});Handlebars.registerHelper("memberHasSecondaryName",function(e,t){var r=false;if(e)r=!!TS.members.getMemberSecondaryName(e);if(r)return t.fn(this);return t.inverse(this)});Handlebars.registerHelper("unlessMemberHasSecondaryName",function(e,t){return Handlebars.helpers.memberHasSecondaryName.call(this,e,{fn:t.inverse,inverse:t.fn,hash:t.hash})});Handlebars.registerHelper("getMemberProfileFieldDisplayName",function(e){return TS.members.getMemberProfileFieldDisplayName(e)});Handlebars.registerHelper("memberHasProfileFieldDisplayName",function(e,t){var r=false;if(e)r=!!TS.members.getMemberProfileFieldDisplayName(e);if(r)return t.fn(this);return t.inverse(this)});Handlebars.registerHelper("unlessMemberHasProfileFieldDisplayName",function(e,t){return Handlebars.helpers.memberHasProfileFieldDisplayName.call(this,e,{fn:t.inverse,inverse:t.fn,hash:t.hash})});Handlebars.registerHelper("memberHasDifferentDisplayAndFullName",function(e,t){var r=false;if(e)r=!!TS.members.getMemberProfileFieldDisplayName(e)&&TS.members.getMemberProfileFieldDisplayName(e)!==TS.members.getMemberRealName(e);if(r)return t.fn(this);return t.inverse(this)});Handlebars.registerHelper("getMemberRealName",function(e){return TS.members.getMemberRealName(e)});Handlebars.registerHelper("getMemberProfileFieldDisplayNameandRealNameInCorrectOrder",function(e){var t=_.escape(TS.members.getPrefCompliantMemberName(e));var r;if(e.is_self)r=TS.i18n.t("(you)","templates_helpers")();else r=_.escape(TS.members.getMemberSecondaryName(e));var n='<span class="member_real_name">'+t+"</span>";var i='<span class="member_preferred_name">'+r+"</span>";return new Handlebars.SafeString(n+i)});Handlebars.registerHelper("getMemberCurrentStatusEmoji",function(e,t){t=t||{};t=t.hash||t;return Handlebars.helpers.formatCurrentStatusWithoutAnimations(TS.members.getMemberCurrentStatus(e).emoji,_.assign({transform_missing_emoji:true,show_icon_for_emoji_in_as_text_mode:true},t))});Handlebars.registerHelper("getMemberCurrentStatusText",function(e){return Handlebars.helpers.formatCurrentStatusWithoutAnimations(TS.members.getMemberCurrentStatus(e).text,{prevent_copy_paste:false})});Handlebars.registerHelper("getMemberCurrentStatusForDisplay",function(e){return new Handlebars.SafeString(TS.members.getMemberCurrentStatusForDisplay(e))});Handlebars.registerHelper("getMemberCurrentStatusForDisplayWithoutAnimations",function(e,t){t=t||{};t=t.hash||t;return new Handlebars.SafeString(TS.members.getMemberCurrentStatusForDisplay(e,_.assign({stop_animations:true},t)))});Handlebars.registerHelper("seesCurrentStatusInProfileView",function(t,r){r=e(r);if(t.profile.status_text||t.profile.status_emoji||"client"===TS.boot_data.app&&t.is_self)return r.fn(this);return r.inverse(this)});Handlebars.registerHelper("getTeamCustomStatusPresets",function(){return TS.team.getTeamCustomStatusPresets()});Handlebars.registerHelper("getDisplayNameOfUserForIm",function(e){if(!e)return"MISSING_IM";return TS.ims.getDisplayNameOfUserForIm(e)});Handlebars.registerHelper("getIMIdByMemberId",function(e){var t=TS.ims.getImByMemberId(e);return t?t.id:""});Handlebars.registerHelper("memberHasIm",function(e){var t=e.hash.member;var r=false;if(t)if(TS.ims.getImByMemberId(t.id))r=true;if(r)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("memberHasImUnreadCount",function(e){var t=e.hash.member;var r=false;if(t){var n=TS.ims.getImByMemberId(t.id);if(n&&n.unread_cnt)r=true}if(r)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("getUnreadCountForIMByMemberId",function(e){var t=TS.ims.getImByMemberId(e);if(t)return t.unread_cnt;return""});Handlebars.registerHelper("makeMemberLinksWithDisplayNames",function(e){if(!e)return"";return e.split(/\s*,\s*/).map(function(e){return TS.templates.builders.makeMemberPreviewLink(TS.members.getMemberById(e))}).join(", ")});function a(e){var t=TS.members.getMemberById(e.user);if(!t){TS.warn("Missing member in makeIMLink: "+e.user);return TS.templates.search_im_link({im_exists:false,im_member_id:e.user,im_name:e.user,im_id:e.id,member_color:"unknown"})}var r={im_exists:!TS.ims.isImWithDeletedMember(e),im_member_id:t.id,im_name:TS.ims.getDisplayNameOfUserForIm(e),im_id:e.id,member_color:"color_"+(t?t.id+" color_"+t.color:"unknown")};if(TS.utility.shouldLinksHaveTargets()){var n="/messages/"+e.id;if(TS.ims.isImWithDeletedMember(e))n=TS.templates.builders.newWindowName();r.target=n}return TS.templates.search_im_link(r)}Handlebars.registerHelper("makeIMLink",function(e){return new Handlebars.SafeString(a(e))});Handlebars.registerHelper("makeIMLinkById",function(e){var t=TS.ims.getImById(e);if(t)return new Handlebars.SafeString(a(t))});function s(e){var t=_.escape(e.username);var r;var n=TS.bots.getBotByMsg(e);if(e.icons)r=e.icons;else if(n&&n.icons)r=n.icons;if(!t&&n&&n.name)t=_.escape(n.name);var i=TS.templates.builders.makeBotLink(n);if(!r)return i.start_a+t+i.end_a;var a;if(r.emoji&&":"===r.emoji.substr(0,1)&&":"===r.emoji.substr(r.emoji.length-1,1))a=i.start_a+TS.emoji.graphicReplace(_.escape(r.emoji))+i.end_a+" "+i.start_a+t+i.end_a;else if(r.image_36&&!TS.environment.is_retina)a=i.start_a+'<img src="'+r.image_36+'" class="inline_bot_icon">'+i.end_a+" "+i.start_a+t+i.end_a;else if(r.image_72&&TS.environment.is_retina)a=i.start_a+'<img src="'+r.image_72+'" class="inline_bot_icon">'+i.end_a+" "+i.start_a+t+i.end_a;else if(r.image_48)a=i.start_a+'<img src="'+r.image_48+'" class="inline_bot_icon">'+i.end_a+" "+i.start_a+t+i.end_a;else a=i.start_a+t+i.end_a;return a}Handlebars.registerHelper("getBotNameAndIcon",s);Handlebars.registerHelper("getBotName",TS.templates.builders.getBotName);Handlebars.registerHelper("getBotNameWithLink",TS.templates.builders.getBotNameWithLink);function o(e){if(!e)return"color_unknown";return"color_bot_"+TS.utility.makeSafeForDomClass(e)}Handlebars.registerHelper("getBotColorClassByUserName",o);function l(e){var t=TS.members.getMemberById(e);if(!t)return"color_unknown";return"color_"+t.id+" color_"+t.color}Handlebars.registerHelper("getMemberColorClassById",l);Handlebars.registerHelper("getMemberColorClassByImId",function(e){var t=TS.ims.getImById(e);if(!t)return"color_unknown";return l(t.user)});Handlebars.registerHelper("makeMemberLinkAriaLabelSafe",TS.templates.builders.makeMemberLinkAriaLabelSafe);Handlebars.registerHelper("msgIsFromSelf",function(e){var t=e.hash.msg;var r=t.user;if(!r&&"file_comment"===t.subtype&&t.comment)r=t.comment.user;var n=TS.members.getMemberById(r);if(!n)return e.inverse(this);if(n.is_self)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("memberIsSelf",function(e){var t=TS.members.getMemberById(e.hash.id);if(!t)return e.inverse(this);if(t.is_self)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("memberIsAdmin",function(e){var t=TS.members.getMemberById(e.hash.id);if(!t)return e.inverse(this);if(t.is_admin)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("currentUserIsAdmin",function(e){if(TS.model.user.is_admin)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("currentUserIsOwner",function(e){if(TS.model.user.is_owner)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("currentUserIsRA",function(e){if(TS.model.user.is_restricted)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("currentUserIsURA",function(e){if(TS.model.user.is_ultra_restricted)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("tinyspeck",function(e){if(TS.boot_data.feature_tinyspeck)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("makeUnshareLinkById",function(e){var t=TS.files.getFileById(TS.web.file.file_id);var r=TS.shared.getModelObById(e);if(r)return TS.templates.builders.makeUnshareLink(r,t)});Handlebars.registerHelper("makeUnshareLink",function(e){var t=TS.files.getFileById(TS.web.file.file_id);return TS.templates.builders.makeUnshareLink(e,t)});Handlebars.registerHelper("makeFileDomId",function(e){return TS.templates.makeFileDomId(e)});Handlebars.registerHelper("makeFileCommentsDomId",function(e){return TS.templates.makeFileCommentsDomId(e)});Handlebars.registerHelper("makeFileContentsDomId",function(e){return TS.templates.makeFileContentsDomId(e)});Handlebars.registerHelper("makeFileCommentHelpHTML",function(e){return new Handlebars.SafeString(TS.templates.builders.makeFileCommentHelpHTML(e))});Handlebars.registerHelper("makeFileHeader",function(e,t){var r=TS.files.getFileActions(e);r.file=e;r.is_post="space"===e.mode||"post"===e.mode;r.download="hosted"===e.mode;r.member=t;return TS.templates.file_header(r)});Handlebars.registerHelper("makeFilePreviewHeader",function(e,t){var r=TS.files.getFileActions(e);r.file=e;r.member=t;r.download="hosted"===e.mode;r.edit_link="post"===e.mode?e.edit_link:e.permalink;r.is_post="space"===e.mode||"post"===e.mode;r.is_snippet="snippet"===e.mode;r.preview=true;return new Handlebars.SafeString(TS.templates.file_header(r))});Handlebars.registerHelper("makeFileSize",function(e){return TS.utility.convertFilesize(e.size)+" "+e.pretty_type});Handlebars.registerHelper("formatSpaceHtml",function(e){var t=$("<div>").html(e);TS.templates.builders.replaceEmojiForPosts(t[0]);if(TS.utility&&TS.utility.attachments)TS.utility.attachments.unfurlPlaceholders(t);return new Handlebars.SafeString(t.html())});Handlebars.registerHelper("fileIsImage",function(e){var t=TS.files.getFileById(e.hash.id);if(!t)return e.inverse(this);if(t.mimetype&&0===t.mimetype.indexOf("image/"))return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("mimeTypeIsImage",function(e){if(e.hash.type&&0===e.hash.type.indexOf("image/"))return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("fileDefaultIsNewWindow",function(t){t=e(t);var r=TS.files.getFileById(t.hash.id);if(!r)return t.inverse(this);var n=r.mimetype&&0===r.mimetype.indexOf("image/")&&-1===r.mimetype.indexOf("svg");var i="pdf"===r.filetype;if(n||i)return t.fn(this);return t.inverse(this)});Handlebars.registerHelper("fileIconTypeDownload",function(){var t=Array.prototype.slice.call(arguments);var r=e(t.pop());var n=t[0];if("string"===typeof n)n=TS.files.getFileById(n);if(!n)return r.inverse(this);var i="external"===n.mode;var a=n.mimetype&&0===n.mimetype.indexOf("image/")&&-1===n.mimetype.indexOf("svg");var s="pdf"===n.filetype;if(i||a||s)return r.inverse(this);return r.fn(this)});Handlebars.registerHelper("nonImageCanUseFSFV",function(e,t){if(TS.files.nonImageCanUseFSFV(e))return t.fn(this);return t.inverse(this)});Handlebars.registerHelper("makeFilePrivacyLabel",function(e){var t="";if(e.is_public)t=TS.i18n.t("Shared","templates_helpers")();else if(e.groups.length>0||e.ims.length>0)t=TS.i18n.t("Private","templates_helpers")();else t=TS.i18n.t("Draft","templates_helpers")();return t});Handlebars.registerHelper("makeExternalFiletypeHTML",function(e){return new Handlebars.SafeString(TS.templates.builders.makeExternalFiletypeHTML(e))});Handlebars.registerHelper("makeFileShareLabel",function(e){return new Handlebars.SafeString(TS.templates.builders.makeFileShareLabel(e))});Handlebars.registerHelper("isFileAuthorExternal",function(e){return TS.files.isFileAuthorExternal(e)});Handlebars.registerHelper("nl2brAndHighlightSearchMatches",function(e){if(!e)return;e=_.escape(e);e=e.replace(/\n/g,"<br />");return new Handlebars.SafeString(TS.utility.msgs.handleSearchHighlights(e))});Handlebars.registerHelper("maybeGetIconForTeamProfileField",function(e){var t=["slack","apple","android","twitter","github","google","windows","youtube","skype","facebook","asana","linkedin","tumblr","instagram","soundcloud","flickr","pinterest","tripit","hangouts","viber","line"];e=e.toLowerCase();if(t.indexOf(e)>-1)return'<i class="ts_icon ts_icon_'+e+'"></i>'});Handlebars.registerHelper("getVisibleTeamProfileFieldsForMember",function(e,t){var r=TS.team.getVisibleTeamProfileFieldsForMember(e);return new Handlebars.SafeString(TS.templates.team_profile_fields({fields:r,lazy_load_profile_fields:t&&t.hash.lazy_load_profile_fields}))});Handlebars.registerHelper("isSkypeTeamProfileField",function(e,t){if("text"===e.type&&"skype"===e.label.toLocaleLowerCase())return t.fn(this);return t.inverse(this)});Handlebars.registerHelper("getSafeSkypeURLComponent",function(e){var t=e.match(/^[a-zA-Z][a-zA-Z0-9.,\-_@]{5,31}/);return t?t[0]:""});Handlebars.registerHelper("highlightSearchMatches",function(e){if(!e)return;e=_.escape(e);return TS.utility.msgs.handleSearchHighlights(e)});Handlebars.registerHelper("highlightSearchMatchesInSpacesHtml",function(e){if(!e)return;var t=Handlebars.helpers.formatSpaceHtml(e);return new Handlebars.SafeString(TS.utility.msgs.handleSearchHighlights(t))});Handlebars.registerHelper("highlightSearchMatchesInFileTitle",function(e){if(!e)return;e=_.unescape(e);e=_.escape(e);e=TS.emoji.graphicReplace(e);return new Handlebars.SafeString(TS.utility.msgs.handleSearchHighlights(e))});Handlebars.registerHelper("searchFilter",function(){if(!TS.search.filter)return;return TS.search.filter});Handlebars.registerHelper("searchSort",function(){if(!TS.search.sort)return;return TS.search.sort});Handlebars.registerHelper("makeUnreadMessagesDomId",function(e){return TS.templates.makeUnreadMessagesDomId(e)});Handlebars.registerHelper("makeUnreadGroupMessagesDomId",function(e){return TS.templates.makeUnreadGroupMessagesDomId(e)});Handlebars.registerHelper("makeUnreadDmsDomId",function(e){return TS.templates.makeUnreadDmsDomId(e)});Handlebars.registerHelper("makeSentMessagesDomId",function(e){return TS.templates.makeSentMessagesDomId(e)});Handlebars.registerHelper("makeSentGroupMessagesDomId",function(e){return TS.templates.makeSentGroupMessagesDomId(e)});Handlebars.registerHelper("makeSentDmsDomId",function(e){return TS.templates.makeSentDmsDomId(e)});Handlebars.registerHelper("makeIssueListDomId",function(e){return TS.templates.makeIssueListDomId(e)});Handlebars.registerHelper("math",function(e,t,r){if(arguments.length<4){r=t;t="+"}e=parseFloat(e);r=parseFloat(r);return{"+":e+r,"-":e-r,"*":e*r,"/":e/r,"%":e%r}[t]});Handlebars.registerHelper("loadingHTML",function(){return new Handlebars.SafeString(TS.templates.builders.loadingHTML())});Handlebars.registerHelper("versioned_loading_animation",function(){return cdn_url+"/9c217/img/loading.gif"});Handlebars.registerHelper("versioned_loading_hash_animation",function(){return cdn_url+"/9c217/img/loading_hash_animation_@2x.gif"});Handlebars.registerHelper("versioned_mac_dock_badge",function(){return cdn_url+"/9135/img/prefs_mac_dock_badge@2x.png"});Handlebars.registerHelper("versioned_prefs_messages_clean",function(){return cdn_url+"/e5d8/img/prefs_messages_clean@2x.png"});Handlebars.registerHelper("versioned_prefs_messages_compact",function(){return cdn_url+"/e5d8/img/prefs_messages_compact@2x.png"});Handlebars.registerHelper("versioned_services_box_32",function(){return cdn_url+"/41b0a/img/plugins/box/service_32.png"});Handlebars.registerHelper("versioned_services_gdrive_16",function(){return cdn_url+"/66f9/img/services/gdrive_16.png"});Handlebars.registerHelper("versioned_services_onedrive_32",function(){return cdn_url+"/41b0a/img/plugins/onedrive/service_32.png"});Handlebars.registerHelper("versioned_slackbot_48",function(){return cdn_url+"/41b0a/img/plugins/slackbot/service_48.png"});Handlebars.registerHelper("versioned_slackbot_72",function(){return cdn_url+"/0180/img/slackbot_72.png"});Handlebars.registerHelper("versioned_twitter_64",function(){return cdn_url+"/66f9/img/services/twitter_64.png"});Handlebars.registerHelper("versioned_upload_file_icon",function(e){if("1x"===e)return cdn_url+"/a079/img/upload_file_icon.png";else if("2x"===e)return cdn_url+"/a079/img/upload_file_icon@2x.png"});Handlebars.registerHelper("versioned_default_application_icon",function(){return cdn_url+"/bfaba/img/apps/default_new_app_icon.png"});Handlebars.registerHelper("versioned_join_shared_channel",function(e){if("1x"===e)return cdn_url+"/742c/img/join-channel/join_shared_channel.png";else if("2x"===e)return cdn_url+"/742c/img/join-channel/join_shared_channel@2x.png"});Handlebars.registerHelper("versioned_tos_book_illustration",function(e){if("1x"===e)return cdn_url+"/ead48/img/signup/book_illustration.png";else if("2x"===e)return cdn_url+"/ead48/img/signup/book_illustration@2x.png"});Handlebars.registerHelper("versioned_join_team_channel",function(e){if("1x"===e)return cdn_url+"/742c/img/join-channel/join_team_channel.png";else if("2x"===e)return cdn_url+"/742c/img/join-channel/join_team_channel@2x.png"});Handlebars.registerHelper("versioned_signin_no_teams",function(e){if("1x"===e)return cdn_url+"/7c9e4/img/enterprise/signin-no-teams.png";else if("2x"===e)return cdn_url+"/7c9e4/img/enterprise/signin-no-teams@2x.png"});Handlebars.registerHelper("versioned_basic_analytics_coming_soon",function(e){if("1x"===e)return cdn_url+"/436da/img/enterprise/ent_basic_analytics_coming_soon.png";else if("2x"===e)return cdn_url+"/436da/img/enterprise/ent_basic_analytics_coming_soon@2x.png"});Handlebars.registerHelper("versioned_slack_logo_240",function(){return cdn_url+"/09f7/marketing/img/slack_logo@2x.png"});Handlebars.registerHelper("versioned_file_drop_blue",function(){return cdn_url+"/c3881/img/file-drop-blue@2x.png"});Handlebars.registerHelper("versioned_focus_rocks",function(){return cdn_url+"/883cf/img/focus-rocks-0.png"});Handlebars.registerHelper("versioned_ill_team",function(e){if("1x"===e)return cdn_url+"/436da/img/quick_promo/ill_team.png";else if("2x"===e)return cdn_url+"/436da/img/quick_promo/ill_team@2x.png"});Handlebars.registerHelper("versioned_basic_analytics_upsell_banner_image",function(){return cdn_url+"/436da/img/enterprise/ent_basic_analytics_upsell_banner_image.gif"});Handlebars.registerHelper("pinToLabel",function(e){var t="";if(e.is_channel)t+="#";if(e.is_im||e.is_mpim)t+=TS.i18n.t("this conversation","pins")();else t+=_.escape(e.name);return new Handlebars.SafeString(t)});Handlebars.registerHelper("preventWidow",function(e){var t=e.split(" ");if(t.length>1){t[t.length-2]+="&nbsp;"+t[t.length-1];t.pop();e=t.join(" ")}return new Handlebars.SafeString(e)});Handlebars.registerHelper("number",function(e){return TS.i18n.number(e)||""});Handlebars.registerHelper("buildReplyBarHTML",function(e,t){return new Handlebars.SafeString(TS.templates.builders.buildReplyBarHTML(e,t))});Handlebars.registerHelper("makeSHRoomParticipantList",TS.templates.builders.makeSHRoomParticipantList);Handlebars.registerHelper("makeSHRoomSharedList",TS.templates.builders.makeSHRoomSharedList);Handlebars.registerHelper("atLabel",function(e){return TS.templates.builders.atLabel(e)});Handlebars.registerHelper("renderAttachmentActions",function(e,t,r){return new Handlebars.SafeString(TS.templates.builders.buildAttachmentActions(e,t,r))});Handlebars.registerHelper("renderAttachmentActionSelectOption",function(e,t){var r=_.merge({},e,{is_group_item:t.hash.is_group_item});var n=TS.templates.attachment_actions_select_option(r);return new Handlebars.SafeString(n)});Handlebars.registerHelper("renderAttachmentMedia",function(e,t){var r;var n=TS.utility.attachments.getMediaType(e);var i;switch(n){case"other":if(e.other_html)r=TS.templates.builders.buildInlineOtherDiv(e.other_html,t,e.safe_other_html);break;case"video":if(e.video_html&&e.thumb_url){i=e.from_url||e.thumb_url;r=TS.templates.builders.buildInlineVideoDiv(i,t)}break;case"image":if(e.image_url){i=e.from_url||e.image_url;var a={};a.flush_with_attachment=true;a.is_giphy_shuffle=e.fallback&&e.fallback.indexOf("giphy")>=0&&e.actions&&e.actions[1]&&"shuffle"===e.actions[1].name;r=TS.templates.builders.buildInlineImgDiv(i,t,a)}break;case"audio":if(e.audio_html)r=TS.templates.builders.buildInlineAudioDiv(e.audio_html,t,e.safe_audio_html);else if(e.audio_url)r=TS.templates.builders.formatSoundUrl(e)}if(r)return new Handlebars.SafeString(r)});Handlebars.registerHelper("getMemberTypeClass",TS.templates.builders.getMemberTypeClass);Handlebars.registerHelper("inlineSaver",function(e){var t=TS.templates.inline_saver({hide_text:e.hash.hide_text,target:e.hash.target});return new Handlebars.SafeString(t)});Handlebars.registerHelper("dangerouslyRenderHTML",function(e){return new Handlebars.SafeString(e)});Handlebars.registerHelper("attachmentMediaCaret",function(e,t){var r="";var n=TS.utility.attachments.getMediaType(e);var i;switch(n){case"video":i=e.from_url||e.thumb_url;r=TS.templates.builders.buildInlineVideoToggler(i,t,true);break;case"audio":i=e.audio_html||e.audio_url;r=TS.templates.builders.buildInlineAudioToggler(i,t);break;case"other":r=TS.templates.builders.buildInlineOtherToggler(e.other_html,t);break;case"image":i=e.from_url||e.image_url;var a={};a.is_giphy_shuffle=e.fallback&&e.fallback.indexOf("giphy")>=0&&e.actions&&e.actions[1]&&"shuffle"===e.actions[1].name;r=TS.templates.builders.buildInlineImgToggler(i,t,false,a);break;default:r=TS.templates.builders.buildInlineAttachmentToggler(e.from_url,t)}if(r)r='<span class="media_caret">'+r+"</span>";return new Handlebars.SafeString(r)});Handlebars.registerHelper("isMsgReply",function(e){var t=e.hash.msg;var r=TS.utility.msgs.isMsgReply(t);if(r)return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("buildMsgHTMLForThreadsView",function(e,t,r,n){var i=TS.templates.builders.buildThreadMsgHTML(e,t,r,n);return new Handlebars.SafeString(i)});Handlebars.registerHelper("buildThreadParticipantListHTML",function(e){return new Handlebars.SafeString(TS.templates.builders.buildThreadParticipantListHTML(e))});Handlebars.registerHelper("getTeamIconOfSize",function(e,t){if(e&&e.icon)return e.icon["image_"+t];return null});Handlebars.registerHelper("listItemCount",function(e){if(_.isUndefined(e)){TS.error("The template helper listItemCount failed because it was passed undefined");return 0}e=TS.utility.parseJSONOrElse(e,e);if(_.isString(e)&&e.length)return e.split(",").length;return e.length});Handlebars.registerHelper("objectKeyCount",function(e){return _.isObject(e)?_.keys(e).length:0});Handlebars.registerHelper("getIconSizeToFit",function(e){return TS.interop.utility.getIconSizeToFit(e)});Handlebars.registerHelper("prefsNotificationExampleAll",function(){var e=TS.model.team.name;if(!TS.model.is_mac)e=TS.i18n.t("from {team_name}","prefs")({team_name:e});var t=TS.templates.prefs_notification_example({name:e,text:TS.i18n.t("Good morning everyone!","prefs")()});return new Handlebars.SafeString(t)});Handlebars.registerHelper("prefsNotificationExampleMentions",function(){var e=TS.model.team.name;if(!TS.model.is_mac)e=TS.i18n.t("from {team_name}","prefs")({team_name:e});var t=":wave:";var r=TS.emoji.getChosenSkinTone();if(r)t+=":"+r+":";var n=TS.emoji.graphicReplace(t);var i=TS.templates.prefs_notification_example({name:e,text:new Handlebars.SafeString(TS.i18n.t("{wave_emoji} Hi <strong>@{username}</strong>","prefs")({wave_emoji:n,username:TS.members.getPrefCompliantMemberName(TS.model.user,true)}))});return new Handlebars.SafeString(i)});Handlebars.registerHelper("prefsNotificationSettingReadable",function(e){if(!e.desktop&&!e.mobile)return"";var t="";var r=TS.boot_data.feature_mpdm_default_fe?"mentions_dms":"mentions";if(e.desktop===e.mobile)if("everything"===e.desktop)t+=TS.i18n.t("<strong>Desktop and Mobile:</strong> All new messages","prefs")();else if(e.desktop===r)t+=TS.i18n.t("<strong>Desktop and Mobile:</strong> Direct messages, mentions &amp; keywords","prefs")();else t+=TS.i18n.t("<strong>Desktop and Mobile:</strong> Nothing","prefs")();else{if(e.desktop)if("everything"===e.desktop)t+=TS.i18n.t("<strong>Desktop:</strong> All new messages","prefs")();else if(e.desktop===r)t+=TS.i18n.t("<strong>Desktop:</strong> Direct messages, mentions &amp; keywords","prefs")();else t+=TS.i18n.t("<strong>Desktop:</strong> Nothing","prefs")();if(e.desktop&&e.mobile)t+="<br>";if(e.mobile)if("everything"===e.mobile)t+=TS.i18n.t("<strong>Mobile:</strong> All new messages","prefs")();else if(e.mobile===r)t+=TS.i18n.t("<strong>Mobile:</strong> Direct messages, mentions &amp; keywords","prefs")();else t+=TS.i18n.t("<strong>Mobile:</strong> Nothing","prefs")()}return new Handlebars.SafeString(t)});Handlebars.registerHelper("teamRetentionDuration",function(){return TS.prefs.getTeamPref("retention_duration")});Handlebars.registerHelper("teamRetentionType",function(){return TS.prefs.getTeamPref("retention_type")});Handlebars.registerHelper("channelInsightsIsEnabled",function(t){t=e(t);if(TS.boot_data.feature_sli_channel_insights&&TS.client.ui.channel_insights.isEnabled())return t.fn(this);return t.inverse(this)});Handlebars.registerHelper("sliFileSearchIsEnabled",function(e){if(TS.search.sliFileSearchIsEnabled())return e.fn(this);return e.inverse(this)});Handlebars.registerHelper("formatWorkspaceDiscoverability",function(e){return TS.utility.enterprise.getWorkspaceVisibilityLabel(e)});Handlebars.registerHelper("escape",function(e){return _.escape(e)});Handlebars.registerHelper("crossWorkspaceJumperLink",function(e){if(!e||!e.id||!e.team_id)return"";var t=TS.teams.getTeamById(e.team_id);return TS.utility.enterprise.buildTeamUrl(_.get(t,"domain"))+"messages/"+e.id})},test:function r(){return{_optionsFnInverseBooleanHelper:e,_inlineImgSrcForFile:t}}});var e=function e(t){if("function"!==typeof t.fn)t.fn=function(){return true};if("function"!==typeof t.inverse)t.inverse=function(){return false};return t};var t=function e(t,r){if("string"===typeof t)t=TS.files.getFileById(t);if(!t)return false;if(!TS.files.fileIsImage(t))return false;if(!r)r=480;return TS.files.getThumbSrcForFile(t,{max_size:r})};var n=function e(t){var r;switch(t){case 32:case 36:case 48:r=16;break;case 72:r=22;break;case 192:case 512:break;default:r=16}return r}})()},4797:function(e,t){(function(){TS.registerModule("utility.date",{fake_ts_unique_padder:"x",do24hrTime:function e(){return TS.model.user&&TS.prefs.prefs_loaded&&TS.prefs.getPref("time24")},memberUTCOffset:function t(r){var n=e(r);var i=n/60/60;if(i<0)return"(UTC"+i+")";else if(i>0)return"(UTC+"+i+")";return"(UTC)"}});var e=function e(t){var r=-28800;if(t&&t.tz_offset&&"undefined"!==typeof t.tz_offset||0===t.tz_offset)r=t.tz_offset;return r}})()},4798:function(e,t){var r="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};(function(){TS.registerModule("utility.msgs",{file_subtypes:["file_comment","file_mention","file_share","file_upload"],allowed_embed_attributes:["class","name","id","src","width","oldwidth","height","oldheight","frameborder","title","scrolling","allowtransparency","allowfullscreen","oallowfullscreen","msallowfullscreen","webkitallowfullscreen","mozallowfullscreen","controls","autoplay","loop","muted","poster","preload","webkit-playsinline","type"],ephemeral_msgs_map:{},messageIncludesMember:function e(t,r){if(!t){TS.warn("messageIncludesMember: WTF no member?");return}if(!r){TS.warn("messageIncludesMember: WTF no msg?");return}if(TS.utility.msgs.memberSentMessage(t,r))return true;var n=r.text;var i=TS.format.calculateOptions(r,{});var a=TSF.getTokensArray($.trim(n),i.tsf_mode,{jumbomoji:!i.no_jumbomoji,allow_intra_word_formatting:TS.format.shouldAllowIntraWordFormatting()});var s;for(var o=0,l=a.length;o<l;o+=1){s=a[o];if(0===s.indexOf("<")&&0===s.indexOf("<@")){var u=s.replace(/<|>/g,"");var d=TS.utility.msgs.getMemberIdFromMemberMarkup(u);if(d&&d==t.id)return true}}return false},memberSentMessage:function e(t,r){if(!t){TS.warn("messageIncludesMember: WTF no member?");return}if(!r){TS.warn("messageIncludesMember: WTF no msg?");return}return!!(r.user&&r.user==t.id)||!!(r.comment&&r.comment.user==t.id)},allUnknownUsersInMessage:function e(t){var r=[];var n=t.text;var i=TS.format.calculateOptions(t,{});var a=TSF.getTokensArray($.trim(n),i.tsf_mode,{jumbomoji:!i.no_jumbomoji,allow_intra_word_formatting:TS.format.shouldAllowIntraWordFormatting()});for(var s=0;s<a.length;s+=1){var o=a[s];if(0===o.indexOf("<")&&0===o.indexOf("<@")){var l=o.replace(/<|>/g,"");var u=TS.utility.msgs.getMemberIdFromMemberMarkup(l);var d=TS.members.getPotentiallyUnknownMemberById(u);if(!d)d=TS.members.getMemberByName(u);if(!d)if(r.indexOf(u)<0)r.push(u)}}return r},appendMsg:function e(t,r){t.unshift(TS.utility.msgs.makeSureMsgObIsValid(r))},setMsgs:function e(t,r){for(var n=0;n<r.length;n+=1)r[n]=TS.utility.msgs.makeSureMsgObIsValid(r[n]);TS.utility.msgs.sortMsgs(r);t.msgs=r;return t.msgs},spliceMsg:function e(t,r){var n=t.indexOf(r);if(n>-1)t.splice(n,1)},getNonTempMsgFromUserMatchingText:function e(t,r,n){if(!t&&0!==t)return null;var i;for(var a=0;a<n.length;a+=1){i=n[a];if(i.user!=r)continue;if(TS.utility.msgs.isTempMsg(i))continue;if(i.text==t)return i}return null},getMsgByProp:function e(t,r,n){if(!r&&0!==r)return null;var i;for(var a=0;a<n.length;a+=1){i=n[a];if(i[t]==r)return i}return null},getEditableMsgByProp:function e(t,r,n){if(!r&&0!==r||!n)return null;var i;for(var a=0;a<n.length;a+=1){i=n[a];if(i.subtype&&"me_message"!==i.subtype&&"thread_broadcast"!==i.subtype)continue;if(i[t]==r)return i}return null},getEditableReplyByProp:function e(t,r,n,i){if(!r&&0!==r||!n||!i)return null;var a;if(TS.ui.replies.activeConvoModelId()===n.id&&TS.ui.replies.activeConvoThreadTs()===i)a=TS.ui.replies.getActiveMessages();else if(TS.model.threads_view_is_showing){var s=TS.client.threads.getThread(n,i);a=s&&s.replies?s.replies:[]}var o=_.findLast(a,function(e){var n=!(e.subtype&&"me_message"!==e.subtype);var i=e[t]===r;return n&&i});return o},sortMsgs:function e(t){function r(e,t){if(e.ts<t.ts)return 1;if(e.ts>t.ts)return-1;return 0}t.sort(r)},isMsgRolledUp:function e(t){if(!t._jl_rolled_up_in)return false;return t._jl_rolled_up_in!==t.ts},isMsgHidden:function e(t){if(!t)return true;if(t.no_display)return true;if(t._hidden_reply)return true;return false},getPrevDisplayedMsg:function e(t,r){var n;var i=false;for(var a=0;a<r.length;a+=1){n=r[a];if(i){if(!TS.utility.msgs.isMsgHidden(n)&&!TS.utility.msgs.isMsgRolledUp(n))return n}else if(n.ts==t)i=true}return null},getDisplayedMsgs:function e(t){var r=[];var n;for(var i=0;i<t.length;i+=1){n=t[i];if(!TS.utility.msgs.isMsgHidden(n)&&!TS.utility.msgs.isMsgRolledUp(n))r.push(n)}return r},getDisplayedMsgAfterTS:function e(t,r){var n;for(var i=r.length-1;i>-1;i-=1){n=r[i];if(n.ts>t)if(!TS.utility.msgs.isMsgHidden(n)&&!TS.utility.msgs.isMsgRolledUp(n))return n}return null},getDisplayedMsgBeforeTS:function e(t,r){var n;for(var i=0;i<r.length;i+=1){n=r[i];if(n.ts<t)if(!TS.utility.msgs.isMsgHidden(n)&&!TS.utility.msgs.isMsgRolledUp(n))return n}return null},getUnreadCountableMsgAfterTS:function e(t,r){var n;for(var i=r.length-1;i>-1;i-=1){n=r[i];if(n.ts>t)if(TS.utility.msgs.msgCanCountAsUnread(n))return n}return null},getMarkMsgTSForUnreadPoint:function e(t,r,n){var i;var a;if(n.oldest_msg_ts&&t==n.oldest_msg_ts)i="0000000000.000000";else{a=TS.utility.msgs.getPrevDisplayedMsg(t,r)||TS.utility.msgs.getMsg(t,r);if(a)i=a.ts}if(!i)return null;while(i&&!TS.utility.msgs.getUnreadCountableMsgAfterTS(i,r)){a=TS.utility.msgs.getPrevDisplayedMsg(i,r);if(a)i=a.ts;else i=null}if(!i)return null;return i},getMsg:function e(t,r){if(!r)return null;return TS.utility.msgs.getMsgByProp("ts",t,r)},canEditMsg:function e(t,r){if(t.user!==TS.model.user.id)return false;if(TS.interop.rules.messages.isAutomatedSubtype(t.subtype))return false;if(TS.utility.msgs.isFileMsg(t))return false;if(t&&"reply_broadcast"===t.subtype)return false;if(t&&"tombstone"===t.subtype)return false;if(r&&r.is_self_im)return true;if(TS.prefs.getTeamPref("msg_edit_window_mins")>-1&&(Date.now()-TS.interop.datetime.toDateObject(t.ts))/6e4>TS.prefs.getTeamPref("msg_edit_window_mins"))return false;return true},isFileMsg:function e(t){if(!t)return false;return TS.utility.msgs.isFileSubtype(t.subtype)},isFileSubtype:function e(t){if(!t)return false;return TS.utility.msgs.file_subtypes.indexOf(t)>=0},getMsgActions:function e(t,r){if(!t)return;r=r||TS.shared.getActiveModelOb();var n={edit_msg:TS.utility.msgs.canEditMsg(t,r),delete_msg:true};var i=false;if(t.user==TS.model.user.id)i=true;var a=TS.utility.teams.isMsgFromOtherTeam(t);if(t.file&&"email"===t.file.mode)n.open_original=true;if(!TS.prefs.getTeamPref("allow_message_deletion")){if(a)if(TS.boot_data.page_needs_enterprise&&TS.model.user.enterprise_user.is_owner)n.delete_msg=true;else n.delete_msg=false;else if(!TS.model.user.is_admin)n.delete_msg=false;else if(TS.model.active_im_id)if(!i&&"USLACKBOT"!==t.user&&"bot_message"!==t.subtype)n.delete_msg=false}else if("tombstone"===t.subtype)n.delete_msg=false;else if("retention"===t.subtype)n.delete_msg=false;else if(a)if(TS.boot_data.page_needs_enterprise&&(i||TS.model.user.enterprise_user.is_owner))n.delete_msg=true;else n.delete_msg=false;else if(TS.model.active_im_id){if(!i&&"USLACKBOT"!==t.user&&"bot_message"!==t.subtype)n.delete_msg=false}else if(!i){if(!TS.model.user.is_admin)n.delete_msg=false}else if(TS.interop.rules.messages.isAutomatedSubtype(t.subtype)){var s=["pinned_item","sh_room_created","sh_room_shared","reply_broadcast"];if(!TS.model.user.is_admin&&!_.includes(s,t.subtype))n.delete_msg=false}if("thread_broadcast"===t.subtype)n.remove_broadcast=n.delete_msg;if(t.is_ephemeral)n.delete_msg=true;else{if(TS.client&&"pinned_item"!==t.subtype&&"unpinned_item"!==t.subtype&&"sh_room_created"!==t.subtype&&"sh_room_shared"!==t.subtype){if(TS.pins.canUserPinHere(r))if(TS.pins.isMessagePinned(t,r))n.unpin_msg=true;else n.pin_msg=true;if("tombstone"===t.subtype){n.unpin_msg=false;n.pin_msg=false}var o=["channel_join","channel_leave","group_join","group_leave"];if(_.includes(o,t.subtype))n.pin_msg=false}if("file_comment"===t.subtype)n.add_file_comment_rxn=true;else if(TS.utility.msgs.isFileMsg(t))n.add_file_rxn=true;else if("tombstone"===t.subtype)n.add_rxn=false;else n.add_rxn=true;if(TS.clipboard.canWriteText()){n.copy_link=true;if("tombstone"===t.subtype)n.copy_link=false}}if(TS.client)n.mark_unread=true;var l=!t.thread_ts||t.thread_ts==t.ts;n.jump_to_original=true;if(TS.replies.canReplyToMsg(r,t))n.reply=true;n.jump_to_original=l;if(n.mark_unread&&!l)n.mark_unread=false;var u=["bot_message","file_share","file_mention","file_comment","me_message","reply_broadcast","thread_broadcast"];if(!t.is_ephemeral&&(!t.subtype||-1!==u.indexOf(t.subtype)))n.remind_me=true;if(n.jump_to_original||n.copy_link||n.mark_unread||n.remind_me)n.has_private_actions=true;if(n.copy_link||n.add_rxn||n.add_file_rxn||n.add_file_comment_rxn||n.pin_msg||n.unpin_msg)n.has_public_actions=true;if(!t.is_ephemeral&&!TS.utility.msgs.isTempMsg(t))if("file_share"===t.subtype||"file_mention"===t.subtype)n.share_file=true;else if("tombstone"===t.subtype)n.share_message=false;else n.share_message=!TS.ims.isImWithDeletedMember(r)&&(!r.is_archived||r.is_channel);return n},validateMsg:function e(t,r,n){if(!r.ts){TS.error("msg lacks a ts ("+t+")");TS.dir(0,r);return false}if(TS.utility.msgs.getMsg(r.ts,n)){TS.warn("msg "+r.ts+" already exists! ("+t+")");TS.dir(0,r);return false}return true},findMsg:function e(t,r){var n;if(TS.useReactMessages()){n=TS.redux.messages.getMessageByTimestamp(r,t);if(n)return n}var i=TS.shared.getModelObById(r);if(i){n=i.msgs&&TS.utility.msgs.getMsg(t,i.msgs);if(n)return n;n=i._archive_msgs&&TS.utility.msgs.getMsg(t,i._archive_msgs);if(n)return n;if(TS.ui.replies){n=TS.ui.replies.getActiveMessage(i,t);if(n)return n}if(TS.client){n=TS.client.threads.getMessage(i,t);if(n)return n}if(!n&&TS.model.unread_view_is_showing&&TS.client){n=TS.client.unread.getMessage(i,t);if(n)return n}}var a=TS.mentions.getMentionByMsgId(t);if(a)return a.message;return null},replaceMsg:function e(t,r,n,i){var a=TS.utility.msgs.getMsg(r.ts,t.msgs);if(!a&&t._archive_msgs)a=TS.utility.msgs.getMsg(r.ts,t._archive_msgs);if(!a&&TS.ui.replies)a=TS.ui.replies.getActiveMessage(t,r.ts);if(!a&&TS.client)a=TS.client.threads.getMessage(t,r.ts);if(!a&&TS.client)a=TS.client.unread.getMessage(t,r.ts);if(TS.useReactMessages())TS.redux.messages.replaceMessage(TS.utility.msgs.processImsg(r,t.id));if(!a){if(!n)TS.error("unknown msg:"+r.ts+" in "+t.id);return}r._rxn_key=a._rxn_key;if(!r.pinned_to)r.pinned_to=a.pinned_to;if(!("is_starred"in r))r.is_starred=a.is_starred;if(TS.boot_data.feature_sli_recaps&&!r.recap&&a.recap)r.recap=a.recap;var s=null;if(r.comment&&r.file){var o=TS.files.getFileById(r.file.id);if(o){TS.files.editCommentOnFile(r.comment,o);s=TS.files.getFileCommentById(o,r.comment.id)}}r=TS.utility.msgs.processImsg(r,t.id);if(s)r.comment=s;var l=_.union(Object.keys(r),Object.keys(a)).filter(function(e){return r[e]!=a[e]});if(!l.length&&!i){TS.info("Not signalling message change because it doesn't look like anything has changed for "+r.ts+" in "+t.id);return}_.each(_.keys(a),function(e){delete a[e]});_.forOwn(r,function(e,t){a[t]=e});if(t.is_im)TS.ims.message_changed_sig.dispatch(t,a,l);else if(t.is_group&&t.is_mpim)TS.mpims.message_changed_sig.dispatch(t,a,l);else if(t.is_group&&!t.is_mpim)TS.groups.message_changed_sig.dispatch(t,a,l);else if(t.is_channel)TS.channels.message_changed_sig.dispatch(t,a,l);if(_.includes(l,"_hidden_reply")){var u=!TS.utility.msgs.isTempMsg(a);if(t.is_im)TS.ims.calcUnreadCnts(t,u);else if(t.is_group&&t.is_mpim)TS.mpims.calcUnreadCnts(t,u);else if(t.is_group&&!t.is_mpim)TS.groups.calcUnreadCnts(t,u);else if(t.is_channel)TS.channels.calcUnreadCnts(t,u)}if(TS.utility.msgs.msgHasReplies(a)&&!TS.useReactMessages())TS.replies.updateThreadBroadcastRoots(t,a)},removeEphemeralMsg:function e(t,r){var n=TS.groups.getGroupById(t)||TS.channels.getChannelById(t);if(!n)return;var i;if(TS.useReactMessages())i=TS.utility.msgs.findMsg(r,n.id);else i=TS.utility.msgs.getMsg(r,n.msgs);if(n.is_channel)TS.channels.removeMsg(t,i);else if(n.is_mpim)TS.mpims.removeMsg(t,i);else if(n.is_group)TS.groups.removeMsg(t,i)},getMemberFromMemberMarkup:function e(t){var r=TS.utility.msgs.getMemberIdFromMemberMarkup(t);var n=TS.members.getPotentiallyUnknownMemberById(r);if(!n)n=TS.members.getMemberByName(r);return n},getMemberIdFromMemberMarkup:function e(t){var r=t.substr(1);if(r)r=r.split("|")[0];return r},makeSureMsgObIsValid:function e(t){return t},api_url_prefix:"api::",doApiUrl:function e(t){if(!TS.client){alert(TS.i18n.t("This link will not work in the archives.","msgs")());return}t=t.replace(TS.utility.msgs.api_url_prefix,"");var r=t.split("?");var n=r[0];var i={};if(r.length>1){var a=r[1].split("&");for(var s=0;s<a.length;s+=1){var o=a[s].indexOf("=");if(-1!=o){var l=a[s].substring(0,o);var u=a[s].substring(o+1);i[l]=unescape(u)}}}TS.api.call(n,i)},new_api_url_prefix:"slack-action://",doNewApiUrl:function e(t){if(!TS.client){alert(TS.i18n.t("This link will not work in the archives.","msgs")());return}var r=t.replace(TS.utility.msgs.new_api_url_prefix,"").split("/");var n=r.shift();var i=r.join("/");TS.api.call("chat.action",{bot:n,payload:decodeURIComponent(i)})},getHighlightWordsRegex:function e(){if(!TS.model.highlight_words_regex)TS.utility.msgs.makeHighlightWordsRegex();return TS.model.highlight_words_regex},makeHighlightWordsRegex:function e(){var t;var r=[];for(var n=0;n<TS.model.highlight_words.length;n+=1){t=TS.format.swapOutAts(TS.model.highlight_words[n]);t=TS.utility.regexpEscape(t);if("don"===t)t+="(?!['’]t)";r.push(t)}TS.model.highlight_words_regex=new RegExp("(\\b|_|\\s|^)("+r.join("|")+")(\\b|_|\\s|$)","i")},msgContainsMention:function e(t,r,n,i,a){var s=TS.utility.msgs.getHighlightWordsRegex();var o="bot_message"===t.subtype;var l=TS.utility.msgs.isMsgReply(t);function u(e){if(!e)return false;if(TS.model.you_regex.test(e))return true;if(!r&&TS.model.here_regex.test(e))return true;if(!i&&!l&&TS.model.everyone_regex.test(e))return true;if(!a&&!l&&TS.model.channel_regex.test(e))return true;if(!l&&TS.model.group_regex.test(e))return true;for(var t in TS.model.your_user_group_regex)if(TS.model.your_user_group_regex[t].test(e))return true;if(o)return false;e=e.replace(/<!subteam\^(\w+\d+)\|@(.+)>/g,"");e=TS.format.swapOutAts(e);if(s.test(e)&&!n)return true;return false}if("pinned_item"===t.subtype)return false;if(!t.ignore_if_attachments_supported&&u(t.text))return true;var d;var _;if(t.attachments)for(var c=0;c<t.attachments.length;c+=1){d=t.attachments[c];if(d.from_url)continue;if(u(d.title))return true;if(u(d.pretext))return true;if(u(d.text))return true;if(u(d.footer))return true;if(!d.fields||!d.fields.length)continue;for(var m=0;m<d.fields.length;m+=1){_=d.fields[m];if(u(_.value))return true}}return false},getMsgMentionData:function e(t,r){var n={mentions:false,non_channel_mentions:false};var i=TS.utility.msgs.getHighlightWordsRegex();var a="bot_message"===t.subtype;var s=TS.utility.msgs.isMsgReply(t);function o(e){if(l(e)){n.non_channel_mentions=true;n.mentions=true;return true}if(u(e))n.mentions=true;return false}function l(e){if(!e)return false;if(TS.model.you_regex.test(e))return true;if(a)return false;e=TS.format.swapOutAts(e);if(i.test(e)&&!r)return true;return false}function u(e){if(!e)return false;if(TS.model.everyone_regex.test(e)&&!s)return true;if(TS.model.channel_regex.test(e)&&!s)return true;if(TS.model.group_regex.test(e)&&!s)return true;return false}if(!t.ignore_if_attachments_supported&&o(t.text))return n;var d;var _;if(t.attachments)for(var c=0;c<t.attachments.length;c+=1){d=t.attachments[c];if(d.from_url)continue;if(o(d.title))return n;if(o(d.pretext))return n;if(o(d.text))return n;if(o(d.footer))return n;if(!d.fields||!d.fields.length)continue;for(var m=0;m<d.fields.length;m+=1){_=d.fields[m];if(o(_.value))return n}}return n},msgCanCountAsUnread:function e(t){if(TS.utility.msgs.isMsgHidden(t))return false;if("channel_join"===t.subtype&&t.inviter&&t.user==TS.model.user.id)return true;if("group_join"===t.subtype&&t.inviter&&t.user==TS.model.user.id)return true;if(t.user==TS.model.user.id)return false;if("channel_join"===t.subtype)return false;if("channel_leave"===t.subtype)return false;if("group_join"===t.subtype)return false;if("group_leave"===t.subtype)return false;if("mpim_notify_disabled"===t.subtype)return false;if(t.comment&&t.comment.user==TS.model.user.id)return false;if(t.dnd_suppressed)return false;return true},countAllUnreads:function t(){if(e)return;TS.model.all_unread_highlights_cnt=0;TS.model.all_unread_cnt=0;TS.model.all_unread_cnt_to_exclude=0;TS.model.all_unread_highlights_cnt_to_exclude=0;var r;var n;var i=TS.channels.getChannelsForUser();i.forEach(function(e){if(e.is_archived&&!e.was_archived_this_session||TS.notifs.isCorGMuted(e.id))return;r=parseInt(e.unread_cnt,10)||0;n=parseInt(e.unread_highlight_cnt,10)||0;TS.model.all_unread_cnt+=r;TS.model.all_unread_highlights_cnt+=n;TS.utility.msgs.maybeExcludeUnreads(e,r,n)});TS.model.groups.forEach(function(e){if(e.is_archived&&!e.was_archived_this_session||TS.notifs.isCorGMuted(e.id))return;r=parseInt(e.unread_cnt,10)||0;n=parseInt(e.unread_highlight_cnt,10)||0;TS.model.all_unread_cnt+=r;TS.model.all_unread_highlights_cnt+=n;TS.utility.msgs.maybeExcludeUnreads(e,r,n)});TS.model.ims.forEach(function(e){r=parseInt(e.unread_cnt,10)||0;n=parseInt(e.unread_cnt,10)||0;TS.model.all_unread_cnt+=r;TS.model.all_unread_highlights_cnt+=n;TS.utility.msgs.maybeExcludeUnreads(e,r,n)});TS.model.mpims.forEach(function(e){r=parseInt(e.unread_cnt,10)||0;n=parseInt(e.unread_cnt,10)||0;TS.model.all_unread_cnt+=r;TS.model.all_unread_highlights_cnt+=n;TS.utility.msgs.maybeExcludeUnreads(e,r,n)});if(TS.boot_data.feature_less_light_up){_.each(TS.model.threads_mention_counts,function(e,t){n=parseInt(e,10)||0;TS.model.all_unread_highlights_cnt+=n;TS.utility.msgs.maybeExcludeUnreads(TS.shared.getModelObById(t),0,n)});if(TS.model.threads_has_unreads)TS.model.all_unread_cnt+=1}else{if(TS.model.threads_has_unreads)TS.model.all_unread_cnt+=1;if(TS.model.threads_mention_count)TS.model.all_unread_highlights_cnt+=TS.model.threads_mention_count}},maybeExcludeUnreads:function e(t,r,n){if(!t)return;if(!r&&!n)return;if(!TS.shared.isModelObOrgShared(t))return;if(!TS.shared.isRelevantTeamForSharedModelOb(t)){if(TS.model.is_our_app&&TS.has_pri[o])TS.log(o,"Excluding unread of "+r+" and highlight of "+n+" for shared channel "+t.id+" because this is NOT the relevant team.");TS.model.all_unread_cnt_to_exclude+=r;TS.model.all_unread_highlights_cnt_to_exclude+=n}else if(TS.has_pri[o]&&TS.model.is_our_app)TS.log(o,"Using unread of "+r+" and highlight of "+n+" for shared channel "+t.id+" because this IS the relevant team.")},doesMsgHaveRxnFromUser:function e(t,r){return TS.rxns.doesRxnsHaveRxnFromUser(TS.rxns.getExistingRxnsByKey(t._rxn_key),r)},doesMsgHaveRxn:function e(t,r){return TS.rxns.doesRxnsHaveRxn(TS.rxns.getExistingRxnsByKey(t._rxn_key),r)},recordEmojiInHash:function e(t,r){if(!t)return false;if(!r)return false;var n=true;var i=TS.utility.findAllTeamEmojiInStr(t,n);if(!i.length)return false;var a=false;var s;for(var o=0;o<i.length;o+=1){s=TS.emoji.isValidName(i[o]);if(!s){TS.error(i[o]+" invalid");continue}if(!parseInt(r[s],10))r[s]=0;r[s]+=1;a=true}return a},reCalcAndCountSomeUnreads:function e(t){if(!t||!t.length)return;var r;var n;var i;for(r=0;r<t.length;r+=1){i=TS.shared.getModelObById(t[r]);if(!i){TS.warn("reCalcAndCountSomeUnreads: WTF no model_ob for id "+t[r]);continue}n=TS.shared.getControllerForModelOb(i);if(!n){TS.warn("reCalcAndCountSomeUnreads: WTF no controller for model_ob.id "+i.id);continue}if(!n.calcUnreadCnts){TS.warn("reCalcAndCountSomeUnreads: WTF no calcUnreadCnts on controller for model_ob.id "+i.id);continue}n.calcUnreadCnts(i)}},reCalcAndCountAllUnreads:function e(){var t=TS.channels.getChannelsForUser();var r=true;TS.utility.msgs.startBatchUnreadCalc();t.forEach(function(e){if(e.is_archived&&!e.was_archived_this_session)return;if(r&&TS.shared.didDeferMessageHistoryById(e.id))return;TS.channels.calcUnreadCnts(e)});TS.model.groups.forEach(function(e){if(e.is_archived&&!e.was_archived_this_session)return;if(r&&TS.shared.didDeferMessageHistoryById(e.id))return;TS.groups.calcUnreadCnts(e)});TS.model.ims.forEach(function(e){if(r&&TS.shared.didDeferMessageHistoryById(e.id))return;TS.ims.calcUnreadCnts(e)});TS.model.mpims.forEach(function(e){if(r&&TS.shared.didDeferMessageHistoryById(e.id))return;TS.mpims.calcUnreadCnts(e)});TS.utility.msgs.finishBatchUnreadCalc()},startBatchUnreadCalc:function t(){if("0"==TS.qs_args.unread_batch)return;e=true},finishBatchUnreadCalc:function t(){e=false;TS.utility.msgs.countAllUnreads()},whatisunread:function e(){var t=[];TS.channels.getChannelsFilteredBy("unread_cnt").forEach(function(e){t.push("C:"+e.name+" "+e.unread_cnt)});TS.groups.getGroupsFilteredBy("unread_cnt").forEach(function(e){t.push("G:"+e.name+" "+e.unread_cnt)});TS.ims.getImsFilteredBy("unread_cnt").forEach(function(e){t.push("D:"+e.name+" "+e.unread_cnt)});TS.mpims.getMpimsFilteredBy("unread_cnt").forEach(function(e){t.push("G:"+e.name+" "+e.unread_cnt)});TS.info("unreads: "+t.join(","))},maybeSetOldestMsgsTsAfterMsgAdded:function e(t){if(t.oldest_msg_ts)return;if(t.latest)return;TS.utility.msgs.setOldestMsgsTs(t)},setOldestMsgsTs:function e(t){var r=TS.utility.msgs.getOldestValidTs(t);if(r){if(TS.pri)TS.log(58,"setOldestMsgsTs ("+t.id+'): setting oldest_msg_ts from "'+t.oldest_msg_ts+'" -> '+r);t.oldest_msg_ts=r;TS.storage.storeOldestTs(t.id,t.oldest_msg_ts);if(t._latest_via_users_counts)t._latest_via_users_counts=void 0}},resetOldestMsgsTs:function e(t){if(TS.pri)TS.log(58,"resetOldestMsgsTs ("+t.id+'): setting oldest_msg_ts from "'+t.oldest_msg_ts+'" -> null');t.oldest_msg_ts=null;TS.storage.storeOldestTs(t.id,null)},getOlderMsgsStatus:function e(t){var r=t.msgs;var n=t.oldest_msg_ts;var i=false;var a="ERROR";var s=false;var o=0;var l;if(t.msgs.length)l=TS.shared.getLatestMsgTs(t)||null;if(n&&TS.utility.msgs.getMsg(n,r))i=true;if(!l)if(r.length){s=false;o=1;a="There are NOT older messages than these."}else{s=false;o=2;a="THIS IS A BRAND NEW CHANNEL SAY SOMETHING"}else if(i||t.is_limited){s=false;o=3;a="We have the oldest msg: "+n+". is_limited:"+t.is_limited}else{s=true;o=4;if(n)a="There are older messages than these. oldest_msg_ts: "+n;else a="There are older messages than these. oldest_msg_ts: unknown"}return{text:a,more:s,code:o,is_limited:t.is_limited}},getMostRecentValidTs:function e(t){if(!t)return null;var r;var n=t.msgs||[];for(var i=0;i<n.length;i+=1){r=n[i];if(!TS.utility.msgs.isTempMsg(r)){if(TS.pri&&i>0)TS.log(58,"getMostRecentValidTs ("+t.id+"): "+r.ts+" at msgs["+i+"] of "+n.length);return r.ts}}var a=TS.shared.getLatestMsgTs(t)||null;if(TS.pri)TS.log(58,"getMostRecentValidTs ("+t.id+"): did not find most recent valid ts. getLatestMsgTs() returned "+a);return a},getOldestValidTs:function e(t){var r;if(!t||!t.msgs)return null;var n=t.msgs.length-1;for(var i=n;i>-1;i-=1){r=t.msgs[i];if(!TS.utility.msgs.isTempMsg(r)){if(TS.pri&&i!==n)TS.log(58,"getOldestValidTs("+t.id+"): "+r.ts+" at msgs["+i+"] of "+n);return r.ts}}if(TS.pri)TS.warn("getOldestValidTs("+t.id+"): none found. msgs.length = "+n);return null},getHistoryFetchJobKey:function e(t,r){var n=t;if(r)n+="_"+r;return n},processImsg:function e(t,r){TS.utility.msgs._slurpExtraData(t,r);return TS.utility.msgs._makeInternalMsgObject(t,r)},processImsgFromHistory:function e(t,r){var n=TS.utility.msgs.processImsg(t,r);t.channel=r;if("message_deleted"===t.subtype)TS.ms.msg_handlers.subtype__message_deleted(t);else if("message_changed"===t.subtype)TS.ms.msg_handlers.subtype__message_changed(t);return n},_makeInternalMsgObject:function e(t,n){var i={type:"message",ts:t.ts};if(TS.useReactMessages()){i.channel=n;if(t._ephemeral_type)i._ephemeral_type=t._ephemeral_type}if(t.source_team)i.source_team_id=t.source_team;if("USLACKBOT"===t.user&&t.slackbot_feels)i.slackbot_feels=t.slackbot_feels;if(t.thread_ts){i.thread_ts=t.thread_ts;if(t.parent_ts)i.parent_ts=t.parent_ts;if(t.parent_user_id)i.parent_user_id=t.parent_user_id;if(t.hasOwnProperty("reply_count"))i.reply_count=parseInt(t.reply_count,10);if(t.thread_ts!==t.ts&&"thread_broadcast"!==t.subtype)i._hidden_reply=true;if("thread_broadcast"===t.subtype&&t.root){i.root=t.root;if(TS.useReactMessages())i.root.channel=n}if(TS.boot_data.feature_threads_perf){if(t.latest_reply)i.latest_reply=t.latest_reply;if(t.reply_users)i.reply_users=t.reply_users;if(t.reply_users_count)i.reply_users_count=t.reply_users_count}}else if(TS.useReactMessages()){i.thread_ts=void 0;i.reply_count=void 0}if("reply_broadcast"===t.subtype){if(t.broadcast_thread_ts)i.broadcast_thread_ts=t.broadcast_thread_ts;if(t.channel)i.channel_id=t.channel;if(t.new_broadcast)i.no_display=true}if(t.replies&&!TS.boot_data.feature_threads_perf)i.replies=t.replies;else if(TS.useReactMessages())i.replies=void 0;if(t.hasOwnProperty("subscribed"))i._subscribed=t.subscribed;if(t.hasOwnProperty("unread_count"))i._unread_count=t.unread_count;if(t.last_read)i._last_read=t.last_read;if("tombstone"===t.subtype&&t.hidden&&t.reply_count>0)delete t.hidden;if("channel_topic"===t.type||"channel_purpose"===t.type||"channel_join"===t.type||"channel_leave"===t.type)t.subtype=t.type;if(TS.utility.msgs.shouldHideChannelJoinOrLeaveMsg(t,n))i.no_display=true;if("group_join"===t.subtype||"group_purpose"===t.subtype||"group_topic"===t.subtype){var a=TS.shared.getModelObById(n);if(a&&a.is_mpim)i.no_display=true}if(t.inviter)i.inviter=t.inviter;if(t.hidden)i.hidden=t.hidden;if(t.no_notifications)i.no_notifications=t.no_notifications;if(t.ignore_if_attachments_supported)i.ignore_if_attachments_supported=t.ignore_if_attachments_supported;if(t.hidden||t.no_display)i.no_display=true;if(t.ignore_if_attachments_supported&&(!t.attachments||!t.attachments.length))i.no_display=true;if(t.edited)i.edited=t.edited;if(t.user)i.user=t.user;if(t.attachments)i.attachments=t.attachments;else if(TS.useReactMessages())i.attachments=void 0;if(t.img_vids)i.img_vids=t.img_vids;if(t.bot_profile)i.bot_profile=t.bot_profile;var s;if(t.imgs){i.img_vids=i.img_vids||{};var o;for(s in t.imgs){if(i.img_vids[s])continue;o=t.imgs[s];o.img_vid_type="img";i.img_vids[s]=o}}if(t.videos){i.img_vids=i.img_vids||{};var l;for(s in t.videos){if(i.img_vids[s])continue;l=t.videos[s];l.img_vid_type="video";i.img_vids[s]=l}}if(t.icons)i.icons=t.icons;if(t.bot_id)i.bot_id=t.bot_id;if(t.is_ephemeral)i.is_ephemeral=t.is_ephemeral;if(t._alert_even_though_temp)i._alert_even_though_temp=t._alert_even_though_temp;if(t.is_starred)i.is_starred=t.is_starred;if(t.reactions)delete t.reactions;if(t._rxn_key)i._rxn_key=t._rxn_key;if(t.pinned_to)i.pinned_to=t.pinned_to;if(t.topic)i.topic=t.topic;if(t.name)i.name=t.name;if(t.old_name)i.old_name=t.old_name;if(t.purpose)i.purpose=t.purpose;if(t.text){if(_.isString(t.text))i.text=t.text;else TS.error("ERROR: invalid imsg.text type: "+r(t.text)+" "+TS.utility.stringifyJSONOrElse(t.text,null,2,"(and it is not JSON.stringifiable)"));if(TS.boot_data.feature_parsed_mrkdwn)TS.utility.msgs.cacheFormatting(i)}if(TS.boot_data.feature_file_threads){if(t.upload)i.upload=true;if(t.file&&t.file.id){i.file=TS.files.getFileById(t.file.id);if(!t.file){TS.error("No file with id "+t.file.id+" for "+i.ts);i.no_display=true}}if(_.isArray(t.files)){var u=t.files.map(function(e){if(!e.id)return null;var r=TS.files.getFileById(e.id);if(!r){TS.error("No file with id "+t.file.id+" for "+i.ts);return null}return r});i.files=_.compact(u);if(_.isEmpty(i.files))i.no_display=true}}if(t.sound)i.sound=t.sound;if("mrkdwn"in t)i.mrkdwn=!!t.mrkdwn;if("hex_swatches"in t)i.hex_swatches=!!t.hex_swatches;if(t.dnd_suppressed)i.dnd_suppressed=t.dnd_suppressed;if(t.recap)i.recap=t.recap;if(t.alert_type)i.alert_type=t.alert_type;if(t.subtype){i.subtype=t.subtype;if("bot_message"===i.subtype)if(t.username)i.username=t.username;if("sh_room_created"===t.subtype||"sh_room_shared"===t.subtype)if(t._room_id)i._room_id=t._room_id;else if(t.room){var d=TS.rooms.getRoomById(t.room.id);if(d)i._room_id=d.id;else{TS.error("no room, no_display = true "+i.ts);i.no_display=true}}else i.no_display=true;if("file_share"===t.subtype||"file_mention"===t.subtype||"file_comment"===t.subtype){if(t.upload)i.upload=true;if(t.file){var c=TS.files.getFileById(t.file.id);if(c)i.file=c;else{TS.error("no file, no_display = true "+i.ts);i.no_display=true}}else i.no_display=true;if("file_comment"===t.subtype)if(t.comment)if(i.file)i.comment=TS.files.addCommentToFile(t.comment,i.file);else i.comment=t.comment;else i.no_display=true}if("pinned_item"===t.subtype){if(t.item_type)i.item_type=t.item_type;if("F"===t.item_type){if(t.item){var m=TS.files.getFileById(t.item.id);i.item=m}}else if("Fc"===t.item_type||"C"===t.item_type||"G"===t.item_type||"D"===t.item_type)i.item=t.item;i.no_display=true}}return i},cacheFormatting:function e(t){if(!t)throw new Error("Message object is required");t.cached_formatting=TSF.getTokensArray(t.text,"NORMAL",{jumbomoji:!!TS.prefs.getPref("jumbomoji"),allow_intra_word_formatting:TS.format.shouldAllowIntraWordFormatting()})},clearCachedFormatting:function e(t){if(!t)throw new Error("Message object is required");delete t.cached_formatting},maybeFetchUserDataFromLS:function e(t){if(!t){TS.warn("maybeFetchUserDataFromLS: WTF no model_ob?");return}if(a[t.id])return;if(!t.last_msg_input){t.last_msg_input=TS.storage.fetchLastMsgInput(t.id);t.has_draft=!!t.last_msg_input;if(t.last_msg_input&&TS.has_pri[l])TS.log(l,'Got last_msg_input for "'+t.id+'": length = '+(t.last_msg_input.length||"unknown"))}a[t.id]=true},processAttachments:function e(t){if(!t)return;var r;for(var n=0;n<t.length;n+=1){r=t[n];if(!r){TS.warn("attachment is null!");continue}if(r.slack_file_id&&!r._slack_file_is_deleted){var i=TS.files.getFileById(r.slack_file_id);if(i)r._slack_file=i;else if(r._slack_file)r._slack_file=TS.files.upsertFile(r._slack_file).file}if(r.mrkdwn_in&&_.isArray(r.mrkdwn_in)&&r.mrkdwn_in.length){r.mrkdwn_in_hash={};for(var a=0;a<r.mrkdwn_in.length;a+=1)r.mrkdwn_in_hash[r.mrkdwn_in[a]]=true}if(!r.mrkdwn_in_hash)r.mrkdwn_in_hash={};delete r.mrkdwn_in;r.hex_swatches=!!r.hex_swatches;if(r.audio_html||r.audio_url)TS.inline_audios.makeInternalInlineAudio(r.audio_html||r.audio_url,r);if(r.other_html)TS.inline_others.makeInternalInlineOther(r);else if(r.video_html){var s=r.video_html_width&&parseInt(r.video_html_width,10)>parseInt(r.thumb_width,10)?r.video_html_width:r.thumb_width;var o=r.video_html_height&&parseInt(r.video_html_height,10)>parseInt(r.thumb_height,10)?r.video_html_height:r.thumb_height;TS.inline_videos.makeInternalInlineVideo(r.from_url||r.thumb_url,{title:r.title,html:TS.utility.msgs.filterHTMLForEmbeds(r.video_html),thumbnail:{url:r.thumb_url,width:s,height:o,link_url:r.from_url||r.title_url}})}else if(r.image_url)TS.inline_imgs.makeInternalInlineImg(r.from_url||r.image_url,{src:r.image_url,width:r.image_width,height:r.image_height,link_url:r.from_url||r.title_url||r.image_url,bytes:r.image_bytes,rotation:r.rotation,content_type:r.content_type});TS.inline_attachments.massageAttachment(r,n)}},_slurpExtraData:function e(t,r){TS.utility.msgs.processAttachments(t.attachments);t._rxn_key=TS.rxns.getRxnKey("message",t.ts,r);if(t.reactions){TS.rxns.upsertRxnsFromDataAndUpdateUI(t._rxn_key,t.reactions);delete t.reactions}if(t.img_vids)_.forOwn(t.img_vids,function(e,t){if("img"===e.img_vid_type)TS.inline_imgs.makeInternalInlineImg(t,e);else if("video"===e.img_vid_type)TS.inline_videos.makeInternalInlineVideo(t,e)});if(t.imgs)_.forOwn(t.imgs,function(e,r){t.imgs[r].from_url=r;TS.inline_imgs.makeInternalInlineImg(r,e)});if(t.videos)_.forOwn(t.videos,function(e,r){t.videos[r].from_url=r;TS.inline_videos.makeInternalInlineVideo(r,e)});if(TS.boot_data.feature_file_threads){if(t.files)_.forEach(t.files,function(e){TS.files.upsertAndSignal(e)});if(t.file)TS.files.upsertAndSignal(t.file)}if("file_share"===t.subtype||"file_mention"===t.subtype||"file_comment"===t.subtype)if(t.file&&!t.file.id)TS.error("WTF no file id on file in imsg.subtype:"+t.subtype+" "+t.ts);else if(t.file){TS.files.upsertAndSignal(t.file);if("file_share"===t.subtype||"file_mention"===t.subtype);if("file_comment"===t.subtype)if(t.comment){var n=TS.files.getFileById(t.file.id);if(n)TS.files.addCommentToFile(t.comment,n);else TS.warn("WTF no file? id:"+t.file.id)}else TS.error("WTF no comment in imsg.subtype:"+t.subtype+" "+t.ts)}if("sh_room_created"===t.subtype||"sh_room_shared"===t.subtype)if(t.room&&!t.room.id)TS.error("WTF no room id on room in imsg.subtype:"+t.subtype+" "+t.ts);else if(t.room)TS.rooms.upsertAndSignal(t.room);else TS.error("WTF no room on imsg.subtype:"+t.subtype+" "+t.ts);if("pinned_item"===t.subtype)if("F"===t.item_type&&t.item&&t.item.id&&!t.item.is_deleted)TS.files.upsertAndSignal(t.item)},constructMsgPermalink:function e(t,r,n){if(!t)return"";var i;if(_.isString(t))i=t;else i=t.id;var a="/archives/"+i+"/p"+r.replace(".","");if(n&&n!==r)a+="?thread_ts="+n+"&cid="+i;return a},constructAbsoluteMsgPermalink:function e(t,r,n){var i=TS.boot_data.team_url.slice(0,-1)+TS.utility.msgs.constructMsgPermalink(t,r,n);return i},constructConversationPermalink:function e(t,r){var n;if(_.isString(t))n=t;else n=t.id;return"/conversation/"+n+"/p"+r.replace(".","")},isTempMsg:function e(t){return TS.utility.msgs.isTempTs(t.ts)},isTempTs:function e(t){return!t||t.indexOf(TS.utility.date.fake_ts_unique_padder)>-1},shouldMarkUnreadsOnMessageFetch:function e(t){if("1"==TS.qs_args.no_unread_marking_on_msgs_fetch)return false;var r;if(t){r=TS.shared.getActiveModelOb();if(!r||r.id!==t.id)return false}if(TS.pri&&r)TS.log(58,"shouldMarkUnreadsOnMessageFetch: returning TRUE for active model_ob of "+r.id);return true},ipsum:function e(){var e=["Build Something People Want","We know that we have built something which is genuinely useful: almost any team which adopts Slack as their central application for communication would be significantly better off than they were before.","That means we have something people want.","However, almost all of them have no idea that they want Slack.","How could they?","They’ve never heard of it.","And only a vanishingly small number will have imagined it on their own.","They think they want something different (if they think they want anything at all).","They definitely are not looking for Slack.","(But then no-one was looking for Post-it notes or GUIs either.)","Just as much as our job is to build something genuinely useful, something which really does make people’s working lives simpler, more pleasant and more productive, our job is also to understand what people think they want and then translate the value of Slack into their terms.","A good part of that is “just marketing,” but even the best slogans, ads, landing pages, PR campaigns, etc., will fall down if they are not supported by the experience people have when they hit our site, when they sign up for an account, when they first begin using the product and when they start using it day in, day out.","Therefore, “understanding what people think they want and then translating the value of Slack into their terms” is something we all work on.","It is the sum of the exercise of all our crafts.","We do it with copy accompanying signup forms, with fast-loading pages, with good welcome emails, with comprehensive and accurate search, with purposeful loading screens, and with thoughtfully implemented and well-functioning features of all kinds.","Marketing from Both Ends","Much has been written about “product-market fit” in the last few years, probably as a result of the popularity of the lean startup movement (though the idea has been around much longer).","The term refers to the degree to which a product could be successful, given sufficient promotion, appropriate pricing, adequate customer support and so on (before you find that fit, all the pushing in the world won’t get you up the hill).","In this classic post on Marc Andreessen’s old blog, he calls getting to product-market fit the “only thing that matters” for startups and offers a way of thinking about the life of the startup that divides it into two distinct phases: before product-market fit and after.","Once the product fits the market, a company is able to step on the gas, spending to promote a product that will actually sell.","The things you need to do before are very different from the things you need to do after (generally test & iterate vs scale & optimize).","We are right in the middle of that first phase.","It seems we are doing well and there are many encouraging signs, but we’re definitely still in the first phase and it is very, very hard to tell how far we have to go to cross over into the promised land (the last 10% is 90% of the work, etc.)","So, we should be working carefully from both the product end and the market end:","Doing a better and better job of providing what people want (whether they know it or not)","Communicating the above more and more effectively (so that they know they want it)","In the best case, there is a dialectic at play here: the product itself and the way people use it should suggest new ways of articulating the value — and refinements to how we communicate the value should lead to principles which clarify decision-making around product features and design.","Our position is different than the one many new companies find themselves in: we are not battling it out in a large, well-defined market with clear incumbents (which is why we can’t get away with “Other group chat products are poisonous. Slack is toasted.”).","Despite the fact that there are a handful of direct competitors and a muddled history of superficially similar tools, we are setting out to define a new market.","And that means we can’t limit ourselves to tweaking the product; we need to tweak the market too.","Sell the innovation, not the product","The best — maybe the only? — real, direct measure of “innovation” is change in human behaviour.","In fact, it is useful to take this way of thinking as definitional: innovation is the sum of change across the whole system, not a thing which causes a change in how people behave.","No small innovation ever caused a large shift in how people spend their time and no large one has ever failed to do so.","By that measure, Slack is a real and large innovation.","It is not as eye-catching as self-driving cars or implantable chips — it is not basic research-y kind of stuff.","But, for organizations that adopt it, there will be a dramatic shift in how time is spent, how communication happens, and how the team’s archives are utilized.","There will be changes in how team members relate to one another and, hopefully, significant changes in productivity.","We are unlikely to be able to sell “a group chat system” very well: there are just not enough people shopping for group chat system (and, as pointed out elsewhere, our current fax machine works fine).","That’s why what we’re selling is organizational transformation.","What we are selling is not the software product — the set of all the features, in their specific implementation — because there are just not many buyers for this software product.","(People buy “software” to address a need they already know they have or perform some specific task they need to perform, whether that is tracking sales contacts or editing video.)","However, if we are selling “a reduction in the cost of communication” or “zero effort knowledge management” or “making better decisions, faster” or “all your team communication, instantly searchable, available wherever you go” or “75% less email” or some other valuable result of adopting Slack, we will find many more buyers.","That’s why what we’re selling is organizational transformation.","The software just happens to be the part we’re able to build & ship (and the means for us to get our cut).","We’re selling a reduction in information overload, relief from stress, and a new ability to extract the enormous value of hitherto useless corporate archives.","We’re selling better organizations, better teams.","That’s a good thing for people to buy and it is a much better thing for us to sell in the long run.","We will be successful to the extent that we create better teams.","To see why, consider the hypothetical Acme Saddle Company.","They could just sell saddles, and if so, they’d probably be selling on the basis of things like the quality of the leather they use or the fancy adornments their saddles include; they could be selling on the range of styles and sizes available, or on durability, or on price.","Or, they could sell horseback riding.","Being successful at selling horseback riding means they grow the market for their product while giving the perfect context for talking about their saddles.","It lets them position themselves as the leader and affords them different kinds of marketing and promotion opportunities (e.g., sponsoring school programs to promote riding to kids, working on land conservation or trail maps).","It lets them think big and potentially be big.","Because the best possible way to find product-market fit is to define your own market.","This isn’t a new idea.","There are many brands whose marketing activities or positioning has them selling something other than (and usually larger than) their product: Harley Davidson sells motorcycle riding, but it especially sells freedom and independence.","Most luxury brands sell something that comes down to “being better than you are” (richer, better looking, more attractive to those you find desirable, etc.)","My favorite recent example is Lululemon: when they started, there was not a large market for yoga-specific athletic wear and accessories.","They sold yoga like crazy: helping people find yoga studios near their homes, hosting free classes, sponsorships and scholarships, local ambassadors and training, etc.","And as a result, they sold just under $1.4 billion worth of yoga-specific athletic wear and accessories in their most recent fiscal year.","But going back to the Acme Saddle Company, the better analogy to what we are doing now is to imagine them selling horseback riding … about 4,000 years ago.","It is almost inevitable that centralized internal communication systems will gradually replace email for most organizations over the next 10-20 years and we should do what we can to accelerate the trend and “own it”.","We are at the beginning of a transition.","We have an opportunity to both define the category and push hard for the whole market’s growth.","We’d be crazy not to take it, because the best possible way to find product-market fit is to define your own market."];return e},removeFileSharesAndMentions:function e(t,r){if(!TS.client)return;var n=t.msgs;var i;for(var a=n.length-1;a>-1;a-=1){i=n[a];if(("file_share"===i.subtype||"file_mention"===i.subtype)&&i.file&&i.file.id==r.id)if(t.is_mpim)TS.mpims.removeMsg(t.id,i);else if(t.is_group)TS.groups.removeMsg(t.id,i);else if(t.is_channel)TS.channels.removeMsg(t.id,i);else TS.ims.removeMsg(t.id,i)}},removeFileComments:function e(t,r){if(!TS.client)return;var n=t.msgs;var i;for(var a=n.length-1;a>-1;a-=1){i=n[a];if("file_comment"===i.subtype&&i.file&&i.file.id==r.id)if(t.is_mpim)TS.mpims.removeMsg(t.id,i);else if(t.is_group)TS.groups.removeMsg(t.id,i);else if(t.is_channel)TS.channels.removeMsg(t.id,i);else TS.ims.removeMsg(t.id,i)}},removeFileReferences:function e(t,r){if(!TS.client)return;var n=t.msgs;var i;for(var a=n.length-1;a>-1;a-=1){i=n[a];if(i.attachments){var s=TS.inline_attachments.getAttachmentBySlackFileId(i.attachments,r);if(s&&!s._slack_file_is_deleted){s._slack_file_is_deleted=true;delete s._slack_file;if(t.id==TS.model.active_im_id)TS.ims.message_changed_sig.dispatch(t,i);else if(t.id==TS.model.active_channel_id)TS.channels.message_changed_sig.dispatch(t,i);else if(t.id==TS.model.active_group_id)TS.groups.message_changed_sig.dispatch(t,i);else if(t.id==TS.model.active_mpim_id)TS.mpims.message_changed_sig.dispatch(t,i)}}}},updateFileMsgs:function e(t,r){var n=t.msgs;var i=!(n&&n.length)||TS.model.archive_view_is_showing&&t.is_channel&&false===t.is_member;n=i?t._archive_msgs:n;if(!n||!n.length)return;var a;var s=function e(t){if(!t)return false;if(!t.attachments)return false;if(!t.attachments.length)return false;if(TS.inline_attachments.getAttachmentBySlackFileId(t.attachments,r.id))return true;return false};for(var o=n.length-1;o>-1;o-=1){a=n[o];if(!r.is_deleted&&("file_share"===a.subtype||"file_mention"===a.subtype||"file_comment"===a.subtype)&&a.file&&a.file.id==r.id);else if(s(a));else continue;if(TS.useReduxFiles())a.file=_.assign({},r);if(!r.is_tombstoned){if("hosted"===r.mode||"external"===r.mode||"snippet"===r.mode)if(r.comments.length||!r.is_tombstoned){if(t.id==TS.model.active_im_id)TS.ims.message_changed_sig.dispatch(t,a);else if(t.id==TS.model.active_channel_id)TS.channels.message_changed_sig.dispatch(t,a);else if(t.id==TS.model.active_group_id)TS.groups.message_changed_sig.dispatch(t,a);else if(t.id==TS.model.active_mpim_id)TS.mpims.message_changed_sig.dispatch(t,a)}else continue;TS.view.rebuildMsgFile(a,r,i)}else if(t.id==TS.model.active_im_id)TS.ims.message_changed_sig.dispatch(t,a);else if(t.id==TS.model.active_channel_id)TS.channels.message_changed_sig.dispatch(t,a);else if(t.id==TS.model.active_group_id)TS.groups.message_changed_sig.dispatch(t,a);else if(t.id==TS.model.active_mpim_id)TS.mpims.message_changed_sig.dispatch(t,a)}},updateCommentReferences:function e(t){if(!t)return;var r=TS.shared.getAllModelObsForUser();_.forEach(r,function(e){_.forEach(e.msgs,function(e){if(!e.file||e.file.id!==t.id)return;if(!e.comment)return;var r=_.find(t.comments,{id:e.comment.id});if(r)e.comment=r})})},tryToEditLastMsgFromShortcut:function e(t){var r=TS.shared.getActiveModelOb();if(!r)return;var n;if(TS.useReactMessages())n=TS.redux.messages.getMessagesByChannelId(r.id);else n=r.msgs;var i=TS.utility.msgs.getEditableMsgByProp("user",TS.model.user.id,n);if(!i){TS.sounds.play("beep");alert(TS.i18n.t("Found no recent messages from you to edit :(","msgs")());return}var a=TS.format.unFormatMsg(i.text,i);var s=TS.utility.msgs.wordReplace(a,t);if(a==s){TS.sounds.play("beep");return}if(TS.useReactMessages())TS.redux.dispatch(TS.interop.redux.actions.saveMessageEdit({channelId:r.id,ts:i.ts,text:s}));else TS.msg_edit.commitEdit(i,r,s)},getEditLastShortcutCmd:function e(t){var r=t.split("/");if(5!=r.length&&4!=r.length)return;if("s"!==r[1])return;var n=r[2];var i=r[3];var a=5==r.length&&("g"===r[4]||"gi"===r[4]||"ig"===r[4]);var s=5==r.length&&("i"===r[4]||"gi"===r[4]||"ig"===r[4]);if(!n)return;return{str:n,rpl:i,g:a,i:s}},wordReplace:function e(t,r){if(!r)return t;var n=(r.g?"g":"")+(r.i?"i":"");var i="[\\s\\n\\r\\t.,'\"+!?\\-_|]";var a=TS.utility.regexpEscape(r.str);var s=new RegExp("(^|"+i+"+)(?:"+a+")(?="+i+"+|$)",n);return t.replace(s,"$1"+r.rpl)},maybeTruncateMsgs:function e(t){if(!t)return;if(!t.msgs)return;if(!t.msgs.length)return;if(!TS.model.active_cid||!TS.shared.getActiveModelOb())return;var r=TS.model.initial_msgs_cnt+1;var n=Math.min(TS.model.hard_msg_limit,2*r);var i=1e3;var a=0;var s=2e4;var o=t.msgs;var l=TS.utility.msgs.getDisplayedMsgs(o);var u=Date.now();var d=t.has_fetched_history_after_scrollback?u-t.fetched_history_after_scrollback_time:u;if(l.length>n&&(t.id!=TS.shared.getActiveModelOb().id||t.scroll_top<i&&d>s))r=n;else{if(l.length-50<=r)return;if(t.last_made_active){var _=u-t.last_made_active;if(_<a)return}if(-1!=t.scroll_top)return}if(t.history_is_being_fetched)return;var c=[];while(TS.utility.msgs.getDisplayedMsgs(o).length>r)c.push(o.pop());if(t.is_limited){TS.info("Truncated "+t.id+" and reset is_limited");t.is_limited=false}if(t.id==TS.shared.getActiveModelOb().id)TS.view.removeMsgsAfterTruncation(c)},checkForMsgsToTruncate:function e(){if(!TS.model)return;if(!TS.model.channels)return;var t=TS.model.channels;var r;var n;for(n=0;n<t.length;n+=1){r=t[n];if(r.id==TS.model.active_channel_id)continue;if(!r.is_member)continue;if(r.is_archived)continue;TS.utility.msgs.maybeTruncateMsgs(r)}var i=TS.model.ims;var a;for(n=0;n<i.length;n+=1){a=i[n];if(a.id==TS.model.active_im_id)continue;TS.utility.msgs.maybeTruncateMsgs(a)}var s=TS.model.groups;var o;for(n=0;n<s.length;n+=1){o=s[n];if(o.id==TS.model.active_group_id)continue;if(o.is_archived)continue;TS.utility.msgs.maybeTruncateMsgs(o)}var l=TS.model.mpims;var u;for(n=0;n<l.length;n+=1){u=l[n];if(u.id==TS.model.active_mpim_id)continue;TS.utility.msgs.maybeTruncateMsgs(u)}},getEphemeralMsgsByCidAndType:function e(t,r){var n;var i=[];var a=TS.shared.getModelObById(t);if(!a)return i;if(TS.useReactMessages())i=TS.redux.messages.getMessagesByProp(t,{_ephemeral_type:r});_.forOwn(TS.utility.msgs.ephemeral_msgs_map,function(e,s){if(e.ephemeral_type==r&&e.c_id==t){n=TS.utility.msgs.getMsg(s,a.msgs);if(!n)return;i.push(n)}});return i},removeAllEphemeralMsgsByType:function e(t,r,n){if(TS.useReactMessages()&&!n){var i=TS.redux.messages.getMessagesByProp(r,{_ephemeral_type:t});_.forEach(i,function(e){var t=TS.shared.getModelObById(e.channel);if(!t)return;var r=TS.shared.getControllerForModelOb(t);r.removeMsg(t.id,e)});return}var a;var s;_.forOwn(TS.utility.msgs.ephemeral_msgs_map,function(e,i){if(e.ephemeral_type==t){if(r&&r!=e.c_id)return;if(n&&n!=e.thread_ts)return;a=TS.shared.getModelObById(e.c_id);if(!a)return;s=TS.utility.msgs.getMsg(i,a.msgs);if(!s)return;if(a.is_im)TS.ims.removeMsg(a.id,s);else if(a.is_mpim)TS.mpims.removeMsg(a.id,s);else if(a.is_channel)TS.channels.removeMsg(a.id,s);else if(a.is_group)TS.groups.removeMsg(a.id,s);delete TS.utility.msgs.ephemeral_msgs_map[i]}})},hasImgs:function e(t){if(!t)return false;if(t.img_vids)_.forOwn(t.img_vids,function(e){if("img"===e.img_vid_type)return true});else if(t.attachments)for(var r=0;r<t.attachments.length;r+=1)if(t.attachments[r].image_url)return true;return false},ingestMessagesFromBootData:function e(t){if(!TS.boot_data.msgs)return;var r=TS.boot_data.msgs[t.id];var n=[];if(r){var i;for(var a=0;a<r.length;a+=1){i=r[a];if(!i.ts)continue;n.push(TS.utility.msgs.processImsg(i,t.id))}}TS.utility.msgs.setMsgs(t,n)},handleSearchHighlights:function e(t){return TS.format.replaceHighlightMarkers(t,'<span class="match">',"</span>")},findAllMsgsBySubtype:function e(t){var r;var n;var i;var a=TS.shared.getAllModelObsForUser();var s={};for(r=0;r<a.length;r+=1){i=a[r];if(!i.msgs)continue;for(n=0;n<i.msgs.length;n+=1){if(t!=i.msgs[n].subtype)continue;s[i.name]=s[i.name]||{id:i.id};s[i.name]["msg_index_"+n]=i.msgs[n]}}TS.info(JSON.stringify(s,null,"\t"))},handleFailedMsgSend:function e(t,r,n){var i=TS.utility.msgs.getMsg(t,r.msgs);if(TS.useReactMessages())i=TS.utility.msgs.findMsg(t,r.id);if(i){var a;var s;if(n&&i.thread_ts){a=TS.utility.msgs.findMsg(i.thread_ts,r.id);s=i._was_reply_broadcast}if(r.is_mpim){TS.mpims.removeMsg(r.id,i);if(n)TS.mpims.sendMsg(r.id,TS.format.unFormatMsg(i.text,i),a,s)}else if(r.is_channel){TS.channels.removeMsg(r.id,i);if(n)TS.channels.sendMsg(r.id,TS.format.unFormatMsg(i.text,i),a,s)}else if(r.is_group){TS.groups.removeMsg(r.id,i);if(n)TS.groups.sendMsg(r.id,TS.format.unFormatMsg(i.text,i),a,s)}else{TS.ims.removeMsg(r.id,i);if(n)TS.ims.sendMsg(r.id,TS.format.unFormatMsg(i.text,i),a,s)}delete TS.model.unsent_msgs[i.ts];delete TS.model.display_unsent_msgs[i.ts]}else TS.error("no msg?: "+t)},msgMightBeRolledUp:function e(t){return t.subtype&&-1!=TS.model.join_leave_subtypes.indexOf(t.subtype)},msgRollUpWorker:function e(t,r,n,i){delete r._jl_rollup_hash;delete r._jl_rolled_up_in;if(!TS.utility.msgs.msgMightBeRolledUp(r))return;i.push(r);if(0!==t&&TS.utility.msgs.msgMightBeRolledUp(n[t-1]))return"continue";i[0]._jl_rollup_hash={msg_ids:[],users:{}};var a=i[0]._jl_rollup_hash;var s;for(var o=0;o<i.length;o+=1){s=i[o];a.users[s.user]=a.users[s.user]||{};var l=a.users[s.user];a.msg_ids.push(s.ts);s._jl_rolled_up_in=i[0].ts;if("channel_join"===s.subtype||"group_join"===s.subtype){l.inviter=s.inviter;l.joined=true;l.is_in=true}else if("channel_leave"===s.subtype||"group_leave"===s.subtype){l.left=true;l.is_in=false}}return"swap"},shouldHaveBotLabel:function e(t,r){var n=t.subtype&&"bot_message"===t.subtype&&"USLACKBOT"!==t.user;var i=r&&r.is_bot&&!r.is_slackbot;return n||i},checkConsistencyViaApi:function e(t){if(!TS.boot_data.feature_msg_consistency)return;if(!TS.redux.socket.isConnected())return;var r=TS.shared.getModelObById(t);if(!r||!r.msgs||!r.msgs.length)return;if(r.is_archived)return;if(r.history_is_being_fetched)return;if(r._consistency_has_been_checked)return;if(r._consistency_is_being_checked)return;var n=TS.utility.msgs.getOldestValidTs(r);if(!n)return;var a=TS.utility.msgs.getMostRecentValidTs(r);var s="checkConsistencyViaApi for: "+t;r._consistency_is_being_checked=true;var o={channel:r.id,oldest:n,count:1e3,inclusive:true,ignore_replies:true,include_pin_count:true};if(a)o.latest=a;if(TS.has_pri[u])TS.log(u,s+", range = "+o.oldest+" -> "+(o.latest||"now"));var l=TS.boot_data.feature_trace_reason?TS.console.getStackTrace().replace(/(\(?http.*\)?)|at|Array|Object/g,"").trim().substring(0,200):"";if(l)o._x_reason=l;TS.api.call("conversations.history",o).then(function(e){var n=TS.utility.msgs.checkConsistency(t,e.data.messages);if(n){i+=1;TS.metrics.store("inconsistent_history_cnt",i,{is_count:true});TS.error(s+" NOT GOOD!")}else{r._consistency_has_been_checked=true;if(TS.has_pri[u])TS.log(u,s+" all good!")}}).catch(function(e){TS.error(s+" err:"+e)}).finally(function(){r._consistency_is_being_checked=false})},checkConsistency:function e(t,r){var n=TS.shared.getModelObById(t);if(!n||!n.msgs||!n.msgs.length)return;var i=[];var a="checkConsistency for: "+t;if(TS.has_pri[u])TS.log(u,a+" from_msgs.length:"+r.length+" model_ob.msgs.length:"+n.msgs.length);r.forEach(function(e,r){if(!TS.utility.msgs.getMsg(e.ts,n.msgs)){e=TS.utility.msgs.processImsg(e,t);i.push(e);TS.error(a+" found and fixed an inconsistency at i:"+r+", ts="+e.ts)}});if(!i.length)return false;if(1==i.length){if(n.is_mpim)TS.mpims.addMsg(t,i[0]);else if(n.is_group)TS.groups.addMsg(t,i[0]);else if(n.is_im)TS.ims.addMsg(t,i[0]);else if(n.is_channel)TS.channels.addMsg(t,i[0])}else TS.shared.addMsgs(n,i);return true},filterHTMLForEmbeds:function e(r){if(!r)return r;var i;var a=new DOMParser;var s=a.parseFromString(r,"text/html")||a.parseFromString(r,"text/xml");var o="";var l;if(s)l=$(s.body);if(!l)return r;if(l){i=l.find(n);if(i.length)o=TS.utility.sanitizeHTML(i.first()[0].outerHTML,t,TS.utility.msgs.allowed_embed_attributes)}a=null;s=null;l=null;i=null;return o},areMsgsSameDay:function e(t,r){var n=TS.interop.datetime.toDateObject(t.ts);var i=TS.interop.datetime.toDateObject(r.ts);return TS.interop.datetime.isSameDay(n,i)},maybeCalcUnreadCnts:function e(t){if(!TS.client||!TS.client._should_defer_initial_msg_history)return;if(!t){TS.warn("maybeCalcUnreadCnts: WTF no model_ob?");return}if(t._needs_unread_recalc&&1==t.unread_cnt){var r=TS.shared.getControllerForModelOb(t);if(!r){TS.warn("maybeCalcUnreadCnts: WTF no controller for id "+t.id+"?");return}var n=false;r.calcUnreadCnts(t,n);t._needs_unread_recalc=false}},maybeSetPrevLastRead:function e(t,r){if(!t)return;var n=TS.utility.msgs.getMostRecentValidTs(t);if(r!=n)TS.utility.msgs.setPrevLastRead(t,r);else TS.utility.msgs.setPrevLastRead(t,t.last_read)},setPrevLastRead:function e(t,r){if(!t)return;if(!t._prev_last_read&&t.unread_cnt&&!TS.notifs.isCorGMuted(t.id))t._prev_last_read=r;else{var n=TS.utility.msgs.getMostRecentValidTs(t);var i=TS.utility.msgs.getMsg(n,t.msgs);if(i&&"pinned_item"===i.subtype)t._prev_last_read=r}},maybeClearPrevLastRead:function e(t){t=t||TS.shared.getActiveModelOb();if(t&&t._prev_last_read)t._prev_last_read=void 0},maybeClearUsersCountsInfo:function e(t){if(!t)return;if(!TS.shared.getUserCountsInfoById(t.id))return;if(TS.has_pri[d])TS.log(d,"Deleting users_counts_info for "+t.id);TS.shared.deleteUserCountsInfoForId(t.id)},isMsgReply:function e(t){if(!t)return false;return t.thread_ts&&t.thread_ts!=t.ts},msgHasReplies:function e(t){if(!t)return false;return t.ts===t.thread_ts&&!!t.reply_count},startUpdatingRelativeTimestamps:function e(t){s.start(t)},stopUpdatingRelativeTimestamps:function e(t){s.stop(t)},shouldHideChannelJoinOrLeaveMsg:function e(t,r){if(!TS.boot_data.feature_hide_join_leave)return false;var n=TS.members.getMemberById(t.user);var i=_.get(n,"is_bot",false);if("channel_join"===t.subtype||"member_joined_channel"===t.type){var a=_.isObject(r)?r:TS.channels.getChannelById(r);if(!a)return false;var s=_.includes(TS.prefs.getTeamPref("default_channels"),a.id);var o=!!t.inviter;var l=a.num_members;if(_.isUndefined(a.num_members)){var u=TS.membership&&TS.membership.getMembershipCounts(a);if(u.counts)l=_.get(u,"counts.member_count")}var d=_.isUndefined(l)?false:l>20;if(!i&&!s&&!o&&d)return true}else if("channel_leave"===t.subtype||"member_left_channel"===t.type)if(!i)return true;return false},extractMsgDisplayContext:function e(t){var r=t.closest("#unread_msgs_div, #sli_briefing");if(r.is("#unread_msgs_div"))return"all_unreads";if(r.is("#sli_briefing"))return"briefing";return null},extractLinkType:function e(t,r,n){if(r.data("member-id")||t.data("member-id"))return"user";if(r.data("channel-id")||t.data("channel-id"))return"channel";if(r.data("file-id")||t.data("file-id"))return"file";if(n&&n.match(/\.slack\.com\/archives\//))return"message";var i=n&&!TS.interop.url.getHostName(n).match(/\.slack\.com/);if(i)return"external";return"internal"},extractLinkItemId:function e(t,r,n){if("user"===n)return r.data("member-id")||t.data("member-id");if("channel"===n)return r.data("channel-id")||t.data("channel-id");if("file"===n)return r.data("file-id")||t.data("file-id");return null},extractLinkAction:function e(t,r){if(r.hasClass("file_preview_action")){if(r.hasClass("file_ssb_download_link"))return"file_ssb_download_link";else if(r.hasClass("file_new_window_link"))return"file_new_window_link";else if(r.hasClass("file_comment_link"))return"file_comment_link";return"file_preview_action"}if(t.hasClass("file_viewer_external_link"))return"file_viewer_external_link";if(t.hasClass("file_viewer_link"))return"file_viewer_link";if(r.hasClass("file_preview_link"))return"file_preview_link";if(r.hasClass("file_header"))return"file_header";if(r.parent()&&r.parent().hasClass("rest_text_expander"))return"rest_text_expander";return null},extractLinkAttachmentField:function e(t){var r=t.parent();if(t.hasClass("btn_attachment_link"))return"attachment_link_button";if(r.hasClass("attachment_source_icon"))return"attachment_source_icon";if(r.hasClass("attachment_source_name"))return"attachment_source_name";if(r.hasClass("attachment_author_name"))return"attachment_author_name";if(r.hasClass("attachment_title"))return"attachment_title";return null},isRawLink:function e(t,r){if(!t||!r)return false;if(!t.is("a"))return false;var n=r.replace(/(^\w+:|^)\/\//,"");return t.text()===r||t.text()===n},charsOverLimit:function e(t,r){if(!_.isNumber(r))r=TS.interop.constants.MAX_MESSAGE_INPUT_BYTES;if(t.length<=r/4)return 0;var n=0;var i=[];var a=0;for(var s=0;s<t.length;s++){var o=t.charCodeAt(s);if(o<55296||o>57343){i.push(o);n+=TS.utility.bytesInUnicodeCodePoint(o)}if(o>=56320&&o<=57343){i.push(65533);n+=1}if(o>=55296&&o<=56319)if(s==t.length-1){i.push(65533);n+=1}else{var l=t.charCodeAt(s+1);if(l>=56320&&l<=57343){var u=1023&o;var d=1023&l;var c=66560+u+d;i.push(c);n+=TS.utility.bytesInUnicodeCodePoint(c);s+=1}else{i.push(65533);n+=1}}if(n<=r)a=i.length}return i.length-a},getUnreadMsgTimestampsWithoutHighlights:function e(t){if(!t||!t.unread_cnt)return[];var r=parseFloat(t.last_read);return _.reduce(t.msgs,function(e,n){if(parseFloat(n.ts)>r&&!TS.client.highlights.msgIsHighlight(t.id,n.ts)&&!TS.client.highlights.isMsgBeingRequested(t.id,n.ts))e[n.ts]=true;return e},{})},shouldSendSlashCommand:function e(t){if("/"===t.substr(0,1)&&"//"!==t.substr(0,2))return true;if("／"===t.substr(0,1))return true;return false}});var e=false;var t=["video","iframe","source"];var n=t.join(",");var i=0;var a={};var s=function(){var e=null;var t=[];function r(r){if(_.includes(t,r))return;t.push(r);if(null===e)e=setInterval(i,6e4)}function n(r){_.pull(t,r);if(!t.length){clearInterval(e);e=null}}function i(){_.forEach(t,function(e){$(e).find(".relative_ts").each(function(){var e=$(this).attr("data-ts");var t=$(this).data("really-short");var r=TS.interop.datetime.toTimeAgo(e,{compact:t});if(r!==$(this).text())$(this).text(r)})})}return{start:r,stop:n}}();var o=67;var l=667;var u=773;var d=888})()},4799:function(e,t){(function(){TS.registerModule("utility.members",{checkMemberMatch:function e(t,r,n){return!n&&t.profile&&t.profile.email&&t.profile.email.match(r)||t.profile&&t.profile.real_name_normalized&&t.profile.real_name_normalized.match(r)||t.profile&&t.profile.real_name&&t.profile.real_name.match(r)||t.profile&&t.profile.display_name_normalized&&t.profile.display_name_normalized.match(r)||t.profile&&t.profile.display_name&&t.profile.display_name.match(r)},filterMembersByQuery:function e(t,r){r=_.toString(r).trim().toLowerCase().replace(/^@/,"");if(!r)return t;var n=new RegExp(TS.utility.regexpEscape(r),"i");return t.filter(function(e){return TS.utility.members.checkMemberMatch(e,n)})},getBroadcastKeywordsForUser:function e(){var t=TS.shared.getActiveModelOb();if(!t)return[];var r=[];var n=[];var i=TS.boot_data.page_needs_enterprise&&TS.channels.isChannelRequired(t)&&TS.shared.isModelObOrgShared(t);if(t.is_general&&TS.permissions.members.canAtMentionEveryone(t.id)&&!i)r=_.filter(TS.model.BROADCAST_KEYWORDS,function(e){return"BKeveryone"===e.id||"BKall"===e.id});if(TS.permissions.members.canAtChannelOrGroup(t.id)&&(t.is_channel||t.is_group)&&(!t.is_general||TS.permissions.members.canAtMentionEveryone(t.id))&&!i)n=_.filter(TS.model.BROADCAST_KEYWORDS,function(e){return"BKchannel"===e.id||"BKgroup"===e.id||"BKhere"===e.id});return r.concat(n)},isMember:function e(t){var r=_.get(t,"id[0]");return"U"===r||"W"===r},isMemberRelevantToModel:function e(t,r){if(!_.isObject(t))t=TS.members.getMemberById(t);if(!t)return false;if(t.is_slackbot)return true;if(t.deleted)return false;if(!_.isObject(r))r=TS.shared.getModelObById(r)||TS.shared.getActiveModelOb();return true},isMemberElement:function e(t){if(t.hasAttribute("data-member-id"))return true;if(t.classList.contains("internal_member_link"))return true;return false},isMemberNonBotNonDeletedNonSelf:function e(t){var r=t&&!t.deleted&&!t.is_bot&&!t.is_slackbot;return r&&!t.is_self},getEntityFromMessage:function e(t){if(!t)return false;var r;if("USLACKBOT"===t.user&&t.file&&t.file.bot_id)r=TS.utility.members.getEntityFromFile(t.file);else r=t.comment?TS.members.getPotentiallyUnknownMemberById(t.comment.user):TS.members.getPotentiallyUnknownMemberById(t.user);return r},getUsernamesMentionedInString:function e(t){var r=_.toLower(t).match(/\B@\w+/g);if(!r)return[];return _(r).map(function(e){return e.replace(/^@/,"")}).uniq().compact().value()},getEntityFromFile:function e(t){if(!t)return false;var r;if("USLACKBOT"===t.user&&t.bot_id){r=TS.bots.getBotById(t.bot_id);if(!r)r={};r.is_bot=true;r.is_service=true}else r=TS.members.getPotentiallyUnknownMemberById(t.user);return r}})})()},4800:function(e,t){(function(){TS.registerModule("format",{hex_rx:/(\W|^)(#[A-Fa-f0-9]{6})(\b)/g,onStart:function e(){n()},replaceUnicodeDoppelgangers:function e(t){if(!t)return"";t=t.replace(/\u00A0/g," ");t=t.replace(/\u000D/g,"\n");t=t.replace(/\u000A/g,"\n");return t},replaceHighlightMarkers:function e(t,r,n){if(!t)return"";r=r||"";n=n||"";return t.replace(/\ue000/g,r).replace(/\ue001/g,n)},hasOnlyValidMemberIds:function e(t){if(!_.isString(t))return true;return _.every(t.match(a),TS.members.getMemberById)},cleanMsg:function e(t){return H(t,{do_specials:true})},cleanInternalMsg:function e(t){return H(t,{do_specials:false})},cleanForLanguageIdentifier:function e(t){var r="";var n=TS.format.texty.convertContentsStringToContents(t);r=_.reduce(n.contents,function(e,t){if(t.attributes&&t.attributes.slackmention)return e;if(t.insert&&t.insert.slackemoji)return e;return e+t.insert},"");r=r.replace(TS.emoji.getColonsRx(),"");r=r.replace(s,"");var i=TSF.getTokensArray(r,"NORMAL");var a=false;r=_.reduce(i,function(e,t){if(-1!==["<I:START>","<B:START>","<STRIKE:START>","<I:END>","<B:END>","<STRIKE:END>","<QUOTE:PREFIX>","<QUOTE:START>","<QUOTE:END>","<LONGQUOTE:PREFIX>"].indexOf(t))return e;if("<HEX:BLOCK"===t.substr(0,10))return e;if("<SPACE:HARD>"===t)return e+" ";if("<LINE:BREAK>"===t)return e+"\n";if("<PARA:BREAK>"===t)return e+"\n\n";if(-1!==["<CODE:START>","<PRE:START>"].indexOf(t)||"<LINK:START"===t.substr(0,11)){a=true;return e}if(-1!==["<CODE:END>","<PRE:END>"].indexOf(t)||"<LINK:END"===t.substr(0,9)){a=false;return e}return a?e:e+t});return r},doEmoticonConversion:function e(t){f.length=0;t=t.replace(o,v);t=t.replace(l,v);t=t.replace(u,v);t=TS.emoji.replaceEmoticons(t);t=TS.format.deTokenizeStr(f,t);return t},tokenizeStr:function e(t,r,n){if(!r)return"";n=n||"";var i=0===r.indexOf("\n")?"\n":"";var a=w(i+h+(p+=1)+Date.now());a=n+a+n;t.push({str:r,token:a});return a},deTokenizeStr:function e(t,r){var n;var i=t.length-1;for(i;i>-1;i-=1){n=t[i];r=r.replace(n.token,n.str.replace(/\$/g,"$$$$"))}return r},unFormatMsg:function e(t,r){return TS.format.formatWithOptions(t,r,{for_edit:true})},formatJustText:function e(t){return TS.format.formatWithOptions(t)},formatDefault:function e(t,r){return TS.format.formatWithOptions(t,r)},formatNoHighlightsNoSpecials:function e(t,r){return TS.format.formatWithOptions(t,r,{no_highlights:true,no_specials:true})},formatNoHighlightsNoSpecialsNoInlineImgs:function e(t,r){return TS.format.formatWithOptions(t,r,{no_highlights:true,no_specials:true,do_inline_imgs:false})},formatNoHighlightsNoInlineImgs:function e(t,r){return TS.format.formatWithOptions(t,r,{do_inline_imgs:false,no_highlights:true})},formatNoSpecials:function e(t,r){return TS.format.formatWithOptions(t,r,{no_specials:true})},formatNotification:function e(t,r){return TS.format.formatWithOptions(t,r,{for_growl:true})},formatCurrentStatus:function e(t,r,n){n=n||{};return TS.format.formatWithOptions(t,r,_.assign({no_jumbomoji:true,no_linking:true,no_specials:true,no_highlights:true,no_emoji_text:true,prevent_copy_paste:true},n))},formatBroadcastExcerpt:function e(t,r){var n="&hellip;<br>";var i=n+'<span class="multiline_block">';var a="</span>";var s=TS.format.formatWithOptions(t,r,{no_highlights:true,no_hex_colors:true,do_inline_imgs:false,enable_slack_action_links:false,do_theme_install_buttons:false,no_jumbomoji:true,no_linking:true,custom_linebreak:n,token_overrides:{"<PRE:START>":i,"<PRE:END>":a,"<QUOTE:START>":i,"<QUOTE:END>":a,"<CODE:START>":"<span>","<CODE:END>":"</span>","<PARA:BREAK>":n}});if(_.startsWith(s,n))s=s.substring(n.length);return s},extractIds:function e(t){var r=[];var n=[];var i=t.match(/<[#@]+(.*?)>/g);if(i)i.forEach(function(e){var t;var i;if(0===e.indexOf("<@")){t=e.replace(/<|>/g,"");i=TS.utility.msgs.getMemberIdFromMemberMarkup(t);if(TS.interop.utility.looksLikeMemberId(i))TS.utility.ensureInArray(n,i)}else{t=e.replace(/<|>|#/g,"");i=t.split("|")[0];if(TS.interop.utility.looksLikeChannelId(i))TS.utility.ensureInArray(r,i)}});return{c_ids:r,m_ids:n}},calculateOptions:function e(t,r){return k(t,r)},formatWithOptions:function e(t,r,n){if(!$.trim(t))return"";var i=k(r,n);var a=x(t,r,i);return a},applyStringifyTransformsToChildren:function e(t,r){if(!t)return false;if(!_.isObject(r))r={};if(!t.childElementCount)return false;var n=1===t.childNodes.length&&1===t.firstChild.nodeType&&t.firstChild.hasAttribute("data-stringify-requires-siblings");if(n)return;if("PRE"!==t.tagName)_.each(t.querySelectorAll("pre br"),function(e){e.parentElement.replaceChild(document.createTextNode("\n"),e)});var i=_.filter(t.querySelectorAll("*"),function(e){if(!R(e))return false;if(_.isFunction(r.excludeFn)&&r.excludeFn(e))return false;var t;if(_.isFunction(r.customFn)&&r.customFn(e))t=r.customFn(e);else t=TS.format.stringifyNode(e);var n=t!==e.textContent;if(n)e.textContent=t;return n});return i.length>0},formatSelection:function e(t,r){if(!t||!t.rangeCount)return;if(!_.isObject(r))r={};var n=TS.selection.combineRanges(t);if(!n)return;var i;if(_.isElement(n.commonAncestorContainer)){if($(n.commonAncestorContainer).is(".ql-editor"))return t.toString();if(TS.model.is_safari_desktop){var a=n.commonAncestorContainer.querySelectorAll("ts-message");if(a.length>1)return}var s=n.commonAncestorContainer.cloneNode();s.appendChild(n.cloneContents());s.classList.add("offscreen","user_select_text");n.commonAncestorContainer.parentElement.appendChild(s);var o="\ufeff";s.innerHTML=s.innerHTML.replace(/&nbsp;/g,o);if(s.lastChild&&!s.lastChild.textContent)s.removeChild(s.lastChild);var l=s.getElementsByClassName("para_break");if(l.length){_.eachRight(l,function(e){var t=document.createElement("br");e.parentElement.replaceChild(t,e);var r=document.createElement("br");t.parentElement.insertBefore(r,t.nextSibling)});s.innerHTML=s.innerHTML.replace(/<br>((<br>){2,})/g,"$1")}_.each(s.getElementsByClassName("ts_tip_tip"),function(e){if(e&&e.parentNode)e.parentNode.removeChild(e)});TS.format.applyStringifyTransformsToChildren(s,r);var u=TS.selection.snapshot();t=TS.selection.selectNodeContents(s);i=t.toString();var d=new RegExp(o,"g");i=i.replace(/ {2}/g," ").replace(d," ");s.parentElement.removeChild(s);u()}else i=t.toString();i=TS.format.replaceUnicodeDoppelgangers(i);i=i.replace(/^\n+/,"");i=i.replace(/\n+$/,"");return i},formatSelectionAsHTML:function e(t){if(!t||!t.rangeCount)return"";if(1!==t.rangeCount)TS.info("TS.format.formatSelection: found "+t.rangeCount+" ranges");var r=t.getRangeAt(0);var n=document.createElement("div");n.appendChild(r.cloneContents());return n.innerHTML.replace(/^<p><\/p>/,"<p><br></p>")},stringifyNode:function e(t){if(!t)return"";if(!R(t))return t.textContent;var r=t.textContent;_.each(d,function(e,n){if(t.hasAttribute(n))r=e(t,r)});return r},shouldAllowIntraWordFormatting:function e(){return TS.boot_data.feature_allow_intra_word_formatting&&TS.boot_data.feature_locale_ja_JP},swapInAts:function e(t){if(!t)return t;return t.replace(new RegExp(g,"g"),"@").replace(new RegExp(S,"g"),"-").replace(new RegExp(T,"g"),"_")},swapOutAts:function e(t){if(!t)return t;return t.replace(/@/g,g).replace(/-/g,S).replace(/_/g,T)},test:function e(){var t={encodeSpecialFormattingChars:y,encodeSpecialFormattingCharsAndColon:w,getTokenMap:c};Object.defineProperty(t,"_hasStringifyTransformations",{get:function e(){return R},set:function e(t){R=t}});return t}});var e=[];var t=[];var r={};var n=function n(){TS.model.BROADCAST_KEYWORDS.forEach(function(n){e.push(n.ms_name);r[n.ms_name]=n.name;t.push({regex:new RegExp("^@("+n.name+"|"+TS.interop.I18n.deburr(n.name)+")[.|\\-|_]*$"),cmd:n.cmd,name:"!"+n.name});if(n.ms_name!==n.name)t.push({regex:new RegExp("^@"+n.ms_name+"[.|\\-|_]*$"),cmd:n.cmd,name:"!"+n.ms_name});if(n.alias){e.push(n.alias);t.push({regex:new RegExp("^@"+n.alias+"[.|\\-|_]*$"),cmd:"<!"+n.alias+">",name:"!"+n.alias})}})};var i=/((?:#[A-Fa-f0-9]{6} {0,}, {0,}){7})(#[A-Fa-f0-9]{6})(\b)/g;var a=/(^|\s|\{|\[|\(|&gt;|&lt;|\*|_|\/|"|“|‘|')(@([\w|.|-]+))/g;if(TS.boot_data.feature_localization)a=/(^|\s|\{|\[|\(|&gt;|&lt;|\*|_|\/|"|“|‘|')(@([^~`!@#$%^&*()+=[\]{}\\|;:'"”’,<>/?\s]+))/g;var s=/(^|\s|\{|\[|\(|&gt;|&lt;|\*|_|\/|"|“|‘|')(#([^~`!@#$%^&*()+=[\]{}\\|;:'"”’,.<>/?\s]+))/g;var o=/(^|\s|[_*?.,\-!^;:{([%$#+=\u2000-\u206F\u2E00-\u2E7F"])```([\s\S]*?)?```(?=$|\s|[_*?.,\-!^;:})\]%$#+=\u2000-\u206F\u2E00-\u2E7F…"])/g;var l=/(^|\s|[?.,\-!^;:{([%$#+=\u2000-\u206F\u2E00-\u2E7F"])`([^`]*?\S *)?`/g;var u=/(^|\n)&gt;(?![\W_](?:&lt;|&gt;|[|/\\[\]{}()Dpb](?=\s|$)))(([^\n]*)(\n&gt;[^\n]*)*)/g;var d={"data-stringify-text":function e(t){return t.getAttribute("data-stringify-text")},"data-stringify-prefix":function e(t,r){return t.getAttribute("data-stringify-prefix")+r},"data-stringify-suffix":function e(t,r){return r+t.getAttribute("data-stringify-suffix")}};var c=function e(){var t={"<QUOTE:START>":'<div class="special_formatting_quote"><div class="quote_bar"><div class="shim"></div></div><div class="content dynamic_content_max_width">',"<QUOTE:PREFIX>":'<span class="copyonly">&gt;</span>',"<LONGQUOTE:PREFIX>":'<span class="copyonly">&gt;&gt;&gt;</span>',"<QUOTE:END>":"</div></div>","<LINK:END>":"</a>","<LINE:BREAK>":"<br>","<PARA:BREAK>":'<span class="para_break"><i class="copy_only"><br></i></span>',"<SPACE:HARD>":"&nbsp;"};var r="ja-JP"===TS.i18n.locale()?"＊":"*";var n="ja-JP"===TS.i18n.locale()?"＿":"_";var i="ja-JP"===TS.i18n.locale()?"｀":"`";var a="ja-JP"===TS.i18n.locale()?"｀｀｀":"```";t["<B:START>"]='<b data-stringify-prefix="'+r+'" data-stringify-suffix="'+r+'" data-stringify-requires-siblings>';t["<B:END>"]="</b>";t["<STRIKE:START>"]='<strike data-stringify-prefix="~" data-stringify-suffix="~" data-stringify-requires-siblings>';t["<STRIKE:END>"]="</strike>";t["<CODE:START>"]='<code class="special_formatting" data-stringify-prefix="'+i+'" data-stringify-suffix="'+i+'" data-stringify-requires-siblings>';t["<CODE:END>"]="</code>";t["<I:START>"]='<i data-stringify-prefix="'+n+'" data-stringify-suffix="'+n+'" data-stringify-requires-siblings>';t["<I:END>"]="</i>";t["<PRE:START>"]='<pre class="special_formatting" data-stringify-prefix="'+a+'" data-stringify-suffix="'+a+'" data-stringify-requires-siblings>';t["<PRE:END>"]="</pre>";return t};var m=c();var f=[];var p=0;var h="^$-+—!?][{}^$-+—!?][{}^$-+—!?][{}^$-+—!?][{}^$-+—!?][{}^$-+—!?][{}^$-+—!?][{}".split("").sort(function(){return.5-Math.random()}).join("");var g="thisreplacementtokenallowsustotreatatsymbolsasiftheywerewordcharactersinregex".split("").sort(function(){return.5-Math.random()}).join("");var S="thisreplacementtokenallowsustotreatdashesasiftheywerewordcharactersinregex".split("").sort(function(){return.5-Math.random()}).join("");var T="thisreplacementtokenallowsustotreatdashesasiftheywerewordcharactersinregex".split("").sort(function(){return.5-Math.random()}).join("");var v=function e(t,r){var n=t.slice(r.length);return r+TS.format.tokenizeStr(f,n)};var b=function e(t){if(TS.boot_data.feature_tinyspeck){var r=TS.interop.format.locateHighlightWords(t,TS.model.highlight_words);_.forEachRight(r,function(e){var r=e.index;var n=r+e.length;var i=t.slice(r,n);var a=t.slice(0,r);var s='<span class="mention">'+i+"</span>";var o=t.slice(n);t=a+s+o});return t}var n=TS.model.highlight_words.concat();n.sort(function e(t,r){return r.length-t.length});var i=false;if(-1!=t.indexOf("@")){i=true;t=TS.format.swapOutAts(t)}var a;n.forEach(function(e){if(!/\S/.test(e))return;if(i)e=TS.format.swapOutAts(e);e=TS.utility.regexpEscape(e);if("don"===e)e+="(?!['’]t)";e=_.escape(e);if(i)a=new RegExp("(\\b(?!.)|_|\\s|^)("+e+")(\\b|,*)((?!.)|_|\\s|$)","ig");else a=new RegExp("(\\b|_|\\s|^)("+e+")(\\b)(|_|\\s|$)","ig");var r=0;t=t.replace(a,function(e,t,n,i,a,s,o){if("&"===o.substr(s-1,1)&&";"===o.substr(s+e.length,1))return e;if(o.substr(0,s).match(/</))for(var l=s;l>=r;l-=1){if("<"===o.charAt(l))return t+n+i;if(">"===o.charAt(l))break}r=s+e.length;return t+'<span class="mention">'+n+"</span>"+i+a})});if(i)return TS.format.swapInAts(t);return t};var y=function e(t){if(!t)return"";return t.replace(/\*/g,"&ast;").replace(/_/g,"&#95;").replace(/`/g,"&#96;")};var w=function e(t){if(!t)return"";return y(t).replace(/:/g,"&#58;")};var k=function e(t,r){r=r||{};var n=!!r.do_inline_imgs||void 0;var i=!!r.for_growl||void 0;var a=!!r.for_edit||void 0;var s=!!r.no_highlights||void 0;var o=!!r.no_specials||void 0;var l=!!r.enable_slack_action_links||void 0;var u=!!r.no_jumbomoji||void 0;var d=!!r.no_preformatted||void 0;var c=r.custom_linebreak||void 0;var m=!!r.stop_animations||void 0;var f=!!r.no_emoji_text||void 0;var p=!!r.transform_missing_emoji||void 0;var h=!!r.show_icon_for_emoji_in_as_text_mode||void 0;var g=!!r.ignore_emoji_mode_pref||void 0;var S=!!r.prevent_copy_paste||void 0;var T=!!r.no_linking||void 0;var v=r.token_overrides||void 0;var b=r.emoji_mode;if(!_.isString(b)&&TS.prefs.prefs_loaded)b=TS.prefs.getPref("emoji_mode");if(true!==u)u=!TS.prefs.getPref("jumbomoji");s=t&&"no_highlights"in t?!!t.no_highlights:!!s;if(!_.isBoolean(o))if(t&&"mrkdwn"in t)o=false===t.mrkdwn;else o=false;if(a)o=true;var y=t&&t.no_emoji;var w=!(n&&(!t||"bot_message"!==t.subtype));if(true!==w)w=!!TS.prefs.getPref("hide_hex_swatch");var k=!w&&TS.client&&TS.model.team;var x="NORMAL";if(o)x="NOMRKDWN";if(i)x="GROWL";if(a)x="EDIT";return{tsf_mode:x,no_highlights:s,no_emoji:y,no_hex_colors:w,do_inline_imgs:n,enable_slack_action_links:l,do_theme_install_buttons:k,no_jumbomoji:u,no_preformatted:d,custom_linebreak:c,stop_animations:m,no_emoji_text:f,transform_missing_emoji:p,show_icon_for_emoji_in_as_text_mode:h,ignore_emoji_mode_pref:g,prevent_copy_paste:S,no_linking:T,token_overrides:v,emoji_mode:b}};var x=function e(t,r,n){var a=n.tsf_mode;var s=n.no_highlights;var o=n.no_emoji;var l=n.no_hex_colors;var u=n.do_inline_imgs;var d=n.enable_slack_action_links;var c=n.do_theme_install_buttons;var f=n.no_jumbomoji;var p=n.no_preformatted;var h=n.custom_linebreak;var g=n.stop_animations;var S=n.no_emoji_text;var T=n.transform_missing_emoji;var v=n.show_icon_for_emoji_in_as_text_mode;var y=n.ignore_emoji_mode_pref;var w=n.prevent_copy_paste;var k=n.no_linking;var x=n.token_overrides;var O=n.emoji_mode;var D=m;if(h||x){var H=x||{};if(h)H["<LINE:BREAK>"]=h;D=_.extend({},D,H)}var j=[];if(c){var R=(t.match(i)||[]).length;var N=[];var U=0;t=t.replace(i,function(e,t,r){U+=1;var n=R>1?E(e,U):E(e);N.push(n);var i=R>1?" ("+U+")\t":"";return t+TS.format.tokenizeStr(j,"<nobr>",",")+r+i+TS.format.tokenizeStr(j,"</nobr>")});t+=TS.format.tokenizeStr(j,F(N))}var q=TS.boot_data.feature_parsed_mrkdwn&&"NORMAL"===a&&r&&r.cached_formatting&&t===r.text;var G;if(q)G=r.cached_formatting;else G=TSF.getTokensArray($.trim(t),a,{jumbomoji:!f,allow_intra_word_formatting:TS.format.shouldAllowIntraWordFormatting()});if(p)G=G.map(B);if(k)G=_.reject(G,L);var W="";var z;var K;var V;var Y;var J;var Q;var X;var Z;var ee;var te;var re;var ne;var ie;var ae;var se;var oe;var le;var ue;var de;if("GROWL"===a||"EDIT"===a)for(Y=0;Y<G.length;Y+=1){V=G[Y];if(0===V.indexOf("<"))if(D[V])TS.error('unexpected: mode == "GROWL" || "EDIT", and yet we got something in the formatting map? '+V);else if(0===V.indexOf("<!"))W+=P(a,V);else if(0===V.indexOf("<@")){de=I(a,V);W+=de}else if(0===V.indexOf("<#"))W+=C(a,V);else TS.error('unexpected: mode == "GROWL" || "EDIT", and yet we got '+V);else if(-1==V.indexOf("<"))if("EDIT"===a){if(TS.boot_data.feature_localization&&TS.i18n.locale()!==TS.interop.I18n.DEFAULT_LOCALE)V=TS.emoji.maybeGetLocalizedEmojiString(V);W+=_.unescape(V)}else if(TS.utility.platformSupportsHtmlNotifications()){if(TS.utility.platformSupportsImgEmojiInHtmlNotifications())W+=TS.emoji.graphicReplace(V,{force_img:true,stop_animations:g})}else{var _e=_.unescape(V);_e=TS.emoji.maybeUnifiedReplace(_e);if(TS.boot_data.feature_localization&&TS.i18n.locale()!==TS.interop.I18n.DEFAULT_LOCALE)V=TS.emoji.maybeGetLocalizedEmojiString(V);W+=_e}else TS.error("token has a < in it but it is not the first character!\n"+V)}else{var ce="";var me;var fe;var pe;for(Y=0;Y<G.length;Y+=1){V=G[Y];if(0===V.indexOf("<"))if(D[V]){W+=D[V];if(V==TSF.LINK_END){W+=ce;ce=""}}else if(0===V.indexOf("<!"))W+=P(a,V,s,k);else if(0===V.indexOf("<@")){de=I(a,V,s,k);W+=de}else if(0===V.indexOf("<#"))W+=C(a,V,k);else if(0===V.indexOf(TSF.LINK_START.split(" ")[0])){var he=function(e){var t=$.trim(e.replace(TSF.LINK_START.split(" ")[0],""));return t.substr(0,t.length-1)}(V);var ge=TS.interop.utility.getBotIdFromUrl(he);var Se;var Te="";var ve;var be="";if(ge){ve=TS.bots.getBotById(ge);if(!ve){TS.warn("No bot found for "+ge);if(TS.shared.isModelObShared(TS.shared.getActiveModelOb())&&r.user){Se=_.get(TS.members.getMemberById(r.user),"profile.team");ve={id:ge,name:TS.bots.getBotNameByBotLink(r.text)?TS.bots.getBotNameByBotLink(r.text):"",source_team_id:Se}}}}if(ge&&ve&&!ve.is_unknown&&!ve.isUnknown){pe=true;Z=TS.utility.shouldLinksHaveTargets()?'target="'+he+'" ':"";fe=s?ve.name:b(ve.name);if(G[Y+1]&&G[Y+1]==he)fe=he;fe=fe.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;");if(ve.app_id)Te=ve.app_id;if(ve.source_team_id)be="data-team-id="+ve.source_team_id+" ";W+='<a href="'+he+'" '+Z+'data-bot-id="'+ge+'" data-app-id="'+Te+'" '+be+'class="internal_bot_link app_preview_link">'+fe}else if(0===he.indexOf(TS.utility.msgs.api_url_prefix+"chat.help"))if(d){me=_.escape(JSON.stringify(""+he));W+='<a onclick="TS.utility.msgs.doApiUrl('+me+')" class="api_url">'}else W+='<a class="api_url muted">(Disabled) ';else if(0===he.indexOf(TS.utility.msgs.new_api_url_prefix))if(d){me=_.escape(JSON.stringify(""+he));W+='<a onclick="TS.utility.msgs.doNewApiUrl('+me+')" class="api_url">'}else W+='<a class="api_url muted">(Disabled) ';else if(0===he.indexOf("javascript:"))W+='<a onclick="TS.client.msg_pane.maybeClick(this)" data-maybe-click="'+he.replace("javascript:","")+'">';else if(TS.client&&TS.client.core_url&&0===he.indexOf(TS.client.core_url))W+='<a target="_self" href="'+he+'">';else{var ye=TS.utility.getFileIDFromURL(he);var we=false;if(ye&&TS.model&&TS.model.user&&TS.model.user.is_primary_owner){var ke=TS.files?TS.files.getFileById(ye):false;if(ke&&TS.utility.welcome_post&&ke.name==TS.utility.welcome_post.WELCOME_POST_NAME)we=true}var xe=we?"file_new_window_link welcome_post_slackbot_message":"file_preview_link";var Ce=ye?' class="no_jumbomoji '+xe+'"':"";var Me=ye?' data-file-id="'+ye+'"':"";W+="<a "+TS.utility.makeRefererSafeLink(he)+' target="_blank"'+Ce+Me+">";if(ce)TS.error("WTF we should have no attach_html");ce="";var Ie;if(r&&r.ts&&u){Ie=TS.inline_attachments.getAttachmentByFromUrl(r.attachments,he);if(Ie&&(TS.boot_data.feature_attachments_inline||TS.templates.builders.shouldDoSimpleAttachment(Ie,r)))ce=TS.templates.builders.buildAttachmentHTML({attachment:Ie,url:he,msg:r,show_initial_caret:true})}}}else if(0===V.indexOf(TSF.JUMBOMOJI_COLONS.split(" ")[0]))W+=M(V,{tsf_mode:a,no_emoji:o,do_jumbomoji:!f,stop_animations:g,no_emoji_text:S,transform_missing_emoji:T,show_icon_for_emoji_in_as_text_mode:v,ignore_emoji_mode_pref:y,emoji_mode:O});else if(0===V.indexOf(TSF.EMOJI_COLONS.split(" ")[0]))W+=M(V,{tsf_mode:a,no_emoji:o,do_jumbomoji:false,stop_animations:g,no_emoji_text:S,transform_missing_emoji:T,show_icon_for_emoji_in_as_text_mode:v,ignore_emoji_mode_pref:y,emoji_mode:O});else if(0===V.indexOf(TSF.HEX_BLOCK.split(" ")[0]))W+=A(a,V,l);else TS.error("markup token not handled:"+V);else if(-1===V.indexOf("<"))if(pe)pe=false;else{if(!s)V=b(V);if(w)V=_.map($.parseHTML(V),function(e){if(e.nodeType===Node.TEXT_NODE)return'<span class="prevent_copy_paste" aria-label="'+_.escape(e.textContent)+'"></span>';return e.outerHTML}).join("");W+=V}else TS.error("token has a < in it but it is not the first character!\n"+V)}}if(r&&("sh_room_created"===r.subtype||"sh_room_shared"===r.subtype)){var Pe=TS.ui.growls.extractFromNameFromCorGMessage(r);if(Pe){if("GROWL"!==a||TS.utility.platformSupportsHtmlNotifications())Pe=_.escape(Pe);Pe+=": "}W="sh_room_created"===r.subtype?TS.i18n.t("{from_name} Started a call","string_format")({from_name:Pe}):TS.i18n.t("{from_name} Shared a call","string_format")({from_name:Pe})}W=TS.format.deTokenizeStr(j,W);return W};var C=function e(t,r,n){var i=r.replace(/<|>|#/g,"");var a=i.split("|");var s=a[0];var o=a[1];var l=TS.channels.getChannelById(s);var u;var d;if(l){u=l.name;d=l.is_private||l.is_group}var _=TS.interop.format.formatChannelName({fallbackName:o,channelName:u,isPrivate:d});if(!l||"GROWL"===t||"EDIT"===t||n)return _;var c=TS.utility.shouldLinksHaveTargets()?'target="/archives/'+l.id+'"':"";return'<a href="/archives/'+l.id+'" '+c+' data-channel-name="'+l.name+'" data-channel-id="'+l.id+'" class="internal_channel_link">'+_+"</a>"};var M=function e(t,r){r=r||{};var n=t.split(" ")[1].replace(">","");if(r.no_emoji)return n;var i;if(r.transform_missing_emoji&&!TS.emoji.isValidName(n))i=TS.emoji.MISSING_EMOJI_HTML;else if(r.show_icon_for_emoji_in_as_text_mode&&"as_text"===r.emoji_mode)i=TS.emoji.graphicReplace(n,{show_icon_for_emoji_in_as_text_mode:true});else i=TS.emoji.graphicReplace(n,{obey_emoji_mode_pref:!r.ignore_emoji_mode_pref,include_title:true,include_text:!r.no_emoji_text,jumbomoji:r.do_jumbomoji,stop_animations:r.stop_animations});if(i&&-1!==i.indexOf(">>"))TS.warn("TS.emoji.graphicReplace may be malformed: "+i);return i};var I=function e(t,r,n,i){var a=r.replace(/<|>/g,"");var s=TS.utility.msgs.getMemberIdFromMemberMarkup(a);if(!TS.interop.utility.looksLikeMemberId(s))return a;var o=TS.utility.msgs.getMemberFromMemberMarkup(a);if(o&&"EDIT"!==t&&"GROWL"!==t)if(o.is_unknown)return TS.templates.unknown_member({id:o.id});else if(o.is_non_existent&&TS.interop.utility.looksLikeMemberId(o.id))return TS.templates.message_member_non_existent({id:o.id});if(!o){if("GROWL"===t)return r;var l=a.split("|");if(l.length>1&&l[1])return"@"+l[1];return a}var u=["internal_member_link"];var d={"member-id":o.id,"stringify-text":"@"+o.id};if(o.is_bot&&o.profile){var c=_.get(o.profile,"bot_id");if(c){d["bot-id"]=c;var m=TS.bots.getBotById(c);if(_.get(m,"app_id"))d["app-id"]=m.app_id}u=_.pull(u,"internal_member_link");u.push("app_preview_link");u.push("app_preview_link_slug")}var f="";_.forEach(d,function(e,t){f+="data-"+t+'="'+e+'" '});var p=_.escape("@"+TS.members.getMemberMentionName(o));u.push("ts_tip ts_tip_top ts_tip_lazy ts_tip_float ts_tip_member");f+='data-tip-member="'+o.id+'" ';if("EDIT"===t)return"<@"+o.id+"|"+p+">";if("GROWL"===t||!TS.permissions.members.canUserSeeMember(o))return"@"+TS.members.getMemberMentionName(o);var h=TS.utility.shouldLinksHaveTargets()?'target="/team/'+o.id+'" ':"";if(o.id==TS.model.user.id)u.push("mention");if(i)return p;f+='data-member-label="'+p+'" ';return'<a href="/team/'+o.id+'" '+h+f+'class="'+u.join(" ")+'">'+p+"</a>"};var P=function t(r,n,i,a){if(TS.boot_data.page_needs_enterprise&&TS.boot_data.feature_default_shared_channels){var s=TS.shared.getActiveModelOb()||{};if(TS.shared.isModelObOrgShared(s)&&TS.channels.isChannelOrgDefault(s)){i=true;a=true}}var o=n.replace(/<|>/g,"");var l=o.split("|");var u=l[0].substr(1);if(_.includes(e,u)){var d=TS.interop.format.formatBroadcastCommand({type:u,featureLocalization:TS.boot_data.feature_localization});if("GROWL"===r||"EDIT"===r||a)return d;return'<b class="mention" data-broadcast-id="BK'+u+'" data-stringify-text="'+d+'">'+d+"</b>"}var c=l[1]?l[1]:u;if(-1!==u.indexOf("^")){var m=u.split("^");u=m.shift();if("date"===u&&m.length>=2){var f=m[0];var p=m[1];var h=TS.interop.datetime.formatDate(f,p,{fallbackString:c});var g=m.length>2?m[2]:"";if("GROWL"===r||"EDIT"===r||!g||a)return h;return"<a "+TS.utility.makeRefererSafeLink(g)+' target="_blank">'+h+"</a>"}else if("team"===u&&1===m.length){var S=c;var T=TS.teams.getTeamById(m[0]);if(T)S=T.name;if("GROWL"===r||"EDIT"===r)return"*"+S+"*";return TS.templates.format_team({team:T,fallback:S})}else if("subteam"===u&&1===m.length){var v=TS.user_groups.getUserGroupsById(m[0]);if(v&&v.handle){var y=TS.utility.shouldLinksHaveTargets()?'target="/usergroups/'+v.id+'" ':" ";var w=_.escape(v.handle);var k=i||"EDIT"===r?"@"+w:b("@"+w);var x=["internal_user_group_link"];if("GROWL"===r||"EDIT"===r){if("EDIT"===r)return"<@"+v.id+"|"+k+">";return"@"+v.handle}if(a)return k;k="@"+w;if(!i&&-1!==TS.model.highlight_words.indexOf("@"+w))x.push("mention");return'<a href="/usergroups/'+v.id+'" '+y+'data-user-group-id="'+v.id+'" class="'+x.join(" ")+'" data-stringify-text="@'+w+'">'+k+"</a>"}if("GROWL"!==r&&"EDIT"!==r)return c}else{if("GROWL"===r||"EDIT"===r)return"<"+c+">";return"&lt;"+c+"&gt;"}}else{if("GROWL"===r||"EDIT"===r)return"<"+c+">";return"&lt;"+c+"&gt;"}return""};var A=function e(t,r,n){var i=r.split(" ")[1].replace(">","");if(!n)return' <div class="inline_color_block" style="background:'+i+';"></div>';return""};var E=function e(t,r){var n=TS.i18n.t("Switch sidebar theme","string_format")();if(r)n+=" ("+r+")";return'<a data-theme="'+_.escape(t)+'" class="btn btn_small btn_outline very_small_top_margin very_small_bottom_margin tiny_right_margin theme_installer_btn">'+n+"</a>"};var F=function e(t){if(t&&t.length)return'<br/><span class="theme_install_btns">'+t.join(" ")+"</span>";return""};function O(e,t,r){var n=e.lastIndexOf(" ",r);var i=-1!==n?n+1:0;var a=e.substring(i,r+t.length);var s=TS.interop.url.findUrlsInString(a).length>0;return s}function B(e){switch(e){case TSF.PRE_START:return TSF.CODE_START;case TSF.PRE_END:return TSF.CODE_END}return e}function D(e){var t=document.createElement("div");t.innerHTML=e;return t.textContent}function H(e,t){if(!e)return"";if(!t)t={};e=TS.format.replaceUnicodeDoppelgangers(e);var r=[];if(TS.boot_data.feature_ignore_code_mentions)e=TSF.replaceFormatContents(r,e,{replace_pre:true,replace_code:true});var n=[];e=TS.format.texty.replaceFormatMentions(n,e,t.do_specials);if(t.do_specials)e=TSF.getTokensString(e,"CLEAN",{jumbomoji:TS.prefs.getPref("jumbomoji"),allow_intra_word_formatting:TS.format.shouldAllowIntraWordFormatting()});n.forEach(function(t){e=e.replace(t.placeholder,t.mention)});e=e.replace(s,function(r,n,i,a,s){if("/"===n&&O(e,r,s))return r;var o=j(TS.channels.getChannelById,i.substr(1),TS.channels.getChannelByName,i);if(o.model_ob){var l;if(t.human_readable)l="#"+o.model_ob.name;else l="<#"+o.model_ob.id+"|"+o.model_ob.name+">";return n+l+o.extra}return n+i});if(TS.prefs.getPref("convert_emoticons")&&"as_text"!==TS.prefs.getPref("emoji_mode"))e=TS.format.doEmoticonConversion(e);if(TS.boot_data.feature_localization&&TS.i18n.locale()!==TS.interop.I18n.DEFAULT_LOCALE)e=TS.emoji.maybeGetCanonicalEmojiString(e);if(TS.boot_data.feature_ignore_code_mentions){r=r.map(function(e){var r=TS.format.texty.convertContentsStringToContents(e.str);if(TS.utility.contenteditable.inlineEmojiIsEnabled())e.str=TS.format.texty.convertContentsToStringForDisplay(r);else e.str=_.reduce(r.contents,function(e,t){return e+t.insert},"");if(t.do_specials)e.str=TSF.getTokensString(e.str,"CLEAN",{jumbomoji:TS.prefs.getPref("jumbomoji"),allow_intra_word_formatting:TS.format.shouldAllowIntraWordFormatting()});return e});e=TSF.swapOutPlaceholders(r,e)}return e}function j(e,t,r,n){var i;var a="";var s;if(_.isFunction(e)&&_.isString(t)){i=t.substring(0,TS.model.model_ob_id_length);s=e(i);if(s)a=t.substring(TS.model.model_ob_id_length)}if(!s)s=r(n);var o=[".","..","...","....","-","--","_","…"];var l=0;while(!s&&l<o.length){var u=o[l];if(n&&n.substr(n.length-u.length,u.length)==u){i=n.substr(0,n.length-u.length);s=r(i);if(s)a=u}l+=1}return{model_ob:s,extra:a}}var R=function e(t){if(!t||t instanceof Text)return false;return _.some(d,function(e,r){return t.hasAttribute(r)})};var L=function e(t){if(!N)N=TSF.LINK_START.split(" ")[0];if(_.startsWith(t,N))return true;if(t===TSF.LINK_END)return true;return false};var N})()},4801:function(e,t){(function(){TS.registerModule("menu",{$menu:null,$submenu:null,$submenu_origin:null,$submenu_parent:null,$menu_header:null,$menu_items:null,$menu_list_container:null,$menu_list:null,$menu_footer:null,menu_lazy_load:null,user_group:null,end_tim:0,$target_element:null,$secondary_target_element:null,members_html_cache:null,large_list_trigger:1500,large_dom_trigger:500,watching_members_model:false,menu_items_hidden:true,has_submenu:false,menu_closed_sig:new signals.Signal,onStart:function e(){},buildIfNeeded:_.once(function(){TS.menu.$menu=$(TS.templates.menu());var e=TS.menu.$menu;if("mobile"!==TS.boot_data.app&&"0"!=TS.qs_args.new_scroll){if(TS.client)e.appendTo($("#client-ui"));else e.appendTo($("body"));if(!TS.environment.supports_custom_scrollbar){var t="1"==TS.qs_args.debug_scroll;e.find("#menu_items_scroller").monkeyScroll({debug:t})}e.detach()}TS.menu.$menu_header=e.find("#menu_header");TS.menu.$menu_body=e.find(".menu_body");TS.menu.$menu_list_container=e.find("#menu_list_container");TS.menu.$menu_list=e.find("#menu_list");TS.menu.$menu_items=e.find("#menu_items");TS.menu.$menu_footer=e.find("#menu_footer")}),handleTopicKeydown:function e(t){var r=TS.utility.keymap;if(t.which==r.enter&&!t.shiftKey&&!t.altKey){var n=$(t.target);var i=TS.shared.getActiveModelOb();var a=$.trim(n.val());if(i.topic.value===a){TS.menu.end();return}if(i.is_group)TS.groups.setTopic(i.id,a);else if(i.is_channel)TS.channels.setTopic(i.id,a);TS.menu.end()}},startWithList:function e(t,r,n){if(!r||!r.length)return;if(TS.menu.isRedundantClick(t))return;n=n||{};TS.menu.buildIfNeeded();TS.menu.clean();TS.menu.$menu_header.addClass("hidden").empty();TS.menu.$menu_items.html(r.html());TS.menu.$menu.addClass(n.menu_class);if(n.close_on_click||n.onClick)TS.menu.$menu_items.on("click.menu","li",function(e){if("function"===typeof n.onClick)n.onClick(e);if(n.close_on_click)TS.menu.end()});TS.menu.start(t,void 0,n);if(n.attach_to_target_at_full_width)TS.menu.$menu.css({width:"100%",top:"calc(100% + 3px)",left:"0"});else{var i=a(n.align_right);TS.menu.positionAt(TS.menu.$target_element,i.left,i.top)}},startWithDatePicker:function e(t){if(TS.menu.isRedundantClick(t))return;if(TS.client.ui.checkForEditing(t))return;TS.menu.buildIfNeeded();TS.menu.clean();TS.menu.$menu_header.addClass("hidden").empty();TS.menu.$menu_items.html(TS.templates.menu_date_picker_items());TS.menu.$menu_items.on("click.menu","li",TS.menu.onDatePickerItemClick);TS.menu.$menu.attr("data-qa","date_picker_menu");var r=$("#date_picker_cal_container");TS.ui.date_picker.startJumpToDatePicker(r);TS.menu.$menu.addClass("date_picker")},onDatePickerItemClick:function e(r){var n=$(this).attr("id");var i=TS.shared.getActiveModelOb();if($(this).hasClass("disabled")){TS.menu.end();return}if("date_picker_back_item"===n){r.preventDefault();t=true;if(i.is_channel||i.is_mpim)TS.menu.channel.startWithChannel(r,i.id);else if(i.is_im)TS.menu.member.startWithMember(r,i.user,false,false,true);else if(i.is_group)TS.menu.group.startWithGroup(r,i.id);TS.menu.$menu.removeClass("date_picker");return}TS.warn("not sure what to do with clicked element id:"+n)},startWithMessageActions:function e(t,r,n,i){if(TS.client&&!TS.redux.socket.isConnected()){TS.sounds.play("beep");return}if(TS.menu.isRedundantClick(t))return;if(TS.model.menu_is_showing)return;TS.menu.buildIfNeeded();TS.menu.clean();var a=TS.utility.msgs.getMsg(r,n);i=i||TS.shared.getActiveModelOb();if(!a)a=TS.ui.replies.getActiveMessage(i,r);if(!a&&TS.model.threads_view_is_showing)a=TS.client.threads.getMessage(i,r);if(!a&&TS.model.unread_view_is_showing)a=TS.client.unread.getMessage(i,r);var s=TS.utility.msgs.getMsgActions(a,i);var o=TS.model.unread_view_is_showing;var u=s.mark_unread&&!a.is_briefing_message&&(TS.utility.msgs.getMarkMsgTSForUnreadPoint(r,n,i)||o)&&!TS.model.archive_view_is_showing&&!a.is_ephemeral;s.mark_unread=!!u;var d={msg:a,actions:s,model_ob:i,is_all_unreads_showing:TS.model.unread_view_is_showing,is_channel_or_group:i.is_channel&&!i.is_mpim||i.is_group&&!i.is_mpim};var c=$(t.target);d.abs_permalink=TS.utility.msgs.constructAbsoluteMsgPermalink(i,a.ts,a.thread_ts);if("file_share"===a.subtype||"file_mention"===a.subtype)if(a.file)d.abs_permalink=a.file.permalink;if(TS.replies.canReplyToMsg(i,a)){d.can_subscribe=true;d.subscription=TS.replies.getSubscriptionState(i.id,a.ts);d.context=TS.ui.thread.getContextForEl(c);if(!d.subscription)TS.replies.promiseToGetSubscriptionState(i.id,a.ts).then(function(e){l(i.id,a.ts,e)});d.prefs_threads_everything=TS.prefs&&TS.prefs.getPref("threads_everything")}d.is_in_conversation=c.closest("ts-conversation").length>0;var m=c.closest("#threads_msgs").length>0;var f=d.is_in_conversation||m;var p=TS.boot_data.feature_sli_briefing&&c.closest("#sli_briefing").length>0;s.mark_unread=s.mark_unread&&!f&&!p;if(f&&"tombstone"===a.subtype)s.has_private_actions=false;if("thread_broadcast"===a.subtype){if(!f&&s.delete_msg)s.delete_msg=false;if(f&&s.remove_broadcast||i.is_channel&&!i.is_member)s.remove_broadcast=false}TS.menu.$menu_header.addClass("hidden").empty();TS.menu.$menu_items.html(TS.templates.menu_message_action_items(d));TS.menu.$menu_items.on("click.menu","li",TS.menu.onMessageActionClick);TS.log("enabled reminders msg action menu");TS.menu.has_submenu=true;var h=TS.menu.$menu_items.find("#remind_me");h.on("highlighted",function(){h.submenu({items_html:TS.templates.remind_me_items(),onclick:_.partial(TS.menu.onMessageRemindClick,i,a,f)})}).on("unhighlighted",function(){if(TS.menu.$submenu&&!TS.menu.$submenu.hasClass("kb_active"))h.submenu("destroy")});TS.menu.start(t);TS.menu.$target_element=c.closest("[data-action]");TS.menu.$target_element.addClass("active");TS.menu.$secondary_target_element=c.closest("ts-message");TS.menu.$secondary_target_element.addClass("active");var g=0;var S=c.width()+10;if(TS.client&&!TS.model.ui_state.flex_visible)S=-(TS.menu.$menu.width()+10);var T=TS.menu.$menu.find("#edit_link");if(0===T.length)T=TS.menu.$menu.find("#rxn_link");if(T.length>0){var v=TS.menu.$menu.offset().top;var b=T.offset().top;g=-(b-v+T.height()/2-5)}TS.menu.positionAt(c,S,g);TS.menu.keepInBounds()},onMessageActionClick:function e(t){t.preventDefault();if(TS.isPartiallyBooted()){TS.incremental_boot.userDidInteractWithUI();return}var r=$(this);var n=r.attr("id");var i=r.data("msg-ts");var a=r.data("model-ob-id");var s=r.data("rxn-key");var o=a?TS.shared.getModelObById(a):TS.shared.getActiveModelOb();var l;if("edit_link"===n){var u=r.data("edit-state");TS.msg_edit.startEdit(i,o,u)}else if("delete_link"===n)TS.msg_edit.startDelete(i,o);else if("open_in_channel"===n){l=r.attr("data-thread-ts");TS.client.ui.tryToJump(o.id,l)}else if("open_thread_in_flexpane"===n){var d=TS.utility.msgs.findMsg(i,o.id);if(d&&TS.replies&&TS.replies.canReplyToMsg(o,d)){l=d.thread_ts||d.ts;TS.ui.replies.openConversation(o,l)}}else if("toggle-subscription-status"===n){var c=r.data("subscribed");var m;var f=TS.utility.msgs.findMsg(i,a);if(TS.boot_data.feature_threads_perf&&f&&f.latest_reply)m=f.latest_reply;else if(f&&f.replies&&f.replies.length)m=_.last(f.replies).ts;r.addClass("disabled");TS.replies.setSubscriptionState(a,i,!c,m);var p=c?"THREADS_UNFOLLOW_CLICKED":"THREADS_FOLLOW_CLICKED";var h=r.data("context");var g=_.get(f,".reply_count",0)+1;TS.ui.thread.trackEvent(a,i,h,p,{num_msg_in_thread:g})}else if("pin_link"===n)TS.pins.startPinMessage(i,o);else if("unpin_link"===n)TS.pins.unPinMessage(i,o);else if("rxn_link"===n)TS.ui.react_emoji_menu.start({e:t,rxn_key:s});else if("mark_unread"===n)if(TS.model.unread_view_is_showing)TS.client.ui.unread.setUnreadPoint(i);else{TS.info("setting unread point on "+o.id+" due to message action click ("+i+")");TS.client.msg_pane.setUnreadPoint(i)}else if("copy_link"===n){TS.clipboard.writeText($(this).data("permalink"));var S=TS.menu.$secondary_target_element;var T={message_timestamp:i,channel_id:a,channel_type:a[0]||"",member_id:S.data("member-id"),app_id:S.data("app-id"),bot_id:S.data("bot-id")};TS.clog.track("MSG_LINK_COPY",T)}else if("open_original_link"===n);else if("share_message_link"===n)TS.ui.share_message_dialog.start(i,o);else if("remove_broadcast_link"===n)TS.msg_edit.startRemoveBroadcast(i,o);else if("remind_me"===n)return;TS.menu.end()},onMessageRemindClick:function e(t,r,n,i){var a=$(i.target).data("msg-action");if("remind"===a){var s={time:$(i.target).data("remind-length"),message_channel:t.id,message_ts:r.ts};if("thread_broadcast"===r.subtype&&!n)s.respond_in_channel=true;var o=function e(){};TS.api.call("reminders.addFromMessage",s).then(function(e){var t=e.data,r=e.args,n=e.request_id;var i=true;o(i,t,r,n);return{data:t,args:r,request_id:n}}).catch(function(e){var t=e.data,r=e.args,n=e.request_id;var i=false;o(i,t,r,n);return{data:t,args:r,request_id:n}})}TS.menu.end()},startWithCommentActions:function e(t,r,n){if(TS.client&&!TS.redux.socket.isConnected()){TS.sounds.play("beep");return}if(TS.menu.isRedundantClick(t))return;if(TS.model.menu_is_showing)return;TS.menu.buildIfNeeded();TS.menu.clean();var i=TS.files.getFileById(r);if(!i)return;var a=TS.files.getFileCommentById(i,n);if(!a)return;var s=TS.shared.getActiveModelOb();var o=TS.files.getFileCommentActions(a,i);TS.menu.$menu_header.addClass("hidden").empty();TS.menu.$menu_items.html(TS.templates.menu_comment_action_items({model_ob:s,file:i,comment:a,actions:o}));var l=$(t.target);TS.menu.$menu_items.on("click.menu","li",function(e){var t=l.closest(".comment_actions");TS.menu.onCommentActionClick(e,t)});TS.menu.start(t);var u=0;var d=-(TS.menu.$menu.width()+10);var _=TS.menu.$menu.find("#edit_file_comment");if(0===_.length)_=TS.menu.$menu.find("#rxn_file_comment");if(_.length>0){var c=TS.menu.$menu.offset().top;var m=_.offset().top;u=-(m-c+_.height()/2-5)}TS.menu.positionAt(l,d,u);TS.menu.keepInBounds()},onCommentActionClick:function e(t,r){t.preventDefault();var n=$(t.target).closest("[id]");var i=n.attr("id");var a=n.data("rxn-key");var s=TS.shared.getActiveModelOb();if("edit_file_comment"===i)TS.ui.comments.startEdit(n.data("file-id"),n.data("comment-id"),r);else if("delete_file_comment"===i)TS.ui.comments.startDelete(n.data("file-id"),n.data("comment-id"));else if("rxn_file_comment"===i)TS.ui.react_emoji_menu.start({e:t,rxn_key:a});else if("pin_comment"===i&&s)TS.pins.startPinFileComment(n.data("comment-id"),n.data("file-id"),s);else if("unpin_comment"===i&&s)TS.pins.unPinFileComment(n.data("comment-id"),n.data("file-id"),s);else{TS.warn("not sure what to do with clicked element id:"+i);return}TS.menu.end()},startWithSpaceWeb:function e(t,r,n){var i=5;if(TS.menu.isRedundantClick(t))return;if(TS.model.menu_is_showing)return;TS.menu.buildIfNeeded();TS.menu.clean();var a=TS.files.getFileById(r);if(!a)return;var s=TS.files.getFileActions(a);var o=a.channels.concat(a.groups).concat(a.ims);var l=a.user==n&&o.length&&"uneditable"!==a.state;var u={file:a,actions:s,can_write_to_clipboard:TS.clipboard.canWriteText(),can_enable_collab_editing:l,collab_enabled:"locked"!==a.state&&"uneditable"!==a.state};TS.menu.$menu_header.addClass("hidden").empty();TS.menu.$menu_items.html(TS.templates.menu_space_action_items(u));TS.menu.$menu_items.on("click.menu","li",TS.menu.onSpaceClickWeb);TS.kb_nav.setSubmitItemHandler(TS.menu.onSpaceClickWeb);TS.menu.start(t);var d=$(".space_btn_more");$("#toggle_input").bind("change",function(){t.preventDefault();var e=$("#toggle_collab_editing");var r=$(this);e.addClass("disabled");r.prop("disabled",true);TS.web.space.lockEditingPrivilegesWithCallback(r.prop("checked"),function(t){var n=t&&t.data;var i=n?"locked"!==n.state:!r.prop("checked");e.removeClass("disabled");r.prop("disabled",false);r.prop("checked",i)})});var _=-TS.menu.$menu.outerWidth()+d.outerWidth();var c=d.outerHeight()+i;TS.menu.positionAt(d,_,c)},onSpaceClickWeb:function e(t){var r=$(this).attr("id");var n=TS.files.getFileById($(this).data("file-id"));if(!n)return;if("keyboard_shortcuts"===r){t.preventDefault();TS.ui.shortcuts_dialog.start(true)}else if("learn_more"===r);else if("feedback"===r){t.preventDefault();TS.web.space.provideFeedback()}else if("delete_space"===r){t.preventDefault();TS.web.file.deleteFile(n.id)}else if("copy_space_link"===r){t.preventDefault();if(TS.clipboard.canWriteText())TS.clipboard.writeText(n.permalink);else TS.warn("User clicked copy link, but we can't write to the clipboard right now")}else if("create_public_space_link"===r){t.preventDefault();TS.files.createPublicURL(n)}else if("view_public_space_link"===r){t.preventDefault();TS.web.space.showPublicUrlDialog()}else if("print_space"===r){window.print();t.preventDefault()}else if("toggle_collab_editing"===r)return;else{t.preventDefault();TS.warn("not sure what to do with clicked element id:"+r);return}TS.menu.end()},startWithTeamAndUser:function e(t){if(TS.menu.isRedundantClick(t))return;if(TS.client.ui.checkForEditing(t))return;if(TS.model.menu_is_showing)return;TS.menu.buildIfNeeded();TS.menu.startWithTeamAndUserRebuild(t);if(TS.boot_data.page_needs_enterprise){TS.menu.listenForRebuildWorthiness(t);s(t)}},did_start_slack_menu_signal_listeners:false,listenForRebuildWorthiness:function e(t){TS.menu.did_start_slack_menu_signal_listeners=true;if(TS.client){TS.members.user_added_to_team_sig.add(function(){return o(t)});TS.members.user_removed_from_team_sig.add(function(){return o(t)})}},stopListeningForRebuildWorthiness:function e(){TS.menu.did_start_slack_menu_signal_listeners=false;if(TS.client){TS.members.user_added_to_team_sig.remove(o);TS.members.user_removed_from_team_sig.remove(o)}},startWithTeamAndUserRebuild:function t(r){TS.menu.clean();TS.menu.submenu_template_args={};var n=TS.model&&TS.model.team&&TS.boot_data.feature_tinyspeck;var i=TS.environment.is_dev;var a=n||i;var s=TS.boot_data.qa_messages_count||TS.model.team.messages_count;var o=!!TS.redux.enterprise.getEnterpriseId();var l=!TS.model.team.plan&&!o&&s>=200;var d=TS.model.user.is_admin||!TS.prefs.getTeamPref("stats_only_admins")&&!TS.model.user.is_restricted;var c=TSSSB.call("isAppStoreBuild")&&navigator.userAgent.match("MacAppStore");var m=(TS.model.user.is_owner||TS.prefs.getPref("purchaser"))&&!c;var f={user:TS.model.user,team:TS.model.team,team_name:TS.model.team.name,logout_url:TS.boot_data.logout_url,signin_url:TS.boot_data.signin_url,help_url:TS.boot_data.help_url,show_version_info:a,current_team_is_in_enterprise:false,current_team_gets_logout_url:true,show_apps_link:TS.apps.isAppSpaceEnabled()&&TS.apps.isAppmin(),show_customize_link:TS.model.user.is_admin||!TS.prefs.getTeamPref("emoji_only_admins")||!TS.prefs.getTeamPref("slackbot_responses_only_admins")||!TS.prefs.getTeamPref("loading_only_admins"),show_statistics_link:d,show_billing_link:m,is_app_store_build:c,is_our_app:TS.model.is_our_app,can_invite:TS.ui.admin_invites.canInvite(),can_view_shared_invites:TS.ui.shared_invites_modal.userCanViewSharedInvitesModal(),show_limit_meters:l,messages_count:s,messages_count_str:TS.utility.number.formatNumberWithAbbreviation(s,{precision:2,decimal_places:1,lowercase:true}),hidden_messages_count_str:TS.utility.number.formatNumberWithAbbreviation(s-1e4,{decimal_places:1,lowercase:true})};var p=Object.keys(TS.boot_data.other_accounts).length;if(p)f.other_accounts=TS.boot_data.other_accounts;if(TS.model.team.enterprise_id)f.current_team_is_in_enterprise=true;var h=false;var g=_.merge({},TS.boot_data.other_accounts);var S={};if(TS.boot_data.page_needs_enterprise&&_.get(TS.model.user,"enterprise_user.teams.length")>1)g[TS.model.team.id]=TS.model.team;_.each(g,function(t){if(t.enterprise_id){if(!f.other_enterprise_accounts){h=true;f.other_enterprise_accounts=_(g).filter("enterprise_id").groupBy("enterprise_id").map(function(t){var r={};r.enterprise_id=t[0].enterprise_id;r.enterprise_name=t[0].enterprise_name;if(TS.model.user.enterprise_user&&r.enterprise_id===TS.model.user.enterprise_user.enterprise_id)r.enterprise_teams=_(_.get(TS.model.user,"enterprise_user.teams",[])).without(TS.model.team.id).map(TS.teams.getTeamById).compact().slice(0,e).map(function(e){return{team_id:e.id,team_url:TS.utility.enterprise.buildTeamUrl(e.domain),team_name:e.name}}).sortBy("team_name").value();else r.enterprise_teams=t.slice(0,e);r.is_currently_logged_into=false;if(r.enterprise_id===TS.model.team.enterprise_id){r.is_enterprise_currently_logged_into=true;r.needs_enterprise_teams_dialog=_.get(TS.model.user,"enterprise_user.teams.length")>e;if(f.current_team_is_in_enterprise)f.current_team_gets_logout_url=false;f.enterprise_logout_url=TS.boot_data.enterprise_logout_url;f.enterprise_domain=TS.boot_data.enterprise_url+"/manage"}else{r.needs_other_enterprise_logout=true;r.logout_url=TS.enterprise.workspaces.createLogoutURL(r.enterprise_id,TS.boot_data.logout_url)}return r}).value();if(TS.model.user.enterprise_user)f.other_enterprise_accounts=f.other_enterprise_accounts.sort(function(e,t){if(e.enterprise_id===TS.model.user.enterprise_user.enterprise_id)return-1;if(t.enterprise_id===TS.model.user.enterprise_user.enterprise_id)return 1;return 0})}}else{t.logout_url=TS.enterprise.workspaces.createLogoutURL(t.team_id,TS.boot_data.logout_url);S[t.team_id]=t}});if(h)if(Object.keys(S).length)f.other_accounts=S;else if(Object.keys(f.other_enterprise_accounts).length)delete f.other_accounts;if(f.current_team_is_in_enterprise){f.current_team_gets_logout_url=false;f.enterprise_logout_url=TS.boot_data.enterprise_logout_url;f.enterprise_domain=TS.boot_data.enterprise_url+"/manage"}if(TS.boot_data.page_needs_enterprise){if((h||f.current_team_is_in_enterprise)&&(f.other_enterprise_accounts&&Object.keys(f.other_enterprise_accounts).length||f.other_accounts&&Object.keys(f.other_accounts).length))f.show_switch_teams_submenu=true;f.can_show_leave_workspace=TS.permissions.enterprise.canUserLeaveTeam(TS.model.user,TS.model.team)}f.show_shared_channels=TS.boot_data.page_needs_enterprise&&!TS.model.user.is_restricted;f.show_shared_channels_open_beta_controls=TS.permissions.members.canManageParticipationInSharedChannelsOpenBeta();TS.menu.$menu.addClass("team_menu slack_menu");TS.menu.$menu.attr("data-qa","team_menu");TS.menu.$menu_header.addClass("hidden").empty();TS.menu.$menu_body.html(TS.templates.menu_slack_menu(f));TS.menu.$menu_items.addClass("hidden");var T=TS.menu.$menu_body;T.off("click.menu mouseenter.section_header");T.on("click.menu","li",TS.menu.onTeamAndUserItemClick);T.on("click.menu",".member_preview_link",function(e){e.preventDefault();TS.client.ui.previewMember(TS.model.user.id)});T.on("mouseenter.section_header","> div.section_header",TS.kb_nav.clearHighlightedItem);TS.kb_nav.setSubmitItemHandler(TS.menu.onTeamAndUserItemClick);if(TS.boot_data.page_needs_enterprise){TS.menu.submenu_template_args.administration={};TS.menu.submenu_template_args.switch_teams=f}var v=55;if(TS.model.is_electron&&TS.model.is_mac&&TSSSB.call("isMainWindowFrameless"))v+=7;TS.menu.has_submenu=true;TS.menu.submenu_template_args.member_current_status_item={member:TS.model.user};TS.menu.start(r,void 0,{needs_to_remain_open:function e(){return TS.ui.react_emoji_menu.is_showing}});TS.menu.positionAt($("#team_menu"),10,v);TS.view.members.updateUserDisplayName();TS.view.members.updateUserCurrentStatus();T.on("highlighted","li:not(.divider)",TS.menu.onTeamAndUserItemMouseenter);if(d)TS.clog.track("UPGRADEXP_TEAM_ANALYTICS",{contexts:{ui_context:{action:"impression",step:"slack_menu"}}});if(m)if(!TS.model.team.plan&&"has_plans_link"==TS.experiment.getGroup("replace_billing_link"))TS.clog.track("GROWTH_PRICING",{contexts:{ui_context:{action:"impression",step:"slack_menu",ui_element:"paid_plans_link"}}});else TS.clog.track("GROWTH_PRICING",{contexts:{ui_context:{action:"impression",step:"slack_menu",ui_element:"billing_link"}}});if(l){TS.clog.track("UPGRDEXP_LIMIT_METER",{limit_meter_messages_count:s,contexts:{ui_context:{action:"impression",step:"slack_menu",ui_element:"limit_meter"}}});if(c)TS.clog.track("UPGRADEXP_TEAM_ANALYTICS",{contexts:{ui_context:{action:"impression",step:"slack_menu",ui_element:"limit_meter"}}});else TS.clog.track("GROWTH_PRICING",{contexts:{ui_context:{action:"impression",step:"slack_menu",ui_element:"limit_meter"}}});u(s)}},onTeamAndUserItemMouseenter:function e(t){if(!$(this).hasClass("has_submenu")||"member_current_status_item"===$(this).attr("id"))if(TS.menu._current_status_input&&TS.menu._current_status_input.isEdited())return;if(TS.menu.$submenu&&TS.menu.$submenu_parent)TS.menu.$submenu_parent.submenu("destroy");if($(t.currentTarget).hasClass("has_submenu")){var r=$(this).attr("id")||$(this).data("action");var n=TS.menu.$menu_body;var i={};if(TS.menu.submenu_template_args[r])i=TS.menu.submenu_template_args[r];switch(r){case"administration":if(TS.model.user.enterprise_user&&(TS.model.user.enterprise_user.is_admin||TS.model.user.enterprise_user.is_owner)){i.show_org_settings=true;i.enterprise_domain=TS.boot_data.enterprise_url+"/manage"}TS.menu.$submenu_parent=n.find("#administration");TS.menu.$submenu_parent.submenu({items_html:TS.templates.administration_items(i),onclick:TS.menu.onTeamAndUserItemSubmenuClick});break;case"switch_teams":TS.menu.$submenu_parent=n.find("#switch_teams");TS.menu.$submenu_parent.submenu({items_html:TS.templates.switch_teams_items(i),onclick:TS.menu.onTeamAndUserItemSubmenuClick});break;case"member_current_status_item":TS.menu.$submenu_parent=n.find("#member_current_status_item");TS.menu.$submenu_parent.submenu({items_html:TS.templates.current_status_submenu(i),onclick:TS.menu.onTeamAndUserItemSubmenuClick,ondestroy:TS.menu._unregisterCurrentStatusInput});TS.menu._registerCurrentStatusInput();break;case"team_invitations":if(!TS.ui.shared_invites_modal.userCanViewSharedInvitesModal())break;TS.menu.$submenu_parent=n.find("#team_invitations");TS.menu.$submenu_parent.submenu({items_html:TS.templates.shared_invites_modal()});TS.clog.track("INAPP_INVITES",{contexts:{ui_context:{step:"share_link",action:"impression",ui_element:"share_invite_link_modal"},referring_ui_context:{step:"invite_people",ui_element:"invite_people_menu"}},referring_event_id:"INAPP_INVITES"});TS.ui.shared_invites_modal.start()}}},onTeamAndUserItemSubmenuClick:function e(t){var r=$(t.target).closest("li");var n=r.attr("id")||r.data("action");switch(n){case"team_settings":case"manage_team":case"switch_team":case"logout":case"enterprise_logout":case"org_settings":break;case"enterprise_teams_dialog":t.preventDefault();TS.ui.enterprise_teams_dialog.show(TS.model.user);break;default:if(!t||!t.target||"_blank"!==t.target.getAttribute("target"))t.preventDefault();return}if(TS.menu.$submenu&&TS.menu.$submenu_parent)TS.menu.$submenu_parent.submenu("destroy");TS.menu.end()},onTeamAndUserItemClick:function e(t){clearTimeout(TS.menu.end_time);var r=$(this);if(r.is("[disabled]")||r.hasClass("disabled")){t.preventDefault();return}var i=r.attr("id");if(!i&&r.hasClass("switch_team"))i="switch_team";switch(i){case"leave_workspace":t.preventDefault();TS.ui.leave_team_dialog.start(TS.model.team.id);break;case"workspaces":t.preventDefault();TS.ui.workspaces.start();break;case"shared_channels":t.preventDefault();TS.ui.enterprise_shared_channels_invites.start();break;case"shared_channels_open_beta":t.preventDefault();TS.ui.shared_channels_open_beta_modal.showModal();break;case"version_info":t.preventDefault();TS.ui.showVersionInfo();break;case"member_account_item":t.preventDefault();TS.client.ui.previewMember(TS.model.user.id);break;case"team_settings":case"manage_team":case"team_billing":case"team_pricing":case"team_services":case"team_customize":case"team_statistics":case"limit_meter":break;case"team_apps":TS.metrics.count("team_menu_download_apps");t.preventDefault();TS.magic_login.execute({fallback_to_browser:true,browser_uri:"/downloads",app_uri:"/ssb/open"});break;case"team_invitations":if(TS.ui.shared_invites_modal.userCanViewSharedInvitesModal())return;t.preventDefault();TS.ui.admin_invites.start();TS.clog.track(this.getAttribute("data-clog-event"),this.getAttribute("data-clog-params"));break;case"member_prefs_item":t.preventDefault();TS.ui.prefs_dialog.start();break;case"team_help":t.preventDefault();n("team_menu");break;case"add_team":if(TSSSB.call("signInTeam"))t.preventDefault();break;case"member_presence":t.preventDefault();TS.redux.presence.toggleUserPresence();TS.menu.end_time=setTimeout(TS.menu.end,1e3);return;case"logout":t.preventDefault();if(TS.client)TS.client.windows.closeAll();TS.utility.loadUrlInWindowIfOnline(TS.boot_data.logout_url);break;case"enterprise_login":if(TSSSB.call("signInTeam"))t.preventDefault();break;case"enterprise_logout":break;case"switch_team":var a=$(this).data("user-id");if(TSSSB.call("displayTeam",a))t.preventDefault();else{var s=$(this).find("a").attr("href");if(s&&-1==s.indexOf("?"))$(this).find("a").attr("href",[s,TS.getQsArgsForUrl()].join("?"))}break;default:t.preventDefault();return}TS.menu.end()},startWithNotificationsMenu:function e(t){if(TS.menu.isRedundantClick(t))return;if(TS.client.ui.checkForEditing(t))return;if(TS.model.menu_is_showing)return;TS.menu.buildIfNeeded();TS.menu.clean();var r=TS.dnd.memberDndStatus();var n=TS.shared.getActiveModelOb();var i;if(n.is_mpim)i=TS.mpims.getDisplayName(n,false,false);else if(n.is_channel||n.is_group)i="#"+n.name;else i=n.name;var a={user:TS.model.user,model_ob:n,model_ob_name:i,in_dnd:r.in_dnd,is_snoozing:r.snoozed,readable_end_time:r.readable_end_time,cmd_key:TS.model.is_mac?"⌘":"ctrl",meta_key:TS.model.is_mac?"opt":"alt",unread_view_is_showing:TS.model.unread_view_is_showing};TS.menu.has_submenu=true;TS.menu.$menu.addClass("notifications_menu");TS.menu.$menu_header.html(TS.templates.notifications_header(a));TS.menu.$menu_items.html(TS.templates.notifications_items(a));TS.menu.$menu_items.on("click.menu","li",TS.menu.onNotificationsMenuItemClick);var s=TS.menu.$menu_items.find("#adjust_snooze_time");s.on("highlighted",function(){s.submenu({items_html:TS.templates.snooze_items(),onclick:TS.menu.onNotificationsMenuItemClick})}).on("unhighlighted",function(){if(TS.menu.$submenu&&!TS.menu.$submenu.hasClass("kb_active"))s.submenu("destroy")});TS.menu.start(t);TS.menu.positionAt($("#team_menu .notifications_menu_btn"),-10,24)},onNotificationsMenuItemClick:function e(t){var r=$(t.target).closest("[data-dnd-menu-action]");if(!r.length)return;var n=r.data("dnd-menu-action");var i=TS.dnd.memberDndStatus();if("turn_off"===n){if(i.snoozed)TS.dnd.endSnooze();else if(i.in_dnd)TS.dnd.endDnd()}else if("snooze"===n){var a=parseInt(r.data("snooze-length"),10);if(a&&!isNaN(a))TS.dnd.setSnooze(a)}else if("dnd_schedule"===n)TS.ui.prefs_dialog.start("notifications","#prefs_dnd");else if("enter_focus_mode"===n){if(!TS.boot_data.feature_focus_mode)return;TS.ui.focus_mode.start()}else if("channel_settings"===n){var s=TS.shared.getActiveModelOb();TS.ui.channel_prefs_dialog.start(s.id)}else if("notif_prefs"===n)TS.ui.prefs_dialog.start("notifications");TS.menu.end()},startWithFlexMenu:function e(t){if(TS.menu.isRedundantClick(t))return;if(TS.model.menu_is_showing)return;TS.menu.buildIfNeeded();TS.menu.clean();TS.menu.$menu_header.addClass("hidden").empty();var r;if(TS.boot_data.page_needs_enterprise)r=TS.i18n.t("Organization Directory","menu")();else r=TS.i18n.t("Workspace Directory","menu")();TS.menu.$menu_items.html(TS.templates.menu_flexpane_items({special_flex_panes:TS.boot_data.special_flex_panes,show_downloads:TS.model.supports_downloads,is_enterprise:TS.boot_data.page_needs_enterprise,show_user_groups:""!==TS.model.team.plan&&!TS.model.user.is_restricted,directory_title:r}));TS.menu.$menu_items.on("click.menu","li",TS.menu.onFlexMenuItemClick);TS.menu.start(t);TS.menu.$menu.addClass("flex_menu");TS.menu.$menu.attr("data-qa","flex_menu");var n=$("#flex_menu_toggle");var i=-(TS.menu.$menu.width()-n.width());var a=6+n.height();TS.menu.positionAt(n,i,a);TS.help.updateIcon();TS.client.whats_new.updateIcon();$("#flex_menu_toggle").addClass("menu_open");$("#flex_menu_callout").bind("click",function(){TS.menu.end()})},onFlexMenuItemClick:function e(t){var r=200;var i=$(this);var a=$(this).data("tab-id");if(a){var s=a;setTimeout(function(){if("files"===s){TS.client.ui.files.toggleFileList("all");TS.client.ui.files.filterFileList("all")}else if("team"===s)TS.client.ui.showTeamList();else if("groups"===s)TS.client.ui.showGroupsList();else{if("whats_new"===s){var e=!i.find("#whats_new_count").hasClass("hidden");if(e)TS.clog.track("WHATSNEW_ACTION",{action:"open_pane_badged",trigger:"flex_menu",step:TS.client.whats_new.getNewestID()});else TS.clog.track("WHATSNEW_ACTION",{action:"open_pane",trigger:"flex_menu",step:TS.client.whats_new.getNewestID()})}TS.client.ui.flex.openFlexTab(s)}},r)}else if($(this).data("filetype")){var o=$(this).data("filetype");var l=$("#file_list");if(!l.length||!l.children().length)if(TS.view.files.last_files_html)TS.view.files.last_files_html="";setTimeout(function(){TS.client.ui.files.toggleFileList("all");TS.client.ui.files.filterFileList(o);TS.view.files.setButtonState(o)},r)}else{var u=$(this).attr("id");if("help"===u){t.preventDefault();setTimeout(function(){n("flex_menu")},r)}}TS.menu.end()},startWithUserGroupMenu:function e(t,r){if(TS.menu.isRedundantClick(t))return;if(TS.model.menu_is_showing)return;TS.menu.buildIfNeeded();TS.menu.clean();TS.menu.user_group=TS.user_groups.getUserGroupsById(r);TS.menu.$menu.addClass("no_min_width");var n=TS.permissions.members.canCreateAndDeleteUserGroups()&&!TS.menu.user_group.date_delete;var i=TS.permissions.members.canCreateAndDeleteUserGroups()&&TS.menu.user_group.date_delete;TS.menu.$menu_header.addClass("hidden").empty();TS.menu.$menu_items.html(TS.templates.user_group_items({show_user_groups_edit:TS.permissions.members.canEditUserGroups(),show_user_groups_disable:n,show_user_groups_enable:i}));TS.menu.$menu_items.on("click.menu","li",TS.menu.onUserGroupMenuItemClick);TS.menu.start(t);TS.menu.positionAt($("#user_group_menu_toggle"),-(TS.menu.$menu.width()-$("#user_group_menu_toggle").width()),37)},onUserGroupMenuItemClick:function e(){var t=$(this).data("action");if("edit_info"===t)TS.ui.admin_user_groups.editInfo(TS.menu.user_group);else if("edit_members"===t)TS.ui.admin_user_groups.editMembers(TS.menu.user_group);else if("disable"===t)TS.ui.admin_user_groups.disable(TS.menu.user_group);else if("enable"===t)TS.ui.admin_user_groups.enable(TS.menu.user_group);else if("delete"===t)TS.ui.admin_user_groups.remove(TS.menu.user_group);TS.menu.end()},startWithSearchFilter:function e(t){if(TS.menu.isRedundantClick(t))return;if(TS.model.menu_is_showing)return;TS.menu.buildIfNeeded();var r={search_exclude_bots:TS.prefs.getPref("search_exclude_bots"),search_only_my_channels:TS.prefs.getPref("search_only_my_channels"),search_only_current_team:TS.prefs.getPref("search_only_current_team"),result_type:"files"===TS.search.filter?"files":"messages",is_enterprise:TS.boot_data.page_needs_enterprise};TS.menu.clean();TS.menu.$menu_header.addClass("hidden").empty();TS.menu.$menu.addClass("search_filter_menu");TS.menu.$menu_items.html(TS.templates.menu_search_filter_items(r));TS.menu.start(t);i();var n=$("#search_filter_menu_label");TS.menu.positionAt(n,-8,n.height()+10);$("#search_only_my_channels_cb").bind("change",function(){TS.prefs.setPrefByAPI({name:"search_only_my_channels",value:!$(this).prop("checked")})});$("#search_exclude_bots_cb").bind("change",function(){TS.prefs.setPrefByAPI({name:"search_exclude_bots",value:!$(this).prop("checked")})});$("#search_only_current_team_cb").bind("change",function(){TS.prefs.setPrefByAPI({name:"search_only_current_team",value:!$(this).prop("checked")})});TS.menu.search_filter_is_showing=true;$("#search_filter_menu_label").addClass("active")},startWithMentionsFilter:function e(t){if(TS.menu.isRedundantClick(t))return;if(TS.model.menu_is_showing)return;TS.menu.buildIfNeeded();var r={exclude_at_channels:TS.prefs.getPref("mentions_exclude_at_channels"),exclude_at_user_groups:TS.prefs.getPref("mentions_exclude_at_user_groups"),show_user_group_filter:true};TS.menu.clean();TS.menu.$menu_header.addClass("hidden").empty();TS.menu.$menu.addClass("search_filter_menu");TS.menu.$menu_items.html(TS.templates.menu_mentions_filter_items(r));TS.menu.start(t);i();var n=$("#mentions_filter_menu_label");TS.menu.positionAt(n,-8,n.height()+10);$("#exclude_at_channels_cb").bind("change",function(){TS.prefs.setPrefByAPI({name:"mentions_exclude_at_channels",value:!$(this).prop("checked")})});$("#exclude_at_user_groups_cb").bind("change",function(){TS.prefs.setPrefByAPI({name:"mentions_exclude_at_user_groups",value:!$(this).prop("checked")})});$("#mentions_filter_menu_label").addClass("active")},startWithEditTeamProfileListActions:function e(t,r,n){if(TS.menu.isRedundantClick(t))return;if(TS.model.menu_is_showing)return;TS.menu.buildIfNeeded();var i=$(t.target);var a=TS.team.getTeamProfileFieldById(i.data("id"));var s={id:a.id,hidden:!!(a&&a.is_hidden),is_scim:n.is_scim};TS.menu.clean();TS.menu.$menu_header.addClass("hidden").empty();TS.menu.$menu_items.html(TS.templates.admin_menu_edit_team_profile_list_action_items(s));TS.menu.$menu_items.on("click.menu","li",r);TS.menu.start(t);TS.menu.positionAt(i.find('[data-action="edit_team_profile_list_menu"]'),-(TS.menu.$menu.width()+6),0);TS.menu.keepInBounds()},startWithAllUnreadsSortOrderMenu:function e(t){if(TS.menu.isRedundantClick(t))return;if(TS.client.ui.checkForEditing(t))return;if(TS.model.menu_is_showing)return;TS.menu.buildIfNeeded();TS.menu.clean();var r={sort_order:TS.client.unread.getSortOrder(),is_paid_team:""!==TS.model.team.plan};TS.menu.has_submenu=true;TS.menu.$menu.addClass("all_unreads_sort_order_menu selectable");TS.menu.$menu_items.html(TS.templates.unread_sort_order_menu(r));TS.menu.$menu_items.on("click.menu","li",TS.menu.onAllUnreadsSortOrderMenuItemClick);TS.menu.addSubmenu(".priority",TS.templates.menu_help_submenu({icon:"ts_icon_emoji_objects",title:TS.i18n.t("Sorted by science","all_unreads")(),message:TS.i18n.t("This sorts your unreads based on how you use Slack.","all_unreads")()}),_.noop,true);TS.menu.start(t);TS.menu.positionAt($(".channel_header_info_count"),105,20)},onAllUnreadsSortOrderMenuItemClick:function e(t){var r=$(t.target).closest("[data-sort-order]");if(!r.length)return;var n=r.data("sortOrder");if(n===TS.client.unread.getSortOrder()){TS.menu.end();return}TS.prefs.setPrefLocal("all_unreads_sort_order",n);TS.prefs.setPrefByAPI({name:"all_unreads_sort_order",value:n});TS.prefs.all_unreads_sort_order_changed_sig.dispatch(n);TS.client.ui.unread.updateChannelHeader();TS.client.unread.reload();TS.menu.end()},startWithSearchableMemberListFilter:function e(t,r,n){if(TS.menu.isRedundantClick(t))return;if(TS.client.ui.checkForEditing(t))return;if(TS.model.menu_is_showing)return;TS.menu.buildIfNeeded();TS.menu.clean();var i={everyone_count:0,admins_count:0,guests_count:0,enterprise_filter_options:TS.boot_data.page_needs_enterprise,bots_count:0};if(TS.boot_data.page_needs_enterprise)_.merge(i,{is_enterprise:true,org_name:TS.model.team.enterprise_name,team_name:TS.model.team.name,everyone_count:0,org_members_count:0,org_admins_count:0,org_guests_count:0,org_bots_count:0});_.each(r,function(e,t){i[t+"_count"]=e});var a=[];_.each(r.external_teams,function(e,t){a.push({id:t,name:TS.teams.getTeamNameById(t)})});if(a.length>0)_.merge(i,{ext_teams:a.sort(TS.i18n.mappedSorter("name"))});TS.menu.$menu.width($(t.target).outerWidth());TS.menu.$menu.addClass("searchable_member_list_filter_menu");TS.menu.$menu_items.html(TS.templates.searchable_member_list_filter_items(i));TS.menu.$menu_items.on("click.menu","li",function(e){TS.menu.end();n(e)});TS.menu.start(t);TS.menu.positionAt($(".searchable_member_list_filter"),16,56)},startWithSharedInvitesMenu:function e(t){if(TS.menu.isRedundantClick(t))return;if(TS.menu.menu_is_showing)return;TS.menu.buildIfNeeded();TS.menu.clean();TS.menu.$menu_items.html(TS.templates.shared_invites_modal());TS.menu.start(t);TS.menu.$menu_items.on("click",'[data-action="admin_invites_modal"]',function(){TS.menu.end()});TS.menu.keepInBounds()},startWithSoundsMenu:function e(t,r){if(TS.menu.isRedundantClick(t))return;if(TS.menu.menu_is_showing)return;TS.menu.buildIfNeeded();var n=TS.boot_data.notification_sounds;n=_.reject(n,{value:"none"});var i={notification_sounds:n};TS.menu.clean();TS.menu.$menu_header.addClass("hidden").empty();TS.menu.$menu_items.html(TS.templates.menu_sound_items(i));TS.menu.start(t);TS.menu.$menu_items.on("click.menu",'[data-action="set_sound"]',function(e){var t=$(this).data("sound");if(!t)return;e.preventDefault();r(t);TS.menu.end()}).on("click.menu",'[data-action="play_sound"]',function(e){var t=$(this).data("sound");if(!t)return;e.preventDefault();TS.sounds.play(t,{ignore_mute:true})});TS.menu.keepInBounds()},startWithGeneric:function e(t,r,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(TS.menu.isRedundantClick(t))return;if(TS.menu.menu_is_showing)return;TS.menu.buildIfNeeded();var a="";_.each(r,function(e){a+=TS.templates.menu_generic_item({label:e.label,value:e.value})});TS.menu.clean();TS.menu.$menu_header.empty();if(i.header_text)TS.menu.$menu_header.html(TS.templates.menu_generic_header({header_text:i.header_text}));else TS.menu.$menu_header.addClass("hidden");TS.menu.$menu_items.html(a);var s={};s.menu_class=i.menu_class;TS.menu.start(t,void 0,s);TS.menu.$menu_items.on("click.menu","a[data-value]",function(){t.preventDefault();n($(this).data("value"));TS.menu.end()});TS.menu.keepInBounds()},positionAt:function e(t,r,n){r=r||0;n=n||0;var i=t.offset();var a=i.left+r;var s=i.top+n;TS.menu.$menu.css({top:s,left:a})},isRedundantClick:function e(t){if(TS.isPartiallyBooted()){t.preventDefault();TS.incremental_boot.userDidInteractWithUI();return true}if(t&&TS.menu.last_e&&(t.target==TS.menu.last_e.target||t.currentTarget==TS.menu.last_e.currentTarget))return true;return false},isLarge:function e(){return TS.menu&&TS.menu.$menu&&TS.menu.$menu.find("li").length>TS.menu.large_dom_trigger},start:function e(n,i,a){a=a||{};TS.menu.last_e=n;if(!t){var s=$(n.target).offset();var o=s.left+$(n.target).width()+10;var l=s.top;if(i){o=n.pageX+10;l=n.pageY+10}}if(_.isFunction(a.needs_to_remain_open))TS.menu.needs_to_remain_open=a.needs_to_remain_open;$(".tooltip").hide();TS.tips.hideAll();$(n.currentTarget).addClass("active");TS.menu.$target_element=$(n.currentTarget);TS.model.menu_is_showing=true;var u=TS.menu.$menu;if(a.onClose)u.one("closed",a.onClose);if(a.menu_class)u.addClass(a.menu_class);var d=TS.menu.isLarge();if(!t)u.css({top:l,left:o});var c=u.find("#menu_items_scroller");c.scrollTop(0);if(a.attach_to_target_at_full_width)TS.menu.$target_element.after(u);else if(TS.client)u.appendTo($("#client-ui"));else u.appendTo($("body"));if(a.keep_menu_open_if_target_clicked_again)TS.menu.$menu.addClass("keep_menu_open_if_target_clicked_again");if(!d&&!t){u.css("opacity",0);u.stop().transition({opacity:1},200)}else u.css("opacity",1);u.find(".menu_close").on("click",TS.menu.end);if(!a.ignore_bounds)TS.menu.keepInBounds();TS.ui.utility.updateClosestMonkeyScroller(c,true);if(TS.menu.menu_lazy_load&&TS.menu.menu_lazy_load.detachEvents)TS.menu.menu_lazy_load.detachEvents();TS.menu.menu_lazy_load=TS.menu.$menu_items.find(".lazy").lazyload({container:$("#menu_items_scroller"),all_images_same_size:true,throttle:250});if(!a.ignore_bounds)$(window).bind("resize",TS.menu.keepInBounds);$(window.document).bind("keydown",TS.menu.onKeyDown);$("html").bind("mousedown touchstart",TS.menu.onMouseDown);var m=u.find(".menu_list");var f=m.length?m:u.find("#menu_items");if(TS.menu.has_submenu)TS.kb_nav.start(f,"li:not(.divider)",u,{onLeftKeyDownIfSubmenuExists:TS.menu.onLeftKeyDownIfSubmenuExists,onRightKeyDownIfSubmenuExists:TS.menu.onRightKeyDownIfSubmenuExists});else TS.kb_nav.start(f,"li:not(.divider)");var p=m.length?m.first().find("a, button").first():null;if(TS.ui&&TS.ui.a11y)TS.ui.a11y.focusAndAddTabindex(p);t=false;r=a.on_esc},clean:function e(){TS.menu.$menu_footer.empty();TS.menu.$menu_header.removeClass("hidden");TS.menu.$menu.removeClass("no_min_width no_max_width profile_preview flex_menu search_filter_menu popover_menu no_icons team_menu file_menu notifications_menu all_unreads_sort_order_menu searchable_member_list_filter_menu selectable member_file_filter_menu app_card keep_menu_open_if_target_clicked_again member_file_filter_menu").css("max-height","");TS.menu.$menu.removeAttr("data-qa");TS.menu.$menu.find("#menu_items_scroller").css("max-height","");TS.menu.$menu.find(".arrow, .arrow_shadow").remove();TS.menu.$menu_items.off("mouseenter.section_header");TS.menu.$menu.removeClass("narrow_menu");TS.menu.$menu_body.off("mouseenter.section_header");TS.menu.needs_to_remain_open=void 0;TS.menu.$menu.removeClass("date_picker");if(TS.boot_data.page_needs_enterprise){TS.menu.$menu_list_container.html('<div id="menu_list" role="menu"></div>').removeClass("populated");TS.menu.$menu_list=TS.menu.$menu.find("#menu_list");TS.menu.$menu.off("keydown","#file_member_filter .member_filter")}TS.menu.$menu.removeAttr("data-model-ob-id");TS.menu.$menu.removeAttr("data-thread-ts");if(TS.SearchableMemberList&&TS.SearchableMemberList.get("member_file_filter_menu")){TS.menu.$menu.find(".searchable_member_list").remove();TS.SearchableMemberList.get("member_file_filter_menu").destroy()}if(TS.menu.$menu.find(".member_item")){TS.menu.$menu.find(".member_item").remove();TS.menu.$menu.find(".list_items").css("height",0)}r=null},end:function e(){if(_.isFunction(TS.menu.needs_to_remain_open)&&TS.menu.needs_to_remain_open())return;if(TS.menu.$submenu&&TS.menu.$submenu_parent)TS.menu.$submenu_parent.submenu("destroy");TS.menu.$menu.width("");TS.model.menu_is_showing=false;TS.menu.menu_items_hidden=true;TS.menu.has_submenu=false;TS.menu.$submenu_parent=null;TS.menu.submenu_template_args={};if(TS.menu.did_start_slack_menu_signal_listeners)TS.menu.stopListeningForRebuildWorthiness();var r=TS.menu.$menu;var n=function e(){if(TS.model.menu_is_showing)return;setTimeout(function(){if(!TS.model.menu_is_showing)TS.menu.last_e=null},50);r.detach();TS.menu.$menu_header.empty();TS.menu.$menu_footer.empty();TS.menu.$menu_items.empty();TS.menu.$menu_items.removeClass("hidden");TS.menu.$menu_body.empty();TS.menu.clean()};if(!TS.menu.isLarge()&&!t)r.stop().transition({opacity:0},200,n);else n();r.trigger("closed");if(TS.menu.$target_element){TS.menu.$target_element.removeClass("active");TS.menu.$target_element=null}if(TS.menu.$secondary_target_element){TS.menu.$secondary_target_element.removeClass("active");TS.menu.$secondary_target_element=null}TS.menu.user_group=null;TS.menu.$menu_header.unbind("click.menu");TS.menu.$menu_items.off("click.menu");TS.menu.$menu_body.off("click.menu");$(window).unbind("resize",TS.menu.keepInBounds);$(window.document).unbind("keydown",TS.menu.onKeyDown);$("html").unbind("mousedown touchstart",TS.menu.onMouseDown);TS.members.view.team_filter_changed_sig.remove(TS.kb_nav.clearHighlightedItem);$(".file_list_item.active").removeClass("active");TS.tips.unhideAll();TS.menu.search_filter_is_showing=false;$("#search_filter_menu_label").removeClass("active");$("#mentions_filter_menu_label").removeClass("active");$("#flex_menu_toggle").removeClass("menu_open");$("#channel_actions_toggle").removeClass("active");if($("#menu_member_dm_input").length)TS.utility.contenteditable.unload($("#menu_member_dm_input"));r.removeClass("narrow_menu");setTimeout(function(){TS.menu.file.file_list_menu_up=false;$(".inline_file_preview_container.file_menu_open, .file_container.file_menu_open").removeClass("file_menu_open")},100);if(TS.menu.menu_lazy_load&&TS.menu.menu_lazy_load.detachEvents){TS.menu.menu_lazy_load.detachEvents();TS.menu.menu_lazy_load=null}TS.kb_nav.end();if(TS.client&&"team"!==TS.model.ui.active_tab_id&&"details"!==TS.model.ui.active_tab_id)TS.client.flex_pane.stopLocalTimeInterval();TS.menu.menu_closed_sig.dispatch()},onKeyDown:function e(t){var n=TS.utility.keymap;var i=t.which;var a=t.metaKey||t.ctrlKey||t.altKey;if(i==n.esc){if(TS.utility.contenteditable.hasFocus($("#menu_member_dm_input")))return;t.stopPropagation();t.preventDefault();TS.menu.end();if(r)r()}else if(!a&&!TS.utility.isArrowKey(i)&&i!=n.tab&&i!=n.enter&&i!=n.shift){TS.kb_nav.clearHighlightedItem();TS.utility.contenteditable.focus($("#menu_member_dm_input"))}},onLeftKeyDownIfSubmenuExists:function e(){var t=false;if(TS.menu.$submenu&&TS.menu.$submenu.hasClass("kb_active")){TS.menu.$submenu.removeClass("kb_active");TS.kb_nav.end();TS.kb_nav.highlightItemWithKey(TS.menu.$submenu_origin);var r=TS.menu.$menu.find(".menu_list");var n=r.length?r:TS.menu.$menu.find("#menu_items");TS.kb_nav.start(n,"li:not(.divider)",TS.menu.$menu,{onLeftKeyDownIfSubmenuExists:TS.menu.onLeftKeyDownIfSubmenuExists,onRightKeyDownIfSubmenuExists:TS.menu.onRightKeyDownIfSubmenuExists});if(-1===["member_current_status_item","switch_teams"].indexOf(TS.menu.$submenu_origin.attr("id")))TS.menu.$submenu_origin.submenu("destroy");t=true}return t},onRightKeyDownIfSubmenuExists:function e(){var t=false;if(TS.kb_nav.getHighlightedItem()&&TS.kb_nav.getHighlightedItem().data("has-submenu"))if(!TS.menu.$submenu)TS.kb_nav.getHighlightedItem().submenu({items_html:TS.templates.snooze_items(),onclick:TS.menu.onNotificationsMenuItemClick});if(TS.menu.$submenu){if(TS.menu.$submenu.hasClass("kb_active")){TS.menu.$submenu.removeClass("kb_active");TS.menu.end()}else{TS.menu.$submenu.addClass("kb_active");TS.kb_nav.end();TS.kb_nav.highlightItemWithKey(TS.menu.$submenu.find("li:not(.divider)").first());TS.kb_nav.start(TS.menu.$submenu.find("ul"),"li:not(.divider)",TS.menu.$submenu,{onLeftKeyDownIfSubmenuExists:TS.menu.onLeftKeyDownIfSubmenuExists,onRightKeyDownIfSubmenuExists:TS.menu.onRightKeyDownIfSubmenuExists})}t=true}return t},onMouseDown:function e(t){var r=$(t.target);if(TS.menu.$menu&&TS.menu.$menu.hasClass("keep_menu_open_if_target_clicked_again")&&r.is(TS.menu.$target_element))return;if(0===r.closest("#menu, .submenu, .trap_menu_clicks").length||r.hasClass("popover_mask"))TS.menu.end()},keepInBounds:function e(){if(window.requestAnimationFrame)TS.utility.rAF(TS.menu.keepInBoundsThrottled);else TS.menu.keepInBoundsThrottled()},keepInBoundsThrottled:function e(){var t=TS.menu.$menu;var r=10;var n=t.dimensions_rect();var i={top:0+r,right:$(window).width()-r,bottom:$(window).height()-(r+14),left:0+r};if(TS.utility.doesRectContainRect(i,n))return;if(n.left<i.left)t.css("left",i.left);else if(n.right>i.right)t.css("left",Math.max(i.left,i.right-n.width));if(n.top<i.top)t.css("top",i.top);else if(n.bottom>i.bottom)t.css("top",Math.max(i.top,i.bottom-n.height+$(window).scrollTop()))},addSubmenu:function e(t,r,n,i){var a=TS.menu.$menu_items.find(t);a.on("highlighted",function(){a.submenu({items_html:r,onclick:n,help:i})}).on("unhighlighted",function(){if(TS.menu.$submenu&&!TS.menu.$submenu.hasClass("kb_active"))a.submenu("destroy")})},_registerCurrentStatusInput:function e(){TS.menu._unregisterCurrentStatusInput();TS.menu._current_status_input=new TS.ui.CurrentStatusInput({$parent:$("#slack_menu_current_status_submenu"),onEscape:TS.menu.end,onSave:TS.menu.end});TS.menu.$menu_body.find("#member_current_status_item").on("click.current_status_item",function(){if(TS.menu._current_status_input)TS.menu._current_status_input.focus()})},_unregisterCurrentStatusInput:function e(){if(TS.menu._current_status_input){TS.menu._current_status_input.destroy();TS.menu._current_status_input=null}TS.menu.$menu_body.find("#member_current_status_item").off(".current_status_item")}});var e=3;var t=false;var n=function e(t){TS.help_modal.start();TS.clog.track("HELP_MODAL_ACTION",{action:"open_modal",trigger:t})};var i=function e(){var t=TS.menu.$menu;t.addClass("popover_menu");t.prepend('<span class="arrow"></span><span class="arrow_shadow"></span>')};var a=function e(t){var r=3;var n=TS.menu.$target_element.outerHeight()+r;var i=0;if(t)i=TS.menu.$target_element.outerWidth()-TS.menu.$menu.outerWidth();return{left:i,top:n}};var s=function t(r){var n=_.without(_.get(TS.model.user,"enterprise_user.teams",[]),TS.model.team.id);if(!n.length)return;var i=_.partition(n,TS.teams.getTeamById);var a=i[0];var s=i[1];var l=s.slice(0,Math.max(0,e-a.length));if(!l.length)return;TS.teams.ensureTeamsArePresent(l).then(function(){if(!TS.model.menu_is_showing||!TS.menu.did_start_slack_menu_signal_listeners)return;o(r)})};var o=function e(r){var n=$(".menu.submenu").data("origin-id");t=true;TS.menu.startWithTeamAndUserRebuild(r);t=false;if(n)$("#"+n).trigger("highlighted")};var l=function e(t,r,n){if(!TS.model.menu_is_showing)return;var i=$("#toggle-subscription-status");if(i.attr("data-model-ob-id")!==t||i.attr("data-msg-ts")!==r)return;i.attr("data-subscribed",n.subscribed);i.removeClass("disabled");TS.menu.keepInBounds()};var u=function e(t){var r=1e4;var n=$("#limit_meter");var i=$("#limit_meter_circle_progress");var a;var s="rgba(0, 0, 0, .1)";var o;var l={r:69,g:186,b:133};var u={r:255,g:197,b:101};var d={r:243,g:61,b:95};if(t<=r){a=t/r;s="rgba(0, 0, 0, .1)";var c=_.mergeWith(l,u,function(e,t){return Math.floor(e*(1-a)+t*a)});o="rgb("+c.r+", "+c.g+", "+c.b+")"}else{a=Math.atan((t-r)/2500-3)/Math.PI+.5;s="rgb("+u.r+", "+u.g+" , "+u.b+")";o="rgb("+d.r+", "+d.g+", "+d.b+")"}i.circleProgress({value:a,size:50,animation:{duration:20},thickness:4,fill:{color:o},emptyFill:s,startAngle:.425*-Math.PI});n.on("click",function(){TS.clog.track("UPGRDEXP_LIMIT_METER",{limit_meter_messages_count:t,contexts:{ui_context:{action:"click",step:"slack_menu"}}})})};$.widget("TS.submenu",{_create:function e(){this.element.data("has-submenu",true);var t=TS.i18n.t("submenu","menu_source")();var r='<div class="menu submenu'+(this.options.help?" submenu_help":"")+'" data-origin-id="'+this.element.attr("id")+'" data-model-ob-id="'+this.element.data("modelObId")+'"><ul aria-hidden="true" aria-label="'+t+'">'+this.options.items_html+"</ul></div>";var n=7;var i=11;var a=TS.menu.$menu.offset().left+TS.menu.$menu.width()+n;var s=this.element.offset().top-i;this.$submenu=$(r);this.$submenu.appendTo("body");TS.menu.$submenu=this.$submenu;TS.menu.$submenu_origin=this.element;if(a+this.$submenu.width()>window.innerWidth){var o=TS.menu.$menu.offset().left-n;var l=window.innerWidth-a;if(o>l)a=TS.menu.$menu.offset().left-this.$submenu.width()-n}if(s+this.$submenu.height()>window.innerHeight){var u=s;var d=Math.abs(window.innerHeight-(s+this.$submenu.height()));if(u>d)s=window.innerHeight-this.$submenu.height()-i;else s=i}this.$submenu.css({position:"absolute",left:a+"px",top:s+"px"});var _=this.options.onclick;if(_)this.$submenu.on("click",function(e){_.call(this,e)})},_destroy:function e(){TS.menu.$submenu=null;TS.menu.$submenu_origin=null;if(this.options.ondestroy)this.options.ondestroy();this.$submenu.remove()}})})();var r},4802:function(e,t){(function(){TS.registerModule("menu.app",{onStart:function e(){},active_app:null,active_app_bot_id:null,app_item_click_sig:new signals.Signal,startWithApp:function t(r,n,i,a,s,o){if(TS.menu.isRedundantClick(r))return;if(TS.client.ui.checkForEditing(r))return;if(!s){TS.menu.buildIfNeeded();TS.menu.clean()}if(!i)i=TS.model.user.team_id;TS.menu.app.active_app_bot_id=n;TS.menu.app.active_app_team_id=i;TS.menu.app.active_app_member_id=_.get(r,"target.dataset.memberId",null);function l(e){var t=_.get(e,"bot_user.id");var r=TS.shared.getActiveModelOb();if(t&&(TS.model.active_channel_id||TS.model.active_group_id))return TS.membership.ensureChannelMembershipIsKnownForUsers(r.id,[t]).then(function(){return e});return e}function u(t){TS.menu.app.active_app=t;if(s)if(TS.menu.app_team_id)TS.client.ui.app_profile.openWithApp(TS.menu.app.active_app,TS.menu.app.active_app_bot_id,TS.menu.app.active_app_team_id);else TS.client.ui.app_profile.openWithApp(TS.menu.app.active_app,TS.menu.app.active_app_bot_id);else e(r,a,o)}return TS.apps.promiseToGetFullAppProfile(n,i,null,true).then(l).then(u)},onAppItemClick:function e(t){var r=$(this);var n=r.data("action");var i=TS.menu.app.active_app.is_xoxa_app?_.get(TS.menu.app.active_app,"app_user_id"):_.get(TS.menu.app.active_app,"bot_user.id");if("view_details"===n)if(TS.apps.isAppSpaceEnabled()&&i)TS.ims.startImByMemberId(i).then(function(){TS.client.ui.app_space.toggleView("about")});else TS.client.ui.app_profile.openWithApp(TS.menu.app.active_app,TS.menu.app.active_app_bot_id,TS.menu.app.active_app_team_id);else if("files"===n){t.preventDefault();TS.view.files.clearFilter();TS.client.ui.files.filterFileList(i)}else if("invite_to_channel"===n){t.preventDefault();TS.ui.invite.showInviteMemberToChannelDialog(i)}else if("app_support"===n)TS.help_modal.start();else if(TS.boot_data.feature_wta_management_modal&&TS.menu.app.active_app.is_xoxa_app&&"settings"===n){t.preventDefault();TS.interop.mountAppManagementModal(TS.boot_data.team_id,document.getElementById("app_management_modal_mount_point"),{appProfile:TS.menu.app.active_app,userIsAppmin:TS.apps.isAppmin()})}TS.clog.track("USER_CARD_CLICK",{app_id:TS.menu.app.active_app.id,bot_id:TS.menu.app.active_app_bot_id});TS.menu.app.end()},end:function e(){TS.menu.app.active_app=null;TS.menu.end()}});var e=function e(t,r,n){var i;if(n){i={app_id:TS.menu.app.active_app.id,bot_id:TS.menu.app.active_app_bot_id,support_url:TS.menu.app.active_app.support_url,is_xoxa_app:TS.menu.app.active_app.is_xoxa_app,homepage_url:TS.menu.app.active_app.url,is_distributed:TS.menu.app.active_app.is_distributed,is_slack_integration:TS.menu.app.active_app.is_slack_integration,is_custom_integration:_.get(TS.menu.app.active_app,"config.is_custom_integration")};TS.menu.$menu_header.addClass("hidden").empty();TS.menu.$menu_items.html(TS.templates.menu_app_items(i));TS.menu.$menu_footer.addClass("hidden").empty();TS.menu.start(t,r);var a=$("#channel_actions_toggle");TS.menu.positionAt(a,6,a.height())}else{i=TS.apps.constructTemplateArgsForCardAndProfile(TS.menu.app.active_app,TS.menu.app.active_app_bot_id,TS.menu.app.active_app_member_id,TS.menu.app.active_app_team_id);var s=_.get(TS.menu.app.active_app,"bot_user.id",false);if(!s){var o=TS.members.getMemberById(TS.menu.app.active_app_member_id);if(o&&o.is_bot)s=o.id}TS.menu.$menu_header.html(TS.templates.menu_app_card_header(i));TS.menu.$menu_items.html(TS.templates.menu_app_card_items(i));TS.menu.$menu_footer.html(TS.templates.menu_app_card_footer(i));TS.menu.$menu_header.find(".emoji_replace_on_load").each(function(){var e=$(this).html();e=TS.emoji.graphicReplace(e);$(this).html(e)});TS.menu.start(t,r,{menu_class:"app_card"});if(s){var l=TS.utility.keymap;var u=false;$("[data-js=app_card_dm]").bind("keydown",function(e){var t=$(this);if(e.which==l.enter&&!e.shiftKey&&!u)if(""!==$.trim(t.val())){e.preventDefault();TS.ims.startImByMemberId(s,false,t.val());TS.menu.app.end();u=true}})}if(!i.hide_link_to_app_profile)TS.menu.$menu_header.on("click",function(){var e=TS.menu.app.active_app.is_xoxa_app?_.get(TS.menu.app.active_app,"app_user_id"):_.get(TS.menu.app.active_app,"bot_user.id");if(TS.apps.isAppSpaceEnabled()&&e)TS.ims.startImByMemberId(e).then(function(){TS.client.ui.app_space.toggleView("about")});else TS.client.ui.app_profile.openWithApp(TS.menu.app.active_app,TS.menu.app.active_app_bot_id,TS.menu.app.active_app_team_id);TS.menu.$menu_header.off();TS.clog.track("USER_CARD_CLICK",{app_id:TS.menu.app.active_app?TS.menu.app.active_app.id:"",bot_id:TS.menu.app.active_app_bot_id});TS.menu.app.end()});else TS.menu.$menu_header.off();TS.menu.$menu_items.on("click.menu","[data-member-profile-link]",function(e){e.preventDefault();TS.client.ui.previewMember($(this).data("member-profile-link"))});TS.menu.keepInBounds()}TS.menu.$menu_items.on("click.menu","li",TS.menu.app.onAppItemClick)}})()},4803:function(e,t){(function(){TS.registerModule("menu.channel",{onStart:function e(){},channel:null,startWithChannel:function t(r,n){if(TS.menu.isRedundantClick(r))return;if(TS.client.ui.checkForEditing(r))return;if(!TS.model.menu_is_showing)e=void 0;TS.menu.buildIfNeeded();TS.menu.clean();TS.menu.channel.channel=TS.channels.getChannelById(n)||TS.mpims.getMpimById(n);var i=TS.menu.channel.channel;var a=TS.prefs.getTeamPref("allow_email_ingestion");TS.menu.$menu_header.addClass("hidden").empty();var s={channel:i,user:TS.model.user,show_email_item:a};if(TS.notifs.isCorGMuted(i.id))s.channel_is_muted=true;if(i.is_mpim){s.show_mpim_create=TS.permissions.members.canCreateMpims();s.show_mpim_convert=TS.permissions.members.canCreateGroups()&&!TS.shared.isModelObShared(i);s.show_export_history=TS.permissions.members.canExportMessageHistory(TS.menu.channel.channel);if(""!==TS.model.team.plan&&TS.prefs.getTeamPref("allow_retention_override")&&!TS.shared.isModelObShared(i))s.show_message_retention=true}else{s.can_delete_channel=TS.model.user.is_admin&&i.is_channel&&!TS.channels.isChannelRequired(i);if(!TS.channels.isChannelRequired(i)||TS.permissions.members.canPostInChannel(i))if(0===i.purpose.last_set&&!TS.model.user.is_ultra_restricted&&i.is_member)s.show_purpose_item=true;if(i.is_member&&(!TS.channels.isChannelRequired(i)||TS.permissions.members.canPostInChannel(i)))s.show_advanced_item=true;if(TS.boot_data.page_needs_enterprise){var o=TS.permissions.members.canCreateConvertOrgSharedChannels();if(s.show_advanced_item)if(!o&&TS.shared.isModelObOrgShared(i))s.show_advanced_item=false;s.is_not_allowed_integrations=true}s.is_moved=i.is_moved}if(TS.apps.permissions.areXoxaAppsInstalled())s.show_add_apps=true;TS.menu.$menu_items.html(TS.templates.menu_channel_items(s));TS.menu.$menu_header.bind("click.menu",TS.menu.channel.onChannelHeaderClick);TS.menu.$menu_items.on("click.menu","li",TS.menu.channel.onChannelItemClick);TS.kb_nav.setSubmitItemHandler(TS.menu.channel.onChannelItemClick);TS.menu.start(r);TS.menu.$menu.attr("data-qa","channel_menu");TS.menu.$menu.addClass("narrow_menu");TS.ui.date_picker.getOldestMsgTs();if(!e)e=$(r.target).closest("#channel_name").length;var l=e?$("#channel_name"):$("#channel_actions_toggle");var u=l.height();var d=e?u+6:u;var _=e?18:6;TS.menu.positionAt(l,_,d)},onChannelHeaderClick:function e(t){t.preventDefault()},onChannelItemClick:function e(t){var r=$(this).attr("id");var n=TS.menu.channel.channel;if($(this).hasClass("disabled")){TS.menu.channel.end();return}if("channel_join_item"===r){t.preventDefault();if(TS.model.archive_view_is_showing&&TS.client.archives.current_model_ob.id==TS.menu.channel.channel.id)TS.channels.joinById(TS.menu.channel.channel.id);else TS.channels.displayChannel({id:TS.menu.channel.channel.id})}else if("channel_details_item"===r){t.preventDefault();if(TS.model.ui_state.flex_visible&&"details"===TS.model.ui_state.flex_name)$("#details_tab").highlight(null,"channel_page_details_highlighter");else TS.client.ui.flex.openFlexTab("details")}else if("channel_display_item"===r){t.preventDefault();TS.channels.displayChannel({id:TS.menu.channel.channel.id})}else if("channel_close_archived_item"===r){t.preventDefault();TS.channels.closeArchivedChannel(TS.menu.channel.channel.id)}else if("channel_leave_item"===r){t.preventDefault();TS.channels.leave(TS.menu.channel.channel.id)}else if("channel_email_item"===r);else if("channel_advanced_item"===r){t.preventDefault();TS.ui.channel_options_dialog.start(TS.menu.channel.channel.id)}else if("channel_convert_item"===r){t.preventDefault();TS.ui.channel_options_dialog.start(TS.menu.channel.channel.id,"manage_teams")}else if("channel_delete_item"===r){t.preventDefault();TS.ui.channel_options_dialog.start(TS.menu.channel.channel.id,"delete")}else if("channel_unarchive_item"===r){t.preventDefault();var i=function e(t,r){if(t)return;var n;if("restricted_action"===r.error)n=TS.i18n.t("<p>You don’t have permission to un-archive channels.</p><p>Talk to your Workspace Owner.</p>","channel_menu")();else n=TS.i18n.t("Un-archiving failed with error","channel_menu")+' "'+r.error+'"';setTimeout(TS.generic_dialog.alert,100,n)};TS.api.call("conversations.unarchive",{channel:TS.menu.channel.channel.id}).then(function(e){var t=e.data,r=e.args,n=e.request_id;var a=true;i(a,t,r,n);return{data:t,args:r,request_id:n}},function(e){var t=e.data,r=e.args,n=e.request_id;var a=false;i(a,t,r,n);return{data:t,args:r,request_id:n}})}else if("channel_archives_item"===r);else if("channel_jump_item"===r){t.preventDefault();TS.menu.startWithDatePicker(t);return}else if("channel_mute_item"===r){t.preventDefault();TS.notifs.muteOrUnmuteCorG(n.id)}else if("channel_invite_item"===r){t.preventDefault();TS.ui.channel_invite_modal.startInviteToChannelModal(TS.menu.channel.channel.id)}else if("channel_notification_prefs"===r){t.preventDefault();TS.ui.channel_prefs_dialog.start(n.id)}else if("channel_add_service_item"===r);else if("channel_mpim_message_retention"===r){t.preventDefault();TS.ui.channel_options_dialog.start(n.id,"retention")}else if("channel_mpim_export_history"===r){t.preventDefault();TS.ui.channel_options_dialog.start(n.id,"export")}else if("channel_create_mpim_item"===r){t.preventDefault();setTimeout(function(){TS.ui.im_browser.startWithMpim(n)},1)}else if("convert_to_private_channel"===r){t.preventDefault();var a=TS.shared.getActiveModelOb();TS.ui.mpim_conversion_modal.startMpimConversionModal(a)}else if("channel_add_apps_item"===r){t.preventDefault();TS.ui.apps_browser.startAddApps()}else{TS.warn("not sure what to do with clicked element id:"+r);return}TS.menu.channel.end()},startWithChannelPickerForChange:function e(r,n){if(TS.menu.isRedundantClick(r))return;TS.menu.buildIfNeeded();TS.menu.clean();var i=TS.members.getMemberById(n);var a=[];var s=[];$.each(TS.channels.getUnarchivedChannelsForUser(),function(e,t){if(!i.channels.hasOwnProperty(t.id))a.push(t)});$.each(TS.groups.getUnarchivedGroups(),function(e,t){if(!i.groups.hasOwnProperty(t.id))s.push(t)});var o={user_id:n,channels:a,groups:s};TS.menu.$menu_header.html(TS.templates.menu_channel_picker_header(o));TS.menu.$menu_items.html(TS.templates.menu_channel_picker(o)).css("max-height",274);TS.menu.$menu_items.on("click.menu","li",TS.menu.channel.onChannelPickerItemClickChangeChannel);TS.menu.start(r);var l=$(r.target).closest(".pill");if("mobile"===TS.boot_data.app)TS.menu.positionAt(l,16-l.offset().left,0);else TS.menu.positionAt(l,-TS.menu.$menu.width()+l.outerWidth(),l.height()+4);TS.menu.$menu.scrollintoview({duration:500,offset:"bottom",px_offset:-25});t();TS.kb_nav.setAllowHighlightWithoutBlurringInput(true)},onChannelPickerItemClickChangeChannel:function e(){var t=$(this).data("user-id");var r=$(this).data("channel-id");var n=$(this).data("group-id");if(r)TS.api.call("users.admin.changeURAChannel",{user:t,channel:r}).then(function(e){var t=e.data,r=e.args,n=e.request_id;var i=true;if(TS.web.admin.onMemberURAChanged)TS.web.admin.onMemberURAChanged(i,t,r,n);return{data:t,args:r,request_id:n}},function(e){var t=e.data,r=e.args,n=e.request_id;var i=false;if(TS.web.admin.onMemberURAChanged)TS.web.admin.onMemberURAChanged(i,t,r,n);return{data:t,args:r,request_id:n}});else if(n)TS.api.call("users.admin.changeURAChannel",{user:t,channel:n}).then(function(e){var t=e.data,r=e.args,n=e.request_id;var i=true;if(TS.web.admin.onMemberURAChanged)TS.web.admin.onMemberURAChanged(i,t,r,n);return{data:t,args:r,request_id:n}},function(e){var t=e.data,r=e.args,n=e.request_id;var i=false;if(TS.web.admin.onMemberURAChanged)TS.web.admin.onMemberURAChanged(i,t,r,n);return{data:t,args:r,request_id:n}});TS.menu.channel.end()},startWithChannelPickerForInvite:function e(r,n){if(TS.menu.isRedundantClick(r))return;TS.menu.buildIfNeeded();TS.menu.clean();var i=TS.members.getMemberById(n);var a=[];var s=[];$.each(TS.channels.getUnarchivedChannelsForUser(),function(e,t){if(!i.channels.hasOwnProperty(t.id))a.push(t)});$.each(TS.groups.getUnarchivedGroups(),function(e,t){if(!i.groups.hasOwnProperty(t.id))s.push(t)});var o={user_id:n,channels:a,groups:s};TS.menu.$menu_header.html(TS.templates.menu_channel_picker_header(o));TS.menu.$menu_items.html(TS.templates.menu_channel_picker(o)).css("max-height",274);TS.menu.$menu_items.on("click.menu","li",TS.menu.channel.onChannelPickerItemClickInviteChannel);TS.menu.start(r);var l=$(r.target).closest(".pill");if("mobile"===TS.boot_data.app)TS.menu.positionAt(l,16-l.offset().left,0);else TS.menu.positionAt(l,10-l.width(),l.height()+4);TS.menu.$menu.scrollintoview({duration:500,offset:"bottom",px_offset:-25});t();TS.kb_nav.setAllowHighlightWithoutBlurringInput(true)},onChannelPickerItemClickInviteChannel:function e(){var t=$(this).data("user-id");var r=$(this).data("channel-id");var n=$(this).data("group-id");var i=r||n;if(i)TS.api.call("conversations.invite",{users:t,channel:i}).then(function(e){var t=e.data,i=e.args,a=e.request_id;var s=true;if(r&&TS.web.admin.onMemberInviteChannel)TS.web.admin.onMemberInviteChannel(s,t,i,a);else if(n&&TS.web.admin.onMemberInviteGroup)TS.web.admin.onMemberInviteGroup(s,t,i,a);return{data:t,args:i,request_id:a}},function(e){var t=e.data,i=e.args,a=e.request_id;var s=false;if(r&&TS.web.admin.onMemberInviteChannel)TS.web.admin.onMemberInviteChannel(s,t,i,a);else if(n&&TS.web.admin.onMemberInviteGroup)TS.web.admin.onMemberInviteGroup(s,t,i,a);return{data:t,args:i,request_id:a}});TS.menu.channel.end()},startWithChannelPicker:function e(r,n,i){if(TS.menu.isRedundantClick(r))return;TS.menu.buildIfNeeded();TS.menu.clean();var a=[];var s=[];var o=[];n.forEach(function(e){if(e.is_mpim)o.push(e);else if(e.is_group||e.is_private)s.push(e);else if(e.is_channel)a.push(e)});var l={user_id:TS.model.user.id,channels:a,groups:s,mpims:o};TS.menu.$menu_header.html(TS.templates.menu_channel_picker_header(l));TS.menu.$menu_items.html(TS.templates.menu_channel_picker(l)).css("max-height",274);TS.menu.$menu_items.on("click.menu","li",i);TS.menu.start(r);t();TS.kb_nav.setAllowHighlightWithoutBlurringInput(true)},end:function e(){TS.menu.channel.channel=null;TS.menu.end()}});var e;var t=function e(){var t=TS.menu.$menu.find(".no_results");var r=TS.menu.$menu.find(".icon_close");var n=TS.menu.$menu.find(".menu_filter");var i="";r.click(function(){n.val("").trigger("change");n.focus()});TS.menu.$menu_items.children("li").each(function(){var e=$(this).data("channel-id");if(e){var t=TS.channels.getChannelById(e);if(t.is_private)$(this).data("name",t.name);else if(t)$(this).data("name","#"+t.name);return}var r=$(this).data("group-id");if(r){var n=TS.groups.getGroupById(r);if(n)$(this).data("name",n.name)}var i=$(this).data("mpim-id");if(i){var a=TS.mpims.getMpimById(i);if(a)$(this).data("mpim",a)}});n.on("keyup change paste",TS.utility.debounce(function(){var e=$(this).val();if(e){if(i!==e){var n=false;var a=new RegExp(TS.utility.regexpEscape(e),"i");var s=[];var o=e.split(/[,| ]/).filter(function(e){return!!e});for(var l=0;l<o.length;l+=1)s.push(new RegExp("^"+TS.utility.regexpEscape(o[l]),"i"));r.removeClass("hidden");TS.menu.$menu_items.children("li").removeClass("hidden").each(function(){var e=$(this).data("name");var t=$(this).data("mpim");if(e){var r=e.match(a);if(r){n=true;return}}else if(t)if(TS.mpims.checkMpimMatch(t,s)){n=true;return}$(this).addClass("hidden")});if(n)t.addClass("hidden");else{t.removeClass("hidden");t.find(".query").text(e)}TS.kb_nav.clearHighlightedItem()}}else{TS.menu.$menu_items.children("li.hidden").removeClass("hidden");t.addClass("hidden");r.addClass("hidden");if(i!==e)TS.kb_nav.clearHighlightedItem()}i=e;TS.ui.utility.updateClosestMonkeyScroller(TS.menu.$menu.find("#menu_items_scroller"),true)},250));n.focus()}})()},4804:function(e,t){(function(){TS.registerModule("menu.file",{onStart:function e(){},reported_no_file_reader:false,startWithNewFileOptions:function e(t,r){if(TS.menu.isRedundantClick(t))return;if(TS.client.ui.checkForEditing(t))return;if(TS.model.menu_is_showing)return;TS.menu.buildIfNeeded();TS.menu.file.clean();TS.menu.$menu.addClass("file_menu");TS.menu.$menu_header.addClass("hidden").empty();var n=window.File&&"disable_all"!==TS.prefs.getTeamPref("disable_file_uploads");var i;var a;if(n)if("disable_all_except_images"===TS.prefs.getTeamPref("disable_file_uploads")){i=TS.i18n.t("Add an image from…","menu_file")();a=TS.i18n.t("an image","menu_file")()}else{i=TS.i18n.t("Add a file from…","menu_file")();a=TS.i18n.t("a file","menu_file")()}else{if(!TS.menu.file.reported_no_file_reader){TS.menu.file.reported_no_file_reader=true;TS.info("TS.menu: No File support?  navigator.userAgent: "+navigator.userAgent)}i=TS.i18n.t("Add from…","menu_file")();a=""}var s=TS.boot_data.feature_email_ingestion&&TS.prefs.getTeamPref("allow_email_ingestion");var o=TS.utility.box.isBrowserSupported()&&TS.prefs.getPref("box_enabled");var l=TS.boot_data.feature_arugula;var u=window.Dropbox&&Dropbox.isBrowserSupported()&&TS.prefs.getPref("dropbox_enabled");var d=TS.prefs.getTeamPref("gdrive_enabled_team");var _=TS.boot_data.feature_onedrive_picker&&TS.prefs.getTeamPref("onedrive_enabled_team");var c=0;if(o)c+=1;if(u)c+=1;if(d)c+=1;if(_)c+=1;var m=c>1;var f=TS.templates.menu_file_new_file_items({should_show_upload_file:n,should_show_email:s,should_show_box:o,should_show_dropbox:u,should_show_gdrive:d,should_show_onedrive:_,should_show_arugula:l,add_from:i,file_type:a,use_cloud_submenu:m});TS.menu.$menu_items.html(f);if(d){TS.menu.addSubmenu("#gdrive_create_submenu",TS.templates.menu_file_gdrive_doc_type_items(),TS.menu.file.onGDriveDocumentTypeItemClick);TS.menu.has_submenu=true}if(_){TS.menu.addSubmenu("#onedrive_create_submenu",TS.templates.menu_file_onedrive_doc_type_items(),TS.menu.file.onOneDriveDocumentTypeItemClick);TS.menu.has_submenu=true}if(m){var p=TS.templates.menu_file_cloud_service_items({should_show_box:o,should_show_dropbox:u,should_show_gdrive:d,should_show_onedrive:_});TS.menu.addSubmenu("#cloud_submenu",p,TS.menu.file.onNewFileOptionsItemClick);TS.menu.has_submenu=true}TS.menu.$menu_items.on("click.menu","li",TS.menu.file.onNewFileOptionsItemClick);TS.kb_nav.setSubmitItemHandler(TS.menu.file.onNewFileOptionsItemClick);var h=r&&"primary_file_button"===r.attr("id");var g;if(TS.client&&h){g=function e(){TS.utility.contenteditable.focus(TS.client.msg_input.$input)};TS.clog.track("PFP_ACTION",{contexts:{growth:{action:"click",trigger:"plus_menu_button"}}})}TS.menu.start(t,false,{on_esc:g});TS.menu.$menu.attr("data-qa","file_menu");if(h)TS.menu.positionAt(r,1,-(TS.menu.$menu.height()+6));else TS.menu.positionAt(r,r.width()-TS.menu.$menu.width(),r.outerHeight()+10)},onGDriveDocumentTypeItemClick:function r(n){var i=$(n.target);var a=i.data("doc-type");var s=i.data("doc-display-type");if(!a)return;var o=TS.templates.loading_indicator();t.remove();e.append(o);TS.files.gdrive.createAndShare(a,s);TS.menu.file.end();e.toggleClass("active",true);TS.clog.track("PFP_ACTION",{contexts:{growth:{action:"click",trigger:"plus_menu_subitem_gdrive_"+a.toLowerCase()}}})},onOneDriveDocumentTypeItemClick:function e(t){TS.log(9999,"boop");TS.log(9999,t)},onGDriveCreateComplete:function r(n,i){if(n&&i)if($("#allow_popups_banner").is(":visible"))TS.client.ui.addEphemeralBotMsg({text:TS.i18n.t("It looks like your browser is blocking popups so here’s a link to your <{url}|document>","menu_file")({url:i.data.url}),ephemeral_type:"created_google_drive_document"});e.find(".ts_icon").remove();e.toggleClass("active",false).append(t)},onNewFileOptionsItemClick:function e(t){var r=$(this).closest("[data-which]");if(!r.length)r=$(t.target).closest("[data-which]");var n=r.data("which");var i;if("choose"===n){t.preventDefault();TS.client.ui.files.$upload.trigger("click");TS.clog.track("PFP_ACTION",{contexts:{growth:{action:"click",trigger:"plus_menu_item_upload"}}})}else if("email"===n);else if("snippet"===n){t.preventDefault();TS.client.msg_input.startSnippet();TS.clog.track("PFP_ACTION",{contexts:{growth:{action:"click",trigger:"plus_menu_item_snippet"}}})}else if("post"===n)TS.clog.track("PFP_ACTION",{contexts:{growth:{action:"click",trigger:"plus_menu_item_post"}}});else if("box"===n){t.preventDefault();TS.files.openBoxChooser();TS.clog.track("PFP_ACTION",{contexts:{growth:{action:"click",trigger:"plus_menu_subitem_cloud_box"}}})}else if("dropbox"===n){t.preventDefault();TS.files.openDropboxChooser();TS.clog.track("PFP_ACTION",{contexts:{growth:{action:"click",trigger:"plus_menu_subitem_cloud_dropbox"}}})}else if("gdrive_import"===n){t.preventDefault();TS.files.gdrive.openPickerWindow();TS.clog.track("PFP_ACTION",{contexts:{growth:{action:"click",trigger:"plus_menu_subitem_cloud_gdrive"}}})}else if("gdrive_create_submenu"===n)t.preventDefault();else if("onedrive_import"===n){t.preventDefault();TS.files.onedrive.openPickerWindow();TS.clog.track("PFP_ACTION",{contexts:{growth:{action:"click",trigger:"plus_menu_subitem_cloud_onedrive"}}})}else if("cloud_submenu"===n)t.preventDefault();else if("space"===n){t.preventDefault();i=TS.utility.cmdKey(t);TS.files.createAndOpenNewSpace(null,i);TS.clog.track("PFP_ACTION",{contexts:{growth:{action:"click",trigger:"plus_menu_item_space"}}})}else{t.preventDefault();TS.warn("not sure what to do with clicked element:"+n)}TS.menu.file.end()},startWithFileFilter:function e(t,r){if(TS.menu.isRedundantClick(t))return;if(TS.model.menu_is_showing)return;TS.menu.buildIfNeeded();TS.menu.file.clean();var n="all";if(TS.model.file_list_types)n=TS.model.file_list_types[0];var i=TS.boot_data.feature_email_ingestion&&TS.prefs.getTeamPref("allow_email_ingestion")||TS.model.team.plan;TS.menu.$menu_header.addClass("hidden").empty();TS.menu.$menu_items.html(TS.templates.menu_file_filter_items({active_type:n,show_email_item:i}));if(r)TS.menu.$menu_items.on("click.menu","li",TS.menu.file.onSearchFileFilterItemClick);else TS.menu.$menu_items.on("click.menu","li",TS.menu.file.onFileFilterItemClick);TS.menu.start(t);if(r)if(TS.search.sliFileSearchIsEnabled())TS.menu.positionAt($("#search_file_list_heading"),0,20);else TS.menu.positionAt($("#search_results_container"),8,74);else TS.menu.positionAt($("#file_list_container"),8,44)},onFileFilterItemClick:function e(t){t.preventDefault();TS.client.ui.files.filterFileList($(this).data("filetype"));TS.view.files.setButtonState($(this).data("filetype"));TS.menu.file.end()},onSearchFileFilterItemClick:function e(t){t.preventDefault();TS.search.setFiletypeFilter($(this).data("filetype"));TS.view.files.setButtonState($(this).data("filetype"));TS.menu.file.end()},startWithFileMemberPromiseFilter:function e(t){if(TS.menu.isRedundantClick(t))return;if(TS.model.menu_is_showing)return;TS.menu.buildIfNeeded();TS.menu.file.clean();TS.menu.$menu.append(TS.templates.menu_file_member_filter());TS.menu.$menu.addClass("member_file_filter_menu");TS.menu.start(t);TS.menu.positionAt($("#file_list_toggle_user"),0,35);var r=new TS.SearchableMemberList({$container:$(".member_file_filter_menu .searchable_member_list"),id:"member_file_filter_menu",show_filter_bar:false,compact_results:true,prevent_member_click_handler:true,suppress_presence:true});r.showInitial();r.member_clicked_sig.add(function(e,t){TS.client.ui.files.toggleFileList(t.id);TS.menu.file.end()})},onFileMemberFilterItemClick:function e(t){t.preventDefault();var r=$(t.currentTarget).data("member-id");TS.client.ui.files.toggleFileList(r);TS.menu.file.end()},onSearchFileMemberFilterItemClick:function e(t){t.preventDefault();var r=$(t.currentTarget).data("member-id");TS.search.setMember(r);TS.menu.file.end()},file_list_menu_up:false,startWithFileActions:function e(t,r){if(TS.client&&!TS.redux.socket.isConnected()){TS.sounds.play("beep");return}if(TS.menu.isRedundantClick(t))return;if(TS.model.menu_is_showing)return;TS.menu.buildIfNeeded();TS.menu.file.clean();var n=TS.files.getFileById(r);if(!n)return;var i=TS.files.getFileActions(n);var a=$(t.target);var s=a.closest(".file_actions");if(i.comment&&s.data("exclude-comment"))i.comment=false;if(i.download&&s.data("exclude-download"))i.download=false;if(i.open_original&&s.data("exclude-original"))i.open_original=false;if(i.rxn_file&&s.data("exclude-rxn"))i.rxn_file=false;if(i.pin_file&&(s.data("exclude-pin")||s.data("exclude-pin-file")))i.pin_file=false;if(i.unpin_file&&(s.data("exclude-pin")||s.data("exclude-unpin-file")))i.unpin_file=false;if(i.edit&&s.data("exclude-edit"))i.edit=false;if(i.edit_title&&s.data("exclude-edit-title"))i.edit_title=false;if(i.print&&s.data("exclude-print"))i.print=false;if(i.create_public_link&&s.data("exclude-create-public-link"))i.create_public_link=false;if(i.revoke_public_link&&s.data("exclude-revoke-public-link"))i.revoke_public_link=false;if(s.data("include-open-flexpane"))i.open_in_flexpane=true;if(s.data("include-open-file-page"))i.open_file_page=true;if(s.data("include-view-public-link"))i.view_public_link=true;var o=a.closest(".file_list_item").length>0;if(o){if("details"!==TS.model.ui_state.flex_name)i.share=false;TS.menu.file.file_list_menu_up=true}var l=a.closest(".inline_file_preview_container, .file_container");if(l.length>0){l.addClass("file_menu_open");i.new_window=false}TS.menu.$menu_header.addClass("hidden").empty();var u=false;if(i.edit||TS.client&&i.edit_title||i.create_public_link||i.revoke_public_link||i.print||i.save_to_dropbox||i.refresh)u=true;var d={file:n,actions:i,is_refreshing:TS.files.waiting_for_refresh[n.id],model_ob:TS.shared.getActiveModelOb(),show_workflow_divider:u,external_file_author:TS.files.isFileAuthorExternal(n)};if(TS.model.unread_view_is_showing){d.source_model_ob_id=a.closest(".unread_group").data("modelId");d.model_ob=TS.shared.getModelObById(d.source_model_ob_id)}if(TS.client)d.info_pane_visible="details"===TS.model.ui_state.flex_name;TS.menu.$menu_items.html(TS.templates.menu_file_action_items(d));if(TS.boot_data.feature_fix_files)TS.menu.$menu.addClass("no_icons");if(TS.web)TS.menu.$menu_items.on("click.menu","li",TS.menu.file.onFileActionClickWeb);else if(TS.client)TS.menu.$menu_items.on("click.menu","li",TS.menu.file.onFileActionClickClient);TS.menu.start(t);a.closest(".file_list_item").addClass("active");TS.menu.positionAt(a,-(TS.menu.$menu.width()+6),0);TS.menu.keepInBounds()},onFileActionClickClient:function e(t){var r=$(this).attr("id");var n=$(this).data("rxn-key");var i=TS.files.getFileById($(this).data("file-id"));var a=TS.shared.getActiveModelOb();var s=$(this).data("sourceModelId");if(TS.model.unread_view_is_showing&&s)a=TS.shared.getModelObById(s);if(!i){TS.error("no file id:"+$(this).data("file-id"));return}if("share_file"===r){t.preventDefault();TS.view.files.shareInCurrentChannelOrIM(i.id,s)}else if("edit_file_snippet"===r){if(!i.is_truncated){t.preventDefault();TS.ui.snippet_dialog.startEdit(i.id)}}else if("edit_file_post"===r);else if("edit_file_space"===r||"open_new_window"===r){if(TS.client.windows.openFileWindow(i.id))t.preventDefault()}else if("edit_file_arugula"===r);else if("edit_file_title"===r){t.preventDefault();TS.client.ui.files.previewFile(i.id,"file_list");TS.files.editFileTitle(i.id)}else if("delete_file"===r){t.preventDefault();TS.view.files.delete(i.id)}else if("create_public_link"===r){t.preventDefault();if(TS.prefs.getTeamPref("disallow_public_file_urls")){var o;if(TS.boot_data.feature_external_files)o=TS.i18n.t("An administator has disabled external file URL creation. You will not be able to create an external URL for this file.","menu_file")();else o=TS.i18n.t("An administator has disabled public file URL creation. You will not be able to create a public URL for this file.","menu_file")();TS.generic_dialog.alert(o);return}TS.files.createPublicURL(i,function(e,t){if(e){if(TS.model.previewed_file_id)$("#file_preview_scroller").find(".file_actions_link").scrollintoview({duration:500,offset:"top",px_offset:-50});$(".file_public_link_"+i.id).highlightText();TS.ui.file_share.fileShowPublicUrlDialog(t.file)}})}else if("revoke_public_link"===r){t.preventDefault();TS.ui.file_share.fileRevokePublicLink(i.id)}else if("view_public_link"===r){t.preventDefault();TS.ui.file_share.fileShowPublicUrlDialog(i)}else if("refresh_file"===r){t.preventDefault();TS.files.refreshFile(i.id);TS.menu.$menu.find("#refresh_file .item_label").text(TS.i18n.t("Refreshing...","menu_file")()).end();return}else if("download_file"===r){var l=!(TS.ui.fs_modal_file_viewer&&TS.ui.fs_modal_file_viewer.is_showing);if(TS.client&&TS.client.downloads.startDownload(i,l))t.preventDefault()}else if("open_original_file"===r);else if("comment_file"===r){t.preventDefault();if(TS.model.previewed_file_id!=i.id)TS.client.ui.files.previewFile(i.id,"file_list",false,true);else TS.utility.contenteditable.focus($("#file_comment"))}else if("save_to_dropbox"===r){var u=function e(t,r){if(t)Dropbox.save(r.url,i.name)};return TS.api.callImmediately("files.getTempURL",{file:i.id}).then(function(e){var t=e.data,r=e.args,n=e.request_id;var i=true;u(i,t,r,n);return{data:t,args:r,request_id:n}}).catch(function(e){var t=e.data,r=e.args,n=e.request_id;var i=false;u(i,t,r,n);return{data:t,args:r,request_id:n}})}else if("rxn_file"===r){t.preventDefault();TS.ui.react_emoji_menu.start({e:t,rxn_key:n})}else if("share_private_file"===r){t.preventDefault();TS.ui.share_dialog.start(i.id)}else if("pin_file"===r&&a){t.preventDefault();TS.pins.startPinFile(i.id,a)}else if("unpin_file"===r&&a){t.preventDefault();TS.pins.unPinFile(i.id,a)}else if("open_in_flexpane"===r){t.preventDefault();TS.client.ui.files.previewFile(i.id)}else if("copy_file_link"===r){t.preventDefault();TS.clipboard.writeText(i.permalink);var d=TS.members.getMemberById(i.user);var _={};if(d&&d.is_bot){var c=d.profile.bot_id;var m=TS.bots.getBotById(c);_.app_id=m?m.app_id:"";_.bot_id=c}TS.clog.track("MSG_LINK_COPY",_)}else if("star_file"===r){t.preventDefault();TS.stars.checkForStarClick(t)}else{t.preventDefault();TS.warn("not sure what to do with clicked element id:"+r);return}TS.menu.file.end()},onFileActionClickWeb:function e(t){var r=$(this).attr("id");var n=$(this).data("rxn-key");var i=TS.files.getFileById($(this).data("file-id"));var a=TS.shared.getActiveModelOb();if(!i){TS.error("no file id:"+$(this).data("file-id"));return}if("share_file"===r){t.preventDefault();TS.ui.share_dialog.start(i.id)}else if("share_private_file"===r){t.preventDefault();TS.ui.share_dialog.start(i.id)}else if("edit_file_snippet"===r);else if("edit_file_post"===r);else if("edit_file_space"===r||"open_new_window"===r);else if("edit_file_title"===r);else if("delete_file"===r){t.preventDefault();TS.web.file.deleteFile(i.id)}else if("create_public_link"===r){t.preventDefault();if(!TS.prefs.getTeamPref("disallow_public_file_urls")){var s=function e(t,r){if(t){var n=$(".file_public_link_shared");n.slideToggle(100);TS.files.upsertAndSignal({id:i.id,public_url_shared:true});if(0===n.length)TS.ui.file_share.fileShowPublicUrlDialog(i)}else if(r.error&&"not_allowed"===r.error){TS.prefs.setTeamPrefLocal("disallow_public_file_urls",true);var a;if(TS.boot_data.feature_external_files)a=TS.i18n.t("An administator has disabled external file URL creation. You will not be able to create an external URL for this file.","menu_file")();else a=TS.i18n.t("An administator has disabled public file URL creation. You will not be able to create a public URL for this file.","menu_file")();TS.generic_dialog.alert(a)}};TS.api.callImmediately("files.sharedPublicURL",{file:i.id}).then(function(e){var t=e.data,r=e.args,n=e.request_id;var i=true;s(i,t,r,n);return{data:t,args:r,request_id:n}}).catch(function(e){var t=e.data,r=e.args,n=e.request_id;var i=false;s(i,t,r,n);return{data:t,args:r,request_id:n}})}}else if("revoke_public_link"===r){t.preventDefault();if(TS.web.file)TS.web.file.revokePublicURL(i);else TS.ui.file_share.fileRevokePublicLink(i.id)}else if("view_public_link"===r){t.preventDefault();TS.ui.file_share.fileShowPublicUrlDialog(i)}else if("refresh_file"===r){t.preventDefault();TS.files.refreshFile(i.id);TS.menu.$menu.find("#refresh_file .item_label").text("Refreshing...").end();return}else if("download_file"===r);else if("print_file"===r){window.print();t.preventDefault()}else if("open_original_file"===r);else if("comment_file"===r){t.preventDefault();TS.utility.contenteditable.focus($("#file_comment"))}else if("save_to_dropbox"===r){var o=function e(t,r){if(t)Dropbox.save(r.url,i.name)};return TS.api.callImmediately("files.getTempURL",{file:i.id}).then(function(e){var t=e.data,r=e.args,n=e.request_id;var i=true;o(i,t,r,n);return{data:t,args:r,request_id:n}}).catch(function(e){var t=e.data,r=e.args,n=e.request_id;var i=false;o(i,t,r,n);return{data:t,args:r,request_id:n}})}else if("rxn_file"===r){t.preventDefault();TS.ui.react_emoji_menu.start({e:t,rxn_key:n})}else if("pin_file"===r&&a){t.preventDefault();TS.pins.startPinFile(i.id,a)}else if("unpin_file"===r&&a){t.preventDefault();TS.pins.unPinFile(i.id,a)}else if("copy_file_link"===r){t.preventDefault();TS.clipboard.writeText(i.permalink)}else if("open_file_page"===r);else{t.preventDefault();TS.warn("not sure what to do with clicked element id:"+r);return}TS.menu.file.end()},clean:function e(){TS.menu.clean()},end:function e(){TS.menu.end()}});var e=$('[data-js="primary_file_button"]');var t=e.find(".ts_icon_plus_thick")})()},4805:function(e,t){(function(){TS.registerModule("menu.group",{onStart:function e(){},group:null,startWithGroup:function t(r,n){if(TS.menu.isRedundantClick(r))return;if(TS.client.ui.checkForEditing(r))return;if(!TS.model.menu_is_showing)e=void 0;TS.menu.buildIfNeeded();TS.menu.clean();TS.menu.group.group=TS.groups.getGroupById(n);var i=TS.menu.group.group;var a=TS.prefs.getTeamPref("allow_email_ingestion");TS.menu.$menu_header.addClass("hidden").empty();var s={group:i,user:TS.model.user,show_email_item:a,leave_action:TS.groups.getLeaveAction(n),show_export_history:TS.permissions.members.canExportMessageHistory(i)};if(0===i.purpose.last_set&&!TS.model.user.is_ultra_restricted)s.show_purpose_item=true;if(TS.notifs.isCorGMuted(i.id))s.group_is_muted=true;s.show_advanced_item=true;if(TS.boot_data.page_needs_enterprise){var o=TS.permissions.members.canCreateConvertOrgSharedChannels();if(o)s.show_advanced_item=true;else if(i.creator!==TS.model.user.id&&i.is_org_shared)s.show_advanced_item=false}if(""!==TS.model.team.plan&&TS.prefs.getTeamPref("allow_retention_override")&&!TS.shared.isModelObShared(i))s.show_message_retention=true;if(TS.apps.permissions.areXoxaAppsInstalled())s.show_add_apps=true;TS.menu.$menu_items.html(TS.templates.menu_group_items(s));TS.menu.$menu_header.bind("click.menu",TS.menu.group.onGroupHeaderClick);TS.menu.$menu_items.on("click.menu","li",TS.menu.group.onGroupItemClick);TS.menu.start(r);TS.menu.$menu.attr("data-qa","group_menu");TS.menu.$menu.addClass("narrow_menu");TS.ui.date_picker.getOldestMsgTs();$("#menu_group_topic_input").bind("keydown",TS.menu.handleTopicKeydown);if(!e)e=$(r.target).closest("#channel_name").length;var l=e?$("#channel_name"):$("#channel_actions_toggle");var u=l.height();var d=e?u+6:u;var _=e?18:6;TS.menu.positionAt(l,_,d)},onGroupHeaderClick:function e(t){t.preventDefault()},onGroupItemClick:function e(t){var r=$(this).attr("id");if($(this).hasClass("disabled")){TS.menu.end();return}if("group_display_item"===r){t.preventDefault();TS.groups.displayGroup({id:TS.menu.group.group.id})}else if("group_details_item"===r){t.preventDefault();if(TS.model.ui_state.flex_visible&&"details"===TS.model.ui_state.flex_name)$("#details_tab").highlight(null,"channel_page_details_highlighter");else TS.client.ui.flex.openFlexTab("details")}else if("group_star_item"===r){t.preventDefault();TS.stars.checkForStarClick(t)}else if("group_mute_item"===r){t.preventDefault();TS.notifs.muteOrUnmuteCorG(TS.menu.group.group.id)}else if("group_email_item"===r);else if("group_files_item"===r){TS.client.ui.flex.openFlexTab("search");TS.search.setFilter("files");TS.view.resizeManually("TS.key_triggers");var n="in:"+TS.shared.getActiveModelOb().name+" ";TS.search.setInputVal(n)}else if("group_leave_item"===r){t.preventDefault();TS.groups.leave(TS.menu.group.group.id)}else if("group_unarchive_item"===r){t.preventDefault();TS.api.call("conversations.unarchive",{channel:TS.menu.group.group.id})}else if("group_archives_item"===r);else if("group_jump_item"===r){t.preventDefault();TS.menu.startWithDatePicker(t);return}else if("group_advanced_item"===r){t.preventDefault();TS.ui.channel_options_dialog.start(TS.menu.group.group.id)}else if("group_convert_item"===r){t.preventDefault();TS.ui.channel_options_dialog.start(TS.menu.group.group.id,"manage_teams")}else if("group_invite_item"===r){t.preventDefault();TS.ui.channel_invite_modal.startInviteToChannelModal(TS.menu.group.group.id)}else if("group_prefs"===r){t.preventDefault();TS.ui.channel_prefs_dialog.start(TS.menu.group.group.id)}else if("group_message_retention"===r){t.preventDefault();TS.ui.channel_options_dialog.start(TS.menu.group.group.id,"retention")}else if("group_export_history"===r){t.preventDefault();TS.ui.channel_options_dialog.start(TS.menu.group.group.id,"export")}else if("group_add_service_item"===r);else if("group_add_apps_item"===r){t.preventDefault();TS.ui.apps_browser.startAddApps()}else{TS.warn("not sure what to do with clicked element id:"+r);return}TS.menu.end()}});var e})()},4806:function(e,t){(function(){TS.registerModule("menu.member",{member:null,member_item_click_sig:new signals.Signal,onStart:function t(){e=new TS.PresenceList},startWithMember:function a(o,l,u,d,c){if(TS.menu.isRedundantClick(o))return;if(TS.client.ui.checkForEditing(o))return;if(!TS.model.menu_is_showing)t=void 0;TS.menu.buildIfNeeded();TS.menu.member.member=TS.members.getMemberById(l);var m=TS.menu.member.member;if(!m)return;if(!TS.permissions.members.canUserSeeMember(m))return;if(m.is_bot&&_.get(m.profile,"bot_id"))return TS.menu.app.startWithApp(o,_.get(m.profile,"bot_id"),null,false,false,c);TS.menu.clean();e.add(l);TS.menu.menu_closed_sig.addOnce(function(){e.clear()});var f=r(m,{is_header_menu:d,is_im_menu:c});if(TS.boot_data.feature_tinyspeck)f.user_mc_url=s(m);if(f.channel_kick_name&&f.channel_kick_hidden){var p=TS.shared.getActiveModelOb();TS.membership.ensureChannelMembershipIsKnownForUsers(p.id,[m.id]).then(function(){if(!TS.model.menu_is_showing)return;if(TS.menu.last_e!==o)return;var e;if(TS.boot_data.feature_store_membership_in_redux)e=TS.redux.membership.getChannelMembershipInfoForUser(p.id,m.id);else e=TS.membership.getUserChannelMembershipStatus(m.id,p);if(e.is_member)TS.menu.$menu_items.find("#member_kick_channel_item").removeClass("hidden")})}if(c)TS.menu.$menu_header.addClass("hidden").empty();else{TS.menu.$menu_header.html(TS.templates.menu_member_header(f));TS.client.flex_pane.startLocalTimeInterval()}if(!m.is_stranger||TS.ims.getImByMemberId(m.id))TS.menu.$menu_items.html(TS.templates.menu_member_items(f));if(!c&&!m.deleted)TS.clog.track("USER_CARD_DISPLAY",{});if(l==TS.model.user.id){var h="";if(!c)h+=TS.templates.menu_member_footer({member:m});TS.menu.$menu_footer.html(h)}else if(!c)TS.menu.$menu_footer.html(TS.templates.menu_member_footer({member:m}));TS.menu.start(o,u);var g=false;var S=$("#menu_member_dm_input");var T=TS.members.getPrefCompliantMemberName(m);TS.utility.contenteditable.create(S,{modules:{tabcomplete:{searchOptions:{complete_member_specials:false},completers:["channels","emoji","members"],positionMenu:function e(t){t.style.width=S.outerWidth()+"px";t.style.minWidth="0";TS.tabcomplete.positionUIRelativeToInput(t,S)}}},singleLineInput:true,onEnter:function e(t){var r=_.trim(TS.utility.contenteditable.value(S));if(!_.keys(t).length&&!g&&r.length){TS.ims.startImByMemberId(m.id,false,r);TS.menu.member.end();g=true;TS.clog.track("USER_CARD_DM",{})}return false},onEscape:function e(){TS.menu.end()},placeholder:TS.i18n.t("Message {name}","menu")({name:_.escape(T)})});TS.utility.contenteditable.enable(S);if(m.is_self)TS.menu.$menu_header.find(".member_timezone_value a").on("click.timezone",function(e){e.preventDefault();TS.menu.member.end()});TS.menu.$menu_header.bind("click.menu",n);TS.menu.$menu_items.on("click.menu","li",i);TS.kb_nav.setSubmitItemHandler(i);if(c){if(!t)t=$(o.target).closest("#channel_name").length;var v=t?$("#channel_name"):$("#channel_actions_toggle");var b=v.height();var y=t?b+6:b;var w=t?18:6;TS.menu.positionAt(v,w,y);TS.menu.$menu.attr("data-qa","member_menu");TS.menu.$menu.addClass("narrow_menu");TS.ui.date_picker.getOldestMsgTs()}if(!c)TS.menu.keepInBounds()},startWithMemberPreview:function e(t,r,n,a){if(TS.menu.isRedundantClick(t))return;if(TS.client&&TS.client.ui.checkForEditing(t))return;if(TS.model.menu_is_showing)return;TS.menu.buildIfNeeded();TS.menu.clean();var o=$(t.target).closest(".member_preview_menu_target");if(!r)r=o.closest("[data-member-id]").data("member-id");TS.menu.member.member=TS.members.getMemberById(r);var l=TS.menu.member.member;var u=TS.ims.getImByMemberId(r);var d={member:l,is_team_directory:true,im_id:u&&u.id,hide_view_profile:a,show_user_id:true,can_write_to_clipboard:TS.clipboard.canWriteText()};if(TS.boot_data.feature_tinyspeck)d.user_mc_url=s(l);TS.menu.$menu_header.addClass("hidden").empty();if(!l.deleted&&!l.is_slackbot&&r!=TS.model.user.id&&!TS.utility.teams.isMemberExternal(l)){if(!TS.model.user.is_ultra_restricted&&!l.is_ultra_restricted)d.show_channel_invite=true;if(TS.boot_data.page_needs_enterprise){var _=TS.model.team;if(_&&_.id!==l.team_id)d.show_call_action=false}}if(n)TS.menu.$menu_items.html(TS.templates.menu_member_items_short(d));else{TS.menu.$menu_items.html(TS.templates.menu_member_items(d));TS.menu.$menu_items.on("click.menu","li",{is_member_preview:a},i)}TS.menu.start(t);TS.kb_nav.setSubmitItemHandler(i);var c=o.outerWidth()-TS.menu.$menu.width()-1;TS.menu.positionAt(o,c,o.outerHeight()+5);TS.menu.keepInBounds()},startWithEditMemberProfilePhotoActions:function e(t,r){if(TS.menu.isRedundantClick(t))return;if(TS.model.menu_is_showing)return;TS.menu.buildIfNeeded();var n=true===TS.model.user.profile.is_custom_image;var i=$(t.target);var a=i.is(".btn");var s={show_delete:n&&!a,is_iOS:TS.model.is_iOS};TS.menu.clean();TS.menu.$menu_header.addClass("hidden").empty();TS.menu.$menu_items.html(TS.templates.menu_edit_member_profile_photo_action_items(s));TS.menu.$menu_items.on("click.menu","li",r);TS.menu.start(t);if(a)TS.menu.positionAt(i,0,i.outerHeight()+5);else TS.menu.positionAt(i.closest('[data-action="edit_member_profile_photo_menu"]'),36,156);TS.menu.keepInBounds()},startWithEnterpriseMemberHeader:function e(t){var r=15;if(TS.menu.isRedundantClick(t))return;if(TS.model.menu_is_showing)return;TS.menu.buildIfNeeded();TS.menu.clean();var n={enterprise_name:$("[data-enterprise-name]").val(),signout_url:TS.boot_data.signout_url};TS.menu.$menu_header.addClass("hidden").empty();TS.menu.$menu_items.html(TS.templates.menu_enterprise_member_header(n));TS.menu.$menu_items.on("click.menu","li",a);TS.kb_nav.setSubmitItemHandler(a);TS.menu.start(t);var i=$("[data-header-menu-toggle]");var s=-TS.menu.$menu.outerWidth()+i.outerWidth();var o=i.outerHeight()+r;TS.menu.positionAt(i,s,o);t.preventDefault()},end:function e(){TS.menu.member.member=null;TS.menu.end()},test:function e(){var e={};Object.defineProperty(e,"_getTemplateArguments",{get:function e(){return r},set:function e(t){r=t}});return e}});var e;var t;var r=function e(t,r){r=r||{};var n={member:t,show_dm_item:!r.is_im_menu,show_email_item:TS.prefs.getTeamPref("allow_email_ingestion"),is_im_menu:r.is_im_menu,show_admin_info:t.is_admin&&t.team_id===TS.model.user.team_id};if(r.is_im_menu){n.im=TS.ims.getImByMemberId(t.id);if(TS.apps.permissions.areXoxaAppsInstalled())n.show_add_apps=true}if(r.is_header_menu&&t.id===TS.model.user.id){n.other_accounts=TS.boot_data.other_accounts;n.logout_url=TS.boot_data.logout_url;n.signin_url=TS.boot_data.signin_url}if(!t.deleted&&!t.is_slackbot&&t.id!==TS.model.user.id&&!TS.utility.teams.isMemberExternal(t))if(!TS.model.user.is_ultra_restricted&&!t.is_ultra_restricted)n.show_channel_invite=true;var i=TS.shared.getActiveModelOb();if(TS.permissions.channels.canMemberBeRemovedFromChannel(i,t)){var a;if(TS.boot_data.feature_store_membership_in_redux)a=TS.redux.membership.getChannelMembershipInfoForUser(i.id,t.id);else a=TS.membership.getUserChannelMembershipStatus(t.id,i);var s={show_tooltip:false,inherit_font_size:true};if(!a.is_known){n.channel_kick_name=new Handlebars.SafeString(TS.templates.builders.makeModelObNameForDisplay(i,s));n.channel_kick_hidden=true}else if(a.is_member)n.channel_kick_name=new Handlebars.SafeString(TS.templates.builders.makeModelObNameForDisplay(i,s))}if("USLACKBOT"===t.id){var o=false;if(TS.model.user.is_admin)o=true;else if(!TS.prefs.getTeamPref("slackbot_responses_disabled")&&!TS.prefs.getTeamPref("slackbot_responses_only_admins"))o=true;n.show_slackbot_responses_item=o}if(TS.utility.calls.isEnabled()&&!t.is_bot&&"USLACKBOT"!==t.id){n.show_call_action=true;if(!t._is_local)n.show_call_action=false}if(""!==TS.model.team.plan&&TS.prefs.getTeamPref("allow_retention_override")&&!TS.shared.isModelObShared(i))n.show_dm_retention=true;n.show_export_history=TS.permissions.members.canExportMessageHistory(i);return n};var n=function e(t){t.preventDefault();TS.client.ui.previewMember(TS.menu.member.member.id,"menu_member_header");TS.clog.track("USER_CARD_CLICK");TS.menu.member.end()};var i=function e(t){var r=$(this).attr("id");clearTimeout(TS.menu.end_time);if("member_photo_item"===r);else if("member_details_item"===r){t.preventDefault();if(TS.model.ui_state.flex_visible&&"details"===TS.model.ui_state.flex_name)$("#details_tab").highlight(null,"channel_page_details_highlighter");else TS.client.ui.flex.openFlexTab("details")}else if("member_dm_retention"===r){t.preventDefault();TS.ui.channel_options_dialog.start(TS.shared.getActiveModelOb().id,"retention")}else if("member_export_history"===r){t.preventDefault();TS.ui.channel_options_dialog.start(TS.shared.getActiveModelOb().id,"export")}else if("member_archives_item"===r);else if("member_jump_item"===r){t.preventDefault();TS.menu.startWithDatePicker(t);TS.menu.member.member_item_click_sig.dispatch(r);return}else if("member_star_item"===r){t.preventDefault();TS.stars.checkForStarClick(t)}else if("member_email_item"===r);else if("member_skype_item"===r);else if("member_account_item"===r);else if("member_prefs_item"===r){t.preventDefault();if(TS.generic_dialog.is_showing)TS.generic_dialog.cancel();TS.ui.prefs_dialog.start()}else if("member_files_item"===r){t.preventDefault();TS.view.files.clearFilter();TS.client.ui.files.filterFileList(TS.menu.member.member.id)}else if("member_im_files_item"===r){TS.client.ui.flex.openFlexTab("search");TS.search.setFilter("files");TS.view.resizeManually("TS.key_triggers");var n="in:"+TS.shared.getActiveModelOb().name+" ";TS.search.setInputVal(n)}else if("member_dm_item"===r){t.preventDefault();TS.ims.startImByMemberId(TS.menu.member.member.id)}else if("member_invite_channel_item"===r){t.preventDefault();if(TS.client.channel_page.members_dialog.isShowing()){var i=TS.generic_dialog.current_setting;TS.generic_dialog.cancel()}TS.ui.invite.showInviteMemberToChannelDialog(TS.menu.member.member.id);if(i)TS.generic_dialog.start(i)}else if("member_create_group_item"===r){t.preventDefault();TS.ui.new_channel_modal.start("",false,[TS.menu.member.member.id])}else if("member_profile_item"===r){t.preventDefault();if(TS.menu.member.member.is_self){if(TS.generic_dialog.is_showing)TS.generic_dialog.cancel();TS.ui.edit_member_profile.start()}else TS.client.ui.previewMember(TS.menu.member.member.id)}else if("member_presence"===r){t.preventDefault();TS.redux.presence.toggleUserPresence();TS.menu.end_time=setTimeout(function(){TS.menu.member.end();TS.menu.member.member_item_click_sig.dispatch(r)},1e3);return}else if("logout"===r){t.preventDefault();if(TS.client)TS.client.windows.closeAll();TS.utility.loadUrlInWindowIfOnline(TS.boot_data.logout_url)}else if($(this).hasClass("switch_team")){t.preventDefault();var a=$(this).data("team-id");if(TSSSB.call("displayTeam",a))t.preventDefault();else{var s=$(this).find("a").attr("href");if(s&&-1==s.indexOf("?"))$(this).find("a").attr("href",s+="?"+TS.getQsArgsForUrl())}}else if("member_kick_channel_item"===r){t.preventDefault();if(TS.model.active_channel_id)TS.channels.kickMember(TS.model.active_channel_id,TS.menu.member.member.id);else if(TS.model.active_group_id)TS.groups.kickMember(TS.model.active_group_id,TS.menu.member.member.id)}else if("member_slackbot_responses"===r);else if("member_call_item"===r)TS.utility.calls.startCallInModelOb(TS.menu.member.member);else if("member_add_apps_item"===r){t.preventDefault();TS.ui.apps_browser.startAddApps()}else if("member_copy_id"===r){if(TS.clipboard.canWriteText())TS.clipboard.writeText(TS.menu.member.member.id)}else if("member_mc_link"===r);else{t.preventDefault();TS.warn("not sure what to do with clicked element id:"+r);return}if(t.data&&t.data.is_member_preview)TS.clog.track("USER_PROFILE_CLICK");else TS.clog.track("USER_CARD_CLICK");TS.menu.member.end();TS.menu.member.member_item_click_sig.dispatch(r)};var a=function e(t){var r=$(this).attr("id");if("sign_out"===r)return;else if("view_account"===r)return;t.preventDefault();TS.warn("not sure what to do with clicked element id:"+r)};var s=function e(t){return"https://"+window.location.host+"/god/user.php?id="+t.id+"&team_id="+t.team_id}})()},4807:function(e,t){(function(){TS.registerModule("cmd_handlers",{server_cmds:null,onStart:function t(){var r=true;s=TS.utility.throttleFunc(s,3e3,r);TS.prefs.team_allow_calls_changed_sig.add(o);if(!_.get(window,"desktop.app.toggleDevTools"))delete TS.cmd_handlers["/slackdevtools"];if(!TS.client||!TS.client.traces.canTrace())delete TS.cmd_handlers["/slacktrace"];if(TS.i18n.locale()!==TS.interop.I18n.DEFAULT_LOCALE)e.push("/"+TS.i18n.t("active","cmd_handlers")())},test:function e(){return{_maybeInviteUserToModelOb:m,_maybeInviteUserGroupToModelOb:f,_getUserIdentifier:p}},groupCmdsByType:function e(t){var r=[l(t),u(t),c(t)];var n=Array.prototype.concat.apply([],r);var i=n.filter(function(e){return e.cmds.length>0});return i},getAvailableUserCmds:function e(t){var r={};var n=TS.shared.getActiveModelOb();t=t||{};_.forOwn(TS.cmd_handlers,function(e,i){if(0!==i.indexOf("/"))return;if("function"===typeof e.autocomplete&&!e.autocomplete()||false===e.autocomplete||e.alias_of)return;if(t.in_thread&&!TS.cmd_handlers.isCmdSupportedInThreads(i))return;switch(i){case"/archive":case"/unarchive":if(TS.channels.isChannelRequired(n))return;if(n.is_im)return;if(n.is_mpim)return;if((n.is_group||n.is_private)&&TS.model.user.is_restricted)return;if(n.is_channel&&!TS.permissions.members.canArchiveChannels())return;break;case"/kick":case"/remove":if(n.is_archived)return;if(n.is_im)return;if(n.is_mpim)return;if(n.is_group&&!TS.permissions.members.canKickFromGroups())return;if(n.is_channel&&!TS.permissions.members.canKickFromChannels())return;break;case"/join":case"/feed":if(TS.model.user.is_restricted)return;break;case"/invite":if(TS.model.user.is_ultra_restricted)return;break;case"/invite_people":if(!TS.ui.admin_invites.canInvite())return;break;case"/topic":case"/purpose":if(n.is_im)return;if(n.is_mpim)return;if(TS.model.user.is_restricted)return;if(TS.channels.isChannelRequired(n)&&!TS.permissions.members.canPostInChannel(n))return;break;case"/leave":if(n.is_group||n.is_private)return}if("custom"===e.type||"service"===e.type)if(TS.prefs.commands_only_regular&&TS.model.user.is_restricted)return;r[i]=e});return r},parseArgs:function e(t){var r=t;t=TS.format.texty.convertContentsStringForSlashCommands(t);var n={cmd:"",rest:"",words:[]};if(!_.isString(t))return n;var i=t.trim();if(!i)return n;n.words=i.split(/\s+/);n.cmd=n.words[0].toLowerCase().replace(/’/g,"'");n.disp=n.words[0];n.rest=i.substring(n.cmd.length).trim();n.original_txt=r;return n},setUpCmds:function e(){if(!TS.boot_data.page_needs_custom_cmds){o();return Promise.resolve()}n();if(a()){var t=TS.storage.fetchCmds();TS.model.did_we_load_with_cmd_cache=true;TS.cmd_handlers.mergeInServerCmds(t.data);o();return Promise.resolve()}var r=true;return TS.api.call("commands.list",{},null,r).then(function(e){if(!e.data.commands)return;i(e.data.commands,e.data.cache_ts)}).catch(_.noop)},removeCommand:function e(t,r){delete TS.cmd_handlers.server_cmds[t];i(TS.cmd_handlers.server_cmds,r)},updateCommand:function e(t,r){TS.cmd_handlers.server_cmds[t.name]=t;i(TS.cmd_handlers.server_cmds,r)},resetUpCmds:function e(){TS.storage.storeCmds("");s()},sortNames:function e(t){var r=t.sort(TS.i18n.sorter);function n(e,t){return e.filter(function(e){return-1!==t.indexOf(TS.cmd_handlers[e].type)})}var i=n(r,["client","core"]);var a=n(r,["custom"]);var s=n(r,["app","service"]);var o=s.filter(function(e){var t=TS.cmd_handlers[e];return!!(t.app||t.service_name)});o.sort(function(e,t){var r=TS.cmd_handlers[e];var n=TS.cmd_handlers[t];var i=r.service_name||TS.model.apps[r.app].name;var a=n.service_name||TS.model.apps[n.app].name;return TS.i18n.sorter(i,a)});var l=s.filter(function(e){var t=TS.cmd_handlers[e];return!(t.app||t.service_name)});l.sort();var u=[].concat(i,a,o,l);return u},getAppNameForCmdName:function e(t){var r=TS.cmd_handlers[t];if(!r)return"";var n;if(r.app&&TS.model.apps[r.app])n=TS.model.apps[r.app].name;else if(r.service_name)n=r.service_name;return n},mergeInServerCmds:function e(t){TS.cmd_handlers.server_cmds=t;var r;for(var n in TS.cmd_handlers){if(0!==n.indexOf("/"))continue;if("client"===TS.cmd_handlers[n].type)delete TS.cmd_handlers[n].override;else delete TS.cmd_handlers[n]}for(r in t){if(0!==r.indexOf("/"))continue;if(TS.cmd_handlers[r]&&!TS.cmd_handlers[r].can_be_overridden_by_server_cmd){TS.cmd_handlers[r].override=true;continue}TS.cmd_handlers[r]=TS.cmd_handlers.makeInternalCmdObject(t[r])}for(r in t){if(0!==r.indexOf("/"))continue;if(!TS.cmd_handlers[r].alias_of)continue;var i=TS.cmd_handlers[TS.cmd_handlers[r].alias_of];if(!i)continue;if("client"===i.type)continue;if(!i.aliases)i.aliases=[];i.aliases.push(r)}},makeInternalCmdObject:function e(t){return{autocomplete:true,alias_of:t.alias_of?t.alias_of:null,aliases:null,usage:t.usage||"",desc:t.desc||"",help_text:t.help_text||"",type:t.type||"",app:t.app||"",service_name:t.service_name||"",normalized:TS.interop.I18n.deburr(t.name),canonical_name:t.canonical_name||null}},addEphemeralFeedback:function e(t,r){r=_.defaults(r,{temporary:true});var n={text:t};if(r.input_txt)if(r.c_id&&r.thread_ts)TS.utility.populateThreadInputs(r.input_txt,r.c_id,r.thread_ts);else TS.utility.contenteditable.value(TS.client.ui.$msg_input,r.input_txt);if(!r.temporary)if(r.c_id&&r.thread_ts)TS.utility.msgs.removeAllEphemeralMsgsByType("threads_temp_slash_cmd_feedback",r.c_id);else TS.utility.msgs.removeAllEphemeralMsgsByType("temp_slash_cmd_feedback",TS.model.active_cid);if(r.temporary)n.ephemeral_type="temp_slash_cmd_feedback";if(r.slackbot_feels)n.slackbot_feels=r.slackbot_feels;if(r.c_id&&r.thread_ts){n.channel=r.c_id;n.thread_ts=r.thread_ts;if(r.temporary)n.ephemeral_type="threads_temp_slash_cmd_feedback"}if(r.temporary)TS.client.ui.addOrFlashEphemeralBotMsg(n);else TS.client.ui.addEphemeralBotMsg(n)},runCommand:function e(t,r,n){if(!TS.cmd_handlers[t.cmd])return;if(r&&!TS.cmd_handlers.isCmdSupportedInThreads(t.cmd)){TS.cmd_handlers.sendCmdNotSupportedInThreadsMsg(t.cmd,t.original_txt,r,n);return}if(TS.model.last_active_cid)TS.utility.msgs.removeAllEphemeralMsgsByType("temp_slash_cmd_feedback",TS.model.last_active_cid);var i=t.cmd;if(TS.cmd_handlers[t.cmd].canonical_name)i=TS.cmd_handlers[t.cmd].canonical_name;if("client"===TS.cmd_handlers[t.cmd].type)TS.clog.track("BUILTIN_CHAT_COMMAND_CALLED",{locale:TS.i18n.locale(),slash_command_canonical_name:i,slash_command_name:t.cmd});TS.cmd_handlers[t.cmd].func(t.cmd,t.rest,t.words,t.original_txt,r,n)},isCmdSupportedInThreads:function t(r){return r&&_.includes(e,r)},sendCmdNotSupportedInThreadsMsg:function e(t,r,n,i){var a;if(TS.cmd_handlers[t])a=TS.i18n.t("*{cmd}* is not supported in threads. Sorry!","threads")({cmd:t});else a=TS.i18n.t("*{cmd}* is not a valid command.","threads")({cmd:t});TS.cmd_handlers.addEphemeralFeedback(a,{input_txt:r,slackbot_feels:"sad_surprise",c_id:i.id,thread_ts:n.ts})},"/slackdevtools":{localized:null,type:"client",autocomplete:false,alias_of:null,aliases:null,func:function e(){if(!_.get(window,"desktop.app.toggleDevTools"))return;var t=false;desktop.app.toggleDevTools(t)}},"/slackdebugunreads":{localized:null,type:"client",autocomplete:false,alias_of:null,aliases:null,func:function e(){var t=TS.shared.getAllModelObsForUser();if(!t||!t.length){var r="/slackdebugunreads: Could not get list of model objects for user. :(";TS.warn(r);TS.cmd_handlers.addEphemeralFeedback(r);return}var n=[];var i=0;var a=0;_.each(t,function(e){if(!e.unread_cnt)return;var t;if(e.is_group)t="group";else if(e.is_mpim)t="mpim";else if(e.is_im)t="im";else if(e.is_channel)t="channel";else t="unknown";if((e.unread_cnt||e.unread_highlight_cnt)&&t){i+=1;n.push([e.id,"group"===t||"mpim"===t?" ("+t+"):":":",e.unread_cnt?" unread"+(e.is_im||e.is_mpim?" (highlight)":"")+" = "+e.unread_cnt:"",e.unread_highlight_cnt?" highlight = "+e.unread_highlight_cnt:"",TS.notifs.isCorGMuted(e.id)?" (muted)":""].join(""));a+=e.unread_cnt}else{var s="/slackdebugunreads: bad type for channel id "+e.id+"? ("+t+")";TS.warn(s);TS.cmd_handlers.addEphemeralFeedback(r)}});if(!a)n.push("No unreads found across "+t.length+" channels??");var s=TS.model.all_unread_highlights_cnt;var o=TS.model.all_unread_cnt;n=["🕵️ 📖 Unreads Report for user @"+TS.model.user.name+" ("+TS.model.user.id+') in workspace "'+TS.model.team.name+'" ('+TS.model.team.id+")",a+" unreads across "+i+(1===i?" channel":" channels"),"TS.model.threads_has_unreads: "+TS.model.threads_has_unreads+" (TS.model.all_unread_cnt++ when true), TS.model.threads_mention_count: "+TS.model.threads_mention_count].concat(n);if(TS.model.is_our_app){if(TS.boot_data.page_needs_enterprise&&TS.model.team&&TS.model.team.enterprise_id&&TS.boot_data.other_accounts){if(TS.model.all_unread_highlights_cnt_to_exclude){n.push("TS.model.all_unread_highlights_cnt_to_exclude = "+TS.model.all_unread_highlights_cnt_to_exclude);s=Math.max(0,s-TS.model.all_unread_highlights_cnt_to_exclude)}if(TS.model.all_unread_cnt_to_exclude){n.push("TS.model.all_unread_cnt_to_exclude = "+TS.model.all_unread_cnt_to_exclude);o=Math.max(0,o-TS.model.all_unread_cnt_to_exclude)}}n.push("SSB setBadgeCount details: all_unread_highlights_cnt = "+s+", all_unread_cnt = "+o+", bullet = "+((window.winssb?!!TS.prefs.getPref("mac_ssb_bullet"):false)?"true":"false"))}n=n.join("\n");TS.cmd_handlers.addEphemeralFeedback(n);TS.info(n)}},"/slackdebugwidget":{localized:null,type:"client",autocomplete:false,alias_of:null,aliases:null,func:function e(){if(!TS.debug_widget)return;TS.debug_widget.toggle()}},"/slacktrace":{type:"client",autocomplete:function e(){return TS.client&&TS.client.traces.canTrace()},alias_of:null,aliases:null,desc:TS.i18n.t("Submit a performance profile to Slack","cmd_handlers")(),func:function e(t,r){if(!TS.client||!TS.client.traces.canTrace())return;TS.client.traces.startTrace(parseInt(r,10),{reason:"slashcommand"});TS.cmd_handlers.addEphemeralFeedback(TS.i18n.t("Thank you for submitting a performance profile to Slack!","cmd_handlers")())}},"/away":{localized:"/"+TS.i18n.t("away","cmd_handlers")(),type:"client",autocomplete:true,alias_of:null,aliases:null,desc:TS.i18n.t('Toggle your "away" status',"cmd_handlers")(),func:function e(t,r,n,i,a,s){TS.redux.presence.toggleUserPresence().then(function(e){var t=e.args.presence||TS.model.user.presence;var r;if("away"===t)r=":white_check_mark: "+TS.i18n.t("You are now marked as *away*.","cmd_handlers")();else r=":white_check_mark: "+TS.i18n.t("You are now marked as *active*.","cmd_handlers")();if(s&&a)TS.cmd_handlers.addEphemeralFeedback(r,{temporary:false,c_id:s.id,thread_ts:a.ts});else TS.cmd_handlers.addEphemeralFeedback(r,{temporary:false})}).catch(_.noop);if(r)TS.members.setUserStatus(r)}},"/prefs":{localized:"/"+TS.i18n.t("prefs","cmd_handlers")(),type:"client",autocomplete:true,alias_of:null,aliases:null,desc:TS.i18n.t("Open the preferences dialog","cmd_handlers")(),func:function e(){TS.ui.prefs_dialog.start()}},"/shortcuts":{localized:"/"+TS.i18n.t("shortcuts","cmd_handlers")(),type:"client",autocomplete:true,alias_of:null,aliases:["/keys"],localized_aliases:["/"+TS.i18n.t("keys","cmd_handlers")()],desc:TS.i18n.t("Open the keyboard shortcuts dialog","cmd_handlers")(),func:function e(){if(!TS.boot_data.feature_shortcuts_flexpane)TS.ui.shortcuts_dialog.start();else TS.ui.react_keyboard_shortcuts.toggleShortcutsFlexpane()}},"/keys":{localized:"/"+TS.i18n.t("keys","cmd_handlers")(),type:"client",autocomplete:true,alias_of:"/shortcuts",aliases:null,desc:"",func:function e(){TS.cmd_handlers["/shortcuts"].func()}},"/open":{localized:"/"+TS.i18n.t("open","cmd_handlers")(),type:"client",autocomplete:true,alias_of:null,aliases:["/join"],localized_aliases:["/"+TS.i18n.t("join","cmd_handlers")()],desc:TS.i18n.t("Open a channel","cmd_handlers")(),args:[{name:TS.i18n.t("channel","cmd_handlers")(),optional:true}],func:function e(t,r,n,i,a,s){if(1==n.length)TS.ui.channel_browser.start();else{var o=r;var l=_.trim(i.substr(t.length));var u=TS.format.texty.convertContentsStringToContents(l);o=TS.format.texty.convertContentsToStringForDisplay(u);o=TS.utility.cleanChannelName(o);var d=TS.channels.getChannelByName(o);var c=TS.groups.getGroupByName(o);if(d){if(d.is_member)TS.channels.displayChannel({id:d.id});else if(!TS.model.user.is_restricted)TS.channels.joinById(d.id,function(e,t){if(!e){var r=TS.i18n.t("There was a problem joining “{channel_name}”, sorry!","cmd_handlers")({channel_name:o});if("is_archived"==t.error)r=TS.i18n.t("“{channel_name}” has been archived, so can’t be opened.","cmd_handlers")({channel_name:o});if(s&&a)TS.cmd_handlers.addEphemeralFeedback(r,{temporary:false,slackbot_feels:"sad_surprise",c_id:s.id,thread_ts:a.ts});else TS.cmd_handlers.addEphemeralFeedback(r,{temporary:false,slackbot_feels:"sad_surprise"})}})}else if(c){if(!c.is_archived||c.was_archived_this_session)TS.groups.displayGroup({id:c.id})}else if(TS.permissions.members.canCreateChannels())TS.ui.new_channel_modal.start(o);else{var m=TS.i18n.t("I couldn’t find a channel named “{channel_name}”, sorry!","cmd_handlers")({channel_name:o});if(s&&a)TS.cmd_handlers.addEphemeralFeedback(m,{temporary:false,slackbot_feels:"sad_surprise",c_id:s.id,thread_ts:a.ts});else TS.cmd_handlers.addEphemeralFeedback(m,{temporary:false,slackbot_feels:"sad_surprise"})}}}},"/join":{localized:"/"+TS.i18n.t("join","cmd_handlers")(),type:"client",autocomplete:true,alias_of:"/open",aliases:null,desc:"",func:function e(t,r,n,i,a,s){TS.cmd_handlers["/open"].func(t,r,n,i,a,s)}},"/msg":{localized:"/"+TS.i18n.t("msg","cmd_handlers")(),type:"client",autocomplete:true,alias_of:null,aliases:["/dm"],localized_aliases:["/"+TS.i18n.t("dm","cmd_handlers")()],desc:TS.i18n.t("Send a DM message to another user","cmd_handlers")(),args:[{name:TS.i18n.t("@user","cmd_handlers")(),optional:false},{name:TS.i18n.t("your message","cmd_handlers")(),optional:true}],func:function e(t,r,n,i,a,s){var o=n.length>1?n[1]:"";var l;var u;var d=h(o);if(!d)if(o){var c=o.replace("#","");l=TS.channels.getChannelByName(c);if(!l)l=TS.groups.getGroupByName(c);if(!l){u=TS.i18n.t("A valid member name is required.","cmd_handlers")();if(s&&a)TS.cmd_handlers.addEphemeralFeedback(u,{input_txt:i,slackbot_feels:"sad_surprise",c_id:s.id,thread_ts:a.ts});else TS.cmd_handlers.addEphemeralFeedback(u,{input_txt:i,slackbot_feels:"sad_surprise"});return}}else $("#direct_messages_header").trigger("click.open_dialog").scrollintoview({duration:500});var m=r.replace(o,"");if(d)m=_.trim(i.substr(i.indexOf(">")+1));else m=_.trim(i.substr(i.indexOf(o)+o.length));if(d){if(d.deleted){u=TS.i18n.t("That user has been deactivated","cmd_handlers")()+" :disappointed:";if(s&&a)TS.cmd_handlers.addEphemeralFeedback(u,{input_txt:i,slackbot_feels:"sad_surprise",c_id:s.id,thread_ts:a.ts});else TS.cmd_handlers.addEphemeralFeedback(u,{input_txt:i,slackbot_feels:"sad_surprise"});return}TS.ims.startImByMemberId(d.id,false,m)}else if(l){if(l.is_archived){u=TS.i18n.t("That {channel} has been archived","cmd_handlers")({channel:l.is_channel?TS.i18n.t("channel","cmd_handlers")():TS.i18n.t("private channel","cmd_handlers")()});if(s&&a)TS.cmd_handlers.addEphemeralFeedback(u,{input_txt:i,slackbot_feels:"sad_surprise",c_id:s.id,thread_ts:a.ts});else TS.cmd_handlers.addEphemeralFeedback(u,{input_txt:i,slackbot_feels:"sad_surprise"});return}if(l.is_channel)TS.channels.displayChannel({id:l.id,and_send_txt:m});else TS.groups.displayGroup({id:l.id,and_send_txt:m})}}},"/invite":{localized:"/"+TS.i18n.t("invite","cmd_handlers")(),type:"client",autocomplete:true,alias_of:null,aliases:null,desc:TS.i18n.t("Invite another member to a channel","cmd_handlers")(),args:[{name:TS.i18n.t("@user","cmd_handlers")(),optional:false},{name:TS.i18n.t("channel","cmd_handlers")(),optional:true}],func:function e(t,r,n,i){var a=n.length>1?n[1]:"";var s=h(a);var o;if(a)o=TS.user_groups.getUserGroupsById(a.substr(1));if(!s&&!o&&a){TS.cmd_handlers.addEphemeralFeedback(TS.i18n.t("A valid member name is required.","cmd_handlers")(),{input_txt:i,slackbot_feels:"sad_surprise"});return}if(s&&s.deleted){TS.cmd_handlers.addEphemeralFeedback(TS.i18n.t("That user has been deactivated.","cmd_handlers")(),{input_txt:i,slackbot_feels:"sad_surprise"});return}var l=n.length>2?n[2]:"";var u=l?TS.channels.getChannelByName(l)||TS.groups.getGroupByName(l):TS.shared.getActiveModelOb();var d=function e(){if(s&&s.is_app_user){var t=TS.shared.getActiveModelOb();TS.apps.permissions.addAppToResource(s,t,i);return}if(!u||u.is_im||!s&&!o&&!u.is_mpim)TS.cmd_handlers.addEphemeralFeedback(TS.i18n.t("A valid channel name is required.","cmd_handlers")(),{input_txt:i,slackbot_feels:"sad_surprise"});else if(s)m(s,u,i);else if(o&&!u.is_mpim)f(o,u,i);else TS.ui.im_browser.startWithMpim(u)};if(!(s&&s.is_restricted)||u&&(u.is_im||u.is_mpim))d();else TS.members.fetchMemberProfileExtras(s.id,["channels"]).then(function(e){return e&&_.isArray(e.channels)&&e.channels||[]}).then(function(e){if(!s.is_ultra_restricted&&TS.model.user.is_admin||u&&e.indexOf(u.id)>-1)d();else if(s.is_ultra_restricted&&e.length){if(TS.model.user.is_admin)TS.cmd_handlers.addEphemeralFeedback(TS.i18n.t("*{user}* is a Single-Channel Guest and can’t be added to a second channel. To invite {user} to this channel, you’ll need to <{team_url}admin#restricted|upgrade their membership> to a Multi-Channel Guest. ​Note: This will add a billable seat to your workspace.","cmd_handlers")({user:p(s),team_url:TS.boot_data.team_url}),{input_txt:i,slackbot_feels:"sad_surprise"});else TS.cmd_handlers.addEphemeralFeedback(TS.i18n.t("*{user}* is a Single-Channel Guest and can’t be added to a second channel. Your Workspace Admin can upgrade their membership to a Multi-Channel Guest.","cmd_handlers")({user:p(s)}),{input_txt:i,slackbot_feels:"sad_surprise"});return false}else if(!TS.model.user.is_admin)if(s.is_ultra_restricted){TS.cmd_handlers.addEphemeralFeedback(TS.i18n.t("*{user}* is a Single-Channel Guest. Only your Workspace Admin can invite them to a channel.","cmd_handlers")({user:p(s)}),{input_txt:i,slackbot_feels:"sad_surprise"});return false}else if(u&&!u.is_private&&!u.is_group){TS.cmd_handlers.addEphemeralFeedback(TS.i18n.t("*{user}* is a Multi-Channel Guest. Only your Workspace Admin can invite them to a channel.","cmd_handlers")({user:p(s)}),{input_txt:i,slackbot_feels:"sad_surprise"});return false}d()})}},"/invite_people":{localized:"/"+TS.i18n.t("invite_people","cmd_handlers")(),type:"client",autocomplete:true,alias_of:null,aliases:null,desc:TS.i18n.t("Invite people to your workspace","cmd_handlers")(),args:[{name:TS.utility.exampleEmailAddress()+", ...",optional:true}],func:function e(t,r){if(TS.ui.admin_invites.canInvite()){r=r&&r.trim();if(r)TS.ui.admin_invites.populateInvites(r.split(/\s*,\s*|\s+/).map(function(e){return{email:e}}));TS.ui.admin_invites.start()}else TS.cmd_handlers.addEphemeralFeedback(TS.i18n.t("You don’t have permission to invite people.","cmd_handlers")(),{slackbot_feels:"sad_surprise"})}},"/dm":{localized:"/"+TS.i18n.t("dm","cmd_handlers")(),type:"client",autocomplete:true,alias_of:"/msg",aliases:null,desc:"",func:function e(t,r,n,i,a,s){TS.cmd_handlers["/msg"].func(t,r,n,i,a,s)}},"/archive":{localized:"/"+TS.i18n.t("archive","cmd_handlers")(),type:"client",autocomplete:true,alias_of:null,aliases:null,desc:TS.i18n.t("Archive the current channel","cmd_handlers")(),func:function e(){var t=TS.shared.getActiveModelOb();if(t.is_archived||TS.channels.isChannelRequired(t))return;if(t.is_channel&&!t.is_mpim){if(!TS.permissions.members.canArchiveChannels())return;TS.channels.ui.showArchiveChannelDialog(t)}else if(t.is_group&&!t.is_mpim){if(TS.model.user.is_restricted)return;TS.channels.ui.showArchiveGroupDialog(t)}}},"/leave":{localized:"/"+TS.i18n.t("leave","cmd_handlers")(),type:"client",autocomplete:true,alias_of:null,aliases:["/close","/part"],localized_aliases:["/"+TS.i18n.t("close","cmd_handlers")(),"/"+TS.i18n.t("part","cmd_handlers")()],desc:TS.i18n.t("Leave a channel","cmd_handlers")(),func:function e(t,r,n){if(1==n.length){var i=TS.shared.getActiveModelOb();if(i.is_channel)if(i.is_mpim)TS.channels.closeMpim(i.id);else if(i.is_archived)TS.channels.closeArchivedChannel(i.id);else TS.channels.leave(i.id);else if(i.is_im)TS.ims.closeIm(i.id);else if(i.is_mpim)TS.mpims.closeMpim(i.id);else if(i.is_group)if(i.is_archived)TS.shared.closeArchivedChannel(i.id);else TS.groups.leave(i.id);else TS.cmd_handlers.addEphemeralFeedback(TS.i18n.t("A valid channel or member name is required.","cmd_handlers")(),{slackbot_feels:"sad_surprise"})}else{var a=TS.channels.getChannelByName(r);if(a)TS.channels.leave(a.id);else TS.cmd_handlers.addEphemeralFeedback(TS.i18n.t("A valid channel name is required.","cmd_handlers")(),{slackbot_feels:"sad_surprise"})}}},"/star":{localized:"/"+TS.i18n.t("star","cmd_handlers")(),type:"client",autocomplete:true,alias_of:null,desc:TS.i18n.t("Stars the current channel or conversation","cmd_handlers")(),func:function e(t,r,n,i,a,s){var o;if(s&&a)TS.stars.toggleStarOnMsg(a.ts,s,function(){o=a.is_starred?TS.i18n.t("Ok, I starred this thread","cmd_handlers")():TS.i18n.t("Ok, I unstarred this thread","cmd_handlers")();TS.cmd_handlers.addEphemeralFeedback(o,{c_id:s.id,thread_ts:a.ts})});else TS.stars.toggleStarForActiveModel(function(e){if(e)o=TS.i18n.t("Ok, I starred {channel}","cmd_handlers")({channel:s.name});else o=TS.i18n.t("Ok, {channel} is unstarred","cmd_handlers")({channel:s.name});TS.cmd_handlers.addEphemeralFeedback(o)})}},"/close":{localized:"/"+TS.i18n.t("close","cmd_handlers")(),type:"client",autocomplete:true,alias_of:"/leave",aliases:null,desc:"",func:function e(t,r,n){TS.cmd_handlers["/leave"].func(t,r,n)}},"/part":{localized:"/"+TS.i18n.t("part","cmd_handlers")(),type:"client",autocomplete:true,alias_of:"/leave",aliases:null,desc:"",func:function e(t,r,n){TS.cmd_handlers["/leave"].func(t,r,n)}},"/topic":{localized:"/"+TS.i18n.t("topic","cmd_handlers")(),type:"client",autocomplete:true,alias_of:null,aliases:null,desc:TS.i18n.t("Set the channel topic","cmd_handlers")(),args:[{name:TS.i18n.t("new topic","cmd_handlers")(),optional:true}],func:function e(t,r,n,i){var a=TS.shared.getActiveModelOb();if(TS.model.user.is_restricted||TS.channels.isChannelRequired(a)&&!TS.permissions.members.canPostInChannel(a)){TS.cmd_handlers.addEphemeralFeedback(TS.i18n.t("Setting the topic is a restricted action.","cmd_handlers")(),{input_txt:i,slackbot_feels:"sad_surprise"});return}if(r.length>TS.model.channel_topic_max_length){TS.cmd_handlers.addEphemeralFeedback(TS.i18n.t("Topics cannot exceed {max_characters} characters.","cmd_handlers")({max_characters:TS.model.channel_topic_max_length}),{input_txt:i,slackbot_feels:"sad_surprise"});return}var s=_.trim(i.substr(t.length));if(a.is_channel&&!a.is_mpim)if(s)TS.channels.setTopic(a.id,s);else $("#channel_topic_text").click().focus().select();else if(a.is_group&&!a.is_mpim)if(s)TS.groups.setTopic(a.id,s);else $("#channel_topic_text").click().focus().select();else TS.cmd_handlers.addEphemeralFeedback(TS.i18n.t("Regrettably, direct messages do not have topics","cmd_handlers")(),{slackbot_feels:"sad_surprise"})}},"/togglethemes":{localized:"/"+TS.i18n.t("togglethemes","cmd_handlers")(),type:"client",autocomplete:false,alias_of:null,aliases:null,desc:"",func:function e(){TS.prefs.setPrefByAPI({name:"messages_theme",value:"light_with_avatars"===TS.prefs.getPref("messages_theme")?"dense":"light_with_avatars"})}},"/search":{localized:"/"+TS.i18n.t("search","cmd_handlers")(),type:"client",autocomplete:true,alias_of:null,aliases:["/s"],localized_aliases:["/"+TS.i18n.t("s","cmd_handlers")()],desc:TS.i18n.t("Perform a search","cmd_handlers")(),args:[{name:TS.i18n.t("your text","cmd_handlers")(),optional:true}],func:function e(t,r){TS.client.ui.flex.openFlexTab("search");TS.view.resizeManually("TS.search.view.showResults");TS.search.autocomplete.search(r,true);TS.clog.track("SEARCH_OPEN",{open_method:"command",search_session_id:TS.search.getSearchSessionId()})}},"/s":{localized:"/"+TS.i18n.t("s","cmd_handlers")(),type:"client",autocomplete:true,alias_of:"/search",aliases:null,desc:"",func:function e(t,r){TS.cmd_handlers["/search"].func(t,r)}},"/rename":{localized:"/"+TS.i18n.t("rename","cmd_handlers")(),type:"client",autocomplete:true,alias_of:null,aliases:null,desc:TS.i18n.t("Rename a channel","cmd_handlers")(),args:[{name:TS.i18n.t("new name","cmd_handlers")(),optional:true}],func:function e(t,r){if(TS.model.user.is_restricted){TS.cmd_handlers.addEphemeralFeedback(TS.i18n.t("You don’t have permission to rename.","cmd_handlers")(),{slackbot_feels:"sad_surprise"});return}var n=TS.shared.getActiveModelOb();if(n.is_mpim||n.is_im){TS.cmd_handlers.addEphemeralFeedback(TS.i18n.t("Direct messages don’t even have a name! Ergo, regrettably, you can’t change it.","cmd_handlers")(),{slackbot_feels:"sad_surprise"});return}else if(n.is_channel||n.is_group)if(!TS.model.user.is_admin&&n.creator!=TS.model.user.id){TS.cmd_handlers.addEphemeralFeedback(TS.i18n.t("Only Workspace Admins (or the channel creator) are allowed to rename channels.","cmd_handlers")(),{slackbot_feels:"sad_surprise"});return}var i=_.escape(r)||n.name;TS.ui.channel_options_dialog.start(n.id,"rename",{name:i})}},"/beep":{localized:"/"+TS.i18n.t("beep","cmd_handlers")(),type:"client",autocomplete:false,alias_of:null,aliases:null,desc:"",func:function e(){TS.sounds.play("new_message")}},"/upload":{localized:"/"+TS.i18n.t("upload","cmd_handlers")(),type:"client",autocomplete:false,alias_of:null,aliases:null,desc:"",func:function e(t,r){var n=TS.utility.base64StrtoBlob(r);TS.client.ui.file_pasted_sig.dispatch(n)}},"/colors":{localized:"/"+TS.i18n.t("colors","cmd_handlers")(),type:"client",autocomplete:false,alias_of:null,aliases:["/colours"],localized_aliases:["/"+TS.i18n.t("colours","cmd_handlers")()],desc:TS.i18n.t("View any custom colors you have set for other members","cmd_handlers")(),func:function e(t,r,n,i,a,s){var o=TS.members.getMembersForUser();var l;var u="";for(var d=0;d<o.length;d+=1){l=o[d];if(l.member_color!=l.color)u+=l.name+": "+l.member_color+"\n"}var _=u?TS.i18n.t("You have overridden colors as follows:","cmd_handlers")()+"\n"+u:TS.i18n.t("No user color overrides have been set.","cmd_handlers")();if(s&&a)TS.cmd_handlers.addEphemeralFeedback(_,{temporary:false,c_id:s.id,thread_ts:a.ts});else TS.cmd_handlers.addEphemeralFeedback(_,{temporary:false})}},"/colours":{localized:"/"+TS.i18n.t("colours","cmd_handlers")(),type:"client",autocomplete:true,alias_of:"/colors",aliases:null,desc:"",func:function e(t,r,n,i,a,s){TS.cmd_handlers["/colors"].func(t,r,n,i,a,s)}},"/color":{localized:"/"+TS.i18n.t("color","cmd_handlers")(),type:"client",autocomplete:false,alias_of:null,aliases:["/colour"],localized_aliases:["/"+TS.i18n.t("colour","cmd_handlers")()],desc:TS.i18n.t("Set a custom color for another member","cmd_handlers")(),func:function e(t,r,n,i,a,s){var o=n.length>1?n[1]:"";var l=n.length>2?n[2].replace(/#/g,""):"";var u;var d=h(o);if(!d){u=TS.i18n.t("A valid member name is required.","cmd_handlers")();if(s&&a)TS.cmd_handlers.addEphemeralFeedback(u,{input_txt:i,slackbot_feels:"sad_surprise",c_id:s.id,thread_ts:a.ts});else TS.cmd_handlers.addEphemeralFeedback(u,{input_txt:i,slackbot_feels:"sad_surprise"});return}var _;if(d)_=TS.members.getPrefCompliantMemberName(d,true,true);if(l&&(6!=l.length||!("#"+l).match(TS.format.hex_rx))){u=TS.i18n.t("A valid 6 character hex code is required, like `FF0000`.","cmd_handlers")();if(s&&a)TS.cmd_handlers.addEphemeralFeedback(u,{input_txt:i,c_id:s.id,thread_ts:a.ts});else TS.cmd_handlers.addEphemeralFeedback(u,{input_txt:i});return}TS.members.setMemberUserColor(d,l);TS.prefs.setPrefLocal("user_colors",JSON.stringify(TS.model.user_colors));TS.prefs.setPrefByAPI({name:"user_colors",value:TS.prefs.getPref("user_colors")});if(l)u=TS.i18n.t("You’ve set your custom color for {user} to {color}","cmd_handlers")({user:_,color:"#"+l});else u=TS.i18n.t("You’ve removed your custom color for {user}.","cmd_handlers")({user:_});if(s&&a)TS.cmd_handlers.addEphemeralFeedback(u,{input_txt:i,c_id:s.id,thread_ts:a.ts});else TS.cmd_handlers.addEphemeralFeedback(u,{input_txt:i})}},"/colour":{localized:"/"+TS.i18n.t("colour","cmd_handlers")(),type:"client",autocomplete:true,alias_of:"/color",aliases:null,desc:"",func:function e(t,r,n,i,a,s){TS.cmd_handlers["/color"].func(t,r,n,i,a,s)}},"/colortest":{localized:"/"+TS.i18n.t("colortest","cmd_handlers")(),type:"client",autocomplete:false,alias_of:null,aliases:null,desc:"",func:function e(t,r){var n=null;if(r)try{n=JSON.parse(r)}catch(e){TS.cmd_handlers.addEphemeralFeedback(TS.i18n.t("Not a good value for colors: ","cmd_handlers")()+r,{slackbot_feels:"sad_surprise"});return}if(!n||!n.length)n=["#DDCFFA","#2EF645","#F38303","#E702AE","#3C986D","#9D6158","#F43368","#97C10A","#7491F9","#9E63A3","#FACE41","#35A5CC","#39A93E","#4FECA8","#CA5B34","#E2A974","#2BCFCB","#F89BA7","#89868A","#6A7841","#ADC498","#B1DBDD","#B849C3","#9CDB81","#E72F36","#A16A28","#F68CCF","#317C84","#58851C","#FC4A97","#5774BB","#97B7FE","#C64D97","#CB4A5C","#F68B6B","#81EE4F","#B7ED6D","#756D8E","#3AED69","#81E7FB","#91ECB7","#ED8947","#57AF19","#28BC89","#4A9788","#D645DF","#B498FE","#71C8F9","#C07B1D","#16BD60","#EFCAE3","#A4E0BB","#478AAF","#59953E","#886CA7","#F0C3F1","#29AF70","#80A5F8","#636BB8"];var i;for(i=0;i<n.length;i+=1)n[i]=n[i].replace("#","");var a=TS.members.getMembersForUser();for(i=0;i<a.length;i+=1)TS.members.setMemberUserColor(a[i],n[_.random(0,n.length-1)])}},"/discon":{localized:null,type:"client",autocomplete:false,alias_of:null,aliases:null,desc:"",func:function e(){TS.interop.SocketManager.disconnect()}},"/sleepsleep":{localized:null,type:"client",autocomplete:false,alias_of:null,aliases:null,desc:"",func:function e(){TS.interop.SocketManager.sleep()}},"/sleepsleep2":{localized:null,type:"client",autocomplete:false,alias_of:null,aliases:null,desc:"",func:function e(){TS.interop.SocketManager.clearFastReconnectUrl();TS.interop.SocketManager.sleep()}},"/wakewake":{localized:null,type:"client",autocomplete:false,alias_of:null,aliases:null,desc:"",func:function e(){TS.interop.SocketManager.wake()}},"/discon4":{localized:null,type:"client",autocomplete:false,alias_of:null,aliases:null,desc:"",func:function e(){TS.interop.SocketManager.clearFastReconnectUrl();TS.interop.SocketManager.disconnect()}},"/emo":{localized:"/"+TS.i18n.t("emo","cmd_handlers")(),type:"client",autocomplete:false,alias_of:null,aliases:["/emote","/emoji"],localized_aliases:["/"+TS.i18n.t("emote","cmd_handlers")(),"/"+TS.i18n.t("emoji","cmd_handlers")()],desc:"",func:function e(){var t={target:TS.client.ui.$msg_input};TS.ui.react_emoji_menu.start({e:t})}},"/emoji":{localized:"/"+TS.i18n.t("emoji","cmd_handlers")(),type:"client",autocomplete:false,alias_of:"/emo",aliases:null,desc:"",func:function e(){TS.cmd_handlers["/emo"].func()}},"/emote":{localized:"/"+TS.i18n.t("emote","cmd_handlers")(),type:"client",autocomplete:false,alias_of:"/emo",aliases:null,desc:"",func:function e(){TS.cmd_handlers["/emo"].func()}},"/editlast":{localized:"/"+TS.i18n.t("editlast","cmd_handlers")(),type:"client",autocomplete:false,alias_of:null,aliases:null,desc:TS.i18n.t("Edit the last message you posted","cmd_handlers")(),func:function e(t,r,n,i,a,s){var o=s||TS.shared.getActiveModelOb();var l;if(!o)return;r=$.trim(r);if(!r){l=TS.i18n.t("You must enter some text!","cmd_handlers")();if(o&&a)TS.cmd_handlers.addEphemeralFeedback(l,{input_txt:i,c_id:o.id,thread_ts:a.ts});else TS.cmd_handlers.addEphemeralFeedback(l,{input_txt:i});return}var u;if(o&&a)u=TS.utility.msgs.getEditableReplyByProp("user",TS.model.user.id,o,a.ts);else{var d;if(TS.useReactMessages())d=TS.redux.messages.getMessagesByChannelId(o.id);else d=o.msgs;d=_.reject(d,TS.utility.msgs.isMsgReply);u=TS.utility.msgs.getEditableMsgByProp("user",TS.model.user.id,d)}if(!u){l=TS.i18n.t("Found no recent messages from you to edit.","cmd_handlers")();if(o&&a)TS.cmd_handlers.addEphemeralFeedback(l,{input_txt:i,slackbot_feels:"sad_surprise",c_id:o.id,thread_ts:a.ts});else TS.cmd_handlers.addEphemeralFeedback(l,{input_txt:i,slackbot_feels:"sad_surprise"});return}if(TS.useReactMessages())TS.redux.dispatch(TS.interop.redux.actions.saveMessageEdit({channelId:o.id,ts:u.ts,text:r}));else TS.msg_edit.commitEdit(u,o,r)}},"/deletelast":{localized:"/"+TS.i18n.t("deletelast","cmd_handlers")(),type:"client",autocomplete:false,alias_of:null,aliases:null,desc:TS.i18n.t("Delete the last message you posted","cmd_handlers")(),func:function e(t,r,n,i,a,s){var o=s||TS.shared.getActiveModelOb();if(!o)return;var l;if(o&&a)l=TS.utility.msgs.getEditableReplyByProp("user",TS.model.user.id,o,a.ts);else{var u;if(TS.useReactMessages())u=TS.redux.messages.getMessagesByChannelId(o.id);else u=o.msgs;u=_.reject(u,TS.utility.msgs.isMsgReply);l=TS.utility.msgs.getEditableMsgByProp("user",TS.model.user.id,u)}if(!l){var d=TS.i18n.t("Found no recent messages from you to delete.","cmd_handlers")();if(o&&a)TS.cmd_handlers.addEphemeralFeedback(d,{slackbot_feels:"sad_surprise",c_id:o.id,thread_ts:a.ts});else TS.cmd_handlers.addEphemeralFeedback(d,{slackbot_feels:"sad_surprise"});return}TS.msg_edit.startDelete(l.ts,o)}},"/collapse":{localized:"/"+TS.i18n.t("collapse","cmd_handlers")(),type:"client",autocomplete:true,alias_of:null,aliases:null,desc:TS.i18n.t("Collapse all files in the current channel (opposite of /expand)","cmd_handlers")(),func:function e(){if(TS.useReactMessages()){var t=TS.shared.getActiveModelOb().id;var r=TS.redux.messages.getExpandablesInChannel(t);var n=_.zipObject(r,_.map(r,function(){return false}));TS.redux.dispatch(TS.interop.redux.features.expandables.bulkSetExpanded(n))}else{TS.inline_imgs.collapseAllInCurrent();TS.inline_videos.collapseAllInCurrent();TS.inline_attachments.collapseAllInCurrent();TS.inline_audios.collapseAllInCurrent();TS.inline_others.collapseAllInCurrent();TS.inline_file_previews.collapseAllInCurrent()}TS.cmd_handlers.addEphemeralFeedback(TS.i18n.t("I’ve collapsed all files in this channel for you.","cmd_handlers")(),{temporary:false})}},"/expand":{localized:"/"+TS.i18n.t("expand","cmd_handlers")(),type:"client",autocomplete:true,alias_of:null,aliases:null,desc:TS.i18n.t("Expand all files in the current channel (opposite of /collapse)","cmd_handlers")(),func:function e(){if(TS.useReactMessages()){var t=TS.shared.getActiveModelOb().id;var r=TS.redux.messages.getExpandablesInChannel(t);var n=_.zipObject(r,_.map(r,function(){return true}));TS.redux.dispatch(TS.interop.redux.features.expandables.bulkSetExpanded(n))}else{TS.inline_imgs.expandAllInCurrent();TS.inline_videos.expandAllInCurrent();TS.inline_attachments.expandAllInCurrent();TS.inline_audios.expandAllInCurrent();TS.inline_others.expandAllInCurrent();TS.inline_file_previews.expandAllInCurrent()}TS.cmd_handlers.addEphemeralFeedback(TS.i18n.t("I’ve expanded all files in this channel for you.","cmd_handlers")(),{temporary:false})}},"/attach_align":{localized:"/"+TS.i18n.t("attach_align","cmd_handlers")(),type:"client",autocomplete:false,alias_of:null,aliases:null,desc:"",func:function e(){$("body").toggleClass("attachments_flush_with_avatar")}},"/attach_thumb_align":{localized:null,type:"client",autocomplete:false,alias_of:null,aliases:null,desc:"",func:function e(){window.attach_thumb_align_title=!window.attach_thumb_align_title;TS.client.msg_pane.rebuildMsgsWithReason("/attach_thumb_align command")}},"/remove":{localized:"/"+TS.i18n.t("remove","cmd_handlers")(),type:"client",autocomplete:true,alias_of:null,aliases:["/kick"],localized_aliases:["/"+TS.i18n.t("kick","cmd_handlers")()],desc:TS.i18n.t("Remove a person from the current channel","cmd_handlers")(),args:[{name:TS.i18n.t("@user","cmd_handlers")(),optional:false}],func:function e(t,r,n,i){var a=TS.shared.getActiveModelOb();r=$.trim(r);var s=h(r);if((a.is_im||a.is_mpim)&&!s.is_app_user){TS.cmd_handlers.addEphemeralFeedback(TS.i18n.t("You can’t remove someone from a direct message.","cmd_handlers")(),{slackbot_feels:"sad_surprise"});return}else if(a.is_channel&&!TS.permissions.members.canKickFromChannels()){TS.cmd_handlers.addEphemeralFeedback(TS.i18n.t("Removing someone from a channel is a restricted action.","cmd_handlers")(),{slackbot_feels:"sad_surprise"});return}else if(a.is_group&&!TS.permissions.members.canKickFromGroups()){TS.cmd_handlers.addEphemeralFeedback(TS.i18n.t("Removing someone from a private channel is a restricted action.","cmd_handlers")(),{slackbot_feels:"sad_surprise"});return}if(a.is_archived){TS.cmd_handlers.addEphemeralFeedback(TS.i18n.t("You can’t remove anyone from *{channel}* while it is archived.","cmd_handlers")({channel:(TS.model.active_channel_id?"#":"")+a.name}),{slackbot_feels:"sad_surprise"});return}if(!r){TS.cmd_handlers.addEphemeralFeedback(TS.i18n.t("Please specify someone to remove!","cmd_handlers")(),{input_txt:i});return}if(!s){var o=TS.format.texty.convertContentsStringToContents(_.trim(i.substr(t.length)));TS.cmd_handlers.addEphemeralFeedback(TS.i18n.t("*{input}* is not a recognized member name.","cmd_handlers")({input:_.escape(TS.format.texty.convertContentsToStringForDisplay(o))}),{input_txt:i,slackbot_feels:"sad_surprise"});return}if(s.is_app_user){TS.apps.permissions.removeAppFromResource(s,a,i);return}if(TS.channels.isChannelRequired(a)&&!s.is_restricted&&!s.is_bot){TS.cmd_handlers.addEphemeralFeedback(TS.i18n.t("You can’t remove this member from *{channel}*!","cmd_handlers")({channel:(TS.model.active_channel_id?"#":"")+a.name}));return}TS.membership.ensureChannelMembershipIsKnownForUsers(a.id,[s.id]).then(function(){var e;if(TS.boot_data.feature_store_membership_in_redux)e=TS.redux.membership.getChannelMembershipInfoForUser(a.id,s.id);else e=TS.membership.getUserChannelMembershipStatus(s.id,a);if(!e.is_member){var r=TS.format.texty.convertContentsStringToContents(_.trim(i.substr(t.length)));TS.cmd_handlers.addEphemeralFeedback(TS.i18n.t("*{user}* is not a member of this {channel}.","cmd_handlers")({user:_.escape(TS.format.texty.convertContentsToStringForDisplay(r)),channel:a.is_channel?TS.i18n.t("channel","cmd_handlers")():TS.i18n.t("private channel","cmd_handlers")()}),{input_txt:i,slackbot_feels:"sad_surprise"});return}if(s.is_self){TS.client.ui.onSubmit("/leave");return}if(TS.utility.teams.isMemberExternal(s)){var n;if(TS.boot_data.page_needs_enterprise)n=TS.i18n.t("You can’t remove {member_name} from this channel, because they’re from a workspace outside your organization.","cmd_handlers")({member_name:p(s)});else n=TS.i18n.t("You can’t remove {member_name} from this channel, because they’re from another workspace.","cmd_handlers")({member_name:p(s)});TS.cmd_handlers.addEphemeralFeedback(n,{input_txt:i,slackbot_feels:"sad_surprise"});return}if(a.is_channel)TS.channels.kickMember(a.id,s.id);else if(a.is_group)TS.groups.kickMember(a.id,s.id)})}},"/kick":{localized:"/"+TS.i18n.t("kick","cmd_handlers")(),type:"client",autocomplete:true,alias_of:"/remove",aliases:null,desc:"",func:function e(t,r,n,i){TS.cmd_handlers["/remove"].func(t,r,n,i)}},"/feedback":{localized:"/"+TS.i18n.t("feedback","cmd_handlers")(),type:"client",autocomplete:true,alias_of:null,aliases:null,desc:TS.i18n.t("Send feedback to Slack","cmd_handlers")(),args:[{name:TS.i18n.t("your message","cmd_handlers")(),optional:true}],func:function e(t,r,n,i,a,s){if(!r){TS.utility.openInNewTab("/help/requests/new","_blank");return}var o=_.trim(i.substr(t.length));o=TS.format.texty.convertContentsStringToDisplayString(o);TS.generic_dialog.start({title:TS.i18n.t("Send feedback","cmd_handlers")(),body:'<p class="bold">'+TS.i18n.t("Looks like you are trying to send us some feedback! Yes?","cmd_handlers")()+"</p>",show_cancel_button:true,show_go_button:true,go_button_text:TS.i18n.t("Yes, send it","cmd_handlers")(),onGo:function e(){var r={command:t,text:o,channel:TS.model.active_cid,client_token:TS.interop.client_action_token.generateAndEnqueue()};if(s&&a){r.channel=s.id;r.thread_ts=a.ts}var n=i;var l=function e(t,r,i){TS.client.ui.onAPICommand(t,r,i,n)};TS.api.call("chat.command",r).then(function(e){var t=e.data,r=e.args,n=e.request_id;var i=true;l(i,t,r,n);return{data:t,args:r,request_id:n}}).catch(function(e){var t=e.data,r=e.args,n=e.request_id;var i=false;l(i,t,r,n);return{data:t,args:r,request_id:n}})},onCancel:function e(){if(s&&a)TS.utility.populateThreadInputs(i,s.id,a.ts);else TS.utility.populateInput(TS.client.ui.$msg_input,i)}})}},"/shrug":{localized:"/"+TS.i18n.t("shrug","cmd_handlers")(),type:"client",autocomplete:true,alias_of:null,aliases:null,desc:TS.i18n.t("Appends ¯\\_(ツ)_/¯ to your message","cmd_handlers")(),args:[{name:TS.i18n.t("your message","cmd_handlers")(),optional:true}],func:function e(t,r,n,i,a,s){var o=_.trim(i.substr(t.length));if(o&&" "!==o.substr(o.length-1))o+=" ";o+="¯\\_(ツ)_/¯ ";if(!s)s=TS.shared.getActiveModelOb();TS.client.ui.sendMessage(s,o,a)}},"/showfallbacks":{localized:null,type:"client",autocomplete:false,alias_of:null,aliases:null,desc:"",func:function e(){TS.model.show_attachment_fallback=!TS.model.show_attachment_fallback;TS.client.msg_pane.rebuildMsgsWithReason("/showfallbacks command")}},"/toggle_debugging_prefs":{localized:null,type:"client",autocomplete:false,alias_of:null,aliases:null,desc:"",func:function e(){TS.ui.prefs_dialog.start("advanced","#prefs_debug")}},"/weighscale":{localized:null,type:"client",autocomplete:false,alias_of:null,aliases:null,desc:"Output size and counts of local model to console.",func:function e(){TS.interop.console.info("Weigh Scale","Calculating local model size ...");TS.metrics.reportModelSize()}}});var e=["/shrug","/prefs","/shortcuts","/keys","/toggle_debugging_prefs","/away","/search","/togglethemes","/feedback","/slack_diagnostic_report","/msg","/dm","/s","/editlast","/deletelast","/star","/beep","/colors","/colours","/color","/colour","/active"];var t;var r={localized:null,type:"client",autocomplete:true,alias_of:null,aliases:null,desc:TS.i18n.t("Start a call","cmd_handlers")(),args:[{name:TS.i18n.t("help","cmd_handlers")(),optional:true}],can_be_overridden_by_server_cmd:true,func:function e(t,r){var n=TS.shared.getActiveModelOb();var i=TS.members.getMemberById(n.user);if(TS.boot_data.page_needs_enterprise){var a=TS.model.team;if(TS.shared.isModelObShared(n)||i&&a&&i.team_id!==a.id){TS.cmd_handlers.addEphemeralFeedback(TS.i18n.t("You are not allowed to use this command here.","cmd_handlers")(),{slackbot_feels:"sad_surprise"});return}}if("help"===r.trim()){var s;if(TS.utility.calls.isCurrentContextMultiParty()&&!TS.utility.calls.isMultiPartyEnabled())s=TS.i18n.t("To call someone, use `/call` in a direct message to them.","cmd_handlers")();else if(n.is_mpim)s=TS.i18n.t("To call {group_name}, use `/call` in this group conversation.","cmd_handlers")({group_name:TS.shared.getDisplayNameForModelOb(n)});else if(n.is_im)s=TS.i18n.t("To call {user}, use `/call` in this Direct Message conversation.","cmd_handlers")({user:TS.shared.getDisplayNameForModelOb(n)});else s=TS.i18n.t("To start a call in {channel}, use `/call` here.","cmd_handlers")({channel:TS.shared.getDisplayNameForModelOb(n)});s+="\n";s+=TS.i18n.t("To run a series of tests, use `/call --test` here.","cmd_handlers")();TS.cmd_handlers.addEphemeralFeedback(s);return}if(r.trim().match(/--server=/)){var o=r.trim().replace(/--server=/g,"");var l=TS.storage.fetchCallsState();l.call_server_override=o;TS.storage.storeCallsState(l)}if(r.trim().match(/--test/)){var u="https://"+window.location.host+"/help/test/calls";if(TS.model.is_our_app)TS.client.windows.openWindow({url:u,no_spinner:true});else window.open(u,"calls_test");return}if(TS.utility.calls.isCurrentContextMultiParty()&&!TS.utility.calls.isMultiPartyEnabled()){if("Slack"!==TS.prefs.getTeamPref("calling_app_name")){TS.utility.calls.startCallInModelOb(n,true);return}TS.cmd_handlers.addEphemeralFeedback(TS.i18n.t("Group calls aren’t available on the free plan. Try using `/call` in a Direct Message conversation!","cmd_handlers")());return}else if(n.is_slackbot_im){var d=[TS.i18n.t("I’m on the other line. Sorry!","cmd_handlers")(),TS.i18n.t("Thanks for calling me! I’m afraid I only accept calls from my mother, Sundays at 2pm.","cmd_handlers")(),TS.i18n.t("I’m washing my hair right now…can’t come to the phone!","cmd_handlers")(),TS.i18n.t("It’s awfully nice of you to try calling me. But — shh! — I’m quite afraid of the phone!","cmd_handlers")()+" :grimacing:",TS.i18n.t("Thank you so much for calling, but I can’t talk right now, I’m watching my stories.","cmd_handlers")()];var c=_.shuffle(d)[0];TS.cmd_handlers.addEphemeralFeedback(c);return}else if(i&&(i.is_bot||i.id==TS.model.user.id)){TS.cmd_handlers.addEphemeralFeedback(TS.i18n.t("Unfortunately, {user} is busy right now, and can’t answer your call.","cmd_handlers")({user:TS.members.getPrefCompliantMemberName(i,false,true)}),{slackbot_feels:"sad_surprise"});return}TS.utility.calls.startCallInModelOb(n,true)}};var n=function r(){if(t||TS.i18n.locale()===TS.interop.I18n.DEFAULT_LOCALE)return;t=true;var n;var i;_.forOwn(TS.cmd_handlers,function(t,r){if(0!==r.indexOf("/"))return;n=TS.cmd_handlers[r].localized?TS.cmd_handlers[r].localized.toLowerCase():null;if(n&&n!==r&&!TS.cmd_handlers[n]){TS.cmd_handlers[n]=_.clone(TS.cmd_handlers[r]);TS.cmd_handlers[n].localized=null;TS.cmd_handlers[n].canonical_name=r;TS.cmd_handlers[r].autocomplete=false;i=TS.interop.I18n.deburr(n);if(n!==i){TS.cmd_handlers[n].normalized=i;if(!TS.cmd_handlers[i])TS.cmd_handlers[i]=_.clone(TS.cmd_handlers[r])}if(_.includes(e,r))e.push(n)}})};var i=function e(t,r){TS.model.commands_cache_ts=r;var n={data:t,cache_ts:TS.model.commands_cache_ts,locale:TS.i18n.locale()};TS.storage.storeCmds(n);TS.cmd_handlers.mergeInServerCmds(t);o()};var a=function e(){var t=TS.storage.fetchCmds();if(!t)return false;if(TS.model.commands_cache_ts!==t.cache_ts)return false;if(TS.i18n.locale()!==t.locale)return false;return true};var s=function e(){TS.cmd_handlers.setUpCmds()};var o=function e(){var t="/"+TS.i18n.t("call","cmd_handlers")();var n=TS.interop.I18n.deburr(t);if(!TS.utility.calls.isEnabled()){if(TS.cmd_handlers["/call"]&&"client"===TS.cmd_handlers["/call"].type)_.unset(TS.cmd_handlers,"/call");if(TS.cmd_handlers[t]&&"client"===TS.cmd_handlers[t].type)_.unset(TS.cmd_handlers,t);if(t!==n&&TS.cmd_handlers[n]&&"client"===TS.cmd_handlers[n].type)_.unset(TS.cmd_handlers,t)}else if(!TS.cmd_handlers["/call"])if("/call"===t)TS.cmd_handlers["/call"]=r;else{TS.cmd_handlers[t]=_.clone(r);var i=_.clone(r);i.autocomplete=false;i.localized=null;TS.cmd_handlers["/call"]=i;if(t!==n){TS.cmd_handlers[t].normalized=n;if(!TS.cmd_handlers[n])TS.cmd_handlers[n]=i}}};var l=function e(t){var r=false;var n=TS.shared.getActiveModelOb();if(TS.shared.isModelObOrgShared(n))r=true;return{cmds:t.filter(function(e){return("core"===e.type||"client"===e.type)&&!(r&&"/call"===e.name)}),id:"core",name:"Slack"}};var u=function e(t){return{cmds:t.filter(function(e){return"custom"===e.type}),id:"custom",name:TS.model.team.name}};var d=function e(t){if(!TS.model.apps[t])return false;if(!TS.model.apps[t].is_xoxa_app)return false;var r=TS.apps.permissions.getAppUserResourceMembershipStatus(TS.model.apps[t].app_user_id,TS.model.active_cid);if(true===r.is_known&&false===r.is_member)return true;return false};var c=function e(t){var r=t.filter(function(e){return"app"===e.type||"service"===e.type});var n=r.filter(function(e){return!!(e.service_name||e.app)});var i=r.filter(function(e){return!(e.service_name||e.app)});var a={};n.forEach(function(e){var t=TS.cmd_handlers.getAppNameForCmdName(e.name);if(!a[t])a[t]=[];a[t].push(e)});var s=TS.apps.sortNames(Object.keys(a));var o=s.map(function(e){var t={cmds:a[e],id:"app",name:e};if(TS.apps.permissions.areXoxaAppsInstalled())t.xoxa_app_not_in_channel=d(a[e][0].app);return t});o.push({cmds:i,id:"app",name:"Other"});return o};var m=function e(t,r,n){if(!_.isObject(t))throw new Error("Expected user to be an object");if(!_.isObject(r))throw new Error("Expected model_ob to be an object");if(!_.isString(n))throw new Error("Expected input_txt to be a string");return TS.membership.ensureChannelMembershipIsKnownForUsers(r.id,[t.id]).then(function(){var e;if(TS.boot_data.feature_store_membership_in_redux)e=TS.redux.membership.getChannelMembershipInfoForUser(r.id,t.id);else e=TS.membership.getUserChannelMembershipStatus(t.id,r);if(e.is_member){TS.cmd_handlers.addEphemeralFeedback(TS.i18n.t("{user} is already in this channel.","cmd_handlers")({user:p(t)}),{input_txt:n});return}if(!r.is_mpim&&!TS.permissions.channels.canMemberBeInvitedToChannel(r,t)){var i;if(TS.boot_data.page_needs_enterprise){if(TS.utility.teams.isMemberExternal(t))if(TS.shared.isModelObShared(r)||!TS.teams.getTeamNameByMember(t))i=TS.i18n.t("{member_name} can’t be invited to this channel because they’re from a workspace outside your organization.","cmd_handlers")({member_name:p(t)});else if(1===TS.prefs.getTeamPref("enable_shared_channels"))i=TS.i18n.t("{member_name} can’t be invited to this channel because they’re from a workspace outside your organization. If you’d like, you can share this channel with {team_name}.","cmd_handlers")({member_name:p(t),team_name:TS.teams.getTeamNameByMember(t)});else i=TS.i18n.t("{member_name} can’t be invited to this channel because they’re from a workspace outside your organization. If you’d like, you can share this channel with {team_name}. <https://get.slack.help/hc/articles/115004151183|Learn about shared channels>","cmd_handlers")({member_name:p(t),team_name:TS.teams.getTeamNameByMember(t)});else i=TS.i18n.t("{user} is not a member of {team_name}.","cmd_handlers")({user:p(t),team_name:TS.model.team.name});TS.cmd_handlers.addEphemeralFeedback(i,{input_txt:n,slackbot_feels:"sad_surprise"});return}else if(TS.utility.teams.isMemberExternal(t)){if(TS.shared.isModelObShared(r)||!TS.teams.getTeamNameByMember(t))i=TS.i18n.t("{member_name} can’t be invited to this channel because they’re from another workspace.","cmd_handlers")({member_name:p(t)});else if(1===TS.prefs.getTeamPref("enable_shared_channels"))i=TS.i18n.t("{member_name} can’t be invited to this channel because they’re from another workspace. If you’d like, you can share this channel with {team_name}.","cmd_handlers")({member_name:p(t),team_name:TS.teams.getTeamNameByMember(t)});else i=TS.i18n.t("{member_name} can’t be invited to this channel because they’re from another workspace. If you’d like, you can share this channel with {team_name}. <https://get.slack.help/hc/articles/115004151183|Learn about shared channels>","cmd_handlers")({member_name:p(t),team_name:TS.teams.getTeamNameByMember(t)});TS.cmd_handlers.addEphemeralFeedback(i,{input_txt:n,slackbot_feels:"sad_surprise"});return}}if(r.is_mpim)TS.ui.im_browser.startWithMpim(r,[t.id]);else if(r.is_group)TS.ui.invite.showInviteMembersPreSelected(r.id,[t.id]);else return TS.api.call("conversations.invite",{channel:r.id,users:t.id})})};var f=function e(t,r,n){if(!_.isObject(t))throw new Error("Expected ug to be an object");if(!_.isObject(r))throw new Error("Expected model_ob to be an object");if(!_.isString(n))throw new Error("Expected input_txt to be a string");TS.membership.ensureChannelMembershipIsKnownForUsers(r.id,t.users).then(function(){var e=t.users.filter(function(e){if(TS.boot_data.page_needs_enterprise){var t=TS.members.getMemberById(e);if(!TS.permissions.channels.canMemberBeInvitedToChannel(r,t))return false}var n;if(TS.boot_data.feature_store_membership_in_redux)n=TS.redux.membership.getChannelMembershipInfoForUser(r.id,e);else n=TS.membership.getUserChannelMembershipStatus(e,r);return!n.is_member});if(!e.length){var i=TS.i18n.t("All of the users in that user group are already in this channel.","cmd_handlers")();TS.cmd_handlers.addEphemeralFeedback(i,{input_txt:n});return}if(r.is_private||r.is_group)TS.ui.invite.showInviteMembersPreSelected(r.id,e);else TS.api.call("conversations.invite",{channel:r.id,users:e})})};var p=function e(t){if(!_.isObject(t))throw new Error("Expected user to be an object");return TS.members.getPrefCompliantMemberName(t,false,true)};var h=function e(t){return TS.members.getMemberById(t)}})()},4808:function(e,t){(function(){TS.registerModule("stars",{member_stars_fetched_sig:new signals.Signal,member_stars_being_fetched_sig:new signals.Signal,channel_starred_sig:new signals.Signal,channel_unstarred_sig:new signals.Signal,has_more:false,fetched_once:false,onStart:function e(){TS.files.team_file_changed_sig.add(l);TS.files.team_file_deleted_sig.add(TS.stars.maybeUpdateUserStarredList);TS.files.team_file_comment_deleted_sig.add(TS.stars.maybeUpdateUserStarredList);TS.channels.message_changed_sig.add(s);TS.ims.message_changed_sig.add(s);TS.mpims.message_changed_sig.add(s);TS.groups.message_changed_sig.add(s);if(TS.client)TS.experiment.loadUserAssignments().then(function(){TS.stars.badge_star_menu=TS.experiment.getGroup("badge_star_menu");if("treatment"==TS.stars.badge_star_menu)TS.stars.fetchUserStarredItems()});r=$("#member_stars_more_btn")},getAllStars:function e(){return a},maybeUpdateUserStarredList:function e(t){if(!TS.client)return;if(!TS.model.team)return;if(n||!TS.stars.fetched_once){i=true;return}o(t)},maybeRemoveStarredListItem:function e(t){if(!TS.client)return;var r=_.findIndex(a,function(e){if(e.type!==t.type)return false;switch(e.type){case"message":return e.message.ts===t.message.ts;case"file":return e.file.id===t.file_id;case"file_comment":return e.comment.id===t.comment.id}return false});if(-1!==r)a.splice(r,1);d();if("stars"!==TS.model.ui_state.flex_name)return;var n;var i;if("file"===t.type){i=".star_item #file_"+t.file_id;n=$(i).parent(".star_item")}else if("message"===t.type){i='.star_item .message[data-ts="'+t.message.ts+'"]';n=$(i).parent(".star_item")}else if("file_comment"===t.type){i='.star_item .star_comment[data-comment-id="'+t.comment.id+'"]';n=$(i).parents(".star_item")}else return;n.remove()},fetchUserStarredItems:function e(){var t=c();if(!TS.stars.fetched_once)TS.stars.fetched_once=true;return TS.api.call("stars.list",t).then(function(e){var t=e.data,r=e.args,n=e.request_id;var i=true;if(u)u(i,t,r,n);return{data:t,args:r,request_id:n}}).catch(function(e){var t=e.data,r=e.args,n=e.request_id;var i=false;if(u)u(i,t,r,n);return{data:t,args:r,request_id:n}})},userStarStatusHasChanged:function e(t,r,n){m(r,n);if("message"===r.type){f(r.message.ts,r.channel,t,false);if(TS.useReactMessages())TS.redux.messages.replaceMessage(TS.utility.msgs.processImsg(r.message,r.channel))}else if("file"===r.type){if(r.file.is_starred!=t)h(r.file.id,t)}else if("file_comment"===r.type){if(r.comment.is_starred!=t)p(r.comment.id,r.file.id,t)}else if("channel"===r.type){var i=TS.channels.getChannelById(r.channel);if(!i)TS.warn("userStarStatusHasChanged channel_id:"+r.channel+" not found");else if(i.is_starred!=t)g(r.channel,t)}else if("group"===r.type){var a=TS.groups.getGroupById(r.channel);if(!a)a=TS.mpims.getMpimById(r.channel);if(!a)TS.warn("userStarStatusHasChanged group_id:"+r.channel+" not found");else if(a.is_starred!=t)if(a.is_mpim)v(r.channel,t);else S(r.channel,t)}else if("im"===r.type){var s=TS.ims.getImById(r.channel);if(!s)TS.warn("userStarStatusHasChanged im_id:"+r.channel+" not found");else if(s.is_starred!=t)T(r.channel,t)}else TS.error("userStarStatusHasChanged needs to handle star item type:"+r.type)},checkForStarClick:function e(t,r){if(!t.target)return false;var n=$(t.target);if(!_.isFunction(r))r=_.noop;var i;if(n.closest(".star").length)i=n.closest(".star");else i=n.closest(".star_link");var a=false;if(!i||!i.length)if(n.is("button.file_star"))i=n.children(".star");else if(n.closest(".starred_icon").length){a=true;i=n.closest(".starred_icon")}if(!i||!i.length)return false;if(i.hasClass("not-clickable"))return false;var s=i.hasClass("starred");var o={};var l;if(a){var u=TS.shared.getModelObById(i.data("c-id"));if(u){o.channel=u.id;s=u.is_starred;l=function e(t){if(u.is_channel)g(o.channel,t);else if(u.is_im)T(o.channel,t);else if(u.is_mpim)v(o.channel,t);else if(u.is_group)S(o.channel,t)}}}else if(i.hasClass("star_message")){o.channel=i.data("c-id");o.timestamp=i.data("msg-id");l=function e(t){f(o.timestamp,o.channel,t,true)}}else if(i.hasClass("star_file")){o.file=i.data("file-id");l=function e(t){h(o.file,t)}}else if(i.hasClass("star_file_comment")){o.file_comment=i.data("comment-id");l=function e(t){p(o.file_comment,i.data("file-id"),t)}}else if(i.hasClass("star_channel")){o.channel=i.data("channel-id");l=function e(t){g(o.channel,t)}}else if(i.hasClass("star_group")){o.channel=i.data("group-id");l=function e(t){S(o.channel,t)}}else if(i.hasClass("star_im")||i.hasClass("star_app")){o.channel=i.data("im-id");var d=false;if(TS.apps.isAppSpaceEnabled()&&i.hasClass("star_app"))d=true;l=function e(t){T(o.channel,t,d)}}else if(i.hasClass("star_mpim")){o.channel=i.data("mpim-id");l=function e(t){v(o.channel,t)}}else{TS.error("checkForStarClick doesn't know what to do with a click on "+i[0].outerHTML);return false}t.preventDefault();l(!s);r(!s);if(s){var c=function e(t,n){if(t)return;if("not_starred"===n.error){l(false);r(false)}else{l(true);r(true)}};TS.api.call("stars.remove",o).then(function(e){var t=e.data,r=e.args,n=e.request_id;var i=true;c(i,t,r,n);return{data:t,args:r,request_id:n}}).catch(function(e){var t=e.data,r=e.args,n=e.request_id;var i=false;c(i,t,r,n);return{data:t,args:r,request_id:n}})}else{var m=function e(t,n){if(t)return;if("already_starred"===n.error){l(true);r(true)}else{l(false);r(false)}};TS.api.call("stars.add",o).then(function(e){var t=e.data,r=e.args,n=e.request_id;var i=true;m(i,t,r,n);return{data:t,args:r,request_id:n}}).catch(function(e){var t=e.data,r=e.args,n=e.request_id;var i=false;m(i,t,r,n);return{data:t,args:r,request_id:n}})}return true},updateMsgStar:function e(t,r,n,i){f(t,r,n,i)},updateFileStar:function e(t,r){h(t,r)},updateFileCommentStar:function e(t,r,n){p(t,r,n)},toggleStarOnMsg:function e(t,r,n){if(!t||!r)return;var i=TS.utility.msgs.findMsg(t,r.id);if(!i)return;var a={channel:r.id,timestamp:t};var s=i.is_starred?"stars.remove":"stars.add";var o=function e(t,i){if(t){if(n)n(r)}else if(i.error)TS.error(i.error)};TS.api.call(s,a).then(function(e){var t=e.data,r=e.args,n=e.request_id;var i=true;o(i,t,r,n);return{data:t,args:r,request_id:n}}).catch(function(e){var t=e.data,r=e.args,n=e.request_id;var i=false;o(i,t,r,n);return{data:t,args:r,request_id:n}})},toggleStar:function e(t,r){var n=r?TS.shared.getModelObById(r):TS.shared.getActiveModelOb();if(!n||TS.client.activeChannelIsHidden())return;var i=n.is_starred;var a={};a.channel=n.id;if(!i){var s=function e(r,i){if(r){if(t)t(n)}else if(i.error)TS.error(i.error)};TS.api.call("stars.add",a).then(function(e){var t=e.data,r=e.args,n=e.request_id;var i=true;s(i,t,r,n);return{data:t,args:r,request_id:n}}).catch(function(e){var t=e.data,r=e.args,n=e.request_id;var i=false;s(i,t,r,n);return{data:t,args:r,request_id:n}})}else{var o=function e(r,i){if(r){if(t)t(n)}else if(i.error)TS.error(i.error)};TS.api.call("stars.remove",a).then(function(e){var t=e.data,r=e.args,n=e.request_id;var i=true;o(i,t,r,n);return{data:t,args:r,request_id:n}}).catch(function(e){var t=e.data,r=e.args,n=e.request_id;var i=false;o(i,t,r,n);return{data:t,args:r,request_id:n}})}},toggleStarForActiveModel:function e(t){if(TS.client.activeChannelIsHidden())return;var r={preventDefault:_.noop,target:$("#star_container button.star").get(0)};try{TS.stars.checkForStarClick(r,t)}catch(e){TS.stars.toggleStar(function(e){t(e.is_starred)})}}});var e=1;var t=20;var r;var n=false;var i=false;var a=[];var s=function e(t,r){if(true===r.is_starred)TS.stars.maybeUpdateUserStarredList()};var o=function e(r){n=true;i=false;TS.stars.member_stars_being_fetched_sig.dispatch(TS.model.user,true);var s=true;var o=c();o.page=1;o._update=true;o.count=Math.max(a.length,t);if(r&&r.delta)o.count+=r.delta;TS.api.call("stars.list",o,null,s).then(function(e){var t=e.data,r=e.args,n=e.request_id;var i=true;if(u)u(i,t,r,n);return{data:t,args:r,request_id:n}}).catch(function(e){var t=e.data,r=e.args,n=e.request_id;var i=false;if(u)u(i,t,r,n);return{data:t,args:r,request_id:n}})};var l=function e(t){if(t.hasOwnProperty("is_starred")){h(t.id,t.is_starred,t.id);TS.files.updateFileListItem(t,$(".star_item"))}};var u=function t(s,o,l){n=false;TS.stars.member_stars_being_fetched_sig.dispatch(TS.model.user,false);if(i){TS.stars.maybeUpdateUserStarredList();return}if(!s){TS.stars.member_stars_fetched_sig.dispatch({error:"api_not_ok"});return}for(var u=0;u<o.items.length;u+=1){var c=o.items[u];TS.stars.userStarStatusHasChanged(true,c,"stars.list")}if(1==l.page)a=o.items;else{a=a.concat(o.items);a=_.uniqWith(a,_.isEqual)}if(r.data("ladda"))r.data("ladda").stop();d();TS.stars.has_more=o.paging.pages>o.paging.page;if(!l._update)e+=1;TS.stars.member_stars_fetched_sig.dispatch(null,TS.model.user)};var d=function e(){if("treatment"!=TS.stars.badge_star_menu)return;var t=Date.now()/1e3-259200;var r=_.countBy(a,function(e){return e.date_create>t});var n=_.get(r,true,0);if(0===n)$("#star_badge").hide();else $("#star_badge").show().text(n>=20?"20+":n)};var c=function r(){var n={user:TS.model.user.id,exclude:"Ch,Gh,Dh",page:e,count:t};return n};var m=function e(t,r){var n;if("message"===t.type){t.message._rxn_key=TS.rxns.getRxnKey("message",t.message.ts,t.channel);if("channel_topic"===t.message.type||"channel_purpose"===t.message.type||"channel_join"===t.message.type||"channel_leave"===t.message.type)t.message.subtype=t.message.type;t.message.type="message"}else if("file"===t.type||"file_comment"===t.type)if(t.file){n=TS.files.upsertAndSignal(t.file);t.file=n.file;if("file_comment"===t.type)if(t.comment)t.comment=TS.files.addCommentToFile(t.comment,t.file);else{TS.error("WTF no comment in type "+t.type+" in "+r);return false}}else{TS.error("WTF no file in type "+t.type+" in "+r);return false}else if("channel"===t.type);else if("group"===t.type);else if("im"===t.type);else{TS.error("need to handle star item type:"+t.type+" in "+r);return false}return true};var f=function e(t,r,n,i){var a=TS.shared.getModelObById(r);var s;if(a)s=TS.utility.msgs.findMsg(t,r);var o='.star_message[data-msg-id="'+t+'"][data-c-id="'+r+'"]';var l=$(o);if(i){var u={};var d=n?"STAR_ADD_CLICKED":"STAR_REMOVE_CLICKED";if(TS.model.unread_view_is_showing){_.merge(u,TS.client.ui.unread.getTrackingData(t));TS.client.ui.unread.incrementTrackingSeqId()}_.merge(u,TS.ui.thread.getTrackingPayloadForEl(l));if("threads_view"===TS.ui.thread.getContextForEl(l))TS.client.ui.threads.incrementTrackingSeqId();TS.clog.track(d,u)}b(l,n,s,o)};var p=function e(t,r,n){var i=TS.files.getFileById(r);var a;if(!i)TS.warn("updateFileCommentStar file_id:"+r+" not found");else a=TS.files.getFileCommentById(i,t);var s='.star_comment[data-comment-id="'+t+'"]';b($(s),n,a,s)};var h=function e(t,r){var n=TS.files.getFileById(t);if(!n)TS.warn("updateFileStar file_id:"+t+" not found");var i='.star_file[data-file-id="'+t+'"]';b($(i),r,n,i)};var g=function e(t,r){var n=TS.channels.getChannelById(t);if(!n)TS.warn("updateChannelStar channel_id:"+t+" not found");n.is_starred=r;var i='.star_channel[data-channel-id="'+t+'"]';b($(i),r,n,i);if(TS.client){var a=TS.shared.getModelObById(t);if(!a)return;if(r)TS.stars.channel_starred_sig.dispatch(a);else TS.stars.channel_unstarred_sig.dispatch(a)}};var S=function e(t,r){var n=TS.groups.getGroupById(t);if(!n)TS.warn("updateGroupStar group_id:"+t+" not found");n.is_starred=r;var i='.star_group[data-group-id="'+t+'"]';b($(i),r,n,i)};var T=function e(t,r,n){var i=TS.ims.getImById(t);if(!i)TS.warn("updateImStar im_id:"+t+" not found");i.is_starred=r;var a="";if(n)a='.star_app[data-im-id="'+t+'"]';else a='.star_im[data-im-id="'+t+'"]';b($(a),r,i,a)};var v=function e(t,r){var n=TS.mpims.getMpimById(t);if(!n)TS.warn("updateMpimStar mpim_id:"+t+" not found");n.is_starred=r;var i='.star_mpim[data-mpim-id="'+t+'"]';b($(i),r,n,i)};var b=function e(t,r,n){if(r){if(!t.hasClass("starred"))t.addClass("starred ts_icon_star").removeClass("ts_icon_star_o")}else t.removeClass("starred ts_icon_star").addClass("ts_icon_star_o");if(n)n.is_starred=r}})()},4809:function(e,t){(function(){TS.registerModule("inline_attachments",{no_scrolling:false,expand_sig:new signals.Signal,collapse_sig:new signals.Signal,shouldExpand:function e(t,r){if(TS.model.expandable_state["attach_"+t+r.from_url])return true;if(false===TS.model.expandable_state["attach_"+t+r.from_url])return false;return true},shouldShow:function e(t,r){if(t.is_share)return true;if(r&&"reply_broadcast"===r.subtype)return true;if("twitter"===t.service_name&&"bot_message"===r.subtype)return true;if(!t.from_url)return true;if(r.standalone_attachment)return true;if(r&&r.text)if(-1==r.text.indexOf(t.from_url))if(TS.model.ampersands_are_inconsistent_in_from_urls){if(-1==r.text.indexOf(t.from_url.replace(/&/g,"&amp;")))return true}else return true;if(TS.prefs.getPref("expand_inline_imgs")){if(t.audio_html)return true;if(t.other_html)return true;if(t.video_html)return true;if(t.image_url)return true;if(t.service_name&&"twitter"===t.service_name.toString().toLowerCase())return true}return!!TS.prefs.getPref("expand_non_media_attachments")},expandAllInCurrent:function e(){TS.inline_attachments.no_scrolling=true;$(".msg_inline_attachment_expander").trigger("click");TS.inline_attachments.no_scrolling=false;if(TS.client)TS.client.ui.instaScrollMsgsToBottom(false)},collapseAllInCurrent:function e(){$(".msg_inline_attachment_collapser").trigger("click")},expand:function e(t,r){TS.model.expandable_state["attach_"+t+r]=true;TS.storage.storeExpandableState(TS.model.expandable_state);var n="#"+TS.utility.makeSafeForDomId(t);var i=$(n);if(!i.length)return;var a=TS.client&&TS.client.ui.areMsgsScrolledToBottom();var s=function e(){return $(this).data("real-src")==r};var o=i.find(".inline_attachment").filter(s);o.removeClass("hidden");i.find(".msg_inline_attachment_expander").filter(s).addClass("hidden");i.find(".msg_inline_attachment_collapser").filter(s).removeClass("hidden");o.css("opacity",0).stop().animate({opacity:1},300);if(!TS.inline_attachments.no_scrolling)if(TS.client&&a){TS.client.ui.instaScrollMsgsToBottom(false);i.children().first().scrollintoview({duration:0,offset:"top",px_offset:10,direction:"y"})}else o.scrollintoview({duration:200,offset:"bottom",px_offset:-10,direction:"y"});TS.inline_attachments.expand_sig.dispatch(t)},collapse:function e(t,r){TS.model.expandable_state["attach_"+t+r]=false;TS.storage.storeExpandableState(TS.model.expandable_state);var n="#"+TS.utility.makeSafeForDomId(t);var i=$(n);if(!i.length)return;var a=function e(){return $(this).data("real-src")==r};var s=i.find(".inline_attachment").filter(a);if(!s.length)s=i.find(".msg_inline_attachment_holder").filter(a);s.css("visibility","hidden");i.find(".msg_inline_attachment_expander").filter(a).removeClass("hidden");i.find(".msg_inline_attachment_collapser").filter(a).addClass("hidden");TS.inline_attachments.collapse_sig.dispatch(t);setTimeout(function(){s.addClass("hidden");s.css("visibility","visible")},200)},checkForInlineAttachmentClick:function e(t){if(!t.target)return;var r=$(t.target);var n;var i;var a=r.closest(".message");i=a.data("ts");n=a.attr("id");var s=r.closest(".msg_inline_attachment_expander");if(s.length){t.preventDefault();if(!n)return;TS.inline_attachments.expand(n,s.data("real-src"))}var o=r.closest(".msg_inline_attachment_collapser");if(o.length){t.preventDefault();if(!n)return;TS.inline_attachments.collapse(n,o.data("real-src"))}var l=r.closest(".rest_text_expander");if(l.length){t.preventDefault();var u=TS.client&&TS.client.ui.areMsgsScrolledToBottom();var d=l.parent().find(".short_text");var _;var c=l.parent().find(".more_text");if(l.data("show-text")){if(c.length){c.addClass("hidden");_=l.find("a span");l.data("hide-text",_.text());_.text(l.data("show-text"));l.data("show-text","");l.find("a .ts_icon").removeClass("ts_icon_caret_down").addClass("ts_icon_caret_right")}}else{var m=d.attr("data-all-text");if(m){d.html(m);d.data("all-text","")}if(c.length)c.removeClass("hidden");if(c.length&&l.data("hide-text")){_=l.find("a span");l.data("show-text",_.text());_.text(l.data("hide-text"));l.data("hide-text","");l.find("a .ts_icon").removeClass("ts_icon_caret_right").addClass("ts_icon_caret_down")}else l.css("display","none")}d.css("opacity",0).transition({opacity:1},300);TS.inline_attachments.rest_texts_expanded[l.attr("id")]=true;if(TS.client)TS.ui.utility.updateClosestMonkeyScroller(d);if(TS.client&&u){TS.client.ui.instaScrollMsgsToBottom(false);d.scrollintoview({duration:0,offset:"top",px_offset:10,direction:"y"})}}var f=r.closest(".delete_attachment_link");if(f.length){t.preventDefault();var p=f.data("attachment-id").toString();var h=a.attr("data-model-ob-id");TS.inline_attachments.promptForDeletingAttachment(h,i,p)}},promptForDeletingAttachment:function e(t,r,n){var i=TS.shared.getModelObById(t);if(!i){TS.console.warn("missing model_ob");return}if(!n){TS.console.warn("missing attachment-id");return}var a=i.id;var s=TS.utility.msgs.findMsg(r,t);if(!s){TS.error("Attachment removing failed: msg not found anywhere!");var o=TS.i18n.t("Attachment removing failed!","inline_attachments")();TS.generic_dialog.alert(o);return}var l="";if(TS.model.user.is_admin){var u=_.find(s.attachments,{id:n});if(u&&u.from_url){var d=TS.inline_attachments.makeBlackListSelect(u.from_url);var c=TS.i18n.t("Disable future attachments from this website?","inline_attachments")();l='<p class="large_left_margin '+(d&&"no_bottom_margin")+'">';l+='<label class="checkbox normal" style="font-size: 16px;">';l+='<input id="attachment_blacklist_cb" type="checkbox" class="small_right_margin" />';l+=c;l+="</label>";if(d)l+=d;l+="</p>"}}var m=TS.i18n.t("Are you sure you wish to remove this attachment from the message?","inline_attachments")();var f='<p class="'+(l?"small_bottom_margin":"")+'">'+m+"</p>"+l;TS.generic_dialog.start({title:TS.i18n.t("Remove attachment","inline_attachments")(),body:f,go_button_text:TS.i18n.t("Yes, remove","inline_attachments")(),onShow:function e(){$("#attachment_blacklist_cb").bind("change",function(){var e=!!$("#attachment_blacklist_cb").prop("checked");if(e)$("#attachment_blacklist_select").prop("disabled",false);else $("#attachment_blacklist_select").prop("disabled",true)})},onGo:function e(){if(s.is_ephemeral){s.attachments=TS.inline_attachments.removeAttachmentById(s.attachments,n);TS.utility.msgs.replaceMsg(i,s,false,true)}else{var t=!!$("#attachment_blacklist_cb").prop("checked");var o=t?$("#attachment_blacklist_select").val():"none";var l=t?$("#attachment_blacklist_select").find(":selected").data("url"):"";var u={channel:a,ts:r,attachment:n,blacklist_type:o,blacklist_url:l};TS.dir(0,u);var d=function e(t){if(t){if(TS.web){s.attachments=TS.inline_attachments.removeAttachmentById(s.attachments,n);TS.utility.msgs.replaceMsg(i,s)}}else{var r=TS.i18n.t("Attachment removing failed!","inline_attachments")();TS.generic_dialog.alert(r)}};TS.api.call("chat.deleteAttachment",u).then(function(e){var t=e.data,r=e.args,n=e.request_id;var i=true;d(i,t,r,n);return{data:t,args:r,request_id:n}}).catch(function(e){var t=e.data,r=e.args,n=e.request_id;var i=false;d(i,t,r,n);return{data:t,args:r,request_id:n}})}}})},makeBlackListSelect:function e(t){if(!t)return"";t=_.escape(t).replace("https://","").replace("http://","");var r="";var n=t.split("/");var i=n[0];var a=n[n.length-1];var s=TS.i18n.t("All links from {host}","inline_attachments")({host:i});var o=TS.i18n.t("Just the link {url}","inline_attachments")({url:t});r+='<label class="select small full_width">\r';r+='<select id="attachment_blacklist_select" disabled="disabled" class="small" style="margin-bottom: 4px;">\r';r+='<option value="all" data-url="'+i+'">'+s+"</option>\r";r+='<option value="just" data-url="'+t+'">'+o+"</option>\r";if(a!=i){TS.info(a);var l=n.concat();l.length-=1;var u=l.join("/");if(u!=i){u+="/";var d=TS.i18n.t("All links under {host_path}","inline_attachments")({host_path:u});r+='<option value="under" data-url="'+u+'">'+d+"</option>\r"}}r+="</select>\r";r+="</label>\r";return r},rest_texts_expanded:{},shouldExpandText:function e(t){return!!TS.inline_attachments.rest_texts_expanded[t]},renderStandaloneAttachment:function e(t){TS.inline_attachments.massageAttachment(t,0);if(t.image_url&&!TS.model.inline_imgs[t.from_url]){if(!t.from_url)t.from_url=t.image_url;TS.inline_imgs.makeInternalInlineImg(t.from_url,{link_url:t.from_url,bytes:t.image_bytes,src:t.image_url,width:isNaN(t.image_width)?null:t.image_width,height:isNaN(t.image_height)?null:t.image_height,should_expand:true})}if(t.video_html&&!TS.model.inline_videos[t.from_url])TS.inline_videos.makeInternalInlineVideo(t.from_url,{src:t.thumb_url,html:t.video_html,proxied_src:t.proxied_thumb_url,title:t.title,display_h:t.video_html_height,display_w:t.video_html_width,thumbnail:{link_url:t.from_url,url:t.thumb_url,height:t.thumb_height,width:t.thumb_width}});var r=TS.interop.datetime.makeTsStamp();var n=TS.templates.builders.buildAttachmentHTML({attachment:t,msg:{enable_slack_action_links:false,text:t.from_url,ts:r,url:t.from_url,standalone_attachment:t.standalone_attachment||false},can_delete:false,maybe_show_file_viewer:false,has_content:TS.utility.attachments.hasContent(t),from_post:true,model_ob:TS.shared.getModelObById(t.channel_id)});var i=TS.templates.makeMsgDomId(r);return'<div class="message standalone-attachment" id="'+i+'" data-ts="'+r+'">'+n+"</div>"},massageAttachment:function e(t,r){t._index=r;if("id"in t)t.id=t.id.toString();var n=500;var i=3;var a="";var s=0;if(t.text){var o="";var l="";var u="";var d;var _=0;var c=false;for(var m=0;m<t.text.length;m+=1){d=t.text.charAt(m);if(l||"<"===d){l+=d;if(u||"|"===d)u+=d;if(">"===d){a+=l;s+=u.length-2;if(s>n)c=true;l="";u=""}}else{if("\n"===d)_+=1;if(_>i+1){o=t.text.replace(a,"");break}a+=d;s+=1;if(s>n)c=true;if(c&&" "===d){o=t.text.replace(a,"");break}}}t._short_text=a.trim()==t.text.trim()?"":a;var f=a.match(/```/g);var p=o.match(/```/g);if(f&&p)t._short_text+="```"}t._floated_thumb_display_height=75;t._floated_thumb_display_width=75;if(t.thumb_height&&t.thumb_width)if(t.thumb_height>t.thumb_width)t._floated_thumb_display_width=parseInt(t.thumb_width*(t._floated_thumb_display_height/t.thumb_height),10);else t._floated_thumb_display_height=parseInt(t.thumb_height*(t._floated_thumb_display_width/t.thumb_width),10);var h=TS.utility.getImgProxyURL(t.thumb_url,t._floated_thumb_display_width,t._floated_thumb_display_height);if(h!=t.thumb_url)t.proxied_thumb_url=h;else delete t.proxied_thumb_url},getAttachmentByFromUrl:function e(t,r){if(!t)return null;for(var n=0;n<t.length;n+=1){if(!t[n]){TS.info(r);TS.dir(0,t);continue}if(!t[n].from_url)continue;if(t[n].from_url==r)return t[n];if(TS.model.ampersands_are_inconsistent_in_from_urls)if(t[n].from_url.replace(/&/g,"&amp;")==r)return t[n]}return null},getAttachmentBySlackFileId:function e(t,r){if(!t)return null;if(!r)return null;for(var n=0;n<t.length;n+=1){if(!t[n])continue;if(t[n].slack_file_id==r)return t[n]}return null},removeAttachmentById:function e(t,r){if(!t)return null;var n=[];for(var i=0;i<t.length;i+=1)if(t[i].id!=r)n.push(t[i]);return n}})})()},4810:function(e,t){(function(){TS.registerModule("inline_others",{no_scrolling:false,expand_sig:new signals.Signal,collapse_sig:new signals.Signal,onStart:function e(){},shouldExpand:function e(t,r){if(TS.model.expandable_state["vid_"+t+r.src])return true;if(false===TS.model.expandable_state["vid_"+t+r.src])return false;if(r.internal_file_id)return TS.prefs.getPref("expand_internal_inline_imgs");return TS.prefs.getPref("expand_inline_imgs")},expandAllInCurrent:function e(){var t=$(".msg_inline_media_toggler[data-media-type=other]:not(.expanded)");if(!t.length)return;TS.inline_others.no_scrolling=true;t.trigger("click");TS.inline_others.no_scrolling=false;if(TS.client)TS.client.ui.instaScrollMsgsToBottom(false)},collapseAllInCurrent:function e(){$(".msg_inline_media_toggler[data-media-type=other].expanded").trigger("click")},expand:function e(t,r){TS.model.expandable_state["vid_"+t+r]=true;TS.storage.storeExpandableState(TS.model.expandable_state);var n="#"+TS.utility.makeSafeForDomId(t);var i=$(n);if(!i.length)return;var a=TS.client&&TS.client.ui.areMsgsScrolledToBottom();var s=function e(){return $(this).data("real-src")==r};var o=TS.boot_data.feature_attachments_inline?i.find(".inline_attachment").filter(s):null;if(!o||!o.length)o=i.find(".msg_inline_other_holder").filter(s);o.removeClass("hidden");i.find(".msg_inline_media_toggler[data-media-type=other]:not(.expanded)").filter(s).addClass("expanded");if(TS.client)TS.client.ui.checkInlineImgsAndIframesEverywhere();o.css("opacity",0).stop().animate({opacity:1},300);if(!TS.inline_others.no_scrolling)if(TS.client&&a){TS.client.ui.instaScrollMsgsToBottom(false);i.children().first().scrollintoview({duration:0,offset:"top",px_offset:10,direction:"y"})}else i.find(".msg_inline_other").last().scrollintoview({duration:200,offset:"bottom",px_offset:-10,direction:"y"});TS.inline_others.expand_sig.dispatch(t);if(TS.client)TS.client.ui.checkInlineImgsAndIframesEverywhere()},collapse:function e(t,r){TS.model.expandable_state["vid_"+t+r]=false;TS.storage.storeExpandableState(TS.model.expandable_state);var n="#"+TS.utility.makeSafeForDomId(t);var i=$(n);if(!i.length)return;var a=function e(){return $(this).data("real-src")==r};var s=TS.boot_data.feature_attachments_inline?i.find(".inline_attachment").filter(a):null;if(!s||!s.length)s=i.find(".msg_inline_other_holder").filter(a);s.css("visibility","hidden");i.find(".msg_inline_media_toggler[data-media-type=other].expanded").filter(a).removeClass("expanded");s.find(".msg_inline_other_iframe_div").html("");TS.inline_others.collapse_sig.dispatch(t);setTimeout(function(){s.addClass("hidden");s.css("visibility","visible")},200)},checkForInlineOtherClick:function e(t){if(!t.target)return;var r=$(t.target);var n;var i=r.closest(".message");n=i.attr("id");if(!n)return;var a=r.closest(".msg_inline_media_toggler[data-media-type=other]");if(a.length){t.preventDefault();var s=a.data("real-src");if(a.hasClass("expanded"))TS.inline_others.collapse(n,s);else TS.inline_others.expand(n,s)}},makeInternalInlineOther:function t(r){var n=400;var i=500;if(r.other_html_width>n){r.other_html_height=parseInt(r.other_html_height*(n/r.other_html_width),10);r.other_html_width=n}if(r.other_html_height>i){r.other_html_width=parseInt(r.other_html_width*(i/r.other_html_height),10);r.other_html_height=i}var a;if(r.google_map_config)a=TS.utility.parseJSONOrElse(r.google_map_config,void 0);if(a&&a.center&&"string"!==typeof a.center.lat){a.scrollwheel=false;var s="googmap_"+(e+=1);r.other_html='<div class="google-maps" id="'+s+'" style="width:100%; min-width:'+_.escape(r.other_html_width)+"px; height:"+_.escape(r.other_html_height)+'px;"></div>\t\t\t<script>TS.inline_others.runGoogleMapCode("'+s+"\", '"+JSON.stringify(a)+"')<\/script>";r.safe_other_html=r.other_html}else{if(-1==r.other_html.indexOf("oldwidth")){r.other_html=r.other_html.replace(" width=",' width="'+r.other_html_width+'" oldwidth=');r.other_html=r.other_html.replace(" height=",' height="'+r.other_html_height+'" oldheight=')}r.safe_other_html=r.other_html;r.safe_other_html=TS.utility.swapInRedirUrlForIframe(r.safe_other_html);r.safe_audio_html=TS.utility.setCssFromHeightAndWidthAttrs(r.safe_audio_html)}TS.model.inline_others[r.other_html]={src:_.escape(r.other_html),attachment:r}},runGoogleMapCode:function e(t,r){if(!window.google)return;if(!r)return;var n=JSON.parse(r);var i=new google.maps.Map(document.getElementById(t),n);if(!n.query)return;var a=new google.maps.Geocoder;var s="number"===typeof n.max_results?n.max_results:10;if(s<0)s=Number.MAX_VALUE;var o=function e(){google.maps.event.clearListeners(i,"bounds_changed");var t=i.getBounds();var r=0;var o=function e(t){new google.maps.Marker({map:i,position:t.geometry.location});r+=1};var l=function e(a,l){var u=false;if(l==google.maps.GeocoderStatus.OK)a.slice(0,s).forEach(function(e){o(e);u=u||!e.partial_match});else TS.warn("Geocoder failed due to: "+l);if(!u&&r<s){var d=new google.maps.places.PlacesService(i);var _=function e(t,n){if(n==google.maps.places.PlacesServiceStatus.OK)t.slice(0,s-r).map(o);else TS.warn("PlacesService failed due to: "+n)};d.nearbySearch({bounds:t,name:n.query},_)}};a.geocode({address:n.query,bounds:t},l)};google.maps.event.addListener(i,"bounds_changed",o)}});var e=0})()},4811:function(e,t){var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)if(Object.prototype.hasOwnProperty.call(r,n))e[n]=r[n]}return e};(function(){TS.registerModule("msg_edit",{editing:false,editing_in_msg_pane:false,editing_in_convo_pane:false,deleting_from_editing:false,current_msg:null,current_model_ob:null,mousedown_active:false,edit_interv:0,onStart:function e(){},onCountDownInterval:function e(){if(!TS.msg_edit.current_msg)return;if(-1==TS.prefs.getTeamPref("msg_edit_window_mins")||_.get(TS.msg_edit.current_model_ob,"is_self_im")){$("#edit_countdown").empty();return}var t=TS.interop.datetime.toDateObject(TS.msg_edit.current_msg.ts).getTime()+60*TS.prefs.getTeamPref("msg_edit_window_mins")*1e3;var r=Math.floor((t-Date.now())/1e3);if(r<1)$("#edit_countdown").html(TS.i18n.t("(your time to edit ran out)","msg_edit")()+"&nbsp&nbsp&nbsp&nbsp");else if(r<61)$("#edit_countdown").html(TS.i18n.t("(you have <strong>{seconds_count, number}</strong> seconds)","msg_edit")({seconds_count:r})+"&nbsp&nbsp&nbsp&nbsp");else $("#edit_countdown").empty()},cancelEditingINothingHasChanged:function e(){if(!TS.msg_edit.editing)return true;var t=TS.format.unFormatMsg(TS.msg_edit.current_msg.text);var r=TS.utility.contenteditable.value($("#message_edit_form").find("#msg_text"));if(r===t){TS.msg_edit.onCancelEdit();return true}return false},editExpiration:function e(r){if(r>0){var n=t(r);if(TS.model.user.is_admin)return'<p class="no_bottom_margin">'+TS.i18n.t('In this workspace, you can’t edit a message after more than <strong>{msg_edit_duration_text}</strong>. Admins can adjust this in <a href="/admin/settings#message_editing" target="_new">Workspace&nbsp;Settings</a>.',"msg_edit")({msg_edit_duration_text:n})+"</p>";return'<p class="no_bottom_margin">'+TS.i18n.t("In this workspace, you can’t edit a message after more than <strong>{msg_edit_duration_text}</strong>. Admins can adjust this in Workspace&nbsp;Settings.","msg_edit")({msg_edit_duration_text:n})+"</p>"}if(TS.model.user.is_admin)return'<p class="no_bottom_margin">'+TS.i18n.t('In this workspace, you can’t edit messages after the fact. Admins can adjust this in <a href="/admin/settings#message_editing" target="_new">Workspace&nbsp;Settings</a>.',"msg_edit")()+"</p>";return'<p class="no_bottom_margin">'+TS.i18n.t("In this workspace, you can’t edit messages after the fact. Admins can adjust this in Workspace&nbsp;Settings.","msg_edit")()+"</p>"},startEdit:function t(r,n,i,a){if($("#message_edit_form").length&&!TS.msg_edit.cancelEditingINothingHasChanged()){TS.msg_edit.promptEdit();return}if(!r){TS.error("no msg_ts?");return null}if(!n){TS.error("no model_ob?");return null}if(!TS.useReactMessages()&&!n.msgs){TS.error("no model_ob.msgs?");return null}if(!a)a=TS.utility.msgs.getMsg(r,e(n));if(!a)a=TS.ui.replies.getActiveMessage(n,r);if(TS.model.threads_view_is_showing&&!a)a=TS.client.threads.getMessage(n,r);if(!a){TS.error("no msg in msgs?");return null}if(TS.useReactMessages()&&"convo"!==i&&!TS.client.activeChannelIsHidden()){TS.redux.dispatch(TS.interop.redux.features.messageEdit.maybeStartEditingMessage({channelId:a.channel,ts:r,scroll:true}));return}var s=TS.format.unFormatMsg(a.text);var o=i&&i.force_reopen;if(!o){var l=Date.now();var u=TS.interop.datetime.toDateObject(a.ts);var d=l-u;var c=d/6e4;if(TS.prefs.getTeamPref("msg_edit_window_mins")>=0&&c>TS.prefs.getTeamPref("msg_edit_window_mins")&&!n.is_self_im){TS.warn("Editing unavailable on channel "+n.id+", msg with ts = "+a.ts+". now = "+l+", elapsed (minutes) = "+c+", msg_edit_window_mins = "+TS.prefs.getTeamPref("msg_edit_window_mins"));var m=TS.prefs.getTeamPref("msg_edit_window_mins")>0?TS.i18n.t("This message can’t be edited","msg_edit")():TS.i18n.t("Messages can’t be edited","msg_edit")();TS.generic_dialog.alert(TS.msg_edit.editExpiration(TS.prefs.getTeamPref("msg_edit_window_mins")),m,TS.i18n.t("Got It","msg_edit")());return}}var f=TS.client&&TS.client.ui.areMsgsScrolledToBottom();var p;if("convo"===i){TS.msg_edit.editing_in_msg_pane=false;TS.msg_edit.editing_in_convo_pane=true;p=TS.msg_edit.getDivForMsgInConvoPane(a.ts)}else{TS.msg_edit.editing_in_msg_pane=true;TS.msg_edit.editing_in_convo_pane=false;p=TS.msg_edit.getDivForMsgInMsgPane(a.ts)}if(!p.length){TS.error("no msg div for edit");return null}TS.msg_edit.current_msg=a;TS.msg_edit.current_model_ob=n;p.addClass("hidden");var h=s;if(i&&i.text)h=i.text;var g=TS.templates.message_edit_form({msg:a,edit_text:h,permalink:TS.utility.msgs.constructMsgPermalink(n,a.ts,a.thread_ts),include_emo:!!TS.client,relative_ts:TS.utility.msgs.isMsgReply(a)});p.after(g);var S=$("#message_edit_form");var T=S;var v=S.find("#msg_text");TS.utility.contenteditable.create(v,{modules:{tabcomplete:{positionMenu:function e(t){t.style.width=v.outerWidth()+"px";TS.tabcomplete.positionUIRelativeToInput(t,v)},completers:["channels","emoji","members"]}},onEnter:function e(){TS.msg_edit.checkAndSubmit(v,S);return false},onEscape:function e(){if(!TS.model.menu_is_showing&&!TS.model.dialog_is_showing)setTimeout(TS.msg_edit.onCancelEdit,0)},onTextChange:function e(){TS.msg_edit.checkLengthAndUpdateMessage(v)}});TS.utility.contenteditable.enable(v);v.on("keyup",function(){var e=TS.utility.contenteditable.cursorPosition(v);if(!e.length){var t=TS.client&&TS.client.ui.getCachedDimensionsRect("cached_msgs_scroller_rect",TS.client.ui.$msgs_scroller_div);if(!TS.client||S.outerHeight()<t.height)T.find(".edit_controls").scrollintoview({px_offset:-50})}});TS.utility.contenteditable.value(v,h);TS.msg_edit.checkLengthAndUpdateMessage(v);TS.info("message_edit_form added");TS.msg_edit.editing=true;S.bind("destroyed",function(){TS.utility.contenteditable.unload($("#message_edit_form #msg_text"));TS.info("message_edit_form removed");TS.msg_edit.editing=false;TS.msg_edit.editing_in_msg_pane=false;TS.msg_edit.editing_in_convo_pane=false;S=null;v=null;TS.msg_edit.resetEditUI()});S.bind("submit",function(e){e.preventDefault();var t=TS.utility.contenteditable.value(v);t=TS.utility.contenteditable.synchronouslyReplacePotentialMentions(t);if(t===s){TS.msg_edit.onCancelEdit();return}if(!t){var i=TS.utility.msgs.getMsgActions(a,n);var o=p.attr("id")===TS.templates.makeMsgDomIdInConversation(r)||p.attr("id")===TS.templates.makeMsgDomIdInThreadsView(r);if(i.remove_broadcast&&!o)TS.msg_edit.startRemoveBroadcast(TS.msg_edit.current_msg.ts,TS.msg_edit.current_model_ob,true);else if(i.delete_msg)TS.msg_edit.startDelete(TS.msg_edit.current_msg.ts,TS.msg_edit.current_model_ob,TS.msg_edit.onCancelEdit,true);else TS.msg_edit.onConfirmEdit("~"+a.text.replace(/~/g,"")+"~");return}var l=TS.ui.needToBlockAtChannelKeyword(t,null,TS.msg_edit.current_model_ob.id);if(l){TS.generic_dialog.alert("<p>"+TS.i18n.t("A Workspace Owner has restricted the use of <strong>{blocked_keyword}</strong> messages.","msg_edit")({blocked_keyword:_.escape(l)})+"</p>");return}if(!$.trim(t))return;TS.msg_edit.onConfirmEdit(t)});S.find("#commit_edit").bind("click",function(){TS.msg_edit.checkAndSubmit(v,S)});S.find("#cancel_edit").bind("click",function(){TS.msg_edit.onCancelEdit()});S.bind("mousedown",function(){TS.msg_edit.mousedown_active=true});S.bind("mouseup",function(){TS.msg_edit.mousedown_active=false});var b=S.find(".emo_menu");b.removeClass("hidden");b.bind("click.open_dialog",function(e){TS.ui.react_emoji_menu.start({e:e,input_to_fill:"#msg_text"})});if(TS.client&&f)TS.client.ui.instaScrollMsgsToBottom(false);var y=TS.client&&TS.client.ui.getCachedDimensionsRect("cached_msgs_scroller_rect",TS.client.ui.$msgs_scroller_div);if(!TS.client||S.outerHeight()<y.height)T.find(".edit_controls").scrollintoview({duration:500,px_offset:-50,complete:function e(){TS.msg_edit.focusAndSetCursorPosition(v,i)}});else{TS.msg_edit.focusAndSetCursorPosition(v,i);T.find(".edit_controls").scrollintoview({duration:500,px_offset:-50})}TS.msg_edit.onCountDownInterval();TS.msg_edit.edit_interv=setInterval(TS.msg_edit.onCountDownInterval,1e3)},isMessageTooLong:function e(t){var r=TS.format.cleanMsg(TS.utility.contenteditable.value(t));if(TS.boot_data.feature_message_input_byte_limit)return TS.utility.msgs.charsOverLimit(r);return r.length>TS.interop.constants.MAX_MESSAGE_INPUT_LENGTH},updateTooLongWarning:function e(t,r){var n=$(t).parent().find(".edit_warning");if(r){n.removeClass("hidden");if(TS.boot_data.feature_message_input_byte_limit)n.text(TS.i18n.t("Your message is {diff_count, plural, =1{# character}other{# characters}} too long.","msg_input")({diff_count:r}))}else $(t).parent().find(".edit_warning").addClass("hidden")},checkLengthAndUpdateMessage:function e(t){var r=TS.msg_edit.isMessageTooLong(t);TS.msg_edit.updateTooLongWarning(t,r);return!r},checkAndSubmit:function e(t,r){if(TS.msg_edit.checkLengthAndUpdateMessage(t))r.submit()},onConfirmEdit:function e(t){if(!TS.msg_edit.current_msg){TS.error("no TS.msg_edit.current_msg?");return null}if(!t){TS.error("no edited_text?");return null}var r=TS.msg_edit.editing_in_convo_pane;TS.msg_edit.commitEditInternal(t);TS.msg_edit.resetEditUI();if(TS.client)if(r){var n=true;TS.ui.replies.focusReplyInput(n)}else TS.view.focusMessageInput()},onCancelEdit:function e(){if(!TS.msg_edit.current_msg){TS.error("no TS.msg_edit.current_msg?");return null}var t=TS.msg_edit.editing_in_convo_pane;TS.msg_edit.resetEditUI();if(TS.client)if(t){var r=true;TS.ui.replies.focusReplyInput(r)}else TS.view.focusMessageInput()},resetEditUI:function e(){clearInterval(TS.msg_edit.edit_interv);if(!TS.msg_edit.current_msg){TS.error("no TS.msg_edit.current_msg?");return null}TS.msg_edit.getDivBeingEdited().removeClass("hidden");$("#message_edit_container").remove()},getDivBeingEdited:function e(){if(TS.msg_edit.editing_in_msg_pane)return TS.msg_edit.getDivForMsgInMsgPane(TS.msg_edit.current_msg.ts);if(TS.msg_edit.editing_in_convo_pane)return TS.msg_edit.getDivForMsgInConvoPane(TS.msg_edit.current_msg.ts);return $()},getDivForMsgInMsgPane:function e(t){var r=TS.model.unread_view_is_showing;var n=TS.model.threads_view_is_showing;if(r)return $("#"+TS.templates.makeMsgDomIdInUnreadView(t));else if(n)return $("#"+TS.templates.makeMsgDomIdInThreadsView(t));return $("#"+TS.templates.makeMsgDomId(t))},getDivForMsgInConvoPane:function e(t){return $("#"+TS.templates.makeMsgDomIdInConversation(t))},getAllDivsForMsg:function e(t){var r=TS.msg_edit.getDivForMsgInMsgPane(t);return r.add(TS.msg_edit.getDivForMsgInConvoPane(t))},commitEditInternal:function e(t){TS.msg_edit.commitEdit(TS.msg_edit.current_msg,TS.msg_edit.current_model_ob,t)},commitEdit:function e(r,n,i,a,s){if(!r){TS.error("no msg?");return null}if(!n){TS.error("no model_ob?");return null}if(!a)a=0;if(!s)s=100;var o=function e(a,s,o){if(a){if(TS.web||n.is_channel&&!n.is_member){var l=_.extend({},r,{text:s.text,edited:{ts:TS.interop.datetime.makeTsStamp(null,{padder:"0"})}});TS.utility.msgs.replaceMsg(n,l)}}else{if(!s||!s.error)TS.generic_dialog.alert(TS.i18n.t("Sorry, something went wrong with editing your message. Try again in a moment.","msg_edit")(),TS.i18n.t("Message editing failed","msg_edit")());else if("message_not_found"===s.error){if(o._attempts<10){o._delay_ms*=1.75;setTimeout(function(){TS.msg_edit.commitEdit(r,n,i,o._attempts,o._delay_ms)},o._delay_ms);return}if(n.is_channel)TS.channels.removeMsg(n.id,r);else if(n.is_im)TS.ims.removeMsg(n.id,r);else if(n.is_mpim)TS.mpims.removeMsg(n.id,r);else if(n.is_group)TS.groups.removeMsg(n.id,r);TS.generic_dialog.alert(TS.i18n.t("Sorry, something went wrong with editing your message. Try again in a moment.","msg_edit")(),TS.i18n.t("Message editing failed","msg_edit")())}else if("edit_window_closed"===s.error){var u="<p>"+TS.i18n.t("Sorry, but messages can only be edited for <strong>{msg_edit_duration_text}</strong> after posting.","msg_edit")({msg_edit_duration_text:t(TS.prefs.getTeamPref("msg_edit_window_mins"))})+"</p>";if(TS.model.user.is_admin)u+="<p>"+TS.i18n.t('(To adjust the message editing window, visit <a href="/admin/settings#message_editing" target="_new">Workspace&nbsp;Settings</a>.)',"msg_edit")()+"</p>";TS.generic_dialog.alert(u,TS.i18n.t("Message editing failed","msg_edit")())}else if("msg_too_long"===s.error)TS.generic_dialog.alert(TS.i18n.t("Sorry, your message is too long. Please shorten it and try again.","msg_edit")(),TS.i18n.t("Message editing failed","msg_edit")());else TS.generic_dialog.alert(TS.i18n.t("Sorry, something went wrong with editing your message. Try again in a moment.","msg_edit")(),TS.i18n.t("Message editing failed","msg_edit")());TS.msg_edit.startEdit(r.ts,n,{text:i,force_reopen:true})}};TS.api.call("chat.update",{channel:n.id,ts:r.ts,text:TS.format.cleanMsg(i),_attempts:a,_delay_ms:s}).then(function(e){var t=e.data,r=e.args,n=e.request_id;var i=true;o(i,t,r,n);return{data:t,args:r,request_id:n}}).catch(function(e){var t=e.data,r=e.args,n=e.request_id;var i=false;o(i,t,r,n);return{data:t,args:r,request_id:n}})},promptEdit:function e(){if("none"!==$("#message_editing_info").css("display")){$("#message_edit_container").scrollintoview({duration:300,px_offset:0});return}$("#message_editing_info").css("display","");$("#message_editing_info").css("opacity",0);$("#message_edit_container").scrollintoview({duration:300,px_offset:0,complete:function e(){$("#message_editing_info").transition({opacity:1},250)}})},startDelete:function t(n,i,a,s){if(!n){TS.error("no msg_ts?");return null}if(_.isString(i))i=TS.shared.getModelObById(i);if(!i){TS.error("no model_ob?");return null}if(!TS.useReactMessages()&&!i.msgs){TS.error("no model_ob.msgs?");return null}var o;if(TS.useReactMessages()){o=TS.redux.messages.getMessageByTimestamp(i.id,n);if(o&&o.file)o=r({},o,{file:TS.redux.files.getFileById(o.file)})}if(!o)o=TS.utility.msgs.getMsg(n,e(i));if(!o)o=TS.ui.replies.getActiveMessage(i,n);if(TS.model.threads_view_is_showing&&!o)o=TS.client.threads.getMessage(i,n);if(!o){TS.error("no msg in msgs?");return null}TS.msg_edit.deleting_from_editing=!!s;TS.msg_edit.current_msg=o;TS.msg_edit.current_model_ob=i;var l=TS.msg_edit.getAllDivsForMsg(o.ts);var u='<p class="bottom_margin">'+TS.i18n.t("Are you sure you want to delete this message? This cannot be undone.","msg_edit")()+"</p>";if(o.subtype){var d;if(o.file){d="file";if("snippet"===o.file.mode)d="snippet";else if("post"===o.file.mode)d="post"}var c="";if("file_upload"===o.subtype){if("file"===d)c=TS.i18n.t("Note that deleting this message will not delete the file that was uploaded.","msg_edit")();else if("snippet"===d)c=TS.i18n.t("Note that deleting this message will not delete the snippet that was uploaded.","msg_edit")();else if("post"===d)c=TS.i18n.t("Note that deleting this message will not delete the post that was uploaded.","msg_edit")()}else if("file_share"===o.subtype){if("file"===d)c=TS.i18n.t("Note that deleting this message will not unshare the file.","msg_edit")();else if("snippet"===d)c=TS.i18n.t("Note that deleting this message will not unshare the snippet.","msg_edit")();else if("post"===d)c=TS.i18n.t("Note that deleting this message will not unshare the post.","msg_edit")()}else if("file_comment"===o.subtype)c=TS.i18n.t("Note that deleting this message will not delete the comment.","msg_edit")();if(c)u+="<p>"+c+"</p>"}l.addClass("delete_mode");TS.generic_dialog.start({title:TS.i18n.t("Delete message","msg_edit")(),body:u+TS.templates.builders.msgs.buildHTML({msg:o,model_ob:i,standalone:true}),go_button_text:TS.i18n.t("Delete","msg_edit")(),go_button_class:"btn_danger",onGo:function e(){if(TS.msg_edit.deleting_from_editing)TS.msg_edit.onCancelEdit();TS.msg_edit.commitDeleteInternal(a)},onCancel:function e(){TS.msg_edit.onCancelDelete()}});TS.generic_dialog.div.find("img.msg_inline_img.hidden").each(function(e,t){var r=$(t);r.prop("src",r.data("real-src"));r.removeClass("hidden")})},onCancelDelete:function e(){if(!TS.msg_edit.current_msg){TS.error("no TS.msg_edit.current_msg?");return null}var t=TS.msg_edit.getAllDivsForMsg(TS.msg_edit.current_msg.ts);t.removeClass("delete_mode");if(TS.msg_edit.deleting_from_editing)TS.utility.contenteditable.focus($("#msg_text"))},commitDeleteInternal:function e(t){TS.msg_edit.commitDelete(TS.msg_edit.current_msg,TS.msg_edit.current_model_ob,TS.msg_edit.onCancelDelete,t)},commitDelete:function t(r,n,i,a,s,o,l){if(!r){TS.error("no msg?");return null}if(!n){TS.error("no model_ob?");return null}var u=n.id;if(!o)o=0;if(!l)l=100;if(r.is_ephemeral||TS.utility.msgs.isTempMsg(r)){if(n.is_channel)TS.channels.removeMsg(n.id,r);else if(n.is_im)TS.ims.removeMsg(n.id,r);else if(n.is_mpim)TS.mpims.removeMsg(n.id,r);else if(n.is_group)TS.groups.removeMsg(n.id,r)}else{if(r._jl_rollup_hash&&r._jl_rollup_hash.msg_ids){var d=r._jl_rollup_hash.msg_ids;d.forEach(function(t){if(t==r.ts)return;var d=function t(o,l,u){if(o||"message_not_found"===l.error){if("message_not_found"===l.error)if(u._attempts<10){u._delay_ms*=1.75;setTimeout(function(){TS.msg_edit.commitDelete(r,n,i,a,s,u._attempts,u._delay_ms)},u._delay_ms);return}if(TS.web||n.is_channel&&!n.is_member)if(n.is_channel)TS.channels.removeMsg(n.id,TS.utility.msgs.getMsg(u.ts,e(n)));else if(n.is_im)TS.ims.removeMsg(n.id,TS.utility.msgs.getMsg(u.ts,e(n)));else if(n.is_mpim)TS.mpims.removeMsg(n.id,TS.utility.msgs.getMsg(u.ts,e(n)));else if(n.is_group)TS.groups.removeMsg(n.id,TS.utility.msgs.getMsg(u.ts,e(n)))}};TS.api.call("chat.delete",{channel:u,ts:t,_attempts:o,_delay_ms:l}).then(function(e){var t=e.data,r=e.args,n=e.request_id;var i=true;d(i,t,r,n);return{data:t,args:r,request_id:n}}).catch(function(e){var t=e.data,r=e.args,n=e.request_id;var i=false;d(i,t,r,n);return{data:t,args:r,request_id:n}})})}var _=function e(t,o,l){if(t||"message_not_found"===o.error){if("message_not_found"===o.error)if(l._attempts<10){l._delay_ms*=1.75;setTimeout(function(){TS.msg_edit.commitDelete(r,n,i,a,s,l._attempts,l._delay_ms)},l._delay_ms);return}if(TS.web||n.is_channel&&!n.is_member)if(n.is_channel)TS.channels.removeMsg(n.id,r);else if(n.is_im)TS.ims.removeMsg(n.id,r);else if(n.is_mpim)TS.mpims.removeMsg(n.id,r);else if(n.is_group)TS.groups.removeMsg(n.id,r);if(a)a()}else{if(i)i();if(!s){var u;if(o&&o.error)u=TS.i18n.t("The message was not deleted. The error was: {error}","msg_edit")({error:o.error});else u=TS.i18n.t("The message was not deleted. The error was: unknown","msg_edit")();TS.generic_dialog.start({title:TS.i18n.t("Delete Message Failed","msg_edit")(),body:u,show_cancel_button:false,esc_for_ok:true})}}if(TS.web){var d=!TS.utility.msgs.getDisplayedMsgs(n.msgs).length;if(d){var _=$(".pager .previous a");if(_.attr("href"))window.location=_.attr("href");else TS.reload(false,"TS.msg_edit.commitEdit")}}};TS.api.call("chat.delete",{channel:u,ts:r.ts,_attempts:o,_delay_ms:l}).then(function(e){var t=e.data,r=e.args,n=e.request_id;var i=true;_(i,t,r,n);return{data:t,args:r,request_id:n}}).catch(function(e){var t=e.data,r=e.args,n=e.request_id;var i=false;_(i,t,r,n);return{data:t,args:r,request_id:n}})}},$last_clicked_cb:null,startBatchDelete:function e(){$("#msgs_div").addClass("selecting_messages");$("#channel_actions_div").addClass("hidden");$("#batch_delete_div").removeClass("hidden");TS.msg_edit.batchDeleteSelectionChanged()},cancelBatchDelete:function e(){TS.msg_edit.selectNoneBatchDelete();$("#msgs_div").removeClass("selecting_messages");$("#channel_actions_div").removeClass("hidden");$("#batch_delete_div").addClass("hidden")},doBatchDelete:function t(){var r=$("#msgs_div").find(".msg_select_cb:checked");var n=TS.shared.getActiveModelOb();if(r.length){var i=r.length;if(1==i){TS.msg_edit.startDelete(r.eq(0).closest(".message").data("ts"),n,TS.msg_edit.cancelBatchDelete);return}var a='<p class="small_bottom_margin">'+TS.i18n.t("Are you sure you want to delete {count, plural, =1 {this message} other {these messages}}? This cannot be undone! Note that deleting these messages will not delete any files or file comments.","msg_edit")({count:i})+"</p>";var s;var o;for(var l=0;l<i;l+=1){if(o&&!o.no_display)s=o;var u=r.eq(l).closest(".message").data("ts");o=TS.utility.msgs.getMsg(u,e(n));if(!o)continue;a+=TS.templates.builders.msgs.buildHTML({msg:o,prev_msg:s,model_ob:n,standalone:true})}var d=function e(t){function r(e){TS.msg_edit.commitDelete(e,n,i,i,true)}function i(){if(t.length)setTimeout(function(){r(t.pop())},100);else{TS.generic_dialog.cancel();TS.generic_dialog.start({title:"",body:TS.i18n.t("Messages deleted.","msg_edit")(),show_cancel_button:false,esc_for_ok:true})}}TS.generic_dialog.start({title:"",body:"<p>"+TS.i18n.t("Deleting messages...","msg_edit")()+"</p>",show_cancel_button:false,show_go_button:false});i()};TS.generic_dialog.start({title:TS.i18n.t("Delete Messages","msg_edit")(),body:a,go_button_text:TS.i18n.t("Yes, delete these messages","msg_edit")(),go_button_class:"btn_danger",onGo:function t(){var a=[];for(var s=0;s<i;s+=1){var o=r.eq(s).closest(".message").data("ts");if(!o){alert("no msg_ts");return}var l=TS.utility.msgs.getMsg(o,e(n));if(!l){alert("no msg");return}a.push(l)}TS.msg_edit.cancelBatchDelete();d(a)}})}},batchDeleteSelectionChanged:function e(t,r){var n=TS.msg_edit.$last_clicked_cb;if(n&&t&&r){var i=$("#msgs_div").find(".msg_select_cb:visible");var a=i.index(n);var s=i.index(t);if(a>s){s=a;a=i.index(t)}var o="checked"===n.prop("checked");for(var l=a;l<=s;l+=1)i.eq(l).prop("checked",o)}n=t;TS.msg_edit.$last_clicked_cb=n;var u=TS.i18n.t("0 messages","msg_edit")();var d=$("#msgs_div").find(".msg_select_cb:checked");$("#msgs_div").find(".multi_delete_mode").removeClass("multi_delete_mode");if(d.length){u=TS.i18n.t("{count, plural, =1 {# message} other {# messages}}","msg_edit")({count:d.length});$("#batch_delete_button").removeClass("disabled");d.each(function(){$(this).closest(".message").addClass("multi_delete_mode")})}else $("#batch_delete_button").addClass("disabled");$("#batch_delete_count_span").html(u)},selectAllBatchDelete:function e(){$("#msgs_div").find(".msg_select_cb:visible").prop("checked",true);TS.msg_edit.batchDeleteSelectionChanged()},selectNoneBatchDelete:function e(){$("#msgs_div").find(".msg_select_cb:visible").prop("checked",false);TS.msg_edit.batchDeleteSelectionChanged()},startRemoveBroadcast:function e(t,r,n){var i=TS.utility.msgs.findMsg(t,r.id);if(!i){TS.error("Cannot find "+t+" for startRemoveBroadcast");return}TS.msg_edit.deleting_from_editing=!!n;TS.msg_edit.current_msg=i;TS.msg_edit.current_model_ob=r;var a=TS.msg_edit.getDivForMsgInMsgPane(t);var s=r.is_channel||r.is_group&&!r.is_mpim;var o=TS.templates.builders.msgs.buildHTML({msg:i,model_ob:r,standalone:true});var l=TS.templates.thread_confirm_remove_broadcast({is_channel_or_group:s,msg_html:new Handlebars.SafeString(o)});a.addClass("delete_mode");var u;if(s)u=TS.i18n.t("Remove from channel","msg_edit")();else u=TS.i18n.t("Remove from conversation","msg_edit")();TS.generic_dialog.start({title:u,body:l,go_button_text:TS.i18n.t("Remove message","msg_edit")(),onGo:function e(){if(TS.msg_edit.deleting_from_editing)TS.msg_edit.onCancelEdit();TS.api.call("chat.delete",{channel:r.id,ts:i.ts,broadcast_delete:true}).then(function(){if(TS.web)if(r.is_channel)TS.channels.removeMsg(r.id,i);else if(r.is_im)TS.ims.removeMsg(r.id,i);else if(r.is_mpim)TS.mpims.removeMsg(r.id,i);else if(r.is_group)TS.groups.removeMsg(r.id,i)}).catch(function(e){TS.error("Failed to remove broadcast "+i.ts);TS.error(e);if(TS.msg_edit.current_msg===i)TS.msg_edit.onCancelDelete()})},onCancel:function e(){TS.msg_edit.onCancelDelete()}})},pauseEditing:function e(){if(!TS.msg_edit.editing)return;var t=$("#msg_text");var r=TS.utility.contenteditable.value(t);var n=TS.utility.contenteditable.cursorPosition(t);var i={msg_ts:TS.msg_edit.current_msg.ts,model_ob:TS.msg_edit.current_model_ob,text:r,cursor_start:n.start,cursor_length:n.length};TS.msg_edit.resetEditUI();return i},resumeEditing:function e(t){if(TS.msg_edit.editing)return;if(!t)return;if(TS.model.active_cid!==t.model_ob.id)return;TS.msg_edit.startEdit(t.msg_ts,t.model_ob,t)},focusAndSetCursorPosition:function e(t,r){TS.utility.contenteditable.focus(t);TS.utility.rAF(function(){if(r&&_.isFinite(r.cursor_start)&&_.isFinite(r.cursor_length))TS.utility.contenteditable.cursorPosition(t,r.cursor_start,r.cursor_length);else TS.utility.contenteditable.cursorPosition(t,1e8,0)})}});var e=function e(t){return TS.model.archive_view_is_showing&&t._archive_msgs?t._archive_msgs:t.msgs};var t=function e(t){return TS.interop.datetime.toTimeDuration(t,{units:"minutes"})}})()},4812:function(e,t){(function(){TS.registerModule("ui.fs_modal",{is_showing:false,transition_duration:250,start:function s(l){if(TS.ui.fs_modal.is_showing){b(l);return}c=_.defaults({},l,m);TS.ui.fs_modal.is_showing=true;TS.tips.hideAll();f();if(c.modal_class)e.addClass(c.modal_class);if(c.modal_bg_class)t.addClass(c.modal_bg_class);if(c.modal_contents_container_class)e.find(".contents_container").addClass(c.modal_contents_container_class);n=e.find(".contents");i=e.find("#fs_modal_sidebar");a=e.find("#fs_modal_header");o=e.find("#fs_modal_footer_content");var u;if(c.body_template_html){u=c.body_template_html;if(c.body)TS.warn("Both body and body_template_html were passed in settings to TS.ui.fs_modal.start(). Using body_template.")}else u=TS.templates.fs_modal_generic_contents({settings:c,fs_modal_header:_.includes(c.modal_class,"fs_modal_header"),fs_modal_footer:_.includes(c.modal_class,"fs_modal_footer")});n.html(u);if(c.header_html)a.replaceWith(c.header_html);if(c.footer_html)o.html(c.footer_html);if(c.sidebar_html)i.html(c.sidebar_html);if(c.modal_gallery)w();e.on("click",".dialog_go",p);e.on("click",".dialog_secondary_go",h);e.on("click",".dialog_cancel",S);$(window.document).off(".fs_modal");$(window.document).on("keydown.fs_modal",g);r.on("click",function(){if(c.esc_for_ok)p();else S()});$("html").addClass("fs_modal_active");setTimeout(function(){if(t)t.addClass("active");if(e)e.addClass("active")},0);if(e.find("input").length)e.find("input").first().focus();else if(document.activeElement&&document.activeElement!==document.body)document.activeElement.blur();if(c.onShow)c.onShow();if(c.onShowComplete||TS.model.is_our_app&&TSSSB.nodrag.getIsRequired()){var d=false;var T=y();var v=setTimeout(function(){d=true;k();if(c.onShowComplete)c.onShowComplete();e.off(T+".fs_modal_show_complete")},600);e.one(T+".fs_modal_show_complete",function(){if(!d){k();clearTimeout(v);if(c.onShowComplete)c.onShowComplete()}})}},close:function e(t){S(t)},bindBackButton:function e(t){$("#fs_modal_back_btn").off("click.fs_modal").on("click.fs_modal",t)},unbindBackButton:function e(){$("#fs_modal_back_btn").off("click.fs_modal")},showBackButton:function e(){$("#fs_modal_back_btn").removeClass("hidden")},hideBackButton:function e(){$("#fs_modal_back_btn").addClass("hidden")},activate:function r(){e.addClass("active");t.addClass("active")},deactivate:function r(){e.removeClass("active");t.removeClass("active")},setHeaderTitle:function t(r){if(!a.length)return;var n=TS.templates.fs_modal_header({title:r});a.replaceWith(n);a=e.find("#fs_modal_header")},showFooter:function t(){if(!s.length)return;e.addClass("fs_modal_footer");s.removeClass("hidden")},hideFooter:function t(){if(!s.length)return;e.removeClass("fs_modal_footer");s.addClass("hidden")},isShowing:function e(){return TS.ui.fs_modal.is_showing}});var e;var t;var r;var n;var i;var a;var s;var o;var l=0;var u=false;var d;var c=null;var m={title:"",body:"",body_template_html:null,show_go_button:true,show_secondary_go_button:false,show_cancel_button:true,go_button_text:TS.i18n.t("OK","fs_modal")(),go_button_class:"",secondary_go_button_text:TS.i18n.t("OK 2","fs_modal")(),secondary_go_button_class:"",cancel_button_text:TS.i18n.t("Cancel","fs_modal")(),disable_default_controls:false,disable_esc:false,onGo:null,onSecondaryGo:null,onCancel:null,onEnd:null,esc_for_ok:false,onShow:null,enter_always_gos:false,fullscreen:false,modal_class:null,modal_bg_class:null,modal_contents_container_class:null,modal_gallery:null,sidebar_html:null,header_html:null,footer_html:null};var f=function l(){t=null;e=null;a=null;s=null;o=null;r=null;n=null;i=null;var u={settings:c,fs_modal_header:_.includes(c.modal_class,"fs_modal_header"),fs_modal_footer:_.includes(c.modal_class,"fs_modal_footer"),fs_modal_sidebar:_.includes(c.modal_class,"fs_modal_sidebar"),disable_default_controls:c.disable_default_controls};var d=TS.templates.fs_modal(u);$("body").append(d);t=$("#fs_modal_bg");e=$("#fs_modal");a=$("#fs_modal_header");s=$("#fs_modal_footer");r=$("#fs_modal_close_btn")};var p=function e(){if(!TS.ui.fs_modal.is_showing){TS.error("not showing?");return}if(c.onGo){if(false!==c.onGo())S()}else S()};var h=function e(){if(!TS.ui.fs_modal.is_showing){TS.error("not showing?");return}if(c.onSecondaryGo){if(false!==c.onSecondaryGo())S()}else S()};var g=function e(t){if(t.which==TS.utility.keymap.enter&&("BODY"===TS.utility.getActiveElementProp("NODENAME")||c.enter_always_gos)){if(c.show_go_button){p();t.preventDefault()}}else if(t.which==TS.utility.keymap.esc){if(c.disable_esc)return;if(c.esc_for_ok)p();else{S();if(c.clog_name)TS.clog.track(c.clog_name+"_ACTION",{action:"close_modal",trigger:"esc_key"})}}};var S=function r(n){if(M(n)){if(e)e.removeClass("active");if(t)t.removeClass("active");setTimeout(function(){$("html").removeClass("fs_modal_active")},TS.ui.fs_modal.transition_duration);if(c.onCancel)c.onCancel();v()}};var T=function r(){e.remove();t.remove();TS.ui.fs_modal.is_showing=false;x()};var v=function e(){setTimeout(function(){T()},TS.ui.fs_modal.transition_duration);$(window.document).off("keydown.fs_modal");if(c.onEnd)c.onEnd();TS.tips.unhideAll()};var b=function r(n){e.removeClass("active");if(c.onCancel)c.onCancel();var i=t.attr("id",null).addClass("fs_modal_bg");setTimeout(function(){e.remove();TS.ui.fs_modal.is_showing=false;TS.ui.fs_modal.start(n);setTimeout(i.remove.bind(i),TS.ui.fs_modal.transition_duration)},TS.ui.fs_modal.transition_duration)};var y=function t(){var r={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",transition:"transitionend"};for(var n in r)if(void 0!==e[0].style[n])return r[n]};var w=function t(){var r=e.find("[data-modal-items]");l=c.modal_gallery.index;TS.ui.fs_modal.hideFooter();if(l)e.find('[data-modal-gallery-index="'+l+'"]').removeClass("hidden");else e.find("[data-modal-gallery-index]").first().removeClass("hidden");e.on("click","[data-modal-gallery-direction]",function(){var e=$(this).data("modal-gallery-direction");l+=e;r.find("[data-modal-gallery-index]").addClass("hidden");r.find('[data-modal-gallery-index="'+l+'"]').removeClass("hidden");C()});C()};var k=function e(){if(!TS.model.is_our_app||!TSSSB.nodrag.getIsRequired())return;if(_.get(window,"desktop.app.updateDragRegion")){window.desktop.app.updateDragRegion([]);return}TSSSB.nodrag.regions.set([]);var t=$("#fs_modal").find("header").find("button, a").toArray();if(!u){TSSSB.nodrag.updateElements(t);u=true}d=_.debounce(function(){window.requestIdleCallback(function(){return TSSSB.nodrag.updateElements(t)},{timeout:200})},400);$(window).off("resize.setupNoDragFSM").on("resize.setupNoDragFSM",d)};var x=function e(){if(!TS.model.is_our_app||!TSSSB.nodrag.getIsRequired())return;u=false;$(window).off("resize.setupNoDragFSM");TSSSB.nodrag.regions.set([]);TS.client.channel_header.calculateNoDragRegions();TS.search.autocomplete.calculateNoDragRegions()};var C=function t(){var r=e.find('[data-modal-gallery-direction="-1"]');var n=e.find('[data-modal-gallery-direction="1"]');var i=e.find("[data-modal-slideshow-count]");var a=e.find("[data-modal-slideshow-total]");var s=c.modal_gallery.total_items;if(0===l)r.prop("disabled",true);else r.prop("disabled",false);if(l===s)n.prop("disabled",true);else n.prop("disabled",false);i.html(l+1);a.html(s+1)};var M=function e(t){if(t)return true;if(TS.ui.lazy_filter_select.is_list_open)return false;if(TS.ui.react_emoji_menu.is_showing)return false;if(TS.model.menu_is_showing)return false;if(TS.model.dialog_is_showing)return false;if(TS.utility.isTabCompleteShowing())return false;return true}})()},4813:function(e,t){(function(){TS.registerModule("ui.admin_edit_team_profile",{onStart:function e(){$("body").on("click",'[data-action="edit_team_profile_modal"]',TS.ui.admin_edit_team_profile.start)},start:function e(){if(C())a()}});var e;var t;var r;var n=[];var i=50;var a=function e(){var t={body_template_html:TS.templates.admin_edit_team_profile_modal(),onShow:s,onCancel:o};TS.ui.fs_modal.start(t)};var s=function r(){e=$("#edit_team_profile_container");t=$("body");e.on("click",'[data-action="edit_team_profile_to_custom"]',v);e.on("click",'[data-action="edit_team_profile_to_add"]',T);e.on("click",'[data-action="edit_team_profile_to_edit"]',b);e.on("click",'[data-action="edit_team_profile_to_hide"]',y);e.on("click",'[data-action="edit_team_profile_to_delete"]',w);e.on("click",'[data-action="edit_team_profile_cancel"]',S);e.on("click",'[data-action="edit_team_profile_confirm_edit"]',h);e.on("click",'[data-action="edit_team_profile_confirm_hide"]',m);e.on("click",'[data-action="edit_team_profile_confirm_delete"]',c);e.on("click",'[data-action="edit_team_profile_remove_option"]',A);e.on("click",'[data-action="edit_team_profile_add_option"]',E);e.on("focusin",'[data-action="edit_team_profile_update_preview_label"], [data-action="edit_team_profile_update_preview_hint"], .option_header_row + .option_row [data-action="edit_team_profile_update_preview_option"]',B);e.on("focusout",'[data-action="edit_team_profile_update_preview_label"], [data-action="edit_team_profile_update_preview_hint"], .option_header_row + .option_row [data-action="edit_team_profile_update_preview_option"]',D);e.on("input",'[data-action="edit_team_profile_update_preview_label"], [data-action="edit_team_profile_update_preview_hint"], .option_header_row + .option_row [data-action="edit_team_profile_update_preview_option"]',O);e.on("click",'[data-action="edit_team_profile_list_menu"]',L);e.on("input","input",V);t.on("keydown.admin_submit",l);u().then(S).catch(TS.error)};var o=function i(){M(true);e=null;n=[];r=null;t.off("keydown.admin_submit");t=null;if(TS.web&&TS.web.account_profile)TS.web.account_profile.render()};var l=function e(t){if(t.which==TS.utility.keymap.enter){$(r).find('button[type="submit"]').trigger("click");return false}};var u=function e(){return TS.team.ensureTeamProfileFields()};var d=function e(t,r){if(!t)return;return TS.api.call(t,r).then(function(e){if(TS.web)if("team.profile.delete"===t)TS.team.upsertTeam(_.assign({id:TS.boot_data.team_id},{profile:JSON.parse(r.profile)}));else TS.team.upsertTeam(_.assign({id:TS.boot_data.team_id},e.data));return Promise.resolve(e)},function(e){return Promise.reject(e)})};var c=function e(t){var r=$(t.target);var n=r.data("id");if(!n)r=r.closest("[data-id]");n=r.data("id");if(!n)return;var i=TS.team.getTeamProfileFieldById(n);if(!i)return;g("team.profile.delete",[n]).then(function(){S()},_.noop)};var m=function e(t){p(t,true)};var f=function e(t){p(t,false)};var p=function e(t,r){var n=$(t.target);var i=n.data("id");if(!i)n=n.closest("[data-id]");i=n.data("id");if(!i)return;var a=TS.team.getTeamProfileFieldById(i);if(!a)return;a=$.extend({},a);a.is_hidden=r;if(r)a.ordering=R();g("team.profile.set",[a]).then(function(){return TS.api.call("team.profile.get")}).then(function(e){TS.model.team.profile.fields=_.get(e,"data.profile.fields");S();K(i)},_.noop)};var h=function t(r){var n=e.find("#edit_team_profile_edit");if(!TS.ui.validation.validate(n,{quiet:true,fast:true})){TS.ui.validation.validate(n);Ladda.stopAll();$("#edit_team_profile_confirm_edit_btn").addClass("disabled");return}var i=$(r.target);var a=i.data("id");if(!a)i=i.closest("[data-id], [data-type]");a=i.data("id");var s=e.find('input[name="label"]');var o=e.find('input[name="hint"]');var l=TS.team.getTeamProfileFieldById(a)||{};var u=JSON.stringify(l);l=$.extend({},l);l.type=l.type||i.data("type")||"text";l.label=s.val().trim();l.hint=o.val().trim();l.ordering=void 0!==l.ordering?l.ordering:R();if("options_list"===l.type)l.possible_values=e.find('input[name^="option_"]').map(function(){return $(this).val().trim()}).toArray();function d(){S();K(a)}if(JSON.stringify(l)==u){d();Ladda.stopAll()}else g("team.profile.set",[l]).then(d,_.noop)};var g=function e(t,r){r=r&&r.length?r:TS.model.team.profile.fields;var n={profile:JSON.stringify({fields:r})};return d(t,n).catch(function(e){if("no_perms"===e.data.error||"missing_scope"===e.data.error)TS.generic_dialog.start({body:TS.i18n.t("Sorry! An owner in your workspace has restricted who can customize your members’ profile.","team_profile")(),show_cancel_button:false,esc_for_ok:true,fullscreen:false,onEnd:TS.ui.fs_modal.close});else if("field_bad_order"===e.data.error){TS.error("Failed to create profile field: "+e.data.error);return TS.generic_dialog.alert(TS.i18n.t("Apologies, but the maximum number of profile fields you can add is {max_no_of_fields, number}. Please remove some existing fields if you’d like to add different ones.","team_profile")({max_no_of_fields:i}))}else{TS.error("Failed to customize profile: "+e.data.error);return TS.generic_dialog.alert(TS.i18n.t("Sorry! Something went wrong. Please try again.","team_profile")())}}).finally(Ladda.stopAll)};var S=function t(){n.length=0;n.push({back:t});var r={};r.team_profile_fields=q();r.hidden_team_profile_fields=G();r.default_team_profile_fields=z();var i=TS.templates.admin_edit_team_profile_list(r);e.find("#edit_team_profile_header").text(TS.i18n.t("Customize profile","team_profile")()).removeClass("hidden center_and_narrow");var a;if(TS.model.team.profile&&TS.model.team.profile.fields.length>=50)a='<div class="alert alert_info"><i class="ts_icon ts_icon_info_circle"></i>'+TS.i18n.t("You have reached the maximum number of fields that can be added to profiles.","team_profile")()+"</div>";else a=TS.i18n.t("Expand your members’ profiles by adding additional fields below","team_profile")();e.find("#edit_team_profile_value_note").html(a).removeClass("hidden center_and_narrow");e.find("#edit_team_profile_list").html(i);U("#edit_team_profile_list");j();x();M(true)};var T=function t(){n.push({back:t});var r={};r.default_team_profile_fields=z();var i=TS.templates.admin_edit_team_profile_add(r);e.find("#edit_team_profile_header").text(TS.i18n.t("Select a field type","team_profile")()).removeClass("center_and_narrow");e.find("#edit_team_profile_value_note").addClass("hidden");e.find("#edit_team_profile_add").html(i);U("#edit_team_profile_add");x();M()};var v=function t(){n.push({back:t});var r=TS.templates.admin_edit_team_profile_custom();e.find("#edit_team_profile_header").text(TS.i18n.t("Create a new field","team_profile")()).removeClass("center_and_narrow");e.find("#edit_team_profile_value_note").text(TS.i18n.t("Which type of field would you like to create?","team_profile")()).removeClass("hidden center_and_narrow");e.find("#edit_team_profile_custom").html(r);U("#edit_team_profile_custom");x();M();H()};var b=function t(r){var i=$(r.target);if(i.hasClass("ts_icon_grabby_patty"))return false;var a=i.data("id");if(!a)i=i.closest("[data-id], [data-type]");a=i.data("id");var s={};var o;if(!a){s.type=i.data("type");s.label=i.data("label");o=TS.i18n.t("Customize profile field","team_profile")()}else{s=TS.team.getTeamProfileFieldById(a);if(!s)return;o=TS.i18n.t("Edit profile field","team_profile")()}r.stopPropagation();n.push({back:t,event:r});var l=TS.templates.admin_edit_team_profile_edit(s);e.find("#edit_team_profile_header").text(o).removeClass("center_and_narrow");e.find("#edit_team_profile_value_note").addClass("hidden");e.find("#edit_team_profile_edit").html(l);U("#edit_team_profile_edit");I();P();H();Ladda.bind("#edit_team_profile_confirm_edit_btn");x();M();V()};var y=function t(r){var i=$(r.target);var a=i.data("id");if(!a)i=i.closest("[data-id]");a=i.data("id");if(!a)return;var s=TS.team.getTeamProfileFieldById(a);if(!s)return;r.stopPropagation();n.push({back:t,event:r});var o=TS.templates.admin_edit_team_profile_hide({id:s.id,can_delete:!_.get(s,"options.is_scim",false)});var l=TS.i18n.t('Hide "{field_label}"',"team_profile")({field_label:s.label});e.find("#edit_team_profile_header").text(l).addClass("center_and_narrow");var u=TS.i18n.t("All data entered for this field will no longer be visible on your members’ profiles. You can un-hide it later.","team_profile")();e.find("#edit_team_profile_value_note").text(u).addClass("center_and_narrow").removeClass("hidden");e.find("#edit_team_profile_hide").html(o);U("#edit_team_profile_hide");Ladda.bind("#edit_team_profile_confirm_hide_btn");k();M()};var w=function t(r){var i=$(r.target);var a=i.data("id");if(!a)i=i.closest("[data-id]");a=i.data("id");if(!a)return;var s=TS.team.getTeamProfileFieldById(a);if(!s)return;r.stopPropagation();n.push({back:t,event:r});var o=TS.templates.admin_edit_team_profile_delete(s);var l=TS.i18n.t('Delete "{field_label}"',"team_profile")({field_label:s.label});e.find("#edit_team_profile_header").text(l).addClass("center_and_narrow");var u=TS.i18n.t("<strong>Are you sure?</strong> All data associated with this field will be permanently deleted. This <strong>cannot be undone</strong>.","team_profile")();e.find("#edit_team_profile_value_note").html(u).addClass("center_and_narrow").removeClass("hidden");e.find("#edit_team_profile_delete").html(o);U("#edit_team_profile_delete");Ladda.bind("#edit_team_profile_confirm_delete_btn");k();M()};var k=function t(){e.closest(".contents").addClass("display_flex flex_direction_column").css("height","70vh");e.css({margin:"auto 0",height:"auto","padding-top":0})};var x=function t(){e.closest(".contents").removeClass("display_flex flex_direction_column").css("height","");e.css({margin:"",height:"","padding-top":""})};var C=function e(){if(!(TS.model.team&&TS.model.team.plan))return false;var t=TS.model.user;if(!t)return false;if("admin"===TS.prefs.getTeamPref("who_can_change_team_profile"))return t.is_admin;if("owner"===TS.prefs.getTeamPref("who_can_change_team_profile"))return t.is_owner;return true};var M=function e(t){if(t){TS.ui.fs_modal.unbindBackButton();TS.ui.fs_modal.hideBackButton()}else{TS.ui.fs_modal.bindBackButton(function(){n.pop();var e=n.pop();e.back(e.event)});TS.ui.fs_modal.showBackButton()}};var I=function t(){var r=e.find(".option_row");if(r.length>=3)r.addClass("show_remove_action");else r.removeClass("show_remove_action")};var P=function t(){O({target:e.find('.option_header_row + .option_row [data-action="edit_team_profile_update_preview_option"]')})};var A=function e(t){$(t.target).closest(".row.option_row").remove();V();I();P();F()};var E=function t(){var r=TS.templates.admin_edit_team_profile_option_row({index:e.find(".row.option_row").length});e.find("#option_rows").append(r).find(".row.option_row").last().find("input").focus();V();I();F()};var F=function t(){if(50===e.find(".row.option_row").length)e.find('[data-action="edit_team_profile_add_option"]').addClass("hidden").next().removeClass("hidden");else e.find('[data-action="edit_team_profile_add_option"]').removeClass("hidden").next().addClass("hidden")};var O=function t(r){var n=$(r.target);var i=n.val();if(i)i=i.trim();if(void 0!==i&&!i.length)i=n.data("default");e.find('.profile_field_preview [data-id="'+n.data("target")+'"]').text(i)};var B=function t(r){var n=e.find('.profile_field_preview [data-id="'+$(r.target).data("target")+'"]');var i=n.closest("select");if(i.length)n=i;n.addClass("highlight_yellow_bg")};var D=function t(r){var n=e.find('.profile_field_preview [data-id="'+$(r.target).data("target")+'"]');var i=n.closest("select");if(i.length)n=i;n.removeClass("highlight_yellow_bg")};var H=function t(){var r=e.find(".edit_team_profile_lazy_filter_select");if(!r.length)return;var n={append:true,classes:"disabled",preselected_ids:[TS.members.getMemberByName("slackbot").id]};TS.ui.people_picker.make(r,n)};var j=function t(){e.find("#edit_team_profile_list_drag_and_drop_area").sortable({items:".visible_row[data-id]",handle:".ts_icon_grabby_patty",forcePlaceholderSize:true}).on("sortupdate",function(e){e.stopPropagation();var t=[];$(this).find(".row[data-id]").each(function(e){var r=TS.team.getTeamProfileFieldById($(this).data("id"));if(r&&r.ordering!=e){r.ordering=e;t.push({id:r.id,ordering:e})}});TS.team.sortTeamProfileFieldsByOrdering();g("team.profile.reorder",t)})};var R=function e(){if(!TS.model.team.profile.fields.length)return 0;return _.max(TS.model.team.profile.fields.map(function(e){return e.ordering}))+1};var L=function e(t){t.stopPropagation();var r=$(t.target).closest("[data-id]").get(0);var n={};n.is_scim=$(t.target).closest("[data-is-scim]").data("is-scim");var i=jQuery.Event("click",{target:r,currentTarget:r});TS.menu.startWithEditTeamProfileListActions(i,N,n)};var N=function e(t){t.preventDefault();var r=$(t.target).closest("[data-id]");if(r.is('[data-action="edit_team_profile_to_show"]'))f(t);else if(r.is('[data-action="edit_team_profile_to_hide"]'))y(t);else if(r.is('[data-action="edit_team_profile_to_delete"]'))w(t);TS.menu.end()};var U=function t(n){var i=["#edit_team_profile_loading","#edit_team_profile_list","#edit_team_profile_add","#edit_team_profile_custom","#edit_team_profile_edit","#edit_team_profile_hide","#edit_team_profile_delete"].filter(function(e){return e!==n}).join(", ");e.find(i).addClass("hidden");e.find(n).removeClass("hidden");r=n};var q=function e(){var t=TS.team.getVisibleTeamProfileFields();return t.length?t:null};var G=function e(){var t=TS.team.getHiddenTeamProfileFields();return t.length?t:null};var W=function e(){return TS.model.team.profile.fields.reduce(function(e,t){e[t.label.toLowerCase()]=true;return e},{})};var z=function e(){var t=W();var r=[{type:"text",label:TS.i18n.t("Address","team_profile")()},{type:"date",label:TS.i18n.t("Birthdate","team_profile")()},{type:"user",label:TS.i18n.t("Direct Reports","team_profile")()},{type:"link",label:TS.i18n.t("Facebook","team_profile")()},{type:"link",label:TS.i18n.t("Flickr","team_profile")()},{type:"link",label:TS.i18n.t("GitHub","team_profile")()},{type:"link",label:TS.i18n.t("Instagram","team_profile")()},{type:"link",label:TS.i18n.t("LinkedIn","team_profile")()},{type:"user",label:TS.i18n.t("Manager","team_profile")()},{type:"link",label:TS.i18n.t("Pinterest","team_profile")()},{type:"text",label:TS.i18n.t("Skype","team_profile")()},{type:"link",label:TS.i18n.t("SoundCloud","team_profile")()},{type:"date",label:TS.i18n.t("Start Date","team_profile")()},{type:"link",label:TS.i18n.t("Tumblr","team_profile")()},{type:"link",label:TS.i18n.t("Twitter","team_profile")()},{type:"link",label:TS.i18n.t("YouTube","team_profile")()}].filter(function(e){return!t[e.label.toLowerCase()]});return r.length?r:[]};var K=function t(r){var n=r?"[data-id="+r+"]":".visible_row[data-id]";var i=e.find("#edit_team_profile_list").find(n).last();var a=-2*i.outerHeight();i.highlight(1500,"",null,0);i.scrollintoview({duration:200,px_offset:a,direction:"y"})};var V=function t(){$("#edit_team_profile_confirm_edit_btn").toggleClass("disabled",!TS.ui.validation.validate(e.find("#edit_team_profile_edit"),{quiet:true,fast:true}))}})()},4814:function(e,t){(function(){TS.registerModule("ui.edit_member_profile",{onStart:function e(){TS.members.changed_profile_sig.add(pe);if(TS.view)TS.view.resize_sig.add(Te);$("body").on("click",'[data-action="edit_member_profile_modal"]',function(e){e.preventDefault();TS.ui.edit_member_profile.start();TS.clog.track("USER_PROFILE_CLICK")})},start:function e(){d()},handleDrag:function e(t){if(TS.boot_data.feature_take_profile_photo)if(t)K();else V()},handleDrop:function e(t){if(TS.boot_data.feature_take_profile_photo){V();O(t)}},_registerCurrentStatusInput:function e(){TS.ui.edit_member_profile._unregisterCurrentStatusInput();TS.ui.edit_member_profile._current_status_input=new TS.ui.CurrentStatusInput({$parent:$("#edit_member_profile_container"),has_presets_menu:true,has_form_context:true})},_unregisterCurrentStatusInput:function e(){if(TS.ui.edit_member_profile._current_status_input){TS.ui.edit_member_profile._current_status_input.destroy();TS.ui.edit_member_profile._current_status_input=null}}});var e;var t;var r;var n;var i;var a;var s;var o=[];var l;var u;var d=function e(){var t={};t.custom_username_policy=TS.prefs.getTeamPref("username_policy");var r={body_template_html:TS.templates.edit_member_profile_modal(t),onShow:c,onGo:ae,onCancel:m,go_button_text:TS.i18n.t("Save Changes","edit_profile")(),go_button_class:"edit_member_profile_confirm_edit_btn ladda-button",modal_class:"fs_modal_header fs_modal_footer",title:TS.i18n.t("Edit your profile","edit_profile")()};TS.ui.fs_modal.start(r)};var c=function r(){e=$("#edit_member_profile_container");t=$("body");if(be())$("#fs_modal_footer").prepend(TS.templates.edit_member_profile_footer({can_edit_team_profile:true}));if(TS.boot_data.feature_take_profile_photo)h();e.on("click",'[data-action="edit_member_profile_cancel_photo"]',G);e.on("click",'[data-action="edit_member_profile_confirm_photo_delete"]',E);e.on("click",'[data-action="edit_member_profile_confirm_photo_crop"]',F);e.on("click",'[data-action="edit_member_profile_photo_menu"]',le);e.on("click",'[data-action="edit_member_profile_upload_image"]',ue);e.on("click",'[data-action="edit_member_profile_to_delete"]',de);e.on("click",'[data-action="edit_member_profile_take_photo"]',Z);e.on("click",'[data-action="edit_member_profile_capture_photo"]',x);t.on("change.photo",'[data-action="edit_member_profile_upload_photo"]',O);t.on("keydown.member_submit",f);e.on("input","input",me).on("change","select",me);e.on("input",'[data-plastic-type="date"]',ve);e.on("dragenter",".member_image_upload",Y);e.on("dragleave",".member_image_upload",J);p().then(G).catch(TS.error)};var m=function a(){U();v();e=null;r=null;n=null;i=null;o=[];s=null;u=null;if(t){t.off("change.photo");t.off("keydown.member_submit");t=null}if(TS.client)TS.ui.edit_member_profile._unregisterCurrentStatusInput();if(TS.web&&TS.web.account_profile)TS.web.account_profile.render()};var f=function e(t){if(t.which==TS.utility.keymap.enter){var r=$(s).find('button[type="submit"]');if(r.length)r.trigger("click");else ae();return false}};var p=function e(){return TS.team.ensureTeamProfileFields()};var h=function e(){if(!TS.boot_data.feature_take_profile_photo)return;var t=g();u={};u.is_supported=!!t;u.is_accepted=true;u.is_enabled=false;u.video_el=null;u.video_stream=null;u.get_media=t};var g=function e(){if(!TS.boot_data.feature_take_profile_photo)return;if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)return navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);var t=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia;if(t)return function(e){return new Promise(function(r,n){t.call(navigator,e,r,n)})};return null};var S=function e(){if(!TS.boot_data.feature_take_profile_photo)return;if(u.is_enabled){$(u.video_el).removeClass("no_opacity");return}var t=true;var r=700;var n=$("#edit_member_profile_photo_preview_overlay");n.addClass("no_opacity");l=function e(){t=false;n.addClass("no_opacity")};var i=function e(){t=false;n.addClass("no_opacity");$(u.video_el).removeClass("no_opacity")};var a=function e(){if(t)n.removeClass("no_opacity")};setTimeout(a,r);var s={video:{width:1280,height:720}};u.get_media(s).then(T).then(i).catch(y)};var T=function e(t){return new Promise(function(e){var r=t;var n=window.URL||window.webkitURL;if(n)r=n.createObjectURL(t);u.video_el=$("#edit_member_profile_photo_preview_video").get()[0];u.is_accepted=true;u.is_enabled=true;u.video_stream=t;$(u.video_el).attr("src",r);u.video_el.addEventListener("loadeddata",e)})};var v=function e(){if(!TS.boot_data.feature_take_profile_photo)return;if(!u||!u.is_enabled)return;b();u.video_el.pause();u.video_el.src="";u.video_el=null;u.video_stream.getVideoTracks()[0].stop();u.video_stream=null;u.is_enabled=false};var b=function e(){if(u.video_el)$(u.video_el).addClass("no_opacity");var t=$("#edit_member_profile_photo_preview_overlay");t.addClass("no_opacity");var r=$("#edit_member_profile_photo_capture_button");r.removeClass("hidden");var n=$("#edit_member_profile_photo_capture_countdown");n.addClass("hidden")};var y=function e(t){switch(t.name){case"PermissionDeniedError":case"PermissionDismissedError":u.is_accepted=false;w();break;case"NotFoundError":k();break;default:q()}};var w=function e(){return TS.generic_dialog.alert(TS.i18n.t("It looks like you’ve blocked Slack from accessing your camera. Just change your browser’s settings to allow Slack to take a photo now.","edit_profile")(),TS.i18n.t("Please enable your camera","edit_profile")()).then(G)};var k=function e(){return TS.generic_dialog.alert(TS.i18n.t("Sorry! Your camera could not be found!","edit_profile")()).then(G)};var x=function e(){if(!TS.boot_data.feature_take_profile_photo)return;if(!u.is_enabled)return;C().then(I).then(P).then(A).then(H).then(j).then(R).then(L).catch(N)};var C=function e(){if(!TS.boot_data.feature_take_profile_photo)return;return new Promise(function(e,t){if(!u.is_enabled){TS.warn("Camera not enabled");t()}TS.ui.fs_modal.setHeaderTitle(TS.i18n.t("Smile for the camera!","edit_profile")());var r=$("#edit_member_profile_photo_capture_button");r.addClass("hidden");var n=$("#edit_member_profile_photo_capture_countdown");n.removeClass("hidden");M(3,false,e,t)})};var M=function e(t,r,n,i){if(!TS.boot_data.feature_take_profile_photo)return;l=function e(){r=true};if(r){TS.info("Profile photo capture aborted");i(new Error("abort"));return}if(0===t){n();return}var a=$("#edit_member_profile_photo_countdown_progress");var s=$("#edit_member_profile_photo_countdown_text");a.circleProgress({value:1,size:64,animation:{duration:1e3},fill:{gradient:["#50acf4","#41a6f5"]},startAngle:Math.PI/-2}).on("circle-animation-progress",function(){s.html(parseInt(t,10))});setTimeout(function(){t-=1;e(t,r,n,i)},1e3)};var I=function e(){b();te();ge(0)};var P=function e(){if(!TS.boot_data.feature_take_profile_photo)return;return new Promise(function(e){var t=document.createElement("canvas");var r=t.getContext("2d");t.width=u.video_el.videoHeight;t.height=u.video_el.videoHeight;var n=(u.video_el.videoWidth-t.width)/-2;r.translate(t.width,0);r.scale(-1,1);r.drawImage(u.video_el,n,0,u.video_el.videoWidth,u.video_el.videoHeight);var i=t.toDataURL("image/png",1);e(i)})};var A=function e(t){if(!TS.boot_data.feature_take_profile_photo)return;var r;if(t.split(",")[0].indexOf("base64")>=0)r=atob(t.split(",")[1]);else r=unescape(t.split(",")[1]);var n=t.split(",")[0].split(":")[1].split(";")[0];var i=new Uint8Array(r.length);for(var a=0;a<r.length;a+=1)i[a]=r.charCodeAt(a);var s=new Blob([i],{type:n});s.lastModifiedDate=new Date;s.name="camera_photo";var o={file:s,src:t};return o};var E=function e(){$("#edit_member_profile_cancel_photo_delete_btn").addClass("disabled");$("#fs_modal").addClass("stop_pointer_events");t.on("keydown.deletePhoto",function(e){e.stopPropagation()});TS.api.call("users.deletePhoto").then(function(){if(TS.web)return TS.api.call("users.info",{user:TS.model.user.id,_x_reason:"web_edit_member_profile"}).then(function(e){delete e.data.ok;var t=$.extend(true,TS.model.user,e.data.user);TS.members.upsertMember(t);pe();G()},G);G()}).catch(function(e){TS.warn("Unable to delete profile photo");TS.error(e);return q()}).finally(function(){Ladda.stopAll();t.off("keydown.deletePhoto");$("#fs_modal").removeClass("stop_pointer_events");$("#edit_member_profile_cancel_photo_delete_btn").removeClass("disabled")})};var F=function e(){if(n)n.disable();$("#edit_member_profile_cancel_photo_crop_btn").addClass("disabled");$("#edit_member_profile_retake_photo_crop_btn").addClass("disabled");$("#fs_modal").addClass("stop_pointer_events");t.on("keydown.uploadPhoto",function(e){e.stopPropagation()});var r=$("#edit_member_profile_photo");var i=$("#cropbox");var a=i.data("dimensions");a.id=r.data("src_id");TS.api.call("users.setPhoto",a).then(function(e){if(TS.web){delete e.data.ok;var t=$.extend(true,TS.model.user,e.data);TS.members.upsertMember(t);pe()}G()}).catch(function(e){TS.warn("Unable to upload cropped profile photo");TS.error(e);return q()}).finally(function(){Ladda.stopAll();t.off("keydown.uploadPhoto");$("#fs_modal").removeClass("stop_pointer_events");$("#edit_member_profile_cancel_photo_crop_btn").removeClass("disabled");$("#edit_member_profile_retake_photo_crop_btn").removeClass("disabled");i.removeData("dimensions")})};var O=function t(r){var n="change"===r.type?$(this):void 0;if(n){if(!n.val()){if(TS.model.is_iOS)TS.menu.end();return}r=n.get(0).files}if(r){if(TS.model.is_iOS)TS.menu.end();if(!r.length)return;te();ge(0);B(r[0]).then(D).then(H).then(j).then(R).then(L).catch(N);e.find('[data-action="edit_member_profile_upload_photo"]').val("")}};var B=function e(t){return new Promise(function(e,r){var n=new FileReader;n.onload=function(r){e({file:t,src:r.target.result})};n.onabort=function(){TS.info("Profile photo file read aborted");r(new Error("abort"))};n.onerror=function(e){TS.warn("Unable to read profile photo file");TS.error(e);r(e)};l=function e(){try{n.abort()}catch(e){TS.error(e)}};n.readAsDataURL(t)})};var D=function e(t){return t.file.type.match(/image\/(?:gif|png|jpeg)/i)?Promise.resolve(t):Promise.reject(new Error("format"))};var H=function e(t){return new Promise(function(e,r){i=new Image;i.onload=function(){e(t)};i.onerror=function(e){TS.warn("Unable to set profile photo file image src");TS.error(e);r(e)};i.src=t.src})};var j=function e(t){var r=TS.model.api_url+"users.preparePhoto";var n=new FormData;n.append("image",t.file);n.append("token",TS.model.api_token);return new Promise(function(e,t){var i=$.ajax({url:r,data:n,dataType:"json",cache:false,contentType:false,processData:false,type:"POST",xhr:function e(){var e=jQuery.ajaxSettings.xhr();if(e.upload)e.upload.addEventListener("progress",function(e){if(e.lengthComputable)ge(e.loaded/e.total);else{TS.info("Upload length not computable");ge(1)}},false);return e}}).fail(function(e,r,n){l=null;t(new Error(n))}).done(function(r){l=null;if(r.ok)e(r);else t(new Error(r.error))});l=i.abort})};var R=function e(t){return new Promise(function(e,r){var n=$("#edit_member_profile_photo");var a=n.get(0);var s=function r(){i.src=t.url;$("#edit_member_profile_photo_preview").css("background","url("+t.url+")");n.css("opacity",0);ee();u();e()};var o=function e(t){TS.warn("Unable to set crop photo file image src");TS.error(t);u();r(t)};var u=function e(){a.removeEventListener("load",s);a.removeEventListener("error",o)};l=function t(){u();e()};n.attr("src",t.url).data("src_id",t.id);a.addEventListener("load",s);a.addEventListener("error",o)})};var L=function e(){function t(e){if(!i)return;var t=o.width();var r=t*i.width/e.crop_w;var n=t*i.height/e.crop_w;var a=r*e.crop_x*-1/i.width;var s=n*e.crop_y*-1/i.height;o.css({"background-size":r+"px","background-position":a+"px "+s+"px"})}function r(e){if(!i)return;var r={crop_x:Math.round(e.x),crop_y:Math.round(e.y),crop_w:Math.min(Math.round(e.w),i.height)};s.data("dimensions",r);t(r)}function a(){n.animateTo(_,function(){var e=this.tellSelect();e.w=i.width;r(e)});n.focus()}var s=$("#cropbox");var o=$("#edit_member_profile_photo_preview");var l=$("#edit_member_profile_photo");var u=l.width();var d=l.height();var _;if(!i)return;var c=Math.min(i.width,i.height);t({crop_x:(i.width-c)/2,crop_y:(i.height-c)/2,crop_w:c});$("#edit_member_profile_photo").css("opacity",0);l.Jcrop({aspectRatio:1,allowSelect:false,boxWidth:u,boxHeight:d,onSelect:r,onRelease:a,bgColor:"white",trueSize:[i.width,i.height]},function(){n=this;var e=this.getBounds();var t=Math.min(e[0],e[1]);var r=(e[0]-t)/2;var i=(e[1]-t)/2;_=[r,i,t,t];a()})};var N=function e(t){switch(t&&t.message){case"abort":break;case"format":case"bad_image":case"too_many_frames":ne();break;case"too_large":ie();break;default:return q()}};var U=function e(){if(l){l();l=null}};var q=function e(){return TS.generic_dialog.alert(TS.i18n.t("Sorry! Something went wrong. Please try again.","edit_profile")()).then(G)};var G=function t(){o.length=0;o.push({back:t});Se();U();v();i=null;var r=!e.find("#edit_member_profile_list").children().first().length;if(r){var n={member:TS.model.user,team:TS.model.team,team_member_profile_fields:TS.team.getVisibleTeamProfileFieldsForMember(TS.model.user,true)};var a=[];_.each(TS.boot_data.slack_timezones,function(e){a.push({label:e[0],val:e[1]})});n.timezone_options=a;n.member_tz=TS.model.user.tz||TS.boot_data.default_tz;n.custom_username_policy=TS.prefs.getTeamPref("username_policy");n.lock_display_name=false;if("normal"!==TS.prefs.getTeamPref("auth_mode")&&false===TS.prefs.getTeamPref("sso_choose_username"))n.lock_display_name=true;var s=TS.templates.edit_member_profile_list(n);e.find("#edit_member_profile_list").html(s);if(TS.client)TS.ui.edit_member_profile._registerCurrentStatusInput();TS.ui.validation.validate(e,{fast:true})}_e("#edit_member_profile_list");TS.ui.fs_modal.showFooter();TS.ui.fs_modal.setHeaderTitle(TS.i18n.t("Edit your profile","edit_profile")());Ladda.bind(".edit_member_profile_confirm_edit_btn");me();fe();oe();ce(true);if(TS.boot_data.feature_take_profile_photo){z();Q()}};var W=function e(){return true===TS.model.user.profile.is_custom_image};var z=function t(){var r=e.find(".show_delete");if(W()){r.removeClass("hidden");e.find(".member_image_wrapped_no_photo").addClass("hidden");e.find(".member_image_wrapped").removeClass("hidden")}else{r.addClass("hidden");e.find(".member_image_wrapped_no_photo").removeClass("hidden");e.find(".member_image_wrapped").addClass("hidden")}};var K=function t(){if(W())e.find(".member_image_wrapped").addClass("hidden");else e.find(".member_image_wrapped_no_photo").addClass("hidden");e.find(".edit-profile-drop-overlay").removeClass("hidden");e.find(".member_image_upload").removeClass("hidden");$(".file_drop_icon").fadeIn({queue:false,duration:"slow"});$(".file_drop_icon").animate({top:"20px"},"slow")};var V=function t(){if(W())e.find(".member_image_wrapped").removeClass("hidden");else e.find(".member_image_wrapped_no_photo").removeClass("hidden");e.find(".member_image_upload").addClass("hidden");e.find(".edit-profile-drop-overlay").addClass("hidden");e.find(".file_drop_icon").css("top","-20px")};var Y=function t(){e.find(".member_image_upload").addClass("hovered")};var J=function t(){e.find(".member_image_upload").removeClass("hovered")};var Q=function t(){var r=e.find(".show_take");if(u.is_supported)r.removeClass("hidden");else r.addClass("hidden")};var X=function t(){var r=e.find("#edit_member_profile_retake_photo_crop_btn");if(u.is_supported&&u.is_enabled&&u.is_accepted)r.removeClass("hidden");else r.addClass("hidden")};var Z=function e(){if(!TS.boot_data.feature_take_profile_photo)return;if(!u||!u.is_supported)return;o.push({back:G});i=null;Se();S();_e("#edit_member_profile_photo_take");TS.ui.fs_modal.hideFooter();TS.ui.fs_modal.setHeaderTitle(TS.i18n.t("Take a profile photo","edit_profile")());oe();ce()};var ee=function e(){o.push({back:G});if(TS.boot_data.feature_take_profile_photo)X();_e("#edit_member_profile_photo_crop");TS.ui.fs_modal.setHeaderTitle(TS.i18n.t("Crop your photo","edit_profile")());Ladda.bind("#edit_member_profile_confirm_photo_crop_btn");oe();ce()};var te=function e(){o.push({back:G});if(!r)he();_e("#edit_member_profile_photo_upload");TS.ui.fs_modal.hideFooter();TS.ui.fs_modal.setHeaderTitle(TS.i18n.t("Uploading your photo…","edit_profile")());oe();ce()};var re=function e(){o.push({back:e});_e("#edit_member_profile_photo_delete");TS.ui.fs_modal.hideFooter();TS.ui.fs_modal.setHeaderTitle(TS.i18n.t("Remove profile photo","edit_profile")());Ladda.bind("#edit_member_profile_confirm_photo_delete_btn");se();ce()};var ne=function e(){o.push({back:G});_e("#edit_member_profile_photo_format_error");TS.ui.fs_modal.setHeaderTitle(TS.i18n.t("Oh cripes","edit_profile")());oe();ce()};var ie=function e(){o.push({back:G});_e("#edit_member_profile_photo_oversize_error");TS.ui.fs_modal.setHeaderTitle(TS.i18n.t("Dang","edit_profile")());oe();ce()};var ae=function t(){if(!TS.ui.validation.validate(e,{quiet:true,fast:true})){TS.ui.validation.validate(e);Ladda.stopAll();$(".edit_member_profile_confirm_edit_btn").addClass("disabled");return}var r=["real_name","display_name","title","phone"];if(TS.client)r=r.concat(["status_emoji","status_text"]);var n={};r.forEach(function(t){var r;var i;if("status_text"===t){r=e.find("#current_status_for_edit_profile");i=TS.utility.contenteditable.value(r)}else{r=e.find('input[name="'+t+'"]');i=r.val()}n[t]=i&&i.trim()});if(TS.client){var i=TS.ui.edit_member_profile._current_status_input;if(i&&i.isEdited())i.clogStatusChange(n.status_text,n.status_emoji,"EDIT_PROFILE")}(TS.model.team.profile.fields||[]).filter(function(e){return!e.is_hidden}).forEach(function(t){var r=TS.model.user.profile.fields||{};var i=ye(r[t.id]);var a=ye(i.value);var s=ye(i.alt);var o=e.find('input[name="'+t.id+'"], select[name="'+t.id+'"]');var l=e.find('input[name="'+t.id+'_alt"]');var u=ye(o.val());var d=ye(l.val());n.fields=n.fields||{};if(a!==u||s!==d)n.fields[t.id]={value:u&&u.trim(),alt:d&&d.trim()};if("text"===t.type&&"skype"===t.label.toLocaleLowerCase())n.skype=u&&u.trim();o.val("").val(u);l.val("").val(d)});var a={profile:JSON.stringify(n)};var s=e.find('[name="tz"]').val();if(s!==TS.model.user.tz){if(TS.web){TS.model.user.tz=s;TS.model.user.tz_offset=TS.boot_data.dst_offsets[s].tz_offset}TS.prefs.setPrefByAPI({name:"tz",value:s})}TS.api.call("users.profile.set",a).then(function(e){$(".edit_member_profile_confirm_edit_btn").addClass("disabled");if(TS.web){TS.model.user.profile=e.data.profile;TS.members.upsertMember(TS.model.user)}if(TS.client)TS.ui.edit_member_profile._unregisterCurrentStatusInput();TS.ui.fs_modal.close()}).catch(function(t){$(".edit_member_profile_confirm_edit_btn").addClass("disabled");if("ratelimited"===t.data.error)return TS.generic_dialog.alert(TS.i18n.t("You’re changing your profile too often! You might have better luck if you try again in a few minutes.","edit_profile")());t.data.error=TS.ui.validation.maybeConvertNameErrorCode(t.data.error);var r=TS.ui.validation.getErrorMessage(t.data.error,{maxlength:80});if("real_name"===t.data.field){TS.ui.validation.showWarning(e.find('input[name="'+t.data.field+'"]'),r,{custom_for:"real_name_profile_field_warnings",should_truncate:false});return false}else if("display_name"===t.data.field){TS.ui.validation.showWarning(e.find('input[name="'+t.data.field+'"]'),r,{custom_for:"display_name_profile_field_warnings",should_truncate:false});return false}TS.ui.fs_modal.close();TS.generic_dialog.alert(TS.i18n.t("Sorry! Something went wrong. Please try again.","edit_profile")())}).finally(Ladda.stopAll);return false};var se=function t(){e.closest(".contents").addClass("display_flex flex_direction_column").css("height","70vh");e.css({margin:"auto 0",height:"auto","padding-top":0})};var oe=function t(){e.closest(".contents").removeClass("display_flex flex_direction_column").css("height","");e.css({margin:"",height:"","padding-top":""})};var le=function t(r){r.stopPropagation();if((!W()||$(r.target).is(".btn"))&&!TS.model.is_iOS)e.find('[data-action="edit_member_profile_upload_photo"]').trigger("click");else TS.menu.member.startWithEditMemberProfilePhotoActions(r,ue)};var ue=function t(r){var n;if(TS.boot_data.feature_take_profile_photo)n=$(r.target).closest("ts-icon");else n=$(r.target).closest("li");if(n.is('[data-action="edit_member_profile_upload_image"]')){if(!TS.model.is_iOS){r.preventDefault();e.find('[data-action="edit_member_profile_upload_photo"]').trigger("click");TS.menu.end()}}else if(n.is('[data-action="edit_member_profile_to_delete"]')){r.preventDefault();re();TS.menu.end()}};var de=function e(t){var r=TS.boot_data.feature_take_profile_photo?$(t.target).closest("ts-icon"):$(t.target).closest("li");if(r.is('[data-action="edit_member_profile_to_delete"]')){t.preventDefault();re();TS.menu.end()}};var _e=function t(r){var n=["#edit_member_profile_loading","#edit_member_profile_list","#edit_member_profile_photo_upload","#edit_member_profile_photo_crop","#edit_member_profile_photo_delete","#edit_member_profile_photo_take","#edit_member_profile_photo_size_error","#edit_member_profile_photo_format_error","#edit_member_profile_photo_oversize_error"].filter(function(e){return e!==r}).join(", ");e.find(n).addClass("hidden");e.find(r).removeClass("hidden");s=r};var ce=function e(t){if(t){TS.ui.fs_modal.unbindBackButton();TS.ui.fs_modal.hideBackButton()}else{TS.ui.fs_modal.bindBackButton(function(){o.pop();var e=o.pop();e.back()});TS.ui.fs_modal.showBackButton()}};var me=function t(){$(".edit_member_profile_confirm_edit_btn").toggleClass("disabled",!TS.ui.validation.validate(e,{quiet:true,fast:true}))};var fe=function t(){e.find(".edit_member_profile_lazy_filter_select").each(function(e,t){var r=$(t);var n=r.val().split(/\s*,\s*/);TS.ui.people_picker.make(r,{preselected_ids:n});r.on("change",function(){var e=TS.ui.people_picker.value(r).map(function(e){return e.member.id}).join(",");r.val(e);me()})})};var pe=function t(){if(!e)return;$("#edit_member_profile_photo_container .member_image").replaceWith(TS.templates.builders.makeMemberPreviewLinkImage(TS.model.user.id,192,false,true))};var he=function e(){r=$("#edit_member_profile_progress_circle").circleProgress({value:0,size:64,fill:{gradient:["#50acf4","#41a6f5"]},startAngle:Math.PI/-2})};var ge=function e(t){var n=parseFloat(t);if(!isNaN(n))r.circleProgress({value:n.toFixed(2)})};var Se=function e(){if(!n)return;n.destroy();n=null;$("#edit_member_profile_photo").css({width:"auto",height:"auto",display:"block",visibility:"visible",opacity:1})};var Te=function e(){if(n&&n.getOptions().disabled)return;Se();if(a)clearTimeout(a);a=setTimeout(function(){if(i&&!n)L()},300)};var ve=function e(t){var r=$(t.target);var n=$('input[name="'+r.attr("name")+'_alt"]');var i=r.val();if(i)i=i.trim();if(TS.ui.validation.validate(r,{quiet:true,fast:true}))n.val(TS.interop.datetime.convertISOtoUTCReadableDate(i))};var be=function e(){if(!TS.model.team.plan)return false;var t=TS.model.user;if(!t)return false;if(TS.model.user.enterprise_user)return TS.model.user.enterprise_user.is_admin||TS.model.user.enterprise_user.is_owner;if("admin"===TS.prefs.getTeamPref("who_can_change_team_profile"))return t.is_admin;if("owner"===TS.prefs.getTeamPref("who_can_change_team_profile"))return t.is_owner;return true};var ye=function e(t){return _.isUndefined(t)?"":t}})()},4815:function(e,t){(function(){TS.registerModule("enterprise.workspaces",{showList:function e(t,r,n,i){var s=TS.enterprise.workspaces.getList(r,i);var o=$(".more_teams_available");var l="";if(s.length){if(TS.boot_data.feature_invite_only_workspaces){v(a);b(a,s)}else s.forEach(function(e){l+=TS.enterprise.workspaces.getTeamCardHTML(e,n,true)});var u=TS.enterprise.workspaces.getList("workspaces_not_on",i);if(("teams_on"===r||"workspaces_on"===r)&&u.length)o.attr("data-has-more","yes").removeClass("hidden");else o.attr("data-has-more","").addClass("hidden")}else{if("teams_on"===r||"workspaces_on"===r)l+=TS.templates.not_on_any_workspaces();else l+=TS.templates.no_workspaces_to_join();o.attr("data-has-more","").addClass("hidden")}if(!TS.boot_data.feature_invite_only_workspaces)t.html(l);t.attr("data-list",r);C(t,r,n);return Promise.resolve(!!s.length)},getList:function e(t,r,n,i,a){if(!r)if("teams_not_on"===t||"workspaces_not_on"===t)r="members";else r="join";if(!n)n="";n=n.toLowerCase();if(void 0===i)i=false;var s=[];if(i)if(TS.model.is_our_app)s=_.difference(TS.model.user.enterprise_user.teams,TSSSB.call("getSignedInTeamIds"));else s=_.difference(TS.model.user.enterprise_user.teams,[TS.model.team.id]);var o={workspaces_on:[],workspaces_not_on:[]};a=a||TS.teams.getAllEnterpriseTeams();_.each(a,function(e){if(_.includes(TS.model.user.enterprise_user.teams,e.id))if(s.indexOf(e.id)>-1)o.workspaces_not_on.push(e);else o.workspaces_on.push(e);else if(e.is_open||e.is_closed||e.is_assigned||e.is_invite_only)o.workspaces_not_on.push(e)});return o[t].filter(function(e){return e.name.toLowerCase().indexOf(n)>-1||e.description&&e.description.toLowerCase().indexOf(n)>-1}).sort(function(e,t){if("name"===r){var n=e.name.toLowerCase();var i=t.name.toLowerCase();if(n<i)return-1;if(n>i)return 1;return 0}else if("creation"===r)return t.created-e.created;else if("join"===r)return t.joined_date-e.joined_date;else if("members"===r)return parseInt(t.user_counts.active_members,10)-parseInt(e.user_counts.active_members,10);return 0})},joinTeam:function e(t){var r=TS.teams.getTeamById(t);if(!r)return TS.generic_dialog.alert(TS.i18n.t("Invalid workspace","enterprise_dashboard")(),TS.i18n.t("Oops! Something went wrong.","enterprise_dashboard")());if(!r.is_open&&!r.is_assigned)return TS.generic_dialog.alert(TS.i18n.t("This workspace is not available to join.","enterprise_dashboard")(),TS.i18n.t("Oops! Something went wrong.","enterprise_dashboard")());var n={team:r.id};if("client"===TS.boot_data.app)n.enterprise_token=TS.model.enterprise_api_token;var i=function e(t,r,n){var i=TS.teams.getTeamById(n.team);var a=new Handlebars.SafeString(emoji.replace_colons(":sparkles:")+TS.i18n.t(" You’ve successfully joined <strong>{team_name}</strong>","enterprise_dashboard")({team_name:_.escape(i.name)}));if(t){TS.teams.upsertTeam(_.merge({},TS.teams.getTeamById(n.team),{joined_date:r.joined_date}));I("success",a);return true}if("user_already_team_member"===r.error){I("success",a);return true}else if("team_is_not_open"===r.error){I("error",TS.i18n.t("This workspace is not open to join.","enterprise_dashboard")());return false}I("error",TS.i18n.t('Joining workspace failed with error "{error}"',"enterprise_dashboard")({error:r.error}));return false};return TS.api.call("enterprise.teams.join",n).then(function(e){var t=e.data,r=e.args,n=e.request_id;var a=true;i(a,t,r,n);return{data:t,args:r,request_id:n}}).catch(function(e){var t=e.data,r=e.args,n=e.request_id;var a=false;i(a,t,r,n);return{data:t,args:r,request_id:n}})},requestToJoinTeam:function e(t,r){var n={team:t};if(r)n=_.merge({},n,r);if("client"===TS.boot_data.app)n.enterprise_token=TS.model.enterprise_api_token;var i=function e(t,r,n){TS.teams.upsertTeam(_.merge({},TS.teams.getTeamById(n.team),{has_join_request:true}));return t};return TS.api.call("enterprise.teams.joinrequests.create",n).then(function(e){var t=e.data,r=e.args,n=e.request_id;var a=true;i(a,t,r,n);return{data:t,args:r,request_id:n}}).catch(function(e){var t=e.data,r=e.args,n=e.request_id;var a=false;i(a,t,r,n);return{data:t,args:r,request_id:n}})},createLogoutURL:function e(t,r){var n=document.createElement("a");n.href=r;var i=n.protocol+"//"+n.host+"/signout/"+t+n.search+n.hash;n=null;return i},createURL:function e(t,r){var n=document.createElement("a");n.href=r;var i=n.protocol+"//"+t.domain+"."+n.host+"/";n=null;return i},getTeamCardHTML:function e(t,r,n){var i=TS.enterprise.workspaces.createURL(t,r);t.launch_url=i+"messages";t.site_url=i+"home";t.signout_url=TS.enterprise.workspaces.createLogoutURL(t.id,r);var a="enterprise_teams_launch_card";if(n)a="enterprise_teams_launch_card_wrapper";return TS.templates[a]({team:t,user:TS.model.user})},recordPageView:function t(r,n,i){if(!i)i="";var a={tracking_code:i,target_team_id:0};var s={action:"impression"};if(n)s.action_status=1;else s.action_status=2;switch(r){case"workspaces_on":case"teams_on":a.anchor_page="your_workspaces";a.entity_key="your_workspaces_list";break;case"workspaces_not_on":case"teams_not_on":a.anchor_page="find_workspaces";a.entity_key="workspaces_you_can_join_list"}TS.clog.track(e,_.assign({},a,{contexts:{ui_context:s}}))},recordTeamView:function t(r,n,i){if(!i)i="";var a={entity_key:"workspace_detail",target_team_id:r,tracking_code:i};var s={action:"impression",action_status:1};TS.clog.track(e,_.assign({},a,{contexts:{ui_context:s}}))},recordTeamJoin:function t(r,n,i){if(!i)i="";var a={anchor_page:n,entity_key:"join_workspace",target_team_id:r,tracking_code:i};var s={action:"click",action_status:1};TS.clog.track(e,_.assign({},a,{contexts:{ui_context:s}}))},recordTeamLeave:function t(r,n,i){if(!i)i="";var a={anchor_page:n,entity_key:"leave_workspace",target_team_id:r,tracking_code:i};var s={action:"click",action_status:1};TS.clog.track(e,_.assign({},a,{contexts:{ui_context:s}}))},recordTeamLeaveConfirm:function t(r,n,i){if(!i)i="";var a={anchor_page:n,entity_key:"leave_workspace_confirm",target_team_id:r,tracking_code:i};var s={action:"click",action_status:1};TS.clog.track(e,_.assign({},a,{contexts:{ui_context:s}}))},recordTeamRequestToJoin:function t(r,n,i){if(!i)i="";var a={anchor_page:n,entity_key:"request_to_join_workspace",target_team_id:r,tracking_code:i};var s={action:"click",action_status:1};TS.clog.track(e,_.assign({},a,{contexts:{ui_context:s}}))},recordTeamLaunch:function t(r,n,i){i=i||"";var a={anchor_page:n,entity_key:"launch_workspace",target_team_id:r,tracking_code:i};var s={action:"click",action_status:1};TS.clog.track(e,_.assign({},a,{contexts:{ui_context:s}}))},showRequestDialog:function e(){var t="#generic_dialog";var r=".dialog_go";var n="enterprise.teams.creationrequests.create";var i="#input_ws_team_name";var a="#textarea_ws_team_message";var s="#ws_request_form";function o(){var e=$(t);var n=e.find(r);var i=TS.ui.validation.validate($(s));if(i){n.removeAttr("disabled");return true}n.attr("disabled",true);return false}TS.generic_dialog.start({title:TS.i18n.t("Request creation of a new workspace","enterprise_workspaces")(),body:TS.templates.ws_request_dialog(),show_cancel_button:true,show_go_button:true,go_button_text:TS.i18n.t("Send Request","enterprise_workspaces")(),onGo:function e(){var s=$(t);var o=$(i);var l=o.val();var u=$(a);var d=u.val();var c=s.find(r);c.addClass("ladda-button");c.attr("data-style","expand-right");var m=Ladda.create(c[0]);m.start();var f={name:l,reason:d};if("client"===TS.boot_data.app)f.enterprise_token=TS.model.enterprise_api_token;TS.api.callImmediately(n,f).then(function(){TS.ui.toast.show({type:"success",message:TS.i18n.t("Request to create <b>{team_name}</b> sent! You’ll be notified once it’s reviewed.","enterprise_workspaces")({team_name:_.escape(l)})});TS.generic_dialog.end();TS.generic_dialog.cancel()}).catch(function(e){if(!e||!e.data){TS.error("WTF: error, but no response or data on "+n+"?",e);return}var t=e.data;var r={name_taken:TS.i18n.t("Request failed: The name <b>{team_name}</b> is already taken by another workspace.","enterprise_workspaces")({team_name:_.escape(l)}),name_is_empty:TS.i18n.t("Request failed: A name is required.","enterprise_workspaces")(),name_too_long:TS.i18n.t("Request failed: The name you provided is too long.","enterprise_workspaces")(),reason_too_long:TS.i18n.t("Request failed: The reason you provided is too long.","enterprise_workspaces")(),unknown:TS.i18n.t("Request failed: The response error was <b>{error_message}</b>.","enterprise_workspaces")({error_message:t.error||"unknown"})};TS.ui.toast.show({type:"error",message:r[t.error]||r.unknown});TS.error(n+" failed with error: "+(t.error||"undefined"));m.stop()});return false}});$([i,a].join(",")).on("keyup change",o);$(i).focus();$(t).find(r).attr("disabled",true)},promiseToSearchWorkspaces:function e(t){return Promise.resolve().then(function(){return TS.teams.promiseToSearchTeams(t)}).then(function(e){if(TS.boot_data.feature_invite_only_workspaces){_(e.items).map(TS.teams.upsertTeam).map("team").value();return Promise.resolve(t)}return Promise.resolve(_(e.items).map(TS.teams.upsertTeam).map("team").value())})},buildWorkspaceSearcher:function e(t,r){var n=_.get(r.additional_args,"sort_by")||_.get(r,"sort_by");if(!_.get(r,"additional_args.workspaces"))r.additional_args.workspaces=p(i);var a=_.assign({},t.additional_args,r.additional_args);var s=_.assign(t,{query:_.get(r,"query",""),sort_by:n,additional_args:a});return s},getWorkspaces:function e(t,r){l=$(a);u=$("[data-workspace-title-bar]");d=$("[data-workspace-search-input]");c=$("[data-workspace-info]");m=$("[data-workspace-search-spinner]");f=$("[data-workspace-list-spinner]");f.removeClass("hidden");o=!!r;if(t!==i)n.additional_args.workspaces=p(t);n.additional_args.search="";return Promise.resolve().then(function(){h(t)}).then(function(){y(n,r)})},setWorkspaceListItems:function e(t,r){var n=r||a;b(n,t)}});var e="ENTERPRISE_DISCOVER_WORKSPACES";var t=1e3;var r;var n={query:"",endpoint:"enterprise.teams.directory",response_key:"teams",additional_args:{sort_by:"name"},sort_dir:"asc",max_api_results:100};var i="workspaces_on";var a="[data-workspace-list-container]";var s="[data-workspace-empty-state]";var o=false;var l;var u;var d;var c;var m;var f;var p=function e(t){switch(t){case"your-workspaces":case"your-teams":case"workspaces_on":case"teams_on":return"user";case"find-workspaces":case"find-teams":case"workspaces_not_on":case"teams_not_on":default:return"all"}};var h=function e(t){i=t};var g=function e(i){var a=$(i.target).scrollTop();var s=r-a;if(s<=t&&a>0)y(n)};var S=function e(t){var r=t.target.value;var i=_.assign({},n.additional_args,{search:r});var a=_.assign({},n,{additional_args:i});y(a)};var T=function e(t,r){var n=t.target.value;var a=TS.enterprise.workspaces.getList(r,"",n);w(i,a,n)};var v=function e(t){r=$(t).find(".list_items").height()};var b=function e(t,r){$(t).longListView("setItems",r,true);$(t).longListView("resizeImmediately");v(t)};var y=function e(t,r){n=TS.enterprise.workspaces.buildWorkspaceSearcher(n,t);return TS.enterprise.workspaces.promiseToSearchWorkspaces(n).then(function(e){var t=i||"workspaces_on";var n="name";var a="";var s=TS.boot_data.signout_url;var o=TS.enterprise.workspaces.getList(t,n,a,void 0,e.items);o=o.map(function(e){if(e.lfs_id)return e;var t=TS.enterprise.workspaces.createURL(e,s);e.launch_url=t+"messages";e.site_url=t+"home";e.signout_url=TS.enterprise.workspaces.createLogoutURL(e.id,s);e.lfs_id=String(e.id);return e});if(TS.boot_data.feature_invite_only_workspaces)if(r){l.addClass("hidden");u.addClass("hidden");d.addClass("hidden").attr("disabled","disabled");c.removeClass("hidden").attr("data-team-id",r)}else{w(t,o);u.removeClass("hidden");d.removeClass("hidden").removeAttr("disabled");c.addClass("hidden").attr("data-team-id","")}})};var w=function e(t,r,i){if(r.length){x(s,a);b(a,r)}else{var o=i||_.get(n,"additional_args.search",false);k(t,s,a,o)}m.addClass("hidden");f.addClass("hidden")};var k=function e(t,r,n,i){var a="";if(i)a=TS.templates.no_workspace_results();else if("teams_on"===t||"workspaces_on"===t)a=TS.templates.not_on_any_workspaces();else a=TS.templates.no_workspaces_to_join();$(n).addClass("hidden");$(r).html(a).removeClass("hidden");$(r).on("click",".find_teams",function(e){e.preventDefault();M("find-workspaces",true)})};var x=function e(t,r){$(t).html("").addClass("hidden");$(r).removeClass("hidden");$(t).off()};var C=function e(t,r,a){var s=t.parents();var l=s.find('[data-qa="teams_search"]');var u=s.find(".workspace_info");var d=s.find(".more_teams_available");var c=s.find(".title_bar");if(!TS.boot_data.feature_invite_only_workspaces){var f=$(".sort_by_container");var p=f.find('select[data-qa="sort-by-your"]');var h=f.find('select[data-qa="sort-by-find"]')}var v=$(window);t.off();l.off();u.off();d.off();if(!TS.boot_data.feature_invite_only_workspaces){p.off();h.off()}v.off("scroll.workspaces");var b=function e(r){return TS.enterprise.workspaces.joinTeam(r).then(function(e){if(e){var n=_.merge({},TS.model.user);n.enterprise_user.teams=_.uniq(n.enterprise_user.teams.concat(r));if("web"===TS.boot_data.app)TS.model.user=n;else TS.members.upsertMember(n);var i=TS.teams.getTeamById(r);t.find('[data-id="'+r+'"]').html(TS.enterprise.workspaces.getTeamCardHTML(i,a))}return e})};l.on("input",function(n){var s=$("#ws_request_create_link");if(TS.boot_data.feature_invite_only_workspaces){m.removeClass("hidden");if("workspaces_not_on"===i)S(n);else T(n,i);s=$("#ws_request_create_link");if(n.target.value.length)s.removeClass("hidden");else s.addClass("hidden")}else{var o=$(this).val();var l;if("teams_on"===r||"workspaces_on"===r)l=p.val();else l=h.val();var u=TS.enterprise.workspaces.getList(r,l,o);var d="";if(u.length)u.forEach(function(e){d+=TS.enterprise.workspaces.getTeamCardHTML(e,a,true)});else d+=TS.templates.no_workspace_results();s=$("#ws_request_create_link");if(o.length)s.removeClass("hidden");else s.addClass("hidden");t.html(d).attr("data-list",r);e(t,r,a)}});d.on("click",'[data-qa="find-more-teams"]',function(e){e.preventDefault();$('.enterprise_memberdash_header .menu_item_teams[data-qa="find-teams"]').click()});var y=function n(){var i=$(this).val();var s=l.val();var o=TS.enterprise.workspaces.getList(r,i,s);var u="";if(o.length)o.forEach(function(e){u+=TS.enterprise.workspaces.getTeamCardHTML(e,a,true)});else if("teams_on"===r||"workspaces_on"===r)u+=TS.templates.not_on_any_workspaces();else u+=TS.templates.no_workspaces_to_join();t.html(u).attr("data-list",r);e(t,r,a)};if(!TS.boot_data.feature_invite_only_workspaces){p.on("change",y);h.on("change",y)}var w=function e(n,i){if("string"!==typeof n)n=$(this).data("id");o=true;t.addClass("hidden");c.addClass("hidden");d.addClass("hidden");l.addClass("hidden").attr("disabled","disabled");u.html(TS.templates.team_info({list:r})).removeClass("hidden").attr("data-team-id",n);if(!i){var s=$("title").text();var _="workspaces_not_on"===r?"find-workspaces":"your-workspaces";window.history.pushState(n,s,"/signin/"+_+"/"+n)}var m={top_combined_channels:5,include_admins:true};var f=[];if(!TS.client)f.push(TS.api.call("users.info",{user:TS.boot_data.user_id,_x_reason:"enterprise_workspaces"}).then(function(e){TS.model.user=e.data.user}));f.push(TS.redux.teams.ensureEnterpriseTeamIsKnown(n,m));return Promise.all(f).then(function(){var e=TS.teams.getTeamById(n);if(!e){u.attr("data-team-id","");return}var i=TS.enterprise.workspaces.createURL(e,a);e.launch_url=i+"messages";e.site_url=i+"home";u.html(TS.templates.team_info({list:r,team:e,user:TS.model.user})).attr("data-team-id",n);t.find('[data-id="'+e.id+'"]').html(TS.enterprise.workspaces.getTeamCardHTML(e,a));var s;var o;if("teams_on"===r||"workspaces_on"===r){s="your_workspaces";o="your_workspaces_list"}else{s="find_workspaces";o="workspaces_you_can_join_list"}TS.enterprise.workspaces.recordTeamView(e.id,s,o)})};t.on("click",".enterprise_team_card",w);u.on("click",".back_to_teams",function(e){e.preventDefault();window.history.back();if(TS.boot_data.feature_invite_only_workspaces)TS.enterprise.workspaces.getWorkspaces(i);else{t.removeClass("hidden");c.removeClass("hidden");l.removeClass("hidden").removeAttr("disabled");u.addClass("hidden").attr("data-team-id","")}if("yes"===d.attr("data-has-more"))d.removeClass("hidden")});var k=function e(r){var n=r.originalEvent.state;if(n&&"T"===n[0]&&9===n.length){var i=true;w(n,i)}else if(TS.boot_data.feature_invite_only_workspaces)M(n,false);else{t.removeClass("hidden");c.removeClass("hidden");l.removeClass("hidden").removeAttr("disabled");u.addClass("hidden").attr("data-team-id","");if("yes"===d.attr("data-has-more"))d.removeClass("hidden")}};$(window).on("popstate",k);u.on("click",'button[data-qa="join-btn"]',function(){var e=Ladda.create(this);e.start();var t=$(this).data("id");var n=TS.teams.getTeamById(t);b(t).then(function(t){e.stop();if(t){var i=TS.enterprise.workspaces.createURL(n,a);n.launch_url=i+"messages";n.site_url=i+"home";u.html(TS.templates.team_info({list:r,team:n,user:TS.model.user}));var s;var o="workspace_detail";if("teams_on"===r||"workspaces_on"===r)s="your_workspaces";else s="find_workspaces";TS.enterprise.workspaces.recordTeamJoin(n.id,s,o)}return t})});u.on("click",'[data-qa="leave-btn"]',function(e){e.preventDefault();var t=$(this).data("id");TS.ui.leave_team_dialog.start(t)});u.on("click",'button[data-qa="request-to-join-btn"]',function(e){e.preventDefault();var n=Ladda.create(this);n.start();var i=$(this).data("id");TS.enterprise.workspaces.requestToJoinTeam(i).then(function(){var e=TS.teams.getTeamById(i);t.find('[data-id="'+i+'"]').html(TS.enterprise.workspaces.getTeamCardHTML(e,a));n.stop();var s=TS.enterprise.workspaces.createURL(e,a);e.launch_url=s+"messages";e.site_url=s+"home";u.html(TS.templates.team_info({list:r,team:e,user:TS.model.user}));var o;var l="workspace_detail";if("teams_on"===r||"workspaces_on"===r)o="your_workspaces";else o="find_workspaces";TS.enterprise.workspaces.recordTeamRequestToJoin(e.id,o,l)}).catch(function(){n.stop()})});t.on("click",".enterprise_team_card a",function(e){e.stopPropagation()});var x=function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";var n=$(t.target).data("id");if(TS.model.is_our_app){t.preventDefault();t.stopPropagation();var a=_.map(TS.model.user.enterprise_user.teams,function(e){var t=TS.teams.getTeamById(e);return{name:TS.model.user.name,id:TS.model.user.id,team_id:t.id,team_name:t.name,team_url:TS.utility.enterprise.buildTeamUrl(t.domain)}}).sort(function(e,t){if(e.id===n)return-1;if(t.id===n)return 1;if(e.team_name<t.team_name)return-1;if(e.team_name>t.team_name)return 1;return 0});var s=true;TSSSB.call("didSignIn",a,s)}var o="workspaces_on"===i?"your_workspaces":"find_workspaces";TS.enterprise.workspaces.recordTeamLaunch(n,o,r)};t.on("click",".enterprise_team_card [data-name=launch_team_button]",function(e){return x(e,"workspaces_list")});u.on("click","[data-name=launch_team_button]",function(e){return x(e,"workspace_detail")});t.on("click",".enterprise_team_card .enterprise_team_menu",function(e){e.stopPropagation();var t=$(this).val();var n=$(this).data("id");var i=TS.teams.getTeamById(n);TS.menu.enterprise_team_signin.start(e,$(this),{list:r,team_id:n,team_site_url:t,should_show_leave_team:TS.permissions.enterprise.canUserLeaveTeam(TS.model.user,i)})});t.on("click",".enterprise_team_card .enterprise_team_join",function(e){e.stopPropagation();var t=Ladda.create(this);t.start();var n=$(this).data("id");b(n).then(function(e){t.stop();if(e){var i;var a;if("teams_on"===r||"workspaces_on"===r){i="your_workspaces";a="your_workspaces_list"}else{i="find_workspaces";a="workspaces_you_can_join_list"}TS.enterprise.workspaces.recordTeamJoin(n,i,a)}})});t.on("click",".enterprise_team_card .enterprise_team_request",function(e){e.stopPropagation();var r=Ladda.create(this);r.start();var n=$(this).data("id");TS.enterprise.workspaces.requestToJoinTeam(n).then(function(){var e=TS.teams.getTeamById(n);r.stop();t.find('[data-id="'+n+'"]').html(TS.enterprise.workspaces.getTeamCardHTML(e,a))}).catch(function(){r.stop()})});if(!TS.boot_data.feature_invite_only_workspaces)t.find(".not_on_any_workspaces").on("click",".find_teams",function(e){e.preventDefault();TS.enterprise.member_header.setPage("teams_not_on");TS.enterprise.signin.loadPage("teams_not_on")});v.on("scroll.workspaces",_.debounce(function(e){if(n.num_remaining>0&&!o)g(e)},60))};var M=function e(t,r){var n="find-workspaces"===t?"workspaces_not_on":"workspaces_on";TS.enterprise.member_header.setPage(n);TS.enterprise.signin.loadPage(n);h(n);if(r){var i=$("title").text();window.history.pushState(t,i,"/signin/"+t)}};var I=function e(t,r){TS.ui.toast.show({type:t,message:r})}})()},4816:function(e,t){(function(){TS.registerModule("help",{issues_sorted_sig:new signals.Signal,issues:[],more_url:null,fake_api_rsps:false,max_title_chars:100,onStart:function e(){if(!TS.client)return;TS.redux.socket.connectedSig.addOnce(function(){TS.api.call("help.issues.list",{}).then(function(e){var t=e.data,r=e.args,n=e.request_id;var i=true;if(TS.help.onListIssues)TS.help.onListIssues(i,t,r,n);return{data:t,args:r,request_id:n}}).catch(function(e){var t=e.data,r=e.args,n=e.request_id;var i=false;if(TS.help.onListIssues)TS.help.onListIssues(i,t,r,n);return{data:t,args:r,request_id:n}})})},getIssueById:function e(t){var r;for(var n=0;n<TS.help.issues.length;n+=1){r=TS.help.issues[n];if(r.id==t)return r}return null},onListIssues:function e(t,r){if(TS.help.fake_api_rsps){TS.help.more_url="/help";TS.help.issues=[{id:"T00001",title:"issue 1",ts:"1111111111",short_text:"blah blah blah blah blah",state:"resolved"},{id:"T00002",title:"issue 2",ts:"1141111111",short_text:"I think this is ok",state:"open"},{id:"T00003",title:"issue 3",ts:"1121111111",short_text:"but I am not so sure abotu this",state:"unread"},{id:"T00004",title:"issue 4",ts:"1161111111",short_text:"what about that?",state:"open"},{id:"T00005",title:"issue 5",ts:"1151111111",short_text:"fuck it all to hell",state:"open"},{id:"T00006",title:"issue 6",ts:"1171111111",short_text:"MORE BATTRY PLZ",state:"read"},{id:"T00007",title:"issue 7",ts:"1191111111",short_text:"halp",state:"unread"},{id:"T00008",title:"issue 8",ts:"191111111",short_text:"halp",state:"unread"},{id:"T00009",title:"issue 9",ts:"181111111",short_text:"halp",state:"unread"},{id:"T000010",title:"issue 10",ts:"171111111",short_text:"halp halp halp halp halp halp halp halp halp halp ...",state:"unread"}]}else if(t)TS.help.issues=r.issues;TS.help.sortIssues();TS.help.updateIcon()},sortIssues:function e(){var t={unread:4,open:3,read:2,resolved:1};var r;for(var n=0;n<TS.help.issues.length;n+=1){r=TS.help.issues[n];r._sorter=parseFloat((t[r.state]||5)+"."+r.ts)}TS.help.issues.sort(function e(t,r){if(t._sorter<r._sorter)return 1;if(t._sorter>r._sorter)return-1;return 0});TS.help.issues_sorted_sig.dispatch()},updateIcon:function e(){var t="normal";var r=0;var n;for(var i=0;i<TS.help.issues.length;i+=1){n=TS.help.issues[i];if("unread"===n.state){t="unread";r+=1}}$("#flex_menu_toggle").removeClass("normal open unread").addClass(t);$("#help_icon_circle_count, .help_icon_circle_count").addClass("hidden");if(r>9)r="9+";if(r)$("#help_icon_circle_count, .help_icon_circle_count").removeClass("hidden").text(r)},createIssue:function e(t,r){var n=t.title;var i=t.text;if(!n)return;i=i||"";var a={title:n,text:i};if(t.tags)a.tags=t.tags;var s=function e(t,a){if(!t&&TS.help.fake_api_rsps){var s={id:Date.now(),title:n,ts:Date.now()/1e3,short_text:i.substr(0,50),state:"open"};setTimeout(function(){TS.redux.dispatch(TS.interop.redux.features.socket.socketMessageReceived({type:"issue_created",issue:s}))},2e3)}if(r)r(t,TS.help.makeErrStr(a))};TS.api.call("help.issues.create",a).then(function(e){var t=e.data,r=e.args,n=e.request_id;var i=true;s(i,t,r,n);return{data:t,args:r,request_id:n}}).catch(function(e){var t=e.data,r=e.args,n=e.request_id;var i=false;s(i,t,r,n);return{data:t,args:r,request_id:n}})},fetchIssueDetails:function e(t,r){var n=TS.help.getIssueById(t);if(!n){if(r)r(false,n,"unknown issue");return}var i=function e(t,i){var a;if(TS.help.fake_api_rsps){t=true;a=_.cloneDeep(n);a.comments=[{ts:112211111,from:"eeric",text:"comment 1"},{ts:112214444,from:"whoop",text:"comment 2"}]}else if(t)a=i.issue;TS.help.onIssueChange(a);if(r)r(t,n,TS.help.makeErrStr(i))};TS.api.call("help.issues.info",{id:t}).then(function(e){var t=e.data,r=e.args,n=e.request_id;var a=true;i(a,t,r,n);return{data:t,args:r,request_id:n}}).catch(function(e){var t=e.data,r=e.args,n=e.request_id;var a=false;i(a,t,r,n);return{data:t,args:r,request_id:n}})},markIssueRead:function e(t,r){var n=TS.help.getIssueById(t);if(!n){if(r)r(false,"unknown issue");return}if("unread"!==n.state){if(r)r(true);return}var i=function e(t,i){if(!t&&TS.help.fake_api_rsps){var a=_.cloneDeep(n);a.state="read";setTimeout(function(){TS.redux.dispatch(TS.interop.redux.features.socket.socketMessageReceived({type:"issue_change",issue:a}))},2e3)}if(r)r(t,TS.help.makeErrStr(i))};TS.api.call("help.issues.markRead",{id:t}).then(function(e){var t=e.data,r=e.args,n=e.request_id;var a=true;i(a,t,r,n);return{data:t,args:r,request_id:n}}).catch(function(e){var t=e.data,r=e.args,n=e.request_id;var a=false;i(a,t,r,n);return{data:t,args:r,request_id:n}})},replyToIssue:function e(t,r,n){var i=function e(t,r){if(n)n(t,TS.help.makeErrStr(r),r&&r.error?r.error:"")};TS.api.call("help.issues.replyTo",{id:t,text:r}).then(function(e){var t=e.data,r=e.args,n=e.request_id;var a=true;i(a,t,r,n);return{data:t,args:r,request_id:n}}).catch(function(e){var t=e.data,r=e.args,n=e.request_id;var a=false;i(a,t,r,n);return{data:t,args:r,request_id:n}})},markIssueResolved:function e(t,r){var n=TS.help.getIssueById(t);if(!n){if(r)r(false,"unknown issue");return}var i=function e(t,i){if(TS.help.fake_api_rsps||!t&&i&&"ticket_closed"===i.error){t=true;var a=_.cloneDeep(n);a.state="resolved";setTimeout(function(){TS.redux.dispatch(TS.interop.redux.features.socket.socketMessageReceived({type:"issue_change",issue:a}))},1e3)}if(r)r(t,TS.help.makeErrStr(i))};TS.api.call("help.issues.markResolved",{id:t}).then(function(e){var t=e.data,r=e.args,n=e.request_id;var a=true;i(a,t,r,n);return{data:t,args:r,request_id:n}}).catch(function(e){var t=e.data,r=e.args,n=e.request_id;var a=false;i(a,t,r,n);return{data:t,args:r,request_id:n}})},onIssueChange:function e(t){var r=TS.help.getIssueById(t.id);if(r)TS.help.updateIssue(t,r);else TS.help.issues.push(t);TS.help.sortIssues();TS.help.updateIcon()},updateIssue:function e(t,r){_.forOwn(t,function(e,t){r[t]=e});if(r.comments)r.comments.sort(function e(t,r){if(t.ts<r.ts)return 1;if(t.ts>r.ts)return-1;return 0})},makeErrStr:function e(t){if(!t)return"missing data";if(t.ok)return null;if(t.error&&t.info&&TS.boot_data.feature_tinyspeck)try{return'api error: "'+t.error+'"<br><br><div class="admin-section" style="word-wrap: break-word; word-break: break-word;">api rsp: '+JSON.stringify(t).replace(/,/g,", ")+"</div>"}catch(e){}if(t.error)return'api error: "'+t.error+'"'}})})()},4817:function(e,t){(function(){TS.registerModule("ui.share_dialog",{div:null,showing:false,delegate:void 0,onStart:function e(){TS.files.team_file_changed_sig.add(n);TS.files.team_file_comment_added_sig.add(i);TS.files.team_file_comment_deleted_sig.add(i)},onKeydown:function e(t){if(!TS.ui.share_dialog.showing)return;if(t.which==TS.utility.keymap.enter){if("BODY"===TS.utility.getActiveElementProp("NODENAME")){TS.ui.share_dialog.go();t.preventDefault()}}else if(t.which==TS.utility.keymap.esc)if("BODY"===TS.utility.getActiveElementProp("NODENAME"))TS.ui.share_dialog.cancel()},start:function e(n,i,a,s,o,l){if(TS.client&&TS.client.ui.checkForEditing())return;r=false;t=n;var u=TS.files.getFileById(n);var d="file";if("post"===u.mode)d="file_post";else if("space"===u.mode)d="file_space";else if("snippet"===u.mode)d="file_snippet";else if("arugula"===u.mode)d="file_arugula";var _=TS.templates.builders.buildFileSharingControls(u,true,null,a);var c=i?"":TS.templates.builders.fileHTML(u,{for_share_dialog:true});var m={type:d,item:u,item_owner:TS.members.getMemberById(u.user),sharing_html:new Handlebars.SafeString(_),file_html:new Handlebars.SafeString(c),show_copy_link:u.permalink&&TS.clipboard.canWriteText()};m.icon_class=TS.utility.getImageIconClass(u,"thumb_80");if(!TS.ui.share_dialog.div)TS.ui.share_dialog.build();var f=TS.templates.share_dialog(m);f=TS.format.replaceHighlightMarkers(f);var p=TS.ui.share_dialog.div;p.html(f);var h=$("#file_comment_textarea");TS.ui.comments.bindInput(h,TS.ui.share_dialog.go);if(o)TS.utility.contenteditable.value(h,o);h=null;p.modal("show");p.find(".dialog_cancel").click(TS.ui.share_dialog.cancel);p.find(".dialog_go").click(TS.ui.share_dialog.go);TS.ui.file_share.bindFileShareDropdowns(false,TS.utility.members.getEntityFromFile(u),{id:s},void 0,l);TS.ui.file_share.bindFileShareShareToggle();TS.ui.file_share.bindFileShareCommentField()},go:function e(){if(r){TS.info("TS.ui.share_dialog stopping because already sharing");return}if(!TS.ui.share_dialog.showing){TS.error("not showing?");return}var n=$("#select_share_channels").lazyFilterSelect("value")[0];var i=_.trim(TS.utility.contenteditable.value($("#file_comment_textarea")));i=TS.utility.contenteditable.synchronouslyReplacePotentialMentions(i,{complete_member_specials:false});i=TS.format.cleanMsg(i);var a=n?n.model_ob||{}:{};if(TS.interop.utility.looksLikeMemberId(a.id))a=TS.ims.getImByMemberId(a.id)||a;if(TS.shared.isModelObShared(a))i="";var s=function e(){TS.shared.getShareModelObId(u,function(e){var r=false;TS.files.shareFile(t,e,i,r).then(function(){t=null;if(!TS.client)return;var r=TS.shared.getModelObById(e);if(!r)return;var n=TS.shared.getActiveModelOb();if(n&&n.id===r.id){if(!TS.useReactMessages())TS.client.ui.instaScrollMsgsToBottom()}else return TS.client.displayModelOb(r)})})};if(n&&n.model_ob&&n.model_ob.create_channel){var o=t;TS.ui.new_channel_modal.start(n.model_ob.name).then(function(e){t=o;u=e.id;s();return null}).catch(function(){TS.ui.share_dialog.start(o,false,false,false,i);return null});TS.ui.share_dialog.cancel();return false}if(!TS.shared.isModelObShared(a))if(TS.ui.file_share.shouldBlockUploadDialogSubmission())return;var l=$("#share_dialog");var u=l.find("#share_model_ob_id").val();if(!u)if(n)u=n.model_ob.id;if(!u){TS.warn("model_ob_id is not set! "+$("#select_share_channels").val());return}if(TS.ui.share_dialog.delegate&&"function"===typeof TS.ui.share_dialog.delegate.submit)TS.ui.share_dialog.delegate.submit(l,s);else s();r=true;TS.ui.share_dialog.div.modal("hide")},cancel:function e(){t=null;TS.ui.share_dialog.div.modal("hide")},end:function t(){if(e&&e.detachEvents)e.detachEvents();e=null;TS.model.dialog_is_showing=false;TS.ui.share_dialog.showing=false;TS.ui.share_dialog.div.empty();$(window.document).unbind("keydown",TS.ui.share_dialog.onKeydown)},build:function t(){$("body").append('<div id="share_dialog" class="modal hide fade"></div>');TS.ui.share_dialog.div=$("#share_dialog");var r=TS.ui.share_dialog.div;r.on("hidden",function(e){if(e.target!=this)return;TS.ui.share_dialog.end()});r.on("show",function(e){if(e.target!=this)return;TS.model.dialog_is_showing=true;TS.ui.share_dialog.showing=true});r.on("shown",function(t){if(t.target!=this)return;var r=$("#select_share_channels").lazyFilterSelect("value");if(r.length<1)$("#select_share_channels").lazyFilterSelect("getInstance").$input.focus();else TS.utility.contenteditable.focus($("#file_comment_textarea"));$(window.document).bind("keydown",TS.ui.share_dialog.onKeydown);e=TS.ui.share_dialog.div.find("img.lazy").lazyload()})}});var e=null;var t;var r=false;var n=function e(r){if(TS.ui.share_dialog.showing&&t===r.id){a(r);s(r)}};var i=function e(r){if(TS.ui.share_dialog.showing&&t===r.id)s(r)};var a=function e(t){TS.templates.builders.updateFileShareLabels(t);$("#select_share_at_channel_list").html(TS.templates.builders.makeFileCommentHelpHTML(t))};var s=function e(t){var r=TS.templates.makeFileDomId(t);$("#"+r).replaceWith(TS.templates.builders.fileHTML(t,{for_share_dialog:true}));var n=$("#"+r).find("img.lazy");n.removeClass("lazy").attr("src",n.attr("data-original"))}})()},4818:function(e,t){var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)if(Object.prototype.hasOwnProperty.call(r,n))e[n]=r[n]}return e};(function(){TS.registerModule("pins",{pins_fetched_sig:new signals.Signal,pinned_status_changed_sig:new signals.Signal,pinned_message_changed_sig:new signals.Signal,pinned_message_deleted_sig:new signals.Signal,onStart:function e(){TS.files.team_file_comment_deleted_sig.add(p);TS.files.team_file_deleted_sig.add(h);TS.redux.socket.connectedSig.add(g);TS.channels.left_sig.add(S);TS.groups.left_sig.add(S)},fetchPins:function r(n){if(!n)return;t[n.id]=true;if(TS.isPartiallyBooted())return new Promise(function(e){TS.redux.socket.connectedSig.addOnce(function(){e(TS.pins.fetchPins(n))})});return TS.api.call("pins.list",{channel:n.id}).then(function(t){var r=t.data.items;TS.pins.upsertPinnedItems(r);n.pinned_items=r;n.pinned_items_count=r.length;n.has_pins=!!n.pinned_items_count;if(!n.is_channel||n.is_member)e[n.id]=true;TS.pins.pins_fetched_sig.dispatch(n,r)}).catch(function(e){TS.logError("Failed to fetch pins for model ob: "+n.id,e)}).finally(function(){delete t[n.id]})},arePinsCurrentlyBeingFetched:function e(r){return!!t[r.id]},havePinsBeenFetched:function t(r){return!!e[r.id]},startPinFile:function e(t,r){var n=TS.files.getFileById(t);if(!n)return;u("file",r,{file:n,type:"file"})},unPinFile:function e(t,r){var n=i(t,r);if(!n)return;var a={file:n,type:"file"};f(a,r,function(){c(r,a)})},startPinFileComment:function e(t,r,n){var i=TS.files.getFileById(r);if(!i)return;var a=TS.files.getFileCommentById(i,t);if(!a)return;u("comment",n,{file:i,comment:a,type:"file_comment"})},unPinFileComment:function e(t,r,n){var i=a(t,r,n);var s=TS.files.getFileById(r);if(!i||!s)return;var o={file:s,comment:i,type:"file_comment"};f(o,n,function(){c(n,o)})},startPinMessage:function e(t,r){t=t.toString();var n=TS.utility.msgs.findMsg(t,r.id);if(n)if("file_comment"===n.subtype)TS.pins.startPinFileComment(n.comment.id,n.file.id||n.file,r);else if(n.file)TS.pins.startPinFile(n.file.id||n.file,r);else u("message",r,{message:n,type:"message"})},unPinMessage:function e(t,r){t=t.toString();var n=s(t,r);if(n)if("file_comment"===n.subtype)TS.pins.unPinFileComment(n.comment.id,n.file.id||n.file,r);else if(n.file)TS.pins.unPinFile(n.file.id||n.file,r);else{var i={message:n,type:"message"};f(i,r,function(){c(r,i)})}},isMessagePinned:function e(t,r){if("file_comment"===t.subtype){if(!t.comment)return false;return!!a(t.comment.id,t.file.id||t.file,r)}else if(t.file)return!!i(t.file.id||t.file,r);return!!s(t.ts,r)},pinStatusHasChanged:function e(t,n,i,a,s){var u;var d;var _;var c;var m;var f;if("message"===i&&a){u=TS.utility.msgs.findMsg(n.message.ts,a.id);if(u){n.message=u;c=o(t,u,a)}}else if("file_comment"===i){f=TS.files.upsertFile(n.file);d=TS.files.getFileById(n.file.id);n.file=d;_=TS.files.getFileCommentById(d,n.comment.id);if(_){n.comment=_;c=o(t,_,a)}else{_=TS.files.addCommentToFile(n.comment,d);n.comment=_}c=c||"CHANGED"===f.status}else if("file"===i){f=TS.files.upsertFile(n.file);d=TS.files.getFileById(n.file.id);n.file=d;c=o(t,d,a);c=c||"CHANGED"===f.status}m=l(t,n,i,a,s);if(c||m)TS.pins.pinned_status_changed_sig.dispatch(a,n,t);if(TS.useReactMessages())if(c&&"message"===i){u=r({},u);TS.redux.messages.replaceMessage(u)}},upsertPinnedItems:function e(t){t.forEach(function(e){if("file"===e.type){TS.files.upsertFile(e.file);e.file=TS.files.getFileById(e.file.id)}else if("file_comment"===e.type){TS.files.upsertFile(e.file);e.file=TS.files.getFileById(e.file.id);var t=TS.files.getFileCommentById(e.file,e.comment.id);if(!t)t=TS.files.addCommentToFile(e.comment,e.file);e.comment=t}})},replaceMsg:function e(t,r){if(!r.pinned_items)return;r.pinned_items.forEach(function(e){if("message"===e.type&&e.message.ts===t.ts){e.message=t;TS.pins.pinned_message_changed_sig.dispatch(r,e)}})},removeMsg:function e(t,r){if(!r.pinned_items)return;l(false,{message:{ts:t}},"message",r);TS.pins.pinned_message_deleted_sig.dispatch(r)},canUserPinHere:function e(t){if(!TS.client||!t)return false;if(!TS.permissions.members.canPostInChannel(t))return false;if(t.is_channel&&!t.is_member)return false;return true},updateCount:function e(t,r){if(!t)return;var n=t.pinned_items_count;t.pinned_items_count=TS.pins.havePinsBeenFetched(t)?_.get(t,"pinned_items.length"):r;if(n===t.pinned_items_count)return;t.has_pins=!!t.pinned_items_count;TS.pins.pinned_status_changed_sig.dispatch(t)},getPinData:function e(t){var r;var n=TS.shared.getActiveModelOb().pinned_items;if(_.isEmpty(n))return;_.forEach(n,function(e){if("file"===e.type&&("file_share"===t.subtype||"file_mention"===t.subtype)){if(t.file.id===e.file.id){r=e;return false}}else if("file_comment"===e.type&&"file_comment"===t.subtype){if(t.comment.id===e.comment.id){r=e;return false}}else if("message"===e.type)if(t.ts===e.message.ts){r=e;return false}});if(!r)return;var i={created:r.created,created_by:r.created_by};return i},getUnreadPins:function e(t){var r;var n=[];if(!t)return n;var i=t._marked_reason;if("0000000000.000000"===t.last_read&&"back"!==i)return n;if(TS.model.ui.is_window_focused)if("back"===i){var a=TS.utility.msgs.getDisplayedMsgAfterTS(t.last_read,t.msgs);if(a)r=parseFloat(a.ts)-1;else r=t.last_read}else if(t._prev_last_read&&(!i||"viewed"===i))r=t._prev_last_read;else r=t.last_read;else r=t.last_read;var s=t.pinned_items;if(_.isEmpty(s))return n;_.forEach(s,function(e){var t=TS.members.getMemberById(e.created_by);if(!t)return;if(e.created>Math.ceil(r))if(t.is_self&&"back"===i)n.push(e);else if(!t.is_self)n.push(e)});return n},test:function t(){return{fileDeleted:h,fileCommentDeleted:p,have_pins_been_fetched:e}}});var e={};var t={};var n=false;var i=function e(t,r){var n=TS.files.getFileById(t);if(!n||!n.pinned_to)return null;var i=-1!==n.pinned_to.indexOf(r.id);return i?n:null};var a=function e(t,r,n){var i=TS.files.getFileById(r);if(!i)return null;var a=TS.files.getFileCommentById(i,t);if(!a||!a.pinned_to)return null;var s=-1!==a.pinned_to.indexOf(n.id);return s?a:null};var s=function e(t,r){if(r.pinned_items){var n;for(var s=0;s<r.pinned_items.length;s+=1){n=r.pinned_items[s];if("message"===n.type&&n.message.ts===t)return n.message}}var o=TS.utility.msgs.findMsg(t,r.id);if(!o)return null;if("file_comment"===o.subtype){if(a(o.comment.id,o.file.id||o.file,r))return o}else if(o.file){if(i(o.file.id||o.file,r))return o}else if(o.pinned_to&&-1!==o.pinned_to.indexOf(r.id))return o;return null};var o=function e(t,r,n){var i=false;if(!r.pinned_to)r.pinned_to=[];if(t){if(-1===r.pinned_to.indexOf(n.id)){r.pinned_to.push(n.id);i=true}}else{var a=r.pinned_to.indexOf(n.id);if(-1!==a){r.pinned_to.splice(a,1);i=true}}return i};var l=function e(t,r,n,i,a){var s=false;if(!i.pinned_items)i.pinned_items=[];var o=-1;i.pinned_items.some(function(e,t){var i=false;if("message"===n&&"message"===e.type){if(e.message.ts===r.message.ts)i=true}else if("file"===n&&"file"===e.type){if(e.file.id===r.file.id)i=true}else if("file_comment"===n&&"file_comment"===e.type)if(e.comment.id===r.comment.id)i=true;if(i)o=t;return i});if(!TS.pins.havePinsBeenFetched(i)){i.pinned_items_count=i.pinned_items_count||0;var l=_.parseInt(a,10);if(!_.isNaN(l))i.pinned_items_count=l;else if(t)i.pinned_items_count+=1;else if(!t)i.pinned_items_count=Math.max(i.pinned_items_count-1,0);s=true}else if(!t&&-1!==o){i.pinned_items.splice(o,1);i.pinned_items_count=i.pinned_items.length;s=true}else if(t&&-1===o){i.pinned_items.unshift(r);i.pinned_items_count=i.pinned_items.length;s=true}i.has_pins=!!i.pinned_items_count;return s};var u=function e(t,r,n){var i="";var a="";var s="";switch(t){case"file":i=TS.i18n.t("Are you sure you want to pin this file to {pin_to_label}?","pins")({type:t,pin_to_label:Handlebars.helpers.pinToLabel(r)});a=TS.i18n.t("Pin file","pins")();s=TS.i18n.t("Yes, pin this file","pins")();break;case"comment":i=TS.i18n.t("Are you sure you want to pin this comment to {pin_to_label}?","pins")({type:t,pin_to_label:Handlebars.helpers.pinToLabel(r)});a=TS.i18n.t("Pin comment","pins")();s=TS.i18n.t("Yes, pin this comment","pins")();break;case"message":i=TS.i18n.t("Are you sure you want to pin this message to {pin_to_label}?","pins")({type:t,pin_to_label:Handlebars.helpers.pinToLabel(r)});a=TS.i18n.t("Pin message","pins")();s=TS.i18n.t("Yes, pin this message","pins")()}var o="<p>"+i+"</p>"+TS.client.channel_page.pinnedItemHtml(n,r);TS.generic_dialog.start({title:a,body:o,go_button_text:s,onGo:function e(){d(r,n)}})};var d=function e(t,r){var n=m(t,r);var i=TS.interop.datetime.makeTsStamp(null,{padder:"0"});var a=function e(n,a){if(!n){if("too_many_pins"===a.error){var s="message";if("file"===r.type)s="file";if("file_comment"===r.type)s="comment";TS.generic_dialog.start({title:TS.i18n.t("Couldn’t pin {type}","pins")({type:s}),body:"<p>"+TS.i18n.t("Sorry! You’ve hit the limit on how many pins you can have in this channel.","pins")()+"</p>",show_cancel_button:false})}else TS.info("pins.add got a not ok rsp: "+a.error);if("already_pinned"!==a.error)return}if(!TS.pins.havePinsBeenFetched(t))return;r.created=i;r.created_by=TS.boot_data.user_id;TS.pins.pinStatusHasChanged(true,r,r.type,t)};TS.api.call("pins.add",n).then(function(e){var t=e.data,r=e.args,n=e.request_id;var i=true;a(i,t,r,n);return{data:t,args:r,request_id:n}}).catch(function(e){var t=e.data,r=e.args,n=e.request_id;var i=false;a(i,t,r,n);return{data:t,args:r,request_id:n}})};var c=function e(t,r){var n=m(t,r);var i=function e(n,i){if(!n)if("not_pinned"!==i.error)return;if(!TS.pins.havePinsBeenFetched(t))return;TS.pins.pinStatusHasChanged(false,r,r.type,t)};TS.api.call("pins.remove",n).then(function(e){var t=e.data,r=e.args,n=e.request_id;var a=true;i(a,t,r,n);return{data:t,args:r,request_id:n}}).catch(function(e){var t=e.data,r=e.args,n=e.request_id;var a=false;i(a,t,r,n);return{data:t,args:r,request_id:n}})};var m=function e(t,r){var n={channel:t.id};if("message"===r.type)n.timestamp=r.message.ts;else if("file"===r.type)n.file=r.file.id;else if("file_comment"===r.type)n.file_comment=r.comment.id;return n};var f=function e(t,r,n){TS.client.channel_page.highlightPinnedItemForRemoval(t);var i=TS.client.channel_page.pinnedItemHtml(t,r);TS.generic_dialog.start({title:TS.i18n.t("Remove Pinned Item","pins")(),body:"<p>"+TS.i18n.t("Are you sure you want to remove this pinned item?","pins")()+"</p>"+i,go_button_text:TS.i18n.t("Yes, remove this pinned item","pins")(),onGo:n,onCancel:function e(){TS.client.channel_page.unHighlightPinnedItemForRemoval(t)}})};var p=function e(t,r,n){if(!n||!n.pinned_to)return;n.pinned_to.forEach(function(e){var t=TS.shared.getModelObById(e);if(!t)return;var r=l(false,{comment:n},"file_comment",t);if(r)TS.pins.pinned_status_changed_sig.dispatch(t)})};var h=function e(t){if(!t)return;if(t.pinned_to)t.pinned_to.forEach(function(e){var r=TS.shared.getModelObById(e);if(!r)return;var n=l(false,{file:t},"file",r);if(n)TS.pins.pinned_status_changed_sig.dispatch(r)});if(t.comments)t.comments.forEach(function(e){p(t,e.id,e)})};var g=function r(){if(n){e={};t={}}else n=true};var S=function r(n){var i=n||TS.shared.getActiveModelOb();if(i&&i.id){delete e[i.id];delete t[i.id]}}})()},4819:function(e,t){(function(){TS.registerModule("inline_file_previews",{expand_sig:new signals.Signal,collapse_sig:new signals.Signal,onStart:function e(){c();this.collapse_sig.add(a);this.expand_sig.add(s);$("#messages_container").on("keydown",".preview_show_more .preview_show_btn",i);$("#messages_container").on("keydown",".preview_show_less .preview_show_btn",i)},checkForInlineFilePreviewClick:function e(t){var r=$(t.target);var i;var a=r.closest(".message");if(0===a.length)return;if(r.hasClass("service_link")||r.closest(".service_link")>0)return;var s=a.attr("id");var u=r.closest(".msg_inline_file_preview_toggler");if(u.length>0){t.preventDefault();i=u.data("file-id");if(u.hasClass("collapsed"))n(s,i);else o(s,i);return true}var _=r.closest(".inline_file_preview_container, .file_container");if(0===_.length)return;var c=r.closest("ts-message");var m=""+c.data("ts");var f=c.data("model-ob-id");var p={message_timestamp:m,channel_id:f,channel_type:f?f.charAt(0):"",member_id:c.data("member-id"),app_id:c.data("app-id"),bot_id:c.data("bot-id")};if(r.closest(".preview_show.preview_show_more").length>0){t.preventDefault();l(t,a,_);TS.clog.track("PREVIEW_EXPAND",p);return true}if(r.closest(".preview_show.preview_show_less .preview_show_btn, .preview_show_less_header").length>0){t.preventDefault();d(t,a,_);TS.clog.track("PREVIEW_COLLAPSE",p);return true}if(r.closest("a").length)return false;i=_.data("file-id");var h=TS.files.getFileById(i);if(!h)return false;if("space"===h.mode||"post"===h.mode||"arugula"===h.mode||"email"===h.mode||"snippet"===h.mode)if(_.hasClass("inline_collapsed")){t.preventDefault();l(t,a,_);return true}return false},shouldTruncate:function e(t){if(!t)return false;if("snippet"===t.mode){if(t.lines_more>0||t.preview_is_truncated)return true}else if("post"===t.mode||"space"===t.mode){if(!t.preview)return false;if(t.preview.length>=400)return true;if(t.preview.split(" ").length>=50)return true;if(t.preview.split("\n").length>=4)return true;var r=t.preview.match(/<\/(?:h\d|p|li|pre|blockquote)>/g)||[];var n=t.preview.match(/<hr>/g)||[];var i=r.concat(n);if(i.length>=4)return true}else if("email"===t.mode)return true;return false},isTruncated:function t(r,n){if(!n)return false;return!e[r+"_"+n.id]},expandableState:function e(t,r){if(TS.model.expandable_state["inline_file_"+t+r])return true;if(false===TS.model.expandable_state["inline_file_"+t+r])return false},shouldExpand:function e(t,r){var n=TS.inline_file_previews.expandableState(t,r);if("boolean"===typeof n)return n;return true},expandAllInCurrent:function e(){t=true;$(".msg_inline_file_preview_toggler").each(function(e,t){var r=$(t);var i=r.data("file-id");var a=r.closest(".message").attr("id");n(a,i)});t=false;if(TS.client)TS.client.ui.instaScrollMsgsToBottom(false)},collapseAllInCurrent:function e(){$(".msg_inline_file_preview_toggler").each(function(e,t){var r=$(t);var n=r.data("file-id");var i=r.closest(".message").attr("id");o(i,n)})},test:function e(){return{actuallyExpandContent:u}}});var e={};var t=false;var r=false;var n=function e(r,n){TS.model.expandable_state["inline_file_"+r+n]=true;TS.storage.storeExpandableState(TS.model.expandable_state);var i="#"+TS.utility.makeSafeForDomId(r);var a=$(i);if(!a.length)return;var s=TS.client&&TS.client.ui.areMsgsScrolledToBottom();var o=function e(){return $(this).data("file-id")==n};var l=a.find(".inline_file_preview_container, .file_container").filter(o);a.find(".msg_inline_file_title_hider").filter(o).addClass("hidden");a.find('.msg_inline_file_preview_toggler[data-file-id="'+n+'"]').removeClass("collapsed").addClass("expanded");l.removeClass("hidden");if(TS.client)TS.client.ui.checkInlineImgsAndIframesEverywhere();l.css("opacity",0).stop().animate({opacity:1},300);if(!t)if(TS.client&&s){TS.client.ui.instaScrollMsgsToBottom(false);l.scrollintoview({duration:0,offset:"top",px_offset:0,direction:"y"})}else l.scrollintoview({duration:200,offset:"bottom",px_offset:0,direction:"y"});TS.inline_file_previews.expand_sig.dispatch(r);if(TS.client)TS.ui.utility.updateClosestMonkeyScroller(a)};var i=function e(t){if(13==t.which||32==t.which)r=true};var a=function e(){if(r)$(".preview_show_more .preview_show_btn").focus().addClass("focus-ring");r=false};var s=function e(){if(r)$(".preview_show_less .preview_show_btn").focus().addClass("focus-ring");r=false};var o=function e(t,r){TS.model.expandable_state["inline_file_"+t+r]=false;TS.storage.storeExpandableState(TS.model.expandable_state);var n="#"+TS.utility.makeSafeForDomId(t);var i=$(n);if(!i.length)return;var a=function e(){return $(this).data("file-id")==r};var s=i.find(".inline_file_preview_container, .file_container").filter(a);i.find(".msg_inline_file_title_hider").filter(a).removeClass("hidden");i.find('.msg_inline_file_preview_toggler[data-file-id="'+r+'"]').removeClass("expanded").addClass("collapsed");s.addClass("hidden");TS.inline_file_previews.collapse_sig.dispatch(t);setTimeout(function(){if(TS.client)TS.ui.utility.updateClosestMonkeyScroller(i)},0)};var l=function e(t,r,n){var i=n.data("file-id");var a=TS.files.getFileById(i);if(!a)return;if("post"===a.mode||"space"===a.mode||"snippet"===a.mode){var s=n.find(".preview_show_more .preview_show_btn");s.data("stashed_text",s.html()).empty();var o=new Spinner({lines:9,length:0,width:4,radius:5,corners:1,rotate:0,direction:1,color:"#ffffff",speed:1,trail:25,shadow:false,hwaccel:false,className:"spinner",zIndex:2e9,top:"-8px",left:"-4px",opacity:.1});o.spin(s.get(0));n.addClass("loading");TS.files.fetchFileInfo(i,function(e,t){o.stop();s.html(s.data("stashed_text"));n.removeClass("loading");if(t.content_html||t.content_highlight_html)u(r,t);TS.utility.welcome_post.clogWelcomePostExpand(t)})}else if("email"===a.mode)if(a.simplified_html)u(r,a);else{r.find(".email_content").addClass("loading");var l=setTimeout(function(){r.find(".inline_file_preview_container, .file_container").addClass("expanded")},1e3);TS.files.fetchFileInfo(i,function(e,t){clearTimeout(l);u(r,t);r.find(".email_content").removeClass("loading")})}};var u=function t(r,n){var i=r.attr("id");var a=i+"_"+n.id;e[a]=true;r.find(".inline_file_preview_container, .file_container").removeClass("inline_collapsed").addClass("inline_expanded");TS.inline_file_previews.expand_sig.dispatch(r);if(TS.client)TS.ui.utility.updateClosestMonkeyScroller(r)};var d=function r(n,i,a){var s=i.attr("id");var o=a.data("file-id");var l=TS.files.getFileById(o);if(!l)return;var u=s+"_"+o;delete e[u];i.find(".inline_file_preview_container, .file_container").removeClass("inline_expanded").addClass("inline_collapsed");if(!t){var d=i[0].getBoundingClientRect();if(d.top<0)i.scrollintoview({duration:0,offset:"top",px_offset:0,direction:"y"})}TS.inline_file_previews.collapse_sig.dispatch(i);if(TS.client)TS.ui.utility.updateClosestMonkeyScroller(i)};var _;var c=function e(){if(_)clearInterval(_);var t=function e(){var t=$("#msgs_div .file_time_ago");var r=[];t.each(function(){var e=$(this).data("file-id");var t=TS.files.getFileById(e);if(!t){r.push($(this).text());return}r.push(TS.interop.datetime.toTimeAgo(t.updated));t=null});t.each(function(e,t){$(t).text(r[e]);t=null});t=null};t=TS.utility.throttleFunc(t,5e3);_=setInterval(t,6e4)}})()},4820:function(e,t){(function(){TS.registerModule("rxns",{rxn_records_changed_sig:new signals.Signal,member_rxns_fetched_sig:new signals.Signal,member_rxns_being_fetched_sig:new signals.Signal,need_alerts:{},onStart:function e(){if(!TS.client)return;TS.prefs.preferred_skin_tone_changed_sig.add(I);TS.prefs.emoji_mode_changed_sig.add(I);x=function e(){};var t=function e(){};TS.client.login_sig.add(function(){x=TS.utility.throttleFunc(k,100);t=TS.utility.throttleFunc(o,1e3)});l=function e(r,n){t(r,void 0,void 0,n)}},upsertRxnsFromDataAndUpdateUI:function e(t,r){var n=m(t,r);if("NOOP"!==n.status)l(t);return n},getRxnKey:function e(t,r,n){if("message"===t&&!n)TS.error("getRxnKey: no c_id provided for message rxn_key");if("message"!==t&&n)TS.error("getRxnKey: c_id provided for but this is not a message rxn_key");return t+"-"+r+"-"+(n||"")},getRxnKeyByMsgType:function e(t){var r;if("file_upload"===t.subtype||"file_share"===t.subtype||"file_mention"===t.subtype||"file_reaction"===t.subtype){if(t.file){var n=t.file;if(_.isString(n))n=TS.files.getFileById(n);r=n&&n._rxn_key}}else if("file_comment"===t.subtype){if(t.comment)r=t.comment._rxn_key}else r=t._rxn_key;return r},getRxnKeyFromData:function e(t){var r;if("message"===t.type)r=t.ts||t.message.ts;else if("file"===t.type)r=t.file.id||t.file;else if("file_comment"===t.type)r=t.file_comment||t.comment.id;else throw new Error("item.type not handled");return TS.rxns.getRxnKey(t.type,r,t.channel)},getExistingRxnsByKey:function e(t){return i[t]||null},getRxnRecordByKey:function e(t){if(n[t])return n[t];for(var i=r.length-1;i>-1;i-=1)if(r[i].rxn_key===t){n[t]=r[i];return n[t]}return null},getNextRxnRecordThatNeedsAlert:function e(){var t;for(var n=r.length-1;n>-1;n-=1)if(TS.rxns.need_alerts[r[n].rxn_key])t=r[n];else break;return t},getRxnsFromData:function e(t){if("message"===t.type)return t.message&&t.message.reactions;if("file"===t.type)return t.file&&t.file.reactions;if("file_comment"===t.type)return t.comment&&t.comment.reactions;return null},doesRxnsHaveRxnFromMember:function e(t,r,n){var i=TS.emoji.nameToCanonicalName(r);if(!t)return false;var a=TS.rxns.getRxnFromRxns(t,r)||TS.rxns.getRxnFromRxns(t,i);if(!a)return false;if(!a.count)return false;if(!a.users)return false;return-1!==a.users.indexOf(n)},doesRxnsHaveRxnFromUser:function e(t,r){return TS.rxns.doesRxnsHaveRxnFromMember(t,r,TS.model.user.id)},doesRxnsHaveRxn:function e(t,r){if(!t)return false;return!!TS.rxns.getRxnFromRxns(t,r)},doesRxnsHaveSkinlessRxn:function e(t,r){if(!t)return false;var n=[r.replace(/(::skin-tone-[2-6])/,"")];TS.emoji.spliceSkinToneVariationsIntoAnArrayOfEmojiNames(n);for(var i=0;i<n.length;i+=1)if(TS.rxns.getRxnFromRxns(t,n[i]))return true;return false},countAllRxns:function e(t){if(!t)return 0;var r=0;t.forEach(function(e){r+=e.count||0});return r},countAllEmoji:function e(t){if(!t)return 0;return t.length},countAllUsersRxns:function e(t,r){if(!t)return 0;var n=0;t.forEach(function(e){if(e.users.indexOf(r)>-1)n+=1});return n},getAllUniqueRxners:function e(t,r){if(!t)return[];var n=[];t.forEach(function(e){if(!e)return;if(!e.count)return;if(!e.users)return;e.users.forEach(function(e){if(r==e)return;if(-1!=n.indexOf(e))return;n.push(e)})});return n},getRxnFromRxns:function e(t,r){if(!t)return null;return t.filter(function(e){return e.name==r})[0]||null},changeRxnsFromIMsg:function e(t){if(!t.item)return;TS.log(2006,"rxn updated from imsg by "+t.user);var r=false;if("message"===t.item.type&&t.item.ts)r=true;else if("file"===t.item.type&&"string"===typeof t.item.file)r=true;else if("file_comment"===t.item.type&&t.item.file_comment&&"string"===typeof t.item.file)r=true;if(!r)return;if(!y(t.item))return;var n=t.user==TS.model.user.id;var i=TS.rxns.getRxnKeyFromData(t.item);var a=TS.rxns.getExistingRxnsByKey(i);var s;var u="reaction_added"===t.type;s=d(u,_.cloneDeep(a)||[],t.reaction,t.user,t.url);var c=m(i,s);if(TS.has_pri[O])TS.dir(O,c,"handleRxnChangeFromMS upsert status:"+c.status);b(t);if("NOOP"===c.status)return;if(n&&!t._from_evt_log)o(i,t.reaction,t.user,t.item.type);else l(i,t.item.type);if(u)TS.log(2006,"Adding to "+i);else TS.log(2006,"Removing from "+i)},changeRxnsFromUserAction:function e(t,r,n){if(n)TS.log(2006,"Adding rxn to "+t+" from user action");else TS.log(2006,"Removing rxn from "+t+" from user action");var i=TS.emoji.nameToCanonicalName(r);var l=TS.rxns.getExistingRxnsByKey(t);var d=TS.rxns.getRxnFromRxns(l,r);if(n||!d)r=i;if(TS.has_pri[O])TS.log(O,"changeRxnsFromUserAction rxn_key:"+t+" name:"+r+" adding:"+n);if(n&&!TS.emoji.isValidName(r)&&!(d&&d.url)){TS.error('"'+r+'" is not a valid emoji');return}var m=TS.rxns.getExistingRxnsByKey(t)||[];if(n){var f=TS.rxns.countAllEmoji(m);var T=TS.rxns.countAllUsersRxns(m,TS.model.user.id);if(f>=50&&!TS.rxns.doesRxnsHaveRxn(m,r)){M(A);return}else if(T>=23){M(P);return}}var v=u(n,_.cloneDeep(m),r);if(TS.has_pri[O]){TS.dir(O,m,"existing_rxns");TS.dir(O,v,"new_rxns")}var b=c(t,v);if(TS.has_pri[O])TS.dir(O,b,"changeRxnsFromUserAction upsert status:"+b.status);if("NOOP"===b.status){TS.error("changeRxnsFromUserAction called but no NOOP?");return}o(t,r,TS.model.user.id);var y=n?"reactions.add":"reactions.remove";var w=g(t,{name:r});var k=$('[data-rxn-key="'+t+'"]');var x={};var C=k.closest("ts-message");var I=""+C.data("ts");var F=C.data("model-ob-id");x={message_timestamp:I,channel_id:F,channel_type:F?F.charAt(0):"",member_id:C.data("member-id"),app_id:C.data("app-id"),bot_id:C.data("bot-id")};if(TS.shared){var B=TS.shared.getActiveChannelSessionId();if(null!==B)x.channel_session_id=B}var D=n?"REACTION_ADDED":"REACTION_REMOVED";if(TS.model.unread_view_is_showing&&w.timestamp){_.merge(x,TS.client.ui.unread.getTrackingData(w.timestamp));TS.client.ui.unread.incrementTrackingSeqId()}_.merge(x,TS.ui.thread.getTrackingPayloadForEl(k));if("threads_view"===TS.ui.thread.getContextForEl(k))TS.client.ui.threads.incrementTrackingSeqId();TS.clog.track(D,x);p(t);var H=function e(i,l,d){h(t);TS.log(2006,y+" returned "+i+" for "+t);var m=false;if(i);else if(!n&&l.error&&"no_reaction"===l.error);else{if(l.error==A||l.error==P)M(l.error);else if(l.error==E)TS.warn("Attempted to add/remove invalid emoji and the API complained: "+d.name);var f=TS.rxns.getExistingRxnsByKey(t)||[];var p=u(!n,_.cloneDeep(f),r);var g=c(t,p);if(TS.has_pri[O])TS.dir(O,g,"changeRxnsFromUserAction UNDO upsert status:"+g.status);if("NOOP"===g.status){if(TS.has_pri[O])TS.log(O,"changeRxnsFromUserAction trying to undo because of API rsp, but no NOOP?")}else m=true}var T=function e(){if(TS.has_pri[O])TS.log(O,"maybeUpdateModel pending:"+a[t]+" _pending_last:"+s[t]);if(a[t])return false;if(!s.hasOwnProperty(t))return false;var r=c(t,s[t]);delete s[t];if(TS.has_pri[O])TS.dir(O,r,"maybeUpdateModel status:"+r.status);if("NOOP"===r.status)return false;o(t);S(t);return true};if(!T()&&!m)return;o(t)};return TS.api.call(y,w).then(function(e){var t=e.data,r=e.args,n=e.request_id;var i=true;H(i,t,r,n);return{data:t,args:r,request_id:n}}).catch(function(e){var t=e.data,r=e.args,n=e.request_id;var i=false;H(i,t,r,n);return{data:t,args:r,request_id:n}})},checkForRxnClick:function e(t){if(!t||!t.target)return;var r=$(t.target);var n=r.closest(".rxn");if(!n.length)return;var i=String(n.data("emoji"));var a=r.closest(".rxn_panel");var s=a.data("rxn-key");var o=n.hasClass("is_handy");var l;if(n.hasClass("menu_rxn"))TS.ui.react_emoji_menu.start({e:t,rxn_key:s});else{l=!n.hasClass("user_reacted");if(!l&&t.shiftKey)F(s);else{var u=o&&TS.emoji.isNameSkinToneModifiable(i)?":"+TS.emoji.getChosenSkinToneModifier():"";TS.rxns.changeRxnsFromUserAction(s,i+u,l)}}},getRxnRecords:function e(){return r},getRxnKeyParts:function e(t){var r=t.split("-");return{type:r[0],id:r[1],c_id:r[2]}},test:function e(){return{updateUI:o,addOrRemoveRxnFromRxns:d,upsertRxnsFromData:m,upsertRxns:f,incrementPendingCnt:p,decrementPendingCnt:h,fetchAndUpdateRxns:S,displayTooManyError:M,TOO_MANY_REACTIONS:P,TOO_MANY_EMOJI:A}},clearHandyRxnsDisplayDataCache:function e(){t=void 0},getMemberRxnsFromMessage:function e(t,r){if(!t||!r)return;var n=TS.rxns.getRxnKeyByMsgType(t);if(!n)return;var i=TS.rxns.getExistingRxnsByKey(n);if(!i)return;var a=i.filter(function(e){return _.includes(e.users,r)});return a},getHandyRxnsDisplayDataByRxnKey:function r(){if(!t){t={items:{}};e.forEach(function(e){var r=TS.emoji.isNameSkinToneModifiable(e)?TS.emoji.getChosenSkinToneModifier():"";var n=":"+e+":"+r;t.items[e]={html:new Handlebars.SafeString(TS.emoji.graphicReplace(n,{no_skin_tone_squares:true})),name:n,names:n}})}return t}});var e=["slightly_smiling_face","+1","white_check_mark","heart","eyes"];var t;var r=[];var n={};var i={};var a={};var s={};var o=function e(t,r,n,i){var a;var s=TS.rxns.getRxnKeyParts(t);if(s&&s.c_id){var o=TS.shared.getActiveModelOb();if(o&&o.id!==s.c_id)a=true}var l;var u=0;if(!a)l=TS.client&&TS.client.ui&&TS.client.ui.areMsgsScrolledToBottom(u);TS.templates.builders.updateRxnPanels(t,r,n);if("file"===i){TS.log("(Temporary) Rebuilding mentions due to file reaction.");TS.view.rebuildMentions()}if(TS.client&&l)TS.client.ui.instaScrollMsgsToBottom(true)};var l=function e(t,r){o(t,void 0,void 0,r)};var u=function e(t,r,n){return d(t,r,n,TS.model.user.id)};var d=function e(t,r,n,i,a){var s=TS.rxns.getRxnFromRxns(r,n);if(t){if(!s)r.push({users:[i],count:1,name:n,url:a});else if(TS.utility.ensureInArray(s.users,i))s.count+=1}else if(s){var o=s.users.indexOf(i)>=0;if(o){_.pull(s.users,i);s.count-=1;if(s.count<1||0===s.users.length)_.pull(r,s);if(!r.length)r=null}}return r};var c=function e(t,r){return f(t,r,true)};var m=function e(t,r){return f(t,r,false)};var f=function e(t,r,n){var o={status:"NOOP",what_changed:[],rxns:r};if(!n&&a[t]){s[t]=_.cloneDeep(r);if(TS.has_pri[O])TS.log(O,"_upsertRxns call ignored because !force && _pending_counts["+t+"]:"+a[t]);return o}var l=TS.rxns.getExistingRxnsByKey(t);if(r)if(l){if(!TS.utility.areSimpleObjectsEqual(l,r,"rxn_key:"+t)){o.status="CHANGED";i[t]=r}}else{o.status="ADDED";i[t]=r}else if(l){o.status="CHANGED";delete i[t]}o.rxns=i[t]||null;if(TS.useReactMessages())if(TS.redux.reactions.isInBulkUpsertMode())TS.redux.reactions.addToBulkUpsertPayload(t,r);else TS.redux.reactions.updateReaction(t,r);if(TS.has_pri[O])TS.dir(O,o,t);return o};var p=function e(t){if(!t)return;a[t]=a[t]||0;a[t]+=1;if(TS.has_pri[O])TS.log(O,"_incrementPendingCnt "+t+": "+a[t])};var h=function e(t){if(!a[t]){if(TS.has_pri[O])TS.log(O,"_decrementPendingCnt "+t+": "+a[t]);return}a[t]-=1;if(0===a[t])delete a[t];if(TS.has_pri[O])TS.log(O,"_decrementPendingCnt "+t+": "+a[t])};var g=function e(t,r){r=r||{};var n=TS.rxns.getRxnKeyParts(t);if("message"===n.type){r.channel=n.c_id;r.timestamp=n.id}else if("file"===n.type)r.file=n.id;else if("file_comment"===n.type)r.file_comment=n.id;else throw new Error("type not handled");return r};var S=function e(t,r){r=r||1;var n=2;var i=g(t,{full:true});if(TS.has_pri[O])TS.log(O,"_fetchAndUpdateRxns rxn_key:"+t+" attempt:"+r);p(t);var a=function i(a,s){h(t);if(a){var l=TS.rxns.getRxnsFromData(s);var u=m(t,l);if(TS.has_pri[O])TS.dir(O,u,"_fetchAndUpdateRxns upsert status:"+u.status);if("NOOP"===u.status)return;o(t)}else TS.error("_fetchAndUpdateRxns got an err:"+JSON.stringify(s||null));if(r<n){r+=1;e(t,r)}};TS.api.call("reactions.get",i).then(function(e){var t=e.data,r=e.args,n=e.request_id;var i=true;a(i,t,r,n);return{data:t,args:r,request_id:n}}).catch(function(e){var t=e.data,r=e.args,n=e.request_id;var i=false;a(i,t,r,n);return{data:t,args:r,request_id:n}})};var T=function e(t,r,n){if(!t)return null;if(!t.emoji)return null;if(!t.emoji.hasOwnProperty(r))return null;for(var i=0;i<t.emoji[r].length;i+=1)if(t.emoji[r][i].id===n)return t.emoji[r][i];return null};var v=function e(t){if(!TS.client)return false;if(t.user==TS.model.user.id)return false;if("message"===t.item.type&&"undefined"!==typeof t.item.message&&t.item.message.user!=TS.model.user.id)return false;if("file"===t.item.type&&"undefined"!==typeof t.item.file&&t.item.file.user!=TS.model.user.id)return false;if("file_comment"===t.item.type&&"undefined"!==typeof t.item.comment&&t.item.comment.user!=TS.model.user.id)return false;return true};var b=function e(t){if(!v(t))return;var r=TS.rxns.getRxnKeyFromData(t.item);if("reaction_added"===t.type){if("message"===t.item.type)var n=t.item.channel;var i=!t._from_evt_log&&"message"===t.item.type;w(t.reaction,r,t.user,t.event_ts,i,n,t.url)}else C(t.reaction,r,t.user)};var y=function e(t){if(!t)return false;if("message"===t.type){var r=TS.utility.msgs.findMsg(t.ts,t.channel);if(!r)return false;t.message=r;return true}else if("file"===t.type||"file_comment"===t.type){var n=TS.files.getFileById(t.file);if(!n)return false;t.file=n;if("file_comment"===t.type){var i=TS.files.getFileCommentById(n,t.file_comment);if(!i)return false;t.comment=i}return true}return false};var w=function e(t,i,a,s,o,l,u){s=s||TS.interop.datetime.makeTsStamp();o=!!o;var d=false;var _=n[i];if(!_){d=true;r[r.length]={rxn_key:i};n[i]=r[r.length-1];_=n[i]}_.last_update=s;if(o)TS.rxns.need_alerts[i]=TS.rxns.need_alerts[i]||s;_.emoji=_.emoji||{};_.source=l||"";_.url=u;_.emoji[t]=_.emoji.hasOwnProperty(t)&&_.emoji[t]||[];var c=_.emoji[t];var m=T(_,t,a);if(!m){c[c.length]={id:a};m=c[c.length-1]}m.when=s;TS.dir(877,r,t+" "+i+" "+a);var f=r.length;if(d&&f>1&&r[f-1].last_update<r[f-2].last_update)r.sort(function e(t,r){if(t.last_update<r.last_update)return-1;if(t.last_update>r.last_update)return 1;return 0});x(o)};var k=function e(t){TS.rxns.rxn_records_changed_sig.dispatch(t)};var x=function e(){k()};var C=function e(t,i,a){var s=TS.rxns.getRxnRecordByKey(i);var o=T(s,t,a);if(o&&s){_.pull(s.emoji[t],o);if(!s.emoji[t].length)delete s.emoji[t];if(!Object.keys(s.emoji).length){delete n[i];_.pull(r,s)}}TS.rxns.rxn_records_changed_sig.dispatch()};var M=function e(t){var r=TS.i18n.t("You’ve reached the reaction limit","rxns")();var n=[TS.i18n.t("For reasons of performance and productivity and brevity being the soul of wit, you can add up to 23 emoji to a message, but no more.","rxns")(),TS.i18n.t("Well done! You’ve added the maximum amount of emoji one person can add to one message. For reasons of performance, productivity and sharpened creative thinking, we cap the number of individual reacji to 23.","rxns")(),TS.i18n.t("Emotions! We all have them — but on Slack, you’re limited to 23 reactions per message.","rxns")()];var i=[TS.i18n.t("The human heart is a powerful thing; its capacity to feel is limitless! A message’s capacity is 50.","rxns")(),TS.i18n.t("Alas! Slack only allows each message a grand total of 50 emoji reactions.","rxns")(),TS.i18n.t("A single message can’t have more than 50 unique reactions. When we asked the engineers why they said, “we have to set limits somewhere,” and then we tried to frown but this error popped up. So that’s where we’re at.","rxns")()];if(t==P){var a=_.sample(n);TS.generic_dialog.alert('<p class="no_bottom_margin">'+a+"</p>",r)}else if(t==A){var s=_.sample(i);TS.generic_dialog.alert('<p class="no_bottom_margin">'+s+"</p>",r)}};var I=function e(){$(".msgs_holder").find("ts-message").each(function(){var e=$(this);TS.ui.messages.maybeUpdateMessageHoverContainer(e)})};var P="too_many_reactions";var A="too_many_emoji";var E="invalid_name";var F=function e(t){var r=TS.rxns.getExistingRxnsByKey(t);if(!r)return;r.forEach(function(e){if(!TS.rxns.doesRxnsHaveRxnFromUser(r,e.name))return;TS.rxns.changeRxnsFromUserAction(t,e.name,false)})};var O="888"})()},4821:function(e,t){(function(){TS.registerModule("ui.new_channel_modal",{start:function t(r,n,i){if(!TS.permissions.members.canCreateChannels()&&!TS.permissions.members.canCreateGroups())return;TS.ui.fs_modal.start({body_template_html:'<div id="new_channel_modal_container"></div>',onShow:g,onEnd:S});e=$("#new_channel_modal_container");if(TS.prefs.getPref("lessons_enabled")&&TS.lessons.inOnboarding())TS.lessons.new_channel_modal_opened_sig.dispatch(true);return TS.ui.new_channel_modal.startInContainer(e,r,n,i)},startInContainer:function i(a,s,o,l){if(!TS.permissions.members.canCreateChannels()&&!TS.permissions.members.canCreateGroups())return;e=a;r=false!==o;if(!TS.permissions.members.canCreateChannels())r=false;if(!TS.permissions.members.canCreateGroups())r=true;var u=TS.permissions.members.canCreateChannels()&&TS.permissions.members.canCreateGroups();s=TS.utility.cleanChannelName(s||"");l=l||[];var _;if(TS.prefs.getPref("lessons_enabled")&&TS.lessons.inOnboarding())_=TS.templates.channel_new_simplified_for_onboarding_modal;else _=TS.templates.channel_new_modal;e.html(_({title:s,is_public:r,can_toggle_private:u,compliance_exports_enabled_for_team:!!TS.prefs.getTeamPref("compliance_export_start"),is_ra:TS.model.user.is_restricted,can_create_shared_channel:TS.permissions.members.canCreateSharedChannel()}));t=Ladda.create(e.find(".new_channel_go")[0]);d(l);setTimeout(function(){p()},500);return new Promise(function(e,t){n={resolve:e,reject:t}})},go:function n(){var i=e.find(".title_input").val();var a=$("#invite_members_container").lazyFilterSelect("value");var s=[];var o=[];if(a)a.forEach(function(e){if(e.member)s.push(e.member.id);else o.push(e)});var l=_.trim(TS.utility.contenteditable.value(e.find("#channel_purpose_input")));if(t)t.start();if(r)c(i,l,s,o);else m(i,l,s,o)},end:function e(){T()},test:function e(){return{createPublicChannel:c,createPrivateChannel:m,showNameTakenAlert:f}}});var e;var t;var r;var n;var i=function t(){var r=e.find("#invite_members_container").find("input")[0];var n=e.find("#channel_purpose_input");e.on("keydown",function(e){if(e.which===TS.utility.keymap.enter&&document.activeElement!=r&&!TS.utility.contenteditable.hasFocus(n)){TS.ui.new_channel_modal.go();e.preventDefault()}else if(e.which===TS.utility.keymap.esc){TS.ui.fs_modal.close();if(TS.boot_data.feature_lesson_onboarding&&TS.prefs.getPref("lessons_enabled")&&TS.lessons.inOnboarding())TS.lessons.new_channel_modal_closed_sig.dispatch(true);e.preventDefault()}})};var a=function t(){var n=$("#channel_public_private_toggle");n.togglify();n.bind("change",function(){r=n.is(":checked");if(n.is(":checked")){e.find(".private_channel_item").addClass("hidden");e.find(".public_channel_item").removeClass("hidden")}else{e.find(".public_channel_item").addClass("hidden");e.find(".private_channel_item").removeClass("hidden")}})};var s=function e(){return new Promise(function(e){if(TS.model.user.is_admin)TS.api.call("users.admin.invited").then(function(t){var r=TS.pending_users.filterOutURAs(t.data.pending);if(r.length){r.forEach(function(e){TS.pending_users.sanitizeNameFields(e)});e(r)}else e([])});else e([])})};var o=function e(t){var r=true;var n=s();return function(e,i){if("@"===e.charAt(0))e=e.substring(1);var a;var s=false;if(r){r=false;if(_.get(t,"length"))s=true}if(s){var o=_.compact(t.map(TS.members.getMemberById));var u=o.map(function(e){return{member:e,lfs_id:String(e.id),preselected:true}});return Promise.resolve({items:u})}else if(i>0)return Promise.resolve({items:[]});a=l(e);return Promise.all([a,n]).then(function(t){var r=t[0];var n=t[1];if(_.isUndefined(n)||0===n.length)return r;var i=new RegExp("^"+TS.utility.regexpEscape(e),"i");var a=new RegExp("(-|_|\\+|\\s|\\.|@)"+TS.utility.regexpEscape(e),"i");n=n.filter(function(e){return TS.pending_users.checkUserMatch(e,i)||TS.pending_users.checkUserMatch(e,a)});r=r.concat(n).sort(function(e,t){return TS.pending_users.usersSorterByName(e,t)});return r})}};var l=function e(t){var r={query:t,filter:"everyone"};return TS.members.fetchAndUpsertMembersWithQuery(r).then(function(e){var r=[];if(""===t)r=TS.members.getMembersForUser();else r=e.objects;r=_.filter(r,function(e){if(e.is_self)return false;if(e.is_slackbot)return false;return true});return r.filter(function(e){return!(e.is_ultra_restricted||e.deleted||!e._is_local||e.is_app_user)}).map(function(e){return{member:e,lfs_id:String(e.id)}})})};var u=function e(t){var r;var n;var i;var a={append:true,per_page:50,max_selected_items:100,approx_item_height:36,placeholder_text:TS.i18n.t("Search by name","new_channel")(),template:function e(t){var r;if(t.member)r=TS.templates.channel_invite_member_small({member:t.member});else r=TS.templates.channel_invite_pending_user_small({invitee:t});return new Handlebars.SafeString(r)},tokenTemplate:function e(t){var r;if(t.member)r=TS.templates.channel_invite_member_token({member:t.member});else r=TS.templates.channel_invite_pending_user_token({invitee:t});return new Handlebars.SafeString(r)},tokenClass:function e(t){if(t.member)return TS.templates.builders.getMemberTypeClass(t.member);return"lfs_token_pending_user"},filter:function e(t,a){var s=t.member;if(r!==a){n=new RegExp("^"+TS.utility.regexpEscape(a),"i");i=new RegExp("(-|_|\\+|\\s|\\.|@)"+TS.utility.regexpEscape(a),"i");r=a}var o=true;if(s)return TS.utility.members.checkMemberMatch(s,n,o)||TS.utility.members.checkMemberMatch(s,i,o);return TS.pending_users.checkUserMatch(t,n)||TS.pending_users.checkUserMatch(t,i)},noResultsTemplate:function e(t){if(!t)return TS.i18n.t("No one found","new_channel")();return TS.i18n.t("No one found matching <strong>{query}</strong>","new_channel")({query:TS.utility.truncateAndEscape(t,50)})}};a.data_promise=o(t);$("#invite_members_container").lazyFilterSelect(a)};var d=function t(r){u(r);e.find(".lfs_input").attr("id","invite_members_input");e.find(".new_channel_go").click(TS.ui.new_channel_modal.go);e.find(".create_share_channel").click(function(){TS.ui.new_channel_modal.end();TS.ui.share_channel_dialog.start({channel_name:$("#channel_create_title").val(),is_private:!$("#channel_public_private_toggle").is(":checked"),element:"shared_channels_new_channel_modal_share_btn"})});i();a();e.find(".title_input").keydown(function(){if(e)e.find(".modal_input_note.mustard_yellow").each(function(){$(this).addClass("hidden")})});$("#channel_create_title").focus();e.find(".new_channel_cancel_btn").on("click",function(){var e=n&&n.reject;if(e)e();TS.ui.fs_modal.close();if(TS.boot_data.feature_lesson_onboarding&&TS.prefs.getPref("lessons_enabled")&&TS.lessons.inOnboarding())TS.lessons.new_channel_modal_closed_sig.dispatch(true)});var s=$("#save_channel");var o=$("#channel_create_title");function l(){var e=o.val();if(e&&e.length)TS.utility.disableElement(s,false);else TS.utility.disableElement(s,true)}if(s.length&&o.length){o.on("input",l);l()}var d=e.find("#channel_purpose_input");TS.utility.contenteditable.create(d,{singleLineInput:true,modules:{tabcomplete:{positionMenu:function e(t){t.style.width=d.outerWidth()+"px";TS.tabcomplete.positionUIRelativeToInput(t,d)},searchOptions:{complete_member_specials:false},completers:["channels","emoji","members"]}},onTab:function e(){return true},onEnter:function e(){return false},onEscape:function e(){TS.ui.fs_modal.close()}});TS.utility.contenteditable.enable(d)};var c=function r(n,i,a,s){TS.channels.create(n,{validate_name:true}).then(function(e){var t=e.data;if(i)TS.channels.setPurpose(t.channel.id,i);if(a&&a.length){_.pull(a,TS.model.user.id);if(a.length)TS.api.call("conversations.invite",{channel:t.channel.id,users:a.join(","),just_created:true,force:true})}if(s&&s.length)TS.pending_users.invitePendingUsersToChannel(s,t.channel.id);TS.ui.fs_modal.close()}).catch(function(r){r=r||{};var i=r.data?r.data.error:r.message;if(t)t.stop();var a=TS.ui.validation.getErrorMessage(i,{maxlength:22,name:n});TS.ui.validation.showWarning(e.find(".title_input"),a,{custom_for:"channel_create_title"})})};var m=function r(n,i,a,s){TS.groups.create(n,{and_invite_members_idsA:a,validate:true}).then(function(e){var t=e.data;var r=t.group||t.channel;if(i)TS.groups.setPurpose(r.id,i);if(s&&s.length)TS.pending_users.invitePendingUsersToChannel(s,r.id);TS.ui.fs_modal.close()}).catch(function(r){if(t)t.stop();var i=r.data.error;var a=TS.ui.validation.getErrorMessage(i,{maxlength:22,name:n});TS.ui.validation.showWarning(e.find(".title_input"),a,{custom_for:"channel_create_title"})})};var f=function t(){TS.channels.ui.channelCreateDialogShowNameTakenAlert(e)};var p=function e(){var t=new Date("March 17, 2017 10:00:00");var r=Math.floor(t.getTime()/1e3);if(TS.prefs.getPref("seen_intl_channel_names_coachmark"))return;if("en-US"===TS.boot_data.browser_lang||"en-us"===TS.boot_data.browser_lang)return;if(TS.model.user.created>r)return;TS.prefs.setPrefLocal("seen_intl_channel_names_coachmark",true);TS.prefs.setPrefByAPI({name:"seen_intl_channel_names_coachmark",value:true},function(){TS.coachmark.start(TS.coachmarks.coachmarks.intl_channel_names)})};var h=function t(){if(e){e.find(".new_channel_go").off("click");e.find("#channel_public_private_toggle").off("change");e.off("keydown")}};var g=function e(){};var S=function e(){T()};var T=function r(){h();e=null;t=null;n=null}})()},4822:function(e,t){(function(){TS.registerModule("ui.lazy_filter_select",{STYLES:{default:"default",filter_in_list:"filter_in_list",normal:"normal",small:"small"},onStart:function e(){$("select[data-lazy-filter-select], label[data-lazy-filter-select] select").addClass("hidden").lazyFilterSelect({use_data_attributes:true})},create:function t(r,n){if(n.use_data_attributes){var a=Object.keys(r.data());a.forEach(function(e){if(e.indexOf("lazyFilterSelect")>-1&&"TS-lazyFilterSelect"!==e&&""!==r.data(e)){var t=r.data(e);if("true"===t||"false"===t)t="true"===t;n[e.replace("lazyFilterSelect","").toLowerCase()]=t}})}if("SELECT"===r.prop("tagName"))if("undefined"===typeof n.single)n.single=!r.prop("multiple");var s=$.extend({},e,n);if(void 0===n.approx_divider_height)s.approx_divider_height*=1;if(void 0===n.approx_item_height)s.approx_item_height*=1;var o=$('<div class="lazy_filter_select">');if(s.classes)o.addClass(s.classes);if(r.prop("disabled"))s.disabled=true;if(s.disabled)o.addClass("disabled");s.style=_.get(TS.ui.lazy_filter_select.STYLES,s.style,TS.ui.lazy_filter_select.STYLES.default);if(re(s)&&!s.single){TS.warn("Multi-select lazyFilterSelect instances can't use the 'filter_in_list' style. Using 'default' style instead.");s.style=TS.ui.lazy_filter_select.default}var l=TS.templates.lazy_filter_select_container({instance:s,aria_labelledby:r.attr("aria-labelledby"),STYLES:TS.ui.lazy_filter_select.STYLES});o.html(l);if(s.append)o.appendTo(r);else o.insertAfter(r);o.addClass(s.style+"_style");if(s.single)o.addClass("single");if(s.width)o.css("width",s.width);if(s.css)o.css(s.css);s.$container=o;s.$select=r;s.$input_container=o.find(".lfs_input_container");s.$lfs_value=o.find(".lfs_value");s.$input=o.find(".lfs_input");s.$list_container=o.find(".lfs_list_container");s.$list=o.find(".lfs_list");s.$status=o.find(".lfs_status");s.$status_loading_indicator=s.$status.find(".lfs_status_loading_indicator");s.$status_content=s.$status.find(".lfs_status_content");if(re(s))s.$filter_input=o.find(".lfs_filter_input");else s.$filter_input=s.$input;s._page_number=1;s._slug_id_counter=1;s.run=O;if(s.data_promise){if(H(s))s._running_promise.cancel("Uhhh...");s._running_promise=D(s,"").then(function(e){s.data=e;s.run();i(s)},function(e){i(s);TS.console.logError(e,"LFS error");ie(s,e,"Something failed while trying to return the initial data for lazyFilterSelect.")})}else{if(s.data)s.data=s.data.slice();_.forEach(s.data,function(e,t,r){if(e&&e._is_interop_channel_object)r[t]=_.assign({},e)});s.run();i(s)}s.current_items_in_view_signal=new signals.Signal;return s},convertHTMLDataToRLFSData:x,is_list_open:false});var e={allow_item_unselect:false,allow_list_position_above:false,always_visible:false,append:false,approx_divider_height:28,approx_item_height:30,data_promise:null,data_qa:"lfs",disabled:false,filter:function e(t,r){var n=t.toString();r=r.toLowerCase();if(t instanceof jQuery||t instanceof HTMLElement){n=$(t).text();var i=$(t).attr("data-additional-search-field");if(i&&i.toLowerCase().indexOf(r)>-1)return true}return n.toLowerCase().indexOf(r)>-1},input_debounce_wait_time:void 0,listItemClass:null,max_selected_items:Infinity,min_query_length:0,monkey_scroll:true,no_default_selection:false,noResultsTemplate:function e(t){if(ne(this)&&t.length<this.min_query_length)return TS.i18n.t("{query_length, plural, =0 {Start typing to see results…} other {Keep typing to see results…}}","lazy_filter_select")({query_length:t.length});return TS.i18n.t("No items matched {query}","lazy_filter_select")({query:"<strong>"+_.escape(t)+"</strong>"})},errorTemplate:function e(t){return t||TS.i18n.t("Couldn't load results.","lazy_filter_select")()},onInputBlur:_.noop,onInputFocus:_.noop,onReady:function e(){},onItemAdded:function e(){},onItemRemoved:function e(){},onKeyDown:function e(){},onMaxItemsSelected:function e(){},onListShown:_.noop,onListHidden:_.noop,adjustAvailableSpaceAbove:_.identity,adjustAvailableSpaceBelow:_.identity,placeholder_text:TS.i18n.t("Choose an option…","lazy_filter_select")(),filter_placeholder_text:TS.i18n.t("Search","lazy_filter_select")(),renderDividerFunc:null,render_item_func:null,restrict_input_container_height:false,restrict_preselected_item_removal:false,scroll_threshold:1e3,set_height:true,should_graphic_replace_emoji:false,single:false,sluggify:{enabled:false,delimiter:null,key_name:null,validator:null},style:TS.ui.lazy_filter_select.STYLES.default,template:function e(t){var r=t.toString();var n;var i;if(t instanceof jQuery||t instanceof HTMLElement){r=$(t).text();n=Z($(t).attr("data-additional-search-field"),this);i=Z($(t).attr("data-ts-icon"),this)}r=Z(r,this);if(n)r+=' <span class="addl_text">'+n+"</span>";if(i)r+=' <ts-icon class="addl_icon '+i+'"></ts-icon>';return new Handlebars.SafeString(r)},tokenClass:null,tokenTemplate:null,tokenTemplateSingle:null,use_data_attributes:false,_$active:null,_all_done_fetching:false,_list_built:false,_list_visible:false,_mouse:{},_page_number:1,_prevent_blur:false,_previous_val:"",_running_promise:null,_scroll_callback_was_called:false,_selected:[],_showing_status:false};$.widget("TS.lazyFilterSelect",{_create:function e(){this.instance=TS.ui.lazy_filter_select.create(this.element,this.options)},_destroy:function e(){this.instance.$container.remove();delete this.instance},blur:function e(){this.instance.$filter_input.blur()},clearValue:function e(){if(this.instance.single){if(this.instance._selected.length){var t=this.instance.$input_container.find(".lfs_item");E(this.instance,t)}}else P(this.instance)},container:function e(){return this.instance.$container},disable:function e(){c(this.instance)},disabled:function e(){return this.instance.disabled},enable:function e(){f(this.instance)},focus:function e(){this.instance.$filter_input.focus()},getInstance:function e(){return this.instance},hideList:function e(){T(this.instance,{force:true});le(this.instance)},recomputeHeight:function e(){Q(this.instance)},setValue:function e(t){var r=this.element[0].selectedIndex;this.element.val(t);if(this.element[0].selectedIndex<0)this.element[0].selectedIndex=0;var n=this.element[0].options[this.element[0].selectedIndex];if(this.instance.single){if(this.element[0].selectedIndex==r)return}else P(this.instance);var i=g(this.instance,$(n));L(this.instance,i)},forceSelectItem:function e(t){this.instance.$lfs_value.html(a(this.instance,t,{force_selected:true}));this.instance.$container.addClass("value")},showList:function e(){W(this.instance)},update:function e(t){J(this.instance,t)},updatePlaceholder:function e(t){this.instance.placeholder_text=t;this.instance.$input.prop("placeholder",t)},updateFilterPlaceholder:function e(t){if(!re(this.instance))return;this.instance.filter_placeholder_text=t;this.instance.$filter_input.prop("placeholder",t)},value:function e(){return this.instance._selected}});var t=function e(t,n){if(!v(t))return;if(!n.trim())return;if(!d(t))return;var i={};i[t.sluggify.key_name]=n.trim();i.lfs_id=null;i.lfs_slug_id=t._slug_id_counter;t._slug_id_counter+=1;t._selected.push(i);var a=TS.templates.lazy_filter_select_item({content:t.tokenTemplate(i),applied_classes:"lfs_token",slug_id:i.lfs_slug_id,data_qa:t.data_qa}).replace(/(\r\n|\n|\r)/gm,"");var s=$(a);s.insertBefore(t.$input);if(t.sluggify.validator)t.sluggify.validator(s);C(t,t.data);W(t);t.$filter_input.val("");t._previous_val="";r(t);t.onItemAdded(i);if(!d(t))t.onMaxItemsSelected()};var r=function e(t){if(!t.single){t.$input.prop("size",t.$filter_input.val().length+1);if(t.$filter_input.val().length+t._selected.length===0)G(t);else{t.$input_container.removeClass("empty");t.$input_container.removeClass("error");ee(t)}}};var n=function e(t){if(t.data_promise)t.$list.on("scroll",function(){var e=$(this).scrollTop();var r=t.$list.height();var n=t.$list.find(".list_items").height();var i=n-e-r;if(i<=t.scroll_threshold&&!t._scroll_callback_was_called&&!t._all_done_fetching){u(t,t._previous_val,t._page_number+1);t._scroll_callback_was_called=true}else if(i>t.scroll_threshold&&t._scroll_callback_was_called){if(H(t))t._running_promise.cancel("User scrolled back and we do not need to add more data");t._scroll_callback_was_called=false}})};var i=function e(t){t.$container.on("mouseleave",ue.bind(null,t));t.$container.on("click",de.bind(null,t));t.$container.parents("label").on("click",_e.bind(null,t));t.$input_container.on("focus",ce.bind(null,t));t.$input.on("focus",me.bind(null,t));var r;if(_.isUndefined(t.input_debounce_wait_time))r=fe;else r=_.debounce(fe,t.input_debounce_wait_time);t.$filter_input.on("input",r.bind(null,t));t.$filter_input.on("keydown",pe.bind(null,t));t.$filter_input.on("blur",he.bind(null,t));t.$lfs_value.on("click",be.bind(null,t));t.$lfs_value.on("mousedown",ye.bind(null,t));t.$input_container.on("click",".lfs_token",we.bind(null,t));t.$input_container.on("mousedown",".lfs_token",ke.bind(null,t));t.$list_container.on("mousedown",xe.bind(null,t));t.$list_container.on("mouseup",Ce.bind(null,t));t.$list_container.on("mousemove",".lfs_item",Me.bind(null,t));t.$list_container.on("mouseleave",".lfs_item.active",Ie.bind(null,t));var n=null===_.get(TSSSB,"env.desktop_app_version")?"click":"mousedown";t.$list_container.on(n,".lfs_item",Pe.bind(null,t));t.onReady()};var a=function e(t,r,n){var i=$(r);n=n||{};var a=n.force_selected||b(t,r);var s=r.disabled||r.lfs_disabled;if(t.restrict_preselected_item_removal&&r.preselected)s=true;var o;if(n.should_tokenize&&_.isFunction(t.tokenTemplate))o=t.tokenTemplate(r);else if(t.single&&_.isFunction(t.tokenTemplateSingle))o=t.tokenTemplateSingle(r);else o=t.template(r);var l=Z(i.data("lfs-item-desc"),t);var u={active:""!==t._previous_val&&!a&&!s,disabled:s,lfs_token:n.should_tokenize,selected:a,single:t.single,group_item:i.hasClass("group_item")};if(_.isFunction(t.tokenClass))u[t.tokenClass(r)]=true;return TS.templates.lazy_filter_select_item({content:o,icon:i.data("lfs-item-icon"),desc:new Handlebars.SafeString(l),applied_classes:TS.utility.getAppliedClasses(u),lfs_id:r.lfs_id,data_qa:t.data_qa}).replace(/(\r\n|\n|\r)/gm,"")};var s="position_above";var o="show_status";var l=function e(t){if(!t._list_built&&!t._showing_status)return;t.$list_container.removeClass(s);var r=t.$list.css("max-height");t.$list.css({"max-height":0});var n=t.$list[0].scrollHeight;var i=parseInt(t.$list_container.css("padding-top"),10)+parseInt(t.$list_container.css("padding-bottom"),10)+parseInt(t.$list_container.css("border-top-width"),10)+parseInt(t.$list_container.css("border-bottom-width"),10)+parseInt(t.$list_container.css("margin-top"),10)+parseInt(t.$list_container.css("margin-bottom"),10);if(re(t))i+=t.$filter_input.outerHeight()+parseInt(t.$filter_input.css("margin-bottom"),10);var a=parseInt(t.$list_container.css("max-height"),10);var o=2*t.approx_item_height+i;var l=Math.min(n+i,a);var u=$(window).height();var d=t.$input_container[0].getBoundingClientRect().bottom+parseInt(t.$input_container.css("margin-bottom"),10);var _=t.adjustAvailableSpaceBelow(u-d);if(t.allow_list_position_above){var c=t.$input_container[0].getBoundingClientRect().top+parseInt(t.$input_container.css("margin-top"),10);var m=t.adjustAvailableSpaceAbove(c);var f=m>=l;var p=_>=l&&_>o;if(f&&!p){_=m;t.$list_container.addClass(s)}}var h=Math.floor(Math.min(_,l)-i);t.$list.css({"max-height":h||r})};var u=function e(t,r,n){if(H(t))t._running_promise.cancel("Scrolling happened");if(t._all_done_fetching)return;t._running_promise=t.data_promise(r,n).then(function(e){var r=e;if(r.items)r=r.items;if(r&&r.length){t._page_number+=1;if(!t._current_data)t._current_data=t.data.slice();if("undefined"!==typeof e.all_items_fetched)t._all_done_fetching=!!e.all_items_fetched;if("undefined"!==typeof e.num_remaining&&0===e.num_remaining)t._all_done_fetching=true;var n;var i=parseInt(e.num_new,10)||0;n=r.slice(-i);if(n.length){if(e._replace_all_items||e.replace_all_items)t._current_data=n;else t._current_data=t._current_data.concat(n);m(t,t._current_data)}else t._all_done_fetching=true}else t._all_done_fetching=true},function(e){TS.console.logError(e,"LFS error");ie(t,e,"Something failed while trying to return the next batch of data for lazyFilterSelect.")})};var d=function e(t){return t._selected.length<t.max_selected_items};var c=function e(t){if(t.disabled)return;t.disabled=true;t.$container.addClass("disabled");t.$input.prop("disabled",true);t.$filter_input.prop("disabled",true)};var m=function e(t,n){I(t,n);C(t,n);var i=t._list_built&&(!t.data||0===t.data.length||t.always_visible);if(i)W(t,true);r(t)};var f=function e(t){if(!t.disabled)return;t.disabled=false;t.$container.removeClass("disabled");t.$input.prop("disabled",false);t.$filter_input.prop("disabled",false)};var p=function e(t,r){var n=t.data;var i=[];for(var a=0;a<n.length;a+=1){var s=n[a];if(s.lfs_group||s.is_divider){var o=[];for(var l=0;l<s.children.length;l+=1){var u=s.children[l];if(t.filter(u,r))o.push(u)}if(o.length>0)i.push({is_divider:true,lfs_group:true,label:s.label,children:o})}else if(t.filter(s,r))i.push(s)}return i};var h=function e(t){return t.attr("data-lfs-id")||t.prop("lfs_id")||null};var g=function e(t,r,n){var i=h(r);var a;if(n)a=t._selected;else{a=t.data_promise&&t._current_data?t._current_data:t.data;if(-1!==i.indexOf(".")){var s=parseInt(i.split(".")[0],10);a=a[s]?a[s].children:a[0].children}}var o=a.filter(function(e){return e.lfs_id===i});if(o.length)return o[0];return null};var S=function e(t,r){var n=parseInt(r.attr("data-lfs-slug-id"),10);var i=t._selected;var a=i.filter(function(e){return e.lfs_slug_id===n});if(a.length)return a[0];return null};var T=function e(t,r){r=r||{};var n=!t._list_visible||t.always_visible||t.disabled;if(n&&!r.force)return;t._list_visible=false;t.$list_container.removeClass("visible");t.$container.removeClass("list_visible");t.$input_container.removeClass("active");if(t._list_built)t.$list.longListView("setHidden",true);t._$active=null;t.onListHidden()};var v=function e(t){if(!t.sluggify.enabled)return false;else if(!t.sluggify.delimiter){TS.error("You must pass a delimiter regular expression to use sluggify with lazyFilterSelect.");return false}else if(!t.sluggify.key_name){TS.error("You must pass a key name to use sluggify with lazyFilterSelect.");return false}else if(t.single){TS.error("Sluggify only works in multi-select versions of lazyFilterSelect.");return false}return true};var b=function e(t,r){if(!t._selected.length)return false;var n=t._selected.filter(function(e){return e.lfs_id===r.lfs_id});return!!n.length};var y=function e(t){if(t instanceof jQuery)return!!t.attr("data-lfs-slug-id");return void 0!==t.lfs_slug_id};var w=function e(t,n,i){if(!v(t))return;if(!y(n))return;var a=$(n);var s=Z(a.data("lfs-item-desc"),t);t._slug_id_counter=Math.max(n.lfs_slug_id,t._slug_id_counter)+1;t._selected.push(n);var o;var l=TS.templates.lazy_filter_select_item({content:t.tokenTemplate(n),icon:a.data("lfs-item-icon"),desc:new Handlebars.SafeString(s),applied_classes:"lfs_token",slug_id:n.lfs_slug_id,data_qa:t.data_qa}).replace(/(\r\n|\n|\r)/gm,"");o=$(l);o.insertBefore(t.$input);r(t);if(t.sluggify.validator)t.sluggify.validator(o);t.data=i.filter(function(e){return e.lfs_slug_id!==n.lfs_slug_id});return t.data};var k=function e(t){var r=t.children("option, optgroup");var n=r.length>0?[]:void 0;r.each(function(){if("OPTGROUP"===$(this).prop("tagName")){var e=$(this).children("option").toArray();if($(this).prop("disabled"))e=e.map(function(e){e.lfs_disabled=true;return e});n.push({is_divider:true,lfs_group:true,label:$(this).prop("label"),children:e})}else n.push(this)});return n};function x(e){var t=k(e);t=t.map(function(e,t){if(e instanceof HTMLOptionElement)e={id:String(e.lfs_id||t),original_item:e,label:$(e).text(),value:e.value,preselected:e.selected};return e});return t}var C=function e(t,r){if(!r)r=t.data;if(!r){ie(t);return}if(0===r.length){ae(t);return}le(t,{keep_input_active:true});if(!t._list_built){if(!t.data||0===t.data.length)t.data=r;z(t)}else{var n=M(r);t.$list.longListView("setItems",n,true);t._current_data=r;Q(t)}l(t)};var M=function e(t){var r=[];t.forEach(function(e){r.push(e);if(e.children&&e.children.length)for(var t=0;t<e.children.length;t+=1)r.push(e.children[t])});return r};var I=function e(t,r){if(!r)r=t.data;if(!r)return;var n="";var i=!t.single;var s=0;while(s<r.length){var o=r[s];if(y(o)){r=w(t,o,r);continue}if(o.children&&o.children.length)o.lfs_group=true;if(o.lfs_group||o.is_divider){o.is_divider=true;var l=s;for(var u=0;u<o.children.length;u+=1){var d=o.children[u];d.lfs_id=d.lfs_id||l+"."+u;if((d.selected||d.preselected)&&false===t.no_default_selection){if(t.single&&t._selected.length>0||b(t,d))continue;t._selected.push(d);n+=a(t,d,{should_tokenize:i})}}}else{o.lfs_id=o.lfs_id||String(s);if((o.selected||o.preselected)&&false===t.no_default_selection){if(t.single&&t._selected.length>0||b(t,o)){s+=1;continue}t._selected.push(o);n+=a(t,o,{should_tokenize:i})}}s+=1}if(n.length>0){t.$container.addClass("value");if(t.single)t.$lfs_value.html(n);else{$(n).insertBefore(t.$input);t.$input_container.removeClass("empty");t.$input_container.removeClass("error");ee(t)}}};var P=function e(t){while(t.$input_container.find(".lfs_token").length>0)A(t)};var A=function e(t){var r=t.$input_container.find(".lfs_token").last();if(r.length)E(t,r)};var E=function e(t,r){if(t.disabled)return;if(y(r)){F(t,r);return}var n=g(t,r,true);if(n.disabled||t.restrict_preselected_item_removal&&n.preselected)return;t._selected=t._selected.filter(function(e){return e!==n});var i=t.$list.find('[data-lfs-id="'+n.lfs_id+'"]');i.removeClass("selected");r.remove();X(t);if(t.$filter_input.val().length+t._selected.length===0)G(t);if(0===t._selected.length)t.$container.removeClass("value");t.onItemRemoved(n)};var F=function e(t,r){if(!v(t))return;var n=S(t,r);t._selected=t._selected.filter(function(e){return e!==n});r.remove();X(t);if(t.$filter_input.val().length+t._selected.length===0)G(t);t.onItemRemoved(n)};var O=function e(){if(this.data&&0===this.data.length)TS.warn("Data passed to lazyFilterSelect is empty.");J(this,this.data);if(this.always_visible)W(this);if(this.restrict_input_container_height){this.$container.addClass("has_restricted_input_container_height");if(!TS.environment.supports_custom_scrollbar)this.$input_container.monkeyScroll()}};var B=function e(t,n,i){if(t.disabled)return;if(n===t._previous_val)return;t._all_done_fetching=false;t._previous_val=n;t._$active=null;r(t);t._page_number=1;if(t._list_built)t.$list.longListView("scrollToTop",true);if(t.data_promise){if(H(t))t._running_promise.cancel("User entered more text");t._running_promise=D(t,n).then(function(e){m(t,e);W(t,i)},function(e){TS.console.logError(e,"LFS error");ie(t,e,"Something failed while trying to return the filtered data for lazyFilterSelect.")})}else{W(t,i);var a=p(t,n);C(t,a);r(t)}};var D=function e(t,r){return new Promise(function(e,n){if(r.length<t.min_query_length){t._all_done_fetching=true;e([])}else{_.delay(function(){if(H(t))se(t)},650);t.data_promise(r).then(function(r){r=r||{};if(!_.isUndefined(r.all_items_fetched))t._all_done_fetching=!!r.all_items_fetched;if(0===r.num_remaining)t._all_done_fetching=true;var n=(r.items||r).slice();e(n);le(t,{keep_input_active:true})},function(e){n(e);le(t)})}})};var H=function e(t){return t._running_promise&&t._running_promise.isPending()};var j=function e(t,r){if(t.disabled)return;if(!t._list_visible){W(t);return}var n;if(!t._$active)n=t.$list.find(".lfs_item:not(.disabled, .hidden)").first();else n=t._$active[r](".lfs_item:not(.disabled, .hidden)").first();if(n.length){n.scrollintoview({duration:0});if(t._$active)t._$active.removeClass("active");n.addClass("active");t._$active=n}};var R=function e(t){return!(t.hasClass("selected")||t.hasClass("disabled"))};var L=function e(t,r){if(!d(t))return;if(t.single&&t._selected.length){var n=t.$list.find('[data-lfs-id="'+t._selected[0].lfs_id+'"]');n.removeClass("selected");t._selected.length=0;t.$lfs_value.empty()}t._selected.push(r);X(t);var i=$(a(t,r,{should_tokenize:!t.single}));if(_.isFunction(t.tokenClass))i.addClass(t.tokenClass(r));if(t.single)t.$lfs_value.html(i);else{i.addClass("lfs_token");i.insertBefore(t.$input)}if(!t.single){t.$input_container.removeClass("empty");t.$input_container.removeClass("error");ee(t)}t.$container.addClass("value");t.onItemAdded(r);if(!d(t))t.onMaxItemsSelected();if(!t.single)t.$filter_input.focus()};var N=function e(t){return j(t,"nextAll")};var U=function e(t){if(t.disabled)return;var r=t._$active;if(!r.length)return;if(!R(r))return;if(!d(t))return;r.addClass("selected");r.removeClass("active");t._$active=null;var n=g(t,r);L(t,n)};var q=function e(t){return j(t,"prevAll")};var G=function e(t){t.$input_container.addClass("empty");te(t)};var W=function e(t,r){if(t.disabled)return;TS.utility.rAF(function(){t.$filter_input.focus()});if(t._list_visible)return;if(t._showing_status&&t.always_visible)return;if(!t._list_built)z(t);if(t._list_built||t._showing_status){t._list_visible=true;t.$list_container.addClass("visible");t.$container.addClass("list_visible");if(!re(t))t.$input_container.addClass("active");if(t._list_built)t.$list.longListView("setHidden",false)}if(t.single&&!r){t.$filter_input.val("");t._previous_val="";t.$filter_input.focus();if(ne(t))t.data=[];C(t)}if(t.set_height){l(t);if(t.monkey_scroll&&!TS.environment.supports_custom_scrollbar)t.$list.monkeyScroll()}t.onListShown()};var z=function e(t){if(!t.data||0===t.data.length)return;var r=M(t.data);t._list_built=true;var i={items:r,approx_item_height:t.approx_item_height,approx_divider_height:t.approx_divider_height,preserve_dom_order:true,calcDividerHeight:function e(t){return t.outerHeight()},makeDivider:function e(){return $('<div class="lfs_group"></div>')},makeElement:function e(){return $(TS.templates.lazy_filter_select_item().replace(/(\r\n|\n|\r)/gm,""))},renderDivider:function e(r,n,i){if(t.renderDividerFunc)return t.renderDividerFunc(r,n,i);r.html(Z(n.label,t))},renderItem:function e(r,n,i){if(t.render_item_func)return t.render_item_func(r,n,i);var a=$(n);var s="active selected disabled single group_item lfs_token";var o={disabled:n.disabled||n.lfs_disabled,selected:b(t,n),single:t.single,group_item:a.hasClass("group_item")};if(_.isFunction(t.listItemClass))o[t.listItemClass(n)]=true;var l=TS.utility.getAppliedClasses(o);var u={"data-qa":t.data_qa+"-item-"+n.lfs_id,"data-lfs-id":n.lfs_id,title:n.title};r.attr(u).removeClass(s).addClass(l).html(t.template(n).string);if(a.data("lfs-item-icon")){var d="url("+a.data("lfs-item-icon")+")";var c=$('<span class="lfs_item_icon">').css("background-image",d);r.prepend(c)}if(a.data("lfs-item-desc")){var m=Z(a.data("lfs-item-desc"),t);var f=$('<span class="lfs_item_desc">').html(m);r.append(f)}}};t.$list.longListView(i);n(t);t.$list_items=t.$container.find(".list_items");TS.utility.rAF(function(){if(t.monkey_scroll&&!TS.environment.supports_custom_scrollbar)t.$list.monkeyScroll();t.$list.longListView("resizeImmediately");TS.utility.rAF(function(){t.current_items_in_view_signal.dispatch(t.$list.longListView("getCurrentItemsInView")||[])})});if(t.$list.longListView("getCurrentItemsInViewSignal"))t.$list.longListView("getCurrentItemsInViewSignal").add(function(e){t.current_items_in_view_signal.dispatch(e)})};var K=function e(t){t.stopPropagation();t.preventDefault()};var V=function e(t,r){if(t.single||!t.allow_item_unselect)return;var n=g(t,r,true);r.removeClass("selected");t._selected=t._selected.filter(function(e){return e!==n});t.$input_container.find('.lfs_item[data-lfs-id="'+n.lfs_id+'"]').remove();X(t);if(t.$filter_input.val().length+t._selected.length===0)G(t);if(0===t._selected.length)t.$container.removeClass("value");t.onItemRemoved(n)};var Y=function e(t,n){if(!v(t)||!y(n))return;var i=n.text().trim();if(n.length)F(t,n);t.$filter_input.val(i);r(t);t.$filter_input.select()};var J=function e(t,r){t.data=r||k(t.$select);if(t.data){t._selected=[];I(t);if(t.$filter_input.val().length){var n=t.$filter_input.val();t._previous_val="";B(t,n)}}};var Q=function e(t){if(t.restrict_input_container_height)TS.ui.utility.updateClosestMonkeyScroller(t.$input_container,true);if(t.monkey_scroll&&!TS.environment.supports_custom_scrollbar){l(t);TS.utility.rAF(function(){TS.ui.utility.updateClosestMonkeyScroller(t.$list,true)})}};var X=function e(t){if(t.append)return;var r=t._selected.filter(function(e){return e instanceof HTMLOptionElement}).map(function(e){return $(e).val()});t.$select.val(r).trigger("change")};var Z=function e(t,r){t=_.escape(t);if(_.get(r,"should_graphic_replace_emoji"))t=TS.emoji.graphicReplace(t);return t};var ee=function e(t){t.$input.attr("placeholder","");if(re(t))t.$filter_input.attr("placeholder","")};var te=function e(t){t.$input.attr("placeholder",t.placeholder_text);if(re(t))t.$filter_input.attr("placeholder",t.filter_placeholder_text)};var re=function e(t){return t.style===TS.ui.lazy_filter_select.STYLES.filter_in_list};var ne=function e(t){return _.isFunction(t.data_promise)&&t.min_query_length};var ie=function e(t,r,n){oe(t,t.errorTemplate(r),{internal_error_message:n,clear_active_items:true})};var ae=function e(t){var r=t.noResultsTemplate(t.$filter_input.val());oe(t,r,{clear_active_items:true})};var se=function e(t){var r=TS.i18n.t("Loading results…","lazy_filter_select")();oe(t,r,{show_loading_indicator:true})};var oe=function e(t,r,n){n=n||{};t._showing_status=true;if(n.internal_error_message)TS.error(n.internal_error_message);if(!re(t))t.$input_container.addClass("active");if(n.show_loading_indicator)t.$status_loading_indicator.removeClass("hidden");if(n.clear_active_items)t._$active=null;t.$status_content.html(r);t.$list_container.addClass(o)};var le=function e(t,r){r=r||{};t._showing_status=false;if(!r.keep_input_active)t.$input_container.removeClass("active");t.$status_loading_indicator.addClass("hidden");t.$list_container.removeClass(o)};var ue=function e(t){t._prevent_blur=false};var de=function e(t){if(t.disabled)return;W(t)};var _e=function e(t,r){if(t.disabled)return;r.preventDefault();W(t)};var ce=function e(t){t.$input_container.click();t.$input.focus()};var me=function e(t){if(!t._input_is_focused){t._input_is_focused=true;t.$input_container.click();t.onInputFocus()}if(!t.single)t.$input_container.addClass("active")};var fe=function e(r){var n=r.$filter_input.val();if(v(r)&&n.match(r.sluggify.delimiter)){var i=n.split(r.sluggify.delimiter);i.forEach(function(e){if(e.length)t(r,e)})}else B(r,n,true)};var pe=function e(t,r){if(t.disabled)return;switch(r.keyCode){case TS.utility.keymap.down:K(r);N(t);break;case TS.utility.keymap.up:K(r);q(t);break;case TS.utility.keymap.enter:ge(t,r);break;case TS.utility.keymap.del:Se(t,r);break;case TS.utility.keymap.tab:Te(t,r);break;case TS.utility.keymap.esc:ve(t,r)}t.onKeyDown(r,r.isDefaultPrevented())};var he=function e(t){if(!t._prevent_blur){T(t);le(t)}t._input_is_focused=false;t.onInputBlur()};var ge=function e(t,r){if(t._$active&&t._$active.length&&t._list_visible){K(r);var n=t._$active;var i=!t.single&&t.allow_item_unselect&&b(t,g(t,n));if(i)V(t,n);else{if(!d(t))return;U(t);var a=$(r.currentTarget);if(""!==a.val()){a.val("");t._previous_val="";C(t)}if(t.single){T(t);le(t)}}}};var Se=function e(t,r){if(""===t.$filter_input.val()){K(r);var n=t.$input_container.find(".lfs_token").last();if(v(t)&&y(n))Y(t,n);else A(t)}};var Te=function e(r,n){if(r.$filter_input.val().trim()&&v(r)){K(n);t(r,r.$filter_input.val())}else if(r.tab_to_nav){K(n);if(n.shiftKey)q(r);else N(r)}};var ve=function e(t,r){K(r);T(t);le(t);t.$filter_input.blur()};var be=function e(t,r){if(t.disabled)return;r.stopPropagation();W(t);t._prevent_blur=false};var ye=function e(t,r){if(1===r.which)t._prevent_blur=true};var we=function e(t,r){if(t.disabled)return;E(t,$(r.currentTarget));t._prevent_blur=false};var ke=function e(t,r){if(1===r.which)t._prevent_blur=true};var xe=function e(t,r){if(1===r.which)t._prevent_blur=true};var Ce=function e(t){if(t._prevent_blur)t.$filter_input.focus()};var Me=function e(t,r){if(t.disabled)return;if(r.clientX==t._mouse.lastX&&r.clientY==t._mouse.lastY)return;var n=$(r.currentTarget);if(t._$active)t._$active.removeClass("active");if(!n.hasClass("active")&&R(n)){n.addClass("active");t._$active=n}t._mouse.lastX=r.clientX;t._mouse.lastY=r.clientY};var Ie=function e(t,r){$(r.currentTarget).removeClass("active");t._$active=null};var Pe=function e(t,r){if(t.disabled)return;r.preventDefault();var n=$(r.currentTarget);t._$active=n;var i=!t.single&&t.allow_item_unselect&&b(t,g(t,n));if(i)V(t,n);else{var a=R(n);if(!a&&!t.single)return;if(!d(t))return;if(!a&&t.single){T(t);r.stopPropagation();return}U(t);if(""!==t.$filter_input.val()){t.$filter_input.val("");t._previous_val="";C(t)}if(t.single){T(t);r.stopPropagation()}}t._prevent_blur=false}})()},4823:function(e,t){(function(){TS.registerModule("ui.people_picker",{STYLES:{normal:"normal",small:"small"},onStart:function e(){},preload:function e(r){t(r)("");return r},make:function e(r,n){n=n||{};if(!n.append)r.addClass("hidden");n.style=_.get(TS.ui.people_picker.STYLES,n.style,TS.ui.people_picker.STYLES.normal);r.lazyFilterSelect({append:!!n.append,always_visible:!!n.always_visible,approx_item_height:n.approx_item_height||50,data_promise:t(n),placeholder_text:n.placeholder_text||TS.i18n.t("Search by name","people_picker")(),classes:"people_picker",scroll_threshold:2500,single:!!n.single,style:n.style,sluggify:n.sluggify,disabled:n.disabled,template:n.template||function(e){var t=TS.templates.member_small({member:e.member});return new Handlebars.SafeString(t)},tokenTemplate:n.tokenTemplate||function(e){var t=TS.templates.member_token({member:e.member});return new Handlebars.SafeString(t)},tokenClass:function e(t){return TS.templates.builders.getMemberTypeClass(t.member)},noResultsTemplate:n.noResultsTemplate||function(e){if(!e)return TS.i18n.t("No one found","people_picker")();return TS.i18n.t("No one found matching <strong>{query}</strong>","people_picker")({query:_.escape(e)})},onItemAdded:n.onItemAdded,onItemRemoved:n.onItemRemoved})},value:function e(t){return t.lazyFilterSelect("value")},clearValue:function e(t){return t.lazyFilterSelect("clearValue")},recomputeHeight:function e(t){return t.lazyFilterSelect("recomputeHeight")}});var e=["include_slackbot","include_self","include_bots","only_local_team","only_admins"];var t=function e(t){var n={};var i={};if(t.preselected_ids&&t.preselected_ids.length)_.forEach(t.preselected_ids,function(e){if(e)i[e]=true});var a={};if(t.omitted_ids&&t.omitted_ids.length)_.forEach(t.omitted_ids,function(e){if(e)a[e]=true});var s=function e(s,o){if("@"===s.charAt(0))s=s.substring(1);if(""===s&&t.empty_query_result){if(o>0)return Promise.resolve([]);return Promise.resolve(t.empty_query_result.map(function(e){return{member:e,lfs_id:String(e.id),preselected:!!i[e.id]}}))}if(""===s&&t.initial_load_promise){if(_.isUndefined(o))return t.initial_load_promise;t.initial_load_promise=r(t.initial_load_promise,i,a);return t.initial_load_promise}if(n.query!==s){n.query=s;n.include_org=TS.boot_data.page_needs_enterprise;n.include_slackbot=!!t.include_slackbot;n.include_self=t.include_self;n.full_profile_filter=false;n.include_bots=!!t.include_bots;n.only_local_team=!!t.only_local_team;n.only_admins=!!t.only_admins}var l=TS.members.ensureMembersArePresent(i).then(function(){return r(n,i,a)});if(""===s&&!t.initial_load_promise)t.initial_load_promise=l;return l};return s};var r=function t(r,n,i){return Promise.resolve().then(function(){var e=[];var t=_.keys(n);t.forEach(function(t){var r=TS.members.getMemberById(t);if(!r)e.push(t)});if(e.length)return TS.members.ensureMembersArePresent(e).catch(_.noop);return Promise.resolve()}).then(function(){return TS.members.promiseToSearchMembers(r).then(function(t){var a=[];if(""===t.query){var s=_.pick(r,e);a=TS.members.getMembersWithOptions(s)}else a=t.items;t.items=a.filter(function(e){return!i[e.id]}).map(function(e){if(e.member&&"undefined"!==typeof e.preselected)return e;return{member:e,lfs_id:String(e.id),preselected:!!n[e.id]}});return t})})}})()},4824:function(e,t){(function(){TS.registerModule("dnd",{dnd_statuses_changed_sig:new signals.Signal,current_user_dnd_status_changed_sig:new signals.Signal,onStart:function e(){if(!TS.client)return;TS.redux.socket.connectedSig.add(h);TS.redux.socket.disconnectedSig.add(g);var t=_.random(i,n);var r=Math.round(t*a);TS.dnd.setApiDelays(t,r);TS.dnd.debouncedCheckForChanges=TS.utility.throttleFunc(TS.dnd.checkForChanges,500,true);if(TS.boot_data.feature_tinyspeck)m=true;else m=TS.utility.enableFeatureForUser(1);TS.presence_manager.sub_list_changed.add(S)},memberDndStatus:function e(){var t=TS.dnd.calculateMemberDndFromTimestamp(TS.model.user);var r=t&&TS.dnd.getSnoozeEnabled();var n=I(TS.model.user);var i;if(n&&r)i=E(n);else if(n){i=TS.interop.datetime.toTime(n,{do24hrTime:TS.utility.date.do24hrTime()});if(!TS.utility.date.do24hrTime())i=i.split(":00").join("")}return{in_dnd:t,snoozed:r,ends:n,readable_end_time:i}},setSnooze:function e(t){var r=function e(r,n){if(!r){TS.warn("dnd.setSnooze failed");return}if(TS.has_pri[D])B("dnd.setSnooze to "+t+" minutes. New end time is "+$(n.snooze_endtime))};return TS.api.call("dnd.setSnooze",{num_minutes:t}).then(function(e){var t=e.data,n=e.args,i=e.request_id;var a=true;r(a,t,n,i);return{data:t,args:n,request_id:i}}).catch(function(e){var t=e.data,n=e.args,i=e.request_id;var a=false;r(a,t,n,i);return{data:t,args:n,request_id:i}})},endSnooze:function e(){var t=function e(t){if(!t){TS.warn("dnd.endSnooze failed");return}if(TS.has_pri[D])B("dnd.endSnooze succeeded")};return TS.api.call("dnd.endSnooze",{}).then(function(e){var r=e.data,n=e.args,i=e.request_id;var a=true;t(a,r,n,i);return{data:r,args:n,request_id:i}}).catch(function(e){var r=e.data,n=e.args,i=e.request_id;var a=false;t(a,r,n,i);return{data:r,args:n,request_id:i}})},endDnd:function e(){var t=function e(t){if(!t){TS.warn("dnd.endDnd failed");return}if(TS.has_pri[D])B("dnd.endDnd succeeded")};return TS.api.call("dnd.endDnd",{}).then(function(e){var r=e.data,n=e.args,i=e.request_id;var a=true;t(a,r,n,i);return{data:r,args:n,request_id:i}}).catch(function(e){var r=e.data,n=e.args,i=e.request_id;var a=false;t(a,r,n,i);return{data:r,args:n,request_id:i}})},calculateMemberDndFromTimestamp:function e(t,r){var n;if(!r)r=A();var i=M(t);var a=I(t);if(t.is_self&&TS.dnd.getSnoozeEnabled()&&a)if(a>r)return true;if(null==i||null==a)return false;n=a>r&&(i<=r||i>a);return n},isMemberInDnd:function e(t){return!!TS.redux.dnd.isMemberInDndById(t.id)},checkForChanges:function e(){if(!TS.redux.socket.isConnected())return;if(m)TS.metrics.mark("dnd_check_for_changes");var t=false;var r=A();if(TS.dnd.getSnoozeEnabled())if(r>=TS.dnd.getSnoozeEndtime()){var n=false;var i=null;TS.redux.dnd.updateSnoozeScheduleForCurrentMember(n,i);t=true}if(_.size(TS.redux.dnd.getAllDndSchedules())>s){if(TS.has_pri[D])B("checkForChanges over limit, purging non-relevant dnd data");v()}var a=[];var o=[];var l=function e(n){if(!n||n.deleted)return;var i=TS.dnd.isMemberInDnd(n)||false;var s=TS.dnd.calculateMemberDndFromTimestamp(n,r);if(i!=s){f(n.id,s);if(n.is_self)t=true;o.push(n)}if(F(n,r))a.push(n)};var u=TS.redux.dnd.getAllDndSchedules();_.forOwn(u,function(e,t){var r=TS.members.getMemberById(t);l(r)});if(t&&!_.includes(o,TS.model.user))o.push(TS.model.user);if(o.length>0&&TS.has_pri[D])B("Processing DND status changes for "+o.length+" members");p(o);if(t){TS.dnd.current_user_dnd_status_changed_sig.dispatch();TSSSB.call("dndStatusChanged",TS.dnd.isMemberInDnd(TS.model.user));if(TS.has_pri[D])B("Current user DND status changed")}var d=0;var c=[];a=_.filter(a,function(e){var t=TS.presence_manager.isSubscribedToMember(e.id);if(!t){c.push(e.id);d+=1}return t});TS.redux.dnd.removeDndScheduleForMember(c);if(d&&TS.has_pri[D])B("checkForChanges discarded "+d+" stale members");TS.dnd.kickOffNextEventTimer();if(m)TS.metrics.measureAndClear("dnd_check_for_changes_lazy","dnd_check_for_changes");return a},debouncedCheckForChanges:function e(){},kickOffNextEventTimer:function e(){clearTimeout(u);var t=A();var r=b(t);if(TS.has_pri[D])B("next DND tick scheduled for "+$(r));var n=1e3*(r-t);d=r;u=setTimeout(function(){var e=TS.dnd.checkForChanges();if(e.length>1){TS.dnd.fetchMultipleMembers(e);if(TS.has_pri[D])B("DND refreshing "+e+" members")}else if(1===e.length){TS.dnd.refreshMember(e[0]);if(TS.has_pri[D])B("DND refreshing one member")}},n)},fetchMultipleMembers:function e(t){var r=k(t);if(r)return r.finally(TS.dnd.checkForChanges)},refreshMember:function e(t){var r=C(t);if(r)return r.finally(TS.dnd.checkForChanges)},updateUserPropsAndSignal:function e(t,r){if(!TS.redux.dnd.getDndScheduleByMemberId(t)){if(TS.has_pri[D])B("Ignoring new DND props for "+t);return}y(t,r);if(t===TS.model.user.id)TS.dnd.checkForChanges();else TS.dnd.debouncedCheckForChanges()},dndOverride:function e(t,r){var n=TS.shared.getModelObById(t);if(!n)return;var i=TS.utility.msgs.getMsg(r,n.msgs);if(!i)return;if(i._ignore_dnd)return;i._ignore_dnd=true;if(n.is_im)TS.ui.growls.growlImMessage(n,i);else TS.ui.growls.growlChannelOrGroupMessage(n,i)},getSnoozeEnabled:function e(){var t=TS.redux.dnd.getSnoozeScheduleForCurrentUser();if(!t)return false;return t.snoozeEnabled},getSnoozeEndtime:function e(){var t=TS.redux.dnd.getSnoozeScheduleForCurrentUser();if(!t)return null;return t.snoozeEndTs},getNextDndStartTs:function e(t){var r=TS.redux.dnd.getDndScheduleByMemberId(t);if(!r)return null;return r.nextDndStartTs},getNextDndEndTs:function e(t){var r=TS.redux.dnd.getDndScheduleByMemberId(t);if(!r)return null;return r.nextDndEndTs},debugInfo:function e(){var t=["DND debug info:"];t.push("next timer fires at "+$(d));t.push("_team_info_delay: "+o);t.push("_single_user_info_delay: "+l);t.push("_calcNextCheckTime: "+$(b()));var r="\n"+t.join("\n");TS.info(r)},debugMember:function e(t){var r=["DND member debugging:"];r.push("is in DND: "+!!TS.dnd.isMemberInDnd(t)+" ("+TS.dnd.calculateMemberDndFromTimestamp(t)+")");r.push("start: "+$(M(t),true));r.push("end  : "+$(I(t),true));r.push("next : "+$(P(t),true));r.push("stale? "+F(t));var n=I(t);if(n&&O(n))r.push("Probably a snooze");else if(n)r.push("Probably a scheduled DND");var i="\n"+r.join("\n");TS.info(i)},setApiDelays:function e(t,r){o=t;l=r},test:function e(){return{fetchUsersInfo:k,calcNextCheckTime:b,snoozeReadableCountdown:E,updateUserDndProps:y,timeWasProbablyASnooze:O,memberHasStaleTimes:F,ensureDndTimesForMemberIds:T,purgeNonRelevantData:v,requested_member_ids:c}}});var e=15;var t=300;var r=100;var n=1500;var i=10;var a=.01;var s=1500;var o=n;var l=i;var u;var d;var c={};var m=false;var f=function e(t,r){TS.redux.dnd.updateDndForMember(t,r)};var p=function e(t){t=_.filter(t,function(e){if(e.is_self)return true;return TS.presence_manager.isSubscribedToMember(e.id)});if(t.length)TS.dnd.dnd_statuses_changed_sig.dispatch(t)};var h=function e(t){if(!t){v();var r=TS.presence_manager.getSubList();if(!_.includes(r,TS.model.user.id))r.push(TS.model.user.id);var n=true;T(r,n)}TS.dnd.checkForChanges()};var g=function e(){clearTimeout(u)};var S=function e(){T(TS.presence_manager.getSubList())};var T=function e(t,r){if(!t||!t.length)return Promise.resolve();var n=_.map(t,TS.members.getMemberById);n=_.filter(n,function(e){return e&&!e.is_bot&&!e.deleted&&e._is_local});if(!r)n=_.filter(n,function(e){return!c[e.id]&&!TS.redux.dnd.getDndScheduleByMemberId(e.id)});if(!n.length)return Promise.resolve();t=_.map(n,"id");var i=_.groupBy(t);_.forEach(t,function(e){c[e]=true});if(TS.has_pri[D])B("_ensureDndTimesForMemberIds requesting "+t.length);if(m)TS.metrics.count("dnd_lookup_lazy",t.length);return TS.api.call("dnd.teamInfo",{users:t.join(",")}).then(function(e){var r=e.data;var n=[];if(r.users){var a=[];var s=true;_.forOwn(r.users,function(e,t){n.push(t);if(i[t])a.push(y(t,e,s))});TS.redux.dnd.updateDndScheduleForMembers(a)}if(TS.boot_data.feature_tinyspeck){var o=[];_.forEach(t,function(e){if(!TS.redux.dnd.getDndScheduleByMemberId(e)){if(TS.has_pri[D])B("dnd lookup failed for "+e);o.push(e)}});if(o.length){TS.metrics.count("dnd_lookup_failed",o.length);var l={requested:t,received:n,missing:o};TS.console.logError(l,"dnd_lookup_failed_members",null,true)}}TS.dnd.checkForChanges()}).catch(function(e){if(TS.boot_data.feature_tinyspeck)TS.console.logError(e,"dnd_lookup_request_failed")}).finally(function(){_.forEach(t,function(e){delete c[e]})})};var v=function e(){var t=_.groupBy(TS.presence_manager.getSubList());var r=[];var n=TS.redux.dnd.getAllDndSchedules();_.forOwn(n,function(e,n){if(t[n])return;if(n===TS.model.user.id)return;r.push(n);f(n,false)});var i=_.map(r,TS.members.getMemberById);i=_.compact(i);p(i);TS.redux.dnd.removeDndScheduleForMember(r);if(TS.has_pri[D])B("_purgeNonRelevantData dropped "+r.length)};var b=function r(n){var i;if(!n)n=A();var a=P(TS.model.user,n);if(a)i=a;var s=function e(t){if(t.id==TS.model.user.id)return;var r=P(t,n);if(!r)return;if(!i||r<i)i=r};var o=TS.redux.dnd.getAllDndSchedules();_.forOwn(o,function(e,t){var r=TS.members.getMemberById(t);if(r)s(r)});var l=t+n;if(!i||i>l)i=l;var u=e+n;if(i<u)i=u;return i};var y=function e(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:false;if(t===TS.model.user.id)if("snooze_enabled"in r||"snooze_endtime"in r)TS.redux.dnd.updateSnoozeScheduleForCurrentMember(r.snooze_enabled,r.snooze_endtime);if(n){if(r.dnd_enabled)return{memberId:t,nextDndStartTs:r.next_dnd_start_ts,nextDndEndTs:r.next_dnd_end_ts};return{memberId:t,nextDndStartTs:null,nextDndEndTs:null}}if(r.dnd_enabled)TS.redux.dnd.updateDndScheduleForMember(t,r.next_dnd_start_ts,r.next_dnd_end_ts);else TS.redux.dnd.updateDndScheduleForMember(t,null,null)};var w=false;var k=function e(t){if(w)return;w=true;if(m)TS.metrics.count("dnd_lookup_lazy",t.length);var r=_.map(t,"id").join(",");var n=function e(t,r){w=false;if(!t){TS.warn("dnd.teamInfo failed for a multi-user request");return}if(r.users){var n=true;var i=_.map(r.users,function(e,t){return y(t,e,n)});TS.redux.dnd.updateDndScheduleForMembers(i)}};return TS.api.call("dnd.teamInfo",{users:r},null,true).then(function(e){var t=e.data,r=e.args,i=e.request_id;var a=true;n(a,t,r,i);return{data:t,args:r,request_id:i}}).catch(function(e){var t=e.data,r=e.args,i=e.request_id;var a=false;n(a,t,r,i);return{data:t,args:r,request_id:i}})};var x=[];var C=function e(t){if(-1!==x.indexOf(t.id))return;x.push(t.id);if(x.length>1)return;return new Promise(function(e,t){setTimeout(function(){var n=x;x=[];var i="dnd.info";var a={user:n[0]};if(n.length>1){i="dnd.teamInfo";a=n.length>r?{}:{users:n.join(",")}}if(m)TS.metrics.count("dnd_lookup_lazy",n.length);var s=function r(i,a){if(!i){if(n.length>1)TS.warn("dnd.teamInfo failed for a multi-user request (bundled single-user fetches)");else{TS.warn("dnd.info failed for "+n[0]);t(new Error("dnd.info failed for "+n[0]))}return}if(a.users){var s=true;var o=_.map(a.users,function(e,t){return y(t,e,s)});TS.redux.dnd.updateDndScheduleForMembers(o)}else y(n[0],a);e()};TS.api.call(i,a,null,true).then(function(e){var t=e.data,r=e.args,n=e.request_id;var i=true;s(i,t,r,n);return{data:t,args:r,request_id:n}}).catch(function(e){var t=e.data,r=e.args,n=e.request_id;var i=false;s(i,t,r,n);return{data:t,args:r,request_id:n}})},1e3*l)})};var M=function e(t){return TS.dnd.getNextDndStartTs(t.id)};var I=function e(t){if(t.is_self)if(TS.dnd.getSnoozeEnabled())return TS.dnd.getSnoozeEndtime();return TS.dnd.getNextDndEndTs(t.id)};var P=function e(t,r){if(!r)r=A();var n=M(t);var i=I(t);if(n&&i)if(n>r&&n<i)return n;if(i){if(i>r)return i;var a=i+o;if(a>=r)return a}return null};var A=function e(){return Math.floor(Date.now()/1e3)};var E=function e(t){var r=t-A();if(r<0)return TS.i18n.t("0s","dnd")();var n;var i;n=r/3600;if(n>=1){n=Math.floor(n);i=(r-3600*n)/60;i=Math.round(i);if(60===i){n+=1;return TS.i18n.t("{dnd_hours}h","dnd")({dnd_hours:n})}if(0===i)return TS.i18n.t("{dnd_hours}h","dnd")({dnd_hours:n});return TS.i18n.t("{dnd_hours}h {dnd_minutes}m","dnd")({dnd_hours:n,dnd_minutes:i})}i=r/60;if(i>=1){i=Math.round(i);if(60===i)return TS.i18n.t("1h","dnd")();return TS.i18n.t("{dnd_minutes}m","dnd")({dnd_minutes:i})}return TS.i18n.t("{dnd_remaining}s","dnd")({dnd_remaining:r})};var F=function e(t,r){if(!r)r=A();var n=I(t);if(!n||n>r)return false;var i=r-n;if(O(n))return true;return i>=o};var O=function e(t){var r=new Date(1e3*t);var n=r.getSeconds();var i=r.getMinutes();var a=0===n&&(0===i||30===i);return!a};var B=function e(t){TS.log(D,t)};var $=function e(t,r){if(!t)return"<null>";var n=new Date(1e3*t);if(r)return n.toTimeString()+" ("+n.toDateString()+")";return n.toTimeString()};var D=2002})()},4825:function(e,t){(function(){TS.registerModule("ui.messages",{onStart:function t(){var r=$("body");r.on("click.msg_action","ts-message",function(t){if(TS.client&&TS.client.ui.checkForEditing(t))return;e(t)});r.delegate("ts-message.dirty_hover_container","mouseenter",function(e){TS.ui.messages.updateMessageHoverContainer($(e.currentTarget))})},maybeUpdateMessageHoverContainer:function e(t){if(!t.length)return;if(t.is(":visible"))TS.ui.messages.updateMessageHoverContainer(t);else t.addClass("dirty_hover_container")},updateMessageHoverContainer:function e(t){t.removeClass("dirty_hover_container");var r=t.data("model-ob-id");var n=r?TS.shared.getModelObById(r):TS.shared.getActiveModelOb();if(!n)return;var i=t.attr("data-ts");var a=TS.utility.msgs.getMsg(i,n.msgs);if(!a&&n._archive_msgs)a=TS.utility.msgs.getMsg(i,n._archive_msgs);if(!a&&TS.model.unread_view_is_showing)a=TS.client.unread.getMessage(n,i);if(!a)a=TS.ui.replies.getActiveMessage(n,i);if(!a)a=TS.client.threads.getMessage(n,i);if(!a){TS.error(i+" not found in "+r);return}var s=t.find("[data-js=action_hover_container]");var o=t.closest("ts-conversation").length>0;var l=t.closest("#threads_msgs").length>0;var u=TS.boot_data.feature_sli_briefing&&t.closest("#sli_briefing").length>0;var d=o||l;var _=!a.thread_ts||a.thread_ts===a.ts;var c="tombstone"===a.subtype&&n.is_channel&&!n.is_member;s.html(TS.templates.action_hover_items({msg:a,actions:TS.utility.msgs.getMsgActions(a,n),ts_tip_delay_class:"ts_tip_delay_60",is_in_threads_view:l,is_in_thread:d,is_root_msg:_,is_briefing_msg:u,hide_actions_menu:c,show_rxn_action:!!s.data("show_rxn_action"),show_reply_action:!!s.data("show_reply_action"),show_comment_action:!!s.data("show_comment_action"),abs_permalink:s.data("abs_permalink")}));s.toggleClass("narrow_buttons",s.children().length>3)}});var e=function e(t){if(TS.isPartiallyBooted()){TS.incremental_boot.userDidInteractWithUI();t.preventDefault();return}var r=$(t.target);var n=r.closest("[data-action]");if(n.length){var i=r.closest("ts-message");var a=i.data("model-ob-id");var s=a?TS.shared.getModelObById(a):TS.shared.getActiveModelOb();var o=i.attr("data-ts");var l=TS.utility.msgs.getMsg(o,s.msgs);var u=n.data("action");var d=false;if(!l){l=TS.utility.msgs.getMsg(o,s._archive_msgs);if(l)d=true}if(!l)l=TS.ui.replies.getActiveMessage(s,o);if(!l&&TS.model.threads_view_is_showing)l=TS.client.threads.getMessage(s,o);if(!l&&TS.model.unread_view_is_showing){l=TS.client.unread.getMessage({id:a},o);if(l){var _=TS.client.unread.getGroup(a);if(_)s=_.model_ob;else if(TS.highlights_briefing){var c=TS.highlights_briefing.getMessageFromCache(a,o);if(c)s=TS.shared.getModelObById(c.channel_id)}}}if(!l){TS.error("WTF no message to click?");return}var m=TS.rxns.getRxnKeyByMsgType(l);var f;switch(u){case"actions_menu":if(d)TS.menu.startWithMessageActions(t,i.data("ts"),s._archive_msgs,s);else TS.menu.startWithMessageActions(t,i.data("ts"),s.msgs,s);TS.clog.track("PFP_ACTION",{contexts:{growth:{action:"click",trigger:"message_action_actions_menu_button"}}});break;case"reaction":if(TS.model.unread_view_is_showing&&TS.client.unread.shouldRecordMetrics())TS.metrics.count("unread_view_emoji_reaction");TS.ui.react_emoji_menu.start({e:t,rxn_key:m});TS.clog.track("PFP_ACTION",{contexts:{growth:{action:"click",trigger:"message_action_reaction_button"}}});break;case"pin":TS.pins.startPinMessage(o,s);break;case"unpin":TS.pins.unPinMessage(o,s);break;case"edit":TS.msg_edit.startEdit(o,s);break;case"delete":TS.msg_edit.startDelete(o,s);break;case"mark_unread":TS.info("_msgActionHandler: setting unread point on "+s.id+", ts = "+o+" (mark_unread)");TS.client.msg_pane.setUnreadPoint(o);break;case"reply":if(i.length){if(TS.model.unread_view_is_showing&&TS.client.unread.shouldRecordMetrics())TS.metrics.count("unread_view_reply");f=l.thread_ts||l.ts;if(TS.boot_data.feature_message_replies_inline)TS.ui.thread.startInlineThread(s,l,i);else TS.ui.replies.openConversationFromMessagePane(i,s,f)}TS.clog.track("PFP_ACTION",{contexts:{growth:{action:"click",trigger:"message_action_reply_button"}}});break;case"open_in_channel":if(TS.web){var p=TS.utility.msgs.constructMsgPermalink(s,o);window.location=p}else if(TS.client){if(TS.model.threads_view_is_showing)TS.client.ui.threads.trackThreadsViewClosed("OPEN_IN_CHANNEL");f=l.thread_ts||l.ts;TS.client.ui.tryToJump(s.id,f)}break;case"open_in_channel_from_briefing":if(TS.boot_data.feature_sli_briefing&&TS.highlights_briefing)TS.highlights_briefing.jumpToMessageInChannel(s.id,l.thread_ts||l.ts);break;case"open_conversation":break;case"copy_link":var h=TS.i18n.t("Copied!","messages_action_items")();TS.tips.updateFloater({title:h,classes_to_add:["success"]});TS.clipboard.writeText(n.data("permalink"));break;case"comment":if(TS.client){t.preventDefault();var g="";var S=null;TS.client.ui.files.previewFile(l.file.id,g,false,true,S)}break;case"share_message":if(TS.model.unread_view_is_showing&&TS.client.unread.shouldRecordMetrics())TS.metrics.count("unread_view_share_message");TS.ui.share_message_dialog.start(l.ts,s);TS.clog.track("PFP_ACTION",{contexts:{growth:{action:"click",trigger:"message_action_share_button"}}});break;case"add_handy_rxn":var T=n.data("name");var v=!TS.rxns.doesRxnsHaveRxnFromUser(TS.rxns.getExistingRxnsByKey(m),T);if(v)i.addClass("just_added_handy_rxn_from_actions");TS.rxns.changeRxnsFromUserAction(m,T,v);break;case"share_file":var b=l.file;if(!b)return;if(TS.client)TS.view.files.shareInCurrentChannelOrIM(b.id,a);else TS.ui.share_dialog.start(b.id);break;default:TS.error("WTF no action?")}}}})()},4826:function(e,t){(function(){TS.registerModule("click",{onStart:function e(){r();t()},addHandler:function t(r,n,i){if(_.isFunction(r)){i=n;n=r;r=null}e.push({selector:r,fn:n,prevent_on_drag:i||false})},addClientHandler:function e(){if(!TS.client)return;return TS.click.addHandler.apply(this,arguments)},addWebHandler:function e(){if(!TS.web)return;return TS.click.addHandler.apply(this,arguments)},test:function n(){return{addAll:t,setupBinding:r,handlers:function t(){return e},resetHandlers:function t(){e=[]},unbind:function e(){$("body").off("click.ts_dot_click");$("body").off("mousedown.ts_dot_click_mousedown")}}}});var e=[];var t=function e(){TS.click.addClientHandler("#archive_msg_lim_btn, #msg_lim_header_btn",function(e,t){TS.clog.track("GROWTH_PRICING",{contexts:{ui_context:{step:"history",action:"click",ui_element:t.data("data-clog-ui-element")}}})});TS.click.addClientHandler(function(e){if(TS.client.ui.checkForEditing(e))e.preventDefault()});TS.click.addWebHandler("#msgs_div",function(e){if(!TS.utility.isSpaceClickEventSafe(e))e.preventDefault()});var t=["[data-ts]","[data-member-id]","[data-channel-id]","[data-user-group-id]","[data-file-id]"].join(", ");TS.click.addClientHandler(t,function(e){if(!e.altKey||!e.shiftKey)return;var r=$(e.target).closest(t);if(!r.length)return;var n=r.attr("data-ts");if(n){var i=r.attr("data-model-ob-id");var a=TS.utility.msgs.findMsg(n,i);if(a){e.preventDefault();TS.dir(0,a);return}}var s=r.attr("data-member-id");if(s){var o=TS.members.getMemberById(s);if(o){e.preventDefault();TS.dir(0,o);return}}var l=r.attr("data-channel-id");if(l){var u=TS.channels.getChannelById(l);if(u){e.preventDefault();TS.dir(0,u);return}}var d=r.attr("data-user-group-id");if(d){var _=TS.user_groups.getUserGroupsById(d);if(_){e.preventDefault();TS.dir(0,_);return}}var c=r.attr("data-file-id");if(c){var m=TS.files.getFileById(c);if(m){e.preventDefault();TS.dir(0,m)}}});TS.click.addClientHandler("#msgs_div .message[data-ts]",function(e){var t=$(e.target);var r=t.closest(".message").data("ts");if(r)r=r.toString();var n=TS.shared.getActiveModelOb();if(!r)return;if(e.altKey){e.preventDefault();TS.info("setting unread point on "+n.id+" due to alt+click on message with ts = "+r);TS.client.msg_pane.setUnreadPoint(r);return}if(TS.utility.cmdKey(e)&&e.shiftKey){e.preventDefault();var i=TS.utility.msgs.getMsg(r,n.msgs);TS.dir(0,i);if(n.is_im)TS.ui.growls.growlImMessage(n,i,false,true);else TS.ui.growls.growlChannelOrGroupMessage(n,i,false,true)}});TS.click.addClientHandler("ts-message .resend_temp_msg, ts-message .remove_temp_msg",function(e,t){var r=t.closest("ts-message");var n=r.attr("data-ts");if(!n)return;var i=r.attr("data-model-ob-id");var a=TS.shared.getModelObById(i);if(!a)return;e.preventDefault();var s=t.hasClass("resend_temp_msg");TS.utility.msgs.handleFailedMsgSend(n,a,s)});TS.click.addClientHandler(".top_results_search_message_result",function(e,t,r){var n=$(e.target);var i=n.closest(".search_message_result");var a=i.data("module-name")||"score_top_results";var s=i.data("module-order")||0;var o=n.closest("ts-message");var l=o.data("iid")||"";if(n.attr("href"))return;if(n.parents(".rxn").length)return;var u=false;n.parentsUntil(".top_results_search_message_result").each(function(){if($(this).attr("href"))u=true});if(u)return;var d=TS.search.view.getMatchForSearchResult(t);if(!d)return;var _=d.match;e.preventDefault();if(TS.boot_data.page_needs_enterprise)if(_.team&&TS.model.team.id!==_.team&&!TS.shared.isModelObOrgShared(_.channel)&&_.permalink)TS.utility.openInNewTab(_.permalink,"_blank");var c=_.channel&&_.channel.id?_.channel.id:_.channel;var m=TS.shared.getModelObById(c);var f=_.thread_ts;if(f&&f!=_.ts){TS.ui.replies.openConversation(m,f,_.ts,r);return}var p={click_target_type:"top_results_jump_body",click_position:d.index,click_user_id:_.user,click_channel_id:_.channel.id,click_timestamp:_.ts,click_module_name:a,click_module_position:s,click_sort:TS.search.sort,click_filter_name:TS.search.filter,search_session_id:TS.search.getSearchSessionIdForResults(),client_request_id:TS.search.getQuerySessionIdForResults()};if(TS.search.last_request_id)p.request_id=TS.search.last_request_id;if(l)p.click_iid=l;TS.clog.track("SEARCH_CLICK",p);TS.client.ui.tryToJump(c,_.ts)});TS.click.addClientHandler(".search_message_result a, .search_message_result button",function(e,t){var r=$(e.target);var n=TS.search.view.getMatchForSearchResult(t);if(!n)return;var i=n.match;var a;var s;var o;var l=r.closest(".search_message_result");var u=l.data("module-name")||"messages";var d=l.data("module-order")||0;var _=l.data("iid")||"";var c=r.closest("ts-message");var m=c.data("iid")||_;var f;if(r.hasClass("jump")||r.hasClass("search_message_result__jump"))a="top_results_jump";else if(r.hasClass("search_jump")||r.hasClass("new_jump_link"))a="jump";else if(r.hasClass("archive"))a="archive";else if(r.is(".channel_link, .internal_im_link, .mpim_link, .group_link"))a="channel";else if(r.hasClass("message_sender")){a="sender";f=r.closest("ts-message");s=f.data("memberId");o=""+f.data("ts")}else if(r.hasClass("timestamp")){a="timestamp";f=r.closest("ts-message");s=f.data("memberId");o=""+f.data("ts")}else if(r.hasClass("star")){a="star";f=r.closest("ts-message");s=f.data("memberId");o=""+f.data("ts")}else if(r.attr("href")||r.attr("onclick"))a="link";if(a){var p={click_target_type:a,click_position:n.index,click_user_id:i.user,click_channel_id:i.channel.id,click_timestamp:i.ts,click_target_user_id:s,click_target_timestamp:o,click_module_name:u,click_module_position:d,click_sort:TS.search.sort,click_filter_name:TS.search.filter,search_session_id:TS.search.getSearchSessionIdForResults(),client_request_id:TS.search.getQuerySessionIdForResults()};if(TS.search.last_request_id)p.request_id=TS.search.last_request_id;if(m)p.click_iid=m;TS.clog.track("SEARCH_CLICK",p)}});TS.click.addClientHandler(".search_message_result .sli_feedback",function(e,t){e.preventDefault();var r=$(e.target);var n=TS.search.view.getMatchForSearchResult(t);if(!n)return;var i={};var a="";var s={plus:TS.i18n.t('Search result is relevant<br><span class="subtle_silver">(query string will be logged!)</span>',"clicks")(),circle:TS.i18n.t('Search result is somewhat relevant<br><span class="subtle_silver">(query string will be logged!)</span>',"clicks")(),minus:TS.i18n.t('Search result is not relevant<br><span class="subtle_silver">(query string will be logged!)</span>',"clicks")()};if(r.is(".selected")){i.undo=true;if(r.is(".sli_feedback_plus"))a=s.plus;else if(r.is(".sli_feedback_circle"))a=s.circle;else if(r.is(".sli_feedback_minus"))a=s.minus}else a=TS.i18n.t('oops!<br><span class="subtle_silver">remove my feedback</span>',"clicks")();TS.tips.updateTipTitle(r,a);r.toggleClass("selected");r.siblings(".sli_feedback").each(function(){$(this).removeClass("selected");var e="";if($(this).is(".sli_feedback_plus"))e=s.plus;else if($(this).is(".sli_feedback_circle"))e=s.circle;else if($(this).is(".sli_feedback_minus"))e=s.minus;TS.tips.updateTipTitle($(this),e)});if(r.is(".sli_feedback_plus"))i.value=5;else if(r.is(".sli_feedback_circle"))i.value=1;else if(r.is(".sli_feedback_minus"))i.value=-5;i.channel_id=n.match.channel.id;i.message_id=n.match.ts;i.permalink=n.match.permalink;i.query=TS.search.view.latest_msg_search_results.query;i.search_sort=TS.search.sort;i.search_exclude_bots=TS.prefs.getPref("search_exclude_bots");i.search_only_current_team=TS.prefs.getPref("search_only_current_team");i.search_exclude_channel=TS.prefs.getPref("search_exclude_channels");i.search_only_my_channels=TS.prefs.getPref("search_only_my_channels");TS.api.call("search.feedback",i)});var r=["ts-message .message_body a","ts-message .message_body .btn_attachment_link","ts-message .file_container a"].join(", ");TS.click.addClientHandler(r,function(e,t){var r;var n;var i;var a;var s;var o;var l;var u;var d;var c;var m;var f=$(e.target);r=t.closest("ts-message");n=""+r.data("ts");i=r.data("model-ob-id");var p=n&&i?TS.utility.msgs.findMsg(n,i):null;a=r.data("member-id");s=r.data("app-id");o=r.data("bot-id");l=t.data("referer-original-href")||t.attr("href")||t.data("url");u={message_timestamp:n,channel_id:i,channel_type:i?i.charAt(0):"",member_id:a,app_id:s,bot_id:o,url:l||""};if(TS.shared){var h=TS.shared.getActiveChannelSessionId();if(null!==h)u.channel_session_id=h}var g=TS.utility.msgs.extractMsgDisplayContext(r);if(g){u.link_origin=g;var S=null;if("briefing"==g&&TS.highlights_briefing)S=TS.highlights_briefing.last_request_id;else if("all_unreads"==g&&TS.client.unread)S=TS.client.unread.last_request_id;if(S)u.request_id=S}var T=TS.utility.msgs.isRawLink(f,l);if(T)u.link_is_raw=true;var v=TS.utility.msgs.extractLinkType(t,f,l);u.link_type=v;var b=TS.utility.msgs.extractLinkAction(t,f);if(b)u.link_action=b;var y=TS.utility.msgs.extractLinkItemId(t,f,v);if(y){u.item_id=y;u.item_type=y.charAt(0);if("channel"===v){var w=TS.channels.getChannelById(y);if(w&&null!==w.is_member)u.is_member=w.is_member}}var k=p&&p.attachments;if(k){var x=t.closest(".attachment_group").length>0;if(x){u.link_is_attachment=true;var C=TS.utility.msgs.extractLinkAttachmentField(t);if(C)u.link_attachment_field=C}}if(TS.model.unread_view_is_showing){_.merge(u,TS.client.ui.unread.getTrackingData(n));TS.client.ui.unread.incrementTrackingSeqId()}d=t.closest(".msg_inline_img_holder").length>0;c=t.attr("data-file-id");if(!c)c=t.closest("[data-file-id]").attr("data-file-id");m=c?TS.files.getFileById(c):null;if("gdrive"===_.get(m,"external_type")){if(!u.contexts)u.contexts={};if(!u.contexts.platform)u.contexts.platform={};u.contexts.platform.service_type="GSUITE";u.contexts.platform.app_id=9;u.contexts.platform.has_rich_preview=TS.files.fileHasRichPreview(m)}if(d||m&&TS.files.fileIsImage(m))TS.clog.track("MSG_PHOTO_EXPAND",u);TS.clog.track("MSG_LINK_CLICKED",u);var M=TS.interop.url.urlQueryStringParse(l).state;M=M?M.match(/(\{.*\})/g):null;M=M?M[0]:null;M=M?JSON.parse(M):null;if(M&&M.is_external_auth_url){var I="auto"===M.ask?"PLATFORM_APPS_TARGETED_SUGGESTIONS_SELECTED":"PLATFORM_APPS_TARGETED_SUGGESTIONS_JUST_THIS_ONCE_SELECTED";TS.clog.track(I,{app_id:M.service_type_id})}});TS.click.addClientHandler("ts-message .msg_inline_video_buttons_div .msg_inline_video_play_button",function(e,t){var r=t.closest("ts-message");var n=""+r.data("ts");var i=r.data("model-ob-id");var a=r.data("member-id");var s=r.data("app-id");var o=r.data("bot-id");var l=r.find(".msg_inline_video_new_window_button");var u=l.data("referer-original-href");var d=u||l.attr("href");var _={message_timestamp:n,channel_id:i,channel_type:i?i.charAt(0):"",member_id:a,app_id:s,bot_id:o,url:d||""};TS.clog.track("MSG_VIDEO_PLAY",_)});TS.click.addClientHandler(".member_preview_link, .member_preview_image",function(e,t,r){e.preventDefault();var n=t.closest("#member_preview_scroller");var i=t.data("member-id");if(i){if(e.shiftKey){e.preventDefault();var a=TS.members.getMemberById(i);TS.dir(0,a)}if(n.length&&i==TS.model.previewed_member_id)TS.menu.member.startWithMember(e,i);else if(n.length)TS.menu.member.startWithMember(e,i,true);else if("mentions"===r||"search_results"===r||"conversation"===r||"threads"===r){if("search_results"===r&&t.closest('[data-expert-search-module-name="experts"]').length)TS.sli_expert_search.handleExpertsClick(e,"experts","user");TS.menu.member.startWithMember(e,i)}else{var s=t.closest("#msgs_div, #archives_msgs_div, #unread_msgs_div, #sli_briefing");var o=t.closest("#all_members_container").length>0;if(TS.ui.share_dialog.showing)TS.ui.share_dialog.div.modal("hide");if(s.length||o)TS.menu.member.startWithMember(e,i);else TS.client.ui.previewMember(i,r||"team_list")}var l=t.closest("ts-message");var u=""+l.data("ts");var d=l.data("model-ob-id");i=l.data("member-id");var _=l.data("app-id");var c=l.data("bot-id");var m={message_timestamp:u,channel_id:d,channel_type:d?d.charAt(0):"",member_id:i,app_id:_,bot_id:c};TS.clog.track("USERNAME_CLICK",m)}else TS.warn("hmmm, no data-member-id?")});TS.click.addClientHandler(".app_profile a, .app_profile_slash_command",function(e,t){var r=t.closest(".app_profile");TS.clog.track("USER_PROFILE_CLICK",{app_id:r.data("app_id"),bot_id:r.data("bot_id")})});TS.click.addClientHandler('.bot_message .message_body a[href*="admin/billing"]',function(){TS.clog.track("GROWTH_PRICING",{contexts:{ui_context:{step:"slackbot",action:"click",ui_element:"billing_link"}}})});TS.click.addClientHandler(".member_details a",function(e,t){if(!t.hasClass("member_preview_menu_target"))TS.clog.track("USER_PROFILE_CLICK")});TS.click.addClientHandler(".member",function(e,t){e.preventDefault();var r=t.data("member-id");if(r)TS.menu.member.startWithMember(e,r);else TS.warn("hmmm, no data-member-id?")});TS.click.addClientHandler(".theme_installer_btn",function(e,t){e.preventDefault();var r=t.data("theme");var n=false;if(r){r=r.replace(/ /g,"");r=r.replace(/,$/g,"");var i=r.split(",");r={column_bg:i[0],menu_bg:i[1],active_item:i[2],active_item_text:i[3],hover_item:i[4],text_color:i[5],active_presence:i[6],badge:i[7]};TS.prefs.last_theme_selected_in_UI="custom_theme";TS.prefs.setMultiPrefsByAPI({sidebar_theme:TS.prefs.last_theme_selected_in_UI,sidebar_theme_custom_values:JSON.stringify(r)});TS.prefs.setPrefLocal("sidebar_theme",TS.prefs.last_theme_selected_in_UI);TS.prefs.setSidebarThemeCustomValues(r);TS.view.prefs.sidebarThemePrefChanged(n)}});TS.click.addClientHandler(".internal_im_link",function(e,t){e.preventDefault();TS.ims.startImByMemberId(t.data("member-id"))});TS.click.addClientHandler(".group_link, .internal_group_link",function(e,t){e.preventDefault();TS.view.onGroupReferenceClick(e,t.data("group-id"))});TS.click.addClientHandler(".internal_im_call_link",function(e,t){if(!TS.utility.calls.isEnabled())return;e.preventDefault();TS.utility.calls.startCallInModelOb(TS.members.getMemberById(t.data("member-id")))});TS.click.addClientHandler(".file_viewer_link",function(e,t){e.preventDefault();if(t.hasClass("file_viewer_channel_link"))TS.ui.fs_modal_file_viewer.start({modal_class:"fs_modal_file_viewer",$el:t,current_file_id:t.data("file-id"),show_control_btns:!t.closest("#file_preview_container").length})});TS.click.addClientHandler(".file_viewer_external_link",function(e,t){e.preventDefault();TS.ui.fs_modal_file_viewer.start({modal_class:"fs_modal_file_viewer",$el:t,current_file_id:t.data("file-id"),current_external_link:t[0]})});TS.click.addHandler(".inline_attachment.clickable, .inline_attachment.clickable + .reply_broadcast_rule",function(e,t){var r=["a",".media_caret",".delete_attachment_link",".msg_inline_video_buttons_div"].join(",");if($(e.target).closest(r).length)return;var n;if(t.is(".reply_broadcast")||t.closest(".reply_broadcast_rule").length)n=t.closest(".message_body").find('[data-action="open_conversation"]');else n=t.find(".attachment_from_url_link");if(n[0])n[0].click()},true);TS.click.addClientHandler(".internal_file_list_filter",function(e,t){e.preventDefault();TS.client.ui.files.showFileList();TS.client.ui.files.toggleFileList(t.data("file-list-filter"))});TS.click.addClientHandler("[data-expert-search-module-name] .channel_link",function(e,t){var r=t.parents("[data-expert-search-module-name]").data("expert-search-module-name");TS.sli_expert_search.handleExpertsClick(e,r,"channel")});TS.click.addClientHandler(".channel_link, .internal_channel_link",function(e,t){e.preventDefault();TS.view.onChannelReferenceClick(e,t.data("channel-id"))});TS.click.addClientHandler(".channel_link_unfurl_footer",function(e,t){var r=t.data("channel-id");var n=TS.channels.getChannelById(r);if(!n)return;e.preventDefault();TS.channels.displayChannel({id:n.id})});TS.click.addClientHandler(".internal_member_link:not(.plastic_contenteditable_element)",function(e,t){e.preventDefault();if(t.data("member-id"))TS.view.onMemberReferenceClick(e,t.data("member-id"))});TS.click.addClientHandler(".internal_user_group_link",function(e,t){e.preventDefault();TS.view.onUserGroupReferenceClick(e,t.data("user-group-id"))});TS.click.addClientHandler(".file_preview_link, .file_details_container .file_comment_btn, .back_from_file_comments",function(e,t,r){e.preventDefault();if(TS.ui.share_dialog.showing)TS.ui.share_dialog.div.modal("hide");var n=t.closest("[data-model-ob-id]").attr("data-model-ob-id");var i=t.attr("data-file-id");if(!i)i=t.closest("[data-file-id]").attr("data-file-id");var a=TS.files.getFileById(i);if(a&&a.is_deleted){TS.generic_dialog.alert("<p>"+TS.i18n.t("This file has been deleted.","clicks")()+"</p>");return}if("search_results"===r&&TS.files.fileIsImage(a)){TS.ui.fs_modal_file_viewer.start({modal_class:"fs_modal_file_viewer",$el:t,current_file_id:i,show_control_btns:false});return}var s=t.hasClass("file_comment_link");var o=t.hasClass("file_force_flexpane");if(!o){var l=s?"?comments=1":"";if(TS.client.windows.openFileWindow(i,l))return}TS.client.ui.files.previewFile(i,r||"file_list",false,s,n)});TS.click.addClientHandler('#share_dialog [data-action="copy_link"]',function(e,t){var r=t.data("link");if(!r||!TS.clipboard.canWriteText())return;TS.tips.updateFloater({title:TS.i18n.t("Copied!","share_dialog")(),classes_to_add:["success"]});TS.clipboard.writeText(r)});TS.click.addClientHandler(".msg_actions",function(e,t){var r=t.data("msg-ts");if(t.is(t)||t.closest(".msg_cog").length){e.preventDefault();if(TS.model.archive_view_is_showing){var n=TS.client.archives.getCurrentModelOb()||{};TS.menu.startWithMessageActions(e,r,n._archive_msgs)}else TS.menu.startWithMessageActions(e,r,TS.shared.getActiveModelOb().msgs)}});TS.click.addClientHandler(".comment_actions",function(e,t){var r=$(e.target);if(r.hasClass("comment_cog")){e.preventDefault();TS.menu.startWithCommentActions(e,t.data("file-id"),t.data("comment-id"))}});TS.click.addHandler(".file_actions",function(e,t){e.preventDefault();TS.menu.file.startWithFileActions(e,t.data("file-id"))});TS.click.addClientHandler(".file_ssb_download_link",function(e,t){var r=!(TS.ui.fs_modal_file_viewer&&TS.ui.fs_modal_file_viewer.is_showing);var n=TS.files.getFileById(t.data("file-id"));var i={is_successful:false};if(n){i.is_successful=true;var a=TS.members.getMemberById(n.user);if(a&&a.is_bot){var s=a.profile.bot_id;var o=TS.bots.getBotById(s);i.app_id=o?o.app_id:"";i.bot_id=s}}TS.clog.track("FILE_DOWNLOAD",i);if(n&&TS.client.downloads.startDownload(n,r))e.preventDefault()});TS.click.addClientHandler(".msg_jump, .star_jump",function(e,t,r){e.preventDefault();var n=""+t.closest("[data-ts]").data("ts");if(!n){TS.error("error no msg_id to jump to?");return}var i=t.data("cid");var a=TS.shared.getModelObById(i);var s=t.closest("[data-thread-ts]").attr("data-thread-ts");if(s&&s!=n){TS.ui.replies.openConversation(a,s,n,r);return}TS.client.ui.tryToJump(i,n)});TS.click.addClientHandler(".search_message_result .search_jump",function(e,t,r){var n=TS.search.view.getMatchForSearchResult(t);if(!n)return;var i=n.match;e.preventDefault();var a=TS.search.view.firstResultWithExtracts(i);var s=i.channel&&i.channel.id?i.channel.id:i.channel;var o=TS.shared.getModelObById(s);var l=a.thread_ts;if(l&&l!=a.ts){TS.ui.replies.openConversation(o,l,a.ts,r);return}TS.client.ui.tryToJump(s,a.ts)});TS.click.addWebHandler("#msgs_div.selecting_messages ts-message",function(e){var t=$(e.target);if(t.attr("href")||t.hasClass("star"))return;var r=t.closest("ts-message");var n=r.find(".msg_select_cb");if(!t.is("input"))n.prop("checked",!n.prop("checked"));TS.msg_edit.batchDeleteSelectionChanged(n,e.shiftKey)});TS.click.addHandler(TS.rxns.checkForRxnClick);TS.click.addHandler(TS.stars.checkForStarClick);TS.click.addHandler(function(e){var t=TS.client&&TS.search.view.getMatchForSearchResult($(e.target));TS.inline_imgs.checkForInlineImgClick(e,t&&t.match);if(t&&TS.client)TS.ui.utility.updateClosestMonkeyScroller($(e.target))});TS.click.addHandler(function(e){var t=TS.client&&TS.search.view.getMatchForSearchResult($(e.target));TS.inline_videos.checkForInlineVideoClick(e,t&&t.match);if(t&&TS.client)TS.ui.utility.updateClosestMonkeyScroller($(e.target))});TS.click.addHandler(function(e){var t=TS.client&&TS.search.view.getMatchForSearchResult($(e.target));TS.inline_audios.checkForInlineAudioClick(e,t&&t.match);if(t&&TS.client)TS.ui.utility.updateClosestMonkeyScroller($(e.target))});TS.click.addHandler(function(e){var t=TS.client&&TS.search.view.getMatchForSearchResult($(e.target));TS.inline_others.checkForInlineOtherClick(e,t&&t.match);if(t&&TS.client)TS.ui.utility.updateClosestMonkeyScroller($(e.target))});TS.click.addHandler(function(e){var t=TS.client&&TS.search.view.getMatchForSearchResult($(e.target));TS.inline_attachments.checkForInlineAttachmentClick(e,t&&t.match);if(t&&TS.client)TS.ui.utility.updateClosestMonkeyScroller($(e.target))});TS.click.addHandler(TS.inline_file_previews.checkForInlineFilePreviewClick);TS.click.addHandler(TS.inline_room_previews.checkForInlineRoomPreviewClick);TS.click.addClientHandler(".file_list_item",function(e,t,r){var n;var i=$(e.target);var a=t.data("file-id");var s=t.parent().children().index(t);var o={click_target_type:"file",click_position:s,click_file_id:a,click_module_name:"all"==TS.search.filter?"top_files":"files",click_module_position:0,click_sort:TS.search.getSort("search.files"),request_id:TS.search.last_files_request_id,click_filter_name:TS.search.filter,search_session_id:TS.search.getSearchSessionIdForResults(),client_request_id:TS.search.getQuerySessionIdForResults()};TS.clog.track("SEARCH_CLICK",o);n=!TS.menu.file.file_list_menu_up&&!i.is(".star")&&!i.closest("a").length&&!i.closest("button").length;if(n){e.preventDefault();if(TS.files.fileIsImage(a)){TS.ui.fs_modal_file_viewer.start({modal_class:"fs_modal_file_viewer",$el:t,current_file_id:a,show_control_btns:false});return}if(TS.ui.share_dialog.showing)TS.ui.share_dialog.div.modal("hide");TS.client.ui.files.previewFile(t.data("file-id"),r||"file_list",false)}});TS.click.addClientHandler("a.file_share, button.file_share",function(e,t){e.preventDefault();TS.view.files.shareInCurrentChannelOrIM(t.data("file-id"))});TS.click.addClientHandler(".snippet_edit_dialog_link",function(e,t){var r=TS.files.getFileById(t.data("file-id"));if(!r.is_truncated){e.preventDefault();TS.ui.snippet_dialog.startEdit(r.id)}});TS.click.addClientHandler(".file_new_window_link",function(e,t){if(TS.client.windows.openFileWindow(t.data("file-id"),""))e.preventDefault();else TS.utility.welcome_post.clogWelcomePostOpen(t)});TS.click.addClientHandler("a.show_parent_replies, a.show_replies, .reply_bar",function(e,t,r){e.preventDefault();var n=t.closest("ts-message");var i=n.attr("data-thread-ts");if(!i)return;var a=n.attr("data-model-ob-id");var s=TS.shared.getModelObById(a);if(!s)return;TS.ui.replies.openConversationFromMessagePane(n,s,i,null,r)});TS.click.addWebHandler(".reply_bar",function(e,t){var r=$(e.target);if(!r.is("a")){var n=t.closest("ts-message");var i=n.attr("data-thread-ts");if(!i)return;var a=n.attr("data-model-ob-id");var s=TS.shared.getModelObById(a);if(!s)return;var o=TS.utility.msgs.constructConversationPermalink(s,i);window.open(o)}});TS.click.addClientHandler('[data-action="open_conversation"]',function(e,t,r){e.preventDefault();var n=t.attr("data-model-ob-id");var i=TS.shared.getModelObById(n);if(!i)return;var a=t.attr("data-thread-ts");if(!a)return;var s=t.attr("data-ts");TS.ui.replies.openConversation(i,a,s,r)});TS.click.addClientHandler("#mentions_clear_notifications",function(e){e.preventDefault();TS.replies.markAllThreads()});TS.click.addClientHandler("#reply_container .reply_send, #file_reply_container .reply_send",function(e,t){e.preventDefault();TS.ui.replies.submitReply(e,t)});TS.click.addClientHandler("#threads_msgs .reply_send",function(e,t){e.preventDefault();TS.ui.thread.submitReply(e,t)});TS.click.addClientHandler("#reply_container .join_channel_from_thread",function(e,t){e.preventDefault();TS.ui.replies.joinChannelFromThread(e,t)});TS.click.addClientHandler("#threads_msgs .join_channel_from_thread",function(e,t){e.preventDefault();TS.ui.thread.joinChannelFromThread(e,t)});TS.click.addClientHandler(".thread_error_state_refresh_button",function(e){e.preventDefault();TS.client.threads.maybeReloadThreadsView()});TS.click.addClientHandler("#thread_notification_banner .banner_buttons .btn",function(e,t){e.preventDefault();var r=t.data("turn-on-pref");var n=$("#thread_notification_banner");var i=n.height();n.height(i);n.addClass("show_confirmation");n.height(92);TS.prefs.setPrefByAPI({name:"seen_threads_notification_banner",value:true});var a=TS.prefs.getPref("threads_everything")!==r;if(a){TS.prefs.setPrefByAPI({name:"threads_everything",value:r});TS.clog.track("PREF_USER_CLIENT_UPDATE",{updated_user_client_prefs:{threads_everything:r.toString()}})}});TS.click.addClientHandler("#thread_notification_banner .close",function(e){e.preventDefault();var t=$("#thread_notification_banner");var r=t.height();t.height(r);t.height(0);if(!TS.prefs.getPref("seen_threads_notification_banner"))TS.prefs.setPrefByAPI({name:"seen_threads_notification_banner",value:true})});TS.click.addClientHandler("#thread_notification_banner_pref_link",function(e){e.preventDefault();TS.ui.prefs_dialog.start("notifications","#prefs_threads_everything","prefs_notifications")});TS.click.addClientHandler("a.see_all_pins",function(e){if(TS.client&&TS.client.channel_page){e.preventDefault();TS.client.ui.flex.openFlexTab("details");TS.client.channel_page.showPinsSection();$("#channel_page_scroller .channel_page_pinned_items").highlight(null,"channel_page_pinned_items_highlighter")}});TS.click.addClientHandler("ts-thread .new_reply_indicator",function(e,t){var r=t.closest("ts-thread");if(!r.length)return;e.preventDefault();var n=r.attr("data-model-ob-id");var i=r.attr("data-thread-ts");TS.client.threads.showNewRepliesAndMarkThread(n,i)});TS.click.addClientHandler("ts-thread .view_all_replies_container",function(e,t){var r=t.closest("ts-thread");if(!r.length)return;e.preventDefault();if(t.hasClass("active"))return;t.addClass("active");var n=r.attr("data-model-ob-id");var i=r.attr("data-thread-ts");TS.client.threads.showPreviousReplies(n,i).finally(function(){t.removeClass("active")})});TS.click.addClientHandler("#msgs_div ts-thread .expand_inline_thread",function(e,t){e.preventDefault();var r=t.closest("ts-thread");if(!r.length)return;TS.ui.thread.expandInlineThread(r)});TS.click.addClientHandler("#msgs_div ts-thread .collapse_inline_thread",function(e,t){e.preventDefault();var r=t.closest("ts-thread");if(!r.length)return;TS.ui.thread.collapseInlineThread(r)});TS.click.addClientHandler(".thread_comments_toggle_container",function(e,t){e.preventDefault();t.closest(".thread_comments_holder").toggleClass("expanded")});TS.click.addClientHandler("a[href]",function(e,t,r){var n;var i;var a=t.attr("href");if(TS.utility.isSlackUrl(a))a=a.toLowerCase();var s=a.indexOf("?")>-1;if(s){n=a.indexOf("?");i=a.slice(0,n)}var o={"/account/settings":true,"/admin":true,"/admin/billing":true,"/admin/settings":true,"/apps":true,"/apps/manage":true,"/apps/new":true,"/customize":true,"/files":true,"/pricing":true,"/stats":true,"/help":true};if(o[a]||o[i]){e.preventDefault();TS.utility.openAuthenticatedInBrowser(a);return}if(TS.client.archives.maybeHandleArchiveLink(t,r)){if(TS.ui.fs_modal_file_viewer&&TS.ui.fs_modal_file_viewer.is_showing)TS.ui.fs_modal.close();e.preventDefault();return}if(TS.utility.calls.maybeHandleCallLink(t)){e.preventDefault();return}if(TS.utility.calls.maybeEnterMasToDdlFlow(a)){e.preventDefault();return}if(!t.attr("target")&&0!==a.indexOf("skype:")){e.preventDefault();TS.utility.openInNewTab(a,TS.templates.builders.newWindowName());return}var l=TS.utility.getFileIDFromURL(a);if(l&&TS.client.windows.openFileWindow(l,"")){e.preventDefault();return}if(TS.ui.replies.maybeOpenConversationLink(t,r))e.preventDefault()});TS.click.addClientHandler(".search_message_result",function(e,t){var r=$(this);var n=$(e.target);if(n.attr("href")||n.attr("onclick"))return;if(n.parents().attr("href"))return;if(n.parents(".message").length&&window.getSelection&&window.getSelection().toString())return;if(t.hasClass("top_results_search_message_result"))return;var i=TS.search.view.getMatchForSearchResult(t);if(!i)return;if(r.hasClass("no_extracts"))return;e.preventDefault();TS.search.view.toggleExtractsForMatch(e,i)});TS.click.addClientHandler(".attachment_show_more",function(e,t){var r=TS.shared.getActiveModelOb();var n=t.data("msg-ts").toString();var i=TS.utility.msgs.findMsg(n,r.id);var a=i._shown_attachments;if(Number.isInteger(a)&&a+20<=i.attachments.length)i._shown_attachments+=20;else i._shown_attachments=i.attachments.length;if(n==TS.shared.getLatestMsgTs(r))TS.shared.markReadMsg(r.id,n,TS.model.marked_reasons.viewed);TS.client.msg_pane.rebuildMsgsWithReason("show more attachments")});TS.click.addClientHandler(".attachment_actions_interactions .btn",function(e){e.preventDefault();var t=TS.attachment_actions.handleActionEventAndGetContext($(e.target));if(t){var r=TS.attachment_actions.client_buttons.fetchClientButtonData(t.message);if(r){TS.attachment_actions.client_buttons.handleClick(r,t);return}if(t.action.confirm)TS.attachment_actions.confirmAction(t.action,function(){TS.attachment_actions.action_triggered_sig.dispatch(t)});else TS.attachment_actions.action_triggered_sig.dispatch(t);var n=["Create a channel","Edit messages","Upload files"];var i=_.startsWith(t.action.name,"slackbot_help");if(_.includes(n,t.action.name)||i)TS.clog.track("GROWTH_HELP_SLACKBOT_V2",{action:"click",click_target:t.action.name,button_position:t.action.id,button_text:t.action.text,locale:TS.i18n.locale()})}});TS.click.addClientHandler("#threads_view_banner .clear_unread_messages",function(e){e.preventDefault();TS.client.threads.markAllNewThreads()});TS.click.addClientHandler("#threads_view_banner",function(e){e.preventDefault();if(TS.client.ui.threads.isAlternativeThreadsViewShowing()){TS.client.threads.maybeReloadThreadsView();return}TS.client.ui.threads.jumpToTop()});TS.click.addClientHandler(".app_preview_link",function(e,t){e.preventDefault();var r=t.closest("[data-bot-id]");var n=r.data("bot-id");var i=r.data("team-id");var a=""+r.data("ts");var s=r.data("model-ob-id");var o=r.data("member-id");var l=r.data("app-id");if(n&&!i)if(o)i=_.get(TS.members.getMemberById(o),"team_id",null);else{var u=TS.shared.getActiveModelOb();var d=TS.utility.msgs.getMsg(a,u.msgs);i=_.get(d,"bot_profile.team_id",null)}var c={message_timestamp:a,channel_id:s,channel_type:s?s.charAt(0):"",member_id:o,app_id:l,bot_id:n};TS.clog.track("USERNAME_CLICK",c);if(n)if(t.closest(".dm_badge").length>0&&t.hasClass("member_image")){var m=o||_.get(TS.apps.getAppById(l),"bot_user.id");TS.ims.startImByMemberId(m).then(function(){TS.client.ui.app_space.toggleView("about")})}else TS.menu.app.startWithApp(e,n,i,true);else TS.warn("hmm, no data-bot-id?")});TS.click.addClientHandler(".attachment_attribution a",function(e,t){var r=t.data("attribution-bot-id");var n=t.data("attribution-team-id");if(r){e.preventDefault();if(n)TS.menu.app.startWithApp(e,r,n);else TS.menu.app.startWithApp(e,r)}else TS.warn("hmm, no data-bot-id?")});TS.click.addHandler("[data-slash-command-autofill]",function(e,t){var r=TS.client.msg_input.$input;var n=TS.utility.contenteditable.value(r);var i=t.data("slash-command-autofill");var a;var s;var o;if(t.data("app_space_profile_slash_command")){a="APP_SPACE_ABOUT_SLASH_COMMAND_CLICK";s=_.get(TS.client.ui.app_space,"active_app.id");o=TS.client.ui.app_space.app_bot_id}else{a="APP_PROFILE_SLASH_COMMAND_CLICK";s=_.get(TS.client.ui.app_profile,"active_app.id");o=null}TS.clog.track(a,{app_id:s,bot_id:o,contexts:{core:{app_id:s,bot_id:TS.client.ui.app_space.app_bot_id}}});if(TS.apps.isAppSpaceEnabled()&&"messages"!==TS.client.ui.app_space.active_view)TS.client.ui.app_space.toggleView("messages");if(!n){TS.utility.contenteditable.clear(r);TS.utility.contenteditable.insertTextAtCursor(r,i)}TS.utility.contenteditable.value(r,i+" "+n);TS.utility.contenteditable.cursorPosition(r,i.length+1,n.length);TS.utility.contenteditable.focus(r)});if(TS.boot_data.feature_tinyspeck){TS.click.addClientHandler(".c-channel_insights__top-contributors-debug",function(){var e=TS.client.ui.channel_insights.last_details_response;var t=_.get(e,"response.data.top_contributors.debug",{});TS.client.ui.debugger_flexpane.printJSON(t)});TS.click.addClientHandler(".c-channel_insights__similar-channels-debug",function(){var e=TS.client.ui.channel_insights.last_details_response;var t=_.get(e,"response.data.similar_channels.debug",{});TS.client.ui.debugger_flexpane.printJSON(t)});TS.click.addClientHandler(".c-channel_insights__top-messages-debug",function(){var e=TS.client.ui.channel_insights.last_highlights_response;var t=_.get(e,"response.data.top_messages.debug",{});TS.client.ui.debugger_flexpane.printJSON(t)})}if(TS.boot_data.feature_tinyspeck)TS.click.addClientHandler(".recap_highlight_debug",function(e){if("sli_debug_info"===TS.client.highlights.sli_recaps_debug_group){var t;if(TS.model.unread_view_is_showing){var r=$(e.target).parents("ts-message").data("model-ob-id");t=TS.shared.getModelObById(r)}else t=TS.shared.getActiveModelOb();var n=$(e.target).parents("ts-message").data("ts");var i=TS.client.highlights.getHighlight(t.id,n);TS.client.ui.debugger_flexpane.printJSON(i)}});TS.click.addClientHandler("[data-highlight-feedback]",function(e){var t=$(e.target).data("highlight-feedback");var r=$(e.target).closest("ts-message");var n=r.data("model-ob-id");var i=r.data("ts");TS.client.highlights.setDefaultFeedbackForHighlight(n,i,{feedback:t},TS.model.unread_view_is_showing?"all-unreads":"in-channel");$("#ts_tip_float_floater .ts_tip_tip").text(TS.i18n.t("Thank you!","highlights")())});TS.click.addClientHandler('[data-js="highlights_feedback_dropdown"]',function(e){var t=$(e.target).closest("ts-message");var r=t.data("model-ob-id");var n=t.data("ts");var i=TS.model.unread_view_is_showing?"all-unreads":"in-channel";TS.client.ui.highlights.openNegativeFeedbackMenu(e,r,n,i)});TS.click.addClientHandler('[data-js="sli_briefing_back_button"]',function(){TS.client.unread.showUnreadView();TS.highlights_briefing.clogBackButton()});TS.click.addClientHandler("[data-js=sli_expert_search_toggle]",function(e){if(TS.sli_expert_search)TS.sli_expert_search.toggleExpand(e)});if(TS.boot_data.feature_sli_channel_insights)TS.click.addClientHandler(".channel_page_highlights ts-message",function(e){var t=$(e.target).closest("ts-message");var r=t.data("ts");var n=t.data("model-ob-id");TS.client.ui.tryToJump(n,r);var i={channel_id:n,channel_type:n[0]||"",message_timestamp:r,request_id:TS.client.ui.channel_insights.last_highlights_response.response.request_id};TS.clog.track("CHANNEL_INSIGHTS_JUMP_TO_MESSAGE",i)});if(TS.boot_data.feature_sli_file_search&&TS.search.sliFileSearchIsEnabled()){TS.click.addClientHandler("#search_file_list_heading",function(e){e.preventDefault();TS.menu.file.startWithFileFilter(e,true)});TS.click.addClientHandler("#search_file_list_clear_filter",function(e){e.stopPropagation();TS.search.view.clearFiletypeFilter()})}};var r=function t(){var r={};$("body").on("mousedown.ts_dot_click_mousedown",function(e){r.x=e.clientX;r.y=e.clientY});$("body").on("click.ts_dot_click",function(t){if(t.isDefaultPrevented())return;if(TS.view&&TS.view.maybeFollowLink(t))return;if(TS.isPartiallyBooted()){t.preventDefault();return}var a=$(t.target);if(a.parents("[data-reactroot]").length)return;var s=n(t);var o;var l;for(var u=0;u<e.length;u+=1){o=e[u];l=null;if(o.prevent_on_drag&&(t.clientX!=r.x||t.clientY!=r.y))continue;else if(o.selector){l=a.closest(o.selector);if(!l.length)continue;o.fn(t,l,s);if(t.isDefaultPrevented()&&TS.has_pri[i])TS.log(i,"click on "+o.selector)}else o.fn(t,s);if(t.isDefaultPrevented())return}})};var n=function e(t){var r=$(t.target);if(r.closest("#search_results_container").length)return"search_results";if(r.closest("#member_stars_list").length)return"starred_items";if(r.closest("#member_mentions").length)return"mentions";if(r.closest("#file_list").length)return"file_list";if(r.closest("#file_preview_scroller").length)return"file_preview";if(r.closest("#member_preview_scroller").length)return"member_preview";if(r.closest("#convo_scroller").length)return"conversation";if(r.closest("#groups_tab").length)return"groups";if(r.closest("#threads_msgs_scroller_div").length)return"threads";if(r.closest("#channel_page_scroller").length){var n=TS.shared.getActiveModelOb();var i="channel_page";if(n.is_group&&!n.is_mpim)i="group_page";else if(n.is_im||n.is_mpim)i="im_page";return i}return null};var i=2003})()},4827:function(e,t){(function(){TS.registerModule("sorter",{onStart:function e(){},search:function e(t,r,n){return l(t,r,n)},printTest:function e(t,r){var n=TS.members.getActiveMembersWithSlackbotAndNotSelf();var i;var a;var s;var o=_.values(TS.boot_data.other_accounts);var l=TS.user_groups.getActiveUserGroups();var u=TS.model.emoji_map;var d=TS.utility.members.getBroadcastKeywordsForUser();var c=TS.model.NAMED_VIEWS;i=_.reject(TS.redux.channels.dangerouslyGetChannelsForUser(),"is_archived");a=_.reject(TS.redux.channels.dangerouslyGetGroups(),"is_archived");s=TS.channels.getAllVisibleMpimsForUser(TS.redux.channels.dangerouslyGetMpims());var m={members:n,channels:i,groups:a,mpims:s,teams:o,usergroups:l,emoji:u,broadcast_keywords:d,views:c};TS.sorter.search(t,m,_.extend({print:true},r))},test:function e(){var n={sortFuzzy:m,frecencyBonusPoints:f,getFilteredMatchesForFrecency:u,scoreMember:a,_scoreUserGroup:s,getSubQueryMatchers:t};Object.defineProperty(n,"_meta_fields",{get:function e(){return r},set:function e(t){r=t}});return n}});var e=function e(r,i){i=i||{};var l=null!=i.fuzzy_limit?i.fuzzy_limit:10;r=TS.interop.I18n.deburr(r.toLocaleLowerCase());var u="@"===r.charAt(0);var d="#"===r.charAt(0);var c=":"===r.charAt(0);if(u||d||c)r=r.substring(1);var m={fuzzy_limit:l};var f={fuzzy_limit:l,search_forward_only:true};var p={fuzzy_limit:l,substrings_only:true,match_emoji_keywords:i.match_emoji_keywords};var h=TS.fuzzy.makeFuzzyMatcher(r,m);var g=TS.fuzzy.makeFuzzyMatcher(r,f);var S=t(r,f);var T=TS.fuzzy.makeFuzzyMatcher(r,p);return{query:r,only_channels:d,only_members:u,only_emoji:c,matchesChannel:function e(t){if(u||c)return false;if((i.allow_empty_query||d)&&!r){n(t.id,"jumper_score",0);return true}var a=h.score(t.name_normalized||t.name);n(t.id,"jumper_score",a);if(i.search_previous_channel_names&&t.previous_names&&t.previous_names.length){var s=_.map(t.previous_names,function(e){return{score:h.score(e),name:e}});n(t.id,"jumper_previous_name_scores",s);var o=_.some(s,function(e){return e.score<=l});var m=o&&a>l;if(m){var f=_.minBy(s,"score");t._jumper_previous_name_match=f&&f.name}else t._jumper_previous_name_match=null;return a<=l||o}return a<=l},matchesGroup:function e(t){if(d||u||c)return false;if(i.allow_empty_query&&!r){n(t.id,"jumper_score",0);return true}var a=h.score(t.name_normalized||t.name);n(t.id,"jumper_score",a);return a<=l},matchesMember:function e(t){if(t.isNonExistent||t.is_non_existent)return;if(d||c)return false;if((i.allow_empty_query||u)&&!r){n(t.id,"jumper_score",0);return true}var s=a(t,g,r);n(t.id,"jumper_score",s);return s<=l},matchesMpim:function e(t){if(d||u||c)return false;if(i.allow_empty_query&&!r){n(t.id,"jumper_score",0);return true}var s=TS.mpims.getMembersInDisplayOrder(t);s=_.compact(s);var o=S.map(function(e){var t=s.map(function(t){return a(t,e)});return _.min(t)});var m=_.sum(o);n(t.id,"jumper_score",m);return m<=l},matchesTeam:function e(t){if(d||u||c)return false;var r=t.team_name||t.name;var i=h.score(r.toLocaleLowerCase());n(t.id,"jumper_score",i);return i<=l},matchesUserGroup:function e(t){if(d||c)return false;if((i.allow_empty_query||u)&&!r){n(t.id,"jumper_score",0);return true}var a=s(t,h);n(t.id,"jumper_score",a);return a<=l},matchesEmoji:function e(t){if(d||u)return false;if(i.allow_empty_query&&!r){n(t.id,"jumper_score",0);return true}var a=TS.interop.I18n.deburr(t.display_name||t.name);var s=T.score(a);if(t.display_name&&t.display_name!==t.name){var o=T.score(t.name);if(o<s)s=o}n(t.id,"jumper_score",s);return s<=l},matchesBroadcastKeyword:function e(t){if(d||c)return false;if((i.allow_empty_query||u)&&!r){n(t.id,"jumper_score",0);return true}var a=o(t,h);n(t.id,"jumper_score",a);return a<=l},matchesView:function e(t){if(d||c)return false;var r=h.score(t.name.toLocaleLowerCase());if(Infinity===r&&t.alt_names)r=_.reduce(t.alt_names,function(e,t){return Math.min(e,h.score(t.toLocaleLowerCase()))},r);n(t.id,"jumper_score",r);return r<=l}}};var t=function e(t,r){var n=t.split(/[,| ]/).filter(function(e){return!!e});return n.map(function(e){e="@"===e.charAt("0")?e.substring(1):e;return TS.fuzzy.makeFuzzyMatcher(e,r)})};var a=function e(t,r,n){var i;if(TS.utility.queryIsMaybeSelf(n)&&t.is_self)return 0;var a=Infinity;var s=Infinity;var o=Infinity;var l=Infinity;a=r.score(t._real_name_lc);if(t._real_name_lc!==t._real_name_normalized_lc)s=r.score(t._real_name_normalized_lc);if(t._display_name_lc){o=r.score(t._display_name_lc);if(t._display_name_lc!==t._display_name_normalized_lc)l=r.score(t._display_name_normalized_lc)}i=Math.min(a,s,o,l);return i};var s=function e(t,r){var n=Infinity;var i=Infinity;n=r.score(t.name);i=r.score(t.handle);var a=Math.min(n,i);return a};var o=function e(t,r){var n=Infinity;var i=Infinity;n=r.score(t.name);if(t.ms_name!==t.name)i=r.score(t.ms_name);if(!t.alias)return Math.min(n,i);var a=Infinity;a=r.score(t.alias);var s=Math.min(n,i,a);return s};var l=function t(r,a,s){var o=e(r,s||{});var l=[];var d=[];var c=[];var p=[];var h=[];var g=[];var S=[];var T=[];var v=[];var b=[];var y=[];var w=[];var k=[];var x=s.match_emoji_keywords?TS.emoji.findByKeyword(r):[];a.members=a.members||[];a.channels=a.channels||[];a.groups=a.groups||[];a.mpims=a.mpims||[];a.teams=a.teams||[];a.usergroups=a.usergroups||[];a.emoji=a.emoji||[];a.broadcast_keywords=a.broadcast_keywords||[];a.views=a.views||[];a.enterprise_channels=a.enterprise_channels||[];a.enterprise_groups=a.enterprise_groups||[];if(!o.only_channels&&!o.only_emoji){d=a.members.filter(function(e){if(s.prefer_exact_match&&o.query&&(TS.members.getMemberProfileFieldDisplayName(e).toLocaleLowerCase()===o.query||TS.members.getMemberRealName(e).toLocaleLowerCase()===o.query)){n(e.id,"jumper_exact_match",true);l.push(e);return false}n(e.id,"jumper_exact_match",false);return o.matchesMember(e)});b=a.usergroups.filter(function(e){if(s.prefer_exact_match&&e.handle===o.query||e.name_lc===o.query){l.push(e);return false}return o.matchesUserGroup(e)});w=a.broadcast_keywords.filter(function(e){if(s.prefer_exact_match&&e.name===o.query){l.push(e);return false}return o.matchesBroadcastKeyword(e)})}if(!o.only_members&&!o.only_emoji)_.concat(a.channels,a.enterprise_channels).forEach(function(e){if(s.prefer_exact_match&&e.name===o.query){n(e.id,"jumper_exact_match",true);l.push(e);return}n(e.id,"jumper_exact_match",false);var t=o.matchesChannel(e);if(!t)return;if(e.is_member)c.push(e);else if(e.is_archived)h.push(e);else p.push(e)});if(!o.only_channels&&!o.only_members&&!o.only_emoji){_.concat(a.groups,a.enterprise_groups).forEach(function(e){if(s.prefer_exact_match&&e.name===o.query){n(e.id,"jumper_exact_match",true);l.push(e);return}n(e.id,"jumper_exact_match",false);var t=o.matchesGroup(e);if(!t)return;if(e.is_archived)S.push(e);else g.push(e)});T=a.mpims.filter(function(e){return o.matchesMpim(e)});v=a.teams.filter(function(e){if(!_.isObject(e))return false;var t=e.team_name||e.name;if(s.prefer_exact_match&&t.toLocaleLowerCase()===o.query){n(e.id,"jumper_exact_match",true);l.push(e);return false}n(e.id,"jumper_exact_match",false);var r=o.matchesTeam(e);return r})}if(!o.only_channels&&!o.only_members)y=a.emoji.filter(function(e){if(s.prefer_exact_match&&(e.display_name||e.name)===o.query){n(e.id,"jumper_exact_match",true);l.push(e);return false}n(e.id,"jumper_exact_match",false);if(s.match_emoji_keywords&&x.length){var t=TS.emoji.nameToBaseName(e.display_name||e.name);if(-1!==x.indexOf(t))return true}return o.matchesEmoji(e)});if(TS.client&&a.views)if(!o.only_channels&&!o.only_members)k=a.views.filter(function(e){if(s.prefer_exact_match&&e.name===o.query){l.push(e);return false}return o.matchesView(e)});var C;var M;var I;C=d.concat(c,g,T,y,b,w,k);C.sort(_.partial(m,true));M=p.concat(v);M.sort(_.partial(m,true));I=S.concat(h);I.sort(_.partial(m,true));var P=C.concat(M,I);var A=P;if(s.prefer_exact_match&&l.length>0)for(var E=0;E<l.length;E+=1)A.unshift(l[E]);if(s.frecency){s.normalize=true;A=TS.ui.frecency.query(A,r,f,s)}if(s.limit)A=_.take(A,s.limit);if(s.frecency)A=u(A);if(s.print){var F="\n";_.forEach(A,function(e){var t=s.frecency?e.model_ob:e;if(s.frecency)F+="["+e.score+"] ";if(null!=i(t.id,"jumper_score"))F+="["+i(t.id,"jumper_score")+"] ";if(t.is_mpim)F+=TS.mpims.getDisplayName(t);else if(t.is_channel)F+="#"+t.name;else if(t.is_group)F+=t.name;else if(t.team_name)F+=t.team_name;else if(t.is_usergroup)F+="@"+t.name;else if(t.presence)F+="@"+t.name;else F+=e.model_ob.name;F+="\n"});TS.info(F)}return A};var u=function e(t){var r=[];if(TS.boot_data.page_needs_enterprise)t=_.uniqBy(t,function(e){return e.id});_.forEach(t,function(e){var t;if(TS.interop.utility.looksLikeMemberId(e.id)){var n=TS.members.getMemberById(e.id);if(n){r.push({model_ob:n,score:e.score});return}}var i=0===e.id.indexOf("BK");var a=0===e.id.indexOf("V");if(i)t=TS.model.getBroadcastKeywordById(e.id);else if(a)t=TS.model.getViewById(e.id);else t=d(e.id);if(t)r.push({model_ob:t,score:e.score})});return r};var d=function e(t){return TS.boot_data.page_needs_enterprise?TS.enterprise.getModelObById(t):TS.shared.getModelObById(t)};var c=function e(t){var r;if(t.is_mpim)r=TS.mpims.getDisplayNameLowerCase(t);else if(t.is_usergroup)r=t.handle;else if(t._name_lc)r=t._name_lc;else if(t.team_name)r=t.team_name.toLocaleLowerCase();else r=t.name;return r};var m=function e(t,r,n){if(r.is_mpim&&!n.is_mpim)return 1;if(n.is_mpim&&!r.is_mpim)return-1;if(!r.is_mpim&&!n.is_mpim){var a=i(r.id,"jumper_score")-i(n.id,"jumper_score");if(0!==a)return a}if(r.is_mpim&&n.is_mpim){var s=i(r.id,"jumper_score")-i(n.id,"jumper_score");if(0!==s)return s;var o=TS.mpims.getMemberCount(r)-TS.mpims.getMemberCount(n);if(0!==o)return o}var l=c(r);var u=c(n);if(t)return TS.i18n.sorter(l,u);if(l>u)return 1;if(u>l)return-1;return 0};var f=function e(t,r){if(t.is_mpim)return 0;var n=0;if(i(t.id,"jumper_exact_match"))n+=TS.ui.frecency.bonus_points.exact_match;else n+=p(t);if(i(t.id,"jumper_previous_name_scores"))n+=TS.ui.frecency.bonus_points.matches_previous_name;if(r.prefer_channel_members&&t.presence)if(r.model_ob&&h(t.id,r.model_ob))n+=TS.ui.frecency.bonus_points.member_of_this_channel;if(t.is_starred)n+=TS.ui.frecency.bonus_points.starred_channel;if(t.is_emoji)if("thumbsup"===t.name||"point_up"===t.name)n+=1;if(t.is_channel||t.is_group){if(t.is_archived)n+=TS.ui.frecency.bonus_points.archived_channel_or_group;if(t.is_channel&&r.prefer_channels_user_belongs_to)if(!t.is_archived&&!h(TS.model.user.id,d(t.id)))n+=TS.ui.frecency.bonus_points.not_in_channel}if(t.is_usergroup||t.is_broadcast_keyword)n+=TS.ui.frecency.bonus_points.usergroup_or_keyword;return n};var p=function e(t){var r=i(t.id,"jumper_score");if(!_.isFinite(r))return 0;var n=Math.pow(.5,r);return Math.round(TS.ui.frecency.bonus_points.fuzzy_match*n)};var h=function e(t,r){if(r.is_channel&&t===TS.model.user.id)return r.is_member;var n;if(TS.boot_data.feature_store_membership_in_redux)n=TS.redux.membership.getChannelMembershipInfoForUser(r.id,t);else n=TS.membership.getUserChannelMembershipStatus(t,r);return n.is_known&&n.is_member}})();var r={};var n=function e(t,n,i){if(!t||!n)return;if(!r[t])r[t]={};r[t][n]=i};var i=function e(t,n){if(!t||!n)return;if(!t||!r[t])return;return r[t][n]}},4828:function(e,t){(function(){TS.registerModule("ui.enterprise_shared_channels_invites",{onStart:function e(){TS.ui.validation.register("valid_invite",$e)},start:function e(){if(TS.boot_data.page_needs_enterprise)ye()}});var e;var t;var r;var n=[];var i;var a=false;var s;var o=false;var l=[];var u=[];var d=[];var c=[];var m;var f=false;var p=function e(r){if(!r)return;var n=B(r,G(r));if(!n)return;t.find('.sci_send_email_container [data-action="replace_sent_emails"]').replaceWith(TS.templates.shared_channels_invites_sent_emails(n))};var h=1e3;var g;var S;var T=1e3;var v;var b=function e(r,n){if(!r)r=false;if(!n)n=false;t.find("#sci_channels_create .input_wrapper .spinner").toggleClass("hidden",r);if(n)y(!r)};var y=function e(r){if(S){clearTimeout(S);S=null}if(!r)r=false;var n=t.find("#sci_channels_create .input_wrapper .available");n.toggleClass("hidden",r);if(!r)S=setTimeout(function(){n.addClass("hidden")},T)};var w=function n(){TS.kb_nav.start(i.find(".list_items"),".channel_browser_row",i,{use_data_ordering:true,px_offset:35,scrollToStartImmediately:function e(){i.longListView("scrollToTop",true)},scrollToEndImmediately:function e(){i.longListView("scrollToEnd",true)}});TS.kb_nav.setAllowHighlightWithoutBlurringInput(true);TS.kb_nav.setSubmitItemHandler(function(e){if(f)Z($(this),e)});i.find(".list_items").on("click",".channel_browser_row",function(e){Z($(this),e)});t.on("click",'[data-action="sci_to_create"]',ke);t.on("click",'[data-action="sci_channels_create"]',I);t.on("click",'[data-action="sci_cancel"]',xe);t.on("change",'[type="radio"][name="share_with"]',Ee);t.on("click",'[data-action="sci_show_action"]',ge);var s='#sci_channels_create input[name="channel_name"]';var o=_.debounce(function(e){if(v&&v.isPending()){if(g){clearTimeout(g);g=null}g=setTimeout(function(e){o(e)},h,e);return}$(".validation_message").remove();$('label[for="channel_name"]').removeClass("validation_warning");e.removeClass("validation_warning");var t=false;var r=true;var n=true;var i=false;var a=$('#sci_channels_create [data-action="sci_channels_create"]');b();Me(null,a,t,r);var s=TS.ui.validation.validate(e);if(s){var l=e.val().trim();var u=function s(o,u){if(!o){n=true;i=false;b(n,i);TS.generic_dialog.alert("Something failed! "+u.error)}else{if(u.name_taken){n=true;i=false;b(n,i);r=true;Me(null,a,t,r);TS.ui.validation.showWarning(e,'"'+_.escape(l)+'" is already taken by a channel, username, or user group.',{});return}v=null;n=true;i=true;b(n,i);r=false;t=true;Me(null,a,t,r)}return null};v=TS.api.callImmediately("enterprise.nameTaken",{name:l,ignore_local_team:false}).then(function(e){var t=e.data,r=e.args,n=e.request_id;var i=true;u(i,t,r,n);return{data:t,args:r,request_id:n}}).catch(function(e){var t=e.data,r=e.args,n=e.request_id;var i=false;u(i,t,r,n);return{data:t,args:r,request_id:n}})}else{n=true;b(n)}},h,{leading:false,trailing:true});t.on("input",s,function(e){e.preventDefault();e.stopPropagation();o($(this))});t.on("input",'#sci_channels_create [data-validation]:not([name="channel_name"])',function(){var e=t.find("#sci_channels_create");Me(e.find(E()),e.find('[data-action="sci_channels_create"]'),true)});r.on("textchange",function(){if(!a)return;P()}).on("keydown",function(e){if(e.which===TS.utility.keymap.esc)TS.ui.fs_modal.close()});var l={classes:"channel_browser_sort",onItemAdded:function e(t){if(!a)return;var r=$(t);var n=r.val();if(TS.model.ui_state){TS.model.ui_state.sort_shared_channel_browser_by=n;TS.storage.storeUIState(TS.model.ui_state)}ve(n);P()},styling:"normal",template:function e(t){var r=$(t);return new Handlebars.SafeString(r.text())},tokenTemplateSingle:function e(t){var r=$(t);var n=TS.i18n.t('<span class="greigh">Sort:</span> {value}',"channel_browser")({value:r.text()});return new Handlebars.SafeString(n)}};m.hide().lazyFilterSelect(l);t.on("click",".clear_filter_icon",function(){r.val("").trigger("textchange").focus()});e.on("keyup.sci",Q);t.on("click",'[data-action="sci_toggle_contents"]',Ie);t.on("click",'[data-action="sci_toggle_send_email"]',Ae);t.on("click",'[data-action="sci_toggle_copy_link"]',Pe);t.on("click",'[data-action="sci_send"]',ce);t.on("click",'[data-action="sci_copy"]',z);t.on("click",'[data-action="sci_revoke"]',_e);t.on("input","input[data-invite-id]",function(e){var t=$(e.target).parent();var r=true;Me(t,t.find('[data-action="sci_send"]'),r)})};var k=function e(){t.find(".showing_sci_action").removeClass("showing_sci_action")};var x=function e(t){$(t.target).closest(".sci_invite_container").find(".sci_copy_link_mini_container").addClass("hidden")};var C=function e(t){$(t.target).closest(".sci_invite_container").find(".sci_send_email_mini_container").addClass("hidden")};var M=function e(t,r){var n=[];if(t.length>0){n.push({is_divider:true,name:TS.i18n.t("Channels you can join","shared")()});n=n.concat(t)}if(r.length>0){n.push({is_divider:true,name:TS.i18n.t("Channels you belong to","shared")()});n=n.concat(r)}return n};var I=function e(){var r=t.find("#sci_channels_create");var n=r.find(E());if(!TS.ui.validation.validate(n,{quiet:true,fast:true})){TS.ui.validation.validate(n);Ladda.stopAll();r.find('[data-action="sci_channels_create"]').addClass("disabled");return}var i={};var a=!r.find('[name="access"]').prop("checked");if(q())switch(r.find('[name^="share_with"]:checked').val()){case"specific":i.target_domains=r.find('[name="domains"]').val();break;case"external":i.target_domain=r.find('[name="domain"]').val();break;case"all":i.all_teams=true}else i.target_domain=r.find('[name="domain"]').val();var s=r.find('[name="channel_name"]').val();if(s)i.channel_name=s;var o=r.find('[name="purpose"]').val();if(o)i.purpose=o.trim();if(i.target_domain){i.is_private=a;te(i).then(function(e){var t=e.data.invite_id;Ce(e.data);return ne().then(function(e){fe(e.data.invites,a);le(t)})}).catch(R).finally(Ladda.stopAll)}else ee(i,a).then(function(e){var t;if(e.data.group){t=e.data.group.id;if(!e.data.group.is_member){TS.warn("A new shared private channel was just created ("+t+") but the creator was not listed as a member in the API response");e.data.group.is_member=true}TS.groups.upsertGroup(e.data.group);TS.groups.displayGroup({id:t})}else{t=e.data.channel.id;if(!e.data.channel.is_member){TS.warn("A new shared channel was just created ("+t+") but the creator was not listed as a member in the API response");e.data.channel.is_member=true}TS.channels.upsertChannel(e.data.channel);TS.channels.displayChannel({id:t})}TS.ui.fs_modal.close()}).catch(R).finally(Ladda.stopAll)};var P=function e(){var t=$.trim(r.val());if(""!==t)if(-1!==t.indexOf("#")){t=t.replace("#","","g");t=$.trim(t)}if(t){r.closest(".channel_browser_filter_container").addClass("active");n=F(t)}else{r.closest(".channel_browser_filter_container").removeClass("active");n=F()}if(0===n.length){Oe(t);N("#sci_no_shared_channels")}else N("#sci_channels_container");i.longListView("scrollToTop",true);i.longListView("setItems",n);TS.utility.rAF(function(){TS.ui.utility.updateClosestMonkeyScroller(i);i.longListView("resizeImmediately")});if(t)TS.kb_nav.highlightFirstItem();else TS.kb_nav.clearHighlightedItem()};var A=function e(t,r){return _.find(D(),function(e){return e.team.domain===t&&e.channel_name===r})||_.find(D(true),function(e){return e.team.domain===t&&e.channel_name===r})};var E=function e(){var r=['[name="channel_name"]','[name="purpose"]'];if(q())switch(t.find('[name^="share_with"]:checked').val()){case"specific":r.push('[name="domains"]');break;case"external":r.push('[name="domain"]')}else r.push('[name="domain"]');return r.join(", ")};var F=function e(t){var r=O();var n=O(true);var i=!(r.length||n.length);if(i)return;var a=V(r,n);var s=[];var o=[];var l={};var u;var d;if(t){t=TS.utility.regexpEscape(t);d=new RegExp(t,"i")}a.forEach(function(e){var r=l.hasOwnProperty(e.id);if(r)return;if(!e.hasOwnProperty("name"))return;if(!r)l[e.id]=true;if(t){if(e.name.toLowerCase()===t.toLowerCase()){u=e;return}if(!e.name.match(d))return}if(e.is_member)o.push(e);else s.push(e)});if(u)if(u.is_member)o.unshift(u);else s.unshift(u);return M(s,o)};var O=function e(t){return t?l:d};var B=function e(t,r){return _.find(D(r),function(e){return e.invite_id==t})};var D=function e(t){return t?u:c};var H=function e(){var r=TS.i18n.t("Anyone in your workspace can join","shared")();if(q()){var n=_.escape(TS.redux.enterprise.getEnterpriseOrgName());switch(t.find('[name^="share_with"]:checked').val()){case"specific":r=TS.i18n.t("Specific workspaces at {name} can join","shared")({name:n});break;case"all":r=TS.i18n.t("Anyone at {name} can join","shared")({name:n})}}return r};var j=function e(){var r=TS.i18n.t("Restricted to invited members","shared")();if(q()){var n=_.escape(TS.redux.enterprise.getEnterpriseOrgName());switch(t.find('[name^="share_with"]:checked').val()){case"specific":r=TS.i18n.t("Restricted to invited members on specific {name} workspaces","shared")({name:n});break;case"all":r=TS.i18n.t("Restricted to invited members at {name}","shared")({name:n})}}return r};var R=function e(t){var r;switch(t.data.error){case"invalid_target_domain":r=TS.i18n.t("Darn&mdash;we couldn’t find a workspace with that domain. Try again?","shared")();break;case"name_taken":r=TS.i18n.t("Darn&mdash;that channel name is already taken. Try another?","shared")();break;case"invite_exists":r=TS.i18n.t("An invitation already exists for that workspace and channel.","shared")();break;case"shared_channel_exists":r=TS.i18n.t("Good news! That workspace has already joined the shared channel.","shared")();break;case"not_paid":r=TS.i18n.t("Darn&mdash;that workspace has to upgrade to a paid Slack plan to join a shared channel.","shared")();break;default:return L(t)}return TS.generic_dialog.alert(r)};var L=function e(t){var r=t.message||"";if(t.data&&t.data.error)r+=": "+t.data.error;TS.error(r);var n=TS.i18n.t("Sorry! Something went wrong. Please try again.","shared")();return TS.generic_dialog.alert(n)};var N=function e(r){var n=["#sci_loading","#sci_no_shared_channels","#sci_channels_container","#sci_channels_create","#sci_send","#sci_invites_container"].filter(function(e){return e!==r}).join(", ");t.find(n).addClass("hidden");t.find(r).removeClass("hidden")};var U=function e(){o=false;if(a)i.longListView("setHidden",true)};var q=function e(){return TS.boot_data.page_needs_enterprise};var G=function e(t){return!!B(t,true)};var W=function e(){var r=t.find("#sci_channels_create");if(TS.useReactLFS()){var n=document.getElementById("sci_teams_picker");var i=true;TS.ui.team_picker.make(n,{omitted_ids:[TS.model.team.id],onValueChange:function e(t){var n=t.map(function(e){return e.team.domain}).join(",");r.find('[name="domains"]').val(n);var i=true;Me(r.find(E()),r.find('[data-action="sci_channels_create"]'),i)}},i)}else r.find('[name="domains"]').each(function(e,t){var n=$(t);TS.ui.team_picker.make(n,{omitted_ids:[TS.model.team.id]});n.on("change",function(){var e=TS.ui.team_picker.value(n).map(function(e){return e.team.domain}).join(",");n.val(e);var t=true;Me(r.find(E()),r.find('[data-action="sci_channels_create"]'),t)})})};var z=function e(t){var r=$(t.target);var n=r.parent();var i=n.find("input");var a=n.find("label > span");var s=i.get(0);var o=i.val();if(TS.clipboard.canWriteText())TS.clipboard.writeText(o);else Se(a);if(s)s.setSelectionRange(0,o.length)};var K=function e(){if(!D().length&&!O().length&&!D(true).length&&!O(true).length)xe()};var V=function e(t,r){return t.concat(r)};var Y=function e(t){if("num_members"in t)return t.num_members||0;return t.active_members?t.active_members.length:0};var J=function r(){Fe(true);t=null;e.off("keyup.sci");e=null;TS.kb_nav.end();o=false;a=false;me([]);me([],true)};var Q=function e(t){if(t.which!==TS.utility.keymap.enter)return;var r=$(t.target);if(r.is("input[data-invite-id]"))ce(t);else if(r.is('input[name="domain"], input[name="channel_name"]')){TS.ui.startButtonSpinner($('#sci_channels_create [data-action="sci_channels_create"]').get(0));I(t)}};var X=function n(){t=$("#sci_container");e=$("body");s=t.find(".list_container");i=s.find(".list");r=t.find("#channel_browser_filter");m=t.find("#channel_browser_sort");if(TS.model.ui_state&&TS.model.ui_state.sort_shared_channel_browser_by)m.find('option[value="'+TS.model.ui_state.sort_shared_channel_browser_by+'"]').attr("selected",true);se().then(xe).catch(R)};var Z=function e(t,r){if(t.hasClass("channel_link")){var n=t.data("channel-id");TS.view.onChannelReferenceClick(r,n)}else{var i=t.data("group-id");TS.view.onGroupReferenceClick(r,i)}TS.ui.fs_modal.close()};var ee=function e(t,r){return TS.api.call(r?"enterprise.groups.createShared":"enterprise.channels.createShared",t)};var te=function e(t){return TS.api.call("conversations.inviteShared",t)};var re=function e(t){return TS.api.call(t?"groups.listShared":"channels.listShared")};var ne=function e(){return TS.api.call("channels.listSharedInvites")};var ie=function e(t){return TS.api.call("channels.revokeSharedInvite",t)};var ae=function e(t){return TS.api.call("channels.sendSharedInvite",t)};var se=function e(){var t=[re().reflect(),re(true).reflect()];return Promise.all(t).then(function(e){var t=[];e.forEach(function(e){if(e.isFulfilled())return;t.push(e.reason())});if(t.length)return Promise.reject(new Error("Some shared channels start APIs failed:\n"+t.join("\n")));me(e[0].value().data.channels);me(e[1].value().data.channels,true)})};var oe=function e(r){if(!r)return;var n=B(r,G(r));if(!n)return;t.find("#sci_invite_container_"+r+' [data-action="replace_emailed_invites"]').replaceWith(TS.templates.shared_channels_invites_emailed_invitations(n))};var le=function e(r){if(!r)return;var n=B(r,G(r));if(!n)return;var i=t.find("#sci_invite_container_"+r);if(i.length)i.replaceWith(TS.templates.shared_channels_invites_invite(n));else t.find("#sci_invites_container .sci_list_header").after(TS.templates.shared_channels_invites_invite(n));t.find("#sci_invites_container").removeClass("hidden")};var ue=function e(r){if(!r)return;t.find("#sci_invite_container_"+r).remove();var n=t.find("#sci_invites_container");if(1===n.children().length)n.addClass("hidden")};var de=function e(t,r){_.remove(D(r),function(e){return e.invite_id==t})};var _e=function e(t){var r=$(t.target);var n=r.data("invite-id");var i=G(n);ie({invite_id:n}).then(function(){de(n,i);ue(n);K()}).catch(R)};var ce=function e(t){var r=$(t.target);var n=r.parent();if(!TS.ui.validation.validate(n,{quiet:true,fast:true})){TS.ui.validation.validate(n);n.find('[data-action="sci_send"]').addClass("disabled");return}var i=r.data("invite-id");var a=n.find("input");var s=a.val();if(!s)return;var o=G(i);var l={invite_id:i,email:s};ae(l).then(function(){a.val("");return ne().then(function(e){fe(e.data.invites,o);oe(i);p(i)})}).catch(R)};var me=function e(t,r){if(t.length)t=t.map(function(e){var t=TS.shared.getModelObById(e.channel);return $.extend({},e,t)});if(r)l=t;else d=t};var fe=function e(t,r){if(r)u=t;else c=t};var pe=function e(){var r=t.find("#sci_channels_create .placeholder_overlay");t.find('#sci_channels_create input[name="domain"]').on("input",function(e){r.toggleClass("hidden",!!$(e.target).val())})};var he=function e(){t.find('#sci_channels_create [name="access"]').togglify({on_text:TS.i18n.t("Public","shared")(),off_text:TS.i18n.t("Private","shared")(),label:H(),off_label:j(),off_class:"ts_toggle_orange",initial_state:true})};var ge=function e(t){k();var r=$(t.currentTarget).addClass("showing_sci_action");if(r.is(".sci_send_email_container"))r.find("input").focus()};var Se=function e(t){var r=t.data("timeout");clearTimeout(r);t.removeClass("hidden").data("timeout",setTimeout(function(){t.addClass("hidden")},3e3))};var Te=function e(){if(o)return;if(!a){we();o=true;return}if(a){o=true;i.longListView("setHidden",false);i.longListView("setItems",F(),true);TS.utility.rAF(function(){TS.ui.utility.updateClosestMonkeyScroller(i)})}};var ve=function e(t){var r=["name","creator","created","members_high","members_low"];var n="name";if(-1!==r.indexOf(t))n=t;be(O(),n);be(O(true),n)};var be=function e(t,r){if("name"===r)t.sort(function(e,t){if(e._name_lc>t._name_lc)return 1;if(t._name_lc>e._name_lc)return-1;return 0});else if("creator"===r)t.sort(function(e,t){var r;var n;r=TS.members.getMemberById(e.creator);n=TS.members.getMemberById(t.creator);if(r&&n){if(r._name_lc>n._name_lc)return 1;if(n._name_lc>r._name_lc)return-1;return 0}else if(r&&!n)return-1;else if(!r&&n)return 1;return 0});else if("created"===r)t.sort(function(e,t){if(e.created<t.created)return 1;if(t.created<e.created)return-1;return 0});else if("members_high"===r)t.sort(function(e,t){var r=Y(e);var n=Y(t);if(r<n)return 1;if(n<r)return-1;return 0});else if("members_low"===r)t.sort(function(e,t){var r=Y(e);var n=Y(t);if(r>n)return 1;if(n>r)return-1;return 0})};var ye=function e(){var t=TS.permissions.members.canCreateConvertOrgSharedChannels();var r={body_template_html:TS.templates.shared_channels_invites_modal({show_create_shared_channel_btn:t}),onShow:X,onCancel:J,modal_class:"fs_modal_internal_scroll convert_to_shared_dialog"};TS.ui.fs_modal.start(r)};var we=function e(){a=true;var t=F();var r={items:t,approx_item_height:60,preserve_dom_order:true,approx_divider_height:35,pin_dividers:true,makeElement:function e(t){var r=$(TS.templates.channel_browser_row({is_shared:true}));t.$icon=r.find(".channel_browser_type_icon");t.$name=r.find(".channel_browser_channel_name");t.$creator=r.find(".channel_browser_created_by");t.$date=r.find(".channel_browser_created_on");t.$purpose=r.find(".channel_browser_channel_purpose");if(!TS.boot_data.feature_hide_membership_counts_in_channel_browser){t.$member_count_container=r.find(".channel_browser_member_count_container");t.$member_count=r.find(".channel_browser_member_count")}t.$open=r.find(".channel_browser_open");t.$preview=r.find(".channel_browser_preview");t.$joined=r.find(".channel_browser_joined");t.$shared_channel_icon=r.find(".shared_channel_icon");return r},makeDivider:function e(){return $("<div>").addClass("channel_browser_divider")},renderItem:function e(t,r,n){if(TS.shared.isModelObOrgShared(r))n.$shared_channel_icon.removeClass("hidden");else n.$shared_channel_icon.addClass("hidden");if(r.is_channel)n.$icon.removeClass("ts_icon_lock").addClass("ts_icon_channel_pane_hash");else n.$icon.removeClass("ts_icon_channel_pane_hash").addClass("ts_icon_lock");n.$name.text(r.name?r.name:"");var i=TS.members.getMemberById(r.creator);if(i){n.$creator.removeClass("hidden");n.$creator.find(".channel_browser_creator_name").text(TS.members.getPrefCompliantMemberName(i))}else n.$creator.addClass("hidden");n.$date.text(TS.interop.datetime.toCalendarDate(r.created));if(!TS.boot_data.feature_hide_membership_counts_in_channel_browser){var a=Y(r);n.$member_count.text(a)}if(r.purpose&&r.purpose.value){var s=TS.utility.formatTopicOrPurpose(r.purpose.value);s=s.replace(/<a .*?>(.*?)<\/a>/g,"$1");n.$purpose.removeClass("hidden").html(s)}else n.$purpose.text("").addClass("hidden");var o=r.is_member||r.is_group;if(o){n.$open.removeClass("hidden");n.$preview.addClass("hidden");n.$joined.removeClass("hidden")}else{n.$open.addClass("hidden");n.$preview.removeClass("hidden");n.$joined.addClass("hidden")}if(r.is_group){t.removeClass("channel_link").removeAttr("data-channel-id");t.addClass("group_link").attr("data-group-id",r.id)}else{t.removeClass("group_link").removeAttr("data-group-id");t.addClass("channel_link").attr("data-channel-id",r.id)}},renderDivider:function e(t,r){t.text(r.name)},calcItemHeight:function e(t){return t.outerHeight()}};i.longListView(r);w();TS.utility.rAF(function(){i.monkeyScroll()})};var ke=function e(){f=false;var r=q();var n={reserved_domain:TS.model.team.domain};if(r)n.enterprise_info=TS.redux.enterprise.getEnterprise();var i=TS.templates.shared_channels_invites_create(n);var a=t.find("#sci_channels_create");a.html(i).find("textarea").autogrow();N("#sci_channels_create");U();$("#fs_modal.convert_to_shared_dialog").toggleClass("fs_modal_internal_scroll",false);t.find("#sci_header_wrapper").addClass("hidden");pe();he();if(r)W();t.find('#sci_channels_create [name="domain"]').focus();Ladda.bind('#sci_channels_create [data-action="sci_channels_create"]');Fe()};var xe=function e(){f=true;t.find("#sci_header_wrapper").removeClass("hidden");var r=O();var n=O(true);var i=!(r.length||n.length);if(i){Oe();N("#sci_no_shared_channels");U();w();return null}N("#sci_channels_container");$("#fs_modal.convert_to_shared_dialog").toggleClass("fs_modal_internal_scroll",true);if(TS.model.ui_state&&TS.model.ui_state.sort_shared_channel_browser_by)ve(TS.model.ui_state.sort_shared_channel_browser_by);else ve(m.val());Te();Fe(true)};var Ce=function e(r){f=false;var n=TS.templates.shared_channels_invites_send(r);t.find("#sci_send").html(n);N("#sci_send");U();Fe()};var Me=function e(t,r,n,i){if(n&&t){var a=$(_.find(t,["nodeName","TEXTAREA"]));var s=a.val();if(s&&s.length)a.attr("data-validation","maxlength=250");else a.removeAttr("data-validation");i=!TS.ui.validation.validate(t,{quiet:true,fast:true})}r.toggleClass("disabled",i)};var Ie=function e(t){if($(t.target).is("a, input, .btn"))return;var r=$(t.currentTarget);var n=r.hasClass("showing_contents");r.toggleClass("showing_contents",!n);r.find(".sci_toggle_icon").toggleClass("ts_icon_caret_right",n).toggleClass("ts_icon_caret_down",!n)};var Pe=function e(t){var r=$(t.target).closest(".sci_invite_container").find(".sci_copy_link_mini_container");r.toggleClass("hidden",!r.hasClass("hidden"));C(t)};var Ae=function e(t){var r=$(t.target).closest(".sci_invite_container").find(".sci_send_email_mini_container");r.toggleClass("hidden",!r.hasClass("hidden")).find("input").focus();x(t)};var Ee=function e(r){var n=$(r.target);var i=t.find("#sci_channels_create");var a=n.val();var s="specific"===a;var o="external"===a;$("#sci_specific_team").toggleClass("hidden",!s);$("#sci_external_team").toggleClass("hidden",!o);i.find('[for="share_with_specific"]').toggleClass("hidden",!s);i.find('[for="share_with_external"]').toggleClass("hidden",!o);if("specific"===a)i.find('[name="team_list"]').focus();if("external"===a)i.find('[name="domain"]').focus();var l=true;Me(i.find(E()),i.find('[data-action="sci_channels_create"]'),l);Be()};var Fe=function e(t){if(t){TS.ui.fs_modal.unbindBackButton();TS.ui.fs_modal.hideBackButton()}else{TS.ui.fs_modal.bindBackButton(xe);TS.ui.fs_modal.showBackButton()}};var Oe=function e(r){var n=t.find("#sci_no_shared_channels");var i=n.find(".sci_no_shared_note");var a=TS.i18n.t("You don’t have any shared channels yet.","shared")();if(r){var s=TS.i18n.t("No matches found for <strong> {escaped_query_string} </strong>","shared")({escaped_query_string:TS.utility.truncateAndEscape(r,50)});i.html(s)}else i.text(a)};var Be=function e(){t.find(".ts_toggle_on_label").text(H());t.find(".ts_toggle_off_label").text(j())};var $e=function e(r,n){if(!t)return true;if(!r.is("input"))return true;var i=$("#sci_channels_create");var a=r.is('[name="domain"]')?r:i.find("[name=domain]");var s=r.is("[name=channel_name]")?r:i.find("[name=channel_name]");var o=a.val();var l=s.val();if(!o)return true;o=o.trim();l=l.trim();if(A(o,l)){if(!n.quiet)r.addClass("invalid_invite");var u=TS.i18n.t("This invite already exists. Try a different workspace or channel!","shared")();TS.ui.validation.showWarning(r,u,n);return}if(a===r){if(l&&!n.quiet&&s.hasClass("invalid_invite")){s.removeClass("invalid_invite");TS.ui.validation.validate(s)}}else if(o&&!n.quiet&&a.hasClass("invalid_invite")){a.removeClass("invalid_invite");TS.ui.validation.validate(a)}if(!n.quiet)r.removeClass("invalid_invite");return true}})()},4829:function(e,t){(function(){TS.registerModule("user_groups",{updated_sig:new signals.Signal,updated_info_sig:new signals.Signal,batch_upserted_sig:new signals.Signal,is_in_bulk_upsert_mode:false,onStart:function e(){if(TS.client)TS.client.login_sig.add(TS.user_groups.onLogin);else if(TS.web)TS.web.login_sig.add(TS.user_groups.onLogin);TS.user_groups.sortUserGroupsAndDispatchThrottled=_.debounce(TS.user_groups.sortUserGroupsAndDispatchThrottled,500)},onLogin:function e(){o=true;TS.user_groups.sortUserGroups()},getUserGroupsByHandle:function t(r){if(!r||"@"===r)return;r=_.toLower(r);var n=TS.model.user_groups;if(!n)return;var i=e[r];if(i)return i;for(var a=0;a<n.length;a+=1){i=n[a];if(i.handle==r||"@"+i.handle==r){TS.warn(r+" not in _handle_map?");e["@"+r]=i;e[r]=i;return i}}return null},getUserGroupsById:function e(r){if(TS.model.user&&TS.model.user.is_restricted)return false;if(TS.useReduxMembers())return TS.redux.user_groups.getUserGroupById(r);var n=TS.model.user_groups;var i=t[r];if(i)return i;if(!n)return;for(var a=0;a<n.length;a+=1){i=n[a];if(i.id==r){TS.warn(r+" not in _id_map?");t[r]=i;return i}}return null},getActiveUserGroups:function e(t){var r=_.filter(TS.model.user_groups,function(e){if(t)return!e.date_delete;return!e.date_delete&&e.team_id});return r},promiseToGetUserGroupMembers:function e(t){return TS.api.call("subteams.users.list",{subteam:t,include_disabled:1}).then(function(e){var r=e.data;var n=TS.user_groups.mergeAndUpsertUserGroupFromUsersListCall(t,r);return n})},getUserGroupMembers:function e(t,r){var n=function e(n,i){if(n&&i){var a=TS.user_groups.mergeAndUpsertUserGroupFromUsersListCall(t,i);if(a&&r)r(a)}};TS.api.call("subteams.users.list",{subteam:t,include_disabled:1}).then(function(e){var t=e.data,r=e.args,i=e.request_id;var a=true;n(a,t,r,i);return{data:t,args:r,request_id:i}}).catch(function(e){var t=e.data,r=e.args,i=e.request_id;var a=false;n(a,t,r,i);return{data:t,args:r,request_id:i}})},mergeAndUpsertUserGroupFromUsersListCall:function e(t,r){var n=TS.user_groups.getUserGroupsById(t);if(!n)return;n.users=r.users;n.user_count=r.users.length;if(TS.useReduxMembers()){TS.user_groups.upsertUserGroupAndSignal(n);return TS.user_groups.getUserGroupsById(t)}TS.user_groups.updated_sig.dispatch(n.id);return n},updateMembersOfUserGroup:function e(t,r){TS.api.call("subteams.users.update",t).then(function(e){var t=e.data,n=e.args,i=e.request_id;var a=true;if(r)r(a,t,n,i);return{data:t,args:n,request_id:i}}).catch(function(e){var t=e.data,n=e.args,i=e.request_id;var a=false;if(r)r(a,t,n,i);return{data:t,args:n,request_id:i}})},createUserGroup:function e(t,r){TS.api.call("subteams.create",t).then(function(e){var t=e.data,n=e.args,i=e.request_id;var a=true;if(r)r(a,t,n,i);return{data:t,args:n,request_id:i}}).catch(function(e){var t=e.data,n=e.args,i=e.request_id;var a=false;if(r)r(a,t,n,i);return{data:t,args:n,request_id:i}})},updateUserGroup:function e(t,r){TS.api.call("subteams.update",t).then(function(e){var t=e.data,n=e.args,i=e.request_id;var a=true;if(r)r(a,t,n,i);return{data:t,args:n,request_id:i}}).catch(function(e){var t=e.data,n=e.args,i=e.request_id;var a=false;if(r)r(a,t,n,i);return{data:t,args:n,request_id:i}})},enableUserGroup:function e(t,r){TS.api.call("subteams.enable",{subteam:t}).then(function(e){var t=e.data,n=e.args,i=e.request_id;var a=true;if(r)r(a,t,n,i);return{data:t,args:n,request_id:i}}).catch(function(e){var t=e.data,n=e.args,i=e.request_id;var a=false;if(r)r(a,t,n,i);return{data:t,args:n,request_id:i}})},disableUserGroup:function e(t,r){TS.api.call("subteams.disable",{subteam:t}).then(function(e){var t=e.data,n=e.args,i=e.request_id;var a=true;if(r)r(a,t,n,i);return{data:t,args:n,request_id:i}}).catch(function(e){var t=e.data,n=e.args,i=e.request_id;var a=false;if(r)r(a,t,n,i);return{data:t,args:n,request_id:i}})},deleteUserGroup:function e(t,r){TS.api.call("subteams.delete",{subteam:t,include_disabled:1}).then(function(e){var t=e.data,n=e.args,i=e.request_id;var a=true;if(r)r(a,t,n,i);return{data:t,args:n,request_id:i}}).catch(function(e){var t=e.data,n=e.args,i=e.request_id;var a=false;if(r)r(a,t,n,i);return{data:t,args:n,request_id:i}})},needsToFetchMembership:function e(t){return void 0===t.users||_.size(t.users)!==t.user_count},ensureUserGroupMembersInModelObNumIsKnown:function e(t,r){var n=TS.user_groups.getUserGroupsById(t);var i=TS.channels.getChannelById(r)||TS.groups.getGroupById(r);if(!n||!i)return Promise.resolve();if(_.isUndefined(n.users)){if(!s[t]){s[t]=TS.user_groups.promiseToGetUserGroupMembers(t).then(function(e){if(e&&e.users)return TS.membership.ensureChannelMembershipIsKnownForUsers(i.id,e.users)}).finally(function(){delete s[t]});return s[t]}return s[t]}return TS.membership.ensureChannelMembershipIsKnownForUsers(i.id,n.users)},getUserGroupMembersNotInModelObCount:function e(t,r){var n=TS.user_groups.getUserGroupsById(t);var i=_.get(n,"users.length");var a=TS.channels.getChannelById(r)||TS.groups.getGroupById(r);if(!n||!a)return 0;if(_.isUndefined(n.users))return 0;if(!TS.membership.isChannelMembershipKnownForUsers(a.id,n.users))return 0;var s=n.users.filter(function(e){var t;if(TS.boot_data.feature_store_membership_in_redux)t=TS.redux.membership.getChannelMembershipInfoForUser(a.id,e);else t=TS.membership.getUserChannelMembershipStatus(e,a);return t.is_known&&t.is_member});return i-s.length},upsertUserGroup:function e(t){if(TS.model.user&&TS.model.user.is_restricted)return false;var r=TS.user_groups.getUserGroupsById(t.id);t._name_lc=t.name.toLowerCase();if(r){if(TS.has_pri[l])TS.log(l,'updating existing User Group "'+t.id+'"');if(TS.useReduxMembers())r=_.assign({},r);var n=TS.model.your_user_group_regex[t.id];if(n)TS.user_groups.removeSelfUserGroup(r.id);for(var a in t)if(r[a]!=t[a])r[a]=t[a];if(!t.date_delete&&t.users&&-1!==t.users.indexOf(TS.model.user.id)){if(!TS.user_groups.getUserGroupsById(t.id))if(!TS.useReduxMembers())TS.model.user_groups.push(t);TS.user_groups.upsertSelfUserGroup(r.id);i(t);if(TS.useReduxMembers())if(TS.user_groups.is_in_bulk_upsert_mode)TS.redux.user_groups.addToBulkUpsertPayload(r);else TS.redux.user_groups.addUserGroup(r)}}else if(!t.date_delete){if(TS.has_pri[l])TS.log(l,'Adding user group "'+t.id+'"');if(!TS.user_groups.getUserGroupsById(t.id))if(!TS.useReduxMembers())TS.model.user_groups.push(t);i(t);if(TS.useReduxMembers())if(TS.user_groups.is_in_bulk_upsert_mode)TS.redux.user_groups.addToBulkUpsertPayload(t);else TS.redux.user_groups.addUserGroup(t)}if(!TS.user_groups.is_in_bulk_upsert_mode)TS.user_groups.sortUserGroupsAndDispatchThrottled()},sortUserGroupsAndDispatch:function e(){TS.user_groups.sortUserGroups();TS.user_groups.updated_sig.dispatch()},sortUserGroupsAndDispatchThrottled:function e(){return TS.user_groups.sortUserGroupsAndDispatch()},startBatchUpsert:function e(){if(TS.user_groups.is_in_bulk_upsert_mode)return false;TS.user_groups.is_in_bulk_upsert_mode=true;return true},finishBatchUpsert:function e(){if(!TS.user_groups.is_in_bulk_upsert_mode)return false;TS.user_groups.is_in_bulk_upsert_mode=false;TS.user_groups.batch_upserted_sig.dispatch();TS.user_groups.sortUserGroupsAndDispatch();return true},sortUserGroups:function e(){if(!o)return;if(TS.useReduxMembers())return;TS.model.user_groups.sort(TS.i18n.mappedSorter("_name_lc"))},upsertUserGroupAndSignal:function e(t){TS.user_groups.upsertUserGroup(t);TS.user_groups.updated_sig.dispatch(t.id)},userGroupMembersChanged:function e(t){TS.info("TS.user_groups.userGroupMembersChanged");var r=TS.user_groups.getUserGroupsById(t.subteam_id);if(!r)return;if(r.users){if(t.added_users)r.users=_.union(r.users,t.added_users);if(t.removed_users)r.users=_.difference(r.removed_users,t.removed_users)}r.user_count=parseInt(r.user_count,10)||0;r.user_count+=parseInt(t.added_users_count,10)||0;r.user_count=Math.max(0,r.user_count-(t.removed_users_count||0));r.date_previous_update=_.assign(r,_.pick(t,["date_update","date_previous_update"]))},removeUserGroup:function e(t){var r=TS.user_groups.getUserGroupsById(t.id);if(r){TS.user_groups.removeSelfUserGroup(r.id);a(r);r.date_delete=-1}},removeUserGroupAndSignal:function e(t){TS.user_groups.removeUserGroup(t);TS.user_groups.updated_sig.dispatch(t.id)},upsertSelfUserGroup:function e(t){var r=TS.model.your_user_group_regex[t];if(r)TS.user_groups.removeSelfUserGroup(t);var n=TS.user_groups.getUserGroupsById(t);if(n&&!n.date_delete){var i=new RegExp("<!subteam\\^("+n.id+(n.handle?"|"+n.handle:"")+")\\b");TS.model.your_user_group_regex[n.id]=i;if(n.handle){TS.model.highlight_words.push("@"+n.handle);TS.model.highlight_words_regex=null}if(TS.useReduxMembers())TS.redux.dispatch(TS.interop.redux.models.userGroups.addMemberToGroup({groupId:n.id,memberId:TS.model.user.id}))}},removeSelfUserGroup:function e(t){TS.model.your_user_group_regex[t]=null;delete TS.model.your_user_group_regex[t];var r=TS.user_groups.getUserGroupsById(t);if(r){if(r.handle)_.pull(TS.model.highlight_words,"@"+r.handle);a(r);TS.model.highlight_words_regex=null;TS.user_groups.updated_sig.dispatch(r.id);if(TS.useReduxMembers())TS.redux.dispatch(TS.interop.redux.models.userGroups.removeMemberFromGroup({groupId:r.id,memberId:TS.model.user.id}))}},ensureUserGroupsArePresent:function e(t){var n=[];t.forEach(function(e){if(!TS.user_groups.getUserGroupsById(e))n.push(e)});if(!n.length)return Promise.resolve();return r(n)},test:function e(){return{clearUseGroupMaps:n}}});var e={};var t={};var r=function e(t){var r=[];t.forEach(function(e){r.push({type:"and",clauses:[{type:"is",value:"group"},{type:"id",value:e}]})});var n={count:t.length,include_usergroups:true,query:{type:"or",clauses:r}};n.query=JSON.stringify(n.query);return TS.api.callImmediately("search.enterprise",n).then(function(e){if(e.data.items&&e.data.items.length){TS.user_groups.startBatchUpsert();e.data.items.forEach(function(e){TS.user_groups.upsertUserGroup(e)});TS.user_groups.finishBatchUpsert()}return null})};var n=function r(){e={};t={}};var i=function r(n){if(!n)return;if(n.handle){e[n.handle]=n;e["@"+n.handle]=n}t[n.id]=n};var a=function r(n){if(!n)return;if(n.handle){delete e[n.handle];delete e["@"+n.handle]}delete t[n.id]};var s={};var o;var l=4})()},4830:function(e,t){(function(){TS.registerModule("ui.admin_user_groups",{user_groups_fetched:new signals.Signal,onStart:function e(){$("body").on("click",'[data-action="admin_user_groups_modal"]',function(){l()});$("body").on("click",'[data-action="admin_user_groups_modal_new"]',function(){TS.ui.admin_user_groups.add()})},start:function e(){l()},add:function e(){l();s=true;y()},editInfo:function e(t){l();s=true;y(t)},editMembers:function e(t){l();s=true;k(t,false)},disable:function e(t){l();s=true;v(t,"disable_user_group")},enable:function e(t){l();s=true;v(t,"enable_user_group")},remove:function e(t){l();s=true;v(t,"delete_user_group")},test:function e(){var t={_isFullLocalMember:E};Object.defineProperty(t,"_isFullLocalMember",{get:function e(){return E},set:function e(t){E=t}});return t}});var e;var t;var r;var n;var i=true;var a=[];var s=false;var o=[];var l=function e(){var t=TS.templates.user_group_modal({show_info_pane:!TS.prefs.getPref("hide_user_group_info_pane"),show_user_groups_add:TS.permissions.members.canCreateAndDeleteUserGroups()});var r={body_template_html:t,onShow:u,onCancel:d};TS.ui.fs_modal.start(r)};var u=function i(){e=$("#user_groups_container");t=$("#all_user_groups");r=$("#user_groups_form_div");n=$("#user_groups_toggle_div");S();e.find('[data-action="open_form"]').on("click",function(e){e.preventDefault();var t=$(this).closest(".user_group_item").data("user-group-id");var r=F(t);y(r)})};var d=function l(){i=true;e=null;t=null;r=null;n=null;s=false;H=null;j=null;$(window).off("resize",g);TS.ui.admin_user_groups.user_groups_fetched.dispatch(a);O(TS.model.user_groups);B(o,TS.model.user_groups)};var c=function e(t){if(t)t.preventDefault();if(!s)S();else{TS.ui.fs_modal.close();H=null}O(TS.model.user_groups);B(o,TS.model.user_groups)};var m=function e(){if(!s){i=true;S()}else{TS.ui.fs_modal.close();H=null}TS.ui.admin_user_groups.user_groups_fetched.dispatch(a);O(TS.model.user_groups);B(o,TS.model.user_groups)};var f=function e(){if(!s){TS.ui.fs_modal.bindBackButton(S);TS.ui.fs_modal.showBackButton()}};var p=function e(t){if(!a||!t)return false;for(var r=0,n=a.length;r<n;r+=1)if(a[r].auto_type===t)return a[r];return false};var h=function e(t,r){if(!t){var n=$("#user_group_name_input").val()||"";var i=$("#user_group_handle_input").val()||"";r.group_name=n;r.group_handle=i;if(r.error&&("forbidden_handle"===r.error||"forbidden_name"===r.error)){var a=n+i;if(a){var s=p("owner");var o=p("admin");var l=!!a.match(/admins/i);var u=!!a.match(/owners/i);r.suggest_auto_group=true;r.can_create_auto_owners=u&&TS.model.user.is_admin&&!s;r.can_enable_auto_owners=u&&s&&s.date_delete;r.can_create_auto_admins=l&&TS.model.user.is_admin&&!o;r.can_enable_auto_admins=l&&o&&o.date_delete}}$("#user_group_alerts").html(TS.templates.user_group_alerts(r));return true}return false};var g=function e(){var t=$("#user_groups_header");if(!t.length)return;var r=$("#user_groups_list_div");if(!r.length)return;var n=parseInt(t.css("padding-top"),10);var i=t[0].offsetHeight;var a=$(window).height();var s=250;var o=Math.max(s,a-i-n);r.css("height",o)};var S=function e(s){if(i){var l=$("#user_groups_list_div");l.html(Handlebars.helpers.loadingHTML());var u=function e(t,r){if(h(t,r))return;a=r.subteams;for(var n=0,i=a.length;n<i;n+=1)a[n]._name_lc=a[n].name.toLowerCase();a.sort(TS.i18n.mappedSorter("_name_lc"));TS.ui.admin_user_groups.user_groups_fetched.dispatch(a);A();T();if(s){$('#fs_modal [data-user-group-id="'+s+'"]').addClass("highlight_yellow");$("#fs_modal").animate({scrollTop:$(".highlight_yellow").offset().top},500)}o=r.subteams};TS.api.call("subteams.list",{include_disabled:1,include_users:1}).then(function(e){var t=e.data,r=e.args,n=e.request_id;var i=true;u(i,t,r,n);return{data:t,args:r,request_id:n}}).catch(function(e){var t=e.data,r=e.args,n=e.request_id;var i=false;u(i,t,r,n);return{data:t,args:r,request_id:n}});i=false}t.removeClass("hidden");r.addClass("hidden");n.addClass("hidden");TS.ui.fs_modal.hideBackButton()};var T=function n(){$(window).on("resize",g);g();$("#user_groups_list_div").monkeyScroll();H=$("#user_groups_list_div").data("monkeyScroll");$("#user_group_modal_search").on("keydown keyup change",I);j=$("#user_groups_header .user_groups_search .icon_close");j.off("click").on("click",P);t.off("click");t.on("click",'[data-action="open_form"]',function(e){e.preventDefault();var t=$(e.target);var r=t.closest(".user_group_item").data("user-group-id");var n=F(r);y(n)});t.on("click",'[data-action="edit_members"]',function(e){e.preventDefault();var t=$(e.target);var r=t.closest(".user_group_item").data("user-group-id");var n=F(r);k(n)});t.on("click",'[data-action="hide_info_pane"]',function(t){t.preventDefault();TS.prefs.setPrefByAPI({hide_user_group_info_pane:true},function(t,r){if(h(t,r))return;e.find(".info_panel").addClass("hidden")})});t.on("click",".user_group_toggle_btn",function(e){e.preventDefault();var t=$(e.target).closest("button, a");var r=t.closest(".user_group_item").data("user-group-id");var n=t.data("action");var i=F(r);v(i,n)});t.on("click",".clear_members_filter",P);var a=function e(t,r){if(t){i=true;s=false;S(r.subteam&&r.subteam.id?r.subteam.id:null)}};var o={owners:{create:function e(){TS.api.call("subteams.createAuto",{type:"owner"}).then(function(e){var t=e.data,r=e.args,n=e.request_id;var i=true;if(a)a(i,t,r,n);return{data:t,args:r,request_id:n}}).catch(function(e){var t=e.data,r=e.args,n=e.request_id;var i=false;if(a)a(i,t,r,n);return{data:t,args:r,request_id:n}})},enable:function e(){var t=p("owner");if(!t)return;TS.user_groups.enableUserGroup(t.id,a)}},admins:{create:function e(){TS.api.call("subteams.createAuto",{type:"admin"}).then(function(e){var t=e.data,r=e.args,n=e.request_id;var i=true;if(a)a(i,t,r,n);return{data:t,args:r,request_id:n}}).catch(function(e){var t=e.data,r=e.args,n=e.request_id;var i=false;if(a)a(i,t,r,n);return{data:t,args:r,request_id:n}})},enable:function e(){var t=p("admin");if(!t)return;TS.user_groups.enableUserGroup(t.id,a)}}};r.off("click").on("click","a.user_group_auto_action",function(e){var t=$(e.target);var r=t.data("auto-type");var n=t.data("auto-action");if(o[r]&&o[r][n]){o[r][n]();e.preventDefault();return false}})};var v=function e(r,i){if(!r){TS.warn("Cannot switch toggle view to undefined User Group");return}n.html(TS.templates.user_group_toggle({action:i,user_group:r}));n.find('[data-action="cancel"]').on("click",c);n.find(".user_group_toggle_btn").on("click",function(){var e=$(this).data("action");TS.user_groups[e](r.id,function(t,n){if(h(t,n))return;if("enableUserGroup"===e)b(r);m()})});n.find('[data-action="switch_delete_user_group"]').on("click",function(t){t.preventDefault();e(r,"delete_user_group")});t.addClass("hidden");n.removeClass("hidden");f()};var b=function e(t){var r=TS.user_groups.getUserGroupsById(t.id);if(!r)TS.user_groups.upsertUserGroup(_.cloneDeep(t))};var y=function e(n){r.html(TS.templates.user_group_settings_form(n));var i=TS.channels.getUnarchivedChannelsForUser().map(function(e){return{id:e.id,name:e.name,is_private:e.is_private,is_shared:e.is_shared,is_pending_ext_shared:e.is_pending_ext_shared,pending_shared:e.pending_shared,shared_team_ids:e.shared_team_ids,is_org_shared:e.is_org_shared}});var a=TS.groups.getUnarchivedGroups().map(function(e){return{id:e.id,name:e.name,is_group:true,is_shared:e.is_shared,is_org_shared:e.is_org_shared}});var s=i.concat(a);if(n){var o=n.prefs.channels.concat(n.prefs.groups);o.forEach(function(e){for(var t=0;t<s.length;t+=1)if(e==s[t].id){s[t].selected=true;break}})}var l={data:s,template:function e(t){var e;if(t.is_group||t.is_private)e='<ts-icon class="ts_icon_lock ts_icon_inherit"></ts-icon>';else e="#";e+=_.escape(t.name);if(TS.shared.isModelObOrgShared(t))e+=' <ts-icon class="ts_icon_shared_channel ts_icon_inherit"></ts-icon>';else if(TS.shared.isModelObShared(t))e+=TS.templates.shared_channels_icon({model_ob:t,tooltip:true,shared_team_ids:TS.shared.isModelObPendingShared(t)?t.pending_shared:t.shared_team_ids,inherit:true});return new Handlebars.SafeString(e)},placeholder_text:"",filter:function e(t,r){var n=new RegExp("^"+TS.utility.regexpEscape(r),"i");var i=new RegExp("^"+TS.utility.regexpEscape(r.replace("#","")),"i");var a=new RegExp("(-|_|\\+|\\s|\\.|#)"+TS.utility.regexpEscape(r),"i");return t.name.match(i)||t.name.match(n)||t.name.match(a)}};$("#user_group_default_channels").lazyFilterSelect(l);w(n);t.addClass("hidden");r.removeClass("hidden");f()};var w=function e(t){var n;var i;var a;if(t){n=TS.user_groups.updateUserGroup;i=false;a=t.id}else{n=TS.user_groups.createUserGroup;i=true}var s=$("#user_group_handle_input");s.on("input",function(){$(this).closest(".handle_input").toggleClass("empty",!this.value.length)});r.find(".user_group_settings_form").on("submit",function(e){e.preventDefault();var t=$('input[name="name"]').val();var r=$('input[name="handle"]').val();var s=$('input[name="description"]').val();var o=$("#user_group_default_channels").lazyFilterSelect("value");o=o.map(function(e){return e.id});var l={name:t,handle:r,description:s,channels:o};if(a)l.subteam=a;n(l,function(e,t){if(h(e,t))return;b(t.subteam);if(i)k(t.subteam,i);else m();TS.user_groups.updated_info_sig.dispatch(t.subteam.id)})});r.find(".user_group_settings_form").on("reset",c);var o=$("#save_user_group");var l=$("#user_group_name_input");function u(){var e=l.val();if(e&&e.length)o.removeAttr("disabled");else o.attr("disabled",true)}if(o.length&&l.length){l.on("change",u);l.on("keyup",u);u()}};var k=function e(n,i){var a=!!n.is_external||!!n.auto_type;var s=function e(){r.html(TS.templates.user_group_members_form({is_new:i,is_locked:a,user_group:n}))};var o=function e(){var a=$("#member_count");var s=n.user_count||0;var o=function e(){var t=$(i?"#create_group":"#save_group");if(t.length)if(s<1)t.prop("disabled",true);else t.prop("disabled",false)};var l={approx_item_height:36,template:function e(t){var r=TS.templates.user_group_invite_member_small(t);return new Handlebars.SafeString(r)},onItemAdded:function e(){s+=1;a.html(s);o()},onItemRemoved:function e(){s-=1;a.html(s);o()},filter:function e(t,r){var n=t.member;if("@"===r.charAt(0))r=r.substr(1);var i=new RegExp("^"+TS.utility.regexpEscape(r),"i");var a=new RegExp("(-|_|\\+|\\s|\\.|@)"+TS.utility.regexpEscape(r),"i");return TS.utility.members.checkMemberMatch(n,i)||TS.utility.members.checkMemberMatch(n,a)},disabled:!!n.is_external||!!n.auto_type,data_promise:x(n)};$("#user_group_members_select").lazyFilterSelect(l);M(n);t.addClass("hidden");r.removeClass("hidden");o()};if(i){s();TS.ui.fs_modal.hideBackButton();o()}else{var l=function e(){s();f();o()};if(TS.user_groups.needsToFetchMembership(n))TS.user_groups.getUserGroupMembers(n.id,function(e){if(e&&e.users){n=e;return l()}});else return l()}};var x=function e(t){var r=true;return function(e,n){if("@"===e.charAt(0))e=e.substring(1);var i=false;if(r){r=false;if(_.get(t,"users.length"))i=true}if(i){var a=t.users.map(TS.members.getMemberById);a.sort(TS.members.memberSorterByName);var s=a.map(function(e){return{member:e,lfs_id:String(e.id),preselected:true}});return Promise.resolve(s)}if(n>0)return Promise.resolve([]);var o={query:e,include_org:false,include_slackbot:false,include_self:true,full_profile_filter:false,include_bots:true};var l=C(o);return l}};var C=function e(t){return Promise.resolve().then(function(){return TS.members.promiseToSearchMembers(t).then(function(e){var t=[];if(""===e.query)t=TS.utility.teams.getMembersForTeam(TS.model.team);else t=e.items;e.items=t.filter(E).map(function(e){return{member:e,lfs_id:String(e.id)}});return e})})};var M=function e(t){r.find(".user_group_members_form").on("submit",function(e){e.preventDefault();var r=$("#user_group_members_select").lazyFilterSelect("value");r=r.map(function(e){return e.member.id});TS.user_groups.updateMembersOfUserGroup({subteam:t.id,users:r},function(e,t){if(h(e,t))return;m();TS.user_groups.updated_info_sig.dispatch(t.subteam.id)})});r.find(".user_group_members_form").on("reset",function(e){e.preventDefault();i=true;c(e)})};var I=function e(t){var r=$(t.target);var n=r.val();if(n!==D){D=n;j.toggleClass("hidden",""===n);A()}};var P=function e(){var t=$("#user_group_modal_search");D="";t.val("");setTimeout(function(){t.focus()},0);j.addClass("hidden");A()};var A=function e(){var t=$("#user_groups_list_div");var r=D;var n;$("#user_groups_header .user_groups_search").toggleClass("hidden",!a.length);if("string"===typeof r&&r.length){var i=a.filter(function(e){return-1!==e.handle.indexOf(r)||-1!==e._name_lc.indexOf(r)||e.description&&-1!==e.description.toLowerCase().indexOf(r)});if(i.length){t.html(TS.templates.builders.buildUserGroupListHTML(i));if(H)H.updateFunc();return}var s={query:r,tab:{label:TS.i18n.t("User Groups","pages_admin")()}};n='<div class="no_results top_margin">'+TS.templates.team_list_no_results(s)+"</div>"}else n=TS.templates.builders.buildUserGroupListHTML(a);t.html(n);if(H)H.updateFunc()};var E=function e(t){if(!t)return false;if(t._is_local&&!t.deleted&&!t.is_ultra_restricted&&!t.is_restricted&&!(t.is_bot||t.is_slackbot))return true;return false};var F=function e(t){if(t)for(var r=0;r<a.length;r+=1)if(a[r].id==t)return a[r]};var O=function e(t){var r=$("#user_groups_tab .count");r.html(t.length)};var B=function e(t,r){if(0===t.length&&r.length>0)TS.reload()};var D;var H;var j})()},4831:function(e,t){(function(){TS.registerModule("utility.search",{test:function e(){return{_fetchMembersFromFlannel:n}},makeClause:function t(r,n,i){if(e(r,n,i))return;var a={type:r.toLowerCase(),value:n};if(i)a.field_id=i;return a},makeConjunction:function e(r,n){if(t(r,n))return;return{type:r.toLowerCase(),clauses:n}},promiseToSearch:function e(t){if(!t)return Promise.reject(new Error("Cannot search without arguments."));if(t.all_of_org&&!TS.boot_data.page_needs_enterprise)return Promise.reject(new Error("cannot search an org when not an enterprise team"));if(!t.solr&&TS.useSocket()){if(!t.hasOwnProperty("raw_query"))return Promise.reject(new Error("Flannel searches require a `raw_query` to be provided"));var a=t.raw_query;var s=t.count||Infinity;var o;if(_.isEmpty(t.raw_query)&&!t.only_admins)o=Promise.resolve([]);else{var l={};if(t.only_admins)l.filter="admins";else if(t.only_local_team)l.filter="team";o=n(t.raw_query,s,t.determine_membership_for_channel,l)}return o.then(function(e){var r=e.objects;if(!t.include_bots){var n=_.remove(r,{is_bot:true});if(n.length&&TS.has_pri[i])TS.log(i,"Flannel: removed these bots from results:",n)}if(t.exclude_slackbot&&t.include_bots){var o=_.remove(r,{is_slackbot:true});if(o.length&&TS.has_pri[i])TS.log(i,"Flannel: removed slackbot from results:",o)}if(TS.boot_data.page_needs_enterprise&&!t.all_of_org){var l=_.remove(r,function(e){var t=_.get(e,"enterprise_user.teams",[]);var r=_.includes(t,TS.model.team.id);return!r});if(l.length&&TS.has_pri[i])TS.log(i,"Flannel: removed these org members from results:",l)}if(!t.include_deleted){var u=_.remove(r,{deleted:true});if(u.length&&TS.has_pri[i])TS.log(i,"Flannel: removed these deleted members from results:",u)}r=_.intersectionBy(TS.members.getMembersForUser(),r,"id");return{ok:true,data:{items:r.slice(0,s),next_cursor_mark:null,num_found:r.length,teams:[TS.model.team]},args:{query:a}}})}if(!t.query)return Promise.reject(new Error("Cannot search without a query."));var u={query:JSON.stringify(t.query)};["sort","sort_direction","count","cursor_mark","include_bots","include_deleted","exclude_slackbot","ignore_guest_accounts"].forEach(function(e){if(t.hasOwnProperty(e))u[e]=t[e]});var d=t.endpoint;if(!d)d=t.all_of_org?"search.enterprise":"search.team";return TS.api.call(d,u).catch(r)}});var e=function e(t,r,n){if(!t){TS.error("cannot make a clause without a type");return}if(!r){TS.error("cannot make a clause without a value");return}if("custom"===t&&!n)TS.error("cannot make a custom type clause without a field id")};var t=function e(t,r){if(!t){TS.error("cannot make a conjunction without an 'and' or 'or' type");return}if(!r||r.length<2)TS.error("cannot make a conjunction without at least two clauses")};var r=function e(t){TS.error(t.data.error+" error occured while searching");TS.generic_dialog.alert(TS.i18n.t("Sorry! Something went wrong. Please try again.","utility_search")());throw t};var n=function e(t,r,n,i){i=i||{};var a={query:t,count:r};if(i.filter)a.filter=i.filter;var s=TS.members.fetchAndUpsertMembersWithQuery(a);if(!n)return s;var o=_.assign({channels:[n]},a);var l=TS.members.fetchAndUpsertMembersWithQuery(o);return Promise.join(s,l).then(function(e){var t=e[0];var r=e[1];var i=_.map(t.objects,"id");var a=_.map(r.objects,"id");var s=TS.shared.getModelObById(n);a.forEach(function(e){TS.membership.setUserChannelMembership(e,s,true)});_.difference(i,a).forEach(function(e){TS.membership.setUserChannelMembership(e,s,false)});return t})};var i=1989})()},4832:function(e,t){(function(){TS.registerModule("utility.calls",{share_url_prefix:document.location.origin+"/call/",calls_window_changed_sig:new signals.Signal,room_id_sig:new signals.Signal,started_platform_call_sig:new signals.Signal,window_types:{call_window:"call_window",mini_panel:"mini_panel",incoming_call:"incoming_call"},messages_to_call_window_types:{invite_response:"invite_response",invite_cancel:"invite_cancel",start_call:"start_call",caller_id:"caller_id",mini_panel_action:"mini_panel_action",did_close_window:"did_close_window",ping:"ping",ms_msg:"ms_msg",reachability:"reachability",calls_status:"calls_status",regions:"regions",got_server:"got_server",got_server_error:"got_server_error"},messages_to_mini_panel_types:{update_state:"update_state"},messages_from_call_window_types:{update_mini_panel:"update_mini_panel",set_call_window_loaded:"set_call_window_loaded",set_call_window_busy:"set_call_window_busy",show_growl_notification:"show_growl_notification",set_is_publisher_screensharing:"set_is_publisher_screensharing",pong:"pong",close:"close",restart_cursors_window_if_open:"restart_cursors_window_if_open",hide_call_window:"hideCallWindow",get_calls_status:"get_calls_status",force_janus_disconnect:"force_janus_disconnect",get_regions:"get_regions",get_server:"get_server",get_member_data:"get_member_data",play_sound:"play_sound",launch_dev_tools_mini_panel:"launch_dev_tools_mini_panel",launch_dev_tools_cursors:"launch_dev_tools_cursors",send_interactive_mas_migration_slackbot_message_after_call:"send_interactive_mas_migration_slackbot_message_after_call",update_injection_urls:"update_injection_urls"},messages_from_incoming_call_types:{user_clicked_accept_or_reject:"user_clicked_accept_or_reject"},messages_from_mini_panel_types:{user_clicked_action:"user_clicked_action"},invite_response_types:{accept:"accept",reject:"reject",on_call:"on_call",dnd:"dnd",hangup:"hangup"},invite_cancel_types:{cleanup:"cleanup",timeout:"timeout",inviter_cancel:"inviter_cancel",accepted_timeout:"accepted_timeout",caller_hangup:"caller_hangup"},invite_unsupported_types:{platform:"platform",client_version:"client_version",offline:"offline",max_teams:"max_teams"},openMasMigrationDialog:function e(){if("enabled"===TS.experiment.getGroup("calls_interactive_ss"))TS.generic_dialog.start({title:TS.i18n.t("Close Slack to download the app?","calls")(),body:TS.i18n.t("We'll close Slack for you, and open the downloads page on our website. The app will download automatically — just follow the three quick installation steps listed at the end!","calls")(),show_cancel_button:true,go_button_text:TS.i18n.t("Start Download Now","calls")(),onGo:function e(){TS.utility.openInNewTab("https://slack.com/downloads/instructions/osx?ddl=1","_blank");_.delay(function(){return _.invoke(desktop.app,"quit")},2e3)}})},onStart:function e(){n.in_slack_app=!!TS.client;n.in_call_window=!!TS.calls;n.calls_url_prefix=document.location.origin+"/call/";n.send_interactive_mas_migration_slackbot_message_after_call=false;if(n.in_slack_app){TS.redux.socket.connectedSig.add(s);TS.redux.socket.disconnectedSig.add(o);TS.redux.socket.socketMessageReceivedSig.add(a);TSSSB.call("setCallWindowBusy",{is_busy:false});window.addEventListener("online",l);window.addEventListener("offline",l);window.addEventListener("message",J);if(TS.model.is_our_app)TS.client.login_sig.add(u);if(TS.client.windows){TS.client.windows.win_finished_loading_sig.add(d);TS.client.windows.win_will_close_sig.add(c);TS.client.windows.win_crashed_sig.add(m);TS.client.windows.win_became_key_sig.add(f);TS.client.windows.win_resigned_key_sig.add(p)}if(TS.ui)TS.ui.window_unloaded_sig.add(h);if(TS.model.is_our_app)n.call_window_loaded=false;else n.call_window_loaded=true;n.is_ms_connected=false;n.is_reachability_online=true;TS.experiment.loadUserAssignments().then(function(){n.screen_sharing_enabled=TS.model.supports_screen_sharing;if("enabled"===TS.experiment.getGroup("calls_better_regions"))n.calls_better_regions_expt=true})}},startCallInModelOb:function e(t,r,n){var i;var a=!r&&"Slack"!==TS.prefs.getTeamPref("calling_app_name");if(TS.interop.utility.looksLikeMemberId(t.id)){var s=t.id;t=TS.ims.getImByMemberId(s);if(!t){TS.ims.promiseToStartImByMemberId(s,true,false).then(function(){t=TS.ims.getImByMemberId(s);i={id:t.id,is_dm:t.is_im,is_mpdm:t.is_mpim,is_video_call:n};if(a)TS.utility.calls.launchPlatformCalls(i);else TS.utility.calls.launchVideoCall(i)});return}}i={id:t.id,is_dm:t.is_im,is_mpdm:t.is_mpim,is_video_call:n};if(a)TS.utility.calls.launchPlatformCalls(i);else TS.utility.calls.launchVideoCall(i)},getCallsUrlPrefix:function e(){return n.calls_url_prefix},isEnabled:function e(){if(!TS.model||!TS.model.team)return false;return TS.prefs.getTeamPref("allow_calls")},isCallWindowReady:function e(){return n.is_reachability_online&&n.is_ms_connected},isMultiPartyEnabled:function e(){return TS.utility.calls.isEnabled()&&TS.utility.calls.isPaidTeam()},isPaidTeam:function e(){return""!==TS.model.team.plan},isCurrentContextMultiParty:function e(){if(TS.model.active_channel_id||TS.model.active_group_id||TS.model.active_mpim_id)return true;return false},launchPlatformCalls:function e(t){if(!t)return;if(!t.id)return;var r=null!=TSSSB.env.desktop_app_version;TS.utility.calls.started_platform_call_sig.dispatch({is_loading:true});TS.api.call("calls.request",{channel:t.id,app:TS.prefs.getTeamPref("calling_app_id")}).then(function(e){if(!e.data.ok){i(e);return}var t=window.open(encodeURI(e.data.url),TS.prefs.getTeamPref("calling_app_name"));try{t.focus()}catch(e){if(!r){var n=bowser.name;var a;if(n)a=TS.i18n.t("Please allow pop-ups in {browser} to make a call. You can <http://my.slack.com/help/requests/new|contact Slack> if you need help.","utility")({browser:n});else a=TS.i18n.t("Please allow pop-ups in your browser to make a call. You can <http://my.slack.com/help/requests/new|contact Slack> if you need help.","utility")();var s={text:a,ephemeral_type:"enable_popups",slackbot_feels:"sad_surprise"};TS.client.ui.addEphemeralBotMsg(s)}}}).catch(function(e){i(e)}).finally(function(){TS.utility.calls.started_platform_call_sig.dispatch({is_loading:false})})},isInteractiveScreenShareHostingSupported:function e(){return TS.model.supports_screen_sharing&&!TS.model.is_lin&&!TS.utility.calls.isInteractiveDisabledByMas()&&!TS.utility.isAppVersionBefore("2.8.0")},isInteractiveDisabledByMas:function e(){return TS.model.is_our_app&&TS.model.is_mac&&TSSSB.call("isAppStoreBuild")},launchVideoCall:function e(t){if(!TS.model.supports_voice_calls&&!TS.utility.calls.platformHasCallsCode()){g();return}if(!t)return;if(!t.id)return;if(!TS.utility.calls.isCallWindowReady())return;if(n.incoming_caller_info){var i=TS.ims.getImByMemberId(n.incoming_caller_info.user_id);if(i&&i.id===t.id)A().then(function(e){if(e){TS.utility.calls.closeIncomingCallWindow();TS.utility.calls.sendInvitationResponseToCaller({user_id:n.incoming_caller_info.user_id,room_id:n.incoming_caller_info.room_id,response:TS.utility.calls.invite_response_types.accept,did_choose_video:false})}})}H().then(function(e){if(e){N();return}TS.utility.calls_log.logEvent({event:r.log_events.start_call,value:t});j(n.calls_url_prefix+t.id,t.id,{start_with_video:t.is_video_call})})},sendInvitationResponseToCaller:function e(t){if(!t||!t.user_id||!t.room_id||!t.response||!TS.utility.calls.invite_response_types[t.response]){TS.utility.calls_log.logError("sendInvitationResponseToCaller: invalid args: ",t);return}TS.utility.calls.room_id_sig.dispatch({room_id:t.room_id});if(t.response){var i=function e(t,r){if(!t)TS.utility.calls_log.logError("inviteResponse API failed with: ",r)};TS.api.callImmediately("screenhero.rooms.inviteResponse",{caller:t.user_id,room:t.room_id,response:t.response}).then(function(e){var t=e.data,r=e.args,n=e.request_id;var a=true;i(a,t,r,n);return{data:t,args:r,request_id:n}}).catch(function(e){var t=e.data,r=e.args,n=e.request_id;var a=false;i(a,t,r,n);return{data:t,args:r,request_id:n}});if(t.response===TS.utility.calls.invite_response_types.accept){n.accepted_caller_id=t.user_id;if(!t.currently_calling_caller)R(t.room_id,t.did_choose_video)}}Promise.join(H(),A(),function(e,n){TS.utility.calls_log.logEvent({event:r.log_events.invite_response_send,value:{response_type:t.response,user_id:t.user_id,room_id:t.room_id,is_call_window_busy:e,is_in_incoming_call:n}});return null})},closeIncomingCallWindow:function e(t){TS.utility.calls_log.logEvent({event:r.log_events.close_incoming_call});if(TS.model.is_our_app){if(window.winssb)if(n.incoming_call_token){TSSSB.call("closeWindow",n.incoming_call_token);delete n.incoming_call_token}}else A().then(function(e){if(e)TS.incoming_call.timeout()});delete n.incoming_caller_info;if(!t)P();else TS.sounds.stop("call/incoming_ring_"+TS.boot_data.call_sounds_version+".mp3",{ignore_mute:true})},maybeEnterMasToDdlFlow:function e(t){if(!TS.utility.calls.isInteractiveDisabledByMas())return false;t=TS.utility.normalizeDevHost(t);if(-1===t.indexOf("slack.com/downloads")||-1===t.indexOf("?ddl=1"))return false;if("enabled"===TS.experiment.getGroup("calls_interactive_ss")){TS.utility.calls.openMasMigrationDialog();return true}return false},maybeHandleCallLink:function e(t){if(!n.in_slack_app)return false;t=$(t);if(!t||!t.length)return false;if(!t.is("a"))return false;var i=t.attr("href");if(!i)return false;i=TS.utility.normalizeDevHost(i);i=i.replace("https://","").replace("http://","");var a=TS.utility.normalizeDevHost(n.calls_url_prefix);a=a.replace("https://","").replace("http://","");if(0===i.indexOf(a))i=i.replace(a,"call/");while(0===i.indexOf("/"))i=i.substr(1);if(0!==i.indexOf("call/"))return false;var s=i.split("/");if(s.length<2)return false;var o=s[1];if(!o)return false;if(!TS.utility.calls.isCallWindowReady())return true;A().then(function(e){if(e){TS.utility.calls_log.logEvent({event:r.log_events.call_object_click_in_incoming_call});return}TS.utility.calls.room_id_sig.dispatch({room_id:o});R(o)});return true},getParentWindow:function e(){if(window.winssb&&!(window.parentInfo||window.parentBrowserWindowId))TS.utility.calls_log.logWarn("WinSSB: Trying to get parent window before browser window ID is initialized");else if(window.opener)return window.opener},promiseToGetRegions:function t(){if(e)return e;if(n.calls_better_regions_expt){e=new Promise(function(e){var t={east:"slack-calls-0fc78df4963fa1cd7.slack-core.com",west:"slack-calls-04e6ff274e7196b49.slack-core.com",eu:"slack-calls-004c3e8ad31b95218.slack-core.com",ap:"slack-calls-00f1852837340bafc.slack-core.com"};var r=function r(n,i){if(n)t=i.servers;var a=Object.keys(t);var s=false;_.each(a,function(r){$.ajax({type:"OPTIONS",url:"https://"+t[r]+"/janus",async:true,cache:false,timeout:2e3}).always(function(){TS.utility.calls_log.logEvent({event:"RegionsNew",value:r});if(!s){e(r);s=true}})})};TS.api.callImmediately("screenhero.getServers",{protocol_version:"2.0",media_server:"janus"}).then(function(e){var t=e.data,n=e.args,i=e.request_id;var a=true;r(a,t,n,i);return{data:t,args:n,request_id:i}}).catch(function(e){var t=e.data,n=e.args,i=e.request_id;var a=false;r(a,t,n,i);return{data:t,args:n,request_id:i}})});return e}var r;var i="https://universal.slack-core.com/region.json";e=new Promise(function(e){$.ajax({type:"GET",url:i,async:true,cache:false,timeout:2e3,success:function t(n){TS.utility.calls_log.logEvent({event:"Regions",value:n.region_text});r=n.region_text;if("dev"===TS.boot_data.version_ts)r="dev";e(r)},error:function t(n,i,a){TS.utility.calls_log.logEventError({event:"GetRegionsErr",value:{status:i,error:a}});r="west|east|ap|eu";if("dev"===TS.boot_data.version_ts)r="dev";e(r)}})});return e},promiseToGetServer:function e(r,n){if(t[n])return t[n];var i;var a={regions:r,protocol:"1.0"};if("R"===n.charAt(0)){i="screenhero.rooms.join";a.room=n}else{i="screenhero.rooms.create";a.channel=n;var s=TS.storage.fetchCallsState();if(s.call_server_override){a.call_server=s.call_server_override;s.call_server_override=null;TS.storage.storeCallsState(s)}}t[n]=TS.api.callImmediately(i,a);return t[n]},clearServerPromise:function e(r){delete t[r]},getCallActive:function e(){return H()},isScreenSharing:function e(){return n.is_publisher_screensharing},isSupportedMessage:function e(t){var r=["user_change","pref_change","team_join","channel_created","channel_deleted","channel_archive","channel_unarchive","channel_rename","channel_joined","channel_left","group_deleted","group_archive","group_unarchive","group_rename","group_joined","group_left","im_open","mpim_joined","mpim_open","mpim_close"];return-1!==r.indexOf(t)},getPlatformErrorMessage:function e(){if(TS.model.is_our_app){if(TS.model.lin_ssb_version)return TS.i18n.t("Unfortunately, the calls feature is not available on Linux.","utility")();else if(window.winssb)return TS.i18n.t("To use the calls feature, please upgrade to the latest version of Slack for Windows.","utility")();return TS.i18n.t("To use the calls feature, please upgrade to the latest version of the Mac app for Slack.","utility")()}else if(bowser.mobile&&bowser.ios)return TS.i18n.t("Please update your Slack iOS app to the newest version.","utility")();else if(bowser.mobile)return TS.i18n.t("Unfortunately, the calls feature is not available on mobile browsers.","utility")();return TS.i18n.t("Unfortunately, the calls feature is not available in this browser. Please switch to Chrome.","utility")()},getPlatformErrorTitle:function e(){if(TS.model.is_our_app){if(TS.model.lin_ssb_version)return TS.i18n.t("Calls feature is not available on Linux","utility")();else if(window.winssb)return TS.i18n.t("Please update your Slack for Windows","utility")();return TS.i18n.t("Please update your Slack for Mac","utility")()}else if(bowser.mobile)return TS.i18n.t("Calls feature is not available on mobile browsers","utility")();return TS.i18n.t("Calls feature is not available in this browser","utility")()},platformHasCallsCode:function e(){if(TS.model.is_our_app){if("1.1"==TS.model.mac_ssb_version&&TS.model.mac_ssb_version_minor<8||parseFloat(TS.model.mac_ssb_version)<2)return false;if("1.2"==TS.model.win_ssb_version&&TS.model.win_ssb_version_minor<5||parseFloat(TS.model.win_ssb_version)<1.2)return false}return true},verifyOriginUrl:function e(t){return TS.interop.url.getHostName(t)==window.location.hostname&&_.startsWith(t,"https:")},getUrlForRoom:function e(t){return TS.utility.calls.getUrlForRoomId(t.id)},getUrlForRoomId:function e(t){return TS.utility.calls.share_url_prefix+t},dbg:{getState:function e(){return{config:r,state:n}},isCallWindowBusy:function e(){H().then(function(e){TS.info("_isCallWindowBusy: "+e)})},isIncomingCallWindowBusy:function e(){A().then(function(e){TS.info("_isInIncomingCall: "+e)})}}});var e;var t={};var r={call_window_dims:{width:1070,height:600,min_width:600,min_height:500},mini_panel_dims:{width:280,height:64,min_width:280,min_height:44,x_offset:50,y_offset:50},incoming_call_window_dims:{width:240,height:373},log_events:{previous_crash:"PreviousCrash",incoming_call:"IncomingCall",invite_response_from_callee:"InviteResponseFromCallee",ms_connected:"MSConnected",ms_disconnected:"MSDisconnected",reachability_changed:"ReachabilityChanged",window_closed:"WindowClosed",window_crashed:"WindowCrashed",call_window_load_timeout:"CallWindowLoadTimeout",call_window_load_start:"CallWindowLoadStart",incoming_call_timeout:"IncomingCallTimeout",send_msg_no_call_window:"SendMsgNoCallWindow",send_msg_no_mini_panel:"SendMsgNoMiniPanel",call_window_loaded:"CallWindowLoaded",call_window_busy:"CallWindowBusy",invalid_msg_from_child_window:"InvalidMsgFromChildWindow",call_window_pong:"CallWindowPong",unknown_msg_from_call_window:"UnknownMsgFromCallWindow",incoming_call_click:"IncomingCallClick",unknown_msg_from_incoming_call_window:"UnknownMsgFromIncomingCallWindow",mini_panel_click:"MiniPanelClick",unknown_msg_from_mini_panel:"UnknownMsgFromMiniPanel",call_object_click_in_incoming_call:"CallObjectClickInIncomingCall",invite_response_send:"InviteResponseSend",close_incoming_call:"CloseIncomingCall",no_mini_panel_in_update:"NoMiniPanelInUpdate",start_call:"StartCall",join_call:"JoinCall"},CALL_WINDOW_LOAD_TIMEOUT_MSECS:3e4,INCOMING_RING_TIMEOUT_MSECS:29e3};var n={};var i=function e(t){var r={text:t.data.response||TS.i18n.t("Darn, that didn’t work. Try your call again or <http://my.slack.com/help.requests/new|contact us> if it’s still not working.","utility")(),ephemeral_type:t.data.error||"uncaught_third_party_call_error",slackbot_feels:"sad_surprise"};TS.client.ui.addEphemeralBotMsg(r)};var a=function e(t){if(!n.in_slack_app)return;switch(t.type){case"screenhero_invite":TS.utility.calls_log.logEvent({event:r.log_events.incoming_call,value:t});Promise.join(H(),A(),function(e,r){M(e,r,t);return null});break;case"screenhero_invite_cancel":TS.utility.calls.closeIncomingCallWindow();H().then(function(e){if(e)E({message_type:TS.utility.calls.messages_to_call_window_types.invite_cancel,cancel_type:t.cancel_type,user_id:t.responder,room_id:t.room});else n.cached_invite_cancel={cancel_type:t.cancel_type,user_id:t.responder,room_id:t.room}});break;case"screenhero_invite_response":TS.utility.calls_log.logEvent({event:r.log_events.invite_response_from_callee,value:t});E({message_type:TS.utility.calls.messages_to_call_window_types.invite_response,response_type:t.response,user_id:t.responder,room_id:t.room});TS.api.callImmediately("screenhero.rooms.inviteCancel",{responder:t.responder,room:t.room,cancel_type:TS.utility.calls.invite_cancel_types.cleanup});break;case"sh_room_join":TS.utility.calls_log.logInfo("sh_room_join msg: ",t);break;default:if(TS.utility.calls.isSupportedMessage(t.type))if(!TS.model.is_our_app)E({message_type:TS.utility.calls.messages_to_call_window_types.ms_msg,msg:t})}};var s=function e(){TS.utility.calls_log.logEvent({event:r.log_events.ms_connected});n.is_ms_connected=true;U()};var o=function e(){TS.utility.calls_log.logEvent({event:r.log_events.ms_disconnected});n.is_ms_connected=false;U()};var l=function e(){n.is_reachability_online=window.navigator.onLine;U();O()};var u=function e(){n.did_login=true};var d=function e(t){switch(t){case n.incoming_call_token:TSSSB.call("centerWindow",t);TSSSB.call("showWindow",t);I();break;case n.mini_panel_token:if(window.winssb&&winssb.window&&winssb.window.browserWindows&&winssb.window.browserWindows[t]&&winssb.window.browserWindows[t].setMinimumSize){winssb.window.browserWindows[t].setMinimumSize(r.mini_panel_dims.min_width,r.mini_panel_dims.min_height);winssb.window.browserWindows[t].setSize(r.mini_panel_dims.width,r.mini_panel_dims.height)}}};var c=function e(t){TS.utility.calls_log.logEvent({event:r.log_events.window_closed,value:{token:t,cw_token:n.call_window_token,mp_token:n.mini_panel_token,ic_token:n.incoming_call_token}});switch(t){case n.call_window_token:n.last_call_window_token=n.call_window_token;W();if(n.call_window_token)delete n.call_window_token;w();k();break;case n.mini_panel_token:if(n.mini_panel_token)delete n.mini_panel_token}};var m=function e(t){TS.utility.calls_log.logEvent({event:r.log_events.window_crashed,value:{token:t,cw_token:n.call_window_token,mp_token:n.mini_panel_token,ic_token:n.incoming_call_token}});if(t!==n.last_call_window_token&&t!==n.call_window_token)return;C();W();delete n.call_window_token;TS.utility.calls_log.logEvent({event:r.log_events.previous_crash});w();k()};var f=function e(t){if(t!==n.call_window_token)return;if(n.is_publisher_screensharing)return;TSSSB.call("hideWindow",n.mini_panel_token)};var p=function e(t){if(t!==n.call_window_token)return;H().then(function(e){if(e)TSSSB.call("showWindowInactive",n.mini_panel_token)})};var h=function e(){TS.utility.calls_log.logInfo("client window unloaded!");x()};var g=function e(){TS.generic_dialog.start({title:TS.utility.calls.getPlatformErrorTitle(),body:TS.utility.calls.getPlatformErrorMessage(),show_cancel_button:true,go_button_text:TS.i18n.t("Update Slack App","utility")(),onGo:function e(){var t="_"+Math.random();TS.utility.openInNewTab("https://slack.com/downloads",t)}})};var S=function e(){return _.get(window,"winssb.app.areTransparentWindowsSupported",true)};var T=function e(t){var i;if(!TS.utility.calls.isEnabled())return;if(!TS.utility.calls.platformHasCallsCode())return;if(n.call_window_token){E({message_type:TS.utility.calls.messages_to_call_window_types.start_call,args:{url:t}});TSSSB.call("focusWindow",n.call_window_token)}else{TS.metrics.mark("start_loading_call_window");i={url:t||n.calls_url_prefix,title:"",background:true,backgroundColor:"#2c2d30",width:r.call_window_dims.width,height:r.call_window_dims.height,minWidth:r.call_window_dims.min_width,minHeight:r.call_window_dims.min_height,hideMenuBar:true,windowType:"calls",show:true,no_spinner:true,hides_on_close:false};if(window.winssb){var a=TSSSB.call("getAppDisplay");i.x=a.bounds.x+(a.bounds.width-r.call_window_dims.width)/2;i.y=a.bounds.y+(a.bounds.height-r.call_window_dims.height)/2}n.call_window_token=TS.client.windows.openWindow(i);TS.utility.calls_log.logInfo("_startCallWindow: returned token: ",n.call_window_token);n.injection_url_promise=new Promise(function(e){n.injection_url_resolver=e})}n.injection_url_promise.then(function(){b();y()})};var v=function e(){if(!n.call_window_token)return;C();var t=n.call_window_token;delete n.call_window_token;TSSSB.call("closeWindow",t);TS.info("Call window closed after Janus disconnect",t)};var b=function e(){if(!window.winssb||n.mini_panel_token)return;var t=TSSSB.call("getDisplayForWindow",n.call_window_token);var i={x:t.bounds.x+(t.bounds.width-r.mini_panel_dims.x_offset-r.mini_panel_dims.width),y:t.bounds.y+r.mini_panel_dims.y_offset,width:r.mini_panel_dims.width,height:r.mini_panel_dims.height,minWidth:r.mini_panel_dims.min_width,minHeight:r.mini_panel_dims.min_height,hideMenuBar:true,resizable:false,alwaysOnTop:true,frame:false,windowType:"calls_mini_panel",show:false,useContentSize:true,skip_css:true,skipTaskbar:true,fullscreenable:false};if(TS.model.is_mac&&S())i.transparent=true;i.content_html=TS.templates.calls_minipanel({is_linux:TS.model.is_lin,locale:TS.i18n.locale(),no_border:!TS.model.is_mac,js_urls:n.injection_urls?n.injection_urls.calls_mini_panel.js:[],css_urls:n.injection_urls?n.injection_urls.calls_mini_panel.css:[]});n.mini_panel_token=TS.client.windows.openWindow(i);TSSSB.call("showWindowInactive",n.mini_panel_token);TSSSB.call("hideWindow",n.mini_panel_token)};var y=function e(){if(!n.screen_sharing_enabled||TS.model.is_lin)return;if(n.injection_urls)var t=n.injection_urls.calls_cursors.js;var r=TS.templates.calls_cursors({locale:TS.i18n.locale(),js_urls:t,css_urls:n.injection_urls?n.injection_urls.calls_cursors.css:[]});var i={width:0,height:0,windowType:"calls_cursors",transparent:true,alwaysOnTop:true,hideMenuBar:true,resizable:false,frame:false,useContentSize:true,skip_css:true,content_html:r,fullscreenable:false,enableLargerThanScreen:true,hasShadow:false,focusable:false,show:false,skipTaskbar:true};n.cursors_window_token=TS.client.windows.openWindow(i)};var w=function e(){if(!n.mini_panel_token)return;var t=n.mini_panel_token;delete n.mini_panel_token;TSSSB.call("closeWindow",t);TS.info("Mini panel window closed after call",t)};var k=function e(){if(!n.screen_sharing_enabled)return;if(!n.cursors_window_token)return;var t=n.cursors_window_token;delete n.cursors_window_token;TSSSB.call("closeWindow",t);TS.info("Cursors window closed after call",t)};var x=function e(){if(n.mini_panel_token){TSSSB.call("closeWindow",n.mini_panel_token);delete n.mini_panel_token}if(n.call_window_token){E({message_type:TS.utility.calls.messages_to_call_window_types.did_close_window});C();TSSSB.call("closeWindow",n.call_window_token);W();delete n.call_window_token}if(n.window_handle){n.window_handle.close();delete n.window_handle}};var C=function e(){B(false);D(false);if(n.send_interactive_mas_migration_slackbot_message_after_call)if("enabled"===TS.experiment.getGroup("calls_interactive_ss")){var t="TS.utility.calls.openMasMigrationDialog()";TS.client.msg_pane.addMaybeClick(t,TS.utility.calls.openMasMigrationDialog.bind(Object.create(null)));var r=TS.i18n.t("To share control of your screen, you'll need to <javascript:{open_dialog_fn}|download the Slack app> directly from our website.","calls")({open_dialog_fn:t});TS.client.ui.addEphemeralBotMsg({text:r,type:"interactive_mas_migration"})}};var M=function e(t,i,a){if(!TS.utility.calls.isEnabled())return;var s=TS.shared.isRelevantTeam();if(!s)return;var o=false;var l=TS.ims.getImByMemberId(a.caller);if(l&&l.id===n.call_channel)o=true;if(t||i||o){TS.utility.calls.sendInvitationResponseToCaller({user_id:a.caller,room_id:a.room,response:o?TS.utility.calls.invite_response_types.accept:TS.utility.calls.invite_response_types.on_call,currently_calling_caller:o});return}if(TS.dnd.isMemberInDnd(TS.model.user)){TS.utility.calls.sendInvitationResponseToCaller({user_id:a.caller,room_id:a.room,response:TS.utility.calls.invite_response_types.dnd});return}var u=TS.members.getMemberById(a.caller);var d=Promise.resolve(u);if(!u)d=TS.api.call("users.info",{user:a.caller,_x_reason:"incoming_calls"}).then(function(e){TS.members.upsertMember(e.data.user);u=TS.members.getMemberById(a.caller)});d.then(function(){var e=TS.members.getPrefCompliantMemberName(u);if(TS.model.is_our_app){if(window.winssb){var t={width:r.incoming_call_window_dims.width,height:r.incoming_call_window_dims.height,hideMenuBar:true,resizable:false,alwaysOnTop:true,frame:false,windowType:"calls_incoming_call",show:false,skip_css:true,fullscreenable:false};if(TS.model.is_mac&&S())t.transparent=true;var i=TS.templates.calls_incoming_call({caller:u,name:e,is_video_call:TS.model.supports_video_calls&&a.cameras_on>0,team:TS.model.team.name});t.content_html=TS.templates.calls_incoming_call_window({locale:TS.i18n.locale(),incoming_call_div:i,room_id:a.room,user_id:a.caller,no_border:!TS.model.is_mac,css_urls:TS.boot_data.electron_window_injection_urls?TS.boot_data.electron_window_injection_urls.calls_incoming_call.css:[]});n.incoming_call_token=TS.client.windows.openWindow(t)}}else TS.incoming_call.start({caller:u,name:e,is_video_call:TS.model.supports_video_calls&&a.cameras_on>0,onAccept:function e(t){TS.utility.calls.sendInvitationResponseToCaller({user_id:a.caller,room_id:a.room,response:TS.utility.calls.invite_response_types.accept,did_choose_video:t})},onReject:function e(){TS.utility.calls.sendInvitationResponseToCaller({user_id:a.caller,room_id:a.room,response:TS.utility.calls.invite_response_types.reject})},onTimeout:function e(){},onShow:function e(){I()},onEnd:function e(){P()}});n.incoming_caller_info={user_id:a.caller,room_id:a.room}})};var I=function e(){TS.sounds.play("call/incoming_ring_"+TS.boot_data.call_sounds_version+".mp3",{should_loop:true,ignore_mute:true});n.incoming_ring_timer=setTimeout(function(){TS.utility.calls_log.logEvent({event:r.log_events.incoming_call_timeout});TS.utility.calls.closeIncomingCallWindow()},r.INCOMING_RING_TIMEOUT_MSECS);n.in_incoming_call=true;z()};var P=function e(){TS.sounds.stop("call/incoming_ring_"+TS.boot_data.call_sounds_version+".mp3",{ignore_mute:true});if(n.incoming_ring_timer){clearTimeout(n.incoming_ring_timer);delete n.incoming_ring_timer}delete n.in_incoming_call;delete n.incoming_caller_info;K()};var A=function e(){if(!TS.model.is_our_app||!TSSSB.call("supportsIncomingCallWindowStatus"))return Promise.resolve(!!n.in_incoming_call);return TSSSB.call("isIncomingCallWindowBusy")};var E=function e(t){if(TS.model.is_our_app){var i=n.call_window_token;if(!i){TS.utility.calls_log.logEventWarn({event:r.log_events.send_msg_no_call_window,value:t});return}if(window.winssb&&window.winssb.window)window.winssb.window.postMessage(t,i)}else if(n.window_handle)try{n.window_handle.postMessage(t,"*")}catch(e){if("DataCloneError"==e.name)n.window_handle.postMessage(_.cloneDeep(t),"*");else TS.error("Unexpected failure in sending a post message:",e.name)}};var F=function e(t){if(!n.mini_panel_token){TS.utility.calls_log.logEventWarn({event:r.log_events.send_msg_no_mini_panel,value:t});return}if(window.winssb&&window.winssb.window)window.winssb.window.postMessage(t,n.mini_panel_token)};var O=function e(){if(!n.call_window_loaded)return;E({message_type:TS.utility.calls.messages_to_call_window_types.reachability,online:n.is_reachability_online})};var B=function e(t){TS.utility.calls_log.logEvent({event:r.log_events.call_window_loaded,value:{is_loaded:t}});n.call_window_loaded=t;U();if(t){TSSSB.call("focusWindow",n.call_window_token);TS.metrics.measureAndClear("calls_desktop_window_loaded","start_loading_call_window")}O()};var D=function e(t){TS.utility.calls_log.logEvent({event:r.log_events.call_window_busy,value:{is_busy:t}});n.is_call_window_busy=t;if(t){G();if(n.accepted_caller_id)E({message_type:TS.utility.calls.messages_to_call_window_types.caller_id,args:{caller_id:n.accepted_caller_id}});if(n.cached_invite_cancel)E({message_type:TS.utility.calls.messages_to_call_window_types.invite_cancel,cancel_type:n.cached_invite_cancel.cancel_type,user_id:n.cached_invite_cancel.user_id,room_id:n.cached_invite_cancel.room_id})}else{W();n.call_channel=void 0;n.is_publisher_screensharing=false;n.is_publisher_screenhero=false}if(n.accepted_caller_id)delete n.accepted_caller_id;if(n.cached_invite_cancel)delete n.cached_invite_cancel};var H=function e(){if(!TS.model.is_our_app||!TSSSB.call("supportsCallWindowStatus"))return Promise.resolve(!!n.is_call_window_busy);return TSSSB.call("isCallWindowBusy")};var j=function e(t,r,i){i=i||{};t+="?_fast_members=1&_end_call_sound=1"+(i.start_with_video?"&_start_with_video=1":"");if(TS.pri)t+="&pri="+TS.pri;if(TS.qs_args._calls_halt_at_loading_screen)t+="&_calls_halt_at_loading_screen=1";if(TS.qs_args.locale)t+="&locale="+TS.qs_args.locale;if(TS.qs_args.js_path)t+="&js_path="+encodeURIComponent(TS.qs_args.js_path);TS.utility.calls.promiseToGetRegions().then(function(e){TS.utility.calls.promiseToGetServer(e,r).catch(_.noop)});if(TS.model.is_our_app)T(t);else n.window_handle=window.open(t,r);n.call_channel=r};var R=function e(t,i){if(!TS.model.supports_voice_calls&&!TS.utility.calls.platformHasCallsCode()){g();return}if(!TS.utility.calls.isCallWindowReady())return;H().then(function(e){if(e){N();return}TS.utility.calls_log.logEvent({event:r.log_events.join_call,value:{room_id:t,start_with_video:i}});j(n.calls_url_prefix+t,t,{start_with_video:i})})};var L=function e(t){var r;if(t)r=TS.i18n.t("You’re already in a call on another workspace ({team_name})","utility")({team_name:t});else r=TS.i18n.t("You’re already in a call on another workspace","utility")();TS.generic_dialog.start({title:r,body:'<p class="no_bottom_margin">'+TS.i18n.t("You can only be in one call at a time. Please end that call and try again.","utility")()+"</p>",go_button_text:TS.i18n.t("OK","utility")(),show_cancel_button:false})};var N=function e(){TS.utility.calls_log.logInfo("_handleAlreadyInCall");if(!TS.model.is_our_app){n.window_handle.focus();return}if(!TSSSB.call("supportsCallWindowStatus")){TSSSB.call("focusWindow",n.call_window_token);return}TSSSB.call("getCallWindowTeamId",{cb:function e(t){if(t===TS.model.team.id)TSSSB.call("focusWindow",n.call_window_token);else TSSSB.call("getCallWindowTeamName",{cb:function e(t){L(t)}})}})};var U=function e(){if(TS.utility.calls.platformHasCallsCode())TS.client.msg_pane.setCallButtonState(TS.utility.calls.isCallWindowReady());else TS.client.msg_pane.setCallButtonState(true)};var q=function e(t){if(!n.mini_panel_token){TS.utility.calls_log.logEventWarn({event:r.log_events.no_mini_panel_in_update});return}F({message_type:TS.utility.calls.messages_to_mini_panel_types.update_state,mini_panel_state:t})};var G=function e(){if(!TS.model.is_our_app)return;TSSSB.call("setCallWindowBusy",{is_busy:true});TSSSB.call("setCallWindowToken",{token:n.call_window_token});TSSSB.call("setCallWindowTeamId",{team_id:TS.model.team.id});TSSSB.call("setCallWindowTeamName",{team_name:TS.model.team.name})};var W=function e(){if(!TS.model.is_our_app)return;if(!TSSSB.call("supportsCallWindowStatus"))return;var t=String(n.call_window_token);TSSSB.call("getCallWindowToken",{cb:function e(r){if(r!==t)return;TSSSB.call("setCallWindowBusy",{is_busy:false});TSSSB.call("clearCallWindowToken");TSSSB.call("clearCallWindowTeamId");TSSSB.call("clearCallWindowTeamName")}})};var z=function e(){if(!TS.model.is_our_app)return;if(!TSSSB.call("supportsIncomingCallWindowStatus"))return;TSSSB.call("setIncomingCallWindowBusy",{is_busy:true});if(n.incoming_call_token)TSSSB.call("setIncomingCallWindowToken",{token:n.incoming_call_token});TSSSB.call("setIncomingCallWindowTeamId",{team_id:TS.model.team.id});TSSSB.call("setIncomingCallWindowTeamName",{team_name:TS.model.team.name})};var K=function e(){var t=function e(){TSSSB.call("setIncomingCallWindowBusy",{is_busy:false});TSSSB.call("clearIncomingCallWindowToken");TSSSB.call("clearIncomingCallWindowTeamId");TSSSB.call("clearIncomingCallWindowTeamName")};if(!TS.model.is_our_app)return;if(!n.incoming_call_token){t();return}var r=String(n.incoming_call_token);TSSSB.call("getIncomingCallWindowToken",{cb:function e(n){if(n!==r)return;t()}})};var V=function e(t,r,n,i){$.ajax({timeout:2e3,type:"POST",url:t+"/"+r,async:true,cache:false,contentType:"application/json",headers:{Authorization:"Basic "+btoa(":"+n)},data:JSON.stringify({janus:"destroy",transaction:i}),dataType:"json"})};var Y=function e(t){_(window.desktop.window.state.windows).filter({subType:t}).map("id").each(_.partial(window.desktop.window.safeInvokeOnWindow,_,function(e){return e.toggleDevTools()}))};var J=function e(t){if(!t||!t.data||!t.data.message_type){TS.utility.calls_log.logEvent({event:r.log_events.invalid_msg_from_child_window,value:t});return}if(!TS.model.is_our_app&&!TS.utility.calls.verifyOriginUrl(t.origin))return;if(t.data.origin_window_type===TS.utility.calls.window_types.call_window)switch(t.data.message_type){case TS.utility.calls.messages_from_call_window_types.update_mini_panel:q(t.data.mini_panel_state);if(t.data.mini_panel_state.hidden)TSSSB.call("hideWindow",n.mini_panel_token);break;case TS.utility.calls.messages_from_call_window_types.set_call_window_loaded:B(t.data.is_loaded);O();break;case TS.utility.calls.messages_from_call_window_types.set_call_window_busy:D(t.data.is_busy);break;case TS.utility.calls.messages_from_call_window_types.show_growl_notification:if("nothing"!==TS.notifs.getGlobalNotificationSetting())TS.ui.growls.show(t.data.title,t.data.txt,null,{subtitle:t.data.subtitle,sound_name:"none",channelId:t.data.channel,is_call_notification:true});break;case TS.utility.calls.messages_from_call_window_types.set_is_publisher_screensharing:n.is_publisher_screensharing=t.data.is_enabled;n.is_publisher_screenhero=t.data.is_screenhero;if(n.is_publisher_screensharing)TSSSB.call("showWindowInactive",n.mini_panel_token);break;case TS.utility.calls.messages_from_call_window_types.close:v();w();k();break;case TS.utility.calls.messages_from_call_window_types.restart_cursors_window_if_open:if(n.cursors_window_token){k();y()}break;case TS.utility.calls.messages_from_call_window_types.hide_call_window:TSSSB.call("hideWindow",n.call_window_token);break;case TS.utility.calls.messages_from_call_window_types.get_calls_status:H().then(function(e){TSSSB.call("getCallWindowTeamName",{cb:function t(r){E({message_type:TS.utility.calls.messages_to_call_window_types.calls_status,is_busy:e,team_name:r})}})});break;case TS.utility.calls.messages_from_call_window_types.force_janus_disconnect:V(t.data.server,t.data.session_id,t.data.token,t.data.transaction_id);break;case TS.utility.calls.messages_from_call_window_types.get_regions:TS.utility.calls.promiseToGetRegions().then(function(e){E({message_type:TS.utility.calls.messages_to_call_window_types.regions,regions:e})});break;case TS.utility.calls.messages_from_call_window_types.get_server:var i=t.data.id;var a=t.data.regions;TS.utility.calls.promiseToGetServer(a,i).then(function(e){E({message_type:TS.utility.calls.messages_to_call_window_types.got_server,data:e.data});TS.utility.calls.clearServerPromise(i)}).catch(function(e){TS.utility.calls.clearServerPromise(i);E({message_type:TS.utility.calls.messages_to_call_window_types.got_server_error,error:e.data.error})});break;case TS.utility.calls.messages_from_call_window_types.get_member_data:TS.members.ensureMembersArePresent([t.data.user_id]).then(function(){E({reply_to:t.data.message_id,message_type:t.data.message_type,message:{user_id:t.data.user_id,member:TS.members.getMemberById(t.data.user_id)}})});break;case TS.utility.calls.messages_from_call_window_types.play_sound:TS.sounds.play("call/"+t.data.sound+"_"+TS.boot_data.call_sounds_version+".mp3");break;case TS.utility.calls.messages_from_call_window_types.launch_dev_tools_mini_panel:if(TS.model.is_our_app)Y("calls_mini_panel");break;case TS.utility.calls.messages_from_call_window_types.launch_dev_tools_cursors:if(TS.model.is_our_app)Y("calls_cursors");break;case TS.utility.calls.messages_from_call_window_types.send_interactive_mas_migration_slackbot_message_after_call:n.send_interactive_mas_migration_slackbot_message_after_call=true;break;case TS.utility.calls.messages_from_call_window_types.update_injection_urls:n.injection_urls=t.data.urls;n.injection_url_resolver();break;default:TS.utility.calls_log.logEvent({event:r.log_events.unknown_msg_from_call_window,value:t})}else if(t.data.origin_window_type===TS.utility.calls.window_types.incoming_call)switch(t.data.message_type){case TS.utility.calls.messages_from_incoming_call_types.user_clicked_accept_or_reject:TS.utility.calls_log.logEvent({event:r.log_events.incoming_call_click,value:t.data});TS.utility.calls.sendInvitationResponseToCaller({user_id:t.data.user_id,room_id:t.data.room_id,response:t.data.did_accept?TS.utility.calls.invite_response_types.accept:TS.utility.calls.invite_response_types.reject,did_choose_video:t.data.did_choose_video});var s=true;TS.utility.calls.closeIncomingCallWindow(s);break;default:TS.utility.calls_log.logEvent({event:r.log_events.unknown_msg_from_incoming_call_window,value:t})}else if(t.data.origin_window_type===TS.utility.calls.window_types.mini_panel)switch(t.data.message_type){case TS.utility.calls.messages_from_mini_panel_types.user_clicked_action:TS.utility.calls_log.logEvent({event:r.log_events.mini_panel_click,value:t.data});if("mute"===t.data.action||"leave"===t.data.action||"screenhero"===t.data.action||"stop_screenshare"===t.data.action||"doodle"===t.data.action)E({message_type:TS.utility.calls.messages_to_call_window_types.mini_panel_action,action:t.data.action});else if("activate"===t.data.action)TSSSB.call("showWindow",n.call_window_token);break;default:TS.utility.calls_log.logEvent({event:r.log_events.unknown_msg_from_mini_panel,value:t})}}})()},4833:function(e,t){var r="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};(function(){TS.registerModule("utility.contenteditable",{onStart:function e(){TS.utility.contenteditable.refreshTextPreferences()},create:function e(t,r){if(!r)r={};t=p(t);if(!t)return;if(h(t))return;if(S(t))return;var n={modules:{tabcomplete:{searchOptions:{complete_member_specials:true},appendMenu:function e(t){$("body").prepend(t)},render:TS.tabcomplete.render,trailingPunctuationChars:i,shouldCompleteOnTab:function e(){return!TS.i18n.sendButtonEnabled()},onRender:function e(){TS.tips.texty.hide()}},textsubstitutions:{getTextPreferences:TS.utility.contenteditable.getTextPreferences,buildSmartQuotesDelta:TS.format.texty.buildSmartQuotesDelta},clipboard:{hasTeamClipboardData:function e(t){return t&&t.clipboardData&&t.clipboardData.getData("slack/"+TS.model.team.id)},onPaste:function e(r){return TS.utility.contenteditable.paste(t,r)}},keyboard:{featureReactMessages:TS.boot_data.feature_react_messages}},onEnter:function e(){return true},onEscape:function e(){return true},onTab:function e(){return true},singleLineInput:false,inlineEmoji:TS.utility.contenteditable.inlineEmojiIsEnabled(),jumbomoji:false,onTextChange:_.noop,attributes:{role:"textbox",tabindex:0,"aria-multiline":true,"aria-haspopup":true},log:_.partial(TS.log,116),logError:TS.error};var a={complete_member_specials:n.modules.tabcomplete.searchOptions.complete_member_specials,no_model_ob:_.get(r,"modules.tabcomplete.no_model_ob"),model_ob:_.get(r,"modules.tabcomplete.searchOptions.model_ob")};if(_.get(r,"modules.tabcomplete.searchOptions")&&r.modules.tabcomplete.searchOptions.hasOwnProperty("complete_member_specials"))a.complete_member_specials=r.modules.tabcomplete.searchOptions.complete_member_specials;n.modules.slackmention={processPotentialMentions:_.debounce(function(){w(t,a)},100)};_.defaultsDeep(r,n);if(r.modules&&r.modules.tabcomplete){if(!r.modules.tabcomplete.completers)r.modules.tabcomplete.completers=["channels","commands","emoji","members"];r.modules.tabcomplete.completers=_.compact(r.modules.tabcomplete.completers.map(function(e){if("channels"===e)return TS.tabcomplete.channels;if("commands"===e)return TS.tabcomplete.commands;if("emoji"===e)return TS.tabcomplete.emoji;if("members"===e)return TS.tabcomplete.members;TS.error("TEXTY","Invalid completer passed to texty");return null}))}var s=r.onEnter;r.onEnter=function(e){if(!r.singleLineInput&&b(e,t))return true;if(_.isFunction(s))return s(e);return false};if(!r.singleLineInput){var o=r.onTextChange;r.onTextChange=function(e){if(!d)TS.tips.texty.hide();o(e)}}var l=new TS.interop.texty.TextyClass(t,r);T(t,l)},inlineEmojiIsEnabled:function e(){if(TS.boot_data.feature_inline_emoji&&"as_text"!==TS.boot_data.pref_emoji_mode&&TS.boot_data.experiment_assignments&&TS.boot_data.experiment_assignments.friends_of_messaging&&"friends_of_messaging"===TS.boot_data.experiment_assignments.friends_of_messaging.group)return true;return false},unload:function e(t){t=p(t);if(!t)return;if(!g(t))return;var r=S(t);if(r){r.unload();if(TS.useReactMessages())v(t)}},isActiveElement:function e(t){t=p(t);if(!t)return false;if(h(t))return document.activeElement===t;else if(g(t)){var r=S(t);if(r.hasFocus())return true;return document.activeElement&&-1!=document.activeElement.className.indexOf("ql-clipboard")&&document.activeElement.parentNode===t}return false},focus:function e(t){t=p(t);if(!t)return;if(TS.boot_data.feature_jumper_prevent_blur&&TS.ui.jumper.is_showing)TS.console.logError(JSON.stringify({input_class:t.getAttribute("class"),input_id:t.id,is_window_focused:TS.model.ui.is_window_focused,dialog_is_showing:TS.model.dialog_is_showing,jumper_is_showing:TS.ui.jumper.is_showing}),"jumper_blur");if(h(t))t.focus();else if(g(t)){var r=S(t);r.focus()}},hasFocus:function e(t){t=p(t);if(!t)return;if(h(t))return $(t).is(":focus");else if(g(t)){var r=S(t);return r.hasFocus()}},blur:function e(t){t=p(t);if(!t)return;if(h(t))t.blur();else if(g(t)){var r=S(t);r.blur()}},isContenteditable:function e(t){t=p(t);if(t&&TS.ui&&TS.ui.paste&&TS.ui.paste.catcher_div&&TS.ui.paste.catcher_div===t)return false;if(t.isContentEditable)return true;if(g(t))return true;return false},disable:function e(t){t=p(t);if(!t)return;if(h(t))t.disabled=true;else if(g(t)){var r=S(t);r.disable()}},isDisabled:function e(t){t=p(t);if(!t)return;if(h(t))return true===t.disabled;else if(g(t)){var r=S(t);return!r.isEnabled()}return false},enable:function e(t){t=p(t);if(!t)return;if(h(t))t.disabled=false;else if(g(t)){var r=S(t);r.enable();TS.utility.contenteditable.updateSpellCheck(t)}},isEnabled:function e(t){t=p(t);if(!t)return false;if(h(t))return true!==t.disabled;else if(g(t)){var r=S(t);return r.isEnabled()}return false},value:function e(t,r){t=p(t);if(!t)return"";if(h(t)){if(_.isString(r))t.value=r;return t.value}else if(g(t)){var n=S(t);if(_.isString(r)){n.setContents(TS.format.texty.convertContentsStringToContents(r));R()}else if(_.isObject(r)){n.setContents(r);R()}return TS.format.texty.convertContentsToString(n.getContents())}return""},displayValue:function e(t){t=p(t);if(!t)return"";if(h(t))return t.value;else if(g(t))return TS.format.texty.convertContentsStringToDisplayString(TS.utility.contenteditable.value(t));return""},getLength:function e(t){t=p(t);if(!t)return 0;if(h(t))return t.value.length;else if(g(t)){var r=S(t);return r.getLength()}return 0},getDisplayValueLength:function e(t){return TS.utility.contenteditable.displayValue(t).length},getTextForRange:function e(t,r,n){t=p(t);if(!t)return"";if(h(t)){var i=TS.utility.contenteditable.value(t);return i.substr(r,n)}else if(g(t)){var a=S(t);return a.getTextForRange(r,n)}return""},getDisplayTextForRange:function e(t,r,n){t=p(t);if(!t)return"";if(h(t)){var i=TS.utility.contenteditable.value(t);return i.substr(r,n)}else if(g(t)){var a=S(t);return TS.format.texty.convertContentsToStringForDisplay({contents:a.getContentsForRange(r,n).ops})}return""},insertTextAtCursor:function e(t,r,n){t=p(t);if(!t)return;var i;if(h(t)){if(!_.isString(r))return t.value;i=TS.utility.contenteditable.cursorPosition(t);var a=TS.utility.contenteditable.value(t);var s=a.substr(0,i.start)+r+a.substr(i.start);t.value=s;if(n){TS.utility.contenteditable.focus(t);TS.utility.contenteditable.cursorPosition(t,i.start+r.length,0)}}else if(g(t)){var o=S(t);if(_.isString(r))o.insertTextAtCursor(r,n)}},insertContentsAtCursor:function e(t,r,n){t=p(t);if(!t)return;if(h(t))TS.utility.contenteditable.insertTextAtCursor(t,TS.format.texty.convertContentsToString(r),n);else if(g(t)){var i=S(t);i.insertContentsAtCursor(r,n)}},updateContents:function e(t,r){t=p(t);if(!t)return;if(h(t))TS.warn("updateContents called on form element");else if(g(t)){var n=S(t);n.updateContents(r)}},paste:function e(t,r){t=p(t);if(!t)return false;if(h(t))return false;if(g(t)){var n;var i;if(r&&r.clipboardData&&r.clipboardData.getData("slack/plain")){r.preventDefault();n=r.clipboardData.getData("slack/plain");if(n.length>f){r.stopPropagation();L(t);return true}n=y(t,n);i=TS.format.texty.convertContentsStringToContents(n);i=TS.format.texty.removeInvalidMentions(i);TS.utility.contenteditable.insertContentsAtCursor(t,i,true);return true}n=TS.ui.paste.getPlainTextFromClipboard(r);if(!_.isEmpty(n)){r.preventDefault();if(n.length>f){r.stopPropagation();L(t);return true}n=y(t,n);if(TS.utility.contenteditable.inlineEmojiIsEnabled()){i=TS.format.texty.convertContentsStringToContents(n);i=TS.format.texty.removeInvalidMentions(i);TS.utility.contenteditable.insertContentsAtCursor(t,i,true)}else TS.utility.contenteditable.insertTextAtCursor(t,n,true);return true}}return false},getFormats:function e(t,r){t=p(t);if(!t)return{};if(g(t)){var n=S(t);return n.getFormats(r)}return{}},isEmpty:function e(t,r){var n=TS.utility.contenteditable.value(t);if(n&&r)n=n.trim();return 0===n.length},clear:function e(t,r){t=p(t);if(!t)return;if(h(t))t.value="";else if(g(t)){R();var n=S(t);n.clear({is_silent:!!r})}},placeholder:function e(t,r){t=p(t);if(!t)return"";var n;if(h(t)){if(_.isString(r))if(""===r)t.removeAttribute("placeholder");else t.setAttribute("placeholder",r);n=t.getAttribute("placeholder")}else if(g(t)){var i=S(t);i.setPlaceholder(r);n=i.getPlaceholder()}return n||""},cursorPosition:function e(t,r,n){if(_.isString(t))t=$(t);var i;var a={start:0,end:0,length:0};t=p(t);if(!t)return a;if(_.isNumber(r)){if(!n)n=0;a.start=r;a.end=r+n;a.length=n;if(h(t))TS.selection.selectCharacters(t,a.start,a.end);else if(g(t)){i=S(t);i.setSelection(a.start,a.length)}}else{if(!TS.utility.contenteditable.isActiveElement(t)){var s=$(t).data("utility-contenteditable-cursor-position");if(_.isObject(s))return s}if(h(t)){t.focus();a.start=t.selectionStart;a.end=t.selectionEnd;a.length=Math.abs(t.selectionEnd-t.selectionStart)}else if(g(t)){i=S(t);var o=i.getSelection();if(o){a.start=o.index;a.length=o.length;a.end=a.start+a.length}}}return a},setCursorAtEnd:function e(t){var r=TS.utility.contenteditable.getLength(t);TS.utility.contenteditable.cursorPosition(t,r)},selectAll:function e(t){var r=TS.utility.contenteditable.getLength(t);TS.utility.contenteditable.cursorPosition(t,0,r)},isTextSelected:function e(t){t=p(t);if(!t)return;if(h(t))return!!(window.getSelection&&window.getSelection().toString());else if(g(t)){var r=S(t);return r.getSelection().length>0}},deserialize:function e(t,n){if(!n)return;t=p(t);if(!t)return;if(h(t))t.value=n;else if(g(t)){if("object"===("undefined"===typeof n?"undefined":r(n))&&n.hasOwnProperty("contents")){TS.utility.contenteditable.value(t,n);return}if("string"!==typeof n)return;try{var i=JSON.parse(n);if(null!==i&&"object"===("undefined"===typeof i?"undefined":r(i))){TS.utility.contenteditable.value(t,i);return}}catch(e){}TS.utility.contenteditable.value(t,n)}},isCursorInPreBlock:function e(t){t=p(t);if(!t)return false;if(g(t)){var r=S(t);return r.isCursorInPreBlock()}return false},deleteSelection:function e(t){t=p(t);if(!t)return false;if(g(t)){var r=S(t);return r.deleteSelection()}window.getSelection().deleteFromDocument()},deleteText:function e(t,r,n){t=p(t);if(!t)return;if(g(t)){var i=S(t);i.deleteText(r,n)}},clogMentionCounts:function e(t){if(!t)return;var r=TS.format.texty.convertContentsStringToContents(t);var n=0;var i=0;r.contents.forEach(function(e){if(e.attributes&&e.attributes.slackmention)if(e.attributes.slackmention.unverified)i+=1;else n+=1});if(n>0||i>0)TS.clog.track("MSG_SUBMITTED_MENTIONS",{num_mentions:n,num_unverified_mentions:i})},getTextPreferences:function e(){if($("#chat_input_tab_ui").length)return{substitutions:{}};return o},refreshTextPreferences:function e(){if(!TS.model.is_our_app&&"1"!==TS.qs_args.smart_quotes||TS.model.is_our_app&&!TS.model.is_mac){o=false;return}o={substitutions:{},useSmartDashes:true,useSmartQuotes:true};if(TS.model.is_our_app){var t=TSSSB.call("readSystemTextPreferences");if(t){o.substitutions=_.mapValues(_.keyBy(t.substitutions,"replace"),"with");o.useSmartDashes=t.useSmartDashes;o.useSmartQuotes=t.useSmartQuotes}}if(!o.substitutions["--"]&&o.useSmartQuotes)o.substitutions["--"]="—"},clearHistory:function e(t){t=p(t);if(!t)return false;var r=S(t);if(!r)return;r.clearHistory()},updateSpellCheck:function e(t){t=p(t);if(!t)return false;var r=S(t);if(!r)return;$(t).find("[contenteditable=true]").attr("spellcheck",!!(TS.client&&TS.prefs.getPref("webapp_spellcheck")))},synchronouslyReplacePotentialMentions:function e(t,r){r=_.defaults(r||{},{complete_member_specials:true});if(!t.length)return t;var n=[];var i=TS.format.texty.convertContentsStringToContents(t);var a;if(r.complete_member_specials)a=TS.tabcomplete.members.getBroadcastKeywords(r.complete_member_specials);var s={usergroups:TS.user_groups.getActiveUserGroups(),members:TS.members.getActiveMembersWithSelfAndSlackbot()};var o={allow_empty_query:false,frecency:false,limit:20,prefer_exact_match:true};x(i).forEach(function(e){var t=e.label.replace(/^[@＠]/,"");if(!t.length)return;var r=C(a,t);if(r)n.push(D(e.text,e.label,e.global_index,e.local_index,[r]));else{var i=TS.sorter.search(t,s,o);if(i.length){var l=D(e.text,e.label,e.global_index,e.local_index,i);if("UNVERIFIED"!==l.id)n.push(l)}}});if(n.length){var l=H(n);var u=new TS.interop.texty.Delta(i.contents).compose(new TS.interop.texty.Delta(l.contents));return TS.format.texty.convertContentsToString({contents:u.ops})}return t},test:function e(){var e={_normalizeInput:p,_isFormElement:h,_createPotentialMentionObject:D,_isNameMatchGoodEnoughForRealMention:B};return e}});var e=["'",".","_","-","‘","’"];var t=e.map(function(e){return"\\"+e}).join("");var n=new RegExp("^["+t+"]+$","g");var i=[".",",",";",":","?","!","]",")","*","_","~",">"];var a=i.concat(["@","#","`","$","%","^","&","+","=","|",'"']);var s=a.map(function(e){return"\\"+e}).join("|");var o=false;var l=new RegExp("(?:^|\\s)(?:[\\{|\\[|\\(|<|>|\\*|_|\\/|\"|“|‘|'|:]?)([@＠].*?)(?=\\s|'s|‘s|’s|"+s+"|$)","g");var u=false;var d=null;var c=[];var m=[];var f=5e4;var p=function e(t){if(!t)return false;if(t instanceof jQuery&&t[0])t=t[0];if(t.nodeType!==Node.ELEMENT_NODE)return false;if("textarea"===t.tagName.toLowerCase())return t;if("input"===t.tagName.toLowerCase())return t;if($(t).hasClass("ql-editor"))return t.parentNode;if(t.hasAttribute("contenteditable"))return t;if("DIV"===t.tagName)return t;return false};var h=function e(t){if(!t||!t.tagName)return false;if("textarea"===t.tagName.toLowerCase())return true;if("input"===t.tagName.toLowerCase())return true;return false};var g=function e(t){if(!t)return false;var r=S(t);if(r)return true;return false};var S=function e(t){return $(t).data("__ts_quill")};var T=function e(t,r){$(t).data("__ts_quill",r)};var v=function e(t){$(t).removeData("__ts_quill")};var b=function e(t,r){if(t.metaKey)return false;if(r&&TS.utility.contenteditable.isCursorInPreBlock(r)&&TS.prefs.getPref("enter_is_special_in_tbt"))return!t.shiftKey;if(t.ctrlKey&&!TS.model.is_mac&&TS.i18n.sendButtonEnabled())return false;if(TS.i18n.sendButtonEnabled())return true;if(t.shiftKey&&!(t.ctrlKey||t.altKey))return true;if(!t.shiftKey&&(t.ctrlKey||t.altKey))return true;return false};var y=function e(t,r){if($(t).hasClass("texty_single_line_input"))r=r.replace(/\n/g," ");return r.replace(/^[\u200b\uFEFF]+|[\u200b\uFEFF]+$/gm,"")};var w=function e(t,r){if($("#chat_input_tab_ui").length)return;var i=TS.utility.contenteditable.value(t);var a=TS.utility.contenteditable.cursorPosition(t);if(!i.length)return;var s=TS.format.texty.convertContentsStringToContents(i);var o=[];var l=[];var d;if(r.complete_member_specials)d=TS.tabcomplete.members.getBroadcastKeywords(r.complete_member_specials);x(s).forEach(function(e){var t=e.label.replace(/^[@＠]/,"");if(!t.length)return;if(!(a.start>e.global_index&&a.start<=e.global_index+e.label.length)&&-1===t.search(n)){var r=C(d,t);if(r)o.push(D(e.text,e.label,e.global_index,e.local_index,[r]));else l.push(e.label)}});l=_.uniq(l);u=TS.boot_data.feature_slug_tooltips&&1===l.length;j(t,o);k(t,l,r)};var k=function e(t,r,n){_.pullAll(r,c);_.pullAll(r,m);if(!r.length)return;var i;if(!n.no_model_ob)i=n.model_ob||TS.shared.getActiveModelOb();r.forEach(function(e){m.push(e);var r={query:e.replace(/^[@＠]/,""),max_api_results:20,include_org:true,include_slackbot:true,include_self:true,full_profile_filter:false,limit_by_model_relevancy:i};TS.members.promiseToSearchMembers(r).then(function(r){var n={usergroups:TS.user_groups.getActiveUserGroups(),members:r&&r.items?r.items:[]};var i={allow_empty_query:false,frecency:false,limit:20,prefer_exact_match:true};var a=TS.sorter.search(e,n,i);if(!a.length){c.push(e);return}var s=[];var o=TS.utility.contenteditable.value(t);var l=TS.utility.contenteditable.cursorPosition(t);var f=TS.format.texty.convertContentsStringToContents(o);x(f).forEach(function(t){if(t.label!==e)return;if(!t.label.replace(/^[@＠]/,"").length)return;if(!(l.start>t.global_index&&l.start<=t.global_index+t.label.length))s.push(D(t.text,t.label,t.global_index,t.local_index,a))});j(t,s);var p=m.length;_.pull(m,e);var h=m.length;if(u&&1===p&&0===h&&1===s.length&&"UNVERIFIED"!==s[0].id){var g=$(t).find("ts-mention[data-id="+s[0].id+"]");if(1===g.length&&$(g[0]).offset().top>=$(t).offset().top){TS.tips.texty.show(g[0]);d=setTimeout(function(){TS.tips.texty.hide();d=null},2e3)}}if(0===h)u=false})})};var x=function e(t){var r=0;var n=[];t.contents.forEach(function(e){if(!e.attributes&&!e.insert.slackemoji)e.insert.replace(l,function(t,i,a){var s=t.indexOf("@");if(s>0)a+=s;var o=t.indexOf("＠");if(o>0)a+=o;n.push({text:e.insert,match:t,label:i,local_index:a,global_index:a+r})});r+=e.insert.slackemoji?1:e.insert.length});return n};var C=function e(t,r){if(t)for(var n=0;n<t.length;n++){var i=t[n];if(i.name===r||i.alias===r||TS.boot_data.feature_localization&&i.ms_name===r||TS.boot_data.feature_localization&&TS.interop.I18n.deburr(i.name)===r)return i}};var M=function e(t,r,n){if(!n)n=0;return P(t)===P(r.substr(n,t.length))};var I=function e(t){if(t.is_broadcast_keyword||t.is_usergroup)return"";var r="";if(TS.members.getMemberProfileFieldDisplayName(t))r=TS.members.getMemberRealName(t);if(r)return"@"+r;return""};var P=function e(t){return TS.interop.I18n.deburr(t).toLowerCase()};var A=_.curry(function(e,t){var r=TS.tabcomplete.members.getDisplayTextForResult(t);return r.length>=e.length&&M(e,r)});var E=_.curry(function(e,t){if(t.is_broadcast_keyword||t.is_usergroup)return false;var r=I(t);return r.length>=e.length&&M(e,r)});var F=_.curry(function(e,t,r){if(r.id===e.id)return false;var n=TS.tabcomplete.members.getDisplayTextForResult(r);if(P(t)===P(n))return true;return false});var O=_.curry(function(e,t){if(e===P(TS.tabcomplete.members.getDisplayTextForResult(t)))return true;if(e===P(I(t)))return true;return false});var B=function e(t,r){t=P(t.replace(/^[@＠]/,""));r=P(r.replace(/^[@＠]/,""));var n=r.split(/[ \-._]/);var i=t.split(/[ ._]/);for(var a=0;a<i.length;a++){var s=i[a].split(/[-]/);if(s[0]===n[0])return true}return false};var D=function e(t,r,n,i,a){var s;var o;var l;var u;var d=1===a.length?a[0]:null;var c={id:"UNVERIFIED",label:r,index:n,length:r.length};if(TS.boot_data.feature_agnostic_autoslugging){if(1===a.length&&a[0].is_broadcast_keyword){s=TS.tabcomplete.members.getDisplayTextForResult(a[0]);return{id:a[0].id,label:s,index:n,length:s.length}}var m=_.map(a,function(e){return P(TS.tabcomplete.members.getDisplayTextForResult(e))});m=m.concat(_.map(a,function(e){return P(I(e))}));m=_.compact(_.uniq(m));m.sort(function(e,t){return t.length-e.length});for(var f=0;f<m.length;f+=1){l=m[f];if(r.length>l.length)break;var p=M(l,t,i);if(a.length>1&&!p)continue;var h=a.filter(O(l));if(B(l,r)&&1===h.length){s=TS.tabcomplete.members.getDisplayTextForResult(h[0]);return{id:h[0].id,label:s,index:n,length:1===a.length&&!p?c.length:l.length}}if(B(l,r)&&h.length>1){var g=TS.ui.frecency.query(h,r,null,{normalize:true});if(g[0].score-g[1].score>=30){var S=_.find(h,{id:g[0].id});s=TS.tabcomplete.members.getDisplayTextForResult(S);return{id:S.id,label:s,index:n,length:1===a.length&&!p?c.length:l.length}}}if(p){c.label=t.substr(i,l.length);c.length=l.length;return c}}}else{if(d){s=TS.tabcomplete.members.getDisplayTextForResult(d);u=r.length;l=s;o=I(d);if(s.length>c.length&&M(s,t,i))u=s.length;else if(o&&o.length>c.length&&M(o,t,i)){u=o.length;l=o}if(d.is_broadcast_keyword||B(l,r))return{id:d.id,label:s,index:n,length:u};return c}a.sort(function(e,t){var r=TS.tabcomplete.members.getDisplayTextForResult(e).length;var n=TS.tabcomplete.members.getDisplayTextForResult(t).length;return n-r});for(var T=0;T<a.length;T+=1){d=a[T];s=TS.tabcomplete.members.getDisplayTextForResult(d);o=I(d);var v=s.length>c.length&&M(s,t,i);var b=false;if(!v&&o)b=o.length>c.length&&M(o,t,i);var y=0;var w=s.length>=c.length&&M(s,t,i);if(w){l=s;y=a.filter(F(d,l)).length;if(y>0){c.label=t.substr(i,l.length);c.length=l.length;return c}else if(0===y){var k=l.length;if(o&&o.length>k&&M(o,t,i))k=o.length;s=TS.tabcomplete.members.getDisplayTextForResult(d);return{id:d.id,label:s,index:n,length:k}}}if(v||b){u=v?s.length:o.length;var x=[];if(v)x=a.filter(A(s));else x=a.filter(E(o));if(!v&&b)TS.clog.track("MSG_AUTO_MENTION_SECONDARY_LONGER_MATCH",{});if(1===x.length)c={id:d.id,label:s,index:n,length:u};else{c.length=u;c.label=v?s:o}break}}}return c};var H=function e(t){var r={contents:[]};var n=0;t.forEach(function(e){var t=e.index-n;if(t>0)r.contents.push({retain:t});r.contents.push({delete:e.length});var i={};if("UNVERIFIED"===e.id){i={id:e.id,label:e.label,unverified:true};TS.clog.track("MSG_AUTO_POTENTIAL_MENTION_CREATED",{})}else{i={id:e.id,label:e.label,unverified:false};TS.clog.track("MSG_AUTO_MENTION_CREATED",{})}i.mention=TS.format.texty.shouldHighlightMention(i.id,i.label);r.contents.push({insert:e.label,attributes:{slackmention:i}});n=e.index+e.length});return r};var j=function e(t,r){if(!r.length)return;var n=H(r);TS.utility.contenteditable.updateContents(t,n)};var R=function e(){c=[];m=[]};var L=function e(t){var r=TS.i18n.t("That’s a bit too long to paste","msg_input")();var n=TS.i18n.t("To keep things running smoothly, there’s a limit on the number of characters you can paste into Slack. If you’d like you could <b>create a snippet</b> instead.","msg_input")();n='<p class="no_bottom_margin">'+n+"</p>";TS.generic_dialog.start({title:r||"",body:n,show_cancel_button:false,esc_for_ok:true,fullscreen:false,go_button_text:TS.i18n.t("OK","msg_input")(),show_secondary_go_button:t===TS.client.msg_input.$input.get(0),secondary_go_button_text:TS.i18n.t("Create a snippet","msg_input")(),secondary_go_button_class:"btn_outline",onSecondaryGo:function e(){TS.ui.snippet_dialog.startCreate()}})}})()},4834:function(e,t){(function(){TS.registerModule("utility.attachments",{hasContent:function t(r,n){if(!r)return false;if(!_.isArray(n))n=[].concat(n);if(TS.attachment_actions.client_buttons.isClientButtonAttachment(r))return true;var i=_.difference(e,n);return _.some(i,function(e){return!_.isEmpty(r[e])})},getMediaSource:function e(t){if(!t)return;var r=TS.utility.attachments.getMediaType(t);switch(r){case"video":return t.thumb_url;case"audio":return t.audio_html||t.audio_url;case"other":return t.other_html;case"image":return t.image_url}return t.from_url},getMediaType:function e(t){if(!t)return;if(t.video_html)return"video";if(t.audio_html||t.audio_url)return"audio";if(t.other_html)return"other";if(t.image_url)return"image"},getDecoratedAttachment:function e(t,r){var d=_.cloneDeep(t);d=n(d);d._source=i(d);if(a(d))d=s(d,r);else if("twitter"===d.service_name)d=o(d);else if("salesforce"===d.service_name)d=l(d);if(d.is_app_unfurl&&d.bot_id){var c=TS.bots.getBotById(d.bot_id);if(c){d._attribution=c.name;d._attribution_link="/services/"+d.bot_id}}if(d._source.icon)d._source.icon=u(d._source.icon);if(d.footer_icon)d.footer_icon=u(d.footer_icon);return d},getSlackMessageFooterText:function e(t,r,n){if(!a(t))return"";var i=t.channel_name;var s=t.channel_id;if(!s&&t.from_url)s=TS.utility.getChannelNameFromUrl(t.from_url);var o=TS.shared.getModelObById(s)||TS.channels.getChannelByName(s);if(!i&&o)i=o.name;var l=r.source_team_id&&TS.teams.getTeamNameById(r.source_team_id);var u='<a class="channel_link_unfurl_footer" data-channel-id='+s+" data-channel-name="+i+' target="_blank" href='+t.from_url+">#"+i+"</a>";if(i){if("Direct Message"===i||o&&(o.is_im||o.is_mpim))return TS.i18n.t("Direct message","attachments")();else if(TS.utility.msgs.isMsgReply(r)||t.is_reply_unfurl){if(TS.boot_data.feature_grid_archive_link_fixes&&n)return TS.i18n.t("From a thread in {channel_link}","attachments")({channel_link:u});return TS.i18n.t("From a thread in #{channel_name}","attachments")({channel_name:i})}else if(r.thread_ts||t.is_thread_root_unfurl){if(TS.boot_data.feature_grid_archive_link_fixes&&n)return TS.i18n.t("Thread in {channel_link}","attachments")({channel_link:u});return TS.i18n.t("Thread in #{channel_name}","attachments")({channel_name:i})}if(TS.boot_data.feature_grid_archive_link_fixes&&n)return TS.i18n.t("Posted in {channel_link}","attachments")({channel_link:u});return TS.i18n.t("Posted in #{channel_name}","attachments")({channel_name:i})}if(l)return TS.i18n.t("From {team_name}","attachments")({team_name:l});return TS.i18n.t("From another workspace","attachments")()},getMediaCaretLocation:function e(r){var n=_.find(t,function(e){return _.some(r[e])});return n||"end"},isAutomatedSlackUnfurl:function e(t){return!!t&&a(t)&&TS.interop.rules.messages.isAutomatedSubtype(t.msg_subtype)},formatMessageAttachmentPart:function e(t,r,n,i,a,s){if(r){if(n&&TS.interop.rules.messages.isAutomatedSubtype(r.subtype))n=false;if(n&&!_.isEmpty(r.attachments)){var o=r.attachments.some(TS.utility.attachments.isAutomatedSlackUnfurl);if(o)n=false}}if(true===s)t=_.escape(t);var l=TS.format.formatWithOptions(t,r,{no_highlights:true!==n,no_specials:true!==i,enable_slack_action_links:true===a});l=TS.utility.msgs.handleSearchHighlights(l);return l},findAttachment:function e(t){if(!t)return;var r=TS.utility.msgs.findMsg(t.message_ts,t.channel_id);if(!r)return;return _.find(r.attachments,{id:t.attachment_id})},unfurlPlaceholders:function e(t){t.find(".unfurl-placeholder:not(.unfurled)").each(function(e,t){var n=$(t);n.addClass("unfurled");var i=_.uniqueId("pending_unfurl_");n.attr("id",i);try{var a=n.attr("href");TS.api.call("chat.unfurlLink",{url:a}).then(function(e){if(e&&e.data&&e.data.attachments&&e.data.attachments[a]){var t=e.data.attachments[a];var n=$("#"+i);if(!n.length)return;if(false===TS.prefs.getPref("a11y_animations")&&"gif"===t.file_type)return;var s=TS.inline_attachments.renderStandaloneAttachment(t);if(TS.client&&TS.client.ui){var o=TS.client.ui.areMsgsScrolledToBottom();n.replaceWith(s);if(void 0!==o){if(TS.pri)TS.log(888,"unfurlPlaceholders: Insta-scrolling back to bottom after unfurl of attachment #"+i);TS.client.ui.instaScrollMsgsToBottom(false)}r()}else{var l=n.closest(".unfurl-container");n.replaceWith(s);l.wrap('<div class="unfurl"></div>');l.removeClass("unfurl-render-pending")}}else throw new Error("No unfurl data")}).catch(function(){$("#"+i).addClass("hidden")})}catch(e){n.addClass("hidden")}});r()},test:function e(){var e={};Object.defineProperty(e,"_isSlackMessageUnfurl",{get:function e(){return a},set:function e(t){a=t}});return e}});var e=["title","text","pretext","video_html","audio_html","audio_url","other_html","from_url","fields","actions","image_url","thumb_url","author_name","service_name","footer","footer_icon","ts"];var t=["ts","footer","fields","text","title","_source"];var r=_.throttle(function(){if(TS.client&&TS.client.ui)TS.client.ui.checkInlineImgsAndIframes("file_preview")},150);var n=function e(t){if(t.author_id&&!t.author_name){var r=TS.members.getPotentiallyUnknownMemberById(t.author_id);if(!r||r.is_non_existent){t.author_name=TS.i18n.t("Private user info","member_token")();t.author_icon=cdn_url+"/436da/img/unknown_avatar.png"}else if(r.is_unknown);else{t.author_name=TS.members.getPrefCompliantMemberName(r);t.author_link="/team/"+r.id;if(r.profile)t.author_icon=r.profile.image_24}}return t};var i=function e(t){var r={};r.icon=t.service_icon||t.author_icon;r.name=t.service_name||t.author_name;r.link=t.service_url||t.author_link;r.author_name=t.author_name==r.name?t.author_subname:t.author_name;r.author_link=t.author_link;return r};var a=function e(t){if(t.is_msg_unfurl)return true;if(t.from_url&&/slack\.com\/archives\/.+\/p.+/.test(t.from_url)){t.is_msg_unfurl=true;return true}};var s=function e(t,r){if(t.author_link){var n=TS.utility.getMemberIdFromURL(t.author_link);var i=TS.interop.utility.getBotIdFromUrl(t.author_link);if(n)t._slack_author_id=n;if(i)t._slack_bot_id=i}if(r&&"pinned_item"===r.subtype)t.from_url=TS.utility.msgs.constructAbsoluteMsgPermalink(TS.shared.getActiveModelOb(),t.ts);t._is_automated_unfurl=TS.utility.attachments.isAutomatedSlackUnfurl(t);t.color=null;_.set(t,"mrkdwn_in_hash.text",true);if(TS.members.shouldDisplayRealNames())t._source.name=t.author_name||t.author_subname;else t._source.name=t.author_subname||t.author_name;t._source.author_name=null;t._source.author_link=null;t._unfurl_type_message=true;if(!t.footer){var a=TS.utility.attachments.getSlackMessageFooterText(t,r);if(a)t.footer=a}return t};var o=function e(t){t._source.name=t.author_name;t._source.link="https://twitter.com/"+t.author_subname;t._source.author_name=t.author_subname;t._source.author_link=t._source.link;t._unfurl_type_message=true;if(!t.footer)t.footer=TS.i18n.t("Twitter","attachments")();if(!t.footer_icon)t.footer_icon=cdn_url+"/6e067/img/services/twitter_pixel_snapped_32.png";return t};var l=function e(t){t._source.name=t.author_name;t._source.author_name=t.author_subname;t._unfurl_type_message=true;t._always_expand=true;return t};var u=function e(t){if(!t)return;if(0===t.indexOf("/img/"))return t;var r={width:16,height:16};if("ico"===t.split(".").pop())r.convert_ico=true;return TS.utility.getImgProxyURLWithOptions(t,r)}})()},4835:function(e,t){(function(){TS.registerModule("ui.inline_msg_input",{onStart:_.noop,make:function n(i,a){var s=TS.client&&TS.client.ui.areMsgsScrolledToBottom();var o=!!(TS.client&&!a.no_emo);var l=TS.templates.inline_message_input({input_id:_.uniqueId("inline_message_input_"),include_emo:o});var u=$(l);u.appendTo(i);var d=u.find(".message_input");if(a.placeholder)TS.utility.contenteditable.placeholder(d,a.placeholder);if(a.aria_label)d.attr("aria-label",a.aria_label);e(u,d,a);t(u,d);if(a.scrollIntoView)r(u,d,s);return u}});var e=function e(t,r,n){var i=n.onSubmit||_.noop;var o=n.onCancel||_.noop;TS.utility.contenteditable.create(r,{modules:{msginput:{onUpArrow:function e(){if(!TS.prefs.getPref("arrow_history"))return s(r,false,n)},onUpArrowCmd:function e(){s(r,true,n)}},tabcomplete:{searchOptions:{complete_member_specials:n.complete_member_specials,model_ob:n.model_ob,in_thread:!!n.in_thread},completers:n.completers,positionMenu:function e(t){var i=r.offset();var a=$(window).width()-i.left-2;t.style.width=Math.min(r.outerWidth(),a)+"px";t.style.minWidth=0;TS.tabcomplete.positionUIRelativeToInput(t,r,n.autocomplete_below_input)}}},placeholder:n.placeholder,jumbomoji:!!n.jumbomoji,onEnter:function e(){if(!TS.client.ui.cal_key_checker.prevent_enter)a(r,t,i);if(n.onEnter)n.onEnter();return false},onEscape:function e(){if(n.onEscape)n.onEscape()},onTab:function e(){if(n.onTab)n.onTab();return true},onTextChange:function e(){TS.msg_edit.checkLengthAndUpdateMessage(r);if(n.onTextChange)n.onTextChange(r)}});TS.utility.contenteditable.enable(r);t.bind("destroyed",function(){o(t)});t.bind("submit",function(e){e.preventDefault();a(r,t,i)})};var t=function e(t,r){var n=t.find(".emo_menu");n.removeClass("hidden");n.bind("click.open_dialog",function(e){TS.ui.react_emoji_menu.start({e:e,input_to_fill:r})})};var r=function e(t,r,n){if(TS.client&&n)TS.client.ui.instaScrollMsgsToBottom(false);t.scrollintoview({duration:500,px_offset:100,complete:function e(){TS.utility.contenteditable.focus(r);TS.utility.contenteditable.setCursorAtEnd(r)}})};var n=function e(t,r){var n=t.closest("ts-message");if(r&&n.length){var i=n.data("ts");var a=TS.utility.msgs.getMsg(i,r.msgs);if(a&&TS.utility.msgs.canEditMsg(a,r))return a}return null};var i=function e(t,r){var n=TS.msg_edit.isMessageTooLong(t);if(n)return false;if(!$.trim(r))return false;return true};var a=function e(t,r,n){var a={complete_member_specials:false};var s=r.closest("#reply_container").length||r.closest(".reply_input_container").length;if(s&&!TS.boot_data.feature_threads_api_stop_fe)a={complete_member_specials:["BKhere"]};var o=TS.utility.contenteditable.value(t);o=TS.utility.contenteditable.synchronouslyReplacePotentialMentions(o,a);if(i(t,o))n(r,o)};var s=function e(t,r,n){var i=jQuery.Event("keydown",{altKey:false,shiftKey:false,which:TS.utility.keymap.up});if(r)if(TS.model.is_mac)i.metaKey=true;else i.ctrlKey=true;if(!TS.client.ui.shouldEventTriggerMaybeEditLast(i,t))return true;o(t,n)};var o=function e(t,r){var i=r.getMsgDivForEditing||n;var a=r.model_ob;var s=i(t,a);if(s&&s.length){var o=s.data("ts");var l=s.data("model-ob-id");a=TS.shared.getModelObById(l);var u=s.closest("#convo_container").length>0;var d=u?"convo":null;TS.msg_edit.startEdit(o,a,d)}}})()},4836:function(e,t){(function(){TS.registerModule("attachment_actions",{action_triggered_sig:new signals.Signal,action_completed_sig:new signals.Signal,onStart:function e(){TS.attachment_actions.action_triggered_sig.add(t);TS.attachment_actions.action_completed_sig.add(r)},getActionContext:function e(t){var r=a(t);var n=TS.utility.msgs.findMsg(r.message_ts,r.channel_id);if(!n)return;var i=_.find(n.attachments,{id:r.attachment_id});if(!i)return;var s=TS.attachment_actions.client_buttons.fetchClientButtonData(n);if(s)return TS.attachment_actions.client_buttons.getActionContext(s,n,i,r);var o=_.find(i.actions,{id:r.action_id});if(!o)return;return{action:o,attachment:i,channel_id:r.channel_id,message:n}},handleActionEventAndGetContext:function e(t){var r=t.data("url");if(r){var n=r.match(/<(.*?)\|/);var i=n?n[1]:r;if(!i)return;if(0===i.indexOf(TS.utility.msgs.new_api_url_prefix))TS.utility.msgs.doNewApiUrl(i);else if(TS.boot_data.feature_link_buttons)TS.utility.openInNewTab(r,"_blank");return}var a=TS.attachment_actions.getActionContext(t);if(TS.client.activeChannelIsHidden()||a.channel_id!=TS.shared.getActiveModelOb().id)TS.client.ui.tryToJump(a.channel_id,a.message.ts);return a},confirmAction:function e(t,r,n){var i="danger"===t.style?"btn_danger":"btn_primary";var a=_.defaults(t.confirm,{dismiss_text:TS.i18n.t("Cancel","attachment_actions")(),ok_text:TS.i18n.t("OK","attachment_actions")(),text:"",title:""});if(a.text)a.text=TS.emoji.graphicReplace(a.text);else if(!a.title)a.text=TS.i18n.t("Are you sure?","attachment_actions")();if(a.title)a.title=TS.emoji.graphicReplace(a.title);TS.generic_dialog.start({title:a.title,body:a.text,show_go_button:true,show_cancel_button:true,go_button_text:a.ok_text,go_button_class:i,cancel_button_text:a.dismiss_text,onGo:r,onCancel:n})},render:function e(t,r,n){if(!t||!r)return;var a=i(t,r);if(!a.length)return;if(!n||a.find(".attachment_actions_interactions").hasClass("attachment_pending")){var s=TS.templates.attachment_actions({attachment:t,message_ts:r});a.html(s);TS.attachment_actions.select.decorateNewElements(a)}},test:function t(){var r={};Object.defineProperty(r,"_getActionContextDataFromDOM",{get:function e(){return a},set:function e(t){a=t}});Object.defineProperty(r,"_getPendingAttachment",{get:function t(){return e},set:function t(r){e=r}});return r}});function e(e,t){if(!e||!t||!t.length)return;var r=_.map(t,"id");var n=_.cloneDeep(e);n.actions.forEach(function(e){e._disabled=true;e._loading=_.includes(r,e.id)});n._pending=true;return n}function t(t){if(!t||!t.message||!t.attachment||!t.action||!t.channel_id){TS.warn("_onActionTriggered: missing message, attachment, action, or channel_id");return}var r=e(t.attachment,[t.action]);if(r)TS.attachment_actions.render(r,t.message.ts);var n=_.clone(t.action);delete n.options;var i={actions:[n],attachment_id:t.attachment.id,callback_id:t.attachment.callback_id,channel_id:t.channel_id,is_ephemeral:t.message.is_ephemeral,message_ts:t.message.ts};var a=_.get(t.message,"bot_profile.team_id",false);if(a)i.team_id=a;var s={payload:JSON.stringify(i),client_token:TS.interop.client_action_token.generateAndEnqueue()};if(t.message.bot_id)s.service_id=t.message.bot_id;if(t.message.user)s.bot_user_id=t.message.user;TS.api.call("chat.attachmentAction",s).then(function(e){TS.attachment_actions.action_completed_sig.dispatch({attachment:t.attachment,message_ts:t.message.ts,channel_id:t.channel_id,is_expecting_ms_update:!!(_.get(e,"data.replaced")||_.get(e,"data.deleted"))})}).catch(function(e){TS.error(e);TS.attachment_actions.action_completed_sig.dispatch({attachment:t.attachment,message_ts:t.message.ts,channel_id:t.channel_id,err:e})})}function r(e){if(!e)return;if(e.err){var t=TS.i18n.t("Oh no, something went wrong. Please try that again.","attachment_actions")();var r={text:_.get(e,"err.data.response")||t,ephemeral_type:_.get(e,"err.data.error")||"attachment_action_error",slackbot_feels:"sad_surprise"};TS.client.ui.addEphemeralBotMsg(r)}if(e.attachment&&e.message_ts&&e.channel_id&&!e.is_expecting_ms_update)n(e)}function n(e){TS.utility.rAF(function(){var t=TS.utility.attachments.findAttachment({attachment_id:e.attachment.id,message_ts:e.message_ts,channel_id:e.channel_id});if(t)TS.attachment_actions.render(t,e.message_ts,true)})}function i(e,t){var r=TS.templates.makeMsgDomId(t);var n="#"+r+", #"+r+"_conversation";return $(n).find("[data-attachment-id="+e.id+"] .attachment_actions")}function a(e){var t=e.parents("[data-attachment-id]");var r=t.parents("ts-message");var n={action_id:String(e.data("action-id")||""),attachment_id:String(t.data("attachment-id")||""),channel_id:String(r.data("model-ob-id")||""),message_ts:String(r.data("ts")||"")};Object.keys(n).forEach(function(e){if(!n[e])throw new Error('Attachment is missing "'+e+'"')});return n}})()},4837:function(e,t){(function(){TS.registerModule("attachment_actions.select",{onStart:_.noop,decorateNewElements:function e(t){t=t||TS.client.ui.$msgs_div;var r=t.find(".attachment_actions_interactions select:not(.hidden)");r.each(function(){var e=$(this);var t=TS.client?TS.attachment_actions.getActionContext(e):{};var r={adjustAvailableSpaceAbove:d,adjustAvailableSpaceBelow:u,allow_list_position_above:true,classes:"select_attachment",data_promise:m(t),disabled:e.attr("disabled"),errorTemplate:a,filter:o,input_debounce_wait_time:g(t),min_query_length:_.get(t,"action.min_query_length",0),no_default_selection:true,onItemAdded:s,onListShown:l(t),placeholder_text:T(t),filter_placeholder_text:v(t),should_graphic_replace_emoji:true,style:TS.ui.lazy_filter_select.STYLES.filter_in_list,template:S(t)};e.lazyFilterSelect(r).addClass("hidden");y(t,e)})},getActionModel:function e(t,n){var i=r[t.data_source]||r.default;return _.merge({},t,{_disabled:t._disabled||!!n,data_source:i,options:C(t.options),option_groups:x(t.option_groups),text:t.text||b(i)})}});var e={channels:TS.i18n.t("Choose a channel…","attachment_actions")(),conversations:TS.i18n.t("Choose a conversation…","attachment_actions")(),default:TS.i18n.t("Choose an option…","attachment_actions")(),external:TS.i18n.t("Choose an option…","attachment_actions")(),users:TS.i18n.t("Choose a person…","attachment_actions")()};var t={channels:TS.i18n.t("Search channels","attachment_actions")(),conversations:TS.i18n.t("Search conversations","attachment_actions")(),default:TS.i18n.t("Filter options","attachment_actions")(),external:TS.i18n.t("Search options","attachment_actions")(),users:TS.i18n.t("Search people","attachment_actions")()};var r={channels:"channels",conversations:"conversations",default:"default",external:"external",users:"users"};var n=250;function i(e,t){var r=_.find(t.attachment.actions,{id:e});if(r)r.selected_options=[]}function a(e){if(!e)return TS.i18n.t("No results.","lazy_filter_select")();return TS.i18n.t("Couldn’t load results.","lazy_filter_select")()}function s(e){if(!TS.client)return;var t=this.$select;var r=TS.attachment_actions.handleActionEventAndGetContext(t);var n=_.get(e,"model_ob.id",e.value);var a=function t(){r.action.selected_options=[{text:e.text,value:n}];var a=i.bind(null,r.action.id);TS.attachment_actions.action_completed_sig.addOnce(a);_.defer(TS.attachment_actions.action_triggered_sig.dispatch,r)};var s=function e(){t.lazyFilterSelect("clearValue")};if(r.action.confirm)TS.attachment_actions.confirmAction(r.action,a,s);else a()}function o(e,t){return _.isEmpty(t)||TS.fuzzy.score(e.text.toLowerCase(),t.toLowerCase())<Infinity}function l(e){var t=_.get(e,"action.data_source");var r=A(e);return function e(){P(t,r)}}function u(e){var t=$("#footer").height()||0;return e-t}function d(e){var t=$("#client_header").height()||0;return e-t}function c(e){var t=_.get(e,"action.data_source");return r[t]||r.default}function m(e){switch(c(e)){case r.channels:return f({channels:{include_archived:false}},{default_query:"#"});case r.conversations:return p();case r.external:return h(e);case r.users:return f({members:{include_self:true}},{default_query:"@"})}}function f(e,t){e=_.defaults(e,{limit:100,sort:{frecency:true}});t=_.defaults(t,{default_query:""});return function(r){r=r||t.default_query;return new Promise(function(t,n){TS.searcher.search(r,e).then(function(e){t({all_items_fetched:true,items:e,replace_all_items:true})},n)})}}function p(){return function(e){return new Promise(function(t,r){TS.ui.file_share.promiseToGetFileShareSelectOptions(e).then(function(e){t({all_items_fetched:true,items:e,replace_all_items:true})},r)})}}function h(e){return function(t){return new Promise(function(r,n){var i=_.get(e.message,"bot_profile.team_id",false);var a={name:e.action.name,value:t,attachment_id:e.attachment.id,callback_id:e.attachment.callback_id,channel_id:e.channel_id,is_ephemeral:true,message_ts:e.message.ts};if(i)a.team_id=i;TS.api.call("chat.attachmentSuggestion",{service_id:A(e),payload:JSON.stringify(a)}).then(function(e){r({all_items_fetched:true,items:M(e),replace_all_items:true})}).catch(function(e){n(e)})})}}function g(e){if(c(e)!==r.default)return n}function S(e){var t=c(e);if("users"===t)return k;else if(_.includes([r.channels,r.conversations],t))return w}function T(e){return _.get(e,"action.text")||b(e)}function v(e){return _.get(t,c(e),t.default)}function b(t){return _.get(e,c(t),e.default)}function y(e,t){if(!$.contains(document,t[0]))return;var n=_.get(e,"action.selected_options[0]");if(n){var i=_.includes([r.channels,r.conversations,r.users],c(e));if(i){var a=TS.shared.getModelObById(n.value);if(a)n={model_ob:a};else return}else{n.text=_.unescape(n.text);n.description=_.unescape(n.description);n=I(n)}t.lazyFilterSelect("forceSelectItem",n)}}function w(e){var t=TS.templates.attachment_actions_select_channel_or_conversation_option(e.model_ob);return new Handlebars.SafeString(t)}function k(e){var t=TS.templates.attachment_actions_select_user_option(e.model_ob);return new Handlebars.SafeString(t)}function x(e){if(!e)return;return e.map(function(e){return _.merge({},e,{options:C(e.options),text:e.text&&new Handlebars.SafeString(e.text)})})}function C(e){if(!e)return;return e.map(function(e){return _.merge({},e,{description:e.description&&new Handlebars.SafeString(e.description),text:e.text&&new Handlebars.SafeString(e.text)})})}function M(e){var t=_.get(e,"data.option_groups");if(_.isArray(t))return t.map(function(e){var t=_.get(e,"options",[]).map(function(e){return I(e,{is_group_item:true})});return{lfs_group:true,label:e.text,children:t}});return _.get(e,"data.options",[]).map(I)}function I(e,t){e=_.merge({},e,{is_group_item:_.get(t,"is_group_item")});var r=TS.templates.attachment_actions_select_option(e);var n=$("<div>").html(r);return n.children()[0]}function P(e,t){TS.clog.track("MSG_MENU_OPEN",{data_source:e,service_id:t})}function A(e){if(_.get(e,"attachment.is_app_unfurl"))return e.attachment.bot_id;return _.get(e,"message.bot_id")}})()},4838:function(e,t){(function(){TS.registerModule("attachment_actions.client_buttons",{onStart:function e(){TS.prefs.enable_shared_channels_changed_sig.add(u)},isClientButtonAttachment:function e(t){if(!t.callback_id)return false;var r=t.callback_id.split("_")[0];return _.includes(m,r)},fetchClientButtonData:function e(t){if(!t||t.bot_id!==d||!t.attachments)return false;return _.find(c,function(e){return e.match(t)})},handleClick:function e(t,r){t.onClick(r)},generateActions:function e(t,r){return t.generate(r)},getActionContext:function e(t,r,n,i){n=TS.attachment_actions.client_buttons.generateActions(t,n);var a={action:_.find(n.actions,{id:i.action_id}),attachment:n,channel_id:i.channel_id,message:r};return a},test:function e(){return{_CLIENT_BUTTON_OPTIONS:c,_generateSharedChannelInvitationActions:t,_generateSharedChannelFindAnAdminAction:i,_generateSharedChannelBetaOptInActions:o,_onEnableSharedChannelPrefChange:u}}});var e=function e(t){var r=_.get(t,"attachments[1].callback_id");return!!r&&_.includes(r,this.callback_id_prefix)};var t=function e(t){var r={id:"1",name:"approve",style:"primary",text:TS.i18n.t("View Invitation","shared_channels")(),type:"button",value:"approve"};var n={id:"2",name:"decline",style:"danger",text:TS.i18n.t("Decline","shared_channels")(),type:"button",value:"decline"};return _.assign({},t,{actions:[r,n]})};var r=function e(t){var r=_.get(t,"message.attachments[1].callback_id");if(!_.isString(r)||!_.includes(r,this.callback_id_prefix))return;var n=r.split("_")[1];if(!n)return;if("approve"===t.action.value){TS.clog.trackClickWithContext({event:"SHARED_CHANNELS_SLACKBOT_ADMIN_ACTION",element:"SHARED_CHANNELS_SLACKBOT_INVITE_VIEW_BTN",contexts:{core:{shared_channels_invite_id:n}}});TS.ui.share_channel_dialog.showApproveRequestDialog(n)}else if("decline"===t.action.value){TS.clog.trackClickWithContext({event:"SHARED_CHANNELS_SLACKBOT_ADMIN_ACTION",element:"SHARED_CHANNELS_SLACKBOT_INVITE_DECLINE_BTN",contexts:{core:{shared_channels_invite_id:n}}});TS.api.call("conversations.declineSharedInvite",{invite_id:n})}};var n=function e(t){var r=_.get(t,"attachments[0].callback_id");return!!r&&_.includes(r,this.callback_id_prefix)};var i=function e(t){var r={id:"1",name:"find_an_admin",style:"primary",text:TS.i18n.t("Who are my admins?","shared_channels")(),type:"button",value:"find_an_admin"};return _.assign({},t,{actions:[r]})};var a=function e(t){var r=_.get(t,"message.attachments[0].callback_id");if(!_.isString(r)||!_.includes(r,this.callback_id_prefix))return;var n=r.split("_")[1];TS.clog.trackClickWithContext({event:"SHARED_CHANNELS_NONADMIN_ACTION",element:"SHARED_CHANNELS_SLACKBOT_INVITE_FIND_ADMIN_BTN",contexts:{core:{shared_channels_invite_id:n}}});TS.ui.share_channel_dialog.showFindAnAdminDialog()};var s=function e(t){var r=_.get(t,"attachments[0].callback_id");return!!r&&_.includes(r,this.callback_id_prefix)};var o=function e(t){var r={id:"1",name:"opt_in",style:"primary",text:TS.i18n.t("Join the Beta","shared_channels")(),type:"button",value:"opt_in"};var n={id:"2",name:"not_now",style:"default",text:TS.i18n.t("Not Now","web_admin")(),type:"button",value:"not_now"};if(0===TS.prefs.getTeamPref("enable_shared_channels")){t.text=TS.i18n.t(":no_entry_sign: To join later, click on *Shared channels (beta)* in the top-left menu.","shared_channels")();return t}else if(1===TS.prefs.getTeamPref("enable_shared_channels")){t.text=TS.i18n.t(":white_check_mark: Your team has joined the Shared Channels beta. To learn more, click on *Shared channels (beta)* in the top-left menu.","shared_channels")();return t}return _.assign({},t,{actions:[r,n]})};var l=function e(t){var r=_.get(t,"message.attachments[0].callback_id");if(!_.isString(r)||!_.includes(r,this.callback_id_prefix))return;if("opt_in"===_.get(t,"action.value"))TS.ui.shared_channels_open_beta_modal.showModal();else if("not_now"===t.action.value)TS.prefs.setTeamPrefByAPI({enable_shared_channels:0})};var u=function e(){if("slackbot"===TS.shared.getTypeForModelOb())TS.client.msg_pane.rebuildMsgsWithReason("TS.prefs.enable_shared_channels_changed_sig")};var d="B01";var c={shared_channel_invitation:{callback_id_prefix:"sharedchannelsinvite",match:e,generate:t,onClick:r},shared_channel_find_an_admin:{callback_id_prefix:"sharedchannelsfindanadmin",match:n,generate:i,onClick:a},shared_channel_beta_opt_in:{callback_id_prefix:"sharedchannelsbetaoptin",match:s,generate:o,onClick:l}};var m=_.map(c,"callback_id_prefix")})()},4839:function(e,t){(function(){TS.registerModule("utility.enterprise",{getSelf:function e(){return _.get(TS.enterprise.model.get(),"org.user")},splitQueryIntoTerms:function e(t,r,n){var i=r;var a;t=t.trim();if(t.length>=2){i=_.isArray(r)?_.slice(r):[];a=t.split(/\s+/);_.each(a,function(e){i.push({type:n||"fuzzy_with_email",value:e})})}return i},doFormatSearchQuery:function e(t,r,n){r=r||"";var i=[];switch(t){case"members":i.push({type:"is",value:"user"});if(n&&!_.isEqual(n,"all"))i.push(TS.utility.enterprise.doFormatMemberFilterClauses(n));break;case"groups":i.push({type:"is",value:"group"});break;case"teams":i.push({type:"is",value:"team"})}return{query:TS.utility.enterprise.splitQueryIntoTerms(r,i)}},doFormatMemberFilterClauses:function e(t){switch(t){case"admins":return{type:"or",clauses:[{type:"level",value:"admin"},{type:"level",value:"owner"}]};case"guests":return{type:"or",clauses:[{type:"level",value:"restricted"},{type:"level",value:"ultra_restricted"}]};case"members":default:return{type:"level",value:"regular"}}},getSSOProviderLabel:function e(t,r){if(!t)return r;var n=_.get(t,"type","");var i=_.get(t,"name","");var a=""===n;var s="saml"===n;if(a||s)return r;return i||r},getProviderLabel:function e(t,r){var n=r||"IDP";if(!t)return n;r=_.get(t,"saml_provider")||n;if("saml"===r.toLowerCase())r=n;return TS.utility.enterprise.getSSOProviderLabel(_.get(t,"sso_provider"),r)},getWorkspaceVisibilityLabel:function e(t){if(TS.boot_data.feature_invite_only_workspaces)switch(t){case"open":return TS.i18n.t("Open","enterprise_dashboard")();case"unlisted":return TS.i18n.t("Hidden","enterprise_dashboard")();case"closed":return TS.i18n.t("By Request","enterprise_dashboard")();case"invite_only":return TS.i18n.t("Invite Only","enterprise_dashboard")();default:return t}return t},getGroupsTitle:function e(t){var r=TS.utility.enterprise.getProviderLabel(t);if("IDP"===r)return TS.i18n.t("IDP Groups","enterprise_dashboard")();return TS.i18n.t("{provider_label} Groups","enterprise_dashboard")({provider_label:r})},wrapWithStrongTags:_.wrap(_.escape,function(e,t){return"<strong>"+e(t)+"</strong>"}),buildTeamUrl:function e(t){return"https://"+(t||"my")+"."+TS.boot_data.abs_root_url.replace(/(http:\/\/|https:\/\/)/,"")},buildOrgUrl:function e(t){return"https://"+t+".enterprise."+TS.boot_data.abs_root_url.replace(/(http:\/\/|https:\/\/)/,"")},getSanitizedIdpLabel:function e(t){return{simple:"IDP"===t||!t?"":t,your:"IDP"===t||!t?TS.i18n.t("your IdP","enterprise_utility")():t,possessive:"IDP"===t||!t?TS.i18n.t("your IdP’s","enterprise_utility")():TS.i18n.fullPossessiveString(t)}},formatChannelsData:function e(t){var r=[];if(t.private_channels){t.private_channels=_.isArray(t.private_channels)?t.private_channels:[t.private_channels];r=_.map(t.private_channels,function(e){var t=TS.members.getMemberById(e.creator)||{};return{creator_display:t.real_name?t.real_name:t.name,creator_id:e.creator,creator_username:t.name,date_created:e.created,id:e.id,member_count:e.member_count,name:e.name,purpose:e.purpose.value,topic:e.topic.value,private:true,is_shared:TS.shared.isModelObOrgShared(e)}})}if(t.channels)r=r.concat(_.map(t.channels,function(e){var t=TS.members.getMemberById(e.creator)||{};return{creator_display:t.real_name?t.real_name:t.name,creator_id:e.creator,creator_username:t.name,date_created:e.created,id:e.id,member_count:_.get(e,"members.length",0),name:e.name,purpose:_.get(e,"purpose.value",""),topic:_.get(e,"topic.value",""),private:false,is_general:e.is_general,is_shared:TS.shared.isModelObOrgShared(e)}}));return r},pollUntilCondition:function e(t){return new Promise(function(e,r){var n={api_method:null,api_params:{},condition_method:null,interval:5e3,interval_backoff:1e3,attempts_max:10,call_immediately:true};t=_.merge(n,t||{});var i={attempts:0,last_api_response:null,interval:parseInt(t.interval,10)||1e3,interval_backoff:parseInt(t.interval_backoff,10)||0};function a(){if(i.attempts>=t.attempts_max)return r(new Error("Giving up on "+t.api_method+", reached max attempts of "+t.attempts_max));i.attempts+=1;i.interval+=i.interval_backoff;TS.api.call(t.api_method,t.api_params).then(function(r){i.last_api_response=r;if(t.condition_method(r))return e(r);return s()}).catch(function(e){i.last_api_response=e;return s()})}function s(){window.setTimeout(a,i.interval)}if(!t.api_method)return r(new Error("missing required api_method in params"));if(!t.condition_method)return r(new Error("missing required condition_method in params"));if(t.call_immediately)a();else s()})},getUserRoleLabel:function e(t,r){var n;var i;if(r)n={primary_owner:TS.i18n.t("Primary Org Owner","enterprise_dashboard")(),owner:TS.i18n.t("Org Owner","enterprise_dashboard")(),admin:TS.i18n.t("Org Admin","enterprise_dashboard")(),single_channel_guest:TS.i18n.t("Single-Channel Guest","enterprise_dashboard")(),multi_channel_guest:TS.i18n.t("Multi-Channel Guest","enterprise_dashboard")(),member:TS.i18n.t("Member","enterprise_dashboard")()};else n={primary_owner:TS.i18n.t("Primary Owner","enterprise_dashboard")(),owner:TS.i18n.t("Owner","enterprise_dashboard")(),admin:TS.i18n.t("Admin","enterprise_dashboard")(),single_channel_guest:TS.i18n.t("Single-Channel Guest","enterprise_dashboard")(),multi_channel_guest:TS.i18n.t("Multi-Channel Guest","enterprise_dashboard")(),member:TS.i18n.t("Member","enterprise_dashboard")()};if(t.is_ultra_restricted)i=n.single_channel_guest;else if(t.is_restricted)i=n.multi_channel_guest;else if(t.is_primary_owner)i=n.primary_owner;else if(t.is_owner)i=n.owner;else if(t.is_admin)i=n.admin;else i=n.member;return i},buildAnalyticsApiOptionsFor:function e(t){var r=function e(t){return _.reduce(t,function(e,t,r){var n=TS.enterprise.model.get(["analytics",t]);if(n)e[r]=n;return e},{})};switch(t){case"teams":return r({query:"teams_search_term",sort_prefix:"teams_sort_prefix",sort_dir:"teams_sort_dir",cursor_mark:"teams_api_cursor",date_range:"current_date_range",start_date:"start_date",end_date:"end_date"});case"team_overview":return r({date_range:"current_date_range",start_date:"start_date",end_date:"end_date",team_id:"team_overview_id"});case"members":return r({query:"members_search_term",sort_prefix:"members_sort_prefix",sort_dir:"members_sort_dir",cursor_mark:"members_api_cursor",date_range:"current_date_range",start_date:"start_date",end_date:"end_date"});case"channels":return r({query:"channels_search_term",sort_prefix:"channels_sort_prefix",sort_dir:"channels_sort_dir",cursor_mark:"channels_api_cursor",date_range:"current_date_range",start_date:"start_date",end_date:"end_date"});default:return r({date_range:"current_date_range",start_date:"start_date",end_date:"end_date"})}},maybeGetUpdatedAtTime:function e(t){return t?TS.interop.datetime.toTimeAgo(t):null},getObjectsForIds:function e(t,r){if(_.isEmpty(t)||_.isEmpty(r))return[];return _.intersectionWith(t,r,function(e,t){return e.id===t})},getQueryForIds:function e(t){if(_.isEmpty(t))return;if(1===t.length)return{query:{type:"id",value:_.head(t)}};return{query:{type:"or",clauses:_.map(t,function(e){return{type:"id",value:e}})}}},buildApiOptionsForAnalyticsCSVExport:function e(t){var r={};if(t.type)r.type=t.type;if(t.date_range)r.date_range=t.date_range;if(_.get(t.selected_columns,"length"))r.cols=t.selected_columns.join(",");if(t.team_id)r.team_id=t.team_id;if(t.sort_prefix){r.sort_prefix=t.sort_prefix;if(t.sort_dir)r.sort_dir=t.sort_dir}if(t.search_term){var n=TS.utility.enterprise.splitQueryIntoTerms(t.search_term,[],"fuzzy_with_email");if(n.length){var i=1===n.length?_.head(n):{type:"and",clauses:n};r.query=JSON.stringify(i)}}return r},recordAnalyticsPricingEvents:function e(t,r,n){n=n||{};var i={};switch(r){case"overview_impression":i.action="impression";i.step="team_stats_overview";break;case"coachmark_impression":i.action="impression";i.step="team_stats_overview_"+_.get(n,"callout_module")+"_coachmark";break;case"coachmark_resolve":i.action="click";i.step="team_stats_overview_"+_.get(n,"callout_module")+"_coachmark";i.ui_element="learn_more_btn";break;case"coachmark_reject":i.action="dismiss";i.step="team_stats_overview_"+_.get(n,"callout_module")+"_coachmark";i.ui_element="skip_this";break;case"msg_files_pricing_btn_click":i.action="click";i.step="team_stats_overview";i.ui_element="msg_files_chart_link_btn";break;case"single_callout_upgrade_link_impression":i.action="impression";i.step="team_stats_overview";i.ui_element=_.get(n,"callout_module")+"_upgrade_link";break;case"multi_callout_upgrade_link_impression":i.action="impression";i.step="team_stats_overview";i.ui_element="multi_lim_upgrade_link";break;case"data_table_upsell_banner_impression":i.action="impression";i.step="team_stats_"+_.get(n,"report_name");break;case"data_table_upsell_banner_click":i.action="click";i.step="team_stats_"+_.get(n,"report_name");i.ui_element="see_pricing_plans_btn"}TS.clog.track(t,{contexts:{ui_context:i}})},recordAnalyticsImpression:function e(t,r,n,i,a){var s="ENTERPRISE_ANALYTICS";var o={};var l={};o.action="impression";o.ui_element=r;l.entity_key=n;l.tracking_code=i;l.anchor_page=t;if(a)l.target_team_id=a;else l.target_team_id=TS.enterprise.model.get("org.enterprise.id")||_.get(TS.boot_data,"team_id");TS.clog.track(s,_.assign({},l,{contexts:{ui_context:o}}))},recordAnalyticsTooltipHover:function e(t){var r="ENTERPRISE_ANALYTICS";var n={};var i={};n.action="hover";n.ui_element="NOTING_BADGE";i.entity_key=t;var a=TS.enterprise.model.get("org.enterprise.id");var s=TS.enterprise.model.get("analytics.overview_open");if(a&&!s){i.anchor_page="organization_overview";i.target_team_id=a}else if(s){i.anchor_page="workspace_overview";i.target_team_id=TS.enterprise.model.get("analytics.team_overview_id")}else{i.anchor_page="workspace_overview";i.target_team_id=_.get(TS.boot_data,"team_id")}TS.clog.track(r,_.assign({},i,{contexts:{ui_context:n}}))},recordAnalyticsSearchEvent:function e(t,r,n){var i="ENTERPRISE_ANALYTICS";var a={};var s={};a.action="impression";a.action_status=n?2:1;a.ui_element="SEARCH_BAR";s.entity_key=r;s.anchor_page=t;s.target_team_id=TS.enterprise.model.get("org.enterprise.id")||_.get(TS.boot_data,"team_id");TS.clog.track(i,_.assign({},s,{contexts:{ui_context:a}}))},convertDateRangeToThriftID:function e(t){switch(t){case"30d":return"FILTER_LAST_30DAYS";case"all":return"FILTER_ALL_TIME"}},convertTimeseriesTabToClogKey:function e(t){switch(t){case"active-users_weekly_active_users":return"wau_ts";case"active-users_daily_active_users":return"dau_ts";case"messages-and-files_messages_sent":return"messages_sent_ts";case"messages-and-files_files_uploaded":return"files_uploaded_ts";case"transparency_where_messages_sent":return"transparency_sent_ts";case"transparency_where_messages_read":return"transparency_read_ts"}},getNumberAnnotation:function e(t){var r="";if("ja-JP"===TS.i18n.locale())switch(t){case"channels":case"messages":r="件";break;case"users":r="人";break;case"files":case"apps":r="個"}return r}})})()},4840:function(e,t){(function(){TS.registerModule("replies",{thread_marked_sig:new signals.Signal,thread_subscription_changed_sig:new signals.Signal,sanity_check_failed_sig:new signals.Signal,reply_changed_sig:new signals.Signal,reply_deleted_sig:new signals.Signal,DEFAULT_HISTORY_API_LIMIT:100,onStart:function e(){TS.channels.message_received_sig.add(d);TS.groups.message_received_sig.add(d);TS.ims.message_received_sig.add(d);TS.mpims.message_received_sig.add(d);TS.channels.message_removed_sig.add(u);TS.groups.message_removed_sig.add(u);TS.ims.message_removed_sig.add(u);TS.mpims.message_removed_sig.add(u);TS.channels.message_changed_sig.add(l);TS.groups.message_changed_sig.add(l);TS.ims.message_changed_sig.add(l);TS.mpims.message_changed_sig.add(l);TS.redux.socket.connectedSig.add(o)},canReplyToMsg:function e(t,r,n){if(!TS.client)return false;if(!r)return false;if(TS.interop.rules.messages.isAutomatedSubtype(r.subtype))return false;if(TS.utility.msgs.isFileMsg(r))return false;if(TS.utility.msgs.isTempMsg(r)||r.is_ephemeral)return false;if(TS.utility.msgs.isMsgReply(r))return false;if(TS.ims.isImWithDeletedMember(t))return false;if(!n)if(t.is_channel&&!t.is_member)return false;return true},getMessage:function e(t,r){var n=TS.utility.msgs.getMsg(r,t.msgs)||TS.utility.msgs.getMsg(r,t._archive_msgs);if(n)return n;if(TS.ui.replies)return TS.ui.replies.getActiveMessage(t,r);return null},getThread:function t(r,n,i){if(!i){var a=c(r,n);if(a){if(m(r,n))f(r,n,a);return Promise.resolve(a)}}var s={channel:r,thread_ts:n};var o={D:"im.replies",C:"channels.replies",G:"groups.replies"};var l=r[0];var u=o[l];if(!u){TS.error("Unable to get thread for message in unsupported model object type with ID"+r);return Promise.reject(new Error("missing api endpoint"))}var d=p(r,n);if(e[d])return e[d];if(TS.has_pri[T])if(i)TS.log(T,"Calling "+u+" for "+n+" because always_make_api_call");else TS.log(T,"Calling "+u+" for "+n+" because local history is incomplete");e[d]=TS.api.call(u,s).then(function(e){var t=e.data.messages.map(function(e){return TS.utility.msgs.processImsgFromHistory(e,r)});h(r,t);var i=TS.shared.getModelObById(r);if(i&&i.msgs&&i.msgs.length){var a=_.filter(i.msgs,function(e){return e.thread_ts===n&&TS.utility.msgs.isTempMsg(e)});if(a.length)t=_.sortBy(t.concat(a),"ts")}g(i,t);return t}).finally(function(){delete e[d]});return e[d]},getThreadLazy:function r(n,i,s,o){if(!o){var l=c(n,i);if(l){if(m(n,i))f(n,i,l,s);var u=_.find(l,{ts:i});return Promise.resolve({root_msg:u,messages:l,has_more_beginning:false,has_more_end:false})}}var d=TS.shared.getModelObById(n);var h=a(d);if(TS.has_pri[T])if(o)TS.log(T,"Calling "+h+" for "+i+" because always_make_api_call");else TS.log(T,"Calling "+h+" for "+i+" because local history is incomplete");var g=p(n,i);if(s){if(t[g])return t[g];t[g]=TS.replies.getThreadBefore(n,i).then(function(e){e.has_more_beginning=e.has_more;e.has_more_end=false;return e}).finally(function(){delete t[g]});return t[g]}if(e[g])return e[g];e[g]=TS.replies.getThreadAfter(n,i).then(function(e){e.has_more_beginning=false;e.has_more_end=e.has_more;return e}).finally(function(){delete e[g]});return e[g]},getThreadBefore:function e(t,r,n,i){var o={channel:t,thread_ts:r,count:TS.replies.DEFAULT_HISTORY_API_LIMIT};if(n){o.latest=n;if(i)o.inclusive=i}var l=TS.shared.getModelObById(t);var u=a(l);return TS.api.call(u,o).then(function(e){var t=s(l,r,e);if(!t.has_more)t.messages.unshift(t.root_msg);return t})},getThreadAfter:function e(t,r,n,i){var o={channel:t,thread_ts:r,count:TS.replies.DEFAULT_HISTORY_API_LIMIT};var l=false;if(n){o.oldest=n;if(i)o.inclusive=i}else{l=true;o.oldest=r;o.inclusive=true}var u=TS.shared.getModelObById(t);var d=a(u);return TS.api.call(d,o).then(function(e){var t=s(u,r,e);if(l)t.messages.unshift(t.root_msg);return t})},getThreadAround:function e(t,r,n){var i=c(t,r);if(i){var a=false;if(m(t,r))f(t,r,i,a);var s=_.find(i,{ts:r});return Promise.resolve({root_msg:s,messages:i,has_more_beginning:false,has_more_end:false})}var o=TS.replies.getThreadBefore(t,r,n);var l=TS.replies.getThreadAfter(t,r,n,true);return Promise.join(o,l,function(e,t){var r=e.has_more;var n=t.has_more;var i=e.messages.concat(t.messages);if(!r)i.unshift(e.root_msg);return{has_more_beginning:r,has_more_end:n,messages:i,root_msg:e.root_msg}})},getSubscriptionState:function e(t,r){var i=p(t,r);var a=n[i];return a},promiseToGetSubscriptionState:function i(a,s){var o=p(a,s);var l=n[o];if(l)return Promise.resolve(l);var u=e[o]||t[o];if(u)return u.then(function(){return TS.replies.getSubscriptionState(a,s)});if(r[o])return r[o];r[o]=TS.api.call("subscriptions.thread.get",{channel:a,thread_ts:s}).then(function(e){var t=e.data.subscriptions;var r=_.includes(t,s);var i={model_ob_id:a,thread_ts:s,subscribed:r};n[o]=i;return i}).finally(function(){delete r[o]});return r[o]},markThread:function e(t,r,a,s){var o=p(t,r);var l=n[o];if(l&&l.last_read===a)return Promise.resolve();if(l){if(!l._pending)l._pending={};if(l._pending[a])return;l._pending[a]=true}var u=function e(){if(TS.has_pri[T])TS.log(T,"subscriptions.thread.mark "+r+" -> "+a);return TS.api.call("subscriptions.thread.mark",{channel:t,thread_ts:r,ts:a}).finally(function(){if(l&&l._pending)delete l._pending[a]})};if(TS.boot_data.feature_delay_thread_mark&&s){if(TS.has_pri[T])TS.log(T,"Queuing thread mark "+r+" -> "+a);if(i)i();i=u}else u()},updateThreadStateReceived:function e(){if(!TS.boot_data.feature_delay_thread_mark)return;if(i){i();i=null}},markAllThreads:function e(t){var r={};if(t)r.max_ts=t;return TS.api.call("subscriptions.thread.clearAll",r)},threadMarked:function e(t,r,i,a){var s=p(t,r);var o=n[s];if(o){o.last_read=i;o.unread_count=a}TS.replies.thread_marked_sig.dispatch(t,r,o)},threadSubscribed:function e(t,r,n){var i=S(t,r,true,n);TS.replies.thread_subscription_changed_sig.dispatch(t,r,i)},threadUnsubscribed:function e(t,r,n){var i=S(t,r,false,n);TS.replies.thread_subscription_changed_sig.dispatch(t,r,i)},setSubscriptionState:function e(t,r,i,a){var s=TS.shared.getModelObById(t);if(!s)return;var o=p(t,r);var l=n[o];if(l)l.subscribed=i;var u={channel:t,thread_ts:r};if(a)u.last_read=a;if(i)return TS.api.call("subscriptions.thread.add",u);var d=TS.replies.getMessage(s,r);if(d&&!d.thread_ts){u.preemptive_remove=true;TS.replies.thread_subscription_changed_sig.dispatch(t,r,l)}return TS.api.call("subscriptions.thread.remove",u)},maybeSlurpSubscriptionState:function e(t,r){return h(t,r)},updateThreadBroadcastRoots:function e(t,r){var n=t.msgs;if(!n||!n.length)return;_.forEach(n,function(e){if(e.ts===r.ts)return;if(e.thread_ts!==r.ts)return;if("thread_broadcast"!==e.subtype||!e.root)return;e.root=r;if(t.is_channel)TS.channels.message_changed_sig.dispatch(t,e);else if(t.is_im)TS.ims.message_changed_sig.dispatch(t,e);else if(t.is_group&&t.is_mpim)TS.mpims.message_changed_sig.dispatch(t,e);else if(t.is_group&&!t.is_mpim)TS.groups.message_changed_sig.dispatch(t,e)})}});var e={};var t={};var r={};var n={};var i=null;var a=function e(t){if(t.is_channel)return"channels.replies";else if(t.is_im)return"im.replies";return"groups.replies"};var s=function e(t,r,n){var i=n.data.messages.map(function(e){return TS.utility.msgs.processImsgFromHistory(e,t.id)});var a=!!n.data.has_more;h(t.id,i);if(t&&t.msgs&&t.msgs.length){var s=_.filter(t.msgs,function(e){return e.thread_ts===r&&TS.utility.msgs.isTempMsg(e)});if(s.length)i=_.sortBy(i.concat(s),"ts")}g(t,i);var o=_.find(i,{ts:r});if(o)i=_.without(i,o);return{messages:i,has_more:a,root_msg:o}};var o=function e(t){if(t)return;if(n)_(n).values().forEach(function(e){delete e.sanity_check_status})};var l=function e(t,r){var n=TS.replies.getSubscriptionState(t.id,r.ts);var i=false===_.get(n,"sanity_check_status");if(i){if(TS.has_pri[T])TS.log(T,"Clearing previous sanity check failure for "+r.ts);delete n.sanity_check_status}TS.replies.reply_changed_sig.dispatch(t,r)};var u=function e(t,r){TS.replies.reply_deleted_sig.dispatch(t,r)};var d=function e(t,r){l(t,r)};var c=function e(t,r){var n=TS.shared.getModelObById(t);if(!n)return;if(n.is_channel&&!n.is_member)return;var i=TS.replies.getSubscriptionState(t,r);var a=false===_.get(i,"sanity_check_status");if(a){if(TS.has_pri[T])TS.log(T,"Sanity check for "+r+" failed earlier, not using local messages");return}var s;var o;if(!o){s=n.msgs;o=TS.utility.msgs.getMsg(r,s)}if(!o){s=n._archive_msgs;o=TS.utility.msgs.getMsg(r,s)}if(!o)return;var l=s.filter(function(e){return e.ts==r||e.thread_ts==r});var u=l.filter(function(e){return!e.is_ephemeral&&!TS.utility.msgs.isTempMsg(e)});var d=o.reply_count||0;if(u.length<d+1)return;return _.sortBy(l,"ts")};var m=function e(t,r){if(!TS.redux.socket.isConnected()||TS.api.isPaused())return false;var n=TS.replies.getSubscriptionState(t,r);var i=_.get(n,"sanity_check_status",false);if(i){if(TS.has_pri[T])TS.log(T,"Skipping sanity check for "+r+" because it passed previously");return false}return true};var f=function e(t,r,n,i){n=n.filter(function(e){return!e.is_ephemeral&&!TS.utility.msgs.isTempMsg(e)});var a=true;TS.replies.getThreadLazy(t,r,i,a).then(function(e){var i=e.messages;if(e.has_more_beginning)n=_.takeRight(n,i.length);else if(e.has_more_end)n=_.take(n,i.length);var a=_.map(n,"ts");var s=_.map(i,"ts");var o=_.map(n,"text");var l=_.map(n,"text");var u=TS.replies.getSubscriptionState(t,r);if(_.isEqual(a,s)&&_.isEqual(o,l)){if(TS.has_pri[T])TS.log(T,"Replies sanity check passed for "+r);if(u)u.sanity_check_status=true;return}var d=_.intersection(a,s);var c=_.difference(s,d);var m=_.difference(a,d);if(0==m.length&&c.length>0){var f=_(i).filter(function(e){return"tombstone"===e.subtype}).map("ts").value();var p=_.isEqual(c.sort(),f.sort());if(p){if(TS.has_pri[T])TS.log(T,"Replies sanity check passed (except tombstones) for "+r);TS.metrics.count("replies_sanity_check_passed_except_tombstones");return}}if(m.length>0&&0==c.length){var h=_.max(s);var g=_.every(m,function(e){return e>h});if(g){if(TS.has_pri[T])TS.log(T,"Replies sanity check passed (except newer local msgs) for "+r);TS.metrics.count("replies_sanity_check_passed_except_newer_local_msgs");return}}var S={version_ts:TS.boot_data.version_ts,channel_id:t,thread_ts:r,messages_from_api:s,messages_from_model_ob:a};TS.warn("Replies sanity check failed. Here's the debug info: "+JSON.stringify(S));TS.metrics.count("replies_sanity_check_failed");if(u)u.sanity_check_status=false;var v=TS.shared.getModelObById(t);if(!v)return;var b=TS.replies.getMessage(v,r);if(!b)return;TS.replies.sanity_check_failed_sig.dispatch(v,b,i,e.has_more_beginning,e.has_more_end);return null});return null};var p=function e(t,r){return t+"_"+r};var h=function e(t,r){r.forEach(function(e){if(!e.hasOwnProperty("_subscribed"))return;var r=p(t,e.ts);if(n[r]&&n[r].last_read){if(e._last_read&&e._last_read>n[r].last_read)n[r].last_read=e._last_read}else n[r]={model_ob_id:t,thread_ts:e.ts,subscribed:e._subscribed,last_read:e._last_read,unread_count:e._unread_count}})};var g=function e(t,r){if(!t||!t.msgs||!TS.useReactMessages()&&!t.msgs.length||!r||!r.length)return;var n=_.find(r,TS.utility.msgs.msgHasReplies);if(!n||n.ts!==n.thread_ts)return;if(!TS.useReactMessages()&&!TS.utility.msgs.getMsg(n.ts,t.msgs))return;var i=_.differenceBy(r,t.msgs,"ts");if(!i.length)return;var a=t.msgs.concat(i);TS.utility.msgs.setMsgs(t,a)};var S=function e(t,r,i,a){var s=p(t,r);var o=n[s];if(o)o.subscribed=i;else{o={subscribed:i,model_ob_id:t,thread_ts:r};n[s]=o}if(a.last_read)o.last_read=a.last_read;if(a.unread_count)o.unread_count=a.unread_count;return o};var T=2004})()},4841:function(e,t){(function(){TS.registerModule("ui.thread",{expanded_threads:{},buildThreadHTML:function e(r,n){try{var i=r.model_ob;var a=r.root_msg;var u=r.replies;var d=[];if(r.max_visible_ts){var c=_.takeWhile(u,function(e){return e.ts<=r.max_visible_ts});d=_.drop(u,c.length);u=c}var m="thread_"+i.id+"_"+r.ts.replace(".","_");var f;if(i.is_im)f=TS.members.getMemberById(i.user);var p=TS.replies.getSubscriptionState(i.id,a.thread_ts);var h=p&&p.subscribed;var g=s(r);var S;var T;if(g>=TS.replies.DEFAULT_HISTORY_API_LIMIT){S=o(r);T=l(r)}var v=TS.templates.thread({id:m,ts:r.ts,model_ob:i,thread:r,root_msg:a,conversation_permalink:TS.utility.msgs.constructConversationPermalink(i,a.ts),channel_msg_permalink:TS.utility.msgs.constructMsgPermalink(i,a.ts),replies:u,new_replies:d,new_replies_count:t(d.length),im_user:f,is_subscribed:h,options:n||{},view_previous_count:g,visible_reply_count:S,total_reply_count:T});return v}catch(e){TS.error("Threads view: error rendering thread");TS.console.logError(e,"threads_view_error");return""}},updateThreadWithMessage:function e(t,s,o,l){var u=t.find('ts-message[data-ts="'+o.ts+'"]');var d;var _={};var c=t.attr("data-context");if("inline"===c)_.inline=true;d=TS.templates.builders.buildThreadMsgHTML(o,s.model_ob,s,_);var m=$(d);if(u.length){if(u.hasClass("hidden"))m.addClass("hidden");u.replaceWith(m)}else if(l){var f=t.find(".thread_replies_container");var p=t.find(".new_replies_container ts-message");f.append(p).append(m);r(t,false)}else{t.find(".new_replies_container").append(m);n(s,t)}if(!TS.utility.msgs.isMsgReply(o)){a(s,t,o);i(s,t,o)}else if(o.is_ephemeral)i(s,t,o);TS.attachment_actions.select.decorateNewElements(t);g(s,t)},removeMessageFromThread:function e(t,r,a){var s=$("#"+TS.templates.makeMsgDomIdInThreadsView(a.ts));if(!s.length)return;if(a.is_pending)s.remove();else s.addClass("delete_mode").slideUp(200,function(){s.remove()});n(r,t);g(r,t);if(a.is_ephemeral)i(r,t)},revealNewReplies:function e(t,n){return new Promise(function(e){var s=t.find(".new_reply_indicator");var o=t.find(".thread_replies_container");var l=t.find(".new_replies_container");s.animate({height:0},150,function(){r(t,false);s.css("height","");var n=o.height();o.height(n);o.css("overflow","hidden");var i=l.find("ts-message");i.appendTo(o);o.css("height","auto");var a=o.height();o.height(n).animate({height:a},300,function(){l.css("height","");o.css("height","");o.css("overflow","");e()})});a(n,t,n.root_msg);i(n,t)})},revealPreviousReplies:function e(t,r,n){var o={};var l=t.attr("data-context");if("inline"===l)o.inline=true;return new Promise(function(e,l){n.then(function(){var n=s(r);var l=t.find(".view_all_replies_container");var u=function s(){if(n){TS.ui.thread.hideThreadLoadingSpinner(t);a(r,t,r.root_msg)}else l.remove();i(r,t);var u=t.find(".thread_replies_container");var d=u.find("ts-message:first");var c=$("<div></div>");if(d.length)d.before(c);else u.append(c);var m=_.takeWhile(r.replies,function(e){return e.ts<r.min_visible_ts});_.forEach(m,function(e){c.append(TS.templates.builders.buildThreadMsgHTML(e,r.model_ob,r,o))});TS.attachment_actions.select.decorateNewElements(t);var f=c.height();c.height(0).animate({height:f},300,function(){var t=c.find("ts-message");if(d.length)t.insertBefore(d);else t.appendTo(u);c.remove();e()})};if(l.length&&!n)l.animate({height:0},150,u);else u()},function(){p(t);l()})})},renderReplyInput:function e(t,r){var n=r.model_ob;var i=r.root_msg.ts;var a=t.find(".reply_input_container");a.empty();var s=TS.permissions.members.canPostInModelOb(TS.model.user,n);if(TS.boot_data.feature_default_shared_channels&&!s)s=TS.permissions.members.canThread(n);if(!s||n.is_archived){c(n,a);return}if(!TS.replies.canReplyToMsg(n,r.root_msg)){if(n.is_channel&&!n.is_member)m(n,a);else t.addClass("no_reply_container");return}TS.ui.inline_msg_input.make(a,{placeholder:TS.i18n.t("Reply...","threads")(),complete_member_specials:TS.boot_data.feature_threads_api_stop_fe?false:["BKhere"],complete_cmds:true,in_thread:true,model_ob:n,jumbomoji:TS.prefs.getPref("jumbomoji"),onSubmit:function e(s,o){if(!TS.redux.socket.isConnected())return;if(n.is_archived){TS.generic_dialog.alert(TS.i18n.t("This channel has been archived; you cannot send messages to it.","threads")());return}var l=_.last(r.replies);if(r.max_visible_ts)l=_.findLast(r.replies,function(e){return e.ts<=r.max_visible_ts});var d=TS.client.ui.maybeHandleReactionCmd(l,o,function(){u(a,n,i)});if(d)return;if(TS.utility.msgs.shouldSendSlashCommand(o)){u(a,n,i);TS.client.ui.sendSlashCommand(n,o,r.root_msg)}else{TS.utility.msgs.removeAllEphemeralMsgsByType("threads_temp_slash_cmd_feedback",n.id,i);var c=a.find(".reply_broadcast_toggle").prop("checked");u(a,n,i);var m=TS.ui.thread.getContextForEl(t);var f=c?"THREADS_REPLY_BROADCAST_CLICKED":"THREADS_REPLY";var p=_.get(r,".root_msg.reply_count",0)+1;TS.ui.thread.trackEvent(n.id,r.root_msg.ts,m,f,{num_msg_in_thread:p});if(c)TS.log(2004,"Submitting broadcast from threads view for "+n.id+"-"+r.root_msg.ts);TS.utility.contenteditable.clogMentionCounts(o);TS.client.ui.sendMessage(n,o,r.root_msg,c)}return null},getMsgDivForEditing:function e(){var n=t.closest("ts-thread");var i=r.replies;var a=_.reject(i,function(e){return"tombstone"===e.subtype});if("tombstone"!==r.root_msg.subtype)a.unshift(r.root_msg);_.reverse(a);var s=TS.utility.msgs.getEditableMsgByProp("user",TS.model.user.id,a);if(!s)return null;return n.find('ts-message[data-ts="'+s.ts+'"]')},onTextChange:function e(t){var r=TS.utility.contenteditable.value(t);var s=!r.trim();var o=s?"":r;TS.storage.storeReplyInput(n.id,i,o);f(a)}});var o=a.find(".message_input");o.on("focusin",function(){a.addClass("has_focus")}).on("focusout",function(){var e=TS.utility.contenteditable.isEmpty(o,true);var t=document.activeElement===this;if(e&&!t)a.removeClass("has_focus")});d(n,i,a);var l=TS.storage.fetchReplyInput(n.id,i);if(l){TS.utility.populateInput(o,l);a.addClass("has_focus")}},joinChannelFromThread:function e(t,r){var n=r.closest("ts-thread");if(!n.length)return;var i=n.data("model-ob-id");var a=TS.shared.getModelObById(i);if(!a)return;TS.channels.joinById(a.id,null,{in_background:true});n.find(".join_channel_from_thread").addClass("disabled")},submitReply:function e(t,r){if(!r||0===r.length)return;var n=r.closest(".reply_input_container").find("form");if(0===n.length)return;n.submit()},findAndPopulateInput:function e(t,r,n){if(!r||!n)return;var i='ts-thread[data-model-ob-id="'+r+'"][data-thread-ts="'+n+'"]';var a=$(i).find(".message_input");TS.utility.populateInput(a,t);TS.storage.storeReplyInput(r,n,t)},showThreadLoadingSpinner:function e(t){if(!TS.model.threads_view_is_showing)return;if(!t||!t.length)return;var r=t.find(".view_all_loading_container");r.html(TS.templates.infinite_spinner({size:"small"}))},hideThreadLoadingSpinner:function e(t){if(!TS.model.threads_view_is_showing)return;if(!t||!t.length)return;var r=t.find(".view_all_loading_container");r.empty()},startInlineThread:function t(r,n){e(r.id,n.ts,true);TS.view.rebuildMsg(n)},expandInlineThread:function t(r){var n=r.attr("data-model-ob-id");var i=r.attr("data-thread-ts");var a=TS.shared.getModelObById(n);if(!a)return;var s=TS.utility.msgs.getMsg(i,a.msgs);if(!s)return;var o={model_ob:a,root_msg:s,replies:[],ts:s.ts};TS.ui.utility.preventElementFromScrolling(r.find(".message_content"),function(){r.addClass("expanded")});TS.ui.thread.renderReplyInput(r,o);var l=TS.replies.getThread(n,i).then(function(e){var t=Infinity;if(o.replies&&o.replies.length)t=_.first(o.replies).ts;o.min_visible_ts=t;var r=_.filter(e,function(e){return e.ts!==s.ts});o.replies=r});TS.ui.thread.revealPreviousReplies(r,o,l);e(n,i,true);return null},collapseInlineThread:function t(r){var n=r.attr("data-model-ob-id");var i=r.attr("data-thread-ts");var a=TS.shared.getModelObById(n);if(!a)return;var s=TS.utility.msgs.getMsg(i,a.msgs);if(!s)return;if(!TS.utility.msgs.msgHasReplies(s)){e(n,i,false);TS.view.rebuildMsg(s);return}var o=r.find(".thread_replies_container");o.animate({height:0},300,function(){o.css("height","");o.find("ts-message").remove();TS.ui.utility.preventElementFromScrolling(r.find(".message_content"),function(){r.removeClass("expanded")})});r.find(".reply_input_container").html(TS.templates.thread_inline_input_placeholder({model_ob:a,root_msg:s,conversation_permalink:TS.utility.msgs.constructConversationPermalink(a,s.ts),num_total_threads:s.reply_count}));e(n,i,false)},isThreadExpanded:function e(t,r){return!!TS.ui.thread.expanded_threads[t+r]},isMessageBeingConvertedToThread:function e(t,r){return!TS.utility.msgs.msgHasReplies(r)&&!TS.utility.msgs.isMsgReply(r)&&TS.ui.thread.isThreadExpanded(t,r.ts)},makeInlineThread:function e(t,r){var n=TS.shared.getModelObById(t);if(!n)return null;var i=TS.utility.msgs.getMsg(r,n.msgs);if(!i)return null;var a={model_ob:n,root_msg:i,replies:[],ts:i.ts};if(TS.ui.thread.isThreadExpanded(t,r)){var s=_.filter(n.msgs,function(e){return e.ts!==r&&e.thread_ts===r});a.replies=s}return a},trackEvent:function e(t,r,n,i,a){if(!t||!r||!n){TS.error("error collecting clog data for threads");return}var s=h(t,r,n,a);if("threads_view"===n)TS.client.ui.threads.incrementTrackingSeqId();TS.clog.track(i,s)},getTrackingPayloadForEl:function e(t,r){var n={};var i=TS.ui.thread.getContextForEl(t);if("threads_view"!==i&&"convo"!==i)return n;var a=t.closest("ts-thread, ts-conversation");if(!a.length)return n;var s=a.attr("data-model-ob-id");var o=a.attr("data-thread-ts");if(!s||!o)return n;return h(s,o,i,r)},getContextForEl:function e(t){if(t.closest("#threads_msgs").length>0)return"threads_view";else if(t.closest("#convo_tab").length>0)return"convo";else if(t.closest("#msgs_scroller_div").length>0)return"message_pane";else if(t.closest("#unread_msgs_scroller_div").length>0)return"unreads_view";return"other"}});var e=function e(t,r,n){TS.ui.thread.expanded_threads[t+r]=n};var t=function e(t){return TS.i18n.t("{reply_count,plural,=1{{reply_count} new reply}other{{reply_count} new replies}}","threads")({reply_count:t})};var r=function e(t,r){var n=t.find(".thread_messages");var i="show_new_reply_indicator";if(r)n.addClass(i);else n.removeClass(i)};var n=function e(n,i){if(!n||!i||!i.length)return;var a=_.reduce(n.replies,function(e,t){if(t.ts>n.max_visible_ts)e+=1;return e},0);var s=i.find(".new_reply_indicator");var o=s.find(".reveal_new_replies");if(a<=0){r(i,false);o.empty();return}var l=t(a);o.text(l);r(i,true)};var i=function e(t,r){if(!t||!r||!r.length)return;var n=r.find(".visible_reply_count");if(s(t)>=TS.replies.DEFAULT_HISTORY_API_LIMIT){var i=o(t);var a=l(t);var u=TS.i18n.t("{visible_reply_count} of {total_reply_count}","threads")({visible_reply_count:i,total_reply_count:a});n.text(u)}else n.text("")};var a=function e(t,r,n){if(!r||!r.length||!n)return;if(TS.boot_data.feature_threads_perf&&!n.reply_count)return;else if(!n.replies)return;var i=r.find(".view_all_replies_container");if(!i.length)return;var a=i.find(".view_all_replies");var o=s(t);if(!o){i.addClass("hidden");return}var l=TS.i18n.t("View {reply_count,plural,=1{{reply_count} previous reply}other{{reply_count} previous replies}}","threads")({reply_count:o});a.text(l)};var s=function e(t){var r=t.root_msg.reply_count;var n=t.replies;if(n&&n.length){var i=_.filter(n,function(e){return!e.is_ephemeral&&!TS.utility.msgs.isTempMsg(e)}).length;r=t.root_msg.reply_count-i;r=Math.min(TS.replies.DEFAULT_HISTORY_API_LIMIT,r)}if(r<0){TS.error("Ignoring negative previous reply count for "+t.ts);return 0}return r};var o=function e(t){var r;if(t.max_visible_ts)r=_.reduce(t.replies,function(e,r){if(r.ts<=t.max_visible_ts)e+=1;return e},0);else r=_.get(t,".replies",[]).length;return r};var l=function e(t){var r=_.filter(t.replies,function(e){return e.is_ephemeral||TS.utility.msgs.isTempMsg(e)}).length;var n;if(TS.boot_data.feature_threads_perf)n=_.get(t,"root_msg.reply_count",0)+r;else n=_.get(t,"root_msg.replies.length",0)+r;return n};var u=function e(t,r,n){var i=t.find(".message_input");TS.utility.populateInput(i,"",0);TS.utility.contenteditable.clearHistory($("#reply_container .message_input"));TS.storage.storeReplyInput(r.id,n,"");t.find(".reply_broadcast_toggle").attr("checked",false)};var d=function e(t,r,n){if(!t||!r||!n||0===n.length)return;var i=TS.permissions.members.canPostInChannel(t);n.append(TS.templates.reply_broadcast_buttons({model_ob:t,label_id:r,view:"threads",can_post_back_to_channel:i}));var a=n.find(".reply_broadcast_label_container, .reply_send");var s=n.find(".message_input");a.mousedown(function(e){e.preventDefault();TS.utility.contenteditable.focus(s)}).click(function(){TS.utility.contenteditable.focus(s)})};var c=function e(t,r){r.html(TS.templates.reply_limited({channel_name:TS.shared.getDisplayNameForModelOb(t),is_archived:t.is_archived}))};var m=function e(t,r){r.html(TS.templates.join_channel_from_thread({model_ob_name:t.name,is_threads_view:true}))};var f=function e(t){var r=t.find(".message_input");var n=!!TS.msg_edit.isMessageTooLong(r);t.find(".reply_container_info").toggleClass("hidden",n)};var p=function e(t){if(!TS.model.threads_view_is_showing)return;if(!t||!t.length)return;var r=t.find(".view_all_replies_container");var n=r.find(".view_all_loading_container");var i=r.find(".view_all_error_msg");var a=r.find(".view_all_replies");n.empty();i.removeClass("hidden");var s=TS.i18n.t("Try Again","threads")();a.removeClass("active").text(s)};var h=function e(t,r,n,i){if(!t||!r||!n){TS.error("error collecting clog data for threads");return}var a={parent_message_id:r,channel_id:t,is_threads_view:"threads_view"===n?1:0,is_flexpane:"convo"===n?1:0};if("threads_view"===n)_.merge(a,TS.client.ui.threads.getTrackingData());if(i)a=_.merge(a,i);return a};var g=function e(t,r){var n=TS.templates.builders.buildThreadParticipantListHTML(t.root_msg);r.find(".thread_participants").html(n)}})()},4842:function(e,t){var r="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};(function(){TS.registerModule("utility.money",{formatMoney:function e(r,a,o){var l={all_digits:false};o=_.defaults(o,l);var u=o.all_digits;if(!a){TS.error("cannot format money: no currency_code specified");return""}r=r?parseInt(r,10):0;var d;if(t){if("JPY"===a)d=r;else d=r/100;var c=r%100!==0;var m=!u&&!c;var f=s(n,a,m);var p;if(i[f])p=i[f];else if(m){p=new Intl.NumberFormat(n,{style:"currency",currency:a,maximumFractionDigits:0,minimumFractionDigits:0});i[f]=p}else{p=new Intl.NumberFormat(n,{style:"currency",currency:a});i[f]=p}return p.format(d)}return TS.utility.money.formatMoneyWithoutIntl(r,a,o)},formatMoneyWithoutIntl:function t(r,i,a){var s=/^[-]*[0-9]+\.?[0-9]*$/;var o=/\B(?=(\d{3})+(?!\d))/g;var l={all_digits:false};a=_.defaults(a,l);var u=a.all_digits;if(!i){TS.error("cannot format money: no currency_code specified");return""}r=r?parseInt(r,10):0;var d=TS.i18n.locales_number_formatting.default;var c=TS.i18n.locales_number_formatting[n]?TS.i18n.locales_number_formatting[n].decimal_symbol:d.decimal_symbol;var m=TS.i18n.locales_number_formatting[i]?TS.i18n.locales_number_formatting[n].thousands_separator:d.thousands_separator;var f=e[i]?e[i].currency_symbol:i;if(!s.test(r)){TS.warn("Incorrect input passed as parameter: amount should only contain numbers");return r}var p="";var h="";var g;var S="";var T=r<0;if(T){p="-";r=Math.abs(r)}if("JPY"===i)h=r.toString();else{g=r%100!==0;h=r/100;if(!u)h=g?h.toFixed(2).replace(".",c):h.toFixed(0);else h=h.toFixed(2).replace(".",c)}h=h.replace(o,m);switch(n){case"en-US":S=p+f+h;break;case"es-ES":case"fr-FR":case"de-DE":S=p+h+" "+f;break;case"ja-JP":S=p+f+h;break;default:S=p+f+h}return S},test:function r(){var o={isInString:a,currencies:e,locales_number_formatting:TS.i18n.locales_number_formatting,locale:n,number_format_cache:i,getNumFormatKey:s,has_Intl:t};Object.defineProperty(o,"isInString",{get:function e(){return a},set:function e(t){a=t}});Object.defineProperty(o,"currencies",{get:function t(){return e},set:function t(r){e=r}});Object.defineProperty(o,"locales_number_formatting",{get:function e(){return TS.i18n.locales_number_formatting},set:function e(t){TS.i18n.locales_number_formatting=t}});Object.defineProperty(o,"locale",{get:function e(){return"_locale"},set:function e(t){n=t}});Object.defineProperty(o,"number_format_cache",{get:function e(){return i},set:function e(t){i=t}});Object.defineProperty(o,"getNumFormatKey",{get:function e(){return s},set:function e(t){s=t}});Object.defineProperty(o,"has_Intl",{get:function e(){return t},set:function e(r){t=r}});return o}});var e={default:{currency_symbol:"$"},USD:{currency_symbol:"$"},GBP:{currency_symbol:"£"},EUR:{currency_symbol:"€"},JPY:{currency_symbol:"¥"}};var t=window.Intl&&"object"===r(window.Intl);var n=TS.i18n.locale()||"en-US";var i={};var a=function e(t,r){if(_.isEmpty(t)||_.isEmpty(r))return false;return t.indexOf(r)>=0};var s=function e(t,r,n){var i=n?"cents":"nocents";return t+"_"+r+"_"+i}})()},4843:function(e,t){(function(){TS.registerModule("ui.react_emoji_menu",{is_showing:false,onStart:function e(){TS.prefs.emoji_mode_changed_sig.add(C);TS.prefs.preferred_skin_tone_changed_sig.add(M)},start:function e(t){m(t)}});var e=15;var t=0;var r=-6;var n="top-left";var i="reactroot_emoji_picker";var a;var s;var o="#msg_input";var l;var u;var d;var c;var m=function e(t){l=t.rxn_key;if(l){g();u=function e(r){var n=!TS.rxns.doesRxnsHaveRxnFromUser(TS.rxns.getExistingRxnsByKey(t.rxn_key),r);TS.rxns.changeRxnsFromUserAction(t.rxn_key,r,n);if(t.callback)t.callback()}}else u=t.callback;o=!l&&(t.input_to_fill||o);if(TS.client&&TS.utility.contenteditable.isDisabled(o))return;var r=t.position;var n=TS.client&&o===TS.client.ui.$msg_input;var i=_.get(TS,"model.ui_state.flex_visible");if(n&&i)r="top-right";s=$(t.e&&t.e.target);h({open:true,is_rxn:!!l});TS.tips.hideAll();if(TS.boot_data.feature_react_emoji_picker_frecency)TS.emoji.replaceFrecentlyUsed();d=t.target_bounds||s.dimensions_rect();var a=window.pageYOffset;d.top+=a;d.bottom+=a;TS.ui.react_emoji_menu.is_showing=true;var c={};var m={position:r,offset_x:t.offset_x,offset_y:t.offset_y};p(c,m);if(TS.model.is_our_app&&TSSSB.nodrag.getIsRequired())if(_.get(window,"desktop.app.updateDragRegion"))window.desktop.app.updateDragRegion([])};var f=function e(){h({open:false,is_rxn:!!l});s=null;o="#msg_input";l=null;u=null;c=null;TS.tips.unhideAll();TS.ui.react_emoji_menu.is_showing=false;p();if(TS.model.is_our_app&&TSSSB.nodrag.getIsRequired())TS.client.channel_header.calculateNoDragRegions()};var p=function e(t,r){var n=b(t);var i=y(r);TS.metrics.mark("react_emoji_menu_render_mark");if(!a)a=I();TS.interop.mountEmojiPicker(TS.boot_data.team_id,a,n,i)};var h=function e(t){if(t.is_rxn){s.closest(".menu_rxn").toggleClass("active",t.open);s.closest(".rxn_panel").toggleClass("active",t.open);s.closest("ts-message").toggleClass("active",t.open);s.toggleClass("active",t.open)}else{s.closest(".emo_menu").toggleClass("active",t.open);s.closest(".handy_rxns_row").toggleClass("active",t.open);s.closest(".current_status_emoji_picker").toggleClass("active",t.open)}};var g=function e(t){var r=TS.rxns.getHandyRxnsDisplayDataByRxnKey(t);c=_.map(r.items,function(e){return e.name})};var S=function e(){if("google"===TS.prefs.getPref("emoji_mode"))return[];return[":hand:",":hand::skin-tone-2:",":hand::skin-tone-3:",":hand::skin-tone-4:",":hand::skin-tone-5:",":hand::skin-tone-6:"]};var T=function e(t,r){var n=$(o);var i=r.display_name||r.name;var a=!(t&&t.shiftKey);if(TS.utility.contenteditable.isContenteditable(n))if(TS.utility.contenteditable.inlineEmojiIsEnabled())setTimeout(TS.utility.contenteditable.insertContentsAtCursor,0,n,TS.format.texty.convertContentsStringToContents(r.name),a);else setTimeout(TS.utility.contenteditable.insertTextAtCursor,0,n,i,a);else{var s=TS.utility.contenteditable.cursorPosition(n).start;var l=s+i.length;var u=TS.utility.contenteditable.value(n);var d=u.substr(0,s)+i+u.substr(s);TS.utility.populateInput(n,d);if(a)setTimeout(TS.utility.contenteditable.cursorPosition,0,o,l)}};var v=function e(t,r){var n=_.find(TS.model.emoji_map,{name_with_colons:TS.emoji.stripLocalizedSkinTone(t.name)});if(r)r=r.replace(/^:/,"");if(n)TS.ui.frecency.record(n,r)};var b=function e(t){t=t||{};var r={onSkinToneChanged:x,groups:TS.model.emoji_groups,skinToneChoiceNames:S(),activeSkinToneId:t.skin_tone_id||TS.prefs.getPref("preferred_skin_tone"),numBackgroundColors:TS.model.emoji_menu_colors,onSelected:w,onClosed:k,canAddEmoji:!TS.model.user.is_restricted&&(!TS.prefs.getTeamPref("emoji_only_admins")||TS.model.user.is_admin),emojiMap:TS.model.emoji_map,skinToneModifier:TS.emoji.getChosenSkinToneModifier(!!TS.boot_data.feature_localization)};if(l)r.handyRxnNames=c;return r};var y=function i(a){a=a||{};return{targetBounds:d,allowanceX:e,allowanceY:e,position:a.position||n,offsetX:!_.isUndefined(a.offset_x)?a.offset_x:t,offsetY:!_.isUndefined(a.offset_y)?a.offset_y:r,isOpen:TS.ui.react_emoji_menu.is_showing,onClose:k}};var w=function e(t,r,n){v(r,n);if(u){setTimeout(u,0,r.name);return}if(!o)return TS.error("Could not find an _input_to_fill.");T(t,r)};var k=function e(){f()};var x=function e(t){TS.prefs.onPrefChanged({name:"preferred_skin_tone",value:t});TS.prefs.setPrefByAPI({name:"preferred_skin_tone",value:t});if(l)g(l);if(TS.boot_data.feature_react_emoji_picker_frecency)TS.emoji.replaceFrecentlyUsed();if(TS.ui.react_emoji_menu.is_showing){var r={skin_tone_id:t};p(r)}};var C=function e(){if(TS.ui.react_emoji_menu.is_showing)_.defer(p)};var M=function e(){if(l)g(l);C()};var I=function e(){if(!document.getElementById(i)){var t=document.createElement("div");t.setAttribute("id",i);document.body.appendChild(t)}return document.getElementById(i)}})()},4844:function(e,t){(function(){var e="reactroot_menu";var t=15;var r;var n;TS.registerModule("ui.react_menu",{is_showing:false,start:function e(r){if(TS.ui.react_menu.is_showing)TS.ui.react_menu.end({skip_unmount:true});TS.ui.react_menu.is_showing=true;TS.tips.hideAll();n=r.on_end;var i=$(r.e&&r.e.target);var s=r.target_bounds||i.dimensions_rect();var o={template:r.template,onMenuItemSelected:TS.ui.react_menu.end,onTriggerClose:TS.ui.react_menu.end};var l={targetBounds:s,position:r.position,allowanceX:r.allowance_x||t,allowanceY:r.allowance_y||t,offsetX:r.offset_x,offsetY:r.offset_y,isOpen:TS.ui.react_menu.is_showing,onClose:TS.ui.react_menu.end};a(o,l)},end:function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};TS.tips.unhideAll();TS.ui.react_menu.is_showing=false;if(_.isFunction(n))n();n=void 0;var i=Promise.resolve();if(!t.skip_unmount)i.then(function(){if(r){TS.interop.unmountMenu(r);document.body.removeChild(r);r=void 0}});return i}});var i=function t(){if(!document.getElementById(e)){var r=document.createElement("div");r.setAttribute("id",e);document.body.appendChild(r)}return document.getElementById(e)};var a=function e(t,n){if(!r)r=i();TS.interop.mountMenu(TS.boot_data.team_id,r,t,n)}})()},4845:function(e,t){(function(){TS.registerModule("ui.a11y",{focus_stack:[],unread_message_strings:{},$aria_live_div:null,zoom_level_changed_sig:new signals.Signal,zoomPercentToLevel:function t(r){return e[r]},zoomLevelToPercent:function e(r){return t[r]},onStart:function e(){a();f();h();TS.channels.switched_sig.add(TS.ui.a11y.annouceCurrentChannelOrImOrGroup);TS.ims.switched_sig.add(TS.ui.a11y.annouceCurrentChannelOrImOrGroup);TS.groups.switched_sig.add(TS.ui.a11y.annouceCurrentChannelOrImOrGroup);TS.mpims.switched_sig.add(TS.ui.a11y.annouceCurrentChannelOrImOrGroup);TS.prefs.a11y_animations_changed_sig.add(TS.ui.a11y.replaceAnimatedImages);$(document).on("focus","input[placeholder],textarea[placeholder]",function(e){i($(e.target))});$(document).on("blur","input[placeholder],textarea[placeholder]",function(e){i($(e.target))})},focusOnNextMessage:function e(){var t=$(document.activeElement);var n;var i=t.is(r);if(i&&t.next().length)n=t.next();else n=o();TS.ui.a11y.focusAndAddTabindex(n)},focusOnPreviousMessage:function e(){var t=$(document.activeElement);var n;var i=l();var a=t.is(r);if(a&&t.prev().length)n=t.prev();else if(a&&TS.model.archive_view_is_showing)n=o();else if(t.is("#end_display_meta"))n=o();else if(i.children(r).length&&i.children(r).last())n=i.children(r).last();else n=o();TS.ui.a11y.focusAndAddTabindex(n)},focusOnOldestUnreadMessage:function e(){if(TS.client.ui.$msgs_unread_divider&&TS.client.ui.$msgs_unread_divider.next().length)TS.ui.a11y.focusAndAddTabindex(TS.client.ui.$msgs_unread_divider.next());else TS.ui.a11y.ariaLiveAnnounce(TS.i18n.t("No unread messages.","a11y")(),true)},focusOnMessageInput:function e(){TS.ui.a11y.focusAndAddTabindex(o())},focusAndAddTabindex:function e(t){if(!t)return;if(t.attr("tabindex"))t.data("previous-tabindex",t.attr("tabindex"));t.attr("tabindex","0");t.focus()},cleanUpTabindex:function e(t){if(!t)return;if(t.data("previous-tabindex"))t.attr("tabindex",t.data("previous-tabindex"));else t.removeAttr("tabindex")},saveCurrentFocus:function e(){TS.ui.a11y.focus_stack.push(document.activeElement);return document.activeElement},saveCurrentFocusAndFocusOnElement:function e(t){var r=TS.ui.a11y.saveCurrentFocus();TS.ui.a11y.focusAndAddTabindex(t);return r},restorePreviousFocus:function e(){var t=TS.ui.a11y.focus_stack.pop();if(t&&"function"===typeof t.focus){t.focus();return t}},restorePreviousFocusAndCleanUpElement:function e(t){var r=TS.ui.a11y.restorePreviousFocus();TS.ui.a11y.cleanUpTabindex(t);return r},ariaLiveAnnounce:function e(t,r){TS.ui.a11y.$aria_live_div.empty();TS.ui.a11y.$aria_live_div.attr("aria-live",r?"assertive":"polite");TS.ui.a11y.$aria_live_div.text(t)},assembleActiveModelName:function e(){var t=TS.shared.getActiveModelOb();var r="";if(TS.model.unread_view_is_showing)r=TS.i18n.t("All unreads","a11y")();else if(TS.model.threads_view_is_showing)r=TS.i18n.t("Threads","a11y")();else if(t.is_channel)r=TS.i18n.t("Channel #{model_name}","a11y")({model_name:t.name});else if(t.is_im)r=TS.i18n.t("Direct message with {model_name}","a11y")({model_name:TS.members.getPrefCompliantMemberNameById(t.user)});else if(t.is_mpim)r=TS.i18n.t("Direct message with {model_name}","a11y")({model_name:TS.mpims.getDisplayName(t)});else if(t.is_group)r=TS.i18n.t("Private Channel {model_name}","a11y")({model_name:t.name});return r},saveUnreadCountMessage:function e(t,r){if(!t||!t.name||!r)return;TS.ui.a11y.unread_message_strings[t.name]=r},annouceCurrentChannelOrImOrGroup:function e(){var t=TS.ui.a11y.assembleActiveModelName();var r=t;var n=TS.shared.getActiveModelOb();if(!n)return;if(TS.model.archive_view_is_showing){TS.ui.a11y.focusAndAddTabindex(o());return}if(TS.ui.a11y.unread_message_strings[n.name]){r+=", "+TS.ui.a11y.unread_message_strings[n.name];delete TS.ui.a11y.unread_message_strings[n.name]}TS.ui.a11y.ariaLiveAnnounce(r,true)},resetMessageInput:function e(){TS.client.msg_input.$input.trigger("autosize-resizeIncludeStyle");TS.client.msg_input.resized();TS.view.onResize()},replaceAnimatedImages:function e(){TS.ui.a11y.replaceAnimatedFiles();TS.ui.a11y.replaceEmoji()},replaceAnimatedFiles:function e(){var t=TS.prefs.getPref("a11y_animations");var r;var i;if(n){_();return}var a=TS.utility.msgs.getDisplayedMsgs(TS.shared.getActiveModelOb().msgs);var s;if(false===t){for(s=0;s<a.length;s+=1)if(a[s].file){r=a[s].file;if("gif"===r.filetype){if(r.deanimate_gif)i=r.deanimate_gif;else if(r.thumb_160)i=r.thumb_160;if(i)u(r.id,i)}else if("space"===r.filetype)_(a[s].ts)}else if(a[s].attachments)d(a[s].ts,a[s].attachments[0])}else for(s=0;s<a.length;s+=1)if(a[s].file){r=a[s].file;if("gif"===r.filetype){if(r.thumb_360_gif)i=r.thumb_360_gif;else if(r.thumb_360)i=r.thumb_360;if(i)u(r.id,i)}else if("space"===r.filetype)_(a[s].ts)}else if(a[s].attachments)d(a[s].ts,a[s].attachments[0])},replaceEmoji:function e(){var t=emoji;var r=$(".emoji:not(.stop_animations)");var n;for(var i=0;i<r.length;i+=1){var a=t.replace_colons(r[i].innerText);if(!a){var s=":"+r[i].parentNode.getAttribute("data-emoji")+":";a=t.replace_colons(s)}if(a)if(a.match(/.+background-image:url\((.+)\).*/))n=a.match(/.+background-image:url\((.+)\).*/)[1];r[i].style.backgroundImage='url("'+n+'")'}TS.emoji.makeMenuLists()},getContrastColor:function e(t){var r=false;t=t.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(e,t,r,n){return t+t+r+r+n+n});t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);if(t){var n=parseInt(t[1],16);var i=parseInt(t[2],16);var a=parseInt(t[3],16);var s=(299*n+587*i+114*a)/1e3;r=s>=128?"#000000":"#FFFFFF"}return r},test:function e(){return{createAriaLiveElement:a,destroyAriaLiveElement:s,getMessageInputElement:o,getMessageDivElement:l}}});var e={70:"-3",80:"-2",90:"-1",normal:"0",110:"1",125:"2",150:"3"};var t=Object.keys(e).reduce(function(t,r){t[e[r]]=r;return t},{});var r=".message, .day_divider, .unread_divider";var n=TS.web&&TS.web.space;var i=function e(t){var r=t.attr("placeholder");var n=t.attr("aria-label")||"";var i=!!n.length;var a=!!t.val().trim().length;if(a&&!i&&r.length){t.attr("aria-label",r);return}if(!a&&i&&n==r)t.removeAttr("aria-label")};var a=function e(){TS.ui.a11y.$aria_live_div=$('<div id="aria_live_announcer" role="status"></div>');$("body").append(TS.ui.a11y.$aria_live_div);return TS.ui.a11y.$aria_live_div};var s=function e(){TS.ui.a11y.$aria_live_div.remove();delete TS.ui.a11y.$aria_live_div};var o=function e(){return TS.model.archive_view_is_showing&&TS.client.archives.not_member?$("#footer_archives"):TS.client.ui.$msg_input};var l=function e(){return TS.model.archive_view_is_showing?TS.client.archives.$archives_msgs_div:TS.client.ui.$msgs_div};var u=function e(t,r){var n=$('.image_gif[data-file-id="'+t+'"]');n.attr("data-src",r);n.find(".image_bg").attr("data-real-background-image",r);n.find(".image_bg").css("backgroundImage","url("+r+")");n.find("img").data("real-src",r);n.find("img").attr("src",r)};var d=function e(t,r){if(!r)return;if(r.is_animated||r.image_url&&r.image_url.match(/\.gifv?$/)){var n=$('.message[data-ts="'+t+'"]');var i=n.find(".msg_inline_img img");var a=false===TS.prefs.getPref("a11y_animations")?TS.utility.getImgProxyURL(r.image_url,r.image_width,r.image_height):r.image_url;c(i,a)}};var _=function e(t){var r=n?$("ts-space .msg_inline_img img"):$('.message[data-ts="'+t+'"] .post_container .msg_inline_img img');$.each(r,function(){var e=$(this);var t=TS.utility.getImgProxyURL(e.attr("src"));c(e,t)})};var c=function e(t,r){t.attr({"data-real-src":r,src:r});var n=t.closest(".msg_inline_img");n.attr("data-real-background-image",r);n.css("backgroundImage","url("+r+")")};var m;var f=function e(){if(!TSSSB.supports_zoom_api)return;m=TSSSB.call("getZoom");$(window).on("resize",p)};var p=function e(){var t=TSSSB.call("getZoom");if(m!=t){m=t;TS.ui.a11y.zoom_level_changed_sig.dispatch({zoom_level:t})}};var h=function e(){if(!TSSSB.supports_zoom_api)return;$("body").append('<div class="zoom_level_indicator hidden"></div>');TS.ui.a11y.zoom_level_changed_sig.add(T)};var g=function e(r){var n=t[r]||"100";var i="normal"===n?"100":n;var a=TS.i18n.t("zoom: <strong>{zoom_percentage}%</strong>","a11y")({zoom_percentage:i});$(".zoom_level_indicator").html(a)};var S;var T=function e(t){if(TS._incremental_boot||$("body").hasClass("loading"))return;var r=$(".prefs_modal.active");if(r.length&&r.find(".a11y_pref_zoom").length)return;if(S){clearTimeout(S);S=null}g(t.zoom_level);var n=$(".zoom_level_indicator");n.insertAfter(document.body.lastElementChild);n.removeClass("hidden").show(0);var i=n.outerWidth()/2;var a="calc(50vw - "+i+"px)";n.css("left",a);S=setTimeout(function(){n.fadeOut(100)},1e3)}})()},4846:function(e,t){(function(){var e=10;var t=10;var r=100;var n=100;var i=33;var a=100;TS.registerComponent("SearchableEnterpriseTeamList",{_constructor:function e(t){this.id=t.id;this.triggered_by_user_action=t.triggered_by_user_action;this.$_container=t.$container;this.$_long_list_view;this.$_search_bar;this.$_search_input;this.$_clear_icon;this._team_searcher={};this._have_all_teams=false;this._model_ob_id=t.model_ob_id;this._omit_my_team=!!t.omit_my_team;this._current_query="";this._approx_item_height=30;this._long_list_view_height=0;this._long_list_view_items_height=0;this._long_list_view_initial_height=null;this._fetch_page_p=null;this._resize_sig_handler=null;this.team_clicked_sig=new signals.Signal},destroy:function e(){if(this._resize_sig_handler&&TS.view)TS.view.resize_sig.remove(this._resize_sig_handler);this.$_container.off();if(this.$_long_list_view)this.$_long_list_view.off();if(this.$_search_input)this.$_search_input.off();if(this.$_clear_icon)this.$_clear_icon.off();if(this.$_long_list_view&&this.$_long_list_view.length&&$.data(this.$_long_list_view.get(0),"TS-longListView"))this.$_long_list_view.longListView("destroy");if(this.$_search_bar)this.$_search_bar.remove()},showInitial:function e(){var t=this;this.$_long_list_view=this.$_container.find(".p-searchable_enterprise_team_list__scroller");this._showLoadingState();this._fetchPage().then(function(){t._hideLoadingState()}).then(function(){t._setupLongListView();t._maybeSetupSearchBar();return null})},maybeRerenderLongListView:function e(){if(this.$_long_list_view&&_.get(this._team_searcher,"items"))this.$_long_list_view.longListView("setItems",this._team_searcher.items,true,true)},_fetchPage:function e(){if(this._fetch_page_p)return this._fetch_page_p;var t=this;this._setupSearcher();this._fetch_page_p=TS.teams.promiseToSearchTeams(this._team_searcher).then(function(){t._fetch_page_p=null;t._have_all_teams=t._team_searcher.num_remaining<=0});return this._fetch_page_p},_setupSearcher:function e(){this._team_searcher.max_api_results=this._current_query?r:t;var n=TS.shared.getModelObById(this._model_ob_id);this._team_searcher.included_ids=TS.utility.members.isMember(n)?_.get(n,"enterprise_user.teams",[]):_.get(n,"shared_team_ids",[]);if(_.get(TS.model.user,"is_restricted"))this._team_searcher.included_ids=_.intersection(_.get(TS.model.user,"enterprise_user.teams"),this._team_searcher.included_ids);if(this._omit_my_team)this._team_searcher.omitted_ids=[TS.model.team.id];if(this._current_query)this._team_searcher.query=this._current_query},_fetchProcessAndDisplayPage:function e(){var t=this;return this._fetchPage().then(function(){t._maybeHideNoResultsState();if(_.get(t._team_searcher,"items.length"))t.$_long_list_view.longListView("setItems",t._team_searcher.items,true,true);else t._showNoResultsState();return null}).then(function(){TS.utility.rAF(function(){t._long_list_view_height=t.$_long_list_view.height();t._long_list_view_items_height=t.$_long_list_view.find(".list_items").height();t._recursivelyFillLongListViewToHeight()});return null})},_maybeSetupSearchBar:function t(){var r=this;if(this.$_search_bar)return;var n=TS.shared.getModelObById(this._model_ob_id);var i;if(TS.utility.members.isMember(n))i=_.get(n,"enterprise_user.teams.length");else if(_.get(n,"is_global_shared"))i=Infinity;else i=_.get(n,"shared_team_ids.length");if(i>=e){r.$_long_list_view.before(TS.templates.teams_search_bar());r.$_search_bar=r.$_container.find(".p-searchable_enterprise_team_list__search_bar");r.$_search_input=r.$_search_bar.find(".p-searchable_enterprise_team_list__input");r._setupSearchInput()}},_setupSearchInput:function e(){var t=this;this.$_search_bar.find(".p-searchable_enterprise_team_list__search.loading").replaceWith(TS.templates.teams_search_bar_input());this.$_search_input=this.$_search_bar.find(".p-searchable_enterprise_team_list__input");this.$_clear_icon=this.$_container.find(".icon_close");this.$_search_input.bind("keyup.searchable_enterprise_team_list",this._handleSearchKeyUp.bind(this));this.$_clear_icon.bind("click",function(){t._reset();Promise.resolve().then(function(){t.$_search_input.focus();return null})});if(this.triggered_by_user_action)this.$_search_input.focus()},_setupLongListView:function e(){var t=this;var r=TS.utility.members.isMember(TS.shared.getModelObById(this._model_ob_id));this.$_long_list_view.longListView({items:this._team_searcher.items||[],approx_item_height:this._approx_item_height,approx_divider_height:this._approx_divider_height,calcItemHeight:function e(t){return t.outerHeight()},makeElement:function e(){return $(TS.templates.teams_list_item())},renderItem:function e(n,i){var a=TS.model.team.id!==i.id;var s=r&&a;n.html(TS.templates.teams_team_row({team:i,linked:s?t._buildTeamLink(i):false,target:s?t._buildTeamLinkTarget(i):""}));TS.utility.makeSureAllLinksHaveTargets(n)}});this.$_long_list_view.on("click","[data-long-list-item]",function(e){t.team_clicked_sig.dispatch(e,TS.teams.getTeamById($(e.target).closest(".p-enterprise_team_item").find("[data-team-id]").data("teamId")))});this._resize_sig_handler=_.throttle(function(){t._long_list_view_height=t.$_long_list_view.height();t._long_list_view_items_height=t.$_long_list_view.find(".list_items").height();if(!t._long_list_view_initial_height)t._long_list_view_initial_height=t._long_list_view_height},i);if(TS.view)TS.view.resize_sig.add(this._resize_sig_handler);this.$_long_list_view.on("scroll",_.debounce(function(e){if(t._current_query)return;var r=t._long_list_view_items_height-($(e.target).scrollTop()+t._long_list_view_height);if(r<n)t._fetchProcessAndDisplayPage()},a));TS.utility.rAF(function(){if(TS.view)TS.view.resizeManually("TS.SearchableEnterpriseTeamList.showInitial");t._recursivelyFillLongListViewToHeight()})},_recursivelyFillLongListViewToHeight:function e(){var t=this;if(this._current_query)return;if(this._long_list_view_items_height<=this._long_list_view_height&&!this._have_all_teams)this._fetchProcessAndDisplayPage().then(function(){t._long_list_view_items_height=t.$_long_list_view.find(".list_items").height()})},_reset:function e(){this._team_searcher={};this._current_query="";this.$_search_input.val("");this.$_clear_icon.addClass("hidden");this._have_all_teams=false;this._maybeHideNoResultsState();this.$_long_list_view.longListView("setItems",[],true,true);this.$_long_list_view.scrollTop(0);this.$_long_list_view.height(this._long_list_view_initial_height);this._fetchProcessAndDisplayPage()},_showLoadingState:function e(){this.$_long_list_view.before(TS.templates.infinite_spinner({color:"white",size:"medium"}))},_hideLoadingState:function e(){this.$_container.find(".infinite_spinner").remove()},_showNoResultsState:function e(){var t=this.$_container.find(".no_results");if(t.length>0)t.remove();var r=this;var n={query:this._current_query};var i=TS.templates.teams_searchable_no_results(n);this.$_long_list_view.hide().before(i);this.$_container.delegate(".clear_enterprise_team_filter","click",function(){r._reset()})},_maybeHideNoResultsState:function e(){var t=this.$_container.find(".no_results");if(0==t.length)return;var r=this.$_container.find(".other_matches");if(r)r.remove();t.remove();this.$_long_list_view.show()},_handleSearchKeyUp:function e(t){var r=$(t.target).val();if(r.trim()!==this._current_query){if(this._fetch_page_p){this._fetch_page_p.cancel();this._fetch_page_p=null}this._team_searcher={};this._have_all_teams=false;this._current_query=r.trim();this._fetchProcessAndDisplayPage();this.$_long_list_view.scrollTop(0);this.$_clear_icon.toggleClass("hidden",!this._current_query)}},_buildTeamLink:function e(t){return TS.utility.enterprise.buildTeamUrl(t.domain)+(TS.client?"messages":"home")},_buildTeamLinkTarget:function e(t){return TS.client?"_self":TS.utility.enterprise.buildTeamUrl(t.domain)},test:function n(){var i={};Object.defineProperty(i,"MINIMUM_TEAMS_FOR_SEARCH",{get:function t(){return e},set:function t(r){e=r}});Object.defineProperty(i,"FETCH_PAGE_SIZE",{get:function e(){return t},set:function e(r){t=r}});Object.defineProperty(i,"FETCH_PAGE_SIZE_SEARCH",{get:function e(){return r},set:function e(t){r=t}});return i}})})()},4847:function(e,t){(function(){TS.registerModule("ui.enterprise_teams_dialog",{show:function e(t){a(t)},test:function e(){var t={};Object.defineProperty(t,"_showTeamsDialog",{get:function e(){return a},set:function e(t){a=t}});Object.defineProperty(t,"_getTeamsDialogChannelTitle",{get:function e(){return s},set:function e(t){s=t}});Object.defineProperty(t,"_getTeamsDialogMemberTitle",{get:function e(){return o},set:function e(t){o=t}});return t}});var e="p-enterprise_teams_dialog";var t="enterprise_team_dialog";var r=null;function n(e){$(window.document).bind("keydown",i);var r=$(".p-searchable_enterprise_team_list");var n=new TS.SearchableEnterpriseTeamList({$container:r,id:t,model_ob_id:e.id,triggered_by_user_action:true});n.showInitial();r.on("click",".p-enterprise_team_row",TS.generic_dialog.cancel)}var i=function e(t){if(t.which==TS.utility.keymap.esc)if(""===TS.generic_dialog.div.find("input").val())TS.generic_dialog.cancel()};var a=function a(l){var u=_.get(l,"id");if(r===u)return;r=u;var d=TS.templates.enterprise_teams_dialog();var c=TS.utility.members.isMember(l);var m;if(c&&!_.get(l,"enterprise_user.teams.length"))return;if(!c&&!l.is_global_shared&&!_.get(l,"shared_team_ids.length"))return;m=c?o(l):s(l);TS.generic_dialog.start({dialog_class:e,title:m,body:d,cancel_button_text:TS.i18n.t("Close","teams")(),hide_footer:true,show_cancel_button:true,show_go_button:false,backdrop_click_to_dismiss:true,onShow:function e(){n(l)},onEnd:function e(){var n=TS.SearchableEnterpriseTeamList.get(t);if(n)n.destroy();TS.generic_dialog.div.remove();TS.generic_dialog.div=void 0;$(window.document).unbind("keydown",i);r=null}})};var s=function e(t){return t.is_global_shared?TS.i18n.t("All workspaces in {channel_name}","teams")({channel_name:TS.shared.getDisplayNameForModelOb(t)}):TS.i18n.t("{team_count, number} workspaces in {channel_name}","teams")({team_count:_.get(t,"shared_team_ids.length"),channel_name:TS.shared.getDisplayNameForModelOb(t)})};var o=function e(t){return TS.i18n.t("Your {enterprise_name} workspaces","teams")({enterprise_name:_.get(t,"enterprise_user.enterprise_name")})}})()},4848:function(e,t){(function(){TS.registerModule("searcher",{search:function t(r,n){if(n.limit)n.limit_option={limit:n.limit};else n.limit_option={limit:e};var i=g(r,n);if(n.tiered){var s=a(r,n);s.promise=i;return Promise.resolve(s)}return i},test:function e(){return{count:y}}});var e=24;var t={prefer_exact_match:true,frecency:true,prefer_channels_user_belongs_to:true};var r={include_archived:true,only_if_member:false};var n={include_archived:true};var i={include_self:false,include_slackbot:true,include_bots:true,only_local_team:false,only_admins:false};var a=function e(r,n){var i={};if(n.members)i.members=s(n.members);if(n.channels)i.channels=o(n.channels);if(n.groups)i.groups=l(n.groups);if(n.all_mpims)i.all_mpims=u(n.all_mpims);if(n.mpims)i.mpims=d(n.mpims);if(n.teams)i.teams=c(n.teams);if(n.usergroups)i.usergroups=m(n.usergroups);if(n.views)i.views=f(n.views);if(n.enterprise_channels){i.enterprise_channels=p();i.enterprise_groups=h()}if(n.filter)i=n.filter(i);if(false!==n.sort){var a=b(n.sort,n.limit_option,t);return TS.sorter.search(r,i,a)}return i};var s=function e(t){t=b(t,i);return TS.members.getMembersWithOptions(t)};var o=function e(t){t=b(t,r);var n;n=TS.redux.channels.dangerouslyGetChannelsForUser();if(!t.include_archived)n=_.reject(n,"is_archived");if(t.only_if_member)n=_.filter(n,"is_member");if(t.exclude_mpims)n=_.reject(n,"is_mpim");if(t.can_post)n=_.filter(n,_.curry(TS.permissions.members.canPostInModelOb)(TS.model.user));if(TS.boot_data.feature_cross_workspace_quick_switcher_prototype)n=_.reject(n,{is_moved:1,is_archived:true});return n};var l=function e(t){t=b(t,n);var r=TS.redux.channels.dangerouslyGetGroups();if(!t.include_archived)r=_.reject(r,"is_archived");r=_.reject(r,{is_moved:1,is_archived:true});return r};var u=function e(){var t;t=TS.channels.getAllVisibleMpimsForUser(TS.redux.channels.dangerouslyGetMpims());return t};var d=function e(){var t;t=TS.redux.channels.dangerouslyGetMpims();return t};var c=function e(){var t=_.map(TS.boot_data.other_accounts,function(e){return TS.teams.getTeamById(e.team_id)});var r=[];if(TS.boot_data.page_needs_enterprise&&(!TS.model.is_our_app||TS.environment.isSSBAndAtLeastVersion("2.8")))r=_.values(TS.teams.getEnterpriseTeams({only_member_of:true,exclude_current_team:true}));return _.uniqBy(r.concat(t),"id")};var m=function e(){return TS.user_groups.getActiveUserGroups().slice()};var f=function e(){var t=[];if(TS.client.unread.isEnabled())t.push(_.find(TS.model.NAMED_VIEWS,{id:"Vall_unreads"}));t.push(_.find(TS.model.NAMED_VIEWS,{id:"Vall_threads"}));if(TS.apps.isAppSpaceEnabled())t.push(_.find(TS.model.NAMED_VIEWS,{id:"Vapp_space"}));if(TS.client.ui.apps_dashboard.isEnabled())t.push(_.find(TS.model.NAMED_VIEWS,{id:"Vapps_dashboard"}));return t};var p=function e(){return TS.enterprise.getChannels()};var h=function e(){return TS.enterprise.getGroups()};var g=function e(t,r){var n=[];if(r.members)n.push(S(t,r));if(TS.boot_data.page_needs_enterprise){if(r.enterprise_channels)n.push(v(t,r));if(r.teams)n.push(T(t,r))}return Promise.all(n).then(function(){return a(t,r)})};var S=function e(t,r){r=b(r.members,r.limit_option,i);r.max_api_results=r.limit;if("@"===t.charAt(0))t=t.slice(1);r.query=t;return TS.members.promiseToSearchMembers(r)};var T=function e(t,r){r=b(r.teams,r.limit_option);r.query=t;return TS.teams.promiseToSearchTeams(r)};var v=function e(t,r){r=b(r.enterprise_channels,r.limit_option);r.query=t;r.count=r.limit;return TS.enterprise.promiseToSearchEnterpriseChannels(r)};var b=function e(t,r){if(true===t)t={};return _.defaultsDeep.apply(null,arguments)};var y=function e(t){return _.size(_.flatten(_.values(t)))}})()},4849:function(e,t){(function(){TS.registerModule("sli_expert_search",{is_expanded:false,last_query:"",last_api_response:{},sli_expert_search_debug_group:null,onStart:function e(){if(TS.client)TS.experiment.loadUserAssignments().then(function(){TS.sli_expert_search.sli_expert_search_debug_group=TS.experiment.getGroup("sli_expert_search_debug")})},render:function n(i,a,s,o){TS.sli_expert_search.last_api_response={experts:s,channels:o};if(TS.sli_expert_search.last_query!==i){TS.sli_expert_search.is_expanded=false;TS.sli_expert_search.last_query=i}var l="";var u=_(s).map(function(e){return _.map(e.users,function(e){return TS.members.getMemberById(e.id)})}).flatten().uniqBy("id").value();var d=u.length;var c=u.length>4;u=_.take(u,4);var m=_.map(s,function(n,a){if("order"===a)return;var s=_.map(n.users,function(e){return TS.members.getMemberById(e.id)});var o=_.map(n.channels,function(e){return TS.channels.getChannelById(e.id)});return{users:s,faces:_.take(s,2),description:e(s,o),channels:o,partial_terms:!t(i,n.terms),terms:r(i,n.terms)}});m=_.compact(m);var f=[];if(!_.isEmpty(o)){var p=_.map(o,function(e,t){if("order"===t)return;var r=TS.channels.getChannelById(e.id);return TS.templates.builders.makeChannelLink(r)});p=_.compact(p);f.push({channels:new Handlebars.SafeString(TS.i18n.listify(p,{no_escape:true}).join(""))})}l+=TS.templates.sli_expert_search_results({query:a,users:u,user_count:d,show_plus_sign_on_last_face:c,terms:i,results:m,channel_matches:f,expanded:TS.sli_expert_search.is_expanded,debug:"sli_expert_search_debug"===TS.sli_expert_search.sli_expert_search_debug_group});return l},toggleExpand:function e(){TS.sli_expert_search.is_expanded=!TS.sli_expert_search.is_expanded;$("[data-js=sli_expert_search]").toggleClass("sli_expert_search--collapsed",!TS.sli_expert_search.is_expanded);TS.clog.track(TS.sli_expert_search.is_expanded?"SEARCH_OPEN":"SEARCH_CLOSE",{request_id:TS.search.last_request_id,client_request_id:TS.search.client_request_id,open_method:TS.sli_expert_search.is_expanded?"experts_expand":"experts_collapse",search_session_id:TS.search.getSearchSessionId()})},handleExpertsClick:function e(t,r,n){var i;var a;var s;a=$(t.target).parents("[data-expert-search-group-index]").data("expert-search-group-index");if("experts"===r)if("user"===n){i=$(t.target).closest(".member").index();s=_.get(TS.sli_expert_search.last_api_response,["experts",a,"users",i,"iid"])}else{i=$(t.target).closest(".channel_link").index();s=_.get(TS.sli_expert_search.last_api_response,["experts",a,"channels",i,"iid"])}else if("channels"===r&&"channel"===n){i=$(t.target).closest(".channel_link").index();s=_.get(TS.sli_expert_search.last_api_response,["channels",i,"iid"])}var o={request_id:TS.search.last_request_id,click_iid:s,click_target_type:"experts_"+n,click_module_name:r,click_module_position:TS.sli_expert_search.last_api_response[r].order,click_sort:"timestamp",click_position:a,search_session_id:TS.search.getSearchSessionIdForResults(),client_request_id:TS.search.getQuerySessionIdForResults()};o["click_"+n+"_id"]=$(t.target).data(("user"===n?"member":"channel")+"-id");if(s)TS.clog.track("SEARCH_CLICK",o)}});var e=function e(t,r){var n=_.map(t,TS.templates.builders.makeMemberPreviewLink);var i=TS.i18n.listify(n,{no_escape:true}).join("");var a=_.map(r,function(e){return TS.templates.builders.makeChannelLink(e)});var s=TS.i18n.listify(a,{strong:true,no_escape:true}).join("");return TS.i18n.t("{user_link_text} in {channel_link_text}","search")({user_link_text:i,channel_link_text:s})};var t=function e(t,r){return _(t).split(" ").map(function(e){return r[e]}).every(Boolean)};var r=function e(t,r){return _.map(t.split(" "),function(e){return{word:e,present:r[e]}})}})()},4850:function(e,t){(function(){TS.registerModule("sli_search_facets",{sli_search_facet_debug_group:null,onStart:function e(){if(TS.client)TS.experiment.loadUserAssignments().then(function(){TS.sli_search_facets.sli_search_facet_debug_group=TS.experiment.getGroup("sli_debug_facet_suggestions")})},isEnabled:function e(){var t=TS.sli_search_facets.sli_search_facet_debug_group;if(t)return t.startsWith("sli_facet_suggestions");return false},render:function e(t,r){var n=null;if(t)n=_(t).chain().filter(function(e,t){return"order"!==t}).map(function(e){return _.get(TS.channels.getChannelById(e.id),"name")||_.get(TS.groups.getGroupById(e.id),"name")||"???"}).value();var i=null;if(r)i=_(r).chain().filter(function(e,t){return"order"!==t}).map(function(e){return _.get(TS.members.getMemberById(e.id),"name")||_.get(TS.bots.getBotById(e.id),"name")||"???"}).value();var a="";a+=TS.templates.sli_search_facets_results({channel_names:n,user_names:i});return a}})})()},5180:function(e,t){(function(){function e(e){var t=TS.interop.utility.snakeCaseKeys(e);if(!t.is_known)Object.defineProperty(t,"is_member",{get:function e(){throw new Error("Value for is_member is not known; check is_known before accessing this field")}});return t}TS.registerModule("redux.membership",{upsertChannelMembershipInfoForUsers:function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.channelId,n=t.membershipInfo;if(!_.isString(r)||!_.isObject(n))return;TS.redux.dispatch(TS.interop.redux.models.membership.upsertChannelMembershipInfoForUsers({channelId:r,membershipInfo:n}))},clearChannelMembershipInfoForUsers:function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.channelId,n=t.userIds;if(!_.isString(r)||!_.isArray(n))return;TS.redux.dispatch(TS.interop.redux.models.membership.clearChannelMembershipInfoForUsers({channelId:r,userIds:n}))},clearChannelMembershipInfo:function e(t){if(!t)return;TS.redux.dispatch(TS.interop.redux.models.membership.clearChannelMembershipInfoForUsers(t))},getChannelMembershipInfoForUser:function t(r,n){if(!TS.interop.redux.models.membership.getChannelMembershipInfoForUser)return{};return e(TS.interop.redux.models.membership.getChannelMembershipInfoForUser(TS.redux.getState(),r,n))},ensureChannelMembershipIsKnownForUsers:function e(t,r){if(!TS.interop.redux.models.membership.ensureChannelMembershipIsKnownForUsers)return Promise.reject();return TS.interop.redux.models.membership.ensureChannelMembershipIsKnownForUsers(TS.redux.getState(),t,r)}})})()}},[4741]);